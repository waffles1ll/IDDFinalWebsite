(function(){const kt=document.createElement("link").relList;if(kt&&kt.supports&&kt.supports("modulepreload"))return;for(const Ke of document.querySelectorAll('link[rel="modulepreload"]'))p(Ke);new MutationObserver(Ke=>{for(const ct of Ke)if(ct.type==="childList")for(const ut of ct.addedNodes)ut.tagName==="LINK"&&ut.rel==="modulepreload"&&p(ut)}).observe(document,{childList:!0,subtree:!0});function V(Ke){const ct={};return Ke.integrity&&(ct.integrity=Ke.integrity),Ke.referrerPolicy&&(ct.referrerPolicy=Ke.referrerPolicy),Ke.crossOrigin==="use-credentials"?ct.credentials="include":Ke.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function p(Ke){if(Ke.ep)return;Ke.ep=!0;const ct=V(Ke);fetch(Ke.href,ct)}})();/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),V.Z=ct},356:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),V.Z=ct},44:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),V.Z=ct},27:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%;-o-object-fit:contain;object-fit:contain}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),V.Z=ct},798:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),V.Z=ct},729:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,'.button-bar{background:var(--tp-base-background-color);width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:500;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:var(--tp-input-foreground-color, #cccccc);transition:color .25s}.button-bar-button:hover{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected-box{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:var(--tp-container-background-color-active, #413762)}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:var(--tp-container-foreground-color, #cccccc);transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s;box-sizing:content-box !important}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem;aspect-ratio:1;box-sizing:content-box !important}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px;flex-wrap:nowrap !important;overflow-x:scroll;pointer-events:auto;max-width:100%;align-content:center;justify-content:flex-start;align-items:center;box-sizing:border-box}.mode-buttons-container::-webkit-scrollbar{display:none}.mode-buttons-container{-ms-overflow-style:none;scrollbar-width:none}.mode-button{font-weight:500}#webgi-logo{background-image:url("https://static.webgi.xyz/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:7.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem;color:var(--tp-container-foreground-color, #dddddd)}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.9rem !important;color:var(--tp-container-foreground-color, #dddddd) !important}#tweakpaneUiContainer{margin-top:4.5rem}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{transition:background-color .5s ease;background-color:#d1d4e7}body.tpTheme-blue{background-color:#d1d4e7}body.tpTheme-white{background-color:#dcdcdc}body.tpTheme-black{background-color:#48495d}',""]),V.Z=ct},898:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,':root{--tp-blade-unit-size: 26px;--tp-font-family: "Inter";--tp-element-border-radius: 0.25rem}:root{--tp-base-background-color: #0e0e0e;--tp-container-background-color: rgba(32, 32, 32, 0.2);--tp-container-background-color-hover: rgba(32, 32, 32, 0.3);--tp-container-background-color-active: rgba(50, 50, 50, 0.8);--tp-container-background-color-focus: rgba(50, 50, 50, 1.0);--tp-container-foreground-color: hsla(0, 0%, 90%, 0.90);--tp-label-foreground-color: hsla(0, 0%, 85%, 0.90)}:root .tpTheme-blue{--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 36%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED}:root .tpTheme-white{--tp-base-background-color: hsla(230, 5%, 90%, 1.00);--tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);--tp-button-background-color: hsla(230, 7%, 85%, 1.00);--tp-button-background-color-active: hsla(230, 7%, 70%, 1.00);--tp-button-background-color-focus: hsla(230, 7%, 75%, 1.00);--tp-button-background-color-hover: hsla(230, 7%, 80%, 1.00);--tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-container-background-color: hsla(230, 15%, 80%, 0.10);--tp-container-background-color-active: hsla(230, 15%, 70%, 0.32);--tp-container-background-color-focus: hsla(230, 15%, 70%, 0.28);--tp-container-background-color-hover: hsla(230, 15%, 70%, 0.24);--tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-groove-foreground-color: hsla(230, 15%, 20%, 0.10);--tp-input-background-color: hsla(230, 15%, 30%, 0.10);--tp-input-background-color-active: hsla(230, 15%, 50%, 0.22);--tp-input-background-color-focus: hsla(230, 15%, 50%, 0.18);--tp-input-background-color-hover: hsla(230, 15%, 50%, 0.14);--tp-input-foreground-color: hsla(230, 10%, 20%, 1.00);--tp-label-foreground-color: hsla(230, 10%, 10%, 1.00);--tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);--tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50)}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.9rem !important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.7rem !important}.tp-lblv_l{font-size:.75rem !important;font-weight:500 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.75rem !important;font-weight:500 !important}.tp-fldv_t{font-weight:500 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:var(--tp-container-foreground-color, #eeeeee);font-size:.9rem;border:none}.tp-sldv_k::after{background-color:var(--tp-input-foreground-color, hsl(230, 7%, 75%))}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{font-weight:500 !important}.tp-rotv{font-size:13px !important}',""]),V.Z=ct},513:function(kt,V,p){var Ke=p(352),ct=p.n(Ke)()(function(ut){return ut[1]});ct.push([kt.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),V.Z=ct},476:function(kt){var V;V=function(){return function(p){var Ke={};function ct(ut){if(Ke[ut])return Ke[ut].exports;var tt=Ke[ut]={i:ut,l:!1,exports:{}};return p[ut].call(tt.exports,tt,tt.exports,ct),tt.l=!0,tt.exports}return ct.m=p,ct.c=Ke,ct.i=function(ut){return ut},ct.d=function(ut,tt,_t){ct.o(ut,tt)||Object.defineProperty(ut,tt,{configurable:!1,enumerable:!0,get:_t})},ct.n=function(ut){var tt=ut&&ut.__esModule?function(){return ut.default}:function(){return ut};return ct.d(tt,"a",tt),tt},ct.o=function(ut,tt){return Object.prototype.hasOwnProperty.call(ut,tt)},ct.p="",ct(ct.s=5)}([function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0});var ut={convertToObject:function(tt){var _t=tt.substring(tt.indexOf("{")+1).trim().slice(0,-1),it={};return _t.split(";").map(function(dt){if(dt=dt.trim()){var At=dt.split(":");it[At[0].trim()]=At[1].trim()}}),it},getFromSheets:function(tt){var _t=document.styleSheets;for(var it in _t){var dt=null;try{dt=_t[it].rules||_t[it].cssRules}catch{}if(dt){for(var At in dt)if(dt[At].selectorText&&dt[At].selectorText.split(",").indexOf(tt)!=-1)return dt[At].cssText?ut.convertToObject(dt[At].cssText):ut.convertToObject(dt[At].style.cssText)}}return{}},getPropertyDefault:function(tt){return tt=="timing-function"?"ease":tt=="iteration-count"?1:tt=="direction"?"normal":tt=="fill-mode"?"none":null}};Ke.default=ut},function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0});var ut={generateId:function(){for(var tt="",_t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",it=0;it<8;++it)tt+=_t.charAt(Math.floor(Math.random()*_t.length));return tt},frameToString:function(tt){var _t="";for(var it in tt)_t+=it+":"+tt[it]+";";return _t},convertTimeToMs:function(tt){if(!tt)return 0;if(typeof tt=="number")return tt;var _t=parseFloat(tt);return tt.indexOf("ms")!=-1?_t:1e3*_t},prefixes:["","-webkit-","-moz-","-o-"]};Ke.default=ut},function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0});var ut,tt=(ut=ct(0))&&ut.__esModule?ut:{default:ut};Ke.default=function _t(it,dt){if(function(pt,Re){if(!(pt instanceof Re))throw new TypeError("Cannot call a class as a function")}(this,_t),this.styles=typeof it=="string"?tt.default.getFromSheets(it):it,typeof dt=="string"){var At=tt.default.getFromSheets(dt);for(var Mt in this.options={},At)this.options[Mt.replace("animation-","")]=At[Mt]}else this.options=typeof dt=="number"?{duration:dt}:dt}},function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0});var ut=function(){function Mt(pt,Re){for(var lt=0;lt<Re.length;lt++){var Ce=Re[lt];Ce.enumerable=Ce.enumerable||!1,Ce.configurable=!0,"value"in Ce&&(Ce.writable=!0),Object.defineProperty(pt,Ce.key,Ce)}}return function(pt,Re,lt){return Re&&Mt(pt.prototype,Re),lt&&Mt(pt,lt),pt}}(),tt=dt(ct(4)),_t=dt(ct(1)),it=dt(ct(0));function dt(Mt){return Mt&&Mt.__esModule?Mt:{default:Mt}}var At=function(){function Mt(pt,Re,lt,Ce){if(function(Fe,Ct){if(!(Fe instanceof Ct))throw new TypeError("Cannot call a class as a function")}(this,Mt),pt.constructor===Array?this.doms=pt:this.doms=[pt],Re.constructor===Array?this.frames=Re:this.frames=[Re],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},lt!=null&&lt!=null)if(typeof lt=="boolean")this.options.instant=lt;else if(typeof lt=="number")this.options.count=lt,typeof Ce=="boolean"&&(this.options.instant=Ce);else for(var vt in lt)vt=="pauseAt"&&lt.pauseAt.constructor!==Array?this.options[vt]=[lt[vt]]:this.options[vt]=lt[vt];for(var at in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=_t.default.prefixes:this.prefixes=[""],pt)this.countRemainder[at]=this.options.count-1;this.options.instant&&this.play()}return ut(Mt,[{key:"play",value:function(){var pt=this;for(var Re in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(Ce){pt.promiseResolve=Ce})),this.doms){var lt=this.makeAnimation(this.doms[Re]);this.animations[Re]=lt.names,this.styleDoms[Re]=lt.styleDom,this.superSets[Re]=this.makeSuperSet(this.doms[Re],this.animations[Re]),this.playAnimation(this.doms[Re],this.superSets[Re]),this.eventHandler[Re]=this.handleAnimationEnd.bind(this,Re),this.doms[Re].addEventListener("animationend",this.eventHandler[Re])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(pt){if(!pt){for(var Re in this.doms)this.clear(Re);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var lt=this.styleDoms[pt];for(var Ce in lt&&lt.parentNode&&lt.parentNode.removeChild(lt),this.superSets[pt])for(var vt in this.prefixes)this.doms[pt].style[this.prefixes[vt]+"animation-"+Ce]=null;for(var at in this.prefixes)this.doms[pt].style[this.prefixes[at]+"animation-play-state"]=null;this.doms[pt].removeEventListener("animationend",this.eventHandler[pt]),this.countRemainder[pt]=this.options.count-1}},{key:"replay",value:function(pt){var Re=this.doms[pt],lt=Re.cloneNode(!0);Re.parentNode.replaceChild(lt,Re),this.doms[pt].removeEventListener("animationend",this.eventHandler[pt]),this.doms[pt]=lt,this.doms[pt].addEventListener("animationend",this.eventHandler[pt])}},{key:"pause",value:function(){for(var pt in this.doms)this.pauseDom(this.doms[pt])}},{key:"resume",value:function(){for(var pt in this.doms)this.resumeDom(this.doms[pt])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(pt,Re){var lt=Re.animationName,Ce=lt.substring(lt.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(Ce))&&this.pauseDom(this.doms[pt]),Ce==this.frames.length&&(this.countRemainder[pt]==-1?this.replay(pt):this.countRemainder[pt]>0?(this.countRemainder[pt]--,this.replay(pt)):(this.options.applyOnEnd&&this.applyOnEnd(pt),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(pt){for(var Re in this.prefixes)pt.style[this.prefixes[Re]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(pt){for(var Re in this.prefixes)pt.style[this.prefixes[Re]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(pt){var Re=this.newFrames[this.frames.length];for(var lt in Re)this.doms[pt].style[lt]=Re[lt]}},{key:"makeAnimation",value:function(pt){var Re={},lt=[],Ce={};for(var vt in this.frames)for(var at in lt.push(this.frames[vt].styles),lt[vt])Ce[at]=!0;var Fe=window.getComputedStyle(pt);for(var Ct in Ce)Re[Ct]=Fe[Ct];lt.unshift(Re);for(var Ft=[lt[0]],Ue=1;Ue<lt.length;++Ue){var $e=JSON.parse(JSON.stringify(Ft[Ue-1]));for(var Z in lt[Ue])$e[Z]=lt[Ue][Z];Ft.push($e)}return this.newFrames=Ft,tt.default.make(Ft,this.prefixes)}},{key:"makeSuperSet",value:function(pt,Re){var lt=0,Ce={};for(var vt in this.frames)for(var at in this.frames[vt].options)Ce[at]="";Ce.name="",Ce.duration="",Ce.delay="";for(var Fe=0;Fe<this.frames.length;++Fe){if(Fe)for(var Ct in Ce)Ce[Ct]+=",";var Ft=_t.default.convertTimeToMs(this.frames[Fe].options.duration),Ue=_t.default.convertTimeToMs(this.frames[Fe].options.delay);for(var $e in Fe<this.options.startFrom&&(Ft=0,Ue=0),Ce.name+=Re[Fe],Ce.duration+=Ft+"ms",Ce.delay+=lt+Ue+"ms",Ce)$e!="name"&&$e!="duration"&&$e!="delay"&&(Ce[$e]+=this.frames[Fe].options[$e]?this.frames[Fe].options[$e]:it.default.getPropertyDefault($e));var Z=this.frames[Fe].options["iteration-count"];lt+=Ft*parseInt(Z||1)+Ue}return Ce}},{key:"playAnimation",value:function(pt,Re){for(var lt in Re)for(var Ce in this.prefixes)pt.style[this.prefixes[Ce]+"animation-"+lt]=Re[lt];this.options.pauseAt.includes(0)&&this.pauseDom(pt)}}]),Mt}();Ke.default=At},function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0});var ut,tt=(ut=ct(1))&&ut.__esModule?ut:{default:ut},_t={make:function(it,dt){for(var At=[],Mt="",pt="atr-"+tt.default.generateId(),Re=document.createElement("style"),lt=0;lt<it.length-1;++lt)At.push(pt+"-"+(lt+1)),Mt+=_t.makeFromTwoFrames(it[lt],it[lt+1],At[lt],dt);return Re.innerHTML=Mt,Re.class="foo",document.getElementsByTagName("head")[0].appendChild(Re),{names:At,styleDom:Re}},makeFromTwoFrames:function(it,dt,At,Mt){var pt="";for(var Re in Mt)pt+="@"+Mt[Re]+"keyframes "+At+" {",pt+="0%",pt+="{"+tt.default.frameToString(it)+"}",pt+="100%",pt+="{"+tt.default.frameToString(dt)+"}",pt+="}";return pt}};Ke.default=_t},function(p,Ke,ct){Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.Queue=Ke.Frame=void 0;var ut=_t(ct(2)),tt=_t(ct(3));function _t(it){return it&&it.__esModule?it:{default:it}}Ke.Frame=ut.default,Ke.Queue=tt.default}])},kt.exports=V()},352:function(kt){kt.exports=function(V){var p=[];return p.toString=function(){return this.map(function(Ke){var ct=V(Ke);return Ke[2]?"@media ".concat(Ke[2]," {").concat(ct,"}"):ct}).join("")},p.i=function(Ke,ct,ut){typeof Ke=="string"&&(Ke=[[null,Ke,""]]);var tt={};if(ut)for(var _t=0;_t<this.length;_t++){var it=this[_t][0];it!=null&&(tt[it]=!0)}for(var dt=0;dt<Ke.length;dt++){var At=[].concat(Ke[dt]);ut&&tt[At[0]]||(ct&&(At[2]?At[2]="".concat(ct," and ").concat(At[2]):At[2]=ct),p.push(At))}},p}},388:function(kt){kt.exports=function V(p,Ke,ct){function ut(it,dt){if(!Ke[it]){if(!p[it]){if(tt)return tt(it,!0);throw new Error("Cannot find module '"+it+"'")}var At=Ke[it]={exports:{}};p[it][0].call(At.exports,function(Mt){return ut(p[it][1][Mt]||Mt)},At,At.exports,V,p,Ke,ct)}return Ke[it].exports}for(var tt=void 0,_t=0;_t<ct.length;_t++)ut(ct[_t]);return ut}({1:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){var Re=V("crypto");function lt(Ue,$e){return function(Z,ee){var ce;if((ce=ee.algorithm!=="passthrough"?Re.createHash(ee.algorithm):new Ft).write===void 0&&(ce.write=ce.update,ce.end=ce.update),Ct(ee,ce).dispatch(Z),ce.update||ce.end(""),ce.digest)return ce.digest(ee.encoding==="buffer"?void 0:ee.encoding);var Ne=ce.read();return ee.encoding!=="buffer"?Ne.toString(ee.encoding):Ne}(Ue,$e=at(Ue,$e))}(Ke=p.exports=lt).sha1=function(Ue){return lt(Ue)},Ke.keys=function(Ue){return lt(Ue,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},Ke.MD5=function(Ue){return lt(Ue,{algorithm:"md5",encoding:"hex"})},Ke.keysMD5=function(Ue){return lt(Ue,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var Ce=Re.getHashes?Re.getHashes().slice():["sha1","md5"];Ce.push("passthrough");var vt=["buffer","hex","binary","base64"];function at(Ue,$e){$e=$e||{};var Z={};if(Z.algorithm=$e.algorithm||"sha1",Z.encoding=$e.encoding||"hex",Z.excludeValues=!!$e.excludeValues,Z.algorithm=Z.algorithm.toLowerCase(),Z.encoding=Z.encoding.toLowerCase(),Z.ignoreUnknown=$e.ignoreUnknown===!0,Z.respectType=$e.respectType!==!1,Z.respectFunctionNames=$e.respectFunctionNames!==!1,Z.respectFunctionProperties=$e.respectFunctionProperties!==!1,Z.unorderedArrays=$e.unorderedArrays===!0,Z.unorderedSets=$e.unorderedSets!==!1,Z.unorderedObjects=$e.unorderedObjects!==!1,Z.replacer=$e.replacer||void 0,Z.excludeKeys=$e.excludeKeys||void 0,Ue===void 0)throw new Error("Object argument required.");for(var ee=0;ee<Ce.length;++ee)Ce[ee].toLowerCase()===Z.algorithm.toLowerCase()&&(Z.algorithm=Ce[ee]);if(Ce.indexOf(Z.algorithm)===-1)throw new Error('Algorithm "'+Z.algorithm+'"  not supported. supported values: '+Ce.join(", "));if(vt.indexOf(Z.encoding)===-1&&Z.algorithm!=="passthrough")throw new Error('Encoding "'+Z.encoding+'"  not supported. supported values: '+vt.join(", "));return Z}function Fe(Ue){if(typeof Ue=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(Ue))!=null}function Ct(Ue,$e,Z){function ee(ce){return $e.update?$e.update(ce,"utf8"):$e.write(ce,"utf8")}return Z=Z||[],{dispatch:function(ce){return Ue.replacer&&(ce=Ue.replacer(ce)),this["_"+(ce===null?"null":typeof ce)](ce)},_object:function(ce){var Ne,K=Object.prototype.toString.call(ce),ie=/\[object (.*)\]/i.exec(K);if(ie=(ie=ie?ie[1]:"unknown:["+K+"]").toLowerCase(),0<=(Ne=Z.indexOf(ce)))return this.dispatch("[CIRCULAR:"+Ne+"]");if(Z.push(ce),tt!==void 0&&tt.isBuffer&&tt.isBuffer(ce))return ee("buffer:"),ee(ce);if(ie==="object"||ie==="function"||ie==="asyncfunction"){var he=Object.keys(ce);Ue.unorderedObjects&&(he=he.sort()),Ue.respectType===!1||Fe(ce)||he.splice(0,0,"prototype","__proto__","constructor"),Ue.excludeKeys&&(he=he.filter(function(He){return!Ue.excludeKeys(He)})),ee("object:"+he.length+":");var _e=this;return he.forEach(function(He){_e.dispatch(He),ee(":"),Ue.excludeValues||_e.dispatch(ce[He]),ee(",")})}if(!this["_"+ie]){if(Ue.ignoreUnknown)return ee("["+ie+"]");throw new Error('Unknown object type "'+ie+'"')}this["_"+ie](ce)},_array:function(ce,Ne){Ne=Ne!==void 0?Ne:Ue.unorderedArrays!==!1;var K=this;if(ee("array:"+ce.length+":"),!Ne||ce.length<=1)return ce.forEach(function(_e){return K.dispatch(_e)});var ie=[],he=ce.map(function(_e){var He=new Ft,gt=Z.slice();return Ct(Ue,He,gt).dispatch(_e),ie=ie.concat(gt.slice(Z.length)),He.read().toString()});return Z=Z.concat(ie),he.sort(),this._array(he,!1)},_date:function(ce){return ee("date:"+ce.toJSON())},_symbol:function(ce){return ee("symbol:"+ce.toString())},_error:function(ce){return ee("error:"+ce.toString())},_boolean:function(ce){return ee("bool:"+ce.toString())},_string:function(ce){ee("string:"+ce.length+":"),ee(ce.toString())},_function:function(ce){ee("fn:"),Fe(ce)?this.dispatch("[native]"):this.dispatch(ce.toString()),Ue.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(ce.name)),Ue.respectFunctionProperties&&this._object(ce)},_number:function(ce){return ee("number:"+ce.toString())},_xml:function(ce){return ee("xml:"+ce.toString())},_null:function(){return ee("Null")},_undefined:function(){return ee("Undefined")},_regexp:function(ce){return ee("regex:"+ce.toString())},_uint8array:function(ce){return ee("uint8array:"),this.dispatch(Array.prototype.slice.call(ce))},_uint8clampedarray:function(ce){return ee("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(ce))},_int8array:function(ce){return ee("uint8array:"),this.dispatch(Array.prototype.slice.call(ce))},_uint16array:function(ce){return ee("uint16array:"),this.dispatch(Array.prototype.slice.call(ce))},_int16array:function(ce){return ee("uint16array:"),this.dispatch(Array.prototype.slice.call(ce))},_uint32array:function(ce){return ee("uint32array:"),this.dispatch(Array.prototype.slice.call(ce))},_int32array:function(ce){return ee("uint32array:"),this.dispatch(Array.prototype.slice.call(ce))},_float32array:function(ce){return ee("float32array:"),this.dispatch(Array.prototype.slice.call(ce))},_float64array:function(ce){return ee("float64array:"),this.dispatch(Array.prototype.slice.call(ce))},_arraybuffer:function(ce){return ee("arraybuffer:"),this.dispatch(new Uint8Array(ce))},_url:function(ce){return ee("url:"+ce.toString())},_map:function(ce){ee("map:");var Ne=Array.from(ce);return this._array(Ne,Ue.unorderedSets!==!1)},_set:function(ce){ee("set:");var Ne=Array.from(ce);return this._array(Ne,Ue.unorderedSets!==!1)},_file:function(ce){return ee("file:"),this.dispatch([ce.name,ce.size,ce.type,ce.lastModfied])},_blob:function(){if(Ue.ignoreUnknown)return ee("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return ee("domwindow")},_bigint:function(ce){return ee("bigint:"+ce.toString())},_process:function(){return ee("process")},_timer:function(){return ee("timer")},_pipe:function(){return ee("pipe")},_tcp:function(){return ee("tcp")},_udp:function(){return ee("udp")},_tty:function(){return ee("tty")},_statwatcher:function(){return ee("statwatcher")},_securecontext:function(){return ee("securecontext")},_connection:function(){return ee("connection")},_zlib:function(){return ee("zlib")},_context:function(){return ee("context")},_nodescript:function(){return ee("nodescript")},_httpparser:function(){return ee("httpparser")},_dataview:function(){return ee("dataview")},_signal:function(){return ee("signal")},_fsevent:function(){return ee("fsevent")},_tlswrap:function(){return ee("tlswrap")}}}function Ft(){return{buf:"",write:function(Ue){this.buf+=Ue},end:function(Ue){this.buf+=Ue},read:function(){return this.buf}}}Ke.writeToStream=function(Ue,$e,Z){return Z===void 0&&(Z=$e,$e={}),Ct($e=at(Ue,$e),Z).dispatch(Ue)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){(function(Re){var lt=typeof Uint8Array<"u"?Uint8Array:Array,Ce="+".charCodeAt(0),vt="/".charCodeAt(0),at="0".charCodeAt(0),Fe="a".charCodeAt(0),Ct="A".charCodeAt(0),Ft="-".charCodeAt(0),Ue="_".charCodeAt(0);function $e(Z){var ee=Z.charCodeAt(0);return ee===Ce||ee===Ft?62:ee===vt||ee===Ue?63:ee<at?-1:ee<at+10?ee-at+26+26:ee<Ct+26?ee-Ct:ee<Fe+26?ee-Fe+26:void 0}Re.toByteArray=function(Z){var ee,ce;if(0<Z.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Ne=Z.length,K=Z.charAt(Ne-2)==="="?2:Z.charAt(Ne-1)==="="?1:0,ie=new lt(3*Z.length/4-K),he=0<K?Z.length-4:Z.length,_e=0;function He(gt){ie[_e++]=gt}for(ee=0;ee<he;ee+=4,0)He((16711680&(ce=$e(Z.charAt(ee))<<18|$e(Z.charAt(ee+1))<<12|$e(Z.charAt(ee+2))<<6|$e(Z.charAt(ee+3))))>>16),He((65280&ce)>>8),He(255&ce);return K==2?He(255&(ce=$e(Z.charAt(ee))<<2|$e(Z.charAt(ee+1))>>4)):K==1&&(He((ce=$e(Z.charAt(ee))<<10|$e(Z.charAt(ee+1))<<4|$e(Z.charAt(ee+2))>>2)>>8&255),He(255&ce)),ie},Re.fromByteArray=function(Z){var ee,ce,Ne,K,ie=Z.length%3,he="";function _e(He){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(He)}for(ee=0,Ne=Z.length-ie;ee<Ne;ee+=3)he+=_e((K=ce=(Z[ee]<<16)+(Z[ee+1]<<8)+Z[ee+2])>>18&63)+_e(K>>12&63)+_e(K>>6&63)+_e(63&K);switch(ie){case 1:he+=_e((ce=Z[Z.length-1])>>2),he+=_e(ce<<4&63),he+="==";break;case 2:he+=_e((ce=(Z[Z.length-2]<<8)+Z[Z.length-1])>>10),he+=_e(ce>>4&63),he+=_e(ce<<2&63),he+="="}return he}})(Ke===void 0?this.base64js={}:Ke)}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(V,p,Ke){(function(ct,ut,Ce,_t,it,dt,At,Mt,pt){var Re=V("base64-js"),lt=V("ieee754");function Ce(oe,Ie,We){if(!(this instanceof Ce))return new Ce(oe,Ie,We);var Wt,ti,mi,rr,Oi,Lr=typeof oe;if(Ie==="base64"&&Lr=="string")for(oe=(Wt=oe).trim?Wt.trim():Wt.replace(/^\s+|\s+$/g,"");oe.length%4!=0;)oe+="=";if(Lr=="number")ti=_e(oe);else if(Lr=="string")ti=Ce.byteLength(oe,Ie);else{if(Lr!="object")throw new Error("First argument needs to be a number, array or string.");ti=_e(oe.length)}if(Ce._useTypedArrays?mi=Ce._augment(new Uint8Array(ti)):((mi=this).length=ti,mi._isBuffer=!0),Ce._useTypedArrays&&typeof oe.byteLength=="number")mi._set(oe);else if(He(Oi=oe)||Ce.isBuffer(Oi)||Oi&&typeof Oi=="object"&&typeof Oi.length=="number")for(rr=0;rr<ti;rr++)Ce.isBuffer(oe)?mi[rr]=oe.readUInt8(rr):mi[rr]=oe[rr];else if(Lr=="string")mi.write(oe,0,Ie);else if(Lr=="number"&&!Ce._useTypedArrays&&!We)for(rr=0;rr<ti;rr++)mi[rr]=0;return mi}function vt(oe,Ie,We,Wt){Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie!=null,"missing offset"),Qe(Ie+1<oe.length,"Trying to read beyond buffer length"));var ti,mi=oe.length;if(!(mi<=Ie))return We?(ti=oe[Ie],Ie+1<mi&&(ti|=oe[Ie+1]<<8)):(ti=oe[Ie]<<8,Ie+1<mi&&(ti|=oe[Ie+1])),ti}function at(oe,Ie,We,Wt){Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie!=null,"missing offset"),Qe(Ie+3<oe.length,"Trying to read beyond buffer length"));var ti,mi=oe.length;if(!(mi<=Ie))return We?(Ie+2<mi&&(ti=oe[Ie+2]<<16),Ie+1<mi&&(ti|=oe[Ie+1]<<8),ti|=oe[Ie],Ie+3<mi&&(ti+=oe[Ie+3]<<24>>>0)):(Ie+1<mi&&(ti=oe[Ie+1]<<16),Ie+2<mi&&(ti|=oe[Ie+2]<<8),Ie+3<mi&&(ti|=oe[Ie+3]),ti+=oe[Ie]<<24>>>0),ti}function Fe(oe,Ie,We,Wt){if(Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie!=null,"missing offset"),Qe(Ie+1<oe.length,"Trying to read beyond buffer length")),!(oe.length<=Ie)){var ti=vt(oe,Ie,We,!0);return 32768&ti?-1*(65535-ti+1):ti}}function Ct(oe,Ie,We,Wt){if(Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie!=null,"missing offset"),Qe(Ie+3<oe.length,"Trying to read beyond buffer length")),!(oe.length<=Ie)){var ti=at(oe,Ie,We,!0);return 2147483648&ti?-1*(4294967295-ti+1):ti}}function Ft(oe,Ie,We,Wt){return Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie+3<oe.length,"Trying to read beyond buffer length")),lt.read(oe,Ie,We,23,4)}function Ue(oe,Ie,We,Wt){return Wt||(Qe(typeof We=="boolean","missing or invalid endian"),Qe(Ie+7<oe.length,"Trying to read beyond buffer length")),lt.read(oe,Ie,We,52,8)}function $e(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+1<oe.length,"trying to write beyond buffer length"),Bt(Ie,65535));var mi=oe.length;if(!(mi<=We))for(var rr=0,Oi=Math.min(mi-We,2);rr<Oi;rr++)oe[We+rr]=(Ie&255<<8*(Wt?rr:1-rr))>>>8*(Wt?rr:1-rr)}function Z(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+3<oe.length,"trying to write beyond buffer length"),Bt(Ie,4294967295));var mi=oe.length;if(!(mi<=We))for(var rr=0,Oi=Math.min(mi-We,4);rr<Oi;rr++)oe[We+rr]=Ie>>>8*(Wt?rr:3-rr)&255}function ee(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+1<oe.length,"Trying to write beyond buffer length"),Rt(Ie,32767,-32768)),oe.length<=We||$e(oe,0<=Ie?Ie:65535+Ie+1,We,Wt,ti)}function ce(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+3<oe.length,"Trying to write beyond buffer length"),Rt(Ie,2147483647,-2147483648)),oe.length<=We||Z(oe,0<=Ie?Ie:4294967295+Ie+1,We,Wt,ti)}function Ne(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+3<oe.length,"Trying to write beyond buffer length"),Qt(Ie,34028234663852886e22,-34028234663852886e22)),oe.length<=We||lt.write(oe,Ie,We,Wt,23,4)}function K(oe,Ie,We,Wt,ti){ti||(Qe(Ie!=null,"missing value"),Qe(typeof Wt=="boolean","missing or invalid endian"),Qe(We!=null,"missing offset"),Qe(We+7<oe.length,"Trying to write beyond buffer length"),Qt(Ie,17976931348623157e292,-17976931348623157e292)),oe.length<=We||lt.write(oe,Ie,We,Wt,52,8)}Ke.Buffer=Ce,Ke.SlowBuffer=Ce,Ke.INSPECT_MAX_BYTES=50,Ce.poolSize=8192,Ce._useTypedArrays=function(){try{var oe=new ArrayBuffer(0),Ie=new Uint8Array(oe);return Ie.foo=function(){return 42},Ie.foo()===42&&typeof Ie.subarray=="function"}catch{return!1}}(),Ce.isEncoding=function(oe){switch(String(oe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ce.isBuffer=function(oe){return!(oe==null||!oe._isBuffer)},Ce.byteLength=function(oe,Ie){var We;switch(oe+="",Ie||"utf8"){case"hex":We=oe.length/2;break;case"utf8":case"utf-8":We=It(oe).length;break;case"ascii":case"binary":case"raw":We=oe.length;break;case"base64":We=xt(oe).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":We=2*oe.length;break;default:throw new Error("Unknown encoding")}return We},Ce.concat=function(oe,Ie){if(Qe(He(oe),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),oe.length===0)return new Ce(0);if(oe.length===1)return oe[0];if(typeof Ie!="number")for(ti=Ie=0;ti<oe.length;ti++)Ie+=oe[ti].length;for(var We=new Ce(Ie),Wt=0,ti=0;ti<oe.length;ti++){var mi=oe[ti];mi.copy(We,Wt),Wt+=mi.length}return We},Ce.prototype.write=function(oe,Ie,We,Wt){var ti;isFinite(Ie)?isFinite(We)||(Wt=We,We=void 0):(ti=Wt,Wt=Ie,Ie=We,We=ti),Ie=Number(Ie)||0;var mi,rr,Oi,Lr,zr,Vr,Qn,nn=this.length-Ie;switch((!We||nn<(We=Number(We)))&&(We=nn),Wt=String(Wt||"utf8").toLowerCase()){case"hex":mi=function($r,Ga,No,hn){No=Number(No)||0;var ae=$r.length-No;(!hn||ae<(hn=Number(hn)))&&(hn=ae);var Gr=Ga.length;Qe(Gr%2==0,"Invalid hex string"),Gr/2<hn&&(hn=Gr/2);for(var An=0;An<hn;An++){var ps=parseInt(Ga.substr(2*An,2),16);Qe(!isNaN(ps),"Invalid hex string"),$r[No+An]=ps}return Ce._charsWritten=2*An,An}(this,oe,Ie,We);break;case"utf8":case"utf-8":zr=oe,Vr=Ie,Qn=We,mi=Ce._charsWritten=jt(It(zr),this,Vr,Qn);break;case"ascii":case"binary":mi=function($r,Ga,No,hn){return Ce._charsWritten=jt(function(ae){for(var Gr=[],An=0;An<ae.length;An++)Gr.push(255&ae.charCodeAt(An));return Gr}(Ga),$r,No,hn)}(this,oe,Ie,We);break;case"base64":rr=oe,Oi=Ie,Lr=We,mi=Ce._charsWritten=jt(xt(rr),this,Oi,Lr);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":mi=function($r,Ga,No,hn){return Ce._charsWritten=jt(function(ae){for(var Gr,An,ps,cr=[],br=0;br<ae.length;br++)An=(Gr=ae.charCodeAt(br))>>8,ps=Gr%256,cr.push(ps),cr.push(An);return cr}(Ga),$r,No,hn)}(this,oe,Ie,We);break;default:throw new Error("Unknown encoding")}return mi},Ce.prototype.toString=function(oe,Ie,We){var Wt,ti,mi,rr,Oi=this;if(oe=String(oe||"utf8").toLowerCase(),Ie=Number(Ie)||0,(We=We!==void 0?Number(We):We=Oi.length)===Ie)return"";switch(oe){case"hex":Wt=function(Lr,zr,Vr){var Qn=Lr.length;(!zr||zr<0)&&(zr=0),(!Vr||Vr<0||Qn<Vr)&&(Vr=Qn);for(var nn="",$r=zr;$r<Vr;$r++)nn+=gt(Lr[$r]);return nn}(Oi,Ie,We);break;case"utf8":case"utf-8":Wt=function(Lr,zr,Vr){var Qn="",nn="";Vr=Math.min(Lr.length,Vr);for(var $r=zr;$r<Vr;$r++)Lr[$r]<=127?(Qn+=ot(nn)+String.fromCharCode(Lr[$r]),nn=""):nn+="%"+Lr[$r].toString(16);return Qn+ot(nn)}(Oi,Ie,We);break;case"ascii":case"binary":Wt=function(Lr,zr,Vr){var Qn="";Vr=Math.min(Lr.length,Vr);for(var nn=zr;nn<Vr;nn++)Qn+=String.fromCharCode(Lr[nn]);return Qn}(Oi,Ie,We);break;case"base64":ti=Oi,rr=We,Wt=(mi=Ie)===0&&rr===ti.length?Re.fromByteArray(ti):Re.fromByteArray(ti.slice(mi,rr));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Wt=function(Lr,zr,Vr){for(var Qn=Lr.slice(zr,Vr),nn="",$r=0;$r<Qn.length;$r+=2)nn+=String.fromCharCode(Qn[$r]+256*Qn[$r+1]);return nn}(Oi,Ie,We);break;default:throw new Error("Unknown encoding")}return Wt},Ce.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Ce.prototype.copy=function(oe,Ie,We,Wt){if(We=We||0,Wt||Wt===0||(Wt=this.length),Ie=Ie||0,Wt!==We&&oe.length!==0&&this.length!==0){Qe(We<=Wt,"sourceEnd < sourceStart"),Qe(0<=Ie&&Ie<oe.length,"targetStart out of bounds"),Qe(0<=We&&We<this.length,"sourceStart out of bounds"),Qe(0<=Wt&&Wt<=this.length,"sourceEnd out of bounds"),Wt>this.length&&(Wt=this.length),oe.length-Ie<Wt-We&&(Wt=oe.length-Ie+We);var ti=Wt-We;if(ti<100||!Ce._useTypedArrays)for(var mi=0;mi<ti;mi++)oe[mi+Ie]=this[mi+We];else oe._set(this.subarray(We,We+ti),Ie)}},Ce.prototype.slice=function(oe,Ie){var We=this.length;if(oe=he(oe,We,0),Ie=he(Ie,We,We),Ce._useTypedArrays)return Ce._augment(this.subarray(oe,Ie));for(var Wt=Ie-oe,ti=new Ce(Wt,void 0,!0),mi=0;mi<Wt;mi++)ti[mi]=this[mi+oe];return ti},Ce.prototype.get=function(oe){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(oe)},Ce.prototype.set=function(oe,Ie){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(oe,Ie)},Ce.prototype.readUInt8=function(oe,Ie){if(Ie||(Qe(oe!=null,"missing offset"),Qe(oe<this.length,"Trying to read beyond buffer length")),!(oe>=this.length))return this[oe]},Ce.prototype.readUInt16LE=function(oe,Ie){return vt(this,oe,!0,Ie)},Ce.prototype.readUInt16BE=function(oe,Ie){return vt(this,oe,!1,Ie)},Ce.prototype.readUInt32LE=function(oe,Ie){return at(this,oe,!0,Ie)},Ce.prototype.readUInt32BE=function(oe,Ie){return at(this,oe,!1,Ie)},Ce.prototype.readInt8=function(oe,Ie){if(Ie||(Qe(oe!=null,"missing offset"),Qe(oe<this.length,"Trying to read beyond buffer length")),!(oe>=this.length))return 128&this[oe]?-1*(255-this[oe]+1):this[oe]},Ce.prototype.readInt16LE=function(oe,Ie){return Fe(this,oe,!0,Ie)},Ce.prototype.readInt16BE=function(oe,Ie){return Fe(this,oe,!1,Ie)},Ce.prototype.readInt32LE=function(oe,Ie){return Ct(this,oe,!0,Ie)},Ce.prototype.readInt32BE=function(oe,Ie){return Ct(this,oe,!1,Ie)},Ce.prototype.readFloatLE=function(oe,Ie){return Ft(this,oe,!0,Ie)},Ce.prototype.readFloatBE=function(oe,Ie){return Ft(this,oe,!1,Ie)},Ce.prototype.readDoubleLE=function(oe,Ie){return Ue(this,oe,!0,Ie)},Ce.prototype.readDoubleBE=function(oe,Ie){return Ue(this,oe,!1,Ie)},Ce.prototype.writeUInt8=function(oe,Ie,We){We||(Qe(oe!=null,"missing value"),Qe(Ie!=null,"missing offset"),Qe(Ie<this.length,"trying to write beyond buffer length"),Bt(oe,255)),Ie>=this.length||(this[Ie]=oe)},Ce.prototype.writeUInt16LE=function(oe,Ie,We){$e(this,oe,Ie,!0,We)},Ce.prototype.writeUInt16BE=function(oe,Ie,We){$e(this,oe,Ie,!1,We)},Ce.prototype.writeUInt32LE=function(oe,Ie,We){Z(this,oe,Ie,!0,We)},Ce.prototype.writeUInt32BE=function(oe,Ie,We){Z(this,oe,Ie,!1,We)},Ce.prototype.writeInt8=function(oe,Ie,We){We||(Qe(oe!=null,"missing value"),Qe(Ie!=null,"missing offset"),Qe(Ie<this.length,"Trying to write beyond buffer length"),Rt(oe,127,-128)),Ie>=this.length||(0<=oe?this.writeUInt8(oe,Ie,We):this.writeUInt8(255+oe+1,Ie,We))},Ce.prototype.writeInt16LE=function(oe,Ie,We){ee(this,oe,Ie,!0,We)},Ce.prototype.writeInt16BE=function(oe,Ie,We){ee(this,oe,Ie,!1,We)},Ce.prototype.writeInt32LE=function(oe,Ie,We){ce(this,oe,Ie,!0,We)},Ce.prototype.writeInt32BE=function(oe,Ie,We){ce(this,oe,Ie,!1,We)},Ce.prototype.writeFloatLE=function(oe,Ie,We){Ne(this,oe,Ie,!0,We)},Ce.prototype.writeFloatBE=function(oe,Ie,We){Ne(this,oe,Ie,!1,We)},Ce.prototype.writeDoubleLE=function(oe,Ie,We){K(this,oe,Ie,!0,We)},Ce.prototype.writeDoubleBE=function(oe,Ie,We){K(this,oe,Ie,!1,We)},Ce.prototype.fill=function(oe,Ie,We){if(oe=oe||0,Ie=Ie||0,We=We||this.length,typeof oe=="string"&&(oe=oe.charCodeAt(0)),Qe(typeof oe=="number"&&!isNaN(oe),"value is not a number"),Qe(Ie<=We,"end < start"),We!==Ie&&this.length!==0){Qe(0<=Ie&&Ie<this.length,"start out of bounds"),Qe(0<=We&&We<=this.length,"end out of bounds");for(var Wt=Ie;Wt<We;Wt++)this[Wt]=oe}},Ce.prototype.inspect=function(){for(var oe=[],Ie=this.length,We=0;We<Ie;We++)if(oe[We]=gt(this[We]),We===Ke.INSPECT_MAX_BYTES){oe[We+1]="...";break}return"<Buffer "+oe.join(" ")+">"},Ce.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(Ce._useTypedArrays)return new Ce(this).buffer;for(var oe=new Uint8Array(this.length),Ie=0,We=oe.length;Ie<We;Ie+=1)oe[Ie]=this[Ie];return oe.buffer};var ie=Ce.prototype;function he(oe,Ie,We){return typeof oe!="number"?We:Ie<=(oe=~~oe)?Ie:0<=oe||0<=(oe+=Ie)?oe:0}function _e(oe){return(oe=~~Math.ceil(+oe))<0?0:oe}function He(oe){return(Array.isArray||function(Ie){return Object.prototype.toString.call(Ie)==="[object Array]"})(oe)}function gt(oe){return oe<16?"0"+oe.toString(16):oe.toString(16)}function It(oe){for(var Ie=[],We=0;We<oe.length;We++){var Wt=oe.charCodeAt(We);if(Wt<=127)Ie.push(oe.charCodeAt(We));else{var ti=We;55296<=Wt&&Wt<=57343&&We++;for(var mi=encodeURIComponent(oe.slice(ti,We+1)).substr(1).split("%"),rr=0;rr<mi.length;rr++)Ie.push(parseInt(mi[rr],16))}}return Ie}function xt(oe){return Re.toByteArray(oe)}function jt(oe,Ie,We,Wt){for(var ti=0;ti<Wt&&!(ti+We>=Ie.length||ti>=oe.length);ti++)Ie[ti+We]=oe[ti];return ti}function ot(oe){try{return decodeURIComponent(oe)}catch{return String.fromCharCode(65533)}}function Bt(oe,Ie){Qe(typeof oe=="number","cannot write a non-number as a number"),Qe(0<=oe,"specified a negative value for writing an unsigned value"),Qe(oe<=Ie,"value is larger than maximum value for type"),Qe(Math.floor(oe)===oe,"value has a fractional component")}function Rt(oe,Ie,We){Qe(typeof oe=="number","cannot write a non-number as a number"),Qe(oe<=Ie,"value larger than maximum allowed value"),Qe(We<=oe,"value smaller than minimum allowed value"),Qe(Math.floor(oe)===oe,"value has a fractional component")}function Qt(oe,Ie,We){Qe(typeof oe=="number","cannot write a non-number as a number"),Qe(oe<=Ie,"value larger than maximum allowed value"),Qe(We<=oe,"value smaller than minimum allowed value")}function Qe(oe,Ie){if(!oe)throw new Error(Ie||"Failed assertion")}Ce._augment=function(oe){return oe._isBuffer=!0,oe._get=oe.get,oe._set=oe.set,oe.get=ie.get,oe.set=ie.set,oe.write=ie.write,oe.toString=ie.toString,oe.toLocaleString=ie.toString,oe.toJSON=ie.toJSON,oe.copy=ie.copy,oe.slice=ie.slice,oe.readUInt8=ie.readUInt8,oe.readUInt16LE=ie.readUInt16LE,oe.readUInt16BE=ie.readUInt16BE,oe.readUInt32LE=ie.readUInt32LE,oe.readUInt32BE=ie.readUInt32BE,oe.readInt8=ie.readInt8,oe.readInt16LE=ie.readInt16LE,oe.readInt16BE=ie.readInt16BE,oe.readInt32LE=ie.readInt32LE,oe.readInt32BE=ie.readInt32BE,oe.readFloatLE=ie.readFloatLE,oe.readFloatBE=ie.readFloatBE,oe.readDoubleLE=ie.readDoubleLE,oe.readDoubleBE=ie.readDoubleBE,oe.writeUInt8=ie.writeUInt8,oe.writeUInt16LE=ie.writeUInt16LE,oe.writeUInt16BE=ie.writeUInt16BE,oe.writeUInt32LE=ie.writeUInt32LE,oe.writeUInt32BE=ie.writeUInt32BE,oe.writeInt8=ie.writeInt8,oe.writeInt16LE=ie.writeInt16LE,oe.writeInt16BE=ie.writeInt16BE,oe.writeInt32LE=ie.writeInt32LE,oe.writeInt32BE=ie.writeInt32BE,oe.writeFloatLE=ie.writeFloatLE,oe.writeFloatBE=ie.writeFloatBE,oe.writeDoubleLE=ie.writeDoubleLE,oe.writeDoubleBE=ie.writeDoubleBE,oe.fill=ie.fill,oe.inspect=ie.inspect,oe.toArrayBuffer=ie.toArrayBuffer,oe}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){tt=V("buffer").Buffer;var Re=new tt(4);Re.fill(0),p.exports={hash:function(lt,Ce,vt,at){return tt.isBuffer(lt)||(lt=new tt(lt)),function(Fe,Ct,Ft){for(var Ue=new tt(Ct),$e=Ft?Ue.writeInt32BE:Ue.writeInt32LE,Z=0;Z<Fe.length;Z++)$e.call(Ue,Fe[Z],4*Z,!0);return Ue}(Ce(function(Fe,Ct){var Ft;Fe.length%4!=0&&(Ft=Fe.length+(4-Fe.length%4),Fe=tt.concat([Fe,Re],Ft));for(var Ue=[],$e=Ct?Fe.readInt32BE:Fe.readInt32LE,Z=0;Z<Fe.length;Z+=4)Ue.push($e.call(Fe,Z));return Ue}(lt,at),8*lt.length),vt,at)}}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){tt=V("buffer").Buffer;var Re=V("./sha"),lt=V("./sha256"),Ce=V("./rng"),vt={sha1:Re,sha256:lt,md5:V("./md5")},at=64,Fe=new tt(at);function Ct(Ue,$e){var Z=vt[Ue=Ue||"sha1"],ee=[];return Z||Ft("algorithm:",Ue,"is not yet supported"),{update:function(ce){return tt.isBuffer(ce)||(ce=new tt(ce)),ee.push(ce),ce.length,this},digest:function(ce){var Ne=tt.concat(ee),K=$e?function(ie,he,_e){tt.isBuffer(he)||(he=new tt(he)),tt.isBuffer(_e)||(_e=new tt(_e)),he.length>at?he=ie(he):he.length<at&&(he=tt.concat([he,Fe],at));for(var He=new tt(at),gt=new tt(at),It=0;It<at;It++)He[It]=54^he[It],gt[It]=92^he[It];var xt=ie(tt.concat([He,_e]));return ie(tt.concat([gt,xt]))}(Z,$e,Ne):Z(Ne);return ee=null,ce?K.toString(ce):K}}}function Ft(){var Ue=[].slice.call(arguments).join(" ");throw new Error([Ue,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Fe.fill(0),Ke.createHash=function(Ue){return Ct(Ue)},Ke.createHmac=Ct,Ke.randomBytes=function(Ue,$e){if(!$e||!$e.call)return new tt(Ce(Ue));try{$e.call(this,void 0,new tt(Ce(Ue)))}catch(Z){$e(Z)}},function(Ue,$e){for(var Z in Ue)$e(Ue[Z])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(Ue){Ke[Ue]=function(){Ft("sorry,",Ue,"is not implemented yet")}})}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){var Re=V("./helpers");function lt(Ue,$e){Ue[$e>>5]|=128<<$e%32,Ue[14+($e+64>>>9<<4)]=$e;for(var Z=1732584193,ee=-271733879,ce=-1732584194,Ne=271733878,K=0;K<Ue.length;K+=16){var ie=Z,he=ee,_e=ce,He=Ne;Z=vt(Z,ee,ce,Ne,Ue[K+0],7,-680876936),Ne=vt(Ne,Z,ee,ce,Ue[K+1],12,-389564586),ce=vt(ce,Ne,Z,ee,Ue[K+2],17,606105819),ee=vt(ee,ce,Ne,Z,Ue[K+3],22,-1044525330),Z=vt(Z,ee,ce,Ne,Ue[K+4],7,-176418897),Ne=vt(Ne,Z,ee,ce,Ue[K+5],12,1200080426),ce=vt(ce,Ne,Z,ee,Ue[K+6],17,-1473231341),ee=vt(ee,ce,Ne,Z,Ue[K+7],22,-45705983),Z=vt(Z,ee,ce,Ne,Ue[K+8],7,1770035416),Ne=vt(Ne,Z,ee,ce,Ue[K+9],12,-1958414417),ce=vt(ce,Ne,Z,ee,Ue[K+10],17,-42063),ee=vt(ee,ce,Ne,Z,Ue[K+11],22,-1990404162),Z=vt(Z,ee,ce,Ne,Ue[K+12],7,1804603682),Ne=vt(Ne,Z,ee,ce,Ue[K+13],12,-40341101),ce=vt(ce,Ne,Z,ee,Ue[K+14],17,-1502002290),Z=at(Z,ee=vt(ee,ce,Ne,Z,Ue[K+15],22,1236535329),ce,Ne,Ue[K+1],5,-165796510),Ne=at(Ne,Z,ee,ce,Ue[K+6],9,-1069501632),ce=at(ce,Ne,Z,ee,Ue[K+11],14,643717713),ee=at(ee,ce,Ne,Z,Ue[K+0],20,-373897302),Z=at(Z,ee,ce,Ne,Ue[K+5],5,-701558691),Ne=at(Ne,Z,ee,ce,Ue[K+10],9,38016083),ce=at(ce,Ne,Z,ee,Ue[K+15],14,-660478335),ee=at(ee,ce,Ne,Z,Ue[K+4],20,-405537848),Z=at(Z,ee,ce,Ne,Ue[K+9],5,568446438),Ne=at(Ne,Z,ee,ce,Ue[K+14],9,-1019803690),ce=at(ce,Ne,Z,ee,Ue[K+3],14,-187363961),ee=at(ee,ce,Ne,Z,Ue[K+8],20,1163531501),Z=at(Z,ee,ce,Ne,Ue[K+13],5,-1444681467),Ne=at(Ne,Z,ee,ce,Ue[K+2],9,-51403784),ce=at(ce,Ne,Z,ee,Ue[K+7],14,1735328473),Z=Fe(Z,ee=at(ee,ce,Ne,Z,Ue[K+12],20,-1926607734),ce,Ne,Ue[K+5],4,-378558),Ne=Fe(Ne,Z,ee,ce,Ue[K+8],11,-2022574463),ce=Fe(ce,Ne,Z,ee,Ue[K+11],16,1839030562),ee=Fe(ee,ce,Ne,Z,Ue[K+14],23,-35309556),Z=Fe(Z,ee,ce,Ne,Ue[K+1],4,-1530992060),Ne=Fe(Ne,Z,ee,ce,Ue[K+4],11,1272893353),ce=Fe(ce,Ne,Z,ee,Ue[K+7],16,-155497632),ee=Fe(ee,ce,Ne,Z,Ue[K+10],23,-1094730640),Z=Fe(Z,ee,ce,Ne,Ue[K+13],4,681279174),Ne=Fe(Ne,Z,ee,ce,Ue[K+0],11,-358537222),ce=Fe(ce,Ne,Z,ee,Ue[K+3],16,-722521979),ee=Fe(ee,ce,Ne,Z,Ue[K+6],23,76029189),Z=Fe(Z,ee,ce,Ne,Ue[K+9],4,-640364487),Ne=Fe(Ne,Z,ee,ce,Ue[K+12],11,-421815835),ce=Fe(ce,Ne,Z,ee,Ue[K+15],16,530742520),Z=Ct(Z,ee=Fe(ee,ce,Ne,Z,Ue[K+2],23,-995338651),ce,Ne,Ue[K+0],6,-198630844),Ne=Ct(Ne,Z,ee,ce,Ue[K+7],10,1126891415),ce=Ct(ce,Ne,Z,ee,Ue[K+14],15,-1416354905),ee=Ct(ee,ce,Ne,Z,Ue[K+5],21,-57434055),Z=Ct(Z,ee,ce,Ne,Ue[K+12],6,1700485571),Ne=Ct(Ne,Z,ee,ce,Ue[K+3],10,-1894986606),ce=Ct(ce,Ne,Z,ee,Ue[K+10],15,-1051523),ee=Ct(ee,ce,Ne,Z,Ue[K+1],21,-2054922799),Z=Ct(Z,ee,ce,Ne,Ue[K+8],6,1873313359),Ne=Ct(Ne,Z,ee,ce,Ue[K+15],10,-30611744),ce=Ct(ce,Ne,Z,ee,Ue[K+6],15,-1560198380),ee=Ct(ee,ce,Ne,Z,Ue[K+13],21,1309151649),Z=Ct(Z,ee,ce,Ne,Ue[K+4],6,-145523070),Ne=Ct(Ne,Z,ee,ce,Ue[K+11],10,-1120210379),ce=Ct(ce,Ne,Z,ee,Ue[K+2],15,718787259),ee=Ct(ee,ce,Ne,Z,Ue[K+9],21,-343485551),Z=Ft(Z,ie),ee=Ft(ee,he),ce=Ft(ce,_e),Ne=Ft(Ne,He)}return Array(Z,ee,ce,Ne)}function Ce(Ue,$e,Z,ee,ce,Ne){return Ft((K=Ft(Ft($e,Ue),Ft(ee,Ne)))<<(ie=ce)|K>>>32-ie,Z);var K,ie}function vt(Ue,$e,Z,ee,ce,Ne,K){return Ce($e&Z|~$e&ee,Ue,$e,ce,Ne,K)}function at(Ue,$e,Z,ee,ce,Ne,K){return Ce($e&ee|Z&~ee,Ue,$e,ce,Ne,K)}function Fe(Ue,$e,Z,ee,ce,Ne,K){return Ce($e^Z^ee,Ue,$e,ce,Ne,K)}function Ct(Ue,$e,Z,ee,ce,Ne,K){return Ce(Z^($e|~ee),Ue,$e,ce,Ne,K)}function Ft(Ue,$e){var Z=(65535&Ue)+(65535&$e);return(Ue>>16)+($e>>16)+(Z>>16)<<16|65535&Z}p.exports=function(Ue){return Re.hash(Ue,lt,16)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){var Re;Re=function(lt){for(var Ce,vt=new Array(lt),at=0;at<lt;at++)!(3&at)&&(Ce=4294967296*Math.random()),vt[at]=Ce>>>((3&at)<<3)&255;return vt},p.exports=Re}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){var Re=V("./helpers");function lt(at,Fe){at[Fe>>5]|=128<<24-Fe%32,at[15+(Fe+64>>9<<4)]=Fe;for(var Ct,Ft,Ue,$e,Z,ee=Array(80),ce=1732584193,Ne=-271733879,K=-1732584194,ie=271733878,he=-1009589776,_e=0;_e<at.length;_e+=16){for(var He=ce,gt=Ne,It=K,xt=ie,jt=he,ot=0;ot<80;ot++){ee[ot]=ot<16?at[_e+ot]:vt(ee[ot-3]^ee[ot-8]^ee[ot-14]^ee[ot-16],1);var Bt=Ce(Ce(vt(ce,5),(Ue=Ne,$e=K,Z=ie,(Ft=ot)<20?Ue&$e|~Ue&Z:!(Ft<40)&&Ft<60?Ue&$e|Ue&Z|$e&Z:Ue^$e^Z)),Ce(Ce(he,ee[ot]),(Ct=ot)<20?1518500249:Ct<40?1859775393:Ct<60?-1894007588:-899497514));he=ie,ie=K,K=vt(Ne,30),Ne=ce,ce=Bt}ce=Ce(ce,He),Ne=Ce(Ne,gt),K=Ce(K,It),ie=Ce(ie,xt),he=Ce(he,jt)}return Array(ce,Ne,K,ie,he)}function Ce(at,Fe){var Ct=(65535&at)+(65535&Fe);return(at>>16)+(Fe>>16)+(Ct>>16)<<16|65535&Ct}function vt(at,Fe){return at<<Fe|at>>>32-Fe}p.exports=function(at){return Re.hash(at,lt,20,!0)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){function Re(at,Fe){var Ct=(65535&at)+(65535&Fe);return(at>>16)+(Fe>>16)+(Ct>>16)<<16|65535&Ct}function lt(at,Fe){return at>>>Fe|at<<32-Fe}function Ce(at,Fe){var Ct,Ft,Ue,$e,Z,ee,ce,Ne,K,ie,he=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),_e=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),He=new Array(64);at[Fe>>5]|=128<<24-Fe%32,at[15+(Fe+64>>9<<4)]=Fe;for(var gt,It,xt,jt,ot,Bt,Rt,Qt,Qe=0;Qe<at.length;Qe+=16){Ct=_e[0],Ft=_e[1],Ue=_e[2],$e=_e[3],Z=_e[4],ee=_e[5],ce=_e[6],Ne=_e[7];for(var oe=0;oe<64;oe++)He[oe]=oe<16?at[oe+Qe]:Re(Re(Re(lt(Qt=He[oe-2],17)^lt(Qt,19)^Qt>>>10,He[oe-7]),lt(Rt=He[oe-15],7)^lt(Rt,18)^Rt>>>3),He[oe-16]),K=Re(Re(Re(Re(Ne,lt(Bt=Z,6)^lt(Bt,11)^lt(Bt,25)),(ot=Z)&ee^~ot&ce),he[oe]),He[oe]),ie=Re(lt(jt=Ct,2)^lt(jt,13)^lt(jt,22),(gt=Ct)&(It=Ft)^gt&(xt=Ue)^It&xt),Ne=ce,ce=ee,ee=Z,Z=Re($e,K),$e=Ue,Ue=Ft,Ft=Ct,Ct=Re(K,ie);_e[0]=Re(Ct,_e[0]),_e[1]=Re(Ft,_e[1]),_e[2]=Re(Ue,_e[2]),_e[3]=Re($e,_e[3]),_e[4]=Re(Z,_e[4]),_e[5]=Re(ee,_e[5]),_e[6]=Re(ce,_e[6]),_e[7]=Re(Ne,_e[7])}return _e}var vt=V("./helpers");p.exports=function(at){return vt.hash(at,Ce,32,!0)}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){function Re(){}(ct=p.exports={}).nextTick=function(){var lt=typeof window<"u"&&window.setImmediate,Ce=typeof window<"u"&&window.postMessage&&window.addEventListener;if(lt)return function(at){return window.setImmediate(at)};if(Ce){var vt=[];return window.addEventListener("message",function(at){var Fe=at.source;Fe!==window&&Fe!==null||at.data!=="process-tick"||(at.stopPropagation(),0<vt.length&&vt.shift()())},!0),function(at){vt.push(at),window.postMessage("process-tick","*")}}return function(at){setTimeout(at,0)}}(),ct.title="browser",ct.browser=!0,ct.env={},ct.argv=[],ct.on=Re,ct.addListener=Re,ct.once=Re,ct.off=Re,ct.removeListener=Re,ct.removeAllListeners=Re,ct.emit=Re,ct.binding=function(lt){throw new Error("process.binding is not supported")},ct.cwd=function(){return"/"},ct.chdir=function(lt){throw new Error("process.chdir is not supported")}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(V,p,Ke){(function(ct,ut,tt,_t,it,dt,At,Mt,pt){Ke.read=function(Re,lt,Ce,vt,at){var Fe,Ct,Ft=8*at-vt-1,Ue=(1<<Ft)-1,$e=Ue>>1,Z=-7,ee=Ce?at-1:0,ce=Ce?-1:1,Ne=Re[lt+ee];for(ee+=ce,Fe=Ne&(1<<-Z)-1,Ne>>=-Z,Z+=Ft;0<Z;Fe=256*Fe+Re[lt+ee],ee+=ce,Z-=8);for(Ct=Fe&(1<<-Z)-1,Fe>>=-Z,Z+=vt;0<Z;Ct=256*Ct+Re[lt+ee],ee+=ce,Z-=8);if(Fe===0)Fe=1-$e;else{if(Fe===Ue)return Ct?NaN:1/0*(Ne?-1:1);Ct+=Math.pow(2,vt),Fe-=$e}return(Ne?-1:1)*Ct*Math.pow(2,Fe-vt)},Ke.write=function(Re,lt,Ce,vt,at,Fe){var Ct,Ft,Ue,$e=8*Fe-at-1,Z=(1<<$e)-1,ee=Z>>1,ce=at===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ne=vt?0:Fe-1,K=vt?1:-1,ie=lt<0||lt===0&&1/lt<0?1:0;for(lt=Math.abs(lt),isNaN(lt)||lt===1/0?(Ft=isNaN(lt)?1:0,Ct=Z):(Ct=Math.floor(Math.log(lt)/Math.LN2),lt*(Ue=Math.pow(2,-Ct))<1&&(Ct--,Ue*=2),2<=(lt+=1<=Ct+ee?ce/Ue:ce*Math.pow(2,1-ee))*Ue&&(Ct++,Ue/=2),Z<=Ct+ee?(Ft=0,Ct=Z):1<=Ct+ee?(Ft=(lt*Ue-1)*Math.pow(2,at),Ct+=ee):(Ft=lt*Math.pow(2,ee-1)*Math.pow(2,at),Ct=0));8<=at;Re[Ce+Ne]=255&Ft,Ne+=K,Ft/=256,at-=8);for(Ct=Ct<<at|Ft,$e+=at;0<$e;Re[Ce+Ne]=255&Ct,Ne+=K,Ct/=256,$e-=8);Re[Ce+Ne-K]|=128*ie}}).call(this,V("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},V("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(kt){var V=function(){function p(Ce){return At(Ce,Mt(dt(pt(Ce.length),Ce),1/Ce.length))}function Ke(Ce){return dt(Re(Ce),Ce)}function ct(Ce,vt){return Mt(Ce,vt?1/(Ce.length-1):1/Ce.length)}function ut(Ce){var vt=function(Fe){var Ct,Ft=Math.pow(2,-52),Ue=1e-64/Ft,$e=0,Z=0,ee=0,ce=0,Ne=0,K=lt(Fe),ie=K.length,he=K[0].length;if(ie<he)throw"Need more rows than columns";var _e=new Array(he),He=new Array(he);for(Z=0;Z<he;Z++)_e[Z]=He[Z]=0;var gt=function Wt(ti,mi,rr){rr===void 0&&(rr=0);var Oi,Lr=ti[rr],zr=Array(Lr);if(rr===ti.length-1){for(Oi=Lr-2;Oi>=0;Oi-=2)zr[Oi+1]=mi,zr[Oi]=mi;return Oi===-1&&(zr[0]=mi),zr}for(Oi=Lr-1;Oi>=0;Oi--)zr[Oi]=Wt(ti,mi,rr+1);return zr}([he,he],0);function It(Wt,ti){return(Wt=Math.abs(Wt))>(ti=Math.abs(ti))?Wt*Math.sqrt(1+ti*ti/Wt/Wt):ti==0?Wt:ti*Math.sqrt(1+Wt*Wt/ti/ti)}var xt=0,jt=0,ot=0,Bt=0,Rt=0,Qt=0,Qe=0;for(Z=0;Z<he;Z++){for(_e[Z]=jt,Qe=0,Ne=Z+1,ee=Z;ee<ie;ee++)Qe+=K[ee][Z]*K[ee][Z];if(Qe<=Ue)jt=0;else for(xt=K[Z][Z],jt=Math.sqrt(Qe),xt>=0&&(jt=-jt),ot=xt*jt-Qe,K[Z][Z]=xt-jt,ee=Ne;ee<he;ee++){for(Qe=0,ce=Z;ce<ie;ce++)Qe+=K[ce][Z]*K[ce][ee];for(xt=Qe/ot,ce=Z;ce<ie;ce++)K[ce][ee]+=xt*K[ce][Z]}for(He[Z]=jt,Qe=0,ee=Ne;ee<he;ee++)Qe+=K[Z][ee]*K[Z][ee];if(Qe<=Ue)jt=0;else{for(xt=K[Z][Z+1],jt=Math.sqrt(Qe),xt>=0&&(jt=-jt),ot=xt*jt-Qe,K[Z][Z+1]=xt-jt,ee=Ne;ee<he;ee++)_e[ee]=K[Z][ee]/ot;for(ee=Ne;ee<ie;ee++){for(Qe=0,ce=Ne;ce<he;ce++)Qe+=K[ee][ce]*K[Z][ce];for(ce=Ne;ce<he;ce++)K[ee][ce]+=Qe*_e[ce]}}(Rt=Math.abs(He[Z])+Math.abs(_e[Z]))>Bt&&(Bt=Rt)}for(Z=he-1;Z!=-1;Z+=-1){if(jt!=0){for(ot=jt*K[Z][Z+1],ee=Ne;ee<he;ee++)gt[ee][Z]=K[Z][ee]/ot;for(ee=Ne;ee<he;ee++){for(Qe=0,ce=Ne;ce<he;ce++)Qe+=K[Z][ce]*gt[ce][ee];for(ce=Ne;ce<he;ce++)gt[ce][ee]+=Qe*gt[ce][Z]}}for(ee=Ne;ee<he;ee++)gt[Z][ee]=0,gt[ee][Z]=0;gt[Z][Z]=1,jt=_e[Z],Ne=Z}for(Z=he-1;Z!=-1;Z+=-1){for(Ne=Z+1,jt=He[Z],ee=Ne;ee<he;ee++)K[Z][ee]=0;if(jt!=0){for(ot=K[Z][Z]*jt,ee=Ne;ee<he;ee++){for(Qe=0,ce=Ne;ce<ie;ce++)Qe+=K[ce][Z]*K[ce][ee];for(xt=Qe/ot,ce=Z;ce<ie;ce++)K[ce][ee]+=xt*K[ce][Z]}for(ee=Z;ee<ie;ee++)K[ee][Z]=K[ee][Z]/jt}else for(ee=Z;ee<ie;ee++)K[ee][Z]=0;K[Z][Z]+=1}for(Ft*=Bt,ce=he-1;ce!=-1;ce+=-1)for(var oe=0;oe<50;oe++){var Ie=!1;for(Ne=ce;Ne!=-1;Ne+=-1){if(Math.abs(_e[Ne])<=Ft){Ie=!0;break}if(Math.abs(He[Ne-1])<=Ft)break}if(!Ie){$e=0,Qe=1;var We=Ne-1;for(Z=Ne;Z<ce+1&&(xt=Qe*_e[Z],_e[Z]=$e*_e[Z],!(Math.abs(xt)<=Ft));Z++)for(ot=It(xt,jt=He[Z]),He[Z]=ot,$e=jt/ot,Qe=-xt/ot,ee=0;ee<ie;ee++)Rt=K[ee][We],Qt=K[ee][Z],K[ee][We]=Rt*$e+Qt*Qe,K[ee][Z]=-Rt*Qe+Qt*$e}if(Qt=He[ce],Ne==ce){if(Qt<0)for(He[ce]=-Qt,ee=0;ee<he;ee++)gt[ee][ce]=-gt[ee][ce];break}if(oe>=49)throw"Error: no convergence.";for(Bt=He[Ne],jt=It(xt=(((Rt=He[ce-1])-Qt)*(Rt+Qt)+((jt=_e[ce-1])-(ot=_e[ce]))*(jt+ot))/(2*ot*Rt),1),xt=xt<0?((Bt-Qt)*(Bt+Qt)+ot*(Rt/(xt-jt)-ot))/Bt:((Bt-Qt)*(Bt+Qt)+ot*(Rt/(xt+jt)-ot))/Bt,$e=1,Qe=1,Z=Ne+1;Z<ce+1;Z++){for(jt=_e[Z],Rt=He[Z],ot=Qe*jt,jt*=$e,Qt=It(xt,ot),_e[Z-1]=Qt,xt=Bt*($e=xt/Qt)+jt*(Qe=ot/Qt),jt=-Bt*Qe+jt*$e,ot=Rt*Qe,Rt*=$e,ee=0;ee<he;ee++)Bt=gt[ee][Z-1],Qt=gt[ee][Z],gt[ee][Z-1]=Bt*$e+Qt*Qe,gt[ee][Z]=-Bt*Qe+Qt*$e;for(Qt=It(xt,ot),He[Z-1]=Qt,xt=($e=xt/Qt)*jt+(Qe=ot/Qt)*Rt,Bt=-Qe*jt+$e*Rt,ee=0;ee<ie;ee++)Rt=K[ee][Z-1],Qt=K[ee][Z],K[ee][Z-1]=Rt*$e+Qt*Qe,K[ee][Z]=-Rt*Qe+Qt*$e}_e[Ne]=0,_e[ce]=xt,He[ce]=Bt}for(Z=0;Z<He.length;Z++)He[Z]<Ft&&(He[Z]=0);for(Z=0;Z<he;Z++)for(ee=Z-1;ee>=0;ee--)if(He[ee]<He[Z]){for($e=He[ee],He[ee]=He[Z],He[Z]=$e,ce=0;ce<K.length;ce++)Ct=K[ce][Z],K[ce][Z]=K[ce][ee],K[ce][ee]=Ct;for(ce=0;ce<gt.length;ce++)Ct=gt[ce][Z],gt[ce][Z]=gt[ce][ee],gt[ce][ee]=Ct;Z=ee}return{U:K,S:He,V:gt}}(Ce);console.log(vt);var at=vt.U;return vt.S.map(function(Fe,Ct){var Ft={};return Ft.eigenvalue=Fe,Ft.vector=at.map(function(Ue,$e){return-1*Ue[Ct]}),Ft})}function tt(Ce,...vt){var at=vt.map(function(Ft){return Ft.vector}),Fe=dt(at,Re(p(Ce))),Ct=Mt(dt(pt(Ce.length),Ce),-1/Ce.length);return{adjustedData:Fe,formattedAdjustedData:it(Fe,2),avgData:Ct,selectedVectors:at}}function _t(Ce){return ut(ct(Ke(p(Ce)),!1))}function it(Ce,vt){var at=Math.pow(10,vt||2);return Ce.map(function(Fe,Ct){return Fe.map(function(Ft){return Math.round(Ft*at)/at})})}function dt(Ce,vt){if(!(Ce[0]&&vt[0]&&Ce.length&&vt.length))throw new Error("Both A and B should be matrices");if(vt.length!==Ce[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var at=[],Fe=0;Fe<Ce.length;Fe++){at[Fe]=[];for(var Ct=0;Ct<vt[0].length;Ct++)for(var Ft=0;Ft<Ce[0].length;Ft++)at[Fe][Ct]=at[Fe][Ct]?at[Fe][Ct]+Ce[Fe][Ft]*vt[Ft][Ct]:Ce[Fe][Ft]*vt[Ft][Ct]}return at}function At(Ce,vt){if(Ce.length!==vt.length||Ce[0].length!==vt[0].length)throw new Error("Both A and B should have the same dimensions");for(var at=[],Fe=0;Fe<Ce.length;Fe++){at[Fe]=[];for(var Ct=0;Ct<vt[0].length;Ct++)at[Fe][Ct]=Ce[Fe][Ct]-vt[Fe][Ct]}return at}function Mt(Ce,vt){for(var at=[],Fe=0;Fe<Ce.length;Fe++){at[Fe]=[];for(var Ct=0;Ct<Ce[0].length;Ct++)at[Fe][Ct]=Ce[Fe][Ct]*vt}return at}function pt(Ce){for(var vt=[],at=0;at<Ce;at++){vt[at]=[];for(var Fe=0;Fe<Ce;Fe++)vt[at][Fe]=1}return vt}function Re(Ce){return lt(Ce)[0].map(function(vt,at){return Ce.map(function(Fe){return Fe[at]})})}function lt(Ce){var vt=JSON.stringify(Ce);return JSON.parse(vt)}return{computeDeviationScores:Ke,computeDeviationMatrix:p,computeSVD:ut,computePercentageExplained:function(Ce,...vt){var at=Ce.map(function(Fe){return Fe.eigenvalue}).reduce(function(Fe,Ct){return Fe+Ct});return vt.map(function(Fe){return Fe.eigenvalue}).reduce(function(Fe,Ct){return Fe+Ct})/at},computeOriginalData:function(Ce,vt,at){var Fe=At(Re(dt(Re(vt),Ce)),at);return{originalData:Fe,formattedOriginalData:it(Fe,2)}},computeVarianceCovariance:ct,computeAdjustedData:tt,getEigenVectors:_t,analyseTopResult:function(Ce){var vt=_t(Ce).sort(function(at,Fe){return Fe.eigenvalue-at.eigenvalue});return console.log("Sorted Vectors",vt),tt(Ce,vt[0].vector)},transpose:Re,multiply:dt,clone:lt,scale:Mt}}();kt.exports=V},701:function(kt){var V=[];function p(ut){for(var tt=-1,_t=0;_t<V.length;_t++)if(V[_t].identifier===ut){tt=_t;break}return tt}function Ke(ut,tt){for(var _t={},it=[],dt=0;dt<ut.length;dt++){var At=ut[dt],Mt=tt.base?At[0]+tt.base:At[0],pt=_t[Mt]||0,Re="".concat(Mt," ").concat(pt);_t[Mt]=pt+1;var lt=p(Re),Ce={css:At[1],media:At[2],sourceMap:At[3],supports:At[4],layer:At[5]};if(lt!==-1)V[lt].references++,V[lt].updater(Ce);else{var vt=ct(Ce,tt);tt.byIndex=dt,V.splice(dt,0,{identifier:Re,updater:vt,references:1})}it.push(Re)}return it}function ct(ut,tt){var _t=tt.domAPI(tt);return _t.update(ut),function(it){if(it){if(it.css===ut.css&&it.media===ut.media&&it.sourceMap===ut.sourceMap&&it.supports===ut.supports&&it.layer===ut.layer)return;_t.update(ut=it)}else _t.remove()}}kt.exports=function(ut,tt){var _t=Ke(ut=ut||[],tt=tt||{});return function(it){it=it||[];for(var dt=0;dt<_t.length;dt++){var At=p(_t[dt]);V[At].references--}for(var Mt=Ke(it,tt),pt=0;pt<_t.length;pt++){var Re=p(_t[pt]);V[Re].references===0&&(V[Re].updater(),V.splice(Re,1))}_t=Mt}}},182:function(kt){kt.exports=function(V){var p=document.createElement("style");return V.setAttributes(p,V.attributes),V.insert(p,V.options),p}},850:function(kt,V,p){kt.exports=function(Ke){var ct=p.nc;ct&&Ke.setAttribute("nonce",ct)}},236:function(kt){kt.exports=function(V){var p=V.insertStyleElement(V);return{update:function(Ke){(function(ct,ut,tt){var _t="";tt.supports&&(_t+="@supports (".concat(tt.supports,") {")),tt.media&&(_t+="@media ".concat(tt.media," {"));var it=tt.layer!==void 0;it&&(_t+="@layer".concat(tt.layer.length>0?" ".concat(tt.layer):""," {")),_t+=tt.css,it&&(_t+="}"),tt.media&&(_t+="}"),tt.supports&&(_t+="}");var dt=tt.sourceMap;dt&&typeof btoa<"u"&&(_t+=`
/`,_t+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(dt))))," *"),_t+="/"),ut.styleTagTransform(_t,ct,ut.options)})(p,V,Ke)},remove:function(){(function(Ke){if(Ke.parentNode===null)return!1;Ke.parentNode.removeChild(Ke)})(p)}}}},213:function(kt){kt.exports=function(V,p){if(p.styleSheet)p.styleSheet.cssText=V;else{for(;p.firstChild;)p.removeChild(p.firstChild);p.appendChild(document.createTextNode(V))}}},1:function(kt){kt.exports=function(){var V={820:function(ut,tt,_t){var it=_t(537),dt=_t.n(it),At=_t(645),Mt=_t.n(At)()(dt());Mt.push([ut.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),tt.Z=Mt},645:function(ut){ut.exports=function(tt){var _t=[];return _t.toString=function(){return this.map(function(it){var dt="",At=it[5]!==void 0;return it[4]&&(dt+="@supports (".concat(it[4],") {")),it[2]&&(dt+="@media ".concat(it[2]," {")),At&&(dt+="@layer".concat(it[5].length>0?" ".concat(it[5]):""," {")),dt+=tt(it),At&&(dt+="}"),it[2]&&(dt+="}"),it[4]&&(dt+="}"),dt}).join("")},_t.i=function(it,dt,At,Mt,pt){typeof it=="string"&&(it=[[null,it,void 0]]);var Re={};if(At)for(var lt=0;lt<this.length;lt++){var Ce=this[lt][0];Ce!=null&&(Re[Ce]=!0)}for(var vt=0;vt<it.length;vt++){var at=[].concat(it[vt]);At&&Re[at[0]]||(pt!==void 0&&(at[5]===void 0||(at[1]="@layer".concat(at[5].length>0?" ".concat(at[5]):""," {").concat(at[1],"}")),at[5]=pt),dt&&(at[2]&&(at[1]="@media ".concat(at[2]," {").concat(at[1],"}")),at[2]=dt),Mt&&(at[4]?(at[1]="@supports (".concat(at[4],") {").concat(at[1],"}"),at[4]=Mt):at[4]="".concat(Mt)),_t.push(at))}},_t}},537:function(ut){ut.exports=function(tt){var _t=tt[1],it=tt[3];if(!it)return _t;if(typeof btoa=="function"){var dt=btoa(unescape(encodeURIComponent(JSON.stringify(it)))),At="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(dt),Mt="/*# ".concat(At," */"),pt=it.sources.map(function(Re){return"/*# sourceURL=".concat(it.sourceRoot||"").concat(Re," */")});return[_t].concat(pt).concat([Mt]).join(`
`)}return[_t].join(`
`)}},379:function(ut){var tt=[];function _t(At){for(var Mt=-1,pt=0;pt<tt.length;pt++)if(tt[pt].identifier===At){Mt=pt;break}return Mt}function it(At,Mt){for(var pt={},Re=[],lt=0;lt<At.length;lt++){var Ce=At[lt],vt=Mt.base?Ce[0]+Mt.base:Ce[0],at=pt[vt]||0,Fe="".concat(vt," ").concat(at);pt[vt]=at+1;var Ct=_t(Fe),Ft={css:Ce[1],media:Ce[2],sourceMap:Ce[3],supports:Ce[4],layer:Ce[5]};if(Ct!==-1)tt[Ct].references++,tt[Ct].updater(Ft);else{var Ue=dt(Ft,Mt);Mt.byIndex=lt,tt.splice(lt,0,{identifier:Fe,updater:Ue,references:1})}Re.push(Fe)}return Re}function dt(At,Mt){var pt=Mt.domAPI(Mt);return pt.update(At),function(Re){if(Re){if(Re.css===At.css&&Re.media===At.media&&Re.sourceMap===At.sourceMap&&Re.supports===At.supports&&Re.layer===At.layer)return;pt.update(At=Re)}else pt.remove()}}ut.exports=function(At,Mt){var pt=it(At=At||[],Mt=Mt||{});return function(Re){Re=Re||[];for(var lt=0;lt<pt.length;lt++){var Ce=_t(pt[lt]);tt[Ce].references--}for(var vt=it(Re,Mt),at=0;at<pt.length;at++){var Fe=_t(pt[at]);tt[Fe].references===0&&(tt[Fe].updater(),tt.splice(Fe,1))}pt=vt}}},216:function(ut){ut.exports=function(tt){var _t=document.createElement("style");return tt.setAttributes(_t,tt.attributes),tt.insert(_t,tt.options),_t}},636:function(ut,tt,_t){ut.exports=function(it){var dt=_t.nc;dt&&it.setAttribute("nonce",dt)}},795:function(ut){ut.exports=function(tt){var _t=tt.insertStyleElement(tt);return{update:function(it){(function(dt,At,Mt){var pt="";Mt.supports&&(pt+="@supports (".concat(Mt.supports,") {")),Mt.media&&(pt+="@media ".concat(Mt.media," {"));var Re=Mt.layer!==void 0;Re&&(pt+="@layer".concat(Mt.layer.length>0?" ".concat(Mt.layer):""," {")),pt+=Mt.css,Re&&(pt+="}"),Mt.media&&(pt+="}"),Mt.supports&&(pt+="}");var lt=Mt.sourceMap;lt&&typeof btoa<"u"&&(pt+=`
/`,pt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(lt))))," *"),pt+="/"),At.styleTagTransform(pt,dt,At.options)})(_t,tt,it)},remove:function(){(function(it){if(it.parentNode===null)return!1;it.parentNode.removeChild(it)})(_t)}}}},589:function(ut){ut.exports=function(tt,_t){if(_t.styleSheet)_t.styleSheet.cssText=tt;else{for(;_t.firstChild;)_t.removeChild(_t.firstChild);_t.appendChild(document.createTextNode(tt))}}}},p={};function Ke(ut){var tt=p[ut];if(tt!==void 0)return tt.exports;var _t=p[ut]={id:ut,exports:{}};return V[ut](_t,_t.exports,Ke),_t.exports}Ke.n=function(ut){var tt=ut&&ut.__esModule?function(){return ut.default}:function(){return ut};return Ke.d(tt,{a:tt}),tt},Ke.d=function(ut,tt){for(var _t in tt)Ke.o(tt,_t)&&!Ke.o(ut,_t)&&Object.defineProperty(ut,_t,{enumerable:!0,get:tt[_t]})},Ke.o=function(ut,tt){return Object.prototype.hasOwnProperty.call(ut,tt)},Ke.nc=void 0;var ct={};return function(){Ke.d(ct,{default:function(){return He}});var ut=Ke(379),tt=Ke.n(ut),_t=Ke(795),it=Ke.n(_t),dt=Ke(636),At=Ke.n(dt),Mt=Ke(216),pt=Ke.n(Mt),Re=Ke(589),lt=Ke.n(Re),Ce=Ke(820),vt={};Ce.Z&&Ce.Z.locals&&(vt.locals=Ce.Z.locals);var at,Fe=0,Ct={};Ct.styleTagTransform=lt(),Ct.setAttributes=At(),Ct.insert=function(gt,It){(It.target||document.head).appendChild(gt)},Ct.domAPI=it(),Ct.insertStyleElement=pt(),vt.use=function(gt){return Ct.options=gt||{},Fe++||(at=tt()(Ce.Z,Ct)),vt},vt.unuse=function(){Fe>0&&!--Fe&&(at(),at=null)};var Ft=vt;function Ue(gt,It){return function(xt){if(Array.isArray(xt))return xt}(gt)||function(xt,jt){var ot=xt==null?null:typeof Symbol<"u"&&xt[Symbol.iterator]||xt["@@iterator"];if(ot!=null){var Bt,Rt,Qt=[],Qe=!0,oe=!1;try{for(ot=ot.call(xt);!(Qe=(Bt=ot.next()).done)&&(Qt.push(Bt.value),!jt||Qt.length!==jt);Qe=!0);}catch(Ie){oe=!0,Rt=Ie}finally{try{Qe||ot.return==null||ot.return()}finally{if(oe)throw Rt}}return Qt}}(gt,It)||function(xt,jt){if(xt){if(typeof xt=="string")return $e(xt,jt);var ot=Object.prototype.toString.call(xt).slice(8,-1);return ot==="Object"&&xt.constructor&&(ot=xt.constructor.name),ot==="Map"||ot==="Set"?Array.from(xt):ot==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ot)?$e(xt,jt):void 0}}(gt,It)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function $e(gt,It){(It==null||It>gt.length)&&(It=gt.length);for(var xt=0,jt=new Array(It);xt<It;xt++)jt[xt]=gt[xt];return jt}function Z(gt,It){var xt=Object.keys(gt);if(Object.getOwnPropertySymbols){var jt=Object.getOwnPropertySymbols(gt);It&&(jt=jt.filter(function(ot){return Object.getOwnPropertyDescriptor(gt,ot).enumerable})),xt.push.apply(xt,jt)}return xt}function ee(gt){for(var It=1;It<arguments.length;It++){var xt=arguments[It]!=null?arguments[It]:{};It%2?Z(Object(xt),!0).forEach(function(jt){ce(gt,jt,xt[jt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(gt,Object.getOwnPropertyDescriptors(xt)):Z(Object(xt)).forEach(function(jt){Object.defineProperty(gt,jt,Object.getOwnPropertyDescriptor(xt,jt))})}return gt}function ce(gt,It,xt){return It in gt?Object.defineProperty(gt,It,{value:xt,enumerable:!0,configurable:!0,writable:!0}):gt[It]=xt,gt}function Ne(gt,It){for(var xt=0;xt<It.length;xt++){var jt=It[xt];jt.enumerable=jt.enumerable||!1,jt.configurable=!0,"value"in jt&&(jt.writable=!0),Object.defineProperty(gt,jt.key,jt)}}function K(gt){var It={};return gt.reduce(function(xt,jt){return It[jt]||(It[jt]=!0,xt.push(jt)),xt},[])}function ie(gt,It){requestAnimationFrame(function(){It.enter(),requestAnimationFrame(function(){It.active(),setTimeout(function(){It.leave()},gt)})})}function he(gt,It){try{var xt=gt.liElementsById[It.parent.id];xt.classList.contains("treejs-node__close")||xt.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(It,"parent")&&he(gt,It.parent)}function _e(gt,It){var xt=gt.liElementsById[It.id];xt.classList.contains("treejs-node__close")&&xt.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(It,"children")&&It.children.forEach(function(jt){return _e(gt,jt)})}var He=function(){function gt(ot,Bt){(function(Rt,Qt){if(!(Rt instanceof Qt))throw new TypeError("Cannot call a class as a function")})(this,gt),Ft.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=ot,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},Bt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(Rt){this.setValues(K(Rt))}},disables:{get:function(){return this.getDisables()},set:function(Rt){this.setDisables(K(Rt))}},selectedNodes:{get:function(){var Rt=[],Qt=this.nodesById;return Object.keys(Qt).forEach(function(Qe){if(Object.prototype.hasOwnProperty.call(Qt,Qe)&&(Qt[Qe].status===1||Qt[Qe].status===2)){var oe=ee({},Qt[Qe]);delete oe.parent,delete oe.children,Rt.push(oe)}}),Rt}},disabledNodes:{get:function(){var Rt=[],Qt=this.nodesById;return Object.keys(Qt).forEach(function(Qe){if(Object.prototype.hasOwnProperty.call(Qt,Qe)&&Qt[Qe].disabled){var oe=ee({},Qt[Qe]);delete oe.parent,Rt.push(oe)}}),Rt}}}),this.init(this.options.data)}var It,xt,jt;return It=gt,jt=[{key:"onSwitcherClick",value:function(ot){var Bt=ot.parentNode,Rt=Bt.lastChild,Qt=Rt.scrollHeight;Bt.classList.contains("treejs-node__close")?ie(150,{enter:function(){Rt.style.height=0,Rt.style.opacity=0},active:function(){Rt.style.height="".concat(Qt,"px"),Rt.style.opacity=1},leave:function(){Rt.style.height="",Rt.style.opacity="",Bt.classList.remove("treejs-node__close")}}):ie(150,{enter:function(){Rt.style.height="".concat(Qt,"px"),Rt.style.opacity=1},active:function(){Rt.style.height=0,Rt.style.opacity=0},leave:function(){Rt.style.height="",Rt.style.opacity="",Bt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(ot){var Bt,Rt=(Bt=ot,JSON.parse(JSON.stringify(Bt))),Qt={},Qe={},oe=[],Ie=[];return function We(Wt,ti){Wt.forEach(function(mi){Qt[mi.id]=mi,mi.checked&&oe.push(mi.id),mi.disabled&&Ie.push(mi.id),ti&&(mi.parent=ti),mi.children&&mi.children.length?We(mi.children,mi):Qe[mi.id]=mi})}(Rt),{treeNodes:Rt,nodesById:Qt,leafNodesById:Qe,defaultValues:oe,defaultDisables:Ie}}},{key:"createRootEle",value:function(){var ot=document.createElement("div");return ot.classList.add("treejs"),ot}},{key:"createUlEle",value:function(){var ot=document.createElement("ul");return ot.classList.add("treejs-nodes"),ot}},{key:"createLiEle",value:function(ot,Bt){var Rt=document.createElement("li");if(Rt.classList.add("treejs-node"),Bt&&Rt.classList.add("treejs-node__close"),ot.children&&ot.children.length){var Qt=document.createElement("span");Qt.classList.add("treejs-switcher"),Rt.appendChild(Qt)}else Rt.classList.add("treejs-placeholder");var Qe=document.createElement("span");Qe.classList.add("treejs-checkbox"),Rt.appendChild(Qe);var oe=document.createElement("span");oe.classList.add("treejs-label");var Ie=document.createTextNode(ot.text);return oe.appendChild(Ie),Rt.appendChild(oe),Rt.nodeId=ot.id,Rt}}],(xt=[{key:"init",value:function(ot){var Bt=gt.parseTreeData(ot),Rt=Bt.treeNodes,Qt=Bt.nodesById,Qe=Bt.leafNodesById,oe=Bt.defaultValues,Ie=Bt.defaultDisables;this.treeNodes=Rt,this.nodesById=Qt,this.leafNodesById=Qe,this.render(this.treeNodes);var We=this.options,Wt=We.values,ti=We.disables,mi=We.loaded;Wt&&Wt.length?this.setValues(Wt):oe&&oe.length&&this.setValues(oe),ti&&ti.length?this.setDisables(ti):Ie&&Ie.length&&this.setDisables(Ie),typeof mi=="function"&&mi.call(this)}},{key:"render",value:function(ot){var Bt=gt.createRootEle();Bt.appendChild(this.buildTree(ot,0)),this.bindEvent(Bt);var Rt=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Qt){for(;Qt.firstChild;)Qt.removeChild(Qt.firstChild)})(Rt),Rt.appendChild(Bt)}},{key:"buildTree",value:function(ot,Bt){var Rt=this,Qt=gt.createUlEle();return ot&&ot.length&&ot.forEach(function(Qe){var oe=gt.createLiEle(Qe,Bt===Rt.options.closeDepth-1);Rt.liElementsById[Qe.id]=oe;var Ie=null;Qe.children&&Qe.children.length&&(Ie=Rt.buildTree(Qe.children,Bt+1)),Ie&&oe.appendChild(Ie),Qt.appendChild(oe)}),Qt}},{key:"bindEvent",value:function(ot){var Bt=this;ot.addEventListener("click",function(Rt){var Qt=Rt.target;Qt.nodeName==="SPAN"&&Qt.classList.contains("treejs-checkbox")?Bt.onItemClick(Qt.parentNode.nodeId):Qt.nodeName==="SPAN"&&Qt.classList.contains("treejs-label")?Bt.onItemLabelClick(Qt.parentNode.nodeId):Qt.nodeName==="LI"&&Qt.classList.contains("treejs-node")?Bt.onItemClick(Qt.nodeId):Qt.nodeName==="SPAN"&&Qt.classList.contains("treejs-switcher")&&gt.onSwitcherClick(Qt)},!1)}},{key:"onItemClick",value:function(ot){var Bt=this.nodesById[ot],Rt=this.options.onChange;Bt.disabled||(this.setValue(ot),this.updateLiElements()),Rt&&Rt.call(this)}},{key:"onItemLabelClick",value:function(ot){var Bt=this.options.onItemLabelClick;Bt&&Bt.call(this,ot)}},{key:"setValue",value:function(ot){var Bt=this.nodesById[ot];if(Bt){var Rt=Bt.status,Qt=Rt===1||Rt===2?0:2;Bt.status=Qt,this.markWillUpdateNode(Bt),this.walkUp(Bt,"status"),this.walkDown(Bt,"status")}}},{key:"getValues",value:function(){var ot=this,Bt=[];return Object.keys(this.leafNodesById).forEach(function(Rt){Object.prototype.hasOwnProperty.call(ot.leafNodesById,Rt)&&(ot.leafNodesById[Rt].status!==1&&ot.leafNodesById[Rt].status!==2||Bt.push(Rt))}),Bt}},{key:"setValues",value:function(ot){var Bt=this;this.emptyNodesCheckStatus(),ot.forEach(function(Qt){Bt.setValue(Qt)}),this.updateLiElements();var Rt=this.options.onChange;Rt&&Rt.call(this)}},{key:"setDisable",value:function(ot){var Bt=this.nodesById[ot];Bt&&(Bt.disabled||(Bt.disabled=!0,this.markWillUpdateNode(Bt),this.walkUp(Bt,"disabled"),this.walkDown(Bt,"disabled")))}},{key:"getDisables",value:function(){var ot=this,Bt=[];return Object.keys(this.leafNodesById).forEach(function(Rt){Object.prototype.hasOwnProperty.call(ot.leafNodesById,Rt)&&ot.leafNodesById[Rt].disabled&&Bt.push(Rt)}),Bt}},{key:"setDisables",value:function(ot){var Bt=this;this.emptyNodesDisable(),ot.forEach(function(Rt){Bt.setDisable(Rt)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ot){ot.disabled||(ot.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ot){ot.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ot,Bt){var Rt=Ue(Bt,2),Qt=Rt[0],Qe=Rt[1];return Qe.status!==1&&Qe.status!==2||(ot[Qt]=Qe),ot},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ot,Bt){var Rt=Ue(Bt,2),Qt=Rt[0],Qe=Rt[1];return Qe.disabled&&(ot[Qt]=Qe),ot},{})}},{key:"updateLiElements",value:function(){var ot=this;Object.values(this.willUpdateNodesById).forEach(function(Bt){ot.updateLiElement(Bt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(ot){this.willUpdateNodesById[ot.id]=ot}},{key:"walkUp",value:function(ot,Bt){var Rt=ot.parent;if(Rt){if(Bt==="status"){var Qt,Qe=Rt.children.reduce(function(Ie,We){return Number.isNaN(We.status)?Ie:Ie+We.status},0);if(Qt=Qe?Qe===2*Rt.children.length?2:1:0,Rt.status===Qt)return;Rt.status=Qt}else{var oe=Rt.children.reduce(function(Ie,We){return Ie&&We.disabled},!0);if(Rt.disabled===oe)return;Rt.disabled=oe}this.markWillUpdateNode(Rt),this.walkUp(Rt,Bt)}}},{key:"walkDown",value:function(ot,Bt){var Rt=this;ot.children&&ot.children.length&&ot.children.forEach(function(Qt){Bt==="status"&&Qt.disabled||(Qt[Bt]=ot[Bt],Rt.markWillUpdateNode(Qt),Rt.walkDown(Qt,Bt))})}},{key:"updateLiElement",value:function(ot){var Bt=this.liElementsById[ot.id].classList;switch(ot.status){case 0:Bt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:Bt.remove("treejs-node__checked"),Bt.add("treejs-node__halfchecked");break;case 2:Bt.remove("treejs-node__halfchecked"),Bt.add("treejs-node__checked")}switch(ot.disabled){case!0:Bt.contains("treejs-node__disabled")||Bt.add("treejs-node__disabled");break;case!1:Bt.contains("treejs-node__disabled")&&Bt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var ot=this;Object.keys(this.leafNodesById).forEach(function(Bt){var Rt=ot.leafNodesById[Bt];he(ot,Rt)})}},{key:"expandAll",value:function(){_e(this,this.treeNodes[0])}}])&&Ne(It.prototype,xt),jt&&Ne(It,jt),Object.defineProperty(It,"prototype",{writable:!1}),gt}()}(),ct.default}()},8:function(kt,V){(function(p){class Ke{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(ie,he){const _e=this._eventListeners;_e[ie]===void 0&&(_e[ie]=[]),_e[ie].includes(he)||_e[ie].push(he)}hasEventListener(ie,he){const _e=this._eventListeners;return _e[ie]!==void 0&&_e[ie].includes(he)}removeEventListener(ie,he){const _e=this._eventListeners[ie];if(_e!==void 0){const He=_e.indexOf(he);He!==-1&&_e.splice(He,1)}}dispatchEvent(ie){const he=this._eventListeners[ie.type];if(he!==void 0){ie.target=this;const _e=he.slice(0);for(let He=0,gt=_e.length;He<gt;He++)_e[He].call(this,ie)}}}function ct(){return(typeof performance>"u"?Date:performance).now()}class ut{constructor(ie=ut.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(ie)}setDecayTime(ie){this.naturalFrequency=1/Math.max(ut.MIN_DECAY_MILLISECONDS,ie)}update(ie,he,_e,He){const gt=2e-4*this.naturalFrequency;if(ie==null||He===0||ie===he&&this.velocity===0)return he;if(_e<0)return ie;const It=ie-he,xt=this.velocity+this.naturalFrequency*It,jt=It+_e*xt,ot=Math.exp(-this.naturalFrequency*_e),Bt=(xt-this.naturalFrequency*jt)*ot,Rt=-this.naturalFrequency*(Bt+xt*ot);return Math.abs(Bt)<gt*Math.abs(He)&&Rt*It>=0?(this.velocity=0,he):(this.velocity=Bt,he+jt*ot)}}async function tt(K){return new Promise((ie,he)=>{const _e=new Image;_e.onload=()=>ie(_e),_e.onerror=he,_e.crossOrigin="anonymous",_e.decoding="sync",_e.src=K})}function _t(K,ie=document.head){const he=document.createElement("style");return he.type="text/css",he.innerText=K,ie==null||ie.appendChild(he),he}ut.SETTLING_TIME=1e4,ut.MIN_DECAY_MILLISECONDS=.001,ut.DECAY_MILLISECONDS=50;const it={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function dt(K){return K.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function At(K,ie,he){return K.replace(new RegExp(dt(ie),"g"),he)}const Mt=(K,...ie)=>String.raw({raw:K},...ie),pt=(K,...ie)=>{let he=String.raw({raw:K},...ie);return he=At(he,"%","%25"),he=At(he,"> <","><"),he=At(he,"; }",";}"),he=At(he,"<","%3c"),he=At(he,">","%3e"),he=At(he,'"',"'"),he=At(he,"#","%23"),he=At(he,"{","%7b"),he=At(he,"}","%7d"),he=At(he,"|","%7c"),he=At(he,"^","%5e"),he=At(he,"`","%60"),he=At(he,"@","%40"),he=At(he,"&","&amp;"),he=At(he,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+he};function Re(K,ie){const he=window.URL.createObjectURL(K),_e=document.createElement("a");_e.style.display="none",_e.href=he,_e.download=ie,document.body.appendChild(_e),_e.click(),setTimeout(()=>{document.body.removeChild(_e),window.URL.revokeObjectURL(he)},1e3)}async function lt(K){return new Promise((ie,he)=>{const _e=new FileReader;_e.onload=He=>ie(_e.result),_e.onerror=He=>he(_e.error),_e.onabort=He=>he(new Error("Read aborted")),_e.readAsDataURL(K)})}function Ce(K,ie){let he;do he=Object.getOwnPropertyDescriptor(K,ie);while(!he&&(K=Object.getPrototypeOf(K)));return he}function vt(K,ie,he=!0,_e=!1){const He=Ce(K,ie);return!!(He!=null&&He.set)||he&&(He==null?void 0:He.writable)!==!1&&(He==null?void 0:He.get)===void 0||_e&&!He}function at(K,ie,he,_e=!0,He=!1){return!(!K||!vt(K,ie,_e,He)||(K[ie]=he,0))}function Fe(K,ie){for(let he=K.length-1;he>=0;he--)if(ie(K[he]))return he;return-1}const Ct={priority:1/0,serialize:(K,ie)=>Object.fromEntries(Object.entries(K).map(([he,_e])=>[he,Ft.Serialize(_e,ie,!1)])),deserialize:(K,ie,he)=>Object.assign(ie||{},Object.fromEntries(Object.entries(K).map(([_e,He])=>[_e,Ft.Deserialize(He,ie==null?void 0:ie[_e],he,!1)]))),isType:K=>(K.constructor||Object)===Object};class Ft{static GetSerializer(ie){return Ft.Serializers.find(he=>he.isType(ie))}static RegisterSerializer(...ie){var he;for(const _e of ie){const He=(he=_e.priority)!==null&&he!==void 0?he:1e10,gt=Fe(Ft.Serializers,It=>It.priority!==void 0&&It.priority<He);gt>=0?Ft.Serializers.splice(gt+1,0,_e):Ft.Serializers.push(_e)}}static UnregisterSerializer(...ie){for(const he of ie){const _e=Ft.Serializers.indexOf(he);_e>=0&&Ft.Serializers.splice(_e,1)}}static Serialize(ie,he,_e=!1){var He,gt;if(typeof ie=="function")return;if(!_e){const jt=Ft.GetSerializer(ie);if(jt)return jt.serialize(ie,he);if(typeof ie.toJSON=="function"){const ot=ie.toJSON(he);return ie.serializableClassId&&ot&&(ot.serializableClassId=ie.serializableClassId),ot}}let It=(He=ie.constructor)!==null&&He!==void 0?He:Object;const xt={};for(;It&&It!==Object;){const jt=(gt=Ft.TypeMap.get(It))!==null&&gt!==void 0?gt:[];for(const[ot,Bt]of jt)xt[ot]=Ft.Serialize(ie[Bt],he,!1);It=Object.getPrototypeOf(It)}return ie.serializableClassId&&(xt.serializableClassId=ie.serializableClassId),xt}static Deserialize(ie,he,_e,He=!1){var gt,It;if(ie===void 0||he===ie)return he;if(ie&&typeof ie=="object"&&(ie.constructor||Object)===Object&&ie.resource&&typeof ie.resource=="string"&&ie.uuid){const jt=_e==null?void 0:_e[ie.resource];if(!jt)return console.warn(`Resource ${ie.resource} not found`),he;if(typeof(ie=jt[ie.uuid])=="object"&&(ie.__useCount=ie.__useCount?ie.__useCount+1:1),ie||console.warn(`Resource ${ie.resource} with uuid ${ie.uuid} not found`),he===ie)return he;if(ie&&typeof ie=="object"){if((ie.constructor||Object)!==Object)return he&&console.warn("replacing object",he,"with deserialized object from meta",ie),ie;console.error("Deserialize; meta should only have class instances, not js objects",ie,he,_e)}}if(ie&&typeof ie=="object"&&(ie.constructor||Object)!==Object&&!Array.isArray(ie)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",ie,"source",he,ie.constructor,ie.constructor!==Object),ie&&typeof ie=="object")if(!ie.serializableClassId||he&&he.serializableClassId===ie.serializableClassId)(ie.constructor||Object)!==Object||he?Array.isArray(ie)&&!he&&(he=[]):he={};else{const jt=Ft.SerializableClasses.get(ie.serializableClassId);jt&&(he=jt.DataInConstructor?new jt(ie):new jt)}if(typeof he=="function")return console.error("cannot deserialize over function",he,ie),he;if(!He){const jt=Ft.GetSerializer(ie);if(jt&&jt!==Ct)return jt.deserialize(ie,he,_e)}if(!ie||he==null||typeof he!="object")return ie;if(!He&&typeof(he==null?void 0:he.fromJSON)=="function")return he.fromJSON(ie,_e),he;let xt=(gt=he.constructor)!==null&&gt!==void 0?gt:Object;if(xt===Object)return Ct.deserialize(ie,he,_e);for(;xt&&xt!==Object;){const jt=(It=Ft.TypeMap.get(xt))!==null&&It!==void 0?It:[];for(const[ot,Bt]of jt){const Rt=he[Bt],Qt=Ft.Deserialize(ie[ot],Rt,_e,!1);Qt!==Rt&&at(he,Bt,Qt,!0)}xt=Object.getPrototypeOf(xt)}return he}}function Ue(K,ie="param"){if(!K)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(he,_e)=>{Object.defineProperty(he,_e,{get(){return this[`_oc_${_e}`]},set(He){var gt;const It=this[`_oc_${_e}`];if(It===He)return;this[`_oc_${_e}`]=He;const xt=ie==="param"?[_e,He,It]:ie==="object"?[{key:_e,value:He,oldValue:It}]:"";if(typeof K=="string")(gt=this[K])===null||gt===void 0||gt.call(this,...xt);else if(typeof K=="function"){let jt=!1;if(K.name){let ot=this;for(;ot;){if(ot[K.name]===K){K.call(this,...xt),jt=!0;break}ot=Object.getPrototypeOf(ot)}}jt||(K.name&&this[K.name].name===`bound ${K.name}`?this[K.name](...xt):K(...xt))}}})}}function $e(K,{backgroundColor:ie="",scale:he=1,width:_e=512,height:He=512}){const gt=document.createElement("canvas"),It=gt.getContext("2d"),xt=he,jt=_e,ot=He;return gt.width=jt*xt,gt.height=ot*xt,gt.style.width=`${jt}`,gt.style.height=`${ot}`,(ie==null?void 0:ie.length)>0&&(It.fillStyle=ie,It.fillRect(0,0,gt.width,gt.height)),It.drawImage(K,0,0,gt.width,gt.height),gt}Ft.TypeMap=new Map,Ft.SerializableClasses=new Map,Ft.Serializers=[{priority:0,isType:K=>Array.isArray(K),serialize:(K,ie)=>K.map(he=>Ft.Serialize(he,ie,!1)),deserialize:(K,ie,he)=>{const _e=K.length;Array.isArray(ie)||(ie=[]);for(let He=0;He<_e;He++){const gt=K[He],It=ie.length>He?Ft.Deserialize(gt,ie[He],he,!1):Ft.Deserialize(gt,void 0,he,!1);ie.length<=He?ie.push(It):ie[He]=It}return ie}},{priority:0,isType:K=>!K||typeof K!="object",serialize:K=>{if(K&&typeof K=="number"){if(K===1/0)return"Infinity";if(K===-1/0)return"-Infinity";if(isNaN(K))return"NaN"}return K},deserialize:(K,ie)=>{if(typeof ie=="number"){if(K==="Infinity")return 1/0;if(K==="-Infinity")return-1/0;if(K==="NaN")return NaN;if(typeof K=="number"||!K)return K}return K}},Ct];const Z=async(K,ie)=>$e(await tt(K),ie),ee=async(K,ie)=>await Z(K,ie).then(he=>he.toDataURL("image/png")),ce=async K=>lt(await(await fetch(K)).blob());function Ne(K,ie,{width:he,height:_e},He=!0){const gt=`
<svg viewBox="0 0 ${he} ${_e}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${ie}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${K}
        </div>
    </foreignObject>
</svg>
    `;return He?pt(gt):gt}p.Damper=ut,p.LinearToSRGB=function(K){return K<.0031308?12.92*K:1.055*Math.pow(K,.41666)-.055},p.PointerDragHelper=class extends Ke{constructor(){super(...arguments),this._onPointerDown=K=>{if(K.button!==0||!this._element)return;this._pointerUp=void 0;const ie=K.clientX/this._element.clientWidth*2-1,he=-K.clientY/this._element.clientHeight*2+1,_e=ct();this._pointerDown={x:ie,y:he,time:_e},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=K=>{if(!this._pointerDown||!this._pointer||!this._element)return;const ie=K.clientX/this._element.clientWidth*2-1,he=-K.clientY/this._element.clientHeight*2+1,_e=ct();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:ie-this._pointerDown.x,y:he-this._pointerDown.y,time:_e-this._pointerDown.time},delta:{x:ie-this._pointer.x,y:he-this._pointer.y,time:_e-this._pointer.time}}),this._pointer={x:ie,y:he,time:ct()},K.buttons%2==0&&this._onPointerUp(K)},this._onPointerUp=K=>{if(K.button!==0||!this._pointerDown||!this._element)return;const ie=K.clientX/this._element.clientWidth*2-1,he=-K.clientY/this._element.clientHeight*2+1,_e=ct();this._pointerUp={x:ie,y:he,time:_e},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(K){this._element!==K&&(this._element&&this._removeElement(),this._element=K,this._element&&this._addElement())}_removeElement(){var K,ie,he,_e,He;(K=this._element)===null||K===void 0||K.removeEventListener("pointerdown",this._onPointerDown),(ie=this._element)===null||ie===void 0||ie.removeEventListener("pointermove",this._onPointerMove),(he=this._element)===null||he===void 0||he.removeEventListener("pointerup",this._onPointerUp),(_e=this._element)===null||_e===void 0||_e.removeEventListener("pointercancel",this._onPointerUp),(He=this._element)===null||He===void 0||He.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var K,ie,he,_e,He;(K=this._element)===null||K===void 0||K.addEventListener("pointerdown",this._onPointerDown),(ie=this._element)===null||ie===void 0||ie.addEventListener("pointermove",this._onPointerMove),(he=this._element)===null||he===void 0||he.addEventListener("pointerup",this._onPointerUp),(_e=this._element)===null||_e===void 0||_e.addEventListener("pointercancel",this._onPointerUp),(He=this._element)===null||He===void 0||He.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},p.SRGBToLinear=function(K){return K<.04045?.0773993808*K:Math.pow(.9478672986*K+.0521327014,2.4)},p.Serialization=Ft,p.SimpleEventDispatcher=Ke,p.TYPED_ARRAYS=it,p.absMax=function(K,ie){return Math.abs(K)>Math.abs(ie)?K:ie},p.aesGcmDecrypt=async function(K,ie){const he=typeof ie=="string"?new TextEncoder().encode(ie):ie,_e=await crypto.subtle.digest("SHA-256",he),He=K.slice(0,12),gt={name:"AES-GCM",iv:typeof He=="string"?new Uint8Array(Array.from(He).map(ot=>ot.charCodeAt(0))):He},It=await crypto.subtle.importKey("raw",_e,gt,!1,["decrypt"]),xt=K.slice(12),jt=typeof xt=="string"?new Uint8Array(Array.from(xt).map(ot=>ot.charCodeAt(0))):xt;try{const ot=await crypto.subtle.decrypt(gt,It,jt);return typeof K=="string"?new TextDecoder().decode(ot):new Uint8Array(ot)}catch{throw new Error("Decrypt failed")}},p.aesGcmEncrypt=async function(K,ie,he){const _e=typeof ie=="string"?new TextEncoder().encode(ie):ie,He=await crypto.subtle.digest("SHA-256",_e),gt=crypto.getRandomValues(new Uint8Array(12)),It=Array.from(gt).map(We=>String.fromCharCode(We)).join(""),xt={name:"AES-GCM",iv:gt},jt=await crypto.subtle.importKey("raw",He,xt,!1,["encrypt"]),ot=typeof K=="string"?new TextEncoder().encode(K):K,Bt=await crypto.subtle.encrypt(xt,jt,ot),Rt=new Uint8Array(Bt),Qt=Array.from(Rt),Qe=Qt.map(We=>String.fromCharCode(We)).join(""),oe=he?typeof he=="string"?he:new TextDecoder().decode(he):"",Ie=he?typeof he=="string"?new TextEncoder().encode(he):Array.from(he):[];return typeof K=="string"?oe+It+Qe:new Uint8Array([...Ie,...gt,...Qt])},p.arrayBufferToBase64=function(K){if(!window)return console.warn("window is required"),"";let ie="";const he=new Uint8Array(K),_e=he.byteLength;for(let He=0;He<_e;He++)ie+=String.fromCharCode(he[He]);return window.btoa(ie)},p.base64ToArrayBuffer=function(K){if(!window)return console.warn("window is required"),new Uint8Array(0);const ie=window.atob(K),he=ie.length,_e=new Uint8Array(he);for(let He=0;He<he;He++)_e[He]=ie.charCodeAt(He);return _e.buffer},p.blobToDataURL=lt,p.canvasFlipY=function(K){const ie=document.createElement("canvas");ie.width=K.width,ie.height=K.height;const he=ie.getContext("2d");if(!he)throw new Error("Unable to get 2d context");return he.translate(0,K.height),he.scale(1,-1),he.drawImage(K,0,0),ie},p.clearBit=function(K,ie){return K&~(1<<ie)},p.colorToDataUrl=function(K,ie=1,he=1){const _e=document.createElement("canvas");_e.width=ie,_e.height=he;const He=_e.getContext("2d");He.fillStyle="#"+K,He.fillRect(0,0,ie,he);const gt=_e.toDataURL();return _e.remove(),gt},p.copyProps=function(K,ie,he){for(const _e of he){const He=K[_e];He!==void 0&&at(ie,_e,He,!0)}return ie},p.createCanvasElement=function(){const K=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return K.style.display="block",K},p.createDiv=function({innerHTML:K="",id:ie,classList:he,addToBody:_e=!0,elementTag:He="div"}){const gt=document.createElement(He);return ie&&(gt.id=ie),gt.innerHTML=K,he&&gt.classList.add(...he),_e&&document.body.appendChild(gt),gt},p.createImage=tt,p.createScriptFromURL=async function(K,ie=document.head){return new Promise((he,_e)=>{const He=document.createElement("script");He.setAttribute("src",K),He.addEventListener("load",()=>he(He)),He.addEventListener("error",_e),ie.appendChild(He)})},p.createStyles=_t,p.css=Mt,p.deepAccessObject=function(K,ie,he=!1){for(typeof K=="string"&&(K=K.split("."));K.length>0;){if(!ie)return;const _e=K.splice(0,1)[0];if(!(_e.length<1)){if(!(_e in ie)){if(he)throw new Error("invalid access, check "+_e+" in "+ie);return}ie=ie[_e]}}return ie},p.downloadBlob=Re,p.downloadFile=function(K,ie){return Re(K,ie??K.name)},p.embedUrlRefs=async function(K,ie=ce){const he=K.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(he)for(const _e of he){const He=await ie(_e);K=K.replace(_e,He)}return K},p.escapeRegExp=dt,p.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(K=>K[0]):window.chooseFileSystemEntries()},p.getFilenameFromPath=function(K){return K.substring(K.lastIndexOf("/")+1)},p.getKeyByValue=function(K,ie){return Object.keys(K).find(he=>K[he]===ie)},p.getNewFileHandle=function(){if("showSaveFilePicker"in window){const K={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(K)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},p.getOrCall=function(K,...ie){return typeof K=="function"&&(K=K(...ie)),K},p.getPropertyDescriptor=Ce,p.getTypedArray=function(K,ie){return new it[K](ie)},p.getUrlQueryParam=function(K,ie=null){var he;return(he=new URL(window.location.href).searchParams.get(K))!==null&&he!==void 0?he:ie},p.glsl=(K,...ie)=>String.raw({raw:K},...ie),p.html=(K,...ie)=>String.raw({raw:K},...ie),p.htmlToCanvas=async function(K,ie,he){const _e=Ne(K,ie,he);return await Z(_e,he)},p.htmlToPng=async function(K,ie,he){const _e=Ne(K,ie,he);return await ee(_e,he)},p.htmlToSvg=Ne,p.imageBitmapToBase64=function(K,ie=8192,he=!1){var _e;if(!K.width||!K.height)return"";const He=document.createElement("canvas");He.width=Math.min(ie,K.width),He.height=Math.floor(1+He.width*K.height/K.width);const gt=K instanceof ImageBitmap,It=gt&&he&&Math.abs(He.width-K.width)<.5?He.getContext("bitmaprenderer"):void 0;It?It.transferFromImageBitmap(K):(_e=He.getContext("2d"))===null||_e===void 0||_e.drawImage(K,0,0,He.width,He.height);const xt=He.toDataURL("image/png");return He.remove(),gt&&he&&K.close(),xt},p.imageDataToCanvas=function(K){const ie=document.createElement("canvas");return ie.width=K.width,ie.height=K.height,ie.getContext("2d").putImageData(K,0,0),ie},p.imageToCanvas=$e,p.imageUrlToImageData=async function(K){return new Promise((ie,he)=>{const _e=new Image;_e.addEventListener("load",()=>{const He=document.createElement("canvas");He.width=_e.width,He.height=_e.height;const gt=He.getContext("2d");if(!gt)return void he(new Error("Could not get 2d context"));gt.drawImage(_e,0,0,He.width,He.height);const It=gt.getImageData(0,0,He.width,He.height);ie(It),He.remove(),_e.remove()},!1),_e.addEventListener("error",He=>{_e.remove(),he(He)},!1),_e.src=K})},p.includesAll=function(K,ie){for(const he of ie)if(!K.includes(he))return!1;return!0},p.isPropertyWritable=vt,p.isWebpExportSupported=function(){const K=document.createElement("canvas");return!(!K.getContext||!K.getContext("2d"))&&K.toDataURL("image/webp").startsWith("data:image/webp")},p.longestCommonPrefix=function(K){return K.sort(),K[0].split("").map((ie,he)=>K[K.length-1][he]===ie?ie:"\0").join("").split("\0").at(0)||""},p.makeColorSvg=K=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${K}'/%3E%3C/svg%3E%0A`,p.makeColorSvgCircle=K=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${K}'/%3E%3C/svg%3E%0A`,p.makeTextSvg=K=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${K}%3C/text%3E%3C/svg%3E%0A`,p.mobileAndTabletCheck=function(){let K=!1;var ie;return ie=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ie)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ie.substr(0,4)))&&(K=!0),K},p.now=ct,p.objectHasOwn=function(K,ie){return Object.hasOwn?Object.hasOwn(K,ie):K.hasOwnProperty(ie)},p.onChange=Ue,p.onChange2=function(K,ie="void"){if(!K)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Ue(K,ie)},p.onChange3=function(K,ie="object"){if(!K)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return Ue(K,ie)},p.parseFileExtension=function(K){var ie;if(!K||K===""||K.match(/__MACOSX\/.*\._/))return"";const he=(ie=(K=K.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&ie!==void 0?ie:"",_e=he.lastIndexOf(".");return he===""||_e<1?"":he.slice(_e+1)},p.pathJoin=function(K,ie="/"){return K.join(ie)},p.prettyScrollbar=function(K=document.head){return _t(Mt`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,K)},p.readFile=function(K){return K.text?K.text():function(ie){return new Promise(he=>{const _e=new FileReader;_e.addEventListener("loadend",He=>{const gt=He.srcElement.result;he(gt)}),_e.readAsText(ie)})}(K)},p.remoteWorkerURL=function(K,ie){const he=(ie?`var Module = { locateFile: function(s) { return "${ie}"; } }; 
`:"")+`importScripts( "${K}" );`;return URL.createObjectURL(new Blob([he],{type:"text/javascript"}))},p.replaceAll=At,p.safeSetProperty=at,p.serializable=function(K){return ie=>(ie=class extends ie{constructor(){super(...arguments),this.serializableClassId=K}},Ft.SerializableClasses.set(K,ie),ie)},p.serialize=function(K){return(ie,he)=>{const _e=ie.constructor;if(_e===Object)throw new Error("All properties in an object are serialized by default");Ft.TypeMap.has(_e)||Ft.TypeMap.set(_e,[]),Ft.TypeMap.get(_e).push([K||he,he])}},p.setUrlQueryParam=function(K,ie,he=!1){const _e=new URLSearchParams(location.search);ie==null?_e.has(K)&&_e.delete(K):_e.set(K,ie),he?window.location.search=_e.toString():window.history.replaceState({},"","?"+_e.toString())},p.svgToCanvas=Z,p.svgToPng=ee,p.svgUrl=pt,p.timeout=async function(K){return new Promise(ie=>setTimeout(ie,Math.max(0,K)))},p.toTitleCase=function(K){return K.replace(/\w\S*/g,function(ie){return ie.charAt(0).toUpperCase()+ie.substr(1).toLowerCase()})},p.updateBit=function(K,ie,he){return K&~(1<<ie)|(he?1:0)<<ie},p.uploadFile=async function(K=!1,ie=!1,he){const _e=document.createElement("input");_e.type="file",_e.multiple=K,_e.accept=he||"*",_e.webkitdirectory=ie,_e.style.display="none",document.body.appendChild(_e),_e.click();const He=await new Promise(gt=>{_e.onchange=It=>{gt(Array.from(_e.files||[]))}});return document.body.removeChild(_e),He},p.verifyPermission=async function(K,ie){const he={};return ie&&(he.writable=!0,he.mode="readwrite"),await K.queryPermission(he)==="granted"||await K.requestPermission(he)==="granted"},p.writeFile=async function(K,ie){if(K.createWriter){const _e=await K.createWriter();return await _e.write(0,ie),void await _e.close()}const he=await K.createWritable();await he.write(ie),await he.close()}})(V)},819:function(kt,V){(function(p){const Ke="tp";function ct($e){return Z=>ee=>{if(!Z&&ee===void 0)return{succeeded:!1,value:void 0};if(Z&&ee===void 0)return{succeeded:!0,value:void 0};const ce=$e(ee);return ce!==void 0?{succeeded:!0,value:ce}:{succeeded:!1,value:void 0}}}function ut($e){return{custom:Z=>ct(Z)($e),boolean:ct(Z=>typeof Z=="boolean"?Z:void 0)($e),number:ct(Z=>typeof Z=="number"?Z:void 0)($e),string:ct(Z=>typeof Z=="string"?Z:void 0)($e),function:ct(Z=>typeof Z=="function"?Z:void 0)($e),constant:Z=>ct(ee=>ee===Z?Z:void 0)($e),raw:ct(Z=>Z)($e),object:Z=>ct(ee=>{if((ce=ee)!==null&&typeof ce=="object")return function(Ne,K){return Object.keys(K).reduce((ie,he)=>{if(ie===void 0)return;const _e=(0,K[he])(Ne[he]);return _e.succeeded?Object.assign(Object.assign({},ie),{[he]:_e.value}):void 0},{})}(ee,Z);var ce})($e),array:Z=>ct(ee=>{if(Array.isArray(ee))return ce=Z,ee.reduce((Ne,K)=>{if(Ne===void 0)return;const ie=ce(K);return ie.succeeded&&ie.value!==void 0?[...Ne,ie.value]:void 0},[]);var ce})($e)}}const tt={optional:ut(!0),required:ut(!1)};function _t($e){return Z=>Z.toFixed(Math.max(Math.min($e,20),0))}function it($e){return[$e[0],$e[1],$e[2]]}function dt($e){return Z=>function(ee,ce){const Ne=_t(ce==="float"?2:0);return`rgb(${it(ee.getComponents("rgb",ce)).map(K=>Ne(K)).join(", ")})`}(Z,$e)}function At($e){return Z=>function(ee,ce){const Ne=_t(2),K=_t(ce==="float"?2:0);return`rgba(${ee.getComponents("rgb",ce).map((ie,he)=>(he===3?Ne:K)(ie)).join(", ")})`}(Z,$e)}function Mt($e){return Z=>function(ee,ce){const Ne=_t(ce==="float"?2:0),K=["r","g","b"];return`{${it(ee.getComponents("rgb",ce)).map((ie,he)=>`${K[he]}: ${Ne(ie)}`).join(", ")}}`}(Z,$e)}function pt($e){return Z=>function(ee,ce){const Ne=_t(2),K=_t(ce==="float"?2:0),ie=["r","g","b","a"];return`{${ee.getComponents("rgb",ce).map((he,_e)=>`${ie[_e]}: ${(_e===3?Ne:K)(he)}`).join(", ")}}`}(Z,$e)}function Re($e,Z,ee,ce){return new(ee||(ee=Promise))(function(Ne,K){function ie(He){try{_e(ce.next(He))}catch(gt){K(gt)}}function he(He){try{_e(ce.throw(He))}catch(gt){K(gt)}}function _e(He){var gt;He.done?Ne(He.value):(gt=He.value,gt instanceof ee?gt:new ee(function(It){It(gt)})).then(ie,he)}_e((ce=ce.apply($e,Z||[])).next())})}function lt($e){return Re(this,void 0,void 0,function*(){const Z=new Image;return Z.crossOrigin="anonymous",new Promise((ee,ce)=>{Z.src=$e,Z.onload=()=>{ee(Z)},Z.onerror=ce})})}["int","float"].reduce(($e,Z)=>[...$e,{format:{alpha:!1,mode:"rgb",notation:"func",type:Z},stringifier:dt(Z)},{format:{alpha:!0,mode:"rgb",notation:"func",type:Z},stringifier:At(Z)},{format:{alpha:!1,mode:"rgb",notation:"object",type:Z},stringifier:Mt(Z)},{format:{alpha:!0,mode:"rgb",notation:"object",type:Z},stringifier:pt(Z)}],[]);const Ce=(vt="img",($e,Z)=>[Ke,"-",vt,"v",$e?`_${$e}`:"",Z?`-${Z}`:""].join(""));var vt;class at{constructor(Z,ee){this.element=Z.createElement("div"),this.element.classList.add(Ce()),ee.viewProps.bindClassModifiers(this.element),this.input=Z.createElement("input"),this.input.classList.add(Ce("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",ee.extensions.join(",")),this.image_=Z.createElement("img"),this.image_.classList.add(Ce("image")),this.image_.classList.add(Ce(`image_${ee.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=ce=>{ee.clickCallback?ee.clickCallback(ce,this.input):this.input.click()},this.element.classList.add(Ce("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Z){this.image_.src=Z}changeDraggingState(Z){const ee=this.element;Z?ee==null||ee.classList.add(Ce("area_dragging")):ee==null||ee.classList.remove(Ce("area_dragging"))}}let Fe=null;class Ct{constructor(Z,ee){this.value=ee.value,this.viewProps=ee.viewProps,this.view=new at(Z,{viewProps:this.viewProps,extensions:ee.extensions,imageFit:ee.imageFit,clickCallback:ee.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Z){const ee=(Z==null?void 0:Z.target).files;if(!ee||!ee.length)return;const ce=ee[0];this.setValue(ce)}onDrop(Z){return Re(this,void 0,void 0,function*(){Z.preventDefault();try{const{dataTransfer:ee}=Z,ce=ee==null?void 0:ee.files[0];if(ce)this.setValue(ce);else{const Ne=ee==null?void 0:ee.getData("url");if(!Ne)throw new Error("No url");this.setValue(Ne)}}catch(ee){console.error("Could not parse the dropped image",ee)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Z){Z.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Z){return Re(this,void 0,void 0,function*(){Z instanceof HTMLImageElement?this.updateImage(Z.src):typeof Z!="string"&&Z?yield this.setValue(Z):(Z!=="placeholder"&&Z||(Z=(yield this.handlePlaceholderImage()).src),this.updateImage(Z))})}updateImage(Z){this.view.changeImage(Z)}setValue(Z){return Re(this,void 0,void 0,function*(){if(Z instanceof HTMLImageElement)this.value.setRawValue(Z);else if(Z instanceof File){const ee=URL.createObjectURL(Z)+"#"+Z.name;Z.src=ee;const ce=yield lt(ee).catch(()=>{});this.value.setRawValue(ce||Z)}else Z?this.value.setRawValue(yield lt(Z)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Re(this,void 0,void 0,function*(){return Fe||(Fe=yield function(){const Z=document.createElement("canvas");Z.width=320,Z.height=50;const ee=Z.getContext("2d");return ee.fillStyle="#00000004",ee.fillRect(0,0,Z.width,Z.height),ee.fillStyle="#eee",ee.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',ee.textAlign="center",ee.textBaseline="middle",ee.fillText("No image",.5*Z.width,.5*Z.height),new Promise(ce=>{Z.toBlob(Ne=>{const K=new Image;K.src=URL.createObjectURL(Ne),K.isPlaceholder=!0,K.onload=()=>{ce(K)}})})}()),Fe})}}const Ft=[".jpg",".png",".gif"],Ue={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept($e,Z){if(!($e instanceof HTMLImageElement||typeof $e=="string"))return null;const ee=tt,ce=function(Ne,K){const ie=tt.required.object(K)(Ne);return ie.succeeded?ie.value:void 0}(Z,{view:ee.required.constant("input-image"),acceptUrl:ee.optional.boolean,clickCallback:ee.optional.function,imageFit:ee.optional.custom(Ne=>Ne==="contain"||Ne==="cover"?Ne:void 0),extensions:ee.optional.array(ee.required.string)});return ce?{initialValue:$e,params:ce}:null},binding:{reader($e){return Z=>Z.src!==void 0?Z.src===""?"placeholder":Z.src:Z},writer($e){return(Z,ee)=>{Z.write(ee)}}},controller($e){var Z,ee;return new Ct($e.document,{value:$e.value,imageFit:(Z=$e.params.imageFit)!==null&&Z!==void 0?Z:"cover",clickCallback:$e.params.clickCallback,viewProps:$e.viewProps,extensions:(ee=$e.params.extensions)!==null&&ee!==void 0?ee:Ft})}};p.plugin=Ue,Object.defineProperty(p,"__esModule",{value:!0})})(V)},665:function(kt,V){(function(p){class Ke{constructor(y){this.controller_=y}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(y){this.controller_.viewProps.set("disabled",y)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(y){this.controller_.viewProps.set("hidden",y)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class ct{constructor(y){this.target=y}}class ut extends ct{constructor(y,M,U,J){super(y),this.value=M,this.presetKey=U,this.last=J==null||J}}class tt extends ct{constructor(y,M,U){super(y),this.value=M,this.presetKey=U}}class _t extends ct{constructor(y,M){super(y),this.expanded=M}}class it extends ct{constructor(y,M){super(y),this.index=M}}function dt(L){return L==null}function At(L,y){if(L.length!==y.length)return!1;for(let M=0;M<L.length;M++)if(L[M]!==y[M])return!1;return!0}function Mt(L,y){let M=L;do{const U=Object.getOwnPropertyDescriptor(M,y);if(U&&(U.set!==void 0||U.writable===!0))return!0;M=Object.getPrototypeOf(M)}while(M!==null);return!1}const pt={alreadydisposed:()=>"View has been already disposed",invalidparams:L=>`Invalid parameters for '${L.name}'`,nomatchingcontroller:L=>`No matching controller for '${L.key}'`,nomatchingview:L=>`No matching view for '${JSON.stringify(L.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:L=>`Property '${L.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Re{static alreadyDisposed(){return new Re({type:"alreadydisposed"})}static notBindable(){return new Re({type:"notbindable"})}static propertyNotFound(y){return new Re({type:"propertynotfound",context:{name:y}})}static shouldNeverHappen(){return new Re({type:"shouldneverhappen"})}constructor(y){var M;this.message=(M=pt[y.type](y.context))!==null&&M!==void 0?M:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=y.type}}class lt{constructor(y,M,U){this.obj_=y,this.key_=M,this.presetKey_=U??M}static isBindable(y){return y!==null&&typeof y=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(y){this.obj_[this.key_]=y}writeProperty(y,M){const U=this.read();if(!lt.isBindable(U))throw Re.notBindable();if(!(y in U))throw Re.propertyNotFound(y);U[y]=M}}class Ce extends Ke{get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get title(){var y;return(y=this.controller_.valueController.props.get("title"))!==null&&y!==void 0?y:""}set title(y){this.controller_.valueController.props.set("title",y)}on(y,M){const U=M.bind(this);return this.controller_.valueController.emitter.on(y,()=>{U(new ct(this))}),this}}class vt{constructor(){this.observers_={}}on(y,M){let U=this.observers_[y];return U||(U=this.observers_[y]=[]),U.push({handler:M}),this}off(y,M){const U=this.observers_[y];return U&&(this.observers_[y]=U.filter(J=>J.handler!==M)),this}emit(y,M){const U=this.observers_[y];U&&U.forEach(J=>{J.handler(M)})}}const at="tp";function Fe(L){return(y,M)=>[at,"-",L,"v",y?`_${y}`:"",M?`-${M}`:""].join("")}function Ct(L){return L.rawValue}function Ft(L,y){var M,U;L.emitter.on("change",(M=Ct,U=y,J=>U(M(J)))),y(L.rawValue)}function Ue(L,y,M){Ft(L.value(y),M)}function $e(L,y){return M=>{(function(U,J,xe){xe?U.classList.add(J):U.classList.remove(J)})(L,y,M)}}function Z(L,y){Ft(L,M=>{y.textContent=M??""})}const ee=Fe("btn");class ce{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(ee()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("button");U.classList.add(ee("b")),M.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U;const J=y.createElement("div");J.classList.add(ee("t")),Z(M.props.value("title"),J),this.buttonElement.appendChild(J)}}class Ne{constructor(y,M){this.emitter=new vt,this.onClick_=this.onClick_.bind(this),this.props=M.props,this.viewProps=M.viewProps,this.view=new ce(y,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class K{constructor(y,M){var U;this.constraint_=M==null?void 0:M.constraint,this.equals_=(U=M==null?void 0:M.equals)!==null&&U!==void 0?U:(J,xe)=>J===xe,this.emitter=new vt,this.rawValue_=y}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(y){this.setRawValue(y,{forceEmit:!1,last:!0})}setRawValue(y,M){const U=M??{forceEmit:!1,last:!0},J=this.constraint_?this.constraint_.constrain(y):y,xe=this.rawValue_;(!this.equals_(xe,J)||U.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=J,this.emitter.emit("change",{options:U,previousRawValue:xe,rawValue:J,sender:this}))}}class ie{constructor(y){this.emitter=new vt,this.value_=y}get rawValue(){return this.value_}set rawValue(y){this.setRawValue(y,{forceEmit:!1,last:!0})}setRawValue(y,M){const U=M??{forceEmit:!1,last:!0},J=this.value_;(J!==y||U.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=y,this.emitter.emit("change",{options:U,previousRawValue:J,rawValue:this.value_,sender:this}))}}function he(L,y){const M=y==null?void 0:y.constraint,U=y==null?void 0:y.equals;return M||U?new K(L,y):new ie(L)}class _e{constructor(y){this.emitter=new vt,this.valMap_=y;for(const M in this.valMap_)this.valMap_[M].emitter.on("change",()=>{this.emitter.emit("change",{key:M,sender:this})})}static createCore(y){return Object.keys(y).reduce((M,U)=>Object.assign(M,{[U]:he(y[U])}),{})}static fromObject(y){const M=this.createCore(y);return new _e(M)}get(y){return this.valMap_[y].rawValue}set(y,M){this.valMap_[y].rawValue=M}value(y){return this.valMap_[y]}}function He(L){return y=>M=>{if(!y&&M===void 0)return{succeeded:!1,value:void 0};if(y&&M===void 0)return{succeeded:!0,value:void 0};const U=L(M);return U!==void 0?{succeeded:!0,value:U}:{succeeded:!1,value:void 0}}}function gt(L){return{custom:y=>He(y)(L),boolean:He(y=>typeof y=="boolean"?y:void 0)(L),number:He(y=>typeof y=="number"?y:void 0)(L),string:He(y=>typeof y=="string"?y:void 0)(L),function:He(y=>typeof y=="function"?y:void 0)(L),constant:y=>He(M=>M===y?y:void 0)(L),raw:He(y=>y)(L),object:y=>He(M=>{if((U=M)!==null&&typeof U=="object")return function(J,xe){return Object.keys(xe).reduce((pe,mt)=>{if(pe===void 0)return;const $t=(0,xe[mt])(J[mt]);return $t.succeeded?Object.assign(Object.assign({},pe),{[mt]:$t.value}):void 0},{})}(M,y);var U})(L),array:y=>He(M=>{if(Array.isArray(M))return U=y,M.reduce((J,xe)=>{if(J===void 0)return;const pe=U(xe);return pe.succeeded&&pe.value!==void 0?[...J,pe.value]:void 0},[]);var U})(L)}}const It={optional:gt(!0),required:gt(!1)};function xt(L,y){const M=It.required.object(y)(L);return M.succeeded?M.value:void 0}function jt(L){console.warn([`Missing '${L.key}' of ${L.target} in ${L.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class ot{constructor(y){this.value_=y}static create(y){return[new ot(y),(M,U)=>{y.setRawValue(M,U)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const Bt=Fe("");function Rt(L,y){return $e(L,Bt(void 0,y))}class Qt extends _e{constructor(y){var M;super(y),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ot.create(he(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(M=this.get("parent"))===null||M===void 0||M.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(y){var M,U,J;const xe=y??{};return new Qt(_e.createCore({disabled:(M=xe.disabled)!==null&&M!==void 0&&M,disposed:!1,hidden:(U=xe.hidden)!==null&&U!==void 0&&U,parent:(J=xe.parent)!==null&&J!==void 0?J:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(y){Ft(this.globalDisabled_,Rt(y,"disabled")),Ue(this,"hidden",Rt(y,"hidden"))}bindDisabled(y){Ft(this.globalDisabled_,M=>{y.disabled=M})}bindTabIndex(y){Ft(this.globalDisabled_,M=>{y.tabIndex=M?-1:0})}handleDispose(y){this.value("disposed").emitter.on("change",M=>{M&&y()})}getGlobalDisabled_(){const y=this.get("parent");return!!y&&y.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(y){var M;const U=y.previousRawValue;U==null||U.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(M=this.get("parent"))===null||M===void 0||M.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Qe=Fe(""),oe={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Ie{constructor(y){this.parent_=null,this.blade=y.blade,this.view=y.view,this.viewProps=y.viewProps;const M=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(U=>{M.classList.remove(Qe(void 0,oe[U]))}),this.blade.get("positions").forEach(U=>{M.classList.add(Qe(void 0,oe[U]))})}),this.viewProps.handleDispose(()=>{(function(U){U&&U.parentElement&&U.parentElement.removeChild(U)})(M)})}get parent(){return this.parent_}set parent(y){this.parent_=y,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):jt({key:"parent",target:Qt.name,place:"BladeController.parent"})}}const We="http://www.w3.org/2000/svg";function Wt(L){L.offsetHeight}function ti(L){return L.ontouchstart!==void 0}function mi(){return globalThis.document}const rr={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Oi(L,y){const M=L.createElementNS(We,"svg");return M.innerHTML=rr[y],M}function Lr(L,y,M){L.insertBefore(y,L.children[M])}function zr(L){L.parentElement&&L.parentElement.removeChild(L)}function Vr(L){for(;L.children.length>0;)L.removeChild(L.children[0])}function Qn(L){return L.relatedTarget?L.relatedTarget:"explicitOriginalTarget"in L?L.explicitOriginalTarget:null}const nn=Fe("lbl");class $r{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(nn()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(nn("l")),Ue(M.props,"label",xe=>{dt(xe)?this.element.classList.add(nn(void 0,"nol")):(this.element.classList.remove(nn(void 0,"nol")),function(pe){for(;pe.childNodes.length>0;)pe.removeChild(pe.childNodes[0])}(U),U.appendChild(function(pe,mt){const $t=pe.createDocumentFragment();return mt.split(`
`).map(gi=>pe.createTextNode(gi)).forEach((gi,ur)=>{ur>0&&$t.appendChild(pe.createElement("br")),$t.appendChild(gi)}),$t}(y,xe)))}),this.element.appendChild(U),this.labelElement=U;const J=y.createElement("div");J.classList.add(nn("v")),this.element.appendChild(J),this.valueElement=J}}class Ga extends Ie{constructor(y,M){const U=M.valueController.viewProps;super(Object.assign(Object.assign({},M),{view:new $r(y,{props:M.props,viewProps:U}),viewProps:U})),this.props=M.props,this.valueController=M.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const No={id:"button",type:"blade",accept(L){const y=It,M=xt(L,{title:y.required.string,view:y.required.constant("button"),label:y.optional.string});return M?{params:M}:null},controller(L){return new Ga(L.document,{blade:L.blade,props:_e.fromObject({label:L.params.label}),valueController:new Ne(L.document,{props:_e.fromObject({title:L.params.title}),viewProps:L.viewProps})})},api(L){return L.controller instanceof Ga&&L.controller.valueController instanceof Ne?new Ce(L.controller):null}};class hn extends Ie{constructor(y){super(y),this.value=y.value}}function ae(){return new _e({positions:he([],{equals:At})})}class Gr extends _e{constructor(y){super(y)}static create(y){const M={completed:!0,expanded:y,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},U=_e.createCore(M);return new Gr(U)}get styleExpanded(){var y;return(y=this.get("temporaryExpanded"))!==null&&y!==void 0?y:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const y=this.get("expandedHeight");return this.get("shouldFixHeight")&&!dt(y)?`${y}px`:"auto"}bindExpandedClass(y,M){const U=()=>{this.styleExpanded?y.classList.add(M):y.classList.remove(M)};Ue(this,"expanded",U),Ue(this,"temporaryExpanded",U)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function An(L,y){y.style.height=L.styleHeight}function ps(L,y){L.value("expanded").emitter.on("beforechange",()=>{if(L.set("completed",!1),dt(L.get("expandedHeight"))){const M=function(U,J){let xe=0;return function(pe,mt){const $t=pe.style.transition;pe.style.transition="none",mt(),pe.style.transition=$t}(J,()=>{U.set("expandedHeight",null),U.set("temporaryExpanded",!0),Wt(J),xe=J.clientHeight,U.set("temporaryExpanded",null),Wt(J)}),xe}(L,y);M>0&&L.set("expandedHeight",M)}L.set("shouldFixHeight",!0),Wt(y)}),L.emitter.on("change",()=>{An(L,y)}),An(L,y),y.addEventListener("transitionend",M=>{M.propertyName==="height"&&L.cleanUpTransition()})}class cr extends Ke{constructor(y,M){super(y),this.rackApi_=M}}class br{constructor(y){this.emitter=new vt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=y}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(y){for(const M of this.allItems())if(y(M))return M;return null}includes(y){return this.cache_.has(y)}add(y,M){if(this.includes(y))throw Re.shouldNeverHappen();const U=M!==void 0?M:this.items_.length;this.items_.splice(U,0,y),this.cache_.add(y);const J=this.extract_(y);J&&(J.emitter.on("add",this.onSubListAdd_),J.emitter.on("remove",this.onSubListRemove_),J.allItems().forEach(xe=>{this.cache_.add(xe)})),this.emitter.emit("add",{index:U,item:y,root:this,target:this})}remove(y){const M=this.items_.indexOf(y);if(M<0)return;this.items_.splice(M,1),this.cache_.delete(y);const U=this.extract_(y);U&&(U.emitter.off("add",this.onSubListAdd_),U.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:M,item:y,root:this,target:this})}onSubListAdd_(y){this.cache_.add(y.item),this.emitter.emit("add",{index:y.index,item:y.item,root:this,target:y.target})}onSubListRemove_(y){this.cache_.delete(y.item),this.emitter.emit("remove",{index:y.index,item:y.item,root:this,target:y.target})}}class fs extends Ke{constructor(y){super(y),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new vt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(y){const M=y.sender.target.read();this.emitter_.emit("change",{event:new ut(this,M,this.controller_.binding.target.presetKey,y.options.last)})}}class $n extends Ga{constructor(y,M){super(y,M),this.binding=M.binding}}class dn extends Ke{constructor(y){super(y),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new vt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(y){const M=y.sender.target.read();this.emitter_.emit("update",{event:new tt(this,M,this.controller_.binding.target.presetKey)})}}class Ha extends Ga{constructor(y,M){super(y,M),this.binding=M.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function ch(L){return L instanceof pn?L.apiSet_:L instanceof cr?L.rackApi_.apiSet_:null}function vl(L,y){const M=L.find(U=>U.controller_===y);if(!M)throw Re.shouldNeverHappen();return M}function xd(L,y,M){if(!lt.isBindable(L))throw Re.notBindable();return new lt(L,y,M)}class pn extends Ke{constructor(y,M){super(y),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new vt,this.apiSet_=new br(ch),this.pool_=M;const U=this.controller_.rack;U.emitter.on("add",this.onRackAdd_),U.emitter.on("remove",this.onRackRemove_),U.emitter.on("inputchange",this.onRackInputChange_),U.emitter.on("monitorupdate",this.onRackMonitorUpdate_),U.children.forEach(J=>{this.setUpApi_(J)})}get children(){return this.controller_.rack.children.map(y=>vl(this.apiSet_,y))}addInput(y,M,U){const J=U??{},xe=this.controller_.view.element.ownerDocument,pe=this.pool_.createInput(xe,xd(y,M,J.presetKey),J),mt=new fs(pe);return this.add(mt,J.index)}addMonitor(y,M,U){const J=U??{},xe=this.controller_.view.element.ownerDocument,pe=this.pool_.createMonitor(xe,xd(y,M),J),mt=new dn(pe);return this.add(mt,J.index)}addFolder(y){return function(M,U){return M.addBlade(Object.assign(Object.assign({},U),{view:"folder"}))}(this,y)}addButton(y){return function(M,U){return M.addBlade(Object.assign(Object.assign({},U),{view:"button"}))}(this,y)}addSeparator(y){return function(M,U){const J=U??{};return M.addBlade(Object.assign(Object.assign({},J),{view:"separator"}))}(this,y)}addTab(y){return function(M,U){return M.addBlade(Object.assign(Object.assign({},U),{view:"tab"}))}(this,y)}add(y,M){this.controller_.rack.add(y.controller_,M);const U=this.apiSet_.find(J=>J.controller_===y.controller_);return U&&this.apiSet_.remove(U),this.apiSet_.add(y),y}remove(y){this.controller_.rack.remove(y.controller_)}addBlade(y){const M=this.controller_.view.element.ownerDocument,U=this.pool_.createBlade(M,y),J=this.pool_.createBladeApi(U);return this.add(J,y.index)}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}setUpApi_(y){this.apiSet_.find(M=>M.controller_===y)||this.apiSet_.add(this.pool_.createBladeApi(y))}onRackAdd_(y){this.setUpApi_(y.bladeController)}onRackRemove_(y){if(y.isRoot){const M=vl(this.apiSet_,y.bladeController);this.apiSet_.remove(M)}}onRackInputChange_(y){const M=y.bladeController;if(M instanceof $n){const U=vl(this.apiSet_,M),J=M.binding;this.emitter_.emit("change",{event:new ut(U,J.target.read(),J.target.presetKey,y.options.last)})}else if(M instanceof hn){const U=vl(this.apiSet_,M);this.emitter_.emit("change",{event:new ut(U,M.value.rawValue,void 0,y.options.last)})}}onRackMonitorUpdate_(y){if(!(y.bladeController instanceof Ha))throw Re.shouldNeverHappen();const M=vl(this.apiSet_,y.bladeController),U=y.bladeController.binding;this.emitter_.emit("update",{event:new tt(M,U.target.read(),U.target.presetKey)})}}class uh extends cr{constructor(y,M){super(y,new pn(y.rackController,M)),this.emitter_=new vt,this.controller_.foldable.value("expanded").emitter.on("change",U=>{this.emitter_.emit("fold",{event:new _t(this,U.sender.rawValue)})}),this.rackApi_.on("change",U=>{this.emitter_.emit("change",{event:U})}),this.rackApi_.on("update",U=>{this.emitter_.emit("update",{event:U})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(y){this.controller_.foldable.set("expanded",y)}get title(){return this.controller_.props.get("title")}set title(y){this.controller_.props.set("title",y)}get children(){return this.rackApi_.children}addInput(y,M,U){return this.rackApi_.addInput(y,M,U)}addMonitor(y,M,U){return this.rackApi_.addMonitor(y,M,U)}addFolder(y){return this.rackApi_.addFolder(y)}addButton(y){return this.rackApi_.addButton(y)}addSeparator(y){return this.rackApi_.addSeparator(y)}addTab(y){return this.rackApi_.addTab(y)}add(y,M){return this.rackApi_.add(y,M)}remove(y){this.rackApi_.remove(y)}addBlade(y){return this.rackApi_.addBlade(y)}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}}class fo extends Ie{constructor(y){super({blade:y.blade,view:y.view,viewProps:y.rackController.viewProps}),this.rackController=y.rackController}}class _l{constructor(y,M){const U=Fe(M.viewName);this.element=y.createElement("div"),this.element.classList.add(U()),M.viewProps.bindClassModifiers(this.element)}}function Jp(L){return L instanceof ms?L.rack:L instanceof fo?L.rackController.rack:null}function yl(L){const y=Jp(L);return y?y.bcSet_:null}class $p{constructor(y){var M,U;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new vt,this.blade_=(M=y.blade)!==null&&M!==void 0?M:null,(U=this.blade_)===null||U===void 0||U.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=y.viewProps,this.bcSet_=new br(yl),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(y,M){var U;(U=y.parent)===null||U===void 0||U.remove(y),Mt(y,"parent")?y.parent=this:(y.parent_=this,jt({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(y,M)}remove(y){Mt(y,"parent")?y.parent=null:(y.parent_=null,jt({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(y)}find(y){return this.bcSet_.allItems().filter(M=>M instanceof y)}onSetAdd_(y){this.updatePositions_();const M=y.target===y.root;if(this.emitter.emit("add",{bladeController:y.item,index:y.index,isRoot:M,sender:this}),!M)return;const U=y.item;if(U.viewProps.emitter.on("change",this.onChildViewPropsChange_),U.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),U.viewProps.handleDispose(this.onChildDispose_),U instanceof $n)U.binding.emitter.on("change",this.onChildInputChange_);else if(U instanceof Ha)U.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(U instanceof hn)U.value.emitter.on("change",this.onChildValueChange_);else{const J=Jp(U);if(J){const xe=J.emitter;xe.on("layout",this.onDescendantLayout_),xe.on("inputchange",this.onDescendantInputChange_),xe.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(y){this.updatePositions_();const M=y.target===y.root;if(this.emitter.emit("remove",{bladeController:y.item,isRoot:M,sender:this}),!M)return;const U=y.item;if(U instanceof $n)U.binding.emitter.off("change",this.onChildInputChange_);else if(U instanceof Ha)U.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(U instanceof hn)U.value.emitter.off("change",this.onChildValueChange_);else{const J=Jp(U);if(J){const xe=J.emitter;xe.off("layout",this.onDescendantLayout_),xe.off("inputchange",this.onDescendantInputChange_),xe.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const y=this.bcSet_.items.filter(J=>!J.viewProps.get("hidden")),M=y[0],U=y[y.length-1];this.bcSet_.items.forEach(J=>{const xe=[];J===M&&(xe.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||xe.push("veryfirst")),J===U&&(xe.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||xe.push("verylast")),J.blade.set("positions",xe)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(y){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(y=>y.viewProps.get("disposed")).forEach(y=>{this.bcSet_.remove(y)})}onChildInputChange_(y){const M=function(U,J){for(let xe=0;xe<U.length;xe++){const pe=U[xe];if(pe instanceof $n&&pe.binding===J)return pe}return null}(this.find($n),y.sender);if(!M)throw Re.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:M,options:y.options,sender:this})}onChildMonitorUpdate_(y){const M=function(U,J){for(let xe=0;xe<U.length;xe++){const pe=U[xe];if(pe instanceof Ha&&pe.binding===J)return pe}return null}(this.find(Ha),y.sender);if(!M)throw Re.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:M,sender:this})}onChildValueChange_(y){const M=function(U,J){for(let xe=0;xe<U.length;xe++){const pe=U[xe];if(pe instanceof hn&&pe.value===J)return pe}return null}(this.find(hn),y.sender);if(!M)throw Re.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:M,options:y.options,sender:this})}onDescendantLayout_(y){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(y){this.emitter.emit("inputchange",{bladeController:y.bladeController,options:y.options,sender:this})}onDescendantMonitorUpdate_(y){this.emitter.emit("monitorupdate",{bladeController:y.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ms extends Ie{constructor(y,M){super(Object.assign(Object.assign({},M),{view:new _l(y,{viewName:"brk",viewProps:M.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const U=new $p({blade:M.root?void 0:M.blade,viewProps:M.viewProps});U.emitter.on("add",this.onRackAdd_),U.emitter.on("remove",this.onRackRemove_),this.rack=U,this.viewProps.handleDispose(()=>{for(let J=this.rack.children.length-1;J>=0;J--)this.rack.children[J].viewProps.set("disposed",!0)})}onRackAdd_(y){y.isRoot&&Lr(this.view.element,y.bladeController.view.element,y.index)}onRackRemove_(y){y.isRoot&&zr(y.bladeController.view.element)}}const hu=Fe("cnt");class vm{constructor(y,M){var U;this.className_=Fe((U=M.viewName)!==null&&U!==void 0?U:"fld"),this.element=y.createElement("div"),this.element.classList.add(this.className_(),hu()),M.viewProps.bindClassModifiers(this.element),this.foldable_=M.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ue(this.foldable_,"completed",$e(this.element,this.className_(void 0,"cpl")));const J=y.createElement("button");J.classList.add(this.className_("b")),Ue(M.props,"title",gi=>{dt(gi)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),M.viewProps.bindDisabled(J),this.element.appendChild(J),this.buttonElement=J;const xe=y.createElement("div");xe.classList.add(this.className_("i")),this.element.appendChild(xe);const pe=y.createElement("div");pe.classList.add(this.className_("t")),Z(M.props.value("title"),pe),this.buttonElement.appendChild(pe),this.titleElement=pe;const mt=y.createElement("div");mt.classList.add(this.className_("m")),this.buttonElement.appendChild(mt);const $t=M.containerElement;$t.classList.add(this.className_("c")),this.element.appendChild($t),this.containerElement=$t}}class Fo extends fo{constructor(y,M){var U;const J=Gr.create((U=M.expanded)===null||U===void 0||U),xe=new ms(y,{blade:M.blade,root:M.root,viewProps:M.viewProps});super(Object.assign(Object.assign({},M),{rackController:xe,view:new vm(y,{containerElement:xe.view.element,foldable:J,props:M.props,viewName:M.root?"rot":void 0,viewProps:M.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=M.props,this.foldable=J,ps(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const bl={id:"folder",type:"blade",accept(L){const y=It,M=xt(L,{title:y.required.string,view:y.required.constant("folder"),expanded:y.optional.boolean});return M?{params:M}:null},controller(L){return new Fo(L.document,{blade:L.blade,expanded:L.params.expanded,props:_e.fromObject({title:L.params.title}),viewProps:L.viewProps})},api(L){return L.controller instanceof Fo?new uh(L.controller,L.pool):null}};class sn extends hn{constructor(y,M){const U=M.valueController.viewProps;super(Object.assign(Object.assign({},M),{value:M.valueController.value,view:new $r(y,{props:M.props,viewProps:U}),viewProps:U})),this.props=M.props,this.valueController=M.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class hh extends Ke{}const ef=Fe("spr");class Wn{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(ef()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("hr");U.classList.add(ef("r")),this.element.appendChild(U)}}class dh extends Ie{constructor(y,M){super(Object.assign(Object.assign({},M),{view:new Wn(y,{viewProps:M.viewProps})}))}}const en={id:"separator",type:"blade",accept(L){const y=xt(L,{view:It.required.constant("separator")});return y?{params:y}:null},controller(L){return new dh(L.document,{blade:L.blade,viewProps:L.viewProps})},api(L){return L.controller instanceof dh?new hh(L.controller):null}},Ot=Fe("tbi");class ql{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(Ot()),M.viewProps.bindClassModifiers(this.element),Ue(M.props,"selected",xe=>{xe?this.element.classList.add(Ot(void 0,"sel")):this.element.classList.remove(Ot(void 0,"sel"))});const U=y.createElement("button");U.classList.add(Ot("b")),M.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U;const J=y.createElement("div");J.classList.add(Ot("t")),Z(M.props.value("title"),J),this.buttonElement.appendChild(J),this.titleElement=J}}class ai{constructor(y,M){this.emitter=new vt,this.onClick_=this.onClick_.bind(this),this.props=M.props,this.viewProps=M.viewProps,this.view=new ql(y,{props:M.props,viewProps:M.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Mn{constructor(y,M){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ai(y,{props:M.itemProps,viewProps:Qt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ms(y,{blade:ae(),viewProps:Qt.create()}),this.props=M.props,Ue(this.props,"selected",U=>{this.itemController.props.set("selected",U),this.contentController.viewProps.set("hidden",!U)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Fs{constructor(y,M){this.controller_=y,this.rackApi_=M}get title(){var y;return(y=this.controller_.itemController.props.get("title"))!==null&&y!==void 0?y:""}set title(y){this.controller_.itemController.props.set("title",y)}get selected(){return this.controller_.props.get("selected")}set selected(y){this.controller_.props.set("selected",y)}get children(){return this.rackApi_.children}addButton(y){return this.rackApi_.addButton(y)}addFolder(y){return this.rackApi_.addFolder(y)}addSeparator(y){return this.rackApi_.addSeparator(y)}addTab(y){return this.rackApi_.addTab(y)}add(y,M){this.rackApi_.add(y,M)}remove(y){this.rackApi_.remove(y)}addInput(y,M,U){return this.rackApi_.addInput(y,M,U)}addMonitor(y,M,U){return this.rackApi_.addMonitor(y,M,U)}addBlade(y){return this.rackApi_.addBlade(y)}}class Xi extends cr{constructor(y,M){super(y,new pn(y.rackController,M)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new vt,this.pageApiMap_=new Map,this.rackApi_.on("change",U=>{this.emitter_.emit("change",{event:U})}),this.rackApi_.on("update",U=>{this.emitter_.emit("update",{event:U})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(U=>{this.setUpPageApi_(U)})}get pages(){return this.controller_.pageSet.items.map(y=>{const M=this.pageApiMap_.get(y);if(!M)throw Re.shouldNeverHappen();return M})}addPage(y){const M=this.controller_.view.element.ownerDocument,U=new Mn(M,{itemProps:_e.fromObject({selected:!1,title:y.title}),props:_e.fromObject({selected:!1})});this.controller_.add(U,y.index);const J=this.pageApiMap_.get(U);if(!J)throw Re.shouldNeverHappen();return J}removePage(y){this.controller_.remove(y)}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}setUpPageApi_(y){const M=this.rackApi_.apiSet_.find(J=>J.controller_===y.contentController);if(!M)throw Re.shouldNeverHappen();const U=new Fs(y,M);this.pageApiMap_.set(y,U)}onPageAdd_(y){this.setUpPageApi_(y.item)}onPageRemove_(y){if(!this.pageApiMap_.get(y.item))throw Re.shouldNeverHappen();this.pageApiMap_.delete(y.item)}onSelect_(y){this.emitter_.emit("select",{event:new it(this,y.rawValue)})}}class Ci{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=he(!0),this.selectedIndex=he(-1),this.items_=[]}add(y,M){const U=M??this.items_.length;this.items_.splice(U,0,y),y.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(y){const M=this.items_.indexOf(y);M<0||(this.items_.splice(M,1),y.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const y=this.items_.findIndex(M=>M.rawValue);y<0?(this.items_.forEach((M,U)=>{M.rawValue=U===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((M,U)=>{M.rawValue=U===y}),this.selectedIndex.rawValue=y),this.empty.rawValue=!1}onItemSelectedChange_(y){if(y.rawValue){const M=this.items_.findIndex(U=>U===y.sender);this.items_.forEach((U,J)=>{U.rawValue=J===M}),this.selectedIndex.rawValue=M}else this.keepSelection_()}}const ea=Fe("tab");class du{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(ea(),hu()),M.viewProps.bindClassModifiers(this.element),Ft(M.empty,$e(this.element,ea(void 0,"nop")));const U=y.createElement("div");U.classList.add(ea("t")),this.element.appendChild(U),this.itemsElement=U;const J=y.createElement("div");J.classList.add(ea("i")),this.element.appendChild(J);const xe=M.contentsElement;xe.classList.add(ea("c")),this.element.appendChild(xe),this.contentsElement=xe}}class Qa extends fo{constructor(y,M){const U=new ms(y,{blade:M.blade,viewProps:M.viewProps}),J=new Ci;super({blade:M.blade,rackController:U,view:new du(y,{contentsElement:U.view.element,empty:J.empty,viewProps:M.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new br(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=J}get pageSet(){return this.pageSet_}add(y,M){this.pageSet_.add(y,M)}remove(y){this.pageSet_.remove(this.pageSet_.items[y])}onPageAdd_(y){const M=y.item;Lr(this.view.itemsElement,M.itemController.view.element,y.index),M.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(M.contentController,y.index),this.tab.add(M.props.value("selected"))}onPageRemove_(y){const M=y.item;zr(M.itemController.view.element),M.itemController.viewProps.set("parent",null),this.rackController.rack.remove(M.contentController),this.tab.remove(M.props.value("selected"))}}const Wa={id:"tab",type:"blade",accept(L){const y=It,M=xt(L,{pages:y.required.array(y.required.object({title:y.required.string})),view:y.required.constant("tab")});return M&&M.pages.length!==0?{params:M}:null},controller(L){const y=new Qa(L.document,{blade:L.blade,viewProps:L.viewProps});return L.params.pages.forEach(M=>{const U=new Mn(L.document,{itemProps:_e.fromObject({selected:!1,title:M.title}),props:_e.fromObject({selected:!1})});y.add(U)}),y},api(L){return L.controller instanceof Qa?new Xi(L.controller,L.pool):null}};class zi{constructor(){this.disabled=!1,this.emitter=new vt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Lc{constructor(y,M){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=y,this.emitter=new vt,this.interval_=M,this.setTimer_()}get disabled(){return this.disabled_}set disabled(y){this.disabled_=y,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const y=this.doc_.defaultView;y&&y.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const y=this.doc_.defaultView;y&&(this.timerId_=y.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ed{constructor(y){this.onValueChange_=this.onValueChange_.bind(this),this.reader=y.reader,this.writer=y.writer,this.emitter=new vt,this.value=y.value,this.value.emitter.on("change",this.onValueChange_),this.target=y.target,this.read()}read(){const y=this.target.read();y!==void 0&&(this.value.rawValue=this.reader(y))}write_(y){this.writer(this.target,y)}onValueChange_(y){this.write_(y.rawValue),this.emitter.emit("change",{options:y.options,rawValue:y.rawValue,sender:this})}}function Sd(L,y){for(;L.length<y;)L.push(void 0)}function Cd(L){const y=[];return Sd(y,L),he(y)}function tf(L){const y=L.indexOf(void 0);return y<0?L:L.slice(0,y)}class _m{constructor(y){this.onTick_=this.onTick_.bind(this),this.reader_=y.reader,this.target=y.target,this.emitter=new vt,this.value=y.value,this.ticker=y.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const y=this.target.read();if(y===void 0)return;const M=this.value.rawValue,U=this.reader_(y);this.value.rawValue=function(J,xe){const pe=[...tf(J),xe];return pe.length>J.length?pe.splice(0,pe.length-J.length):Sd(pe,J.length),pe}(M,U),this.emitter.emit("update",{rawValue:U,sender:this})}onTick_(y){this.read()}}class Br{constructor(y){this.constraints=y}constrain(y){return this.constraints.reduce((M,U)=>U.constrain(M),y)}}function gr(L,y){if(L instanceof y)return L;if(L instanceof Br){const M=L.constraints.reduce((U,J)=>U||(J instanceof y?J:null),null);if(M)return M}return null}class Xa{constructor(y){this.values=_e.fromObject({max:y.max,min:y.min})}constrain(y){const M=this.values.get("max"),U=this.values.get("min");return Math.min(Math.max(y,U),M)}}class Cs{constructor(y){this.values=_e.fromObject({options:y})}get options(){return this.values.get("options")}constrain(y){const M=this.values.get("options");return M.length===0||M.filter(U=>U.value===y).length>0?y:M[0].value}}class jo{constructor(y){this.values=_e.fromObject({max:y.max,min:y.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(y){const M=this.values.get("max"),U=this.values.get("min");let J=y;return dt(U)||(J=Math.max(J,U)),dt(M)||(J=Math.min(J,M)),J}}class Xn{constructor(y,M=0){this.step=y,this.origin=M}constrain(y){const M=this.origin%this.step;return M+Math.round((y-M)/this.step)*this.step}}const Mi=Fe("lst");class es{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),this.props_=M.props,this.element=y.createElement("div"),this.element.classList.add(Mi()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("select");U.classList.add(Mi("s")),Ue(this.props_,"options",xe=>{Vr(U),xe.forEach((pe,mt)=>{const $t=y.createElement("option");$t.dataset.index=String(mt),$t.textContent=pe.text,$t.value=String(pe.value),U.appendChild($t)})}),M.viewProps.bindDisabled(U),this.element.appendChild(U),this.selectElement=U;const J=y.createElement("div");J.classList.add(Mi("m")),J.appendChild(Oi(y,"dropdown")),this.element.appendChild(J),M.value.emitter.on("change",this.onValueChange_),this.value_=M.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class kc{constructor(y,M){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=M.props,this.value=M.value,this.viewProps=M.viewProps,this.view=new es(y,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(y){const M=y.currentTarget.selectedOptions.item(0);if(!M)return;const U=Number(M.dataset.index);this.value.rawValue=this.props.get("options")[U].value}}const Yl=Fe("pop");class rf{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(Yl()),M.viewProps.bindClassModifiers(this.element),Ft(M.shows,$e(this.element,Yl(void 0,"v")))}}class Kl{constructor(y,M){this.shows=he(!1),this.viewProps=M.viewProps,this.view=new rf(y,{shows:this.shows,viewProps:this.viewProps})}}const On=Fe("txt");class pu{constructor(y,M){this.onChange_=this.onChange_.bind(this),this.element=y.createElement("div"),this.element.classList.add(On()),M.viewProps.bindClassModifiers(this.element),this.props_=M.props,this.props_.emitter.on("change",this.onChange_);const U=y.createElement("input");U.classList.add(On("i")),U.type="text",M.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,M.value.emitter.on("change",this.onChange_),this.value_=M.value,this.refresh()}refresh(){const y=this.props_.get("formatter");this.inputElement.value=y(this.value_.rawValue)}onChange_(){this.refresh()}}class fu{constructor(y,M){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=M.parser,this.props=M.props,this.value=M.value,this.viewProps=M.viewProps,this.view=new pu(y,{props:M.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(y){const M=y.currentTarget.value,U=this.parser_(M);dt(U)||(this.value.rawValue=U),this.view.refresh()}}function nf(L){return L!=="false"&&!!L}function ha(L){return function(y){return String(y)}(L)}class Si{constructor(y){this.text=y}evaluate(){return Number(this.text)}toString(){return this.text}}const Zl={"**":(L,y)=>Math.pow(L,y),"*":(L,y)=>L*y,"/":(L,y)=>L/y,"%":(L,y)=>L%y,"+":(L,y)=>L+y,"-":(L,y)=>L-y,"<<":(L,y)=>L<<y,">>":(L,y)=>L>>y,">>>":(L,y)=>L>>>y,"&":(L,y)=>L&y,"^":(L,y)=>L^y,"|":(L,y)=>L|y};class qa{constructor(y,M,U){this.left=M,this.operator=y,this.right=U}evaluate(){const y=Zl[this.operator];if(!y)throw new Error(`unexpected binary operator: '${this.operator}`);return y(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const sf={"+":L=>L,"-":L=>-L,"~":L=>~L};class vr{constructor(y,M){this.operator=y,this.expression=M}evaluate(){const y=sf[this.operator];if(!y)throw new Error(`unexpected unary operator: '${this.operator}`);return y(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function af(L){return(y,M)=>{for(let U=0;U<L.length;U++){const J=L[U](y,M);if(J!=="")return J}return""}}function mu(L,y){var M;const U=L.substr(y).match(/^\s+/);return(M=U&&U[0])!==null&&M!==void 0?M:""}function Al(L,y){var M;const U=L.substr(y).match(/^[0-9]+/);return(M=U&&U[0])!==null&&M!==void 0?M:""}function Uc(L,y){const M=L.substr(y,1);if(y+=1,M.toLowerCase()!=="e")return"";const U=function(J,xe){const pe=Al(J,xe);if(pe!=="")return pe;const mt=J.substr(xe,1);if(mt!=="-"&&mt!=="+")return"";const $t=Al(J,xe+=1);return $t===""?"":mt+$t}(L,y);return U===""?"":M+U}function Md(L,y){const M=L.substr(y,1);if(M==="0")return M;const U=function(J,xe){const pe=J.substr(xe,1);return pe.match(/^[1-9]$/)?pe:""}(L,y);return y+=U.length,U===""?"":U+Al(L,y)}const Jl=af([function(L,y){const M=Md(L,y);if(y+=M.length,M==="")return"";const U=L.substr(y,1);if(y+=U.length,U!==".")return"";const J=Al(L,y);return M+U+J+Uc(L,y+=J.length)},function(L,y){const M=L.substr(y,1);if(y+=M.length,M!==".")return"";const U=Al(L,y);return y+=U.length,U===""?"":M+U+Uc(L,y)},function(L,y){const M=Md(L,y);return y+=M.length,M===""?"":M+Uc(L,y)}]),$l=af([function(L,y){const M=L.substr(y,2);if(y+=M.length,M.toLowerCase()!=="0b")return"";const U=function(J,xe){var pe;const mt=J.substr(xe).match(/^[01]+/);return(pe=mt&&mt[0])!==null&&pe!==void 0?pe:""}(L,y);return U===""?"":M+U},function(L,y){const M=L.substr(y,2);if(y+=M.length,M.toLowerCase()!=="0o")return"";const U=function(J,xe){var pe;const mt=J.substr(xe).match(/^[0-7]+/);return(pe=mt&&mt[0])!==null&&pe!==void 0?pe:""}(L,y);return U===""?"":M+U},function(L,y){const M=L.substr(y,2);if(y+=M.length,M.toLowerCase()!=="0x")return"";const U=function(J,xe){var pe;const mt=J.substr(xe).match(/^[0-9a-f]+/i);return(pe=mt&&mt[0])!==null&&pe!==void 0?pe:""}(L,y);return U===""?"":M+U}]),gu=af([$l,Jl]);function js(L,y){var M;return(M=function(U,J){const xe=gu(U,J);return J+=xe.length,xe===""?null:{evaluable:new Si(xe),cursor:J}}(L,y))!==null&&M!==void 0?M:function(U,J){const xe=U.substr(J,1);if(J+=xe.length,xe!=="(")return null;const pe=Id(U,J);if(!pe)return null;J=pe.cursor,J+=mu(U,J).length;const mt=U.substr(J,1);return J+=mt.length,mt!==")"?null:{evaluable:pe.evaluable,cursor:J}}(L,y)}function Td(L,y,M){M+=mu(y,M).length;const U=L.filter(J=>y.startsWith(J,M))[0];return U?(M+=U.length,{cursor:M+=mu(y,M).length,operator:U}):null}const wl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((L,y)=>function(M,U){return(J,xe)=>{const pe=M(J,xe);if(!pe)return null;xe=pe.cursor;let mt=pe.evaluable;for(;;){const $t=Td(U,J,xe);if(!$t)break;xe=$t.cursor;const gi=M(J,xe);if(!gi)return null;xe=gi.cursor,mt=new qa($t.operator,mt,gi.evaluable)}return mt?{cursor:xe,evaluable:mt}:null}}(L,y),function L(y,M){const U=js(y,M);if(U)return U;const J=y.substr(M,1);if(M+=J.length,J!=="+"&&J!=="-"&&J!=="~")return null;const xe=L(y,M);return xe?{cursor:M=xe.cursor,evaluable:new vr(J,xe.evaluable)}:null});function Id(L,y){return y+=mu(L,y).length,wl(L,y)}function zo(L){var y;const M=function(U){const J=Id(U,0);return J?J.cursor+mu(U,J.cursor).length!==U.length?null:J.evaluable:null}(L);return(y=M==null?void 0:M.evaluate())!==null&&y!==void 0?y:null}function Pd(L){if(typeof L=="number")return L;if(typeof L=="string"){const y=zo(L);if(!dt(y))return y}return 0}function xl(L){return String(L)}function gs(L){return y=>y.toFixed(Math.max(Math.min(L,20),0))}const Tn=gs(0);function Ca(L){return Tn(L)+"%"}function of(L){return String(L)}function Ya(L){return L}function Yi({primary:L,secondary:y,forward:M,backward:U}){let J=!1;function xe(pe){J||(J=!0,pe(),J=!1)}L.emitter.on("change",pe=>{xe(()=>{y.setRawValue(M(L,y),pe.options)})}),y.emitter.on("change",pe=>{xe(()=>{L.setRawValue(U(L,y),pe.options)}),xe(()=>{y.setRawValue(M(L,y),pe.options)})}),xe(()=>{y.setRawValue(M(L,y),{forceEmit:!1,last:!0})})}function an(L,y){const M=L*(y.altKey?.1:1)*(y.shiftKey?10:1);return y.upKey?+M:y.downKey?-M:0}function Nc(L){return{altKey:L.altKey,downKey:L.key==="ArrowDown",shiftKey:L.shiftKey,upKey:L.key==="ArrowUp"}}function kr(L){return{altKey:L.altKey,downKey:L.key==="ArrowLeft",shiftKey:L.shiftKey,upKey:L.key==="ArrowRight"}}function vv(L){return function(y){return y==="ArrowUp"||y==="ArrowDown"}(L)||L==="ArrowLeft"||L==="ArrowRight"}function Ar(L,y){var M,U;const J=y.ownerDocument.defaultView,xe=y.getBoundingClientRect();return{x:L.pageX-(((M=J&&J.scrollX)!==null&&M!==void 0?M:0)+xe.left),y:L.pageY-(((U=J&&J.scrollY)!==null&&U!==void 0?U:0)+xe.top)}}class vu{constructor(y){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=y,this.emitter=new vt,y.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),y.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),y.addEventListener("touchend",this.onTouchEnd_),y.addEventListener("mousedown",this.onMouseDown_)}computePosition_(y){const M=this.elem_.getBoundingClientRect();return{bounds:{width:M.width,height:M.height},point:y?{x:y.x,y:y.y}:null}}onMouseDown_(y){var M;y.preventDefault(),(M=y.currentTarget)===null||M===void 0||M.focus();const U=this.elem_.ownerDocument;U.addEventListener("mousemove",this.onDocumentMouseMove_),U.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:y.altKey,data:this.computePosition_(Ar(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onDocumentMouseMove_(y){this.emitter.emit("move",{altKey:y.altKey,data:this.computePosition_(Ar(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onDocumentMouseUp_(y){const M=this.elem_.ownerDocument;M.removeEventListener("mousemove",this.onDocumentMouseMove_),M.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:y.altKey,data:this.computePosition_(Ar(y,this.elem_)),sender:this,shiftKey:y.shiftKey})}onTouchStart_(y){y.preventDefault();const M=y.targetTouches.item(0),U=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:y.altKey,data:this.computePosition_(M?{x:M.clientX-U.left,y:M.clientY-U.top}:void 0),sender:this,shiftKey:y.shiftKey}),this.lastTouch_=M}onTouchMove_(y){const M=y.targetTouches.item(0),U=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:y.altKey,data:this.computePosition_(M?{x:M.clientX-U.left,y:M.clientY-U.top}:void 0),sender:this,shiftKey:y.shiftKey}),this.lastTouch_=M}onTouchEnd_(y){var M;const U=(M=y.targetTouches.item(0))!==null&&M!==void 0?M:this.lastTouch_,J=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:y.altKey,data:this.computePosition_(U?{x:U.clientX-J.left,y:U.clientY-J.top}:void 0),sender:this,shiftKey:y.shiftKey})}}function wn(L,y,M,U,J){return U+(L-y)/(M-y)*(J-U)}function _v(L){return String(L.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function vs(L,y,M){return Math.min(Math.max(L,y),M)}function yv(L,y){return(L%y+y)%y}const mo=Fe("txt");class L_{constructor(y,M){this.onChange_=this.onChange_.bind(this),this.props_=M.props,this.props_.emitter.on("change",this.onChange_),this.element=y.createElement("div"),this.element.classList.add(mo(),mo(void 0,"num")),M.arrayPosition&&this.element.classList.add(mo(void 0,M.arrayPosition)),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("input");U.classList.add(mo("i")),U.type="text",M.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=M.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(mo()),this.inputElement.classList.add(mo("i"));const J=y.createElement("div");J.classList.add(mo("k")),this.element.appendChild(J),this.knobElement=J;const xe=y.createElementNS(We,"svg");xe.classList.add(mo("g")),this.knobElement.appendChild(xe);const pe=y.createElementNS(We,"path");pe.classList.add(mo("gb")),xe.appendChild(pe),this.guideBodyElem_=pe;const mt=y.createElementNS(We,"path");mt.classList.add(mo("gh")),xe.appendChild(mt),this.guideHeadElem_=mt;const $t=y.createElement("div");$t.classList.add(Fe("tt")()),this.knobElement.appendChild($t),this.tooltipElem_=$t,M.value.emitter.on("change",this.onChange_),this.value=M.value,this.refresh()}onDraggingChange_(y){if(y.rawValue===null)return void this.element.classList.remove(mo(void 0,"drg"));this.element.classList.add(mo(void 0,"drg"));const M=y.rawValue/this.props_.get("draggingScale"),U=M+(M>0?-1:M<0?1:0),J=vs(-U,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${U+J},0 L${U},4 L${U+J},8`,`M ${M},-1 L${M},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${M},4`);const xe=this.props_.get("formatter");this.tooltipElem_.textContent=xe(this.value.rawValue),this.tooltipElem_.style.left=`${M}px`}refresh(){const y=this.props_.get("formatter");this.inputElement.value=y(this.value.rawValue)}onChange_(){this.refresh()}}class Rd{constructor(y,M){var U;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=M.baseStep,this.parser_=M.parser,this.props=M.props,this.sliderProps_=(U=M.sliderProps)!==null&&U!==void 0?U:null,this.value=M.value,this.viewProps=M.viewProps,this.dragging_=he(null),this.view=new L_(y,{arrayPosition:M.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const J=new vu(this.view.knobElement);J.emitter.on("down",this.onPointerDown_),J.emitter.on("move",this.onPointerMove_),J.emitter.on("up",this.onPointerUp_)}constrainValue_(y){var M,U;const J=(M=this.sliderProps_)===null||M===void 0?void 0:M.get("minValue"),xe=(U=this.sliderProps_)===null||U===void 0?void 0:U.get("maxValue");let pe=y;return J!==void 0&&(pe=Math.max(pe,J)),xe!==void 0&&(pe=Math.min(pe,xe)),pe}onInputChange_(y){const M=y.currentTarget.value,U=this.parser_(M);dt(U)||(this.value.rawValue=this.constrainValue_(U)),this.view.refresh()}onInputKeyDown_(y){const M=an(this.baseStep_,Nc(y));M!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+M),{forceEmit:!1,last:!1})}onInputKeyUp_(y){an(this.baseStep_,Nc(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(y){if(!y.point)return null;const M=y.point.x-y.bounds.width/2;return this.constrainValue_(this.originRawValue_+M*this.props.get("draggingScale"))}onPointerMove_(y){const M=this.computeDraggingValue_(y.data);M!==null&&(this.value.setRawValue(M,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(y){const M=this.computeDraggingValue_(y.data);M!==null&&(this.value.setRawValue(M,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ym=Fe("sld");class k_{constructor(y,M){this.onChange_=this.onChange_.bind(this),this.props_=M.props,this.props_.emitter.on("change",this.onChange_),this.element=y.createElement("div"),this.element.classList.add(ym()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(ym("t")),M.viewProps.bindTabIndex(U),this.element.appendChild(U),this.trackElement=U;const J=y.createElement("div");J.classList.add(ym("k")),this.trackElement.appendChild(J),this.knobElement=J,M.value.emitter.on("change",this.onChange_),this.value=M.value,this.update_()}update_(){const y=vs(wn(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${y}%`}onChange_(){this.update_()}}class U_{constructor(y,M){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=M.baseStep,this.value=M.value,this.viewProps=M.viewProps,this.props=M.props,this.view=new k_(y,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vu(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,M){y.point&&this.value.setRawValue(wn(vs(y.point.x,0,y.bounds.width),0,y.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),M)}onPointerDownOrMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const M=an(this.baseStep_,kr(y));M!==0&&this.value.setRawValue(this.value.rawValue+M,{forceEmit:!1,last:!1})}onKeyUp_(y){an(this.baseStep_,kr(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const bm=Fe("sldtxt");class N_{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(bm());const U=y.createElement("div");U.classList.add(bm("s")),this.sliderView_=M.sliderView,U.appendChild(this.sliderView_.element),this.element.appendChild(U);const J=y.createElement("div");J.classList.add(bm("t")),this.textView_=M.textView,J.appendChild(this.textView_.element),this.element.appendChild(J)}}class lf{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.sliderC_=new U_(y,{baseStep:M.baseStep,props:M.sliderProps,value:M.value,viewProps:this.viewProps}),this.textC_=new Rd(y,{baseStep:M.baseStep,parser:M.parser,props:M.textProps,sliderProps:M.sliderProps,value:M.value,viewProps:M.viewProps}),this.view=new N_(y,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function ph(L,y){L.write(y)}function Dd(L){const y=It;return Array.isArray(L)?y.required.array(y.required.object({text:y.required.string,value:y.required.raw}))(L).value:typeof L=="object"?y.required.raw(L).value:void 0}function cf(L){if(L==="inline"||L==="popup")return L}function El(L){const y=It;return y.required.object({max:y.optional.number,min:y.optional.number,step:y.optional.number})(L).value}function Am(L){if(Array.isArray(L))return L;const y=[];return Object.keys(L).forEach(M=>{y.push({text:M,value:L[M]})}),y}function uf(L){return dt(L)?null:new Cs(Am(L))}function Bd(L,y){const M=L&&gr(L,Xn);return M?_v(M.step):Math.max(_v(y),2)}function Fc(L){return function(M){const U=M?gr(M,Xn):null;return U?U.step:null}(L)??1}function Sl(L,y){var M;const U=L&&gr(L,Xn),J=Math.abs((M=U==null?void 0:U.step)!==null&&M!==void 0?M:y);return J===0?.1:Math.pow(10,Math.floor(Math.log10(J))-1)}const hf=Fe("ckb");class go{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),this.element=y.createElement("div"),this.element.classList.add(hf()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("label");U.classList.add(hf("l")),this.element.appendChild(U);const J=y.createElement("input");J.classList.add(hf("i")),J.type="checkbox",U.appendChild(J),this.inputElement=J,M.viewProps.bindDisabled(this.inputElement);const xe=y.createElement("div");xe.classList.add(hf("w")),U.appendChild(xe);const pe=Oi(y,"check");xe.appendChild(pe),M.value.emitter.on("change",this.onValueChange_),this.value=M.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class fh{constructor(y,M){this.onInputChange_=this.onInputChange_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.view=new go(y,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(y){const M=y.currentTarget;this.value.rawValue=M.checked}}const bv={id:"input-bool",type:"input",accept:(L,y)=>{if(typeof L!="boolean")return null;const M=xt(y,{options:It.optional.custom(Dd)});return M?{initialValue:L,params:M}:null},binding:{reader:L=>nf,constraint:L=>function(y){const M=[],U=uf(y.options);return U&&M.push(U),new Br(M)}(L.params),writer:L=>ph},controller:L=>{const y=L.document,M=L.value,U=L.constraint,J=U&&gr(U,Cs);return J?new kc(y,{props:new _e({options:J.values.value("options")}),value:M,viewProps:L.viewProps}):new fh(y,{value:M,viewProps:L.viewProps})}},jc=Fe("col");class wm{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(jc()),M.foldable.bindExpandedClass(this.element,jc(void 0,"expanded")),Ue(M.foldable,"completed",$e(this.element,jc(void 0,"cpl")));const U=y.createElement("div");U.classList.add(jc("h")),this.element.appendChild(U);const J=y.createElement("div");J.classList.add(jc("s")),U.appendChild(J),this.swatchElement=J;const xe=y.createElement("div");if(xe.classList.add(jc("t")),U.appendChild(xe),this.textElement=xe,M.pickerLayout==="inline"){const pe=y.createElement("div");pe.classList.add(jc("p")),this.element.appendChild(pe),this.pickerElement=pe}else this.pickerElement=null}}function df(L,y,M){const U=yv(L,360),J=vs(y/100,0,1),xe=vs(M/100,0,1),pe=xe*J,mt=pe*(1-Math.abs(U/60%2-1)),$t=xe-pe;let gi,ur,cn;return[gi,ur,cn]=U>=0&&U<60?[pe,mt,0]:U>=60&&U<120?[mt,pe,0]:U>=120&&U<180?[0,pe,mt]:U>=180&&U<240?[0,mt,pe]:U>=240&&U<300?[mt,0,pe]:[pe,0,mt],[255*(gi+$t),255*(ur+$t),255*(cn+$t)]}function vo(L){return[L[0],L[1],L[2]]}function Av(L,y){return[L[0],L[1],L[2],y]}const Vo={hsl:{hsl:(L,y,M)=>[L,y,M],hsv:function(L,y,M){const U=M+y*(100-Math.abs(2*M-100))/200;return[L,U!==0?y*(100-Math.abs(2*M-100))/U:0,M+y*(100-Math.abs(2*M-100))/200]},rgb:function(L,y,M){const U=(L%360+360)%360,J=vs(y/100,0,1),xe=vs(M/100,0,1),pe=(1-Math.abs(2*xe-1))*J,mt=pe*(1-Math.abs(U/60%2-1)),$t=xe-pe/2;let gi,ur,cn;return[gi,ur,cn]=U>=0&&U<60?[pe,mt,0]:U>=60&&U<120?[mt,pe,0]:U>=120&&U<180?[0,pe,mt]:U>=180&&U<240?[0,mt,pe]:U>=240&&U<300?[mt,0,pe]:[pe,0,mt],[255*(gi+$t),255*(ur+$t),255*(cn+$t)]}},hsv:{hsl:function(L,y,M){const U=100-Math.abs(M*(200-y)/100-100);return[L,U!==0?y*M/U:0,M*(200-y)/200]},hsv:(L,y,M)=>[L,y,M],rgb:df},rgb:{hsl:function(L,y,M){const U=vs(L/255,0,1),J=vs(y/255,0,1),xe=vs(M/255,0,1),pe=Math.max(U,J,xe),mt=Math.min(U,J,xe),$t=pe-mt;let gi=0,ur=0;const cn=(mt+pe)/2;return $t!==0&&(ur=$t/(1-Math.abs(pe+mt-1)),gi=U===pe?(J-xe)/$t:J===pe?2+(xe-U)/$t:4+(U-J)/$t,gi=gi/6+(gi<0?1:0)),[360*gi,100*ur,100*cn]},hsv:function(L,y,M){const U=vs(L/255,0,1),J=vs(y/255,0,1),xe=vs(M/255,0,1),pe=Math.max(U,J,xe),mt=pe-Math.min(U,J,xe);let $t;return $t=mt===0?0:pe===U?((J-xe)/mt%6+6)%6*60:pe===J?60*((xe-U)/mt+2):60*((U-J)/mt+4),[$t,100*(pe===0?0:mt/pe),100*pe]},rgb:(L,y,M)=>[L,y,M]}};function da(L,y){return[y==="float"?1:L==="rgb"?255:360,y==="float"?1:L==="rgb"?255:100,y==="float"?1:L==="rgb"?255:100]}function Go(L,y,M,U){const J=da(y,M),xe=da(y,U);return L.map((pe,mt)=>pe/J[mt]*xe[mt])}function zc(L,y){return typeof L=="object"&&!dt(L)&&y in L&&typeof L[y]=="number"}class sr{static black(y="int"){return new sr([0,0,0],"rgb",y)}static fromObject(y,M="int"){const U="a"in y?[y.r,y.g,y.b,y.a]:[y.r,y.g,y.b];return new sr(U,"rgb",M)}static toRgbaObject(y,M="int"){return y.toRgbaObject(M)}static isRgbColorObject(y){return zc(y,"r")&&zc(y,"g")&&zc(y,"b")}static isRgbaColorObject(y){return this.isRgbColorObject(y)&&zc(y,"a")}static isColorObject(y){return this.isRgbColorObject(y)}static equals(y,M){if(y.mode!==M.mode)return!1;const U=y.comps_,J=M.comps_;for(let xe=0;xe<U.length;xe++)if(U[xe]!==J[xe])return!1;return!0}constructor(y,M,U="int"){this.mode=M,this.type=U,this.comps_=function(J,xe,pe){var mt;const $t=da(xe,pe);return[xe==="rgb"?vs(J[0],0,$t[0]):(gi=J[0],ur=$t[0],gi===ur?ur:yv(gi,ur)),vs(J[1],0,$t[1]),vs(J[2],0,$t[2]),vs((mt=J[3])!==null&&mt!==void 0?mt:1,0,1)];var gi,ur}(y,M,U)}getComponents(y,M="int"){return Av(function(U,J,xe){const pe=Go(U,J.mode,J.type,"int");return Go(Vo[J.mode][xe.mode](...pe),xe.mode,"int",xe.type)}(vo(this.comps_),{mode:this.mode,type:this.type},{mode:y??this.mode,type:M}),this.comps_[3])}toRgbaObject(y="int"){const M=this.getComponents("rgb",y);return{r:M[0],g:M[1],b:M[2],a:M[3]}}}const fn=Fe("colp");class wv{constructor(y,M){this.alphaViews_=null,this.element=y.createElement("div"),this.element.classList.add(fn()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(fn("hsv"));const J=y.createElement("div");J.classList.add(fn("sv")),this.svPaletteView_=M.svPaletteView,J.appendChild(this.svPaletteView_.element),U.appendChild(J);const xe=y.createElement("div");xe.classList.add(fn("h")),this.hPaletteView_=M.hPaletteView,xe.appendChild(this.hPaletteView_.element),U.appendChild(xe),this.element.appendChild(U);const pe=y.createElement("div");if(pe.classList.add(fn("rgb")),this.textView_=M.textView,pe.appendChild(this.textView_.element),this.element.appendChild(pe),M.alphaViews){this.alphaViews_={palette:M.alphaViews.palette,text:M.alphaViews.text};const mt=y.createElement("div");mt.classList.add(fn("a"));const $t=y.createElement("div");$t.classList.add(fn("ap")),$t.appendChild(this.alphaViews_.palette.element),mt.appendChild($t);const gi=y.createElement("div");gi.classList.add(fn("at")),gi.appendChild(this.alphaViews_.text.element),mt.appendChild(gi),this.element.appendChild(mt)}}get allFocusableElements(){const y=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(M=>M.inputElement)];return this.alphaViews_&&y.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),y}}function _u(L){return L==="int"?"int":L==="float"?"float":void 0}function ec(L){const y=It;return xt(L,{alpha:y.optional.boolean,color:y.optional.object({alpha:y.optional.boolean,type:y.optional.custom(_u)}),expanded:y.optional.boolean,picker:y.optional.custom(cf)})}function ts(L){return L?.1:1}function Kr(L){var y;return(y=L.color)===null||y===void 0?void 0:y.type}function pa(L,y){const M=L.match(/^(.+)%$/);return Math.min(M?.01*parseFloat(M[1])*y:parseFloat(L),y)}const Cl={deg:L=>L,grad:L=>360*L/400,rad:L=>360*L/(2*Math.PI),turn:L=>360*L};function fa(L){const y=L.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!y)return parseFloat(L);const M=parseFloat(y[1]),U=y[2];return Cl[U](M)}function pf(L){const y=L.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const M=[pa(y[1],255),pa(y[2],255),pa(y[3],255)];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])?null:M}function Ho(L){return y=>{const M=pf(y);return M?new sr(M,"rgb",L):null}}function is(L){const y=L.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const M=[pa(y[1],255),pa(y[2],255),pa(y[3],255),pa(y[4],1)];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])?null:M}function Ji(L){return y=>{const M=is(y);return M?new sr(M,"rgb",L):null}}function xv(L){const y=L.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const M=[fa(y[1]),pa(y[2],100),pa(y[3],100)];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])?null:M}function Jt(L){return y=>{const M=xv(y);return M?new sr(M,"hsl",L):null}}function _r(L){const y=L.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!y)return null;const M=[fa(y[1]),pa(y[2],100),pa(y[3],100),pa(y[4],1)];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])?null:M}function Od(L){return y=>{const M=_r(y);return M?new sr(M,"hsl",L):null}}function mh(L){const y=L.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(y)return[parseInt(y[1]+y[1],16),parseInt(y[2]+y[2],16),parseInt(y[3]+y[3],16)];const M=L.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return M?[parseInt(M[1],16),parseInt(M[2],16),parseInt(M[3],16)]:null}function Ld(L){const y=L.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(y)return[parseInt(y[1]+y[1],16),parseInt(y[2]+y[2],16),parseInt(y[3]+y[3],16),wn(parseInt(y[4]+y[4],16),0,255,0,1)];const M=L.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return M?[parseInt(M[1],16),parseInt(M[2],16),parseInt(M[3],16),wn(parseInt(M[4],16),0,255,0,1)]:null}function Ml(L){const y=L.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!y)return null;const M=[parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3])];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])?null:M}function tc(L){return y=>{const M=Ml(y);return M?new sr(M,"rgb",L):null}}function xm(L){const y=L.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!y)return null;const M=[parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3]),parseFloat(y[4])];return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])||isNaN(M[3])?null:M}function gh(L){return y=>{const M=xm(y);return M?new sr(M,"rgb",L):null}}const vh=[{parser:mh,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Ld,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:pf,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:is,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:xv,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:_r,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ml,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:xm,result:{alpha:!0,mode:"rgb",notation:"object"}}];function kd(L,y="int"){const M=function(U){return vh.reduce((J,{parser:xe,result:pe})=>J||(xe(U)?pe:null),null)}(L);return M?M.notation==="hex"&&y!=="float"?Object.assign(Object.assign({},M),{type:"int"}):M.notation==="func"?Object.assign(Object.assign({},M),{type:y}):null:null}const Em={int:[function(L){const y=mh(L);return y?new sr(y,"rgb","int"):null},function(L){const y=Ld(L);return y?new sr(y,"rgb","int"):null},Ho("int"),Ji("int"),Jt("int"),Od("int"),tc("int"),gh("int")],float:[Ho("float"),Ji("float"),Jt("float"),Od("float"),tc("float"),gh("float")]};function ff(L){const y=Em[L];return M=>y.reduce((U,J)=>U||J(M),null)}function Ud(L){const y=vs(Math.floor(L),0,255).toString(16);return y.length===1?`0${y}`:y}function mf(L,y="#"){return`${y}${vo(L.getComponents("rgb")).map(Ud).join("")}`}function ta(L,y="#"){const M=L.getComponents("rgb");return`${y}${[M[0],M[1],M[2],255*M[3]].map(Ud).join("")}`}function ic(L,y){const M=gs(y==="float"?2:0);return`rgb(${vo(L.getComponents("rgb",y)).map(U=>M(U)).join(", ")})`}function Sm(L){return y=>ic(y,L)}function _h(L,y){const M=gs(2),U=gs(y==="float"?2:0);return`rgba(${L.getComponents("rgb",y).map((J,xe)=>(xe===3?M:U)(J)).join(", ")})`}function yu(L){return y=>_h(y,L)}function Nd(L,y){const M=gs(y==="float"?2:0),U=["r","g","b"];return`{${vo(L.getComponents("rgb",y)).map((J,xe)=>`${U[xe]}: ${M(J)}`).join(", ")}}`}function Mr(L){return y=>Nd(y,L)}function xr(L,y){const M=gs(2),U=gs(y==="float"?2:0),J=["r","g","b","a"];return`{${L.getComponents("rgb",y).map((xe,pe)=>`${J[pe]}: ${(pe===3?M:U)(xe)}`).join(", ")}}`}function Tr(L){return y=>xr(y,L)}const zs=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:mf},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ta},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(L){const y=[gs(0),Ca,Ca];return`hsl(${vo(L.getComponents("hsl")).map((M,U)=>y[U](M)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(L){const y=[gs(0),Ca,Ca,gs(2)];return`hsla(${L.getComponents("hsl").map((M,U)=>y[U](M)).join(", ")})`}},...["int","float"].reduce((L,y)=>[...L,{format:{alpha:!1,mode:"rgb",notation:"func",type:y},stringifier:Sm(y)},{format:{alpha:!0,mode:"rgb",notation:"func",type:y},stringifier:yu(y)},{format:{alpha:!1,mode:"rgb",notation:"object",type:y},stringifier:Mr(y)},{format:{alpha:!0,mode:"rgb",notation:"object",type:y},stringifier:Tr(y)}],[])];function Qo(L){return zs.reduce((y,M)=>{return y||(U=M.format,J=L,U.alpha===J.alpha&&U.mode===J.mode&&U.notation===J.notation&&U.type===J.type?M.stringifier:null);var U,J},null)}const rc=Fe("apl");class gf{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),this.value=M.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(rc()),M.viewProps.bindClassModifiers(this.element),M.viewProps.bindTabIndex(this.element);const U=y.createElement("div");U.classList.add(rc("b")),this.element.appendChild(U);const J=y.createElement("div");J.classList.add(rc("c")),U.appendChild(J),this.colorElem_=J;const xe=y.createElement("div");xe.classList.add(rc("m")),this.element.appendChild(xe),this.markerElem_=xe;const pe=y.createElement("div");pe.classList.add(rc("p")),this.markerElem_.appendChild(pe),this.previewElem_=pe,this.update_()}update_(){const y=this.value.rawValue,M=y.getComponents("rgb"),U=new sr([M[0],M[1],M[2],0],"rgb"),J=new sr([M[0],M[1],M[2],255],"rgb"),xe=["to right",_h(U),_h(J)];this.colorElem_.style.background=`linear-gradient(${xe.join(",")})`,this.previewElem_.style.backgroundColor=_h(y);const pe=wn(M[3],0,1,0,100);this.markerElem_.style.left=`${pe}%`}onValueChange_(){this.update_()}}class Ev{constructor(y,M){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.view=new gf(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,M){if(!y.point)return;const U=y.point.x/y.bounds.width,J=this.value.rawValue,[xe,pe,mt]=J.getComponents("hsv");this.value.setRawValue(new sr([xe,pe,mt,U],"hsv"),M)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const M=an(ts(!0),kr(y));if(M===0)return;const U=this.value.rawValue,[J,xe,pe,mt]=U.getComponents("hsv");this.value.setRawValue(new sr([J,xe,pe,mt+M],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){an(ts(!0),kr(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Vc=Fe("coltxt");class Vs{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(Vc()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(Vc("m")),this.modeElem_=function(pe){const mt=pe.createElement("select");return mt.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(($t,gi)=>{const ur=pe.createElement("option");return ur.textContent=gi.text,ur.value=gi.value,$t.appendChild(ur),$t},pe.createDocumentFragment())),mt}(y),this.modeElem_.classList.add(Vc("ms")),U.appendChild(this.modeSelectElement),M.viewProps.bindDisabled(this.modeElem_);const J=y.createElement("div");J.classList.add(Vc("mm")),J.appendChild(Oi(y,"dropdown")),U.appendChild(J),this.element.appendChild(U);const xe=y.createElement("div");xe.classList.add(Vc("w")),this.element.appendChild(xe),this.textsElem_=xe,this.textViews_=M.textViews,this.applyTextViews_(),Ft(M.colorMode,pe=>{this.modeElem_.value=pe})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(y){this.textViews_=y,this.applyTextViews_()}applyTextViews_(){Vr(this.textsElem_);const y=this.element.ownerDocument;this.textViews_.forEach(M=>{const U=y.createElement("div");U.classList.add(Vc("c")),U.appendChild(M.element),this.textsElem_.appendChild(U)})}}function Se(L,y,M){const U=da(L,y)[M];return new Xa({min:0,max:U})}function yh(L,y,M){return new Rd(L,{arrayPosition:M===0?"fst":M===2?"lst":"mid",baseStep:ts(!1),parser:y.parser,props:_e.fromObject({draggingScale:y.colorType==="float"?.01:1,formatter:(U=y.colorType,gs(U==="float"?2:0))}),value:he(0,{constraint:Se(y.colorMode,y.colorType,M)}),viewProps:y.viewProps});var U}class vf{constructor(y,M){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=M.colorType,this.parser_=M.parser,this.value=M.value,this.viewProps=M.viewProps,this.colorMode=he(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(y),this.view=new Vs(y,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(y){const M={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},U=[yh(y,M,0),yh(y,M,1),yh(y,M,2)];return U.forEach((J,xe)=>{Yi({primary:this.value,secondary:J.value,forward:pe=>pe.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[xe],backward:(pe,mt)=>{const $t=this.colorMode.rawValue,gi=pe.rawValue.getComponents($t,this.colorType_);return gi[xe]=mt.rawValue,new sr(Av(vo(gi),gi[3]),$t,this.colorType_)}})}),U}onModeSelectChange_(y){const M=y.currentTarget;this.colorMode.rawValue=M.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const ia=Fe("hpl");class Ur{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),this.value=M.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(ia()),M.viewProps.bindClassModifiers(this.element),M.viewProps.bindTabIndex(this.element);const U=y.createElement("div");U.classList.add(ia("c")),this.element.appendChild(U);const J=y.createElement("div");J.classList.add(ia("m")),this.element.appendChild(J),this.markerElem_=J,this.update_()}update_(){const y=this.value.rawValue,[M]=y.getComponents("hsv");this.markerElem_.style.backgroundColor=ic(new sr([M,100,100],"hsv"));const U=wn(M,0,360,0,100);this.markerElem_.style.left=`${U}%`}onValueChange_(){this.update_()}}class ma{constructor(y,M){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.view=new Ur(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,M){if(!y.point)return;const U=wn(vs(y.point.x,0,y.bounds.width),0,y.bounds.width,0,360),J=this.value.rawValue,[,xe,pe,mt]=J.getComponents("hsv");this.value.setRawValue(new sr([U,xe,pe,mt],"hsv"),M)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){const M=an(ts(!1),kr(y));if(M===0)return;const U=this.value.rawValue,[J,xe,pe,mt]=U.getComponents("hsv");this.value.setRawValue(new sr([J+M,xe,pe,mt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){an(ts(!1),kr(y))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _s=Fe("svp");class Ma{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),this.value=M.value,this.value.emitter.on("change",this.onValueChange_),this.element=y.createElement("div"),this.element.classList.add(_s()),M.viewProps.bindClassModifiers(this.element),M.viewProps.bindTabIndex(this.element);const U=y.createElement("canvas");U.height=64,U.width=64,U.classList.add(_s("c")),this.element.appendChild(U),this.canvasElement=U;const J=y.createElement("div");J.classList.add(_s("m")),this.element.appendChild(J),this.markerElem_=J,this.update_()}update_(){const y=function(gi){const ur=gi.ownerDocument.defaultView;return ur&&"document"in ur?gi.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!y)return;const M=this.value.rawValue.getComponents("hsv"),U=this.canvasElement.width,J=this.canvasElement.height,xe=y.getImageData(0,0,U,J),pe=xe.data;for(let gi=0;gi<J;gi++)for(let ur=0;ur<U;ur++){const cn=wn(ur,0,U,0,100),mn=wn(gi,0,J,100,0),gn=df(M[0],cn,mn),Wr=4*(gi*U+ur);pe[Wr]=gn[0],pe[Wr+1]=gn[1],pe[Wr+2]=gn[2],pe[Wr+3]=255}y.putImageData(xe,0,0);const mt=wn(M[1],0,100,0,100);this.markerElem_.style.left=`${mt}%`;const $t=wn(M[2],0,100,100,0);this.markerElem_.style.top=`${$t}%`}onValueChange_(){this.update_()}}class Wo{constructor(y,M){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.view=new Ma(y,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(y,M){if(!y.point)return;const U=wn(y.point.x,0,y.bounds.width,0,100),J=wn(y.point.y,0,y.bounds.height,100,0),[xe,,,pe]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new sr([xe,U,J,pe],"hsv"),M)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onKeyDown_(y){vv(y.key)&&y.preventDefault();const[M,U,J,xe]=this.value.rawValue.getComponents("hsv"),pe=ts(!1),mt=an(pe,kr(y)),$t=an(pe,Nc(y));mt===0&&$t===0||this.value.setRawValue(new sr([M,U+mt,J+$t,xe],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(y){const M=ts(!1),U=an(M,kr(y)),J=an(M,Nc(y));U===0&&J===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class bu{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.hPaletteC_=new ma(y,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Wo(y,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=M.supportsAlpha?{palette:new Ev(y,{value:this.value,viewProps:this.viewProps}),text:new Rd(y,{parser:zo,baseStep:.1,props:_e.fromObject({draggingScale:.01,formatter:gs(2)}),value:he(0,{constraint:new Xa({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Yi({primary:this.value,secondary:this.alphaIcs_.text.value,forward:U=>U.rawValue.getComponents()[3],backward:(U,J)=>{const xe=U.rawValue.getComponents();return xe[3]=J.rawValue,new sr(xe,U.rawValue.mode)}}),this.textC_=new vf(y,{colorType:M.colorType,parser:zo,value:this.value,viewProps:this.viewProps}),this.view=new wv(y,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:M.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Xo=Fe("colsw");class nc{constructor(y,M){this.onValueChange_=this.onValueChange_.bind(this),M.value.emitter.on("change",this.onValueChange_),this.value=M.value,this.element=y.createElement("div"),this.element.classList.add(Xo()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(Xo("sw")),this.element.appendChild(U),this.swatchElem_=U;const J=y.createElement("button");J.classList.add(Xo("b")),M.viewProps.bindDisabled(J),this.element.appendChild(J),this.buttonElement=J,this.update_()}update_(){const y=this.value.rawValue;this.swatchElem_.style.backgroundColor=ta(y)}onValueChange_(){this.update_()}}class Gc{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.view=new nc(y,{value:this.value,viewProps:this.viewProps})}}class Tl{constructor(y,M){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.foldable_=Gr.create(M.expanded),this.swatchC_=new Gc(y,{value:this.value,viewProps:this.viewProps});const U=this.swatchC_.view.buttonElement;U.addEventListener("blur",this.onButtonBlur_),U.addEventListener("click",this.onButtonClick_),this.textC_=new fu(y,{parser:M.parser,props:_e.fromObject({formatter:M.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new wm(y,{foldable:this.foldable_,pickerLayout:M.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=M.pickerLayout==="popup"?new Kl(y,{viewProps:this.viewProps}):null;const J=new bu(y,{colorType:M.colorType,supportsAlpha:M.supportsAlpha,value:this.value,viewProps:this.viewProps});J.view.allFocusableElements.forEach(xe=>{xe.addEventListener("blur",this.onPopupChildBlur_),xe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=J,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(J.view.element),Yi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:xe=>xe.rawValue,backward:(xe,pe)=>pe.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ps(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(y){if(!this.popC_)return;const M=this.view.element,U=y.relatedTarget;U&&M.contains(U)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(y){if(!this.popC_)return;const M=this.popC_.view.element,U=Qn(y);U&&M.contains(U)||U&&U===this.swatchC_.view.buttonElement&&!ti(M.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(y){this.popC_?y.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&y.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ga(L){return vo(L.getComponents("rgb")).reduce((y,M)=>y<<8|255&Math.floor(M),0)}function Au(L){return L.getComponents("rgb").reduce((y,M,U)=>y<<8|255&Math.floor(U===3?255*M:M),0)>>>0}function qo(L){return typeof L!="number"?sr.black():new sr([(y=L)>>16&255,y>>8&255,255&y],"rgb");var y}function Ta(L){return typeof L!="number"?sr.black():new sr([(y=L)>>24&255,y>>16&255,y>>8&255,wn(255&y,0,255,0,1)],"rgb");var y}function wu(L){var y;return!(!(L!=null&&L.alpha)&&!(!((y=L==null?void 0:L.color)===null||y===void 0)&&y.alpha))}function Ia(L){return L?y=>ta(y,"0x"):y=>mf(y,"0x")}const Hc={id:"input-color-number",type:"input",accept:(L,y)=>{if(typeof L!="number"||!function(U){return"color"in U||"view"in U&&U.view==="color"}(y))return null;const M=ec(y);return M?{initialValue:L,params:M}:null},binding:{reader:L=>wu(L.params)?Ta:qo,equals:sr.equals,writer:L=>function(y){const M=y?Au:ga;return(U,J)=>{ph(U,M(J))}}(wu(L.params))},controller:L=>{const y=wu(L.params),M="expanded"in L.params?L.params.expanded:void 0,U="picker"in L.params?L.params.picker:void 0;return new Tl(L.document,{colorType:"int",expanded:M!=null&&M,formatter:Ia(y),parser:ff("int"),pickerLayout:U??"popup",supportsAlpha:y,value:L.value,viewProps:L.viewProps})}};function Pa(L){return y=>function(M,U){return sr.isColorObject(M)?sr.fromObject(M,U):sr.black(U)}(y,L)}function _o(L,y){return M=>L?xr(M,y):Nd(M,y)}const Fd={id:"input-color-object",type:"input",accept:(L,y)=>{if(!sr.isColorObject(L))return null;const M=ec(y);return M?{initialValue:L,params:M}:null},binding:{reader:L=>Pa(Kr(L.params)),equals:sr.equals,writer:L=>{return U=L.initialValue,y=sr.isRgbaColorObject(U),M=Kr(L.params),(J,xe)=>{y?function(pe,mt,$t){const gi=mt.toRgbaObject($t);pe.writeProperty("r",gi.r),pe.writeProperty("g",gi.g),pe.writeProperty("b",gi.b),pe.writeProperty("a",gi.a)}(J,xe,M):function(pe,mt,$t){const gi=mt.toRgbaObject($t);pe.writeProperty("r",gi.r),pe.writeProperty("g",gi.g),pe.writeProperty("b",gi.b)}(J,xe,M)};var y,M,U}},controller:L=>{var y;const M=sr.isRgbaColorObject(L.initialValue),U="expanded"in L.params?L.params.expanded:void 0,J="picker"in L.params?L.params.picker:void 0,xe=(y=Kr(L.params))!==null&&y!==void 0?y:"int";return new Tl(L.document,{colorType:xe,expanded:U!=null&&U,formatter:_o(M,xe),parser:ff(xe),pickerLayout:J??"popup",supportsAlpha:M,value:L.value,viewProps:L.viewProps})}},sc={id:"input-color-string",type:"input",accept:(L,y)=>{if(typeof L!="string"||"view"in y&&y.view==="text")return null;const M=kd(L,Kr(y));if(!M||!Qo(M))return null;const U=ec(y);return U?{initialValue:L,params:U}:null},binding:{reader:L=>{var y;return function(M){const U=Em[M];return J=>typeof J!="string"?sr.black(M):U.reduce((pe,mt)=>pe||mt(J),null)??sr.black(M)}((y=Kr(L.params))!==null&&y!==void 0?y:"int")},equals:sr.equals,writer:L=>{const y=kd(L.initialValue,Kr(L.params));if(!y)throw Re.shouldNeverHappen();const M=function(U){const J=Qo(U);return J?(xe,pe)=>{ph(xe,J(pe))}:null}(y);if(!M)throw Re.notBindable();return M}},controller:L=>{const y=kd(L.initialValue,Kr(L.params));if(!y)throw Re.shouldNeverHappen();const M=Qo(y);if(!M)throw Re.shouldNeverHappen();const U="expanded"in L.params?L.params.expanded:void 0,J="picker"in L.params?L.params.picker:void 0;return new Tl(L.document,{colorType:y.type,expanded:U!=null&&U,formatter:M,parser:ff(y.type),pickerLayout:J??"popup",supportsAlpha:y.alpha,value:L.value,viewProps:L.viewProps})}};class ys{constructor(y){this.components=y.components,this.asm_=y.assembly}constrain(y){const M=this.asm_.toComponents(y).map((U,J)=>{var xe,pe;return(pe=(xe=this.components[J])===null||xe===void 0?void 0:xe.constrain(U))!==null&&pe!==void 0?pe:U});return this.asm_.fromComponents(M)}}const bh=Fe("pndtxt");class jd{constructor(y,M){this.textViews=M.textViews,this.element=y.createElement("div"),this.element.classList.add(bh()),this.textViews.forEach(U=>{const J=y.createElement("div");J.classList.add(bh("a")),J.appendChild(U.element),this.element.appendChild(J)})}}class Ka{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.acs_=M.axes.map((U,J)=>function(xe,pe,mt){return new Rd(xe,{arrayPosition:mt===0?"fst":mt===pe.axes.length-1?"lst":"mid",baseStep:pe.axes[mt].baseStep,parser:pe.parser,props:pe.axes[mt].textProps,value:he(0,{constraint:pe.axes[mt].constraint}),viewProps:pe.viewProps})}(y,M,J)),this.acs_.forEach((U,J)=>{Yi({primary:this.value,secondary:U.value,forward:xe=>M.assembly.toComponents(xe.rawValue)[J],backward:(xe,pe)=>{const mt=M.assembly.toComponents(xe.rawValue);return mt[J]=pe.rawValue,M.assembly.fromComponents(mt)}})}),this.view=new jd(y,{textViews:this.acs_.map(U=>U.view)})}}function Qc(L,y){return"step"in L&&!dt(L.step)?new Xn(L.step,y):null}function or(L){return dt(L.max)||dt(L.min)?dt(L.max)&&dt(L.min)?null:new jo({max:L.max,min:L.min}):new Xa({max:L.max,min:L.min})}const Yo={id:"input-number",type:"input",accept:(L,y)=>{if(typeof L!="number")return null;const M=It,U=xt(y,{format:M.optional.function,max:M.optional.number,min:M.optional.number,options:M.optional.custom(Dd),step:M.optional.number});return U?{initialValue:L,params:U}:null},binding:{reader:L=>Pd,constraint:L=>function(y,M){const U=[],J=Qc(y,M);J&&U.push(J);const xe=or(y);xe&&U.push(xe);const pe=uf(y.options);return pe&&U.push(pe),new Br(U)}(L.params,L.initialValue),writer:L=>ph},controller:L=>{var y;const M=L.value,U=L.constraint,J=U&&gr(U,Cs);if(J)return new kc(L.document,{props:new _e({options:J.values.value("options")}),value:M,viewProps:L.viewProps});const xe=(y="format"in L.params?L.params.format:void 0)!==null&&y!==void 0?y:gs(Bd(U,M.rawValue)),pe=U&&gr(U,Xa);return pe?new lf(L.document,{baseStep:Fc(U),parser:zo,sliderProps:new _e({maxValue:pe.values.value("max"),minValue:pe.values.value("min")}),textProps:_e.fromObject({draggingScale:Sl(U,M.rawValue),formatter:xe}),value:M,viewProps:L.viewProps}):new Rd(L.document,{baseStep:Fc(U),parser:zo,props:_e.fromObject({draggingScale:Sl(U,M.rawValue),formatter:xe}),value:M,viewProps:L.viewProps})}};class rs{constructor(y=0,M=0){this.x=y,this.y=M}getComponents(){return[this.x,this.y]}static isObject(y){if(dt(y))return!1;const M=y.x,U=y.y;return typeof M=="number"&&typeof U=="number"}static equals(y,M){return y.x===M.x&&y.y===M.y}toObject(){return{x:this.x,y:this.y}}}const Wc={toComponents:L=>L.getComponents(),fromComponents:L=>new rs(...L)},Il=Fe("p2d");class ac{constructor(y,M){this.element=y.createElement("div"),this.element.classList.add(Il()),M.viewProps.bindClassModifiers(this.element),Ft(M.expanded,$e(this.element,Il(void 0,"expanded")));const U=y.createElement("div");U.classList.add(Il("h")),this.element.appendChild(U);const J=y.createElement("button");J.classList.add(Il("b")),J.appendChild(Oi(y,"p2dpad")),M.viewProps.bindDisabled(J),U.appendChild(J),this.buttonElement=J;const xe=y.createElement("div");if(xe.classList.add(Il("t")),U.appendChild(xe),this.textElement=xe,M.pickerLayout==="inline"){const pe=y.createElement("div");pe.classList.add(Il("p")),this.element.appendChild(pe),this.pickerElement=pe}else this.pickerElement=null}}const Ra=Fe("p2dp");class Da{constructor(y,M){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=M.invertsY,this.maxValue_=M.maxValue,this.element=y.createElement("div"),this.element.classList.add(Ra()),M.layout==="popup"&&this.element.classList.add(Ra(void 0,"p")),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("div");U.classList.add(Ra("p")),M.viewProps.bindTabIndex(U),this.element.appendChild(U),this.padElement=U;const J=y.createElementNS(We,"svg");J.classList.add(Ra("g")),this.padElement.appendChild(J),this.svgElem_=J;const xe=y.createElementNS(We,"line");xe.classList.add(Ra("ax")),xe.setAttributeNS(null,"x1","0"),xe.setAttributeNS(null,"y1","50%"),xe.setAttributeNS(null,"x2","100%"),xe.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(xe);const pe=y.createElementNS(We,"line");pe.classList.add(Ra("ax")),pe.setAttributeNS(null,"x1","50%"),pe.setAttributeNS(null,"y1","0"),pe.setAttributeNS(null,"x2","50%"),pe.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(pe);const mt=y.createElementNS(We,"line");mt.classList.add(Ra("l")),mt.setAttributeNS(null,"x1","50%"),mt.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(mt),this.lineElem_=mt;const $t=y.createElement("div");$t.classList.add(Ra("m")),this.padElement.appendChild($t),this.markerElem_=$t,M.value.emitter.on("change",this.onValueChange_),this.value=M.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[y,M]=this.value.rawValue.getComponents(),U=this.maxValue_,J=wn(y,-U,+U,0,100),xe=wn(M,-U,+U,0,100),pe=this.invertsY_?100-xe:xe;this.lineElem_.setAttributeNS(null,"x2",`${J}%`),this.lineElem_.setAttributeNS(null,"y2",`${pe}%`),this.markerElem_.style.left=`${J}%`,this.markerElem_.style.top=`${pe}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Xc(L,y,M){return[an(y[0],kr(L)),an(y[1],Nc(L))*(M?1:-1)]}class xu{constructor(y,M){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.baseSteps_=M.baseSteps,this.maxValue_=M.maxValue,this.invertsY_=M.invertsY,this.view=new Da(y,{invertsY:this.invertsY_,layout:M.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vu(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(y,M){if(!y.point)return;const U=this.maxValue_,J=wn(y.point.x,0,y.bounds.width,-U,+U),xe=wn(this.invertsY_?y.bounds.height-y.point.y:y.point.y,0,y.bounds.height,-U,+U);this.value.setRawValue(new rs(J,xe),M)}onPointerDown_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerMove_(y){this.handlePointerEvent_(y.data,{forceEmit:!1,last:!1})}onPointerUp_(y){this.handlePointerEvent_(y.data,{forceEmit:!0,last:!0})}onPadKeyDown_(y){vv(y.key)&&y.preventDefault();const[M,U]=Xc(y,this.baseSteps_,this.invertsY_);M===0&&U===0||this.value.setRawValue(new rs(this.value.rawValue.x+M,this.value.rawValue.y+U),{forceEmit:!1,last:!1})}onPadKeyUp_(y){const[M,U]=Xc(y,this.baseSteps_,this.invertsY_);M===0&&U===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ah{constructor(y,M){var U,J;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=M.value,this.viewProps=M.viewProps,this.foldable_=Gr.create(M.expanded),this.popC_=M.pickerLayout==="popup"?new Kl(y,{viewProps:this.viewProps}):null;const xe=new xu(y,{baseSteps:[M.axes[0].baseStep,M.axes[1].baseStep],invertsY:M.invertsY,layout:M.pickerLayout,maxValue:M.maxValue,value:this.value,viewProps:this.viewProps});xe.view.allFocusableElements.forEach(pe=>{pe.addEventListener("blur",this.onPopupChildBlur_),pe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=xe,this.textC_=new Ka(y,{assembly:Wc,axes:M.axes,parser:M.parser,value:this.value,viewProps:this.viewProps}),this.view=new ac(y,{expanded:this.foldable_.value("expanded"),pickerLayout:M.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(U=this.view.buttonElement)===null||U===void 0||U.addEventListener("blur",this.onPadButtonBlur_),(J=this.view.buttonElement)===null||J===void 0||J.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Yi({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:pe=>pe.rawValue,backward:(pe,mt)=>mt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ps(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(y){if(!this.popC_)return;const M=this.view.element,U=y.relatedTarget;U&&M.contains(U)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(y){if(!this.popC_)return;const M=this.popC_.view.element,U=Qn(y);U&&M.contains(U)||U&&U===this.view.buttonElement&&!ti(M.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(y){this.popC_?y.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&y.key==="Escape"&&this.view.buttonElement.focus()}}class Pl{constructor(y=0,M=0,U=0){this.x=y,this.y=M,this.z=U}getComponents(){return[this.x,this.y,this.z]}static isObject(y){if(dt(y))return!1;const M=y.x,U=y.y,J=y.z;return typeof M=="number"&&typeof U=="number"&&typeof J=="number"}static equals(y,M){return y.x===M.x&&y.y===M.y&&y.z===M.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Cm={toComponents:L=>L.getComponents(),fromComponents:L=>new Pl(...L)};function Mm(L){return Pl.isObject(L)?new Pl(L.x,L.y,L.z):new Pl}function Za(L,y){L.writeProperty("x",y.x),L.writeProperty("y",y.y),L.writeProperty("z",y.z)}function Ja(L,y){return{baseStep:Fc(y),constraint:y,textProps:_e.fromObject({draggingScale:Sl(y,L),formatter:gs(Bd(y,L))})}}const oc={id:"input-point3d",type:"input",accept:(L,y)=>{if(!Pl.isObject(L))return null;const M=It,U=xt(y,{x:M.optional.custom(El),y:M.optional.custom(El),z:M.optional.custom(El)});return U?{initialValue:L,params:U}:null},binding:{reader:L=>Mm,constraint:L=>{return y=L.params,M=L.initialValue,new ys({assembly:Cm,components:[kn("x"in y?y.x:void 0,M.x),kn("y"in y?y.y:void 0,M.y),kn("z"in y?y.z:void 0,M.z)]});var y,M},equals:Pl.equals,writer:L=>Za},controller:L=>{const y=L.value,M=L.constraint;if(!(M instanceof ys))throw Re.shouldNeverHappen();return new Ka(L.document,{assembly:Cm,axes:[Ja(y.rawValue.x,M.components[0]),Ja(y.rawValue.y,M.components[1]),Ja(y.rawValue.z,M.components[2])],parser:zo,value:y,viewProps:L.viewProps})}};class qn{constructor(y=0,M=0,U=0,J=0){this.x=y,this.y=M,this.z=U,this.w=J}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(y){if(dt(y))return!1;const M=y.x,U=y.y,J=y.z,xe=y.w;return typeof M=="number"&&typeof U=="number"&&typeof J=="number"&&typeof xe=="number"}static equals(y,M){return y.x===M.x&&y.y===M.y&&y.z===M.z&&y.w===M.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Eu={toComponents:L=>L.getComponents(),fromComponents:L=>new qn(...L)};function va(L){return qn.isObject(L)?new qn(L.x,L.y,L.z,L.w):new qn}function Ln(L,y){L.writeProperty("x",y.x),L.writeProperty("y",y.y),L.writeProperty("z",y.z),L.writeProperty("w",y.w)}const _f={id:"input-point4d",type:"input",accept:(L,y)=>{if(!qn.isObject(L))return null;const M=It,U=xt(y,{x:M.optional.custom(El),y:M.optional.custom(El),z:M.optional.custom(El),w:M.optional.custom(El)});return U?{initialValue:L,params:U}:null},binding:{reader:L=>va,constraint:L=>{return y=L.params,M=L.initialValue,new ys({assembly:Eu,components:[kn("x"in y?y.x:void 0,M.x),kn("y"in y?y.y:void 0,M.y),kn("z"in y?y.z:void 0,M.z),kn("w"in y?y.w:void 0,M.w)]});var y,M},equals:qn.equals,writer:L=>Ln},controller:L=>{const y=L.value,M=L.constraint;if(!(M instanceof ys))throw Re.shouldNeverHappen();return new Ka(L.document,{assembly:Eu,axes:y.rawValue.getComponents().map((U,J)=>{return xe=U,{baseStep:Fc(pe=M.components[J]),constraint:pe,textProps:_e.fromObject({draggingScale:Sl(pe,xe),formatter:gs(Bd(pe,xe))})};var xe,pe}),parser:zo,value:y,viewProps:L.viewProps})}},Hr={id:"input-string",type:"input",accept:(L,y)=>{if(typeof L!="string")return null;const M=xt(y,{options:It.optional.custom(Dd)});return M?{initialValue:L,params:M}:null},binding:{reader:L=>of,constraint:L=>function(y){const M=[],U=uf(y.options);return U&&M.push(U),new Br(M)}(L.params),writer:L=>ph},controller:L=>{const y=L.document,M=L.value,U=L.constraint,J=U&&gr(U,Cs);return J?new kc(y,{props:new _e({options:J.values.value("options")}),value:M,viewProps:L.viewProps}):new fu(y,{parser:xe=>xe,props:_e.fromObject({formatter:Ya}),value:M,viewProps:L.viewProps})}},Su={monitor:{defaultInterval:200,defaultLineCount:3}},zd=Fe("mll");class Nr{constructor(y,M){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=M.formatter,this.element=y.createElement("div"),this.element.classList.add(zd()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("textarea");U.classList.add(zd("i")),U.style.height=`calc(var(--bld-us) * ${M.lineCount})`,U.readOnly=!0,M.viewProps.bindDisabled(U),this.element.appendChild(U),this.textareaElem_=U,M.value.emitter.on("change",this.onValueUpdate_),this.value=M.value,this.update_()}update_(){const y=this.textareaElem_,M=y.scrollTop===y.scrollHeight-y.clientHeight,U=[];this.value.rawValue.forEach(J=>{J!==void 0&&U.push(this.formatter_(J))}),y.textContent=U.join(`
`),M&&(y.scrollTop=y.scrollHeight)}onValueUpdate_(){this.update_()}}class ya{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.view=new Nr(y,{formatter:M.formatter,lineCount:M.lineCount,value:this.value,viewProps:this.viewProps})}}const yo=Fe("sgl");class yf{constructor(y,M){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=M.formatter,this.element=y.createElement("div"),this.element.classList.add(yo()),M.viewProps.bindClassModifiers(this.element);const U=y.createElement("input");U.classList.add(yo("i")),U.readOnly=!0,U.type="text",M.viewProps.bindDisabled(U),this.element.appendChild(U),this.inputElement=U,M.value.emitter.on("change",this.onValueUpdate_),this.value=M.value,this.update_()}update_(){const y=this.value.rawValue,M=y[y.length-1];this.inputElement.value=M!==void 0?this.formatter_(M):""}onValueUpdate_(){this.update_()}}class $a{constructor(y,M){this.value=M.value,this.viewProps=M.viewProps,this.view=new yf(y,{formatter:M.formatter,value:this.value,viewProps:this.viewProps})}}const ba={id:"monitor-bool",type:"monitor",accept:(L,y)=>{if(typeof L!="boolean")return null;const M=xt(y,{lineCount:It.optional.number});return M?{initialValue:L,params:M}:null},binding:{reader:L=>nf},controller:L=>{var y;return L.value.rawValue.length===1?new $a(L.document,{formatter:ha,value:L.value,viewProps:L.viewProps}):new ya(L.document,{formatter:ha,lineCount:(y=L.params.lineCount)!==null&&y!==void 0?y:Su.monitor.defaultLineCount,value:L.value,viewProps:L.viewProps})}},Ba=Fe("grl");class Tm{constructor(y,M){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=y.createElement("div"),this.element.classList.add(Ba()),M.viewProps.bindClassModifiers(this.element),this.formatter_=M.formatter,this.props_=M.props,this.cursor_=M.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const U=y.createElementNS(We,"svg");U.classList.add(Ba("g")),U.style.height=`calc(var(--bld-us) * ${M.lineCount})`,this.element.appendChild(U),this.svgElem_=U;const J=y.createElementNS(We,"polyline");this.svgElem_.appendChild(J),this.lineElem_=J;const xe=y.createElement("div");xe.classList.add(Ba("t"),Fe("tt")()),this.element.appendChild(xe),this.tooltipElem_=xe,M.value.emitter.on("change",this.onValueUpdate_),this.value=M.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const y=this.svgElem_.getBoundingClientRect(),M=this.value.rawValue.length-1,U=this.props_.get("minValue"),J=this.props_.get("maxValue"),xe=[];this.value.rawValue.forEach((ur,cn)=>{if(ur===void 0)return;const mn=wn(cn,0,M,0,y.width),gn=wn(ur,U,J,y.height,0);xe.push([mn,gn].join(","))}),this.lineElem_.setAttributeNS(null,"points",xe.join(" "));const pe=this.tooltipElem_,mt=this.value.rawValue[this.cursor_.rawValue];if(mt===void 0)return void pe.classList.remove(Ba("t","a"));const $t=wn(this.cursor_.rawValue,0,M,0,y.width),gi=wn(mt,U,J,y.height,0);pe.style.left=`${$t}px`,pe.style.top=`${gi}px`,pe.textContent=`${this.formatter_(mt)}`,pe.classList.contains(Ba("t","a"))||(pe.classList.add(Ba("t","a"),Ba("t","in")),Wt(pe),pe.classList.remove(Ba("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Cu{constructor(y,M){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=M.props,this.value=M.value,this.viewProps=M.viewProps,this.cursor_=he(-1),this.view=new Tm(y,{cursor:this.cursor_,formatter:M.formatter,lineCount:M.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),ti(y)){const U=new vu(this.view.element);U.emitter.on("down",this.onGraphPointerDown_),U.emitter.on("move",this.onGraphPointerMove_),U.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(y){const M=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(wn(y.offsetX,0,M.width,0,this.value.rawValue.length))}onGraphPointerDown_(y){this.onGraphPointerMove_(y)}onGraphPointerMove_(y){y.data.point?this.cursor_.rawValue=Math.floor(wn(y.data.point.x,0,y.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ms(L){return"format"in L&&!dt(L.format)?L.format:gs(2)}function wh(L){return"view"in L&&L.view==="graph"}const xh={id:"monitor-number",type:"monitor",accept:(L,y)=>{if(typeof L!="number")return null;const M=It,U=xt(y,{format:M.optional.function,lineCount:M.optional.number,max:M.optional.number,min:M.optional.number,view:M.optional.string});return U?{initialValue:L,params:U}:null},binding:{defaultBufferSize:L=>wh(L)?64:1,reader:L=>Pd},controller:L=>wh(L.params)?function(y){var M,U,J;return new Cu(y.document,{formatter:Ms(y.params),lineCount:(M=y.params.lineCount)!==null&&M!==void 0?M:Su.monitor.defaultLineCount,props:_e.fromObject({maxValue:(U="max"in y.params?y.params.max:null)!==null&&U!==void 0?U:100,minValue:(J="min"in y.params?y.params.min:null)!==null&&J!==void 0?J:0}),value:y.value,viewProps:y.viewProps})}(L):function(y){var M;return y.value.rawValue.length===1?new $a(y.document,{formatter:Ms(y.params),value:y.value,viewProps:y.viewProps}):new ya(y.document,{formatter:Ms(y.params),lineCount:(M=y.params.lineCount)!==null&&M!==void 0?M:Su.monitor.defaultLineCount,value:y.value,viewProps:y.viewProps})}(L)},bs={id:"monitor-string",type:"monitor",accept:(L,y)=>{if(typeof L!="string")return null;const M=It,U=xt(y,{lineCount:M.optional.number,multiline:M.optional.boolean});return U?{initialValue:L,params:U}:null},binding:{reader:L=>of},controller:L=>{var y;const M=L.value;return M.rawValue.length>1||"multiline"in L.params&&L.params.multiline?new ya(L.document,{formatter:Ya,lineCount:(y=L.params.lineCount)!==null&&y!==void 0?y:Su.monitor.defaultLineCount,value:M,viewProps:L.viewProps}):new $a(L.document,{formatter:Ya,value:M,viewProps:L.viewProps})}};function bf(L,y){return y===0?new zi:new Lc(L,y??Su.monitor.defaultInterval)}class Gs{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(y){y.type==="blade"?this.pluginsMap_.blades.unshift(y):y.type==="input"?this.pluginsMap_.inputs.unshift(y):y.type==="monitor"&&this.pluginsMap_.monitors.unshift(y)}createInput(y,M,U){if(dt(M.read()))throw new Re({context:{key:M.key},type:"nomatchingcontroller"});const J=this.pluginsMap_.inputs.reduce((xe,pe)=>xe??function(mt,$t){const gi=mt.accept($t.target.read(),$t.params);if(dt(gi))return null;const ur=It,cn={target:$t.target,initialValue:gi.initialValue,params:gi.params},mn=mt.binding.reader(cn),gn=mt.binding.constraint?mt.binding.constraint(cn):void 0,Wr=he(mn(gi.initialValue),{constraint:gn,equals:mt.binding.equals}),hr=new Ed({reader:mn,target:$t.target,value:Wr,writer:mt.binding.writer(cn)}),Yc=ur.optional.boolean($t.params.disabled).value,lc=ur.optional.boolean($t.params.hidden).value,Mu=mt.controller({constraint:gn,document:$t.document,initialValue:gi.initialValue,params:gi.params,value:hr.value,viewProps:Qt.create({disabled:Yc,hidden:lc})}),xf=ur.optional.string($t.params.label).value;return new $n($t.document,{binding:hr,blade:ae(),props:_e.fromObject({label:xf??$t.target.key}),valueController:Mu})}(pe,{document:y,target:M,params:U}),null);if(J)return J;throw new Re({context:{key:M.key},type:"nomatchingcontroller"})}createMonitor(y,M,U){const J=this.pluginsMap_.monitors.reduce((xe,pe)=>xe??function(mt,$t){var gi,ur,cn;const mn=It,gn=mt.accept($t.target.read(),$t.params);if(dt(gn))return null;const Wr={target:$t.target,initialValue:gn.initialValue,params:gn.params},hr=mt.binding.reader(Wr),Yc=(ur=(gi=mn.optional.number($t.params.bufferSize).value)!==null&&gi!==void 0?gi:mt.binding.defaultBufferSize&&mt.binding.defaultBufferSize(gn.params))!==null&&ur!==void 0?ur:1,lc=mn.optional.number($t.params.interval).value,Mu=new _m({reader:hr,target:$t.target,ticker:bf($t.document,lc),value:Cd(Yc)}),xf=mn.optional.boolean($t.params.disabled).value,Ch=mn.optional.boolean($t.params.hidden).value,Kc=mt.controller({document:$t.document,params:gn.params,value:Mu.value,viewProps:Qt.create({disabled:xf,hidden:Ch})}),Tu=(cn=mn.optional.string($t.params.label).value)!==null&&cn!==void 0?cn:$t.target.key;return new Ha($t.document,{binding:Mu,blade:ae(),props:_e.fromObject({label:Tu}),valueController:Kc})}(pe,{document:y,params:U,target:M}),null);if(J)return J;throw new Re({context:{key:M.key},type:"nomatchingcontroller"})}createBlade(y,M){const U=this.pluginsMap_.blades.reduce((J,xe)=>J??function(pe,mt){const $t=pe.accept(mt.params);if(!$t)return null;const gi=It.optional.boolean(mt.params.disabled).value,ur=It.optional.boolean(mt.params.hidden).value;return pe.controller({blade:ae(),document:mt.document,params:Object.assign(Object.assign({},$t.params),{disabled:gi,hidden:ur}),viewProps:Qt.create({disabled:gi,hidden:ur})})}(xe,{document:y,params:M}),null);if(!U)throw new Re({type:"nomatchingview",context:{params:M}});return U}createBladeApi(y){if(y instanceof $n)return new fs(y);if(y instanceof Ha)return new dn(y);if(y instanceof ms)return new pn(y,this);const M=this.pluginsMap_.blades.reduce((U,J)=>U??J.api({controller:y,pool:this}),null);if(!M)throw Re.shouldNeverHappen();return M}}function Im(L){return rs.isObject(L)?new rs(L.x,L.y):new rs}function Vd(L,y){L.writeProperty("x",y.x),L.writeProperty("y",y.y)}function kn(L,y){if(!L)return;const M=[],U=Qc(L,y);U&&M.push(U);const J=or(L);return J&&M.push(J),new Br(M)}function Eh(L,y){const[M,U]=L?function(xe){const pe=gr(xe,Xa);if(pe)return[pe.values.get("min"),pe.values.get("max")];const mt=gr(xe,jo);return mt?[mt.minValue,mt.maxValue]:[void 0,void 0]}(L):[];if(!dt(M)||!dt(U))return Math.max(Math.abs(M??0),Math.abs(U??0));const J=Fc(L);return Math.max(10*Math.abs(J),10*Math.abs(y))}function Af(L,y){const M=y instanceof ys?y.components[0]:void 0,U=y instanceof ys?y.components[1]:void 0,J=Eh(M,L.x),xe=Eh(U,L.y);return Math.max(J,xe)}function xi(L,y){return{baseStep:Fc(y),constraint:y,textProps:_e.fromObject({draggingScale:Sl(y,L),formatter:gs(Bd(y,L))})}}function Ts(L){if(!("y"in L))return!1;const y=L.y;return!!y&&"inverted"in y&&!!y.inverted}const qc={id:"input-point2d",type:"input",accept:(L,y)=>{if(!rs.isObject(L))return null;const M=It,U=xt(y,{expanded:M.optional.boolean,picker:M.optional.custom(cf),x:M.optional.custom(El),y:M.optional.object({inverted:M.optional.boolean,max:M.optional.number,min:M.optional.number,step:M.optional.number})});return U?{initialValue:L,params:U}:null},binding:{reader:L=>Im,constraint:L=>{return y=L.params,M=L.initialValue,new ys({assembly:Wc,components:[kn("x"in y?y.x:void 0,M.x),kn("y"in y?y.y:void 0,M.y)]});var y,M},equals:rs.equals,writer:L=>Vd},controller:L=>{const y=L.document,M=L.value,U=L.constraint;if(!(U instanceof ys))throw Re.shouldNeverHappen();const J="expanded"in L.params?L.params.expanded:void 0,xe="picker"in L.params?L.params.picker:void 0;return new Ah(y,{axes:[xi(M.rawValue.x,U.components[0]),xi(M.rawValue.y,U.components[1])],expanded:J!=null&&J,invertsY:Ts(L.params),maxValue:Af(M.rawValue,U),parser:zo,pickerLayout:xe??"popup",value:M,viewProps:L.viewProps})}};class Rl extends Ke{constructor(y){super(y),this.emitter_=new vt,this.controller_.valueController.value.emitter.on("change",M=>{this.emitter_.emit("change",{event:new ut(this,M.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get options(){return this.controller_.valueController.props.get("options")}set options(y){this.controller_.valueController.props.set("options",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}}class wf extends Ke{constructor(y){super(y),this.emitter_=new vt,this.controller_.valueController.value.emitter.on("change",M=>{this.emitter_.emit("change",{event:new ut(this,M.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(y){this.controller_.valueController.sliderController.props.set("maxValue",y)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(y){this.controller_.valueController.sliderController.props.set("minValue",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}}class Is extends Ke{constructor(y){super(y),this.emitter_=new vt,this.controller_.valueController.value.emitter.on("change",M=>{this.emitter_.emit("change",{event:new ut(this,M.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(y){this.controller_.props.set("label",y)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(y){this.controller_.valueController.props.set("formatter",y)}get value(){return this.controller_.valueController.value.rawValue}set value(y){this.controller_.valueController.value.rawValue=y}on(y,M){const U=M.bind(this);return this.emitter_.on(y,J=>{U(J.event)}),this}}const Sh={id:"list",type:"blade",accept(L){const y=It,M=xt(L,{options:y.required.custom(Dd),value:y.required.raw,view:y.required.constant("list"),label:y.optional.string});return M?{params:M}:null},controller(L){const y=new Cs(Am(L.params.options)),M=he(L.params.value,{constraint:y}),U=new kc(L.document,{props:new _e({options:y.values.value("options")}),value:M,viewProps:L.viewProps});return new sn(L.document,{blade:L.blade,props:_e.fromObject({label:L.params.label}),valueController:U})},api(L){return L.controller instanceof sn&&L.controller.valueController instanceof kc?new Rl(L.controller):null}};class Sv extends uh{constructor(y,M){super(y,M)}get element(){return this.controller_.view.element}importPreset(y){(function(M,U){M.forEach(J=>{const xe=U[J.target.presetKey];xe!==void 0&&J.writer(J.target,J.reader(xe))})})(this.controller_.rackController.rack.find($n).map(M=>M.binding),y),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find($n).map(y=>y.binding.target).reduce((y,M)=>Object.assign(y,{[M.presetKey]:M.read()}),{})}refresh(){this.controller_.rackController.rack.find($n).forEach(y=>{y.binding.read()}),this.controller_.rackController.rack.find(Ha).forEach(y=>{y.binding.read()})}}class In extends Fo{constructor(y,M){super(y,{expanded:M.expanded,blade:M.blade,props:M.props,root:!0,viewProps:M.viewProps})}}const Gd={id:"slider",type:"blade",accept(L){const y=It,M=xt(L,{max:y.required.number,min:y.required.number,view:y.required.constant("slider"),format:y.optional.function,label:y.optional.string,value:y.optional.number});return M?{params:M}:null},controller(L){var y,M;const U=(y=L.params.value)!==null&&y!==void 0?y:0,J=new Xa({max:L.params.max,min:L.params.min}),xe=new lf(L.document,{baseStep:1,parser:zo,sliderProps:new _e({maxValue:J.values.value("max"),minValue:J.values.value("min")}),textProps:_e.fromObject({draggingScale:Sl(void 0,U),formatter:(M=L.params.format)!==null&&M!==void 0?M:xl}),value:he(U,{constraint:J}),viewProps:L.viewProps});return new sn(L.document,{blade:L.blade,props:_e.fromObject({label:L.params.label}),valueController:xe})},api(L){return L.controller instanceof sn&&L.controller.valueController instanceof lf?new wf(L.controller):null}},on={id:"text",type:"blade",accept(L){const y=It,M=xt(L,{parse:y.required.function,value:y.required.raw,view:y.required.constant("text"),format:y.optional.function,label:y.optional.string});return M?{params:M}:null},controller(L){var y;const M=new fu(L.document,{parser:L.params.parse,props:_e.fromObject({formatter:(y=L.params.format)!==null&&y!==void 0?y:U=>String(U)}),value:he(L.params.value),viewProps:L.viewProps});return new sn(L.document,{blade:L.blade,props:_e.fromObject({label:L.params.label}),valueController:M})},api(L){return L.controller instanceof sn&&L.controller.valueController instanceof fu?new Is(L.controller):null}};function Cv(L,y,M){if(L.querySelector(`style[data-tp-style=${y}]`))return;const U=L.createElement("style");U.dataset.tpStyle=y,U.textContent=M,L.head.appendChild(U)}const F_=new class{constructor(L){const[y,M]=L.split("-"),U=y.split(".");this.major=parseInt(U[0],10),this.minor=parseInt(U[1],10),this.patch=parseInt(U[2],10),this.prerelease=M??null}toString(){const L=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[L,this.prerelease].join("-"):L}}("3.1.6");p.BladeApi=Ke,p.ButtonApi=Ce,p.FolderApi=uh,p.InputBindingApi=fs,p.ListApi=Rl,p.MonitorBindingApi=dn,p.Pane=class extends Sv{constructor(L){var y,M;const U=L??{},J=(y=U.document)!==null&&y!==void 0?y:mi(),xe=function(){const pe=new Gs;return[qc,oc,_f,Hr,Yo,sc,Fd,Hc,bv,ba,bs,xh,No,bl,en,Wa].forEach(mt=>{pe.register(mt)}),pe}();super(new In(J,{expanded:U.expanded,blade:ae(),props:_e.fromObject({title:U.title}),viewProps:Qt.create()}),xe),this.pool_=xe,this.containerElem_=(M=U.container)!==null&&M!==void 0?M:function(pe){const mt=pe.createElement("div");return mt.classList.add(Fe("dfw")()),pe.body&&pe.body.appendChild(mt),mt}(J),this.containerElem_.appendChild(this.element),this.doc_=J,this.usesDefaultWrapper_=!U.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Re.alreadyDisposed();return this.doc_}dispose(){const L=this.containerElem_;if(!L)throw Re.alreadyDisposed();if(this.usesDefaultWrapper_){const y=L.parentElement;y&&y.removeChild(L)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(L){("plugin"in L?[L.plugin]:"plugins"in L?L.plugins:[]).forEach(y=>{this.pool_.register(y),this.embedPluginStyle_(y)})}embedPluginStyle_(L){L.css&&Cv(this.document,`plugin-${L.id}`,L.css)}setUpDefaultPlugins_(){Cv(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(L=>{this.embedPluginStyle_(L)}),this.registerPlugin({plugins:[Gd,Sh,Wa,on]})}},p.SeparatorApi=hh,p.SliderApi=wf,p.TabApi=Xi,p.TabPageApi=Fs,p.TextApi=Is,p.TpChangeEvent=ut,p.VERSION=F_,Object.defineProperty(p,"__esModule",{value:!0})})(V)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(kt){super(kt),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath(DRACOLoader2.LIB_CDN_PATH),this.setDecoderConfig({type:"js"})}transform(kt,V){return kt?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(kt,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(kt=!0,V=!1){return kt&&super.preload(),V&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async kt=>kt.text()).then(kt=>{const V=kt.indexOf("/* worker */");if(V<1)throw new Error("unable to load decoder module");return kt.substring(0,V-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}async _loadLibrary(kt,V){return DRACOLoader2.LibraryValueMap[kt]?DRACOLoader2.LibraryValueMap[kt]:DRACOLoader2.LibraryValueMap[kt]=await super._loadLibrary(kt,V)}static SetDecoderJsString(kt){this.LibraryValueMap["draco_decoder.js"]=kt}}DRACOLoader2.LIB_CDN_PATH="https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/",DRACOLoader2.LibraryValueMap={}},988:function(kt,V,p){p.d(V,{$TI:function(){return kl},$V:function(){return _w},$Vf:function(){return Sg},$YQ:function(){return np},A5E:function(){return Sv},AXT:function(){return Nf},Aip:function(){return UE},B02:function(){return dt},BFQ:function(){return Wa},BG$:function(){return es},BKK:function(){return kE},BVF:function(){return Qe},BVQ:function(){return Vf},BbS:function(){return T0},Bf4:function(){return ps},BtG:function(){return Pu},CJI:function(){return bs},CP7:function(){return ro},CaW:function(){return tf},CdI:function(){return nn},Cne:function(){return FE},CtA:function(){return ea},CtF:function(){return xn},D1R:function(){return _l},D67:function(){return Dd},D9w:function(){return Xi},DT1:function(){return BE},Djp:function(){return Mi},DqL:function(){return By},DvJ:function(){return eo},E2K:function(){return du},EB7:function(){return l0},EJi:function(){return el},EoG:function(){return Qn},F1y:function(){return cf},F5T:function(){return Gs},FDw:function(){return Jp},FE5:function(){return pg},FIo:function(){return nw},FM8:function(){return Jt},FT0:function(){return sw},FUD:function(){return pu},FvO:function(){return yw},GG6:function(){return Kl},GQ:function(){return xg},GUF:function(){return an},GVz:function(){return rc},GZb:function(){return xw},G_r:function(){return kr},Gih:function(){return On},Gql:function(){return pE},H$k:function(){return hg},HTd:function(){return ch},HW6:function(){return ao},HdW:function(){return Si},HgB:function(){return wm},HkE:function(){return Eo},Hmr:function(){return Gy},Hw6:function(){return yu},Hy8:function(){return ot},Hyl:function(){return $o},IEO:function(){return La},IFH:function(){return js},IKL:function(){return Iy},ILR:function(){return Lc},IOt:function(){return Ca},Ilk:function(){return xi},Ir4:function(){return jc},JCZ:function(){return zc},JOQ:function(){return ra},JQ4:function(){return Fo},JUT:function(){return gf},JWc:function(){return fh},Jjb:function(){return Bd},KI_:function(){return Yi},Kgo:function(){return ru},KhW:function(){return He},Kj0:function(){return Ut},Kz5:function(){return vm},L5g:function(){return NE},L5s:function(){return jy},LBq:function(){return so},LSk:function(){return Vo},LY2:function(){return Ga},L_r:function(){return da},Lcc:function(){return zE},LgZ:function(){return xt},LsT:function(){return hu},Ltg:function(){return Tr},Lun:function(){return rp},M$G:function(){return El},M5h:function(){return $e},M6v:function(){return rr},M8C:function(){return xv},Mig:function(){return Uy},MyG:function(){return L_},N$j:function(){return Lh},N4l:function(){return Ue},NDo:function(){return zr},NMF:function(){return Uc},NYV:function(){return kc},Ns1:function(){return Oi},NwF:function(){return So},Ny0:function(){return kh},O78:function(){return uf},O7d:function(){return Wf},OAl:function(){return U_},OM3:function(){return mt},OTo:function(){return dh},OdW:function(){return Jm},OoA:function(){return $n},Ox3:function(){return lw},PA7:function(){return of},PMe:function(){return ky},Pa4:function(){return Se},PeU:function(){return tt},Pnf:function(){return Jl},PpQ:function(){return Sm},QM0:function(){return bv},QRU:function(){return Vy},QZ1:function(){return go},QmN:function(){return ut},Qpg:function(){return Wh},R2R:function(){return _0},REq:function(){return LE},RNb:function(){return Cv},ROQ:function(){return GA},RSm:function(){return g0},Rki:function(){return Zy},RlZ:function(){return Qt},RsA:function(){return ct},RvT:function(){return bm},S2y:function(){return it},S3k:function(){return gg},S9g:function(){return Pl},SJI:function(){return Hy},SPe:function(){return i0},SUY:function(){return C0},Se2:function(){return oe},Sm8:function(){return ie},So8:function(){return gE},SvJ:function(){return nf},Syv:function(){return Al},T6w:function(){return Fc},T95:function(){return $p},TOt:function(){return WA},TUj:function(){return bg},TUv:function(){return jA},T_1:function(){return TE},T_J:function(){return yv},T__:function(){return c0},T_f:function(){return x0},TlE:function(){return on},Tme:function(){return Nr},Tn7:function(){return My},TyD:function(){return dn},U7:function(){return jf},USm:function(){return Ah},UY4:function(){return ig},UZH:function(){return Ke},Uk6:function(){return iw},UlW:function(){return Id},Uol:function(){return _c},V1s:function(){return Dv},V4E:function(){return as},VLJ:function(){return wg},VYz:function(){return yE},Vdb:function(){return Bt},Vj0:function(){return Pn},Vkp:function(){return _r},VzW:function(){return bl},W2J:function(){return Sl},WMw:function(){return Ft},WTc:function(){return F_},WXh:function(){return Xf},Wbm:function(){return ce},WdD:function(){return Er},Wid:function(){return qf},Wjw:function(){return OE},Wl3:function(){return lt},Wpd:function(){return Rt},Wqd:function(){return QA},WwZ:function(){return wl},Wzm:function(){return VA},XZw:function(){return jE},Xaj:function(){return Z},Xcj:function(){return mw},XvJ:function(){return dg},Y8D:function(){return Ot},YBo:function(){return mp},YGz:function(){return $r},YKA:function(){return af},YLQ:function(){return Ha},YN5:function(){return IE},YT8:function(){return h0},Ywn:function(){return Ev},Z6B:function(){return vo},ZAu:function(){return ws},ZQ6:function(){return d0},ZRs:function(){return wn},ZTh:function(){return qa},ZZA:function(){return uE},Z_g:function(){return ns},Zen:function(){return Am},Zp0:function(){return Fy},Zr5:function(){return Ie},ZzF:function(){return ia},Zzh:function(){return Wy},_12:function(){return Jc},_3:function(){return RE},_AM:function(){return Ed},_C8:function(){return Qu},_Li:function(){return Ce},_MY:function(){return At},_RZ:function(){return Go},_YM:function(){return Ds},_YX:function(){return CE},_am:function(){return Zc},_fP:function(){return Vs},_iA:function(){return Mt},_kC:function(){return wc},_lf:function(){return $l},_sL:function(){return gu},a$l:function(){return pe},aCh:function(){return Ya},aH4:function(){return vl},aLr:function(){return Pa},aNw:function(){return Hs},aVm:function(){return y},ad5:function(){return vv},anP:function(){return kv},aq0:function(){return ME},av9:function(){return Ci},b5g:function(){return Df},bBp:function(){return pw},bGH:function(){return ee},b_z:function(){return og},bdR:function(){return Ct},blk:function(){return s0},bnF:function(){return fp},brP:function(){return Mn},bsb:function(){return ha},c8b:function(){return he},cBI:function(){return Ky},cBK:function(){return hE},cJO:function(){return Gu},cLu:function(){return sn},cPb:function(){return vn},cRx:function(){return ql},cU9:function(){return Kf},ce8:function(){return vu},cek:function(){return Ec},cum:function(){return lf},dSO:function(){return An},dUE:function(){return Vh},dYG:function(){return fg},dZ3:function(){return No},dd2:function(){return zs},dj0:function(){return hf},dpR:function(){return Zf},dwk:function(){return Re},e62:function(){return xe},eD:function(){return Wt},eMJ:function(){return mo},eaV:function(){return Cd},ehD:function(){return vt},ejS:function(){return vc},ekQ:function(){return gr},epp:function(){return ta},fHI:function(){return Uh},fO1:function(){return ng},fQA:function(){return Zu},fQK:function(){return uy},fSK:function(){return jt},fY$:function(){return ae},fto:function(){return _m},g8_:function(){return cr},gH0:function(){return vw},gSk:function(){return Td},g_z:function(){return Ff},ghN:function(){return _e},gi4:function(){return Xn},gti:function(){return zf},hEm:function(){return Fs},hH6:function(){return Ac},iAb:function(){return ms},iDF:function(){return yc},iKG:function(){return Ao},iLg:function(){return tl},iMs:function(){return SE},iUV:function(){return Qr},iWC:function(){return gt},iWj:function(){return Ef},i_9:function(){return vE},iiP:function(){return fu},irR:function(){return ef},j4z:function(){return N_},j87:function(){return U},jAl:function(){return vr},jFi:function(){return Fe},jZA:function(){return Cs},jfJ:function(){return _v},jwo:function(){return ym},jyi:function(){return Lu},jyz:function(){return cc},k0A:function(){return hh},k74:function(){return It},kB5:function(){return Bh},kFz:function(){return Vc},kaV:function(){return jn},knz:function(){return xl},kqm:function(){return bE},ksN:function(){return ti},l0P:function(){return Br},l8J:function(){return df},lCJ:function(){return J},lDi:function(){return Ny},lGU:function(){return sf},lLk:function(){return mg},lRF:function(){return io},lRj:function(){return fo},lb7:function(){return lp},lfu:function(){return Wu},lk7:function(){return To},m7l:function(){return il},mSO:function(){return Tn},mTL:function(){return mE},mXe:function(){return hp},m_w:function(){return DE},mzJ:function(){return EE},nls:function(){return wa},ntZ:function(){return pt},ntt:function(){return Nc},nvb:function(){return $y},o8S:function(){return Hu},oAp:function(){return V_},oa8:function(){return jh},oqc:function(){return vs},p3g:function(){return Qo},p7y:function(){return Fu},pBf:function(){return sr},pIN:function(){return Md},pKu:function(){return rf},pQR:function(){return Fh},ptH:function(){return Xa},qhX:function(){return Lr},qkB:function(){return ai},qlB:function(){return M},qyh:function(){return uh},rAo:function(){return L},rBU:function(){return _i},rDY:function(){return Bm},rOj:function(){return Ne},r_:function(){return K},rnI:function(){return Pd},rpg:function(){return br},s4_:function(){return Ll},sYA:function(){return rl},tEQ:function(){return Dy},tGC:function(){return L0},tJx:function(){return Jy},tUh:function(){return sa},tf:function(){return I0},tm_:function(){return _t},trn:function(){return PE},u37:function(){return uw},u7G:function(){return E0},u9r:function(){return hr},uEv:function(){return mu},uL9:function(){return Vr},uWy:function(){return fs},uXU:function(){return Rd},ub3:function(){return at},ujx:function(){return Pr},v3W:function(){return zi},v9Y:function(){return Av},vBJ:function(){return qc},vCF:function(){return We},vCx:function(){return Sd},vZf:function(){return xd},vmT:function(){return Mo},vpT:function(){return Xv},vuL:function(){return Zl},vxC:function(){return Gr},w$m:function(){return mi},wJv:function(){return Wn},wem:function(){return pn},wk1:function(){return en},woe:function(){return py},wuA:function(){return Qa},x12:function(){return Uu},x5V:function(){return Ar},xEZ:function(){return xr},xG9:function(){return Yy},xJs:function(){return Yl},xWb:function(){return _g},xeV:function(){return qv},xfE:function(){return hn},xo$:function(){return zh},xoQ:function(){return ph},xoR:function(){return Ty},xsS:function(){return dy},y$t:function(){return Nu},y2t:function(){return jo},y8_:function(){return ww},yC1:function(){return bc},yGw:function(){return or},ybr:function(){return Wv},yj7:function(){return yy},ylh:function(){return P0},yo9:function(){return Wm},yt0:function(){return k_},ywz:function(){return yl},yxD:function(){return ow},z$h:function(){return zo},z81:function(){return gs},z8B:function(){return Of},zHn:function(){return Qc},zbs:function(){return aw},zf8:function(){return dp}});const Ke="153",ct={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ut={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},tt=0,_t=1,it=2,dt=3,At=0,Mt=1,pt=2,Re=3,lt=0,Ce=1,vt=2,at=2,Fe=0,Ct=1,Ft=2,Ue=3,$e=4,Z=5,ee=100,ce=101,Ne=102,K=103,ie=104,he=200,_e=201,He=202,gt=203,It=204,xt=205,jt=206,ot=207,Bt=208,Rt=209,Qt=210,Qe=0,oe=1,Ie=2,We=3,Wt=4,ti=5,mi=6,rr=7,Oi=0,Lr=1,zr=2,Vr=0,Qn=1,nn=2,$r=3,Ga=4,No=5,hn=300,ae=301,Gr=302,An=303,ps=304,cr=306,br=1e3,fs=1001,$n=1002,dn=1003,Ha=1004,ch=1004,vl=1005,xd=1005,pn=1006,uh=1007,fo=1007,_l=1008,Jp=1008,yl=1009,$p=1010,ms=1011,hu=1012,vm=1013,Fo=1014,bl=1015,sn=1016,hh=1017,ef=1018,Wn=1020,dh=1021,en=1023,Ot=1024,ql=1025,ai=1026,Mn=1027,Fs=1028,Xi=1029,Ci=1030,ea=1031,du=1033,Qa=33776,Wa=33777,zi=33778,Lc=33779,Ed=35840,Sd=35841,Cd=35842,tf=35843,_m=36196,Br=37492,gr=37496,Xa=37808,Cs=37809,jo=37810,Xn=37811,Mi=37812,es=37813,kc=37814,Yl=37815,rf=37816,Kl=37817,On=37818,pu=37819,fu=37820,nf=37821,ha=36492,Si=36283,Zl=36284,qa=36285,sf=36286,vr=2200,af=2201,mu=2202,Al=2300,Uc=2301,Md=2302,Jl=2400,$l=2401,gu=2402,js=2500,Td=2501,wl=0,Id=1,zo=2,Pd=3e3,xl=3001,gs=3200,Tn=3201,Ca=0,of=1,Ya="",Yi="srgb",an="srgb-linear",Nc="display-p3",kr="rgbm-16",vv=0,Ar=7680,vu=7681,wn=7682,_v=7683,vs=34055,yv=34056,mo=5386,L_=512,Rd=513,ym=514,k_=515,U_=516,bm=517,N_=518,lf=519,ph=512,Dd=513,cf=514,El=515,Am=516,uf=517,Bd=518,Fc=519,Sl=35044,hf=35048,go=35040,fh=35045,bv=35049,jc=35041,wm=35046,df=35050,vo=35042,Av="100",Vo="300 es",da=1035,Go=2e3,zc=2001;class sr{addEventListener(n,c){this._listeners===void 0&&(this._listeners={});const d=this._listeners;d[n]===void 0&&(d[n]=[]),d[n].indexOf(c)===-1&&d[n].push(c)}hasEventListener(n,c){if(this._listeners===void 0)return!1;const d=this._listeners;return d[n]!==void 0&&d[n].indexOf(c)!==-1}removeEventListener(n,c){if(this._listeners===void 0)return;const d=this._listeners[n];if(d!==void 0){const m=d.indexOf(c);m!==-1&&d.splice(m,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const c=this._listeners[n.type];if(c!==void 0){n.target=this;const d=c.slice(0);for(let m=0,v=d.length;m<v;m++)d[m].call(this,n);n.target=null}}}const fn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wv=1234567;const _u=Math.PI/180,ec=180/Math.PI;function ts(){const b=4294967295*Math.random()|0,n=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(fn[255&b]+fn[b>>8&255]+fn[b>>16&255]+fn[b>>24&255]+"-"+fn[255&n]+fn[n>>8&255]+"-"+fn[n>>16&15|64]+fn[n>>24&255]+"-"+fn[63&c|128]+fn[c>>8&255]+"-"+fn[c>>16&255]+fn[c>>24&255]+fn[255&d]+fn[d>>8&255]+fn[d>>16&255]+fn[d>>24&255]).toLowerCase()}function Kr(b,n,c){return Math.max(n,Math.min(c,b))}function pa(b,n){return(b%n+n)%n}function Cl(b,n,c){return(1-c)*b+c*n}function fa(b){return(b&b-1)==0&&b!==0}function pf(b){return Math.pow(2,Math.ceil(Math.log(b)/Math.LN2))}function Ho(b){return Math.pow(2,Math.floor(Math.log(b)/Math.LN2))}function is(b,n){switch(n.constructor){case Float32Array:return b;case Uint32Array:return b/4294967295;case Uint16Array:return b/65535;case Uint8Array:return b/255;case Int32Array:return Math.max(b/2147483647,-1);case Int16Array:return Math.max(b/32767,-1);case Int8Array:return Math.max(b/127,-1);default:throw new Error("Invalid component type.")}}function Ji(b,n){switch(n.constructor){case Float32Array:return b;case Uint32Array:return Math.round(4294967295*b);case Uint16Array:return Math.round(65535*b);case Uint8Array:return Math.round(255*b);case Int32Array:return Math.round(2147483647*b);case Int16Array:return Math.round(32767*b);case Int8Array:return Math.round(127*b);default:throw new Error("Invalid component type.")}}const xv={DEG2RAD:_u,RAD2DEG:ec,generateUUID:ts,clamp:Kr,euclideanModulo:pa,mapLinear:function(b,n,c,d,m){return d+(b-n)*(m-d)/(c-n)},inverseLerp:function(b,n,c){return b!==n?(c-b)/(n-b):0},lerp:Cl,damp:function(b,n,c,d){return Cl(b,n,1-Math.exp(-c*d))},pingpong:function(b,n=1){return n-Math.abs(pa(b,2*n)-n)},smoothstep:function(b,n,c){return b<=n?0:b>=c?1:(b=(b-n)/(c-n))*b*(3-2*b)},smootherstep:function(b,n,c){return b<=n?0:b>=c?1:(b=(b-n)/(c-n))*b*b*(b*(6*b-15)+10)},randInt:function(b,n){return b+Math.floor(Math.random()*(n-b+1))},randFloat:function(b,n){return b+Math.random()*(n-b)},randFloatSpread:function(b){return b*(.5-Math.random())},seededRandom:function(b){b!==void 0&&(wv=b);let n=wv+=1831565813;return n=Math.imul(n^n>>>15,1|n),n^=n+Math.imul(n^n>>>7,61|n),((n^n>>>14)>>>0)/4294967296},degToRad:function(b){return b*_u},radToDeg:function(b){return b*ec},isPowerOfTwo:fa,ceilPowerOfTwo:pf,floorPowerOfTwo:Ho,setQuaternionFromProperEuler:function(b,n,c,d,m){const v=Math.cos,w=Math.sin,C=v(c/2),P=w(c/2),D=v((n+d)/2),B=w((n+d)/2),j=v((n-d)/2),F=w((n-d)/2),z=v((d-n)/2),G=w((d-n)/2);switch(m){case"XYX":b.set(C*B,P*j,P*F,C*D);break;case"YZY":b.set(P*F,C*B,P*j,C*D);break;case"ZXZ":b.set(P*j,P*F,C*B,C*D);break;case"XZX":b.set(C*B,P*G,P*z,C*D);break;case"YXY":b.set(P*z,C*B,P*G,C*D);break;case"ZYZ":b.set(P*G,P*z,C*B,C*D);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+m)}},normalize:Ji,denormalize:is};class Jt{constructor(n=0,c=0){Jt.prototype.isVector2=!0,this.x=n,this.y=c}get width(){return this.x}set width(n){this.x=n}get height(){return this.y}set height(n){this.y=n}set(n,c){return this.x=n,this.y=c,this}setScalar(n){return this.x=n,this.y=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setComponent(n,c){switch(n){case 0:this.x=c;break;case 1:this.y=c;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y)}copy(n){return this.x=n.x,this.y=n.y,this}add(n){return this.x+=n.x,this.y+=n.y,this}addScalar(n){return this.x+=n,this.y+=n,this}addVectors(n,c){return this.x=n.x+c.x,this.y=n.y+c.y,this}addScaledVector(n,c){return this.x+=n.x*c,this.y+=n.y*c,this}sub(n){return this.x-=n.x,this.y-=n.y,this}subScalar(n){return this.x-=n,this.y-=n,this}subVectors(n,c){return this.x=n.x-c.x,this.y=n.y-c.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divide(n){return this.x/=n.x,this.y/=n.y,this}divideScalar(n){return this.multiplyScalar(1/n)}applyMatrix3(n){const c=this.x,d=this.y,m=n.elements;return this.x=m[0]*c+m[3]*d+m[6],this.y=m[1]*c+m[4]*d+m[7],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this}clamp(n,c){return this.x=Math.max(n.x,Math.min(c.x,this.x)),this.y=Math.max(n.y,Math.min(c.y,this.y)),this}clampScalar(n,c){return this.x=Math.max(n,Math.min(c,this.x)),this.y=Math.max(n,Math.min(c,this.y)),this}clampLength(n,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(n,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(n){const c=Math.sqrt(this.lengthSq()*n.lengthSq());if(c===0)return Math.PI/2;const d=this.dot(n)/c;return Math.acos(Kr(d,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const c=this.x-n.x,d=this.y-n.y;return c*c+d*d}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,c){return this.x+=(n.x-this.x)*c,this.y+=(n.y-this.y)*c,this}lerpVectors(n,c,d){return this.x=n.x+(c.x-n.x)*d,this.y=n.y+(c.y-n.y)*d,this}equals(n){return n.x===this.x&&n.y===this.y}fromArray(n,c=0){return this.x=n[c],this.y=n[c+1],this}toArray(n=[],c=0){return n[c]=this.x,n[c+1]=this.y,n}fromBufferAttribute(n,c){return this.x=n.getX(c),this.y=n.getY(c),this}rotateAround(n,c){const d=Math.cos(c),m=Math.sin(c),v=this.x-n.x,w=this.y-n.y;return this.x=v*d-w*m+n.x,this.y=v*m+w*d+n.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class _r{constructor(n,c,d,m,v,w,C,P,D){_r.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],n!==void 0&&this.set(n,c,d,m,v,w,C,P,D)}set(n,c,d,m,v,w,C,P,D){const B=this.elements;return B[0]=n,B[1]=m,B[2]=C,B[3]=c,B[4]=v,B[5]=P,B[6]=d,B[7]=w,B[8]=D,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(n){const c=this.elements,d=n.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],this}extractBasis(n,c,d){return n.setFromMatrix3Column(this,0),c.setFromMatrix3Column(this,1),d.setFromMatrix3Column(this,2),this}setFromMatrix4(n){const c=n.elements;return this.set(c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]),this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,c){const d=n.elements,m=c.elements,v=this.elements,w=d[0],C=d[3],P=d[6],D=d[1],B=d[4],j=d[7],F=d[2],z=d[5],G=d[8],W=m[0],Q=m[3],$=m[6],Y=m[1],q=m[4],be=m[7],we=m[2],me=m[5],Be=m[8];return v[0]=w*W+C*Y+P*we,v[3]=w*Q+C*q+P*me,v[6]=w*$+C*be+P*Be,v[1]=D*W+B*Y+j*we,v[4]=D*Q+B*q+j*me,v[7]=D*$+B*be+j*Be,v[2]=F*W+z*Y+G*we,v[5]=F*Q+z*q+G*me,v[8]=F*$+z*be+G*Be,this}multiplyScalar(n){const c=this.elements;return c[0]*=n,c[3]*=n,c[6]*=n,c[1]*=n,c[4]*=n,c[7]*=n,c[2]*=n,c[5]*=n,c[8]*=n,this}determinant(){const n=this.elements,c=n[0],d=n[1],m=n[2],v=n[3],w=n[4],C=n[5],P=n[6],D=n[7],B=n[8];return c*w*B-c*C*D-d*v*B+d*C*P+m*v*D-m*w*P}invert(){const n=this.elements,c=n[0],d=n[1],m=n[2],v=n[3],w=n[4],C=n[5],P=n[6],D=n[7],B=n[8],j=B*w-C*D,F=C*P-B*v,z=D*v-w*P,G=c*j+d*F+m*z;if(G===0)return this.set(0,0,0,0,0,0,0,0,0);const W=1/G;return n[0]=j*W,n[1]=(m*D-B*d)*W,n[2]=(C*d-m*w)*W,n[3]=F*W,n[4]=(B*c-m*P)*W,n[5]=(m*v-C*c)*W,n[6]=z*W,n[7]=(d*P-D*c)*W,n[8]=(w*c-d*v)*W,this}transpose(){let n;const c=this.elements;return n=c[1],c[1]=c[3],c[3]=n,n=c[2],c[2]=c[6],c[6]=n,n=c[5],c[5]=c[7],c[7]=n,this}getNormalMatrix(n){return this.setFromMatrix4(n).invert().transpose()}transposeIntoArray(n){const c=this.elements;return n[0]=c[0],n[1]=c[3],n[2]=c[6],n[3]=c[1],n[4]=c[4],n[5]=c[7],n[6]=c[2],n[7]=c[5],n[8]=c[8],this}setUvTransform(n,c,d,m,v,w,C){const P=Math.cos(v),D=Math.sin(v);return this.set(d*P,d*D,-d*(P*w+D*C)+w+n,-m*D,m*P,-m*(-D*w+P*C)+C+c,0,0,1),this}scale(n,c){return this.premultiply(Od.makeScale(n,c)),this}rotate(n){return this.premultiply(Od.makeRotation(-n)),this}translate(n,c){return this.premultiply(Od.makeTranslation(n,c)),this}makeTranslation(n,c){return n.isVector2?this.set(1,0,n.x,0,1,n.y,0,0,1):this.set(1,0,n,0,1,c,0,0,1),this}makeRotation(n){const c=Math.cos(n),d=Math.sin(n);return this.set(c,-d,0,d,c,0,0,0,1),this}makeScale(n,c){return this.set(n,0,0,0,c,0,0,0,1),this}equals(n){const c=this.elements,d=n.elements;for(let m=0;m<9;m++)if(c[m]!==d[m])return!1;return!0}fromArray(n,c=0){for(let d=0;d<9;d++)this.elements[d]=n[d+c];return this}toArray(n=[],c=0){const d=this.elements;return n[c]=d[0],n[c+1]=d[1],n[c+2]=d[2],n[c+3]=d[3],n[c+4]=d[4],n[c+5]=d[5],n[c+6]=d[6],n[c+7]=d[7],n[c+8]=d[8],n}clone(){return new this.constructor().fromArray(this.elements)}}const Od=new _r;function mh(b){for(let n=b.length-1;n>=0;--n)if(b[n]>=65535)return!0;return!1}const Ld={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ml(b,n){return new Ld[b](n)}function tc(b){return document.createElementNS("http://www.w3.org/1999/xhtml",b)}const xm={};function gh(b){b in xm||(xm[b]=!0,console.warn(b))}function vh(b){return b<.04045?.0773993808*b:Math.pow(.9478672986*b+.0521327014,2.4)}function kd(b){return b<.0031308?12.92*b:1.055*Math.pow(b,.41666)-.055}const Em=new _r().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),ff=new _r().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Ud={[an]:b=>b,[Yi]:b=>b.convertSRGBToLinear(),[Nc]:function(b){return b.convertSRGBToLinear().applyMatrix3(ff)}},mf={[an]:b=>b,[Yi]:b=>b.convertLinearToSRGB(),[Nc]:function(b){return b.applyMatrix3(Em).convertLinearToSRGB()}},ta={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(b){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!b},get workingColorSpace(){return an},set workingColorSpace(b){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(b,n,c){if(this.enabled===!1||n===c||!n||!c)return b;const d=Ud[n],m=mf[c];if(d===void 0||m===void 0)throw new Error(`Unsupported color space conversion, "${n}" to "${c}".`);return m(d(b))},fromWorkingColorSpace:function(b,n){return this.convert(b,this.workingColorSpace,n)},toWorkingColorSpace:function(b,n){return this.convert(b,n,this.workingColorSpace)}};let ic;class Sm{static getDataURL(n,c=!1){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let d;if(n instanceof HTMLCanvasElement)d=n;else{ic===void 0&&(ic=tc("canvas")),ic.width=n.width,ic.height=n.height;const m=ic.getContext("2d");n instanceof ImageData?m.putImageData(n,0,0):m.drawImage(n,0,0,n.width,n.height),d=ic}return!c&&(d.width>2048||d.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),d.toDataURL("image/jpeg",.6)):d.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const c=tc("canvas");c.width=n.width,c.height=n.height;const d=c.getContext("2d");d.drawImage(n,0,0,n.width,n.height);const m=d.getImageData(0,0,n.width,n.height),v=m.data;for(let w=0;w<v.length;w++)v[w]=255*vh(v[w]/255);return d.putImageData(m,0,0),c}if(n.data){const c=n.data.slice(0);for(let d=0;d<c.length;d++)c instanceof Uint8Array||c instanceof Uint8ClampedArray?c[d]=Math.floor(255*vh(c[d]/255)):c[d]=vh(c[d]);return{data:c,width:n.width,height:n.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}}let _h=0;class yu{constructor(n=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_h++}),this.uuid=ts(),this.data=n,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const c=n===void 0||typeof n=="string";if(!c&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const d={uuid:this.uuid,url:""},m=this.data;if(m!==null){let v;if(Array.isArray(m)){v=[];for(let w=0,C=m.length;w<C;w++)m[w].isDataTexture?v.push(Nd(m[w].image)):v.push(Nd(m[w]))}else v=Nd(m);d.url=v}return c||(n.images[this.uuid]=d),d}}function Nd(b){if(typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&b instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&b instanceof ImageBitmap)return Sm.getDataURL(b);if(b.data){let n=[];try{n=Array.from(b.data)}catch(c){c.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(c),n=b.data}return{data:n,width:b.width,height:b.height,type:b.data.constructor.name}}return b.url!==void 0?b.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Mr=0;class xr extends sr{constructor(n=xr.DEFAULT_IMAGE,c=xr.DEFAULT_MAPPING,d=fs,m=fs,v=pn,w=_l,C=en,P=yl,D=xr.DEFAULT_ANISOTROPY,B=Ya){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Mr++}),this.uuid=ts(),this.name="",this.source=new yu(n),this.mipmaps=[],this.mapping=c,this.channel=0,this.wrapS=d,this.wrapT=m,this.magFilter=v,this.minFilter=w,this.anisotropy=D,this.format=C,this.internalFormat=null,this.type=P,this.offset=new Jt(0,0),this.repeat=new Jt(1,1),this.center=new Jt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof B=="string"?this.colorSpace=B:(gh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=B===xl?Yi:Ya),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(n=null){this.source.data=n}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(n){return this.name=n.name,this.source=n.source,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.channel=n.channel,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.colorSpace=n.colorSpace,this.userData=JSON.parse(JSON.stringify(n.userData)),this.needsUpdate=!0,this}toJSON(n){const c=n===void 0||typeof n=="string";if(!c&&n.textures&&n.textures[this.uuid]!==void 0)return n.textures[this.uuid];const d={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(n).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Yi?xl:Pd,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(d.userData=this.userData),!c&&n.textures&&(n.textures[this.uuid]=d),d}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(n){if(this.mapping!==hn)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case br:n.x=n.x-Math.floor(n.x);break;case fs:n.x=n.x<0?0:1;break;case $n:Math.abs(Math.floor(n.x)%2)===1?n.x=Math.ceil(n.x)-n.x:n.x=n.x-Math.floor(n.x)}if(n.y<0||n.y>1)switch(this.wrapT){case br:n.y=n.y-Math.floor(n.y);break;case fs:n.y=n.y<0?0:1;break;case $n:Math.abs(Math.floor(n.y)%2)===1?n.y=Math.ceil(n.y)-n.y:n.y=n.y-Math.floor(n.y)}return this.flipY&&(n.y=1-n.y),n}set needsUpdate(n){n===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return gh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Yi?xl:Pd}set encoding(n){gh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=n===xl?Yi:Ya}}xr.DEFAULT_IMAGE=null,xr.DEFAULT_MAPPING=hn,xr.DEFAULT_ANISOTROPY=1;class Tr{constructor(n=0,c=0,d=0,m=1){Tr.prototype.isVector4=!0,this.x=n,this.y=c,this.z=d,this.w=m}get width(){return this.z}set width(n){this.z=n}get height(){return this.w}set height(n){this.w=n}set(n,c,d,m){return this.x=n,this.y=c,this.z=d,this.w=m,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this.w=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setW(n){return this.w=n,this}setComponent(n,c){switch(n){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w!==void 0?n.w:1,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this}addVectors(n,c){return this.x=n.x+c.x,this.y=n.y+c.y,this.z=n.z+c.z,this.w=n.w+c.w,this}addScaledVector(n,c){return this.x+=n.x*c,this.y+=n.y*c,this.z+=n.z*c,this.w+=n.w*c,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this}subVectors(n,c){return this.x=n.x-c.x,this.y=n.y-c.y,this.z=n.z-c.z,this.w=n.w-c.w,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this}applyMatrix4(n){const c=this.x,d=this.y,m=this.z,v=this.w,w=n.elements;return this.x=w[0]*c+w[4]*d+w[8]*m+w[12]*v,this.y=w[1]*c+w[5]*d+w[9]*m+w[13]*v,this.z=w[2]*c+w[6]*d+w[10]*m+w[14]*v,this.w=w[3]*c+w[7]*d+w[11]*m+w[15]*v,this}divideScalar(n){return this.multiplyScalar(1/n)}setAxisAngleFromQuaternion(n){this.w=2*Math.acos(n.w);const c=Math.sqrt(1-n.w*n.w);return c<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/c,this.y=n.y/c,this.z=n.z/c),this}setAxisAngleFromRotationMatrix(n){let c,d,m,v;const w=n.elements,C=w[0],P=w[4],D=w[8],B=w[1],j=w[5],F=w[9],z=w[2],G=w[6],W=w[10];if(Math.abs(P-B)<.01&&Math.abs(D-z)<.01&&Math.abs(F-G)<.01){if(Math.abs(P+B)<.1&&Math.abs(D+z)<.1&&Math.abs(F+G)<.1&&Math.abs(C+j+W-3)<.1)return this.set(1,0,0,0),this;c=Math.PI;const $=(C+1)/2,Y=(j+1)/2,q=(W+1)/2,be=(P+B)/4,we=(D+z)/4,me=(F+G)/4;return $>Y&&$>q?$<.01?(d=0,m=.707106781,v=.707106781):(d=Math.sqrt($),m=be/d,v=we/d):Y>q?Y<.01?(d=.707106781,m=0,v=.707106781):(m=Math.sqrt(Y),d=be/m,v=me/m):q<.01?(d=.707106781,m=.707106781,v=0):(v=Math.sqrt(q),d=we/v,m=me/v),this.set(d,m,v,c),this}let Q=Math.sqrt((G-F)*(G-F)+(D-z)*(D-z)+(B-P)*(B-P));return Math.abs(Q)<.001&&(Q=1),this.x=(G-F)/Q,this.y=(D-z)/Q,this.z=(B-P)/Q,this.w=Math.acos((C+j+W-1)/2),this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this}clamp(n,c){return this.x=Math.max(n.x,Math.min(c.x,this.x)),this.y=Math.max(n.y,Math.min(c.y,this.y)),this.z=Math.max(n.z,Math.min(c.z,this.z)),this.w=Math.max(n.w,Math.min(c.w,this.w)),this}clampScalar(n,c){return this.x=Math.max(n,Math.min(c,this.x)),this.y=Math.max(n,Math.min(c,this.y)),this.z=Math.max(n,Math.min(c,this.z)),this.w=Math.max(n,Math.min(c,this.w)),this}clampLength(n,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(n,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,c){return this.x+=(n.x-this.x)*c,this.y+=(n.y-this.y)*c,this.z+=(n.z-this.z)*c,this.w+=(n.w-this.w)*c,this}lerpVectors(n,c,d){return this.x=n.x+(c.x-n.x)*d,this.y=n.y+(c.y-n.y)*d,this.z=n.z+(c.z-n.z)*d,this.w=n.w+(c.w-n.w)*d,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w}fromArray(n,c=0){return this.x=n[c],this.y=n[c+1],this.z=n[c+2],this.w=n[c+3],this}toArray(n=[],c=0){return n[c]=this.x,n[c+1]=this.y,n[c+2]=this.z,n[c+3]=this.w,n}fromBufferAttribute(n,c){return this.x=n.getX(c),this.y=n.getY(c),this.z=n.getZ(c),this.w=n.getW(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class zs extends sr{constructor(n=1,c=1,d={}){super(),this.isWebGLRenderTarget=!0,this.width=n,this.height=c,this.depth=1,this.scissor=new Tr(0,0,n,c),this.scissorTest=!1,this.viewport=new Tr(0,0,n,c);const m={width:n,height:c,depth:1};d.encoding!==void 0&&(gh("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),d.colorSpace=d.encoding===xl?Yi:Ya),this.texture=new xr(m,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=d.generateMipmaps!==void 0&&d.generateMipmaps,this.texture.internalFormat=d.internalFormat!==void 0?d.internalFormat:null,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:pn,this.depthBuffer=d.depthBuffer===void 0||d.depthBuffer,this.stencilBuffer=d.stencilBuffer!==void 0&&d.stencilBuffer,this.depthTexture=d.depthTexture!==void 0?d.depthTexture:null,this.samples=d.samples!==void 0?d.samples:0}setSize(n,c,d=1){this.width===n&&this.height===c&&this.depth===d||(this.width=n,this.height=c,this.depth=d,this.texture.image.width=n,this.texture.image.height=c,this.texture.image.depth=d,this.dispose()),this.viewport.set(0,0,n,c),this.scissor.set(0,0,n,c)}clone(){return new this.constructor().copy(this)}copy(n){this.width=n.width,this.height=n.height,this.depth=n.depth,this.scissor.copy(n.scissor),this.scissorTest=n.scissorTest,this.viewport.copy(n.viewport),this.texture=n.texture.clone(),this.texture.isRenderTargetTexture=!0;const c=Object.assign({},n.texture.image);return this.texture.source=new yu(c),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.samples=n.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Qo extends xr{constructor(n=null,c=1,d=1,m=1){super(null),this.isDataArrayTexture=!0,this.image={data:n,width:c,height:d,depth:m},this.magFilter=dn,this.minFilter=dn,this.wrapR=fs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class rc extends zs{constructor(n=1,c=1,d=1){super(n,c),this.isWebGLArrayRenderTarget=!0,this.depth=d,this.texture=new Qo(null,n,c,d),this.texture.isRenderTargetTexture=!0}}class gf extends xr{constructor(n=null,c=1,d=1,m=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:c,height:d,depth:m},this.magFilter=dn,this.minFilter=dn,this.wrapR=fs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ev extends zs{constructor(n=1,c=1,d=1){super(n,c),this.isWebGL3DRenderTarget=!0,this.depth=d,this.texture=new gf(null,n,c,d),this.texture.isRenderTargetTexture=!0}}class Vc extends zs{constructor(n=1,c=1,d=1,m={}){super(n,c,m),this.isWebGLMultipleRenderTargets=!0;const v=this.texture;this.texture=[];for(let w=0;w<d;w++)this.texture[w]=v.clone(),this.texture[w].isRenderTargetTexture=!0}setSize(n,c,d=1){if(this.width!==n||this.height!==c||this.depth!==d){this.width=n,this.height=c,this.depth=d;for(let m=0,v=this.texture.length;m<v;m++)this.texture[m].image.width=n,this.texture[m].image.height=c,this.texture[m].image.depth=d;this.dispose()}return this.viewport.set(0,0,n,c),this.scissor.set(0,0,n,c),this}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.scissor.copy(n.scissor),this.scissorTest=n.scissorTest,this.viewport.copy(n.viewport),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,n.depthTexture!==null&&(this.depthTexture=n.depthTexture.clone()),this.texture.length=0;for(let c=0,d=n.texture.length;c<d;c++)this.texture[c]=n.texture[c].clone(),this.texture[c].isRenderTargetTexture=!0;return this}}class Vs{constructor(n=0,c=0,d=0,m=1){this.isQuaternion=!0,this._x=n,this._y=c,this._z=d,this._w=m}static slerpFlat(n,c,d,m,v,w,C){let P=d[m+0],D=d[m+1],B=d[m+2],j=d[m+3];const F=v[w+0],z=v[w+1],G=v[w+2],W=v[w+3];if(C===0)return n[c+0]=P,n[c+1]=D,n[c+2]=B,void(n[c+3]=j);if(C===1)return n[c+0]=F,n[c+1]=z,n[c+2]=G,void(n[c+3]=W);if(j!==W||P!==F||D!==z||B!==G){let Q=1-C;const $=P*F+D*z+B*G+j*W,Y=$>=0?1:-1,q=1-$*$;if(q>Number.EPSILON){const we=Math.sqrt(q),me=Math.atan2(we,$*Y);Q=Math.sin(Q*me)/we,C=Math.sin(C*me)/we}const be=C*Y;if(P=P*Q+F*be,D=D*Q+z*be,B=B*Q+G*be,j=j*Q+W*be,Q===1-C){const we=1/Math.sqrt(P*P+D*D+B*B+j*j);P*=we,D*=we,B*=we,j*=we}}n[c]=P,n[c+1]=D,n[c+2]=B,n[c+3]=j}static multiplyQuaternionsFlat(n,c,d,m,v,w){const C=d[m],P=d[m+1],D=d[m+2],B=d[m+3],j=v[w],F=v[w+1],z=v[w+2],G=v[w+3];return n[c]=C*G+B*j+P*z-D*F,n[c+1]=P*G+B*F+D*j-C*z,n[c+2]=D*G+B*z+C*F-P*j,n[c+3]=B*G-C*j-P*F-D*z,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,c,d,m){return this._x=n,this._y=c,this._z=d,this._w=m,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,c){const d=n._x,m=n._y,v=n._z,w=n._order,C=Math.cos,P=Math.sin,D=C(d/2),B=C(m/2),j=C(v/2),F=P(d/2),z=P(m/2),G=P(v/2);switch(w){case"XYZ":this._x=F*B*j+D*z*G,this._y=D*z*j-F*B*G,this._z=D*B*G+F*z*j,this._w=D*B*j-F*z*G;break;case"YXZ":this._x=F*B*j+D*z*G,this._y=D*z*j-F*B*G,this._z=D*B*G-F*z*j,this._w=D*B*j+F*z*G;break;case"ZXY":this._x=F*B*j-D*z*G,this._y=D*z*j+F*B*G,this._z=D*B*G+F*z*j,this._w=D*B*j-F*z*G;break;case"ZYX":this._x=F*B*j-D*z*G,this._y=D*z*j+F*B*G,this._z=D*B*G-F*z*j,this._w=D*B*j+F*z*G;break;case"YZX":this._x=F*B*j+D*z*G,this._y=D*z*j+F*B*G,this._z=D*B*G-F*z*j,this._w=D*B*j-F*z*G;break;case"XZY":this._x=F*B*j-D*z*G,this._y=D*z*j-F*B*G,this._z=D*B*G+F*z*j,this._w=D*B*j+F*z*G;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+w)}return c!==!1&&this._onChangeCallback(),this}setFromAxisAngle(n,c){const d=c/2,m=Math.sin(d);return this._x=n.x*m,this._y=n.y*m,this._z=n.z*m,this._w=Math.cos(d),this._onChangeCallback(),this}setFromRotationMatrix(n){const c=n.elements,d=c[0],m=c[4],v=c[8],w=c[1],C=c[5],P=c[9],D=c[2],B=c[6],j=c[10],F=d+C+j;if(F>0){const z=.5/Math.sqrt(F+1);this._w=.25/z,this._x=(B-P)*z,this._y=(v-D)*z,this._z=(w-m)*z}else if(d>C&&d>j){const z=2*Math.sqrt(1+d-C-j);this._w=(B-P)/z,this._x=.25*z,this._y=(m+w)/z,this._z=(v+D)/z}else if(C>j){const z=2*Math.sqrt(1+C-d-j);this._w=(v-D)/z,this._x=(m+w)/z,this._y=.25*z,this._z=(P+B)/z}else{const z=2*Math.sqrt(1+j-d-C);this._w=(w-m)/z,this._x=(v+D)/z,this._y=(P+B)/z,this._z=.25*z}return this._onChangeCallback(),this}setFromUnitVectors(n,c){let d=n.dot(c)+1;return d<Number.EPSILON?(d=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=d):(this._x=0,this._y=-n.z,this._z=n.y,this._w=d)):(this._x=n.y*c.z-n.z*c.y,this._y=n.z*c.x-n.x*c.z,this._z=n.x*c.y-n.y*c.x,this._w=d),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(Kr(this.dot(n),-1,1)))}rotateTowards(n,c){const d=this.angleTo(n);if(d===0)return this;const m=Math.min(1,c/d);return this.slerp(n,m),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,c){const d=n._x,m=n._y,v=n._z,w=n._w,C=c._x,P=c._y,D=c._z,B=c._w;return this._x=d*B+w*C+m*D-v*P,this._y=m*B+w*P+v*C-d*D,this._z=v*B+w*D+d*P-m*C,this._w=w*B-d*C-m*P-v*D,this._onChangeCallback(),this}slerp(n,c){if(c===0)return this;if(c===1)return this.copy(n);const d=this._x,m=this._y,v=this._z,w=this._w;let C=w*n._w+d*n._x+m*n._y+v*n._z;if(C<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,C=-C):this.copy(n),C>=1)return this._w=w,this._x=d,this._y=m,this._z=v,this;const P=1-C*C;if(P<=Number.EPSILON){const z=1-c;return this._w=z*w+c*this._w,this._x=z*d+c*this._x,this._y=z*m+c*this._y,this._z=z*v+c*this._z,this.normalize(),this._onChangeCallback(),this}const D=Math.sqrt(P),B=Math.atan2(D,C),j=Math.sin((1-c)*B)/D,F=Math.sin(c*B)/D;return this._w=w*j+this._w*F,this._x=d*j+this._x*F,this._y=m*j+this._y*F,this._z=v*j+this._z*F,this._onChangeCallback(),this}slerpQuaternions(n,c,d){return this.copy(n).slerp(c,d)}random(){const n=Math.random(),c=Math.sqrt(1-n),d=Math.sqrt(n),m=2*Math.PI*Math.random(),v=2*Math.PI*Math.random();return this.set(c*Math.cos(m),d*Math.sin(v),d*Math.cos(v),c*Math.sin(m))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,c=0){return this._x=n[c],this._y=n[c+1],this._z=n[c+2],this._w=n[c+3],this._onChangeCallback(),this}toArray(n=[],c=0){return n[c]=this._x,n[c+1]=this._y,n[c+2]=this._z,n[c+3]=this._w,n}fromBufferAttribute(n,c){return this._x=n.getX(c),this._y=n.getY(c),this._z=n.getZ(c),this._w=n.getW(c),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Se{constructor(n=0,c=0,d=0){Se.prototype.isVector3=!0,this.x=n,this.y=c,this.z=d}set(n,c,d){return d===void 0&&(d=this.z),this.x=n,this.y=c,this.z=d,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setComponent(n,c){switch(n){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}add(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this}addVectors(n,c){return this.x=n.x+c.x,this.y=n.y+c.y,this.z=n.z+c.z,this}addScaledVector(n,c){return this.x+=n.x*c,this.y+=n.y*c,this.z+=n.z*c,this}sub(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this}subVectors(n,c){return this.x=n.x-c.x,this.y=n.y-c.y,this.z=n.z-c.z,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this}multiplyVectors(n,c){return this.x=n.x*c.x,this.y=n.y*c.y,this.z=n.z*c.z,this}applyEuler(n){return this.applyQuaternion(vf.setFromEuler(n))}applyAxisAngle(n,c){return this.applyQuaternion(vf.setFromAxisAngle(n,c))}applyMatrix3(n){const c=this.x,d=this.y,m=this.z,v=n.elements;return this.x=v[0]*c+v[3]*d+v[6]*m,this.y=v[1]*c+v[4]*d+v[7]*m,this.z=v[2]*c+v[5]*d+v[8]*m,this}applyNormalMatrix(n){return this.applyMatrix3(n).normalize()}applyMatrix4(n){const c=this.x,d=this.y,m=this.z,v=n.elements,w=1/(v[3]*c+v[7]*d+v[11]*m+v[15]);return this.x=(v[0]*c+v[4]*d+v[8]*m+v[12])*w,this.y=(v[1]*c+v[5]*d+v[9]*m+v[13])*w,this.z=(v[2]*c+v[6]*d+v[10]*m+v[14])*w,this}applyQuaternion(n){const c=this.x,d=this.y,m=this.z,v=n.x,w=n.y,C=n.z,P=n.w,D=P*c+w*m-C*d,B=P*d+C*c-v*m,j=P*m+v*d-w*c,F=-v*c-w*d-C*m;return this.x=D*P+F*-v+B*-C-j*-w,this.y=B*P+F*-w+j*-v-D*-C,this.z=j*P+F*-C+D*-w-B*-v,this}project(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)}unproject(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)}transformDirection(n){const c=this.x,d=this.y,m=this.z,v=n.elements;return this.x=v[0]*c+v[4]*d+v[8]*m,this.y=v[1]*c+v[5]*d+v[9]*m,this.z=v[2]*c+v[6]*d+v[10]*m,this.normalize()}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this}divideScalar(n){return this.multiplyScalar(1/n)}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this}clamp(n,c){return this.x=Math.max(n.x,Math.min(c.x,this.x)),this.y=Math.max(n.y,Math.min(c.y,this.y)),this.z=Math.max(n.z,Math.min(c.z,this.z)),this}clampScalar(n,c){return this.x=Math.max(n,Math.min(c,this.x)),this.y=Math.max(n,Math.min(c,this.y)),this.z=Math.max(n,Math.min(c,this.z)),this}clampLength(n,c){const d=this.length();return this.divideScalar(d||1).multiplyScalar(Math.max(n,Math.min(c,d)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,c){return this.x+=(n.x-this.x)*c,this.y+=(n.y-this.y)*c,this.z+=(n.z-this.z)*c,this}lerpVectors(n,c,d){return this.x=n.x+(c.x-n.x)*d,this.y=n.y+(c.y-n.y)*d,this.z=n.z+(c.z-n.z)*d,this}cross(n){return this.crossVectors(this,n)}crossVectors(n,c){const d=n.x,m=n.y,v=n.z,w=c.x,C=c.y,P=c.z;return this.x=m*P-v*C,this.y=v*w-d*P,this.z=d*C-m*w,this}projectOnVector(n){const c=n.lengthSq();if(c===0)return this.set(0,0,0);const d=n.dot(this)/c;return this.copy(n).multiplyScalar(d)}projectOnPlane(n){return yh.copy(this).projectOnVector(n),this.sub(yh)}reflect(n){return this.sub(yh.copy(n).multiplyScalar(2*this.dot(n)))}angleTo(n){const c=Math.sqrt(this.lengthSq()*n.lengthSq());if(c===0)return Math.PI/2;const d=this.dot(n)/c;return Math.acos(Kr(d,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const c=this.x-n.x,d=this.y-n.y,m=this.z-n.z;return c*c+d*d+m*m}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)}setFromSpherical(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)}setFromSphericalCoords(n,c,d){const m=Math.sin(c)*n;return this.x=m*Math.sin(d),this.y=Math.cos(c)*n,this.z=m*Math.cos(d),this}setFromCylindrical(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)}setFromCylindricalCoords(n,c,d){return this.x=n*Math.sin(c),this.y=d,this.z=n*Math.cos(c),this}setFromMatrixPosition(n){const c=n.elements;return this.x=c[12],this.y=c[13],this.z=c[14],this}setFromMatrixScale(n){const c=this.setFromMatrixColumn(n,0).length(),d=this.setFromMatrixColumn(n,1).length(),m=this.setFromMatrixColumn(n,2).length();return this.x=c,this.y=d,this.z=m,this}setFromMatrixColumn(n,c){return this.fromArray(n.elements,4*c)}setFromMatrix3Column(n,c){return this.fromArray(n.elements,3*c)}setFromEuler(n){return this.x=n._x,this.y=n._y,this.z=n._z,this}setFromColor(n){return this.x=n.r,this.y=n.g,this.z=n.b,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z}fromArray(n,c=0){return this.x=n[c],this.y=n[c+1],this.z=n[c+2],this}toArray(n=[],c=0){return n[c]=this.x,n[c+1]=this.y,n[c+2]=this.z,n}fromBufferAttribute(n,c){return this.x=n.getX(c),this.y=n.getY(c),this.z=n.getZ(c),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const n=2*(Math.random()-.5),c=Math.random()*Math.PI*2,d=Math.sqrt(1-n**2);return this.x=d*Math.cos(c),this.y=d*Math.sin(c),this.z=n,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const yh=new Se,vf=new Vs;class ia{constructor(n=new Se(1/0,1/0,1/0),c=new Se(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=c}set(n,c){return this.min.copy(n),this.max.copy(c),this}setFromArray(n){this.makeEmpty();for(let c=0,d=n.length;c<d;c+=3)this.expandByPoint(ma.fromArray(n,c));return this}setFromBufferAttribute(n){this.makeEmpty();for(let c=0,d=n.count;c<d;c++)this.expandByPoint(ma.fromBufferAttribute(n,c));return this}setFromPoints(n){this.makeEmpty();for(let c=0,d=n.length;c<d;c++)this.expandByPoint(n[c]);return this}setFromCenterAndSize(n,c){const d=ma.copy(c).multiplyScalar(.5);return this.min.copy(n).sub(d),this.max.copy(n).add(d),this}setFromObject(n,c=!1){return this.makeEmpty(),this.expandByObject(n,c)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,c=!1){if(n.updateWorldMatrix(!1,!1),n.boundingBox!==void 0)n.boundingBox===null&&n.computeBoundingBox(),_s.copy(n.boundingBox),_s.applyMatrix4(n.matrixWorld),this.union(_s);else{const m=n.geometry;if(m!==void 0)if(c&&m.attributes!==void 0&&m.attributes.position!==void 0){const v=m.attributes.position;for(let w=0,C=v.count;w<C;w++)ma.fromBufferAttribute(v,w).applyMatrix4(n.matrixWorld),this.expandByPoint(ma)}else m.boundingBox===null&&m.computeBoundingBox(),_s.copy(m.boundingBox),_s.applyMatrix4(n.matrixWorld),this.union(_s)}const d=n.children;for(let m=0,v=d.length;m<v;m++)this.expandByObject(d[m],c);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,c){return c.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,ma),ma.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let c,d;return n.normal.x>0?(c=n.normal.x*this.min.x,d=n.normal.x*this.max.x):(c=n.normal.x*this.max.x,d=n.normal.x*this.min.x),n.normal.y>0?(c+=n.normal.y*this.min.y,d+=n.normal.y*this.max.y):(c+=n.normal.y*this.max.y,d+=n.normal.y*this.min.y),n.normal.z>0?(c+=n.normal.z*this.min.z,d+=n.normal.z*this.max.z):(c+=n.normal.z*this.max.z,d+=n.normal.z*this.min.z),c<=-n.constant&&d>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(Tl),ga.subVectors(this.max,Tl),Ma.subVectors(n.a,Tl),Wo.subVectors(n.b,Tl),bu.subVectors(n.c,Tl),Xo.subVectors(Wo,Ma),nc.subVectors(bu,Wo),Gc.subVectors(Ma,bu);let c=[0,-Xo.z,Xo.y,0,-nc.z,nc.y,0,-Gc.z,Gc.y,Xo.z,0,-Xo.x,nc.z,0,-nc.x,Gc.z,0,-Gc.x,-Xo.y,Xo.x,0,-nc.y,nc.x,0,-Gc.y,Gc.x,0];return!!Ta(c,Ma,Wo,bu,ga)&&(c=[1,0,0,0,1,0,0,0,1],!!Ta(c,Ma,Wo,bu,ga)&&(Au.crossVectors(Xo,nc),c=[Au.x,Au.y,Au.z],Ta(c,Ma,Wo,bu,ga)))}clampPoint(n,c){return c.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,ma).distanceTo(n)}getBoundingSphere(n){return this.isEmpty()?n.makeEmpty():(this.getCenter(n.center),n.radius=.5*this.getSize(ma).length()),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()||(Ur[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),Ur[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),Ur[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),Ur[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),Ur[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),Ur[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),Ur[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),Ur[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(Ur)),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const Ur=[new Se,new Se,new Se,new Se,new Se,new Se,new Se,new Se],ma=new Se,_s=new ia,Ma=new Se,Wo=new Se,bu=new Se,Xo=new Se,nc=new Se,Gc=new Se,Tl=new Se,ga=new Se,Au=new Se,qo=new Se;function Ta(b,n,c,d,m){for(let v=0,w=b.length-3;v<=w;v+=3){qo.fromArray(b,v);const C=m.x*Math.abs(qo.x)+m.y*Math.abs(qo.y)+m.z*Math.abs(qo.z),P=n.dot(qo),D=c.dot(qo),B=d.dot(qo);if(Math.max(-Math.max(P,D,B),Math.min(P,D,B))>C)return!1}return!0}const wu=new ia,Ia=new Se,Hc=new Se;class Pa{constructor(n=new Se,c=-1){this.center=n,this.radius=c}set(n,c){return this.center.copy(n),this.radius=c,this}setFromPoints(n,c){const d=this.center;c!==void 0?d.copy(c):wu.setFromPoints(n).getCenter(d);let m=0;for(let v=0,w=n.length;v<w;v++)m=Math.max(m,d.distanceToSquared(n[v]));return this.radius=Math.sqrt(m),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const c=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=c*c}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,c){const d=this.center.distanceToSquared(n);return c.copy(n),d>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center)),c}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;Ia.subVectors(n,this.center);const c=Ia.lengthSq();if(c>this.radius*this.radius){const d=Math.sqrt(c),m=.5*(d-this.radius);this.center.addScaledVector(Ia,m/d),this.radius+=m}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(Hc.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(Ia.copy(n.center).add(Hc)),this.expandByPoint(Ia.copy(n.center).sub(Hc))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _o=new Se,Fd=new Se,sc=new Se,ys=new Se,bh=new Se,jd=new Se,Ka=new Se;class Qc{constructor(n=new Se,c=new Se(0,0,-1)){this.origin=n,this.direction=c}set(n,c){return this.origin.copy(n),this.direction.copy(c),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,c){return c.copy(this.origin).addScaledVector(this.direction,n)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,_o)),this}closestPointToPoint(n,c){c.subVectors(n,this.origin);const d=c.dot(this.direction);return d<0?c.copy(this.origin):c.copy(this.origin).addScaledVector(this.direction,d)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const c=_o.subVectors(n,this.origin).dot(this.direction);return c<0?this.origin.distanceToSquared(n):(_o.copy(this.origin).addScaledVector(this.direction,c),_o.distanceToSquared(n))}distanceSqToSegment(n,c,d,m){Fd.copy(n).add(c).multiplyScalar(.5),sc.copy(c).sub(n).normalize(),ys.copy(this.origin).sub(Fd);const v=.5*n.distanceTo(c),w=-this.direction.dot(sc),C=ys.dot(this.direction),P=-ys.dot(sc),D=ys.lengthSq(),B=Math.abs(1-w*w);let j,F,z,G;if(B>0)if(j=w*P-C,F=w*C-P,G=v*B,j>=0)if(F>=-G)if(F<=G){const W=1/B;j*=W,F*=W,z=j*(j+w*F+2*C)+F*(w*j+F+2*P)+D}else F=v,j=Math.max(0,-(w*F+C)),z=-j*j+F*(F+2*P)+D;else F=-v,j=Math.max(0,-(w*F+C)),z=-j*j+F*(F+2*P)+D;else F<=-G?(j=Math.max(0,-(-w*v+C)),F=j>0?-v:Math.min(Math.max(-v,-P),v),z=-j*j+F*(F+2*P)+D):F<=G?(j=0,F=Math.min(Math.max(-v,-P),v),z=F*(F+2*P)+D):(j=Math.max(0,-(w*v+C)),F=j>0?v:Math.min(Math.max(-v,-P),v),z=-j*j+F*(F+2*P)+D);else F=w>0?-v:v,j=Math.max(0,-(w*F+C)),z=-j*j+F*(F+2*P)+D;return d&&d.copy(this.origin).addScaledVector(this.direction,j),m&&m.copy(Fd).addScaledVector(sc,F),z}intersectSphere(n,c){_o.subVectors(n.center,this.origin);const d=_o.dot(this.direction),m=_o.dot(_o)-d*d,v=n.radius*n.radius;if(m>v)return null;const w=Math.sqrt(v-m),C=d-w,P=d+w;return P<0?null:C<0?this.at(P,c):this.at(C,c)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const c=n.normal.dot(this.direction);if(c===0)return n.distanceToPoint(this.origin)===0?0:null;const d=-(this.origin.dot(n.normal)+n.constant)/c;return d>=0?d:null}intersectPlane(n,c){const d=this.distanceToPlane(n);return d===null?null:this.at(d,c)}intersectsPlane(n){const c=n.distanceToPoint(this.origin);return c===0||n.normal.dot(this.direction)*c<0}intersectBox(n,c){let d,m,v,w,C,P;const D=1/this.direction.x,B=1/this.direction.y,j=1/this.direction.z,F=this.origin;return D>=0?(d=(n.min.x-F.x)*D,m=(n.max.x-F.x)*D):(d=(n.max.x-F.x)*D,m=(n.min.x-F.x)*D),B>=0?(v=(n.min.y-F.y)*B,w=(n.max.y-F.y)*B):(v=(n.max.y-F.y)*B,w=(n.min.y-F.y)*B),d>w||v>m?null:((v>d||isNaN(d))&&(d=v),(w<m||isNaN(m))&&(m=w),j>=0?(C=(n.min.z-F.z)*j,P=(n.max.z-F.z)*j):(C=(n.max.z-F.z)*j,P=(n.min.z-F.z)*j),d>P||C>m?null:((C>d||d!=d)&&(d=C),(P<m||m!=m)&&(m=P),m<0?null:this.at(d>=0?d:m,c)))}intersectsBox(n){return this.intersectBox(n,_o)!==null}intersectTriangle(n,c,d,m,v){bh.subVectors(c,n),jd.subVectors(d,n),Ka.crossVectors(bh,jd);let w,C=this.direction.dot(Ka);if(C>0){if(m)return null;w=1}else{if(!(C<0))return null;w=-1,C=-C}ys.subVectors(this.origin,n);const P=w*this.direction.dot(jd.crossVectors(ys,jd));if(P<0)return null;const D=w*this.direction.dot(bh.cross(ys));if(D<0||P+D>C)return null;const B=-w*ys.dot(Ka);return B<0?null:this.at(B/C,v)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class or{constructor(n,c,d,m,v,w,C,P,D,B,j,F,z,G,W,Q){or.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n!==void 0&&this.set(n,c,d,m,v,w,C,P,D,B,j,F,z,G,W,Q)}set(n,c,d,m,v,w,C,P,D,B,j,F,z,G,W,Q){const $=this.elements;return $[0]=n,$[4]=c,$[8]=d,$[12]=m,$[1]=v,$[5]=w,$[9]=C,$[13]=P,$[2]=D,$[6]=B,$[10]=j,$[14]=F,$[3]=z,$[7]=G,$[11]=W,$[15]=Q,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new or().fromArray(this.elements)}copy(n){const c=this.elements,d=n.elements;return c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this}copyPosition(n){const c=this.elements,d=n.elements;return c[12]=d[12],c[13]=d[13],c[14]=d[14],this}setFromMatrix3(n){const c=n.elements;return this.set(c[0],c[3],c[6],0,c[1],c[4],c[7],0,c[2],c[5],c[8],0,0,0,0,1),this}extractBasis(n,c,d){return n.setFromMatrixColumn(this,0),c.setFromMatrixColumn(this,1),d.setFromMatrixColumn(this,2),this}makeBasis(n,c,d){return this.set(n.x,c.x,d.x,0,n.y,c.y,d.y,0,n.z,c.z,d.z,0,0,0,0,1),this}extractRotation(n){const c=this.elements,d=n.elements,m=1/Yo.setFromMatrixColumn(n,0).length(),v=1/Yo.setFromMatrixColumn(n,1).length(),w=1/Yo.setFromMatrixColumn(n,2).length();return c[0]=d[0]*m,c[1]=d[1]*m,c[2]=d[2]*m,c[3]=0,c[4]=d[4]*v,c[5]=d[5]*v,c[6]=d[6]*v,c[7]=0,c[8]=d[8]*w,c[9]=d[9]*w,c[10]=d[10]*w,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromEuler(n){const c=this.elements,d=n.x,m=n.y,v=n.z,w=Math.cos(d),C=Math.sin(d),P=Math.cos(m),D=Math.sin(m),B=Math.cos(v),j=Math.sin(v);if(n.order==="XYZ"){const F=w*B,z=w*j,G=C*B,W=C*j;c[0]=P*B,c[4]=-P*j,c[8]=D,c[1]=z+G*D,c[5]=F-W*D,c[9]=-C*P,c[2]=W-F*D,c[6]=G+z*D,c[10]=w*P}else if(n.order==="YXZ"){const F=P*B,z=P*j,G=D*B,W=D*j;c[0]=F+W*C,c[4]=G*C-z,c[8]=w*D,c[1]=w*j,c[5]=w*B,c[9]=-C,c[2]=z*C-G,c[6]=W+F*C,c[10]=w*P}else if(n.order==="ZXY"){const F=P*B,z=P*j,G=D*B,W=D*j;c[0]=F-W*C,c[4]=-w*j,c[8]=G+z*C,c[1]=z+G*C,c[5]=w*B,c[9]=W-F*C,c[2]=-w*D,c[6]=C,c[10]=w*P}else if(n.order==="ZYX"){const F=w*B,z=w*j,G=C*B,W=C*j;c[0]=P*B,c[4]=G*D-z,c[8]=F*D+W,c[1]=P*j,c[5]=W*D+F,c[9]=z*D-G,c[2]=-D,c[6]=C*P,c[10]=w*P}else if(n.order==="YZX"){const F=w*P,z=w*D,G=C*P,W=C*D;c[0]=P*B,c[4]=W-F*j,c[8]=G*j+z,c[1]=j,c[5]=w*B,c[9]=-C*B,c[2]=-D*B,c[6]=z*j+G,c[10]=F-W*j}else if(n.order==="XZY"){const F=w*P,z=w*D,G=C*P,W=C*D;c[0]=P*B,c[4]=-j,c[8]=D*B,c[1]=F*j+W,c[5]=w*B,c[9]=z*j-G,c[2]=G*j-z,c[6]=C*B,c[10]=W*j+F}return c[3]=0,c[7]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}makeRotationFromQuaternion(n){return this.compose(Wc,n,Il)}lookAt(n,c,d){const m=this.elements;return Da.subVectors(n,c),Da.lengthSq()===0&&(Da.z=1),Da.normalize(),ac.crossVectors(d,Da),ac.lengthSq()===0&&(Math.abs(d.z)===1?Da.x+=1e-4:Da.z+=1e-4,Da.normalize(),ac.crossVectors(d,Da)),ac.normalize(),Ra.crossVectors(Da,ac),m[0]=ac.x,m[4]=Ra.x,m[8]=Da.x,m[1]=ac.y,m[5]=Ra.y,m[9]=Da.y,m[2]=ac.z,m[6]=Ra.z,m[10]=Da.z,this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,c){const d=n.elements,m=c.elements,v=this.elements,w=d[0],C=d[4],P=d[8],D=d[12],B=d[1],j=d[5],F=d[9],z=d[13],G=d[2],W=d[6],Q=d[10],$=d[14],Y=d[3],q=d[7],be=d[11],we=d[15],me=m[0],Be=m[4],Ze=m[8],et=m[12],ft=m[1],Le=m[5],Gt=m[9],Ht=m[13],ri=m[2],hi=m[6],ei=m[10],Xt=m[14],oi=m[3],Pt=m[7],Nt=m[11],ci=m[15];return v[0]=w*me+C*ft+P*ri+D*oi,v[4]=w*Be+C*Le+P*hi+D*Pt,v[8]=w*Ze+C*Gt+P*ei+D*Nt,v[12]=w*et+C*Ht+P*Xt+D*ci,v[1]=B*me+j*ft+F*ri+z*oi,v[5]=B*Be+j*Le+F*hi+z*Pt,v[9]=B*Ze+j*Gt+F*ei+z*Nt,v[13]=B*et+j*Ht+F*Xt+z*ci,v[2]=G*me+W*ft+Q*ri+$*oi,v[6]=G*Be+W*Le+Q*hi+$*Pt,v[10]=G*Ze+W*Gt+Q*ei+$*Nt,v[14]=G*et+W*Ht+Q*Xt+$*ci,v[3]=Y*me+q*ft+be*ri+we*oi,v[7]=Y*Be+q*Le+be*hi+we*Pt,v[11]=Y*Ze+q*Gt+be*ei+we*Nt,v[15]=Y*et+q*Ht+be*Xt+we*ci,this}multiplyScalar(n){const c=this.elements;return c[0]*=n,c[4]*=n,c[8]*=n,c[12]*=n,c[1]*=n,c[5]*=n,c[9]*=n,c[13]*=n,c[2]*=n,c[6]*=n,c[10]*=n,c[14]*=n,c[3]*=n,c[7]*=n,c[11]*=n,c[15]*=n,this}determinant(){const n=this.elements,c=n[0],d=n[4],m=n[8],v=n[12],w=n[1],C=n[5],P=n[9],D=n[13],B=n[2],j=n[6],F=n[10],z=n[14];return n[3]*(+v*P*j-m*D*j-v*C*F+d*D*F+m*C*z-d*P*z)+n[7]*(+c*P*z-c*D*F+v*w*F-m*w*z+m*D*B-v*P*B)+n[11]*(+c*D*j-c*C*z-v*w*j+d*w*z+v*C*B-d*D*B)+n[15]*(-m*C*B-c*P*j+c*C*F+m*w*j-d*w*F+d*P*B)}transpose(){const n=this.elements;let c;return c=n[1],n[1]=n[4],n[4]=c,c=n[2],n[2]=n[8],n[8]=c,c=n[6],n[6]=n[9],n[9]=c,c=n[3],n[3]=n[12],n[12]=c,c=n[7],n[7]=n[13],n[13]=c,c=n[11],n[11]=n[14],n[14]=c,this}setPosition(n,c,d){const m=this.elements;return n.isVector3?(m[12]=n.x,m[13]=n.y,m[14]=n.z):(m[12]=n,m[13]=c,m[14]=d),this}invert(){const n=this.elements,c=n[0],d=n[1],m=n[2],v=n[3],w=n[4],C=n[5],P=n[6],D=n[7],B=n[8],j=n[9],F=n[10],z=n[11],G=n[12],W=n[13],Q=n[14],$=n[15],Y=j*Q*D-W*F*D+W*P*z-C*Q*z-j*P*$+C*F*$,q=G*F*D-B*Q*D-G*P*z+w*Q*z+B*P*$-w*F*$,be=B*W*D-G*j*D+G*C*z-w*W*z-B*C*$+w*j*$,we=G*j*P-B*W*P-G*C*F+w*W*F+B*C*Q-w*j*Q,me=c*Y+d*q+m*be+v*we;if(me===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Be=1/me;return n[0]=Y*Be,n[1]=(W*F*v-j*Q*v-W*m*z+d*Q*z+j*m*$-d*F*$)*Be,n[2]=(C*Q*v-W*P*v+W*m*D-d*Q*D-C*m*$+d*P*$)*Be,n[3]=(j*P*v-C*F*v-j*m*D+d*F*D+C*m*z-d*P*z)*Be,n[4]=q*Be,n[5]=(B*Q*v-G*F*v+G*m*z-c*Q*z-B*m*$+c*F*$)*Be,n[6]=(G*P*v-w*Q*v-G*m*D+c*Q*D+w*m*$-c*P*$)*Be,n[7]=(w*F*v-B*P*v+B*m*D-c*F*D-w*m*z+c*P*z)*Be,n[8]=be*Be,n[9]=(G*j*v-B*W*v-G*d*z+c*W*z+B*d*$-c*j*$)*Be,n[10]=(w*W*v-G*C*v+G*d*D-c*W*D-w*d*$+c*C*$)*Be,n[11]=(B*C*v-w*j*v-B*d*D+c*j*D+w*d*z-c*C*z)*Be,n[12]=we*Be,n[13]=(B*W*m-G*j*m+G*d*F-c*W*F-B*d*Q+c*j*Q)*Be,n[14]=(G*C*m-w*W*m-G*d*P+c*W*P+w*d*Q-c*C*Q)*Be,n[15]=(w*j*m-B*C*m+B*d*P-c*j*P-w*d*F+c*C*F)*Be,this}scale(n){const c=this.elements,d=n.x,m=n.y,v=n.z;return c[0]*=d,c[4]*=m,c[8]*=v,c[1]*=d,c[5]*=m,c[9]*=v,c[2]*=d,c[6]*=m,c[10]*=v,c[3]*=d,c[7]*=m,c[11]*=v,this}getMaxScaleOnAxis(){const n=this.elements,c=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],d=n[4]*n[4]+n[5]*n[5]+n[6]*n[6],m=n[8]*n[8]+n[9]*n[9]+n[10]*n[10];return Math.sqrt(Math.max(c,d,m))}makeTranslation(n,c,d){return n.isVector3?this.set(1,0,0,n.x,0,1,0,n.y,0,0,1,n.z,0,0,0,1):this.set(1,0,0,n,0,1,0,c,0,0,1,d,0,0,0,1),this}makeRotationX(n){const c=Math.cos(n),d=Math.sin(n);return this.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1),this}makeRotationY(n){const c=Math.cos(n),d=Math.sin(n);return this.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1),this}makeRotationZ(n){const c=Math.cos(n),d=Math.sin(n);return this.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(n,c){const d=Math.cos(c),m=Math.sin(c),v=1-d,w=n.x,C=n.y,P=n.z,D=v*w,B=v*C;return this.set(D*w+d,D*C-m*P,D*P+m*C,0,D*C+m*P,B*C+d,B*P-m*w,0,D*P-m*C,B*P+m*w,v*P*P+d,0,0,0,0,1),this}makeScale(n,c,d){return this.set(n,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1),this}makeShear(n,c,d,m,v,w){return this.set(1,d,v,0,n,1,w,0,c,m,1,0,0,0,0,1),this}compose(n,c,d){const m=this.elements,v=c._x,w=c._y,C=c._z,P=c._w,D=v+v,B=w+w,j=C+C,F=v*D,z=v*B,G=v*j,W=w*B,Q=w*j,$=C*j,Y=P*D,q=P*B,be=P*j,we=d.x,me=d.y,Be=d.z;return m[0]=(1-(W+$))*we,m[1]=(z+be)*we,m[2]=(G-q)*we,m[3]=0,m[4]=(z-be)*me,m[5]=(1-(F+$))*me,m[6]=(Q+Y)*me,m[7]=0,m[8]=(G+q)*Be,m[9]=(Q-Y)*Be,m[10]=(1-(F+W))*Be,m[11]=0,m[12]=n.x,m[13]=n.y,m[14]=n.z,m[15]=1,this}decompose(n,c,d){const m=this.elements;let v=Yo.set(m[0],m[1],m[2]).length();const w=Yo.set(m[4],m[5],m[6]).length(),C=Yo.set(m[8],m[9],m[10]).length();this.determinant()<0&&(v=-v),n.x=m[12],n.y=m[13],n.z=m[14],rs.copy(this);const P=1/v,D=1/w,B=1/C;return rs.elements[0]*=P,rs.elements[1]*=P,rs.elements[2]*=P,rs.elements[4]*=D,rs.elements[5]*=D,rs.elements[6]*=D,rs.elements[8]*=B,rs.elements[9]*=B,rs.elements[10]*=B,c.setFromRotationMatrix(rs),d.x=v,d.y=w,d.z=C,this}makePerspective(n,c,d,m,v,w,C=Go){const P=this.elements,D=2*v/(c-n),B=2*v/(d-m),j=(c+n)/(c-n),F=(d+m)/(d-m);let z,G;if(C===Go)z=-(w+v)/(w-v),G=-2*w*v/(w-v);else{if(C!==zc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+C);z=-w/(w-v),G=-w*v/(w-v)}return P[0]=D,P[4]=0,P[8]=j,P[12]=0,P[1]=0,P[5]=B,P[9]=F,P[13]=0,P[2]=0,P[6]=0,P[10]=z,P[14]=G,P[3]=0,P[7]=0,P[11]=-1,P[15]=0,this}makeOrthographic(n,c,d,m,v,w,C=Go){const P=this.elements,D=1/(c-n),B=1/(d-m),j=1/(w-v),F=(c+n)*D,z=(d+m)*B;let G,W;if(C===Go)G=(w+v)*j,W=-2*j;else{if(C!==zc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+C);G=v*j,W=-1*j}return P[0]=2*D,P[4]=0,P[8]=0,P[12]=-F,P[1]=0,P[5]=2*B,P[9]=0,P[13]=-z,P[2]=0,P[6]=0,P[10]=W,P[14]=-G,P[3]=0,P[7]=0,P[11]=0,P[15]=1,this}equals(n){const c=this.elements,d=n.elements;for(let m=0;m<16;m++)if(c[m]!==d[m])return!1;return!0}fromArray(n,c=0){for(let d=0;d<16;d++)this.elements[d]=n[d+c];return this}toArray(n=[],c=0){const d=this.elements;return n[c]=d[0],n[c+1]=d[1],n[c+2]=d[2],n[c+3]=d[3],n[c+4]=d[4],n[c+5]=d[5],n[c+6]=d[6],n[c+7]=d[7],n[c+8]=d[8],n[c+9]=d[9],n[c+10]=d[10],n[c+11]=d[11],n[c+12]=d[12],n[c+13]=d[13],n[c+14]=d[14],n[c+15]=d[15],n}}const Yo=new Se,rs=new or,Wc=new Se(0,0,0),Il=new Se(1,1,1),ac=new Se,Ra=new Se,Da=new Se,Xc=new or,xu=new Vs;class Ah{constructor(n=0,c=0,d=0,m=Ah.DEFAULT_ORDER){this.isEuler=!0,this._x=n,this._y=c,this._z=d,this._order=m}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get order(){return this._order}set order(n){this._order=n,this._onChangeCallback()}set(n,c,d,m=this._order){return this._x=n,this._y=c,this._z=d,this._order=m,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this}setFromRotationMatrix(n,c=this._order,d=!0){const m=n.elements,v=m[0],w=m[4],C=m[8],P=m[1],D=m[5],B=m[9],j=m[2],F=m[6],z=m[10];switch(c){case"XYZ":this._y=Math.asin(Kr(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-B,z),this._z=Math.atan2(-w,v)):(this._x=Math.atan2(F,D),this._z=0);break;case"YXZ":this._x=Math.asin(-Kr(B,-1,1)),Math.abs(B)<.9999999?(this._y=Math.atan2(C,z),this._z=Math.atan2(P,D)):(this._y=Math.atan2(-j,v),this._z=0);break;case"ZXY":this._x=Math.asin(Kr(F,-1,1)),Math.abs(F)<.9999999?(this._y=Math.atan2(-j,z),this._z=Math.atan2(-w,D)):(this._y=0,this._z=Math.atan2(P,v));break;case"ZYX":this._y=Math.asin(-Kr(j,-1,1)),Math.abs(j)<.9999999?(this._x=Math.atan2(F,z),this._z=Math.atan2(P,v)):(this._x=0,this._z=Math.atan2(-w,D));break;case"YZX":this._z=Math.asin(Kr(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(-B,D),this._y=Math.atan2(-j,v)):(this._x=0,this._y=Math.atan2(C,z));break;case"XZY":this._z=Math.asin(-Kr(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(F,D),this._y=Math.atan2(C,v)):(this._x=Math.atan2(-B,z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+c)}return this._order=c,d===!0&&this._onChangeCallback(),this}setFromQuaternion(n,c,d){return Xc.makeRotationFromQuaternion(n),this.setFromRotationMatrix(Xc,c,d)}setFromVector3(n,c=this._order){return this.set(n.x,n.y,n.z,c)}reorder(n){return xu.setFromEuler(this),this.setFromQuaternion(xu,n)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order}fromArray(n){return this._x=n[0],this._y=n[1],this._z=n[2],n[3]!==void 0&&(this._order=n[3]),this._onChangeCallback(),this}toArray(n=[],c=0){return n[c]=this._x,n[c+1]=this._y,n[c+2]=this._z,n[c+3]=this._order,n}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ah.DEFAULT_ORDER="XYZ";class Pl{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!=0}isEnabled(n){return(this.mask&(1<<n|0))!=0}}let Cm=0;const Mm=new Se,Za=new Vs,Ja=new or,oc=new Se,qn=new Se,Eu=new Se,va=new Vs,Ln=new Se(1,0,0),_f=new Se(0,1,0),Hr=new Se(0,0,1),Su={type:"added"},zd={type:"removed"};class Nr extends sr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Cm++}),this.uuid=ts(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Nr.DEFAULT_UP.clone();const n=new Se,c=new Ah,d=new Vs,m=new Se(1,1,1);c._onChange(function(){d.setFromEuler(c,!1)}),d._onChange(function(){c.setFromQuaternion(d,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:c},quaternion:{configurable:!0,enumerable:!0,value:d},scale:{configurable:!0,enumerable:!0,value:m},modelViewMatrix:{value:new or},normalMatrix:{value:new _r}}),this.matrix=new or,this.matrixWorld=new or,this.matrixAutoUpdate=Nr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Nr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Pl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(n,c,d,m,v,w){this.dispatchEvent({type:"beforeRender",renderer:n,scene:c,camera:d,geometry:m,material:v,group:w})}onAfterRender(n,c,d,m,v,w){this.dispatchEvent({type:"afterRender",renderer:n,scene:c,camera:d,geometry:m,material:v,group:w})}applyMatrix4(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(n){return this.quaternion.premultiply(n),this}setRotationFromAxisAngle(n,c){this.quaternion.setFromAxisAngle(n,c)}setRotationFromEuler(n){this.quaternion.setFromEuler(n,!0)}setRotationFromMatrix(n){this.quaternion.setFromRotationMatrix(n)}setRotationFromQuaternion(n){this.quaternion.copy(n)}rotateOnAxis(n,c){return Za.setFromAxisAngle(n,c),this.quaternion.multiply(Za),this}rotateOnWorldAxis(n,c){return Za.setFromAxisAngle(n,c),this.quaternion.premultiply(Za),this}rotateX(n){return this.rotateOnAxis(Ln,n)}rotateY(n){return this.rotateOnAxis(_f,n)}rotateZ(n){return this.rotateOnAxis(Hr,n)}translateOnAxis(n,c){return Mm.copy(n).applyQuaternion(this.quaternion),this.position.add(Mm.multiplyScalar(c)),this}translateX(n){return this.translateOnAxis(Ln,n)}translateY(n){return this.translateOnAxis(_f,n)}translateZ(n){return this.translateOnAxis(Hr,n)}localToWorld(n){return this.updateWorldMatrix(!0,!1),n.applyMatrix4(this.matrixWorld)}worldToLocal(n){return this.updateWorldMatrix(!0,!1),n.applyMatrix4(Ja.copy(this.matrixWorld).invert())}lookAt(n,c,d){n.isVector3?oc.copy(n):oc.set(n,c,d);const m=this.parent;this.updateWorldMatrix(!0,!1),qn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ja.lookAt(qn,oc,this.up):Ja.lookAt(oc,qn,this.up),this.quaternion.setFromRotationMatrix(Ja),m&&(Ja.extractRotation(m.matrixWorld),Za.setFromRotationMatrix(Ja),this.quaternion.premultiply(Za.invert()))}add(n){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.add(arguments[c]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(n.parent!==null&&n.parent.remove(n),n.parent=this,this.children.push(n),n.dispatchEvent(Su)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)}remove(n){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.remove(arguments[d]);return this}const c=this.children.indexOf(n);return c!==-1&&(n.parent=null,this.children.splice(c,1),n.dispatchEvent(zd)),this}removeFromParent(){const n=this.parent;return n!==null&&n.remove(this),this}clear(){for(let n=0;n<this.children.length;n++){const c=this.children[n];c.parent=null,c.dispatchEvent(zd)}return this.children.length=0,this}attach(n){return this.updateWorldMatrix(!0,!1),Ja.copy(this.matrixWorld).invert(),n.parent!==null&&(n.parent.updateWorldMatrix(!0,!1),Ja.multiply(n.parent.matrixWorld)),n.applyMatrix4(Ja),this.add(n),n.updateWorldMatrix(!1,!0),this}getObjectById(n){return this.getObjectByProperty("id",n)}getObjectByName(n){return this.getObjectByProperty("name",n)}getObjectByProperty(n,c){if(this[n]===c)return this;for(let d=0,m=this.children.length;d<m;d++){const v=this.children[d].getObjectByProperty(n,c);if(v!==void 0)return v}}getObjectsByProperty(n,c){let d=[];this[n]===c&&d.push(this);for(let m=0,v=this.children.length;m<v;m++){const w=this.children[m].getObjectsByProperty(n,c);w.length>0&&(d=d.concat(w))}return d}getWorldPosition(n){return this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qn,n,Eu),n}getWorldScale(n){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qn,va,n),n}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return n.set(c[8],c[9],c[10]).normalize()}raycast(){}traverse(n){n(this);const c=this.children;for(let d=0,m=c.length;d<m;d++)c[d].traverse(n)}traverseVisible(n){if(this.visible===!1)return;n(this);const c=this.children;for(let d=0,m=c.length;d<m;d++)c[d].traverseVisible(n)}traverseAncestors(n){const c=this.parent;c!==null&&(n(c),c.traverseAncestors(n))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0);const c=this.children;for(let d=0,m=c.length;d<m;d++){const v=c[d];v.matrixWorldAutoUpdate!==!0&&n!==!0||v.updateMatrixWorld(n)}}updateWorldMatrix(n,c){const d=this.parent;if(n===!0&&d!==null&&d.matrixWorldAutoUpdate===!0&&d.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),c===!0){const m=this.children;for(let v=0,w=m.length;v<w;v++){const C=m[v];C.matrixWorldAutoUpdate===!0&&C.updateWorldMatrix(!1,!0)}}}toJSON(n){const c=n===void 0||typeof n=="string",d={};c&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},d.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const m={};function v(C,P){return C[P.uuid]===void 0&&(C[P.uuid]=P.toJSON(n)),P.uuid}if(m.uuid=this.uuid,m.type=this.type,this.name!==""&&(m.name=this.name),this.castShadow===!0&&(m.castShadow=!0),this.receiveShadow===!0&&(m.receiveShadow=!0),this.visible===!1&&(m.visible=!1),this.frustumCulled===!1&&(m.frustumCulled=!1),this.renderOrder!==0&&(m.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(m.userData=this.userData),m.layers=this.layers.mask,m.matrix=this.matrix.toArray(),m.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(m.matrixAutoUpdate=!1),this.isInstancedMesh&&(m.type="InstancedMesh",m.count=this.count,m.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(m.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?m.background=this.background.toJSON():this.background.isTexture&&(m.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(m.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){m.geometry=v(n.geometries,this.geometry);const C=this.geometry.parameters;if(C!==void 0&&C.shapes!==void 0){const P=C.shapes;if(Array.isArray(P))for(let D=0,B=P.length;D<B;D++){const j=P[D];v(n.shapes,j)}else v(n.shapes,P)}}if(this.isSkinnedMesh&&(m.bindMode=this.bindMode,m.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(v(n.skeletons,this.skeleton),m.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const C=[];for(let P=0,D=this.material.length;P<D;P++)C.push(v(n.materials,this.material[P]));m.material=C}else m.material=v(n.materials,this.material);if(this.children.length>0){m.children=[];for(let C=0;C<this.children.length;C++)m.children.push(this.children[C].toJSON(n).object)}if(this.animations.length>0){m.animations=[];for(let C=0;C<this.animations.length;C++){const P=this.animations[C];m.animations.push(v(n.animations,P))}}if(c){const C=w(n.geometries),P=w(n.materials),D=w(n.textures),B=w(n.images),j=w(n.shapes),F=w(n.skeletons),z=w(n.animations),G=w(n.nodes);C.length>0&&(d.geometries=C),P.length>0&&(d.materials=P),D.length>0&&(d.textures=D),B.length>0&&(d.images=B),j.length>0&&(d.shapes=j),F.length>0&&(d.skeletons=F),z.length>0&&(d.animations=z),G.length>0&&(d.nodes=G)}return d.object=m,d;function w(C){const P=[];for(const D in C){const B=C[D];delete B.metadata,P.push(B)}return P}}clone(n){return new this.constructor().copy(this,n)}copy(n,c=!0){this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=n.matrixWorldAutoUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.animations=n.animations,this.userData={};for(const[d,m]of Object.entries(n.userData))this.userData[d]=!m||m&&(m.isTexture||m.isObject3D)?m:JSON.parse(JSON.stringify(m));if(c===!0)for(let d=0;d<n.children.length;d++){const m=n.children[d];this.add(m.clone())}return this}}Nr.DEFAULT_UP=new Se(0,1,0),Nr.DEFAULT_MATRIX_AUTO_UPDATE=!0,Nr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ya=new Se,yo=new Se,yf=new Se,$a=new Se,ba=new Se,Ba=new Se,Tm=new Se,Cu=new Se,Ms=new Se,wh=new Se;let xh=!1;class bs{constructor(n=new Se,c=new Se,d=new Se){this.a=n,this.b=c,this.c=d}static getNormal(n,c,d,m){m.subVectors(d,c),ya.subVectors(n,c),m.cross(ya);const v=m.lengthSq();return v>0?m.multiplyScalar(1/Math.sqrt(v)):m.set(0,0,0)}static getBarycoord(n,c,d,m,v){ya.subVectors(m,c),yo.subVectors(d,c),yf.subVectors(n,c);const w=ya.dot(ya),C=ya.dot(yo),P=ya.dot(yf),D=yo.dot(yo),B=yo.dot(yf),j=w*D-C*C;if(j===0)return v.set(-2,-1,-1);const F=1/j,z=(D*P-C*B)*F,G=(w*B-C*P)*F;return v.set(1-z-G,G,z)}static containsPoint(n,c,d,m){return this.getBarycoord(n,c,d,m,$a),$a.x>=0&&$a.y>=0&&$a.x+$a.y<=1}static getUV(n,c,d,m,v,w,C,P){return xh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),xh=!0),this.getInterpolation(n,c,d,m,v,w,C,P)}static getInterpolation(n,c,d,m,v,w,C,P){return this.getBarycoord(n,c,d,m,$a),P.setScalar(0),P.addScaledVector(v,$a.x),P.addScaledVector(w,$a.y),P.addScaledVector(C,$a.z),P}static isFrontFacing(n,c,d,m){return ya.subVectors(d,c),yo.subVectors(n,c),ya.cross(yo).dot(m)<0}set(n,c,d){return this.a.copy(n),this.b.copy(c),this.c.copy(d),this}setFromPointsAndIndices(n,c,d,m){return this.a.copy(n[c]),this.b.copy(n[d]),this.c.copy(n[m]),this}setFromAttributeAndIndices(n,c,d,m){return this.a.fromBufferAttribute(n,c),this.b.fromBufferAttribute(n,d),this.c.fromBufferAttribute(n,m),this}clone(){return new this.constructor().copy(this)}copy(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this}getArea(){return ya.subVectors(this.c,this.b),yo.subVectors(this.a,this.b),.5*ya.cross(yo).length()}getMidpoint(n){return n.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(n){return bs.getNormal(this.a,this.b,this.c,n)}getPlane(n){return n.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(n,c){return bs.getBarycoord(n,this.a,this.b,this.c,c)}getUV(n,c,d,m,v){return xh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),xh=!0),bs.getInterpolation(n,this.a,this.b,this.c,c,d,m,v)}getInterpolation(n,c,d,m,v){return bs.getInterpolation(n,this.a,this.b,this.c,c,d,m,v)}containsPoint(n){return bs.containsPoint(n,this.a,this.b,this.c)}isFrontFacing(n){return bs.isFrontFacing(this.a,this.b,this.c,n)}intersectsBox(n){return n.intersectsTriangle(this)}closestPointToPoint(n,c){const d=this.a,m=this.b,v=this.c;let w,C;ba.subVectors(m,d),Ba.subVectors(v,d),Cu.subVectors(n,d);const P=ba.dot(Cu),D=Ba.dot(Cu);if(P<=0&&D<=0)return c.copy(d);Ms.subVectors(n,m);const B=ba.dot(Ms),j=Ba.dot(Ms);if(B>=0&&j<=B)return c.copy(m);const F=P*j-B*D;if(F<=0&&P>=0&&B<=0)return w=P/(P-B),c.copy(d).addScaledVector(ba,w);wh.subVectors(n,v);const z=ba.dot(wh),G=Ba.dot(wh);if(G>=0&&z<=G)return c.copy(v);const W=z*D-P*G;if(W<=0&&D>=0&&G<=0)return C=D/(D-G),c.copy(d).addScaledVector(Ba,C);const Q=B*G-z*j;if(Q<=0&&j-B>=0&&z-G>=0)return Tm.subVectors(v,m),C=(j-B)/(j-B+(z-G)),c.copy(m).addScaledVector(Tm,C);const $=1/(Q+W+F);return w=W*$,C=F*$,c.copy(d).addScaledVector(ba,w).addScaledVector(Ba,C)}equals(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)}}let bf=0;class Gs extends sr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:bf++}),this.uuid=ts(),this.name="",this.type="Material",this.blending=Ct,this.side=lt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=It,this.blendDst=xt,this.blendEquation=ee,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=We,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=lf,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ar,this.stencilZFail=Ar,this.stencilZPass=Ar,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const c in n){const d=n[c];if(d===void 0){console.warn(`THREE.Material: parameter '${c}' has value of undefined.`);continue}const m=this[c];m!==void 0&&(m&&m.isColor?m.set(d):m&&m.isVector3&&d&&d.isVector3?m.copy(d):Array.isArray(d)&&m&&typeof m.fromArray=="function"?m.fromArray(d):this[c]=d)}}toJSON(n){const c=n===void 0||typeof n=="string";c&&(n={textures:{},images:{}});const d={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function m(v){const w=[];for(const C in v){const P=v[C];delete P.metadata,w.push(P)}return w}if(d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.color&&this.color.isColor&&(d.color=this.color.getHex()),this.roughness!==void 0&&(d.roughness=this.roughness),this.metalness!==void 0&&(d.metalness=this.metalness),this.sheen!==void 0&&(d.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(d.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(d.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(d.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(d.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(d.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(d.shininess=this.shininess),this.clearcoat!==void 0&&(d.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(d.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(d.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(d.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(d.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.anisotropy!==void 0&&(d.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(d.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(d.anisotropyMap=this.anisotropyMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(d.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(n).uuid,d.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(n).uuid,d.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(n).uuid,d.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(n).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(n).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(d.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(d.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(d.combine=this.combine)),this.envMapIntensity!==void 0&&(d.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(d.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(d.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(d.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(d.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(d.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(d.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(d.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(d.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(d.size=this.size),this.shadowSide!==null&&(d.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(d.sizeAttenuation=this.sizeAttenuation),this.blending!==Ct&&(d.blending=this.blending),this.side!==lt&&(d.side=this.side),this.vertexColors&&(d.vertexColors=!0),this.opacity<1&&(d.opacity=this.opacity),this.transparent===!0&&(d.transparent=this.transparent),d.depthFunc=this.depthFunc,d.depthTest=this.depthTest,d.depthWrite=this.depthWrite,d.colorWrite=this.colorWrite,d.stencilWrite=this.stencilWrite,d.stencilWriteMask=this.stencilWriteMask,d.stencilFunc=this.stencilFunc,d.stencilRef=this.stencilRef,d.stencilFuncMask=this.stencilFuncMask,d.stencilFail=this.stencilFail,d.stencilZFail=this.stencilZFail,d.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(d.rotation=this.rotation),this.polygonOffset===!0&&(d.polygonOffset=!0),this.polygonOffsetFactor!==0&&(d.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(d.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(d.linewidth=this.linewidth),this.dashSize!==void 0&&(d.dashSize=this.dashSize),this.gapSize!==void 0&&(d.gapSize=this.gapSize),this.scale!==void 0&&(d.scale=this.scale),this.dithering===!0&&(d.dithering=!0),this.alphaTest>0&&(d.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(d.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(d.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(d.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(d.wireframe=this.wireframe),this.wireframeLinewidth>1&&(d.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(d.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(d.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(d.flatShading=this.flatShading),this.visible===!1&&(d.visible=!1),this.toneMapped===!1&&(d.toneMapped=!1),this.fog===!1&&(d.fog=!1),Object.keys(this.userData).length>0&&(d.userData=this.userData),c){const v=m(n.textures),w=m(n.images);v.length>0&&(d.textures=v),w.length>0&&(d.images=w)}return d}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const c=n.clippingPlanes;let d=null;if(c!==null){const m=c.length;d=new Array(m);for(let v=0;v!==m;++v)d[v]=c[v].clone()}return this.clippingPlanes=d,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.forceSinglePass=n.forceSinglePass,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=Im({},n.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}}function Im(b,n){if(!n)return b;for(const c of Object.keys(n)){if(c.startsWith("__")||typeof b[c]=="function"||typeof n[c]=="function")continue;const d=n[c],m=!d||d.isTexture||d.isObject3D||d.isMaterial;m||typeof n[c].clone!="function"?m||typeof n[c]!="object"&&!Array.isArray(n[c])?b[c]=n[c]:b[c]=Im(Array.isArray(n[c])?[]:{},n[c]):b[c]=n[c].clone()}return b}const Vd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kn={h:0,s:0,l:0},Eh={h:0,s:0,l:0};function Af(b,n,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?b+6*(n-b)*c:c<.5?n:c<2/3?b+6*(n-b)*(2/3-c):b}class xi{constructor(n,c,d){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,c,d)}set(n,c,d){if(c===void 0&&d===void 0){const m=n;m&&m.isColor?this.copy(m):typeof m=="number"?this.setHex(m):typeof m=="string"&&this.setStyle(m)}else this.setRGB(n,c,d);return this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,c=Yi){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(255&n)/255,ta.toWorkingColorSpace(this,c),this}setRGB(n,c,d,m=ta.workingColorSpace){return this.r=n,this.g=c,this.b=d,ta.toWorkingColorSpace(this,m),this}setHSL(n,c,d,m=ta.workingColorSpace){if(n=pa(n,1),c=Kr(c,0,1),d=Kr(d,0,1),c===0)this.r=this.g=this.b=d;else{const v=d<=.5?d*(1+c):d+c-d*c,w=2*d-v;this.r=Af(w,v,n+1/3),this.g=Af(w,v,n),this.b=Af(w,v,n-1/3)}return ta.toWorkingColorSpace(this,m),this}setStyle(n,c=Yi){function d(v){v!==void 0&&parseFloat(v)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let m;if(m=/^(\w+)\(([^\)]*)\)/.exec(n)){let v;const w=m[1],C=m[2];switch(w){case"rgb":case"rgba":if(v=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return d(v[4]),this.setRGB(Math.min(255,parseInt(v[1],10))/255,Math.min(255,parseInt(v[2],10))/255,Math.min(255,parseInt(v[3],10))/255,c);if(v=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return d(v[4]),this.setRGB(Math.min(100,parseInt(v[1],10))/100,Math.min(100,parseInt(v[2],10))/100,Math.min(100,parseInt(v[3],10))/100,c);break;case"hsl":case"hsla":if(v=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(C))return d(v[4]),this.setHSL(parseFloat(v[1])/360,parseFloat(v[2])/100,parseFloat(v[3])/100,c);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(m=/^\#([A-Fa-f\d]+)$/.exec(n)){const v=m[1],w=v.length;if(w===3)return this.setRGB(parseInt(v.charAt(0),16)/15,parseInt(v.charAt(1),16)/15,parseInt(v.charAt(2),16)/15,c);if(w===6)return this.setHex(parseInt(v,16),c);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&n.length>0)return this.setColorName(n,c);return this}setColorName(n,c=Yi){const d=Vd[n.toLowerCase()];return d!==void 0?this.setHex(d,c):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=vh(n.r),this.g=vh(n.g),this.b=vh(n.b),this}copyLinearToSRGB(n){return this.r=kd(n.r),this.g=kd(n.g),this.b=kd(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=Yi){return ta.fromWorkingColorSpace(Ts.copy(this),n),65536*Math.round(Kr(255*Ts.r,0,255))+256*Math.round(Kr(255*Ts.g,0,255))+Math.round(Kr(255*Ts.b,0,255))}getHexString(n=Yi){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,c=ta.workingColorSpace){ta.fromWorkingColorSpace(Ts.copy(this),c);const d=Ts.r,m=Ts.g,v=Ts.b,w=Math.max(d,m,v),C=Math.min(d,m,v);let P,D;const B=(C+w)/2;if(C===w)P=0,D=0;else{const j=w-C;switch(D=B<=.5?j/(w+C):j/(2-w-C),w){case d:P=(m-v)/j+(m<v?6:0);break;case m:P=(v-d)/j+2;break;case v:P=(d-m)/j+4}P/=6}return n.h=P,n.s=D,n.l=B,n}getRGB(n,c=ta.workingColorSpace){return ta.fromWorkingColorSpace(Ts.copy(this),c),n.r=Ts.r,n.g=Ts.g,n.b=Ts.b,n}getStyle(n=Yi){ta.fromWorkingColorSpace(Ts.copy(this),n);const c=Ts.r,d=Ts.g,m=Ts.b;return n!==Yi?`color(${n} ${c.toFixed(3)} ${d.toFixed(3)} ${m.toFixed(3)})`:`rgb(${Math.round(255*c)},${Math.round(255*d)},${Math.round(255*m)})`}offsetHSL(n,c,d){return this.getHSL(kn),kn.h+=n,kn.s+=c,kn.l+=d,this.setHSL(kn.h,kn.s,kn.l),this}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,c){return this.r=n.r+c.r,this.g=n.g+c.g,this.b=n.b+c.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,c){return this.r+=(n.r-this.r)*c,this.g+=(n.g-this.g)*c,this.b+=(n.b-this.b)*c,this}lerpColors(n,c,d){return this.r=n.r+(c.r-n.r)*d,this.g=n.g+(c.g-n.g)*d,this.b=n.b+(c.b-n.b)*d,this}lerpHSL(n,c){this.getHSL(kn),n.getHSL(Eh);const d=Cl(kn.h,Eh.h,c),m=Cl(kn.s,Eh.s,c),v=Cl(kn.l,Eh.l,c);return this.setHSL(d,m,v),this}setFromVector3(n){return this.r=n.x,this.g=n.y,this.b=n.z,this}applyMatrix3(n){const c=this.r,d=this.g,m=this.b,v=n.elements;return this.r=v[0]*c+v[3]*d+v[6]*m,this.g=v[1]*c+v[4]*d+v[7]*m,this.b=v[2]*c+v[5]*d+v[8]*m,this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,c=0){return this.r=n[c],this.g=n[c+1],this.b=n[c+2],this}toArray(n=[],c=0){return n[c]=this.r,n[c+1]=this.g,n[c+2]=this.b,n}fromBufferAttribute(n,c){return this.r=n.getX(c),this.g=n.getY(c),this.b=n.getZ(c),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ts=new xi;xi.NAMES=Vd;class qc extends Gs{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new xi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}const Rl=wf();function wf(){const b=new ArrayBuffer(4),n=new Float32Array(b),c=new Uint32Array(b),d=new Uint32Array(512),m=new Uint32Array(512);for(let P=0;P<256;++P){const D=P-127;D<-27?(d[P]=0,d[256|P]=32768,m[P]=24,m[256|P]=24):D<-14?(d[P]=1024>>-D-14,d[256|P]=1024>>-D-14|32768,m[P]=-D-1,m[256|P]=-D-1):D<=15?(d[P]=D+15<<10,d[256|P]=D+15<<10|32768,m[P]=13,m[256|P]=13):D<128?(d[P]=31744,d[256|P]=64512,m[P]=24,m[256|P]=24):(d[P]=31744,d[256|P]=64512,m[P]=13,m[256|P]=13)}const v=new Uint32Array(2048),w=new Uint32Array(64),C=new Uint32Array(64);for(let P=1;P<1024;++P){let D=P<<13,B=0;for(;!(8388608&D);)D<<=1,B-=8388608;D&=-8388609,B+=947912704,v[P]=D|B}for(let P=1024;P<2048;++P)v[P]=939524096+(P-1024<<13);for(let P=1;P<31;++P)w[P]=P<<23;w[31]=1199570944,w[32]=2147483648;for(let P=33;P<63;++P)w[P]=2147483648+(P-32<<23);w[63]=3347054592;for(let P=1;P<64;++P)P!==32&&(C[P]=1024);return{floatView:n,uint32View:c,baseTable:d,shiftTable:m,mantissaTable:v,exponentTable:w,offsetTable:C}}function Is(b){Math.abs(b)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),b=Kr(b,-65504,65504),Rl.floatView[0]=b;const n=Rl.uint32View[0],c=n>>23&511;return Rl.baseTable[c]+((8388607&n)>>Rl.shiftTable[c])}function Sh(b){const n=b>>10;return Rl.uint32View[0]=Rl.mantissaTable[Rl.offsetTable[n]+(1023&b)]+Rl.exponentTable[n],Rl.floatView[0]}const Sv={toHalfFloat:Is,fromHalfFloat:Sh},In=new Se,Gd=new Jt;class on{constructor(n,c,d=!1){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=c,this.count=n!==void 0?n.length/c:0,this.normalized=d,this.usage=Sl,this.updateRange={offset:0,count:-1},this.gpuType=bl,this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this.gpuType=n.gpuType,this}copyAt(n,c,d){n*=this.itemSize,d*=c.itemSize;for(let m=0,v=this.itemSize;m<v;m++)this.array[n+m]=c.array[d+m];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let c=0,d=this.count;c<d;c++)Gd.fromBufferAttribute(this,c),Gd.applyMatrix3(n),this.setXY(c,Gd.x,Gd.y);else if(this.itemSize===3)for(let c=0,d=this.count;c<d;c++)In.fromBufferAttribute(this,c),In.applyMatrix3(n),this.setXYZ(c,In.x,In.y,In.z);return this}applyMatrix4(n){for(let c=0,d=this.count;c<d;c++)In.fromBufferAttribute(this,c),In.applyMatrix4(n),this.setXYZ(c,In.x,In.y,In.z);return this}applyNormalMatrix(n){for(let c=0,d=this.count;c<d;c++)In.fromBufferAttribute(this,c),In.applyNormalMatrix(n),this.setXYZ(c,In.x,In.y,In.z);return this}transformDirection(n){for(let c=0,d=this.count;c<d;c++)In.fromBufferAttribute(this,c),In.transformDirection(n),this.setXYZ(c,In.x,In.y,In.z);return this}set(n,c=0){return this.array.set(n,c),this}getX(n){let c=this.array[n*this.itemSize];return this.normalized&&(c=is(c,this.array)),c}setX(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize]=c,this}getY(n){let c=this.array[n*this.itemSize+1];return this.normalized&&(c=is(c,this.array)),c}setY(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+1]=c,this}getZ(n){let c=this.array[n*this.itemSize+2];return this.normalized&&(c=is(c,this.array)),c}setZ(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+2]=c,this}getW(n){let c=this.array[n*this.itemSize+3];return this.normalized&&(c=is(c,this.array)),c}setW(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+3]=c,this}setXY(n,c,d){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array)),this.array[n+0]=c,this.array[n+1]=d,this}setXYZ(n,c,d,m){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array)),this.array[n+0]=c,this.array[n+1]=d,this.array[n+2]=m,this}setXYZW(n,c,d,m,v){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array),v=Ji(v,this.array)),this.array[n+0]=c,this.array[n+1]=d,this.array[n+2]=m,this.array[n+3]=v,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==Sl&&(n.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(n.updateRange=this.updateRange),n}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Cv extends on{constructor(n,c,d){super(new Int8Array(n),c,d)}}class F_ extends on{constructor(n,c,d){super(new Uint8Array(n),c,d)}}class L extends on{constructor(n,c,d){super(new Uint8ClampedArray(n),c,d)}}class y extends on{constructor(n,c,d){super(new Int16Array(n),c,d)}}class M extends on{constructor(n,c,d){super(new Uint16Array(n),c,d)}}class U extends on{constructor(n,c,d){super(new Int32Array(n),c,d)}}class J extends on{constructor(n,c,d){super(new Uint32Array(n),c,d)}}class xe extends on{constructor(n,c,d){super(new Uint16Array(n),c,d),this.isFloat16BufferAttribute=!0}getX(n){let c=Sh(this.array[n*this.itemSize]);return this.normalized&&(c=is(c,this.array)),c}setX(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize]=Is(c),this}getY(n){let c=Sh(this.array[n*this.itemSize+1]);return this.normalized&&(c=is(c,this.array)),c}setY(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+1]=Is(c),this}getZ(n){let c=Sh(this.array[n*this.itemSize+2]);return this.normalized&&(c=is(c,this.array)),c}setZ(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+2]=Is(c),this}getW(n){let c=Sh(this.array[n*this.itemSize+3]);return this.normalized&&(c=is(c,this.array)),c}setW(n,c){return this.normalized&&(c=Ji(c,this.array)),this.array[n*this.itemSize+3]=Is(c),this}setXY(n,c,d){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array)),this.array[n+0]=Is(c),this.array[n+1]=Is(d),this}setXYZ(n,c,d,m){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array)),this.array[n+0]=Is(c),this.array[n+1]=Is(d),this.array[n+2]=Is(m),this}setXYZW(n,c,d,m,v){return n*=this.itemSize,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array),v=Ji(v,this.array)),this.array[n+0]=Is(c),this.array[n+1]=Is(d),this.array[n+2]=Is(m),this.array[n+3]=Is(v),this}}class pe extends on{constructor(n,c,d){super(new Float32Array(n),c,d)}}class mt extends on{constructor(n,c,d){super(new Float64Array(n),c,d)}}let $t=0;const gi=new or,ur=new Nr,cn=new Se,mn=new ia,gn=new ia,Wr=new Se;class hr extends sr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$t++}),this.uuid=ts(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(n){return Array.isArray(n)?this.index=new(mh(n)?J:M)(n,1):this.index=n,this}getAttribute(n){return this.attributes[n]}setAttribute(n,c){return this.attributes[n]=c,this}deleteAttribute(n){return delete this.attributes[n],this}hasAttribute(n){return this.attributes[n]!==void 0}addGroup(n,c,d=0){this.groups.push({start:n,count:c,materialIndex:d})}clearGroups(){this.groups=[]}setDrawRange(n,c){this.drawRange.start=n,this.drawRange.count=c}applyMatrix4(n){const c=this.attributes.position;c!==void 0&&(c.applyMatrix4(n),c.needsUpdate=!0);const d=this.attributes.normal;if(d!==void 0){const v=new _r().getNormalMatrix(n);d.applyNormalMatrix(v),d.needsUpdate=!0}const m=this.attributes.tangent;return m!==void 0&&(m.transformDirection(n),m.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(n){return gi.makeRotationFromQuaternion(n),this.applyMatrix4(gi),this}rotateX(n){return gi.makeRotationX(n),this.applyMatrix4(gi),this}rotateY(n){return gi.makeRotationY(n),this.applyMatrix4(gi),this}rotateZ(n){return gi.makeRotationZ(n),this.applyMatrix4(gi),this}translate(n,c,d){return gi.makeTranslation(n,c,d),this.applyMatrix4(gi),this}scale(n,c,d){return gi.makeScale(n,c,d),this.applyMatrix4(gi),this}lookAt(n){return ur.lookAt(n),ur.updateMatrix(),this.applyMatrix4(ur.matrix),this}center(n=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(cn).negate(),this.translate(cn.x,cn.y,cn.z),n&&n.copy(cn),this}setFromPoints(n){const c=[];for(let d=0,m=n.length;d<m;d++){const v=n[d];c.push(v.x,v.y,v.z||0)}return this.setAttribute("position",new pe(c,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ia);const n=this.attributes.position,c=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Se(-1/0,-1/0,-1/0),new Se(1/0,1/0,1/0));if(n!==void 0){if(this.boundingBox.setFromBufferAttribute(n),c)for(let d=0,m=c.length;d<m;d++){const v=c[d];mn.setFromBufferAttribute(v),this.morphTargetsRelative?(Wr.addVectors(this.boundingBox.min,mn.min),this.boundingBox.expandByPoint(Wr),Wr.addVectors(this.boundingBox.max,mn.max),this.boundingBox.expandByPoint(Wr)):(this.boundingBox.expandByPoint(mn.min),this.boundingBox.expandByPoint(mn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Pa);const n=this.attributes.position,c=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Se,1/0);if(n){const d=this.boundingSphere.center;if(mn.setFromBufferAttribute(n),c)for(let v=0,w=c.length;v<w;v++){const C=c[v];gn.setFromBufferAttribute(C),this.morphTargetsRelative?(Wr.addVectors(mn.min,gn.min),mn.expandByPoint(Wr),Wr.addVectors(mn.max,gn.max),mn.expandByPoint(Wr)):(mn.expandByPoint(gn.min),mn.expandByPoint(gn.max))}mn.getCenter(d);let m=0;for(let v=0,w=n.count;v<w;v++)Wr.fromBufferAttribute(n,v),m=Math.max(m,d.distanceToSquared(Wr));if(c)for(let v=0,w=c.length;v<w;v++){const C=c[v],P=this.morphTargetsRelative;for(let D=0,B=C.count;D<B;D++)Wr.fromBufferAttribute(C,D),P&&(cn.fromBufferAttribute(n,D),Wr.add(cn)),m=Math.max(m,d.distanceToSquared(Wr))}this.boundingSphere.radius=Math.sqrt(m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const n=this.index,c=this.attributes;if(n===null||c.position===void 0||c.normal===void 0||c.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const d=n.array,m=c.position.array,v=c.normal.array,w=c.uv.array,C=m.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new on(new Float32Array(4*C),4));const P=this.getAttribute("tangent").array,D=[],B=[];for(let ft=0;ft<C;ft++)D[ft]=new Se,B[ft]=new Se;const j=new Se,F=new Se,z=new Se,G=new Jt,W=new Jt,Q=new Jt,$=new Se,Y=new Se;function q(ft,Le,Gt){j.fromArray(m,3*ft),F.fromArray(m,3*Le),z.fromArray(m,3*Gt),G.fromArray(w,2*ft),W.fromArray(w,2*Le),Q.fromArray(w,2*Gt),F.sub(j),z.sub(j),W.sub(G),Q.sub(G);const Ht=1/(W.x*Q.y-Q.x*W.y);isFinite(Ht)&&($.copy(F).multiplyScalar(Q.y).addScaledVector(z,-W.y).multiplyScalar(Ht),Y.copy(z).multiplyScalar(W.x).addScaledVector(F,-Q.x).multiplyScalar(Ht),D[ft].add($),D[Le].add($),D[Gt].add($),B[ft].add(Y),B[Le].add(Y),B[Gt].add(Y))}let be=this.groups;be.length===0&&(be=[{start:0,count:d.length}]);for(let ft=0,Le=be.length;ft<Le;++ft){const Gt=be[ft],Ht=Gt.start;for(let ri=Ht,hi=Ht+Gt.count;ri<hi;ri+=3)q(d[ri+0],d[ri+1],d[ri+2])}const we=new Se,me=new Se,Be=new Se,Ze=new Se;function et(ft){Be.fromArray(v,3*ft),Ze.copy(Be);const Le=D[ft];we.copy(Le),we.sub(Be.multiplyScalar(Be.dot(Le))).normalize(),me.crossVectors(Ze,Le);const Gt=me.dot(B[ft])<0?-1:1;P[4*ft]=we.x,P[4*ft+1]=we.y,P[4*ft+2]=we.z,P[4*ft+3]=Gt}for(let ft=0,Le=be.length;ft<Le;++ft){const Gt=be[ft],Ht=Gt.start;for(let ri=Ht,hi=Ht+Gt.count;ri<hi;ri+=3)et(d[ri+0]),et(d[ri+1]),et(d[ri+2])}}computeVertexNormals(){const n=this.index,c=this.getAttribute("position");if(c!==void 0){let d=this.getAttribute("normal");if(d===void 0)d=new on(new Float32Array(3*c.count),3),this.setAttribute("normal",d);else for(let F=0,z=d.count;F<z;F++)d.setXYZ(F,0,0,0);const m=new Se,v=new Se,w=new Se,C=new Se,P=new Se,D=new Se,B=new Se,j=new Se;if(n)for(let F=0,z=n.count;F<z;F+=3){const G=n.getX(F+0),W=n.getX(F+1),Q=n.getX(F+2);m.fromBufferAttribute(c,G),v.fromBufferAttribute(c,W),w.fromBufferAttribute(c,Q),B.subVectors(w,v),j.subVectors(m,v),B.cross(j),C.fromBufferAttribute(d,G),P.fromBufferAttribute(d,W),D.fromBufferAttribute(d,Q),C.add(B),P.add(B),D.add(B),d.setXYZ(G,C.x,C.y,C.z),d.setXYZ(W,P.x,P.y,P.z),d.setXYZ(Q,D.x,D.y,D.z)}else for(let F=0,z=c.count;F<z;F+=3)m.fromBufferAttribute(c,F+0),v.fromBufferAttribute(c,F+1),w.fromBufferAttribute(c,F+2),B.subVectors(w,v),j.subVectors(m,v),B.cross(j),d.setXYZ(F+0,B.x,B.y,B.z),d.setXYZ(F+1,B.x,B.y,B.z),d.setXYZ(F+2,B.x,B.y,B.z);this.normalizeNormals(),d.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const n=this.attributes.normal;for(let c=0,d=n.count;c<d;c++)Wr.fromBufferAttribute(n,c),Wr.normalize(),n.setXYZ(c,Wr.x,Wr.y,Wr.z)}toNonIndexed(){function n(C,P){const D=C.array,B=C.itemSize,j=C.normalized,F=new D.constructor(P.length*B);let z=0,G=0;for(let W=0,Q=P.length;W<Q;W++){z=C.isInterleavedBufferAttribute?P[W]*C.data.stride+C.offset:P[W]*B;for(let $=0;$<B;$++)F[G++]=D[z++]}return new on(F,B,j)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const c=new hr,d=this.index.array,m=this.attributes;for(const C in m){const P=n(m[C],d);c.setAttribute(C,P)}const v=this.morphAttributes;for(const C in v){const P=[],D=v[C];for(let B=0,j=D.length;B<j;B++){const F=n(D[B],d);P.push(F)}c.morphAttributes[C]=P}c.morphTargetsRelative=this.morphTargetsRelative;const w=this.groups;for(let C=0,P=w.length;C<P;C++){const D=w[C];c.addGroup(D.start,D.count,D.materialIndex)}return c}toJSON(){const n={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),this.parameters!==void 0){const P=this.parameters;for(const D in P)P[D]!==void 0&&(n[D]=P[D]);return n}n.data={attributes:{}};const c=this.index;c!==null&&(n.data.index={type:c.array.constructor.name,array:Array.prototype.slice.call(c.array)});const d=this.attributes;for(const P in d){const D=d[P];n.data.attributes[P]=D.toJSON(n.data)}const m={};let v=!1;for(const P in this.morphAttributes){const D=this.morphAttributes[P],B=[];for(let j=0,F=D.length;j<F;j++){const z=D[j];B.push(z.toJSON(n.data))}B.length>0&&(m[P]=B,v=!0)}v&&(n.data.morphAttributes=m,n.data.morphTargetsRelative=this.morphTargetsRelative);const w=this.groups;w.length>0&&(n.data.groups=JSON.parse(JSON.stringify(w)));const C=this.boundingSphere;return C!==null&&(n.data.boundingSphere={center:C.center.toArray(),radius:C.radius}),n}clone(){return new this.constructor().copy(this)}copy(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const c={};this.name=n.name;const d=n.index;d!==null&&this.setIndex(d.clone(c));const m=n.attributes;for(const D in m){const B=m[D];this.setAttribute(D,B.clone(c))}const v=n.morphAttributes;for(const D in v){const B=[],j=v[D];for(let F=0,z=j.length;F<z;F++)B.push(j[F].clone(c));this.morphAttributes[D]=B}this.morphTargetsRelative=n.morphTargetsRelative;const w=n.groups;for(let D=0,B=w.length;D<B;D++){const j=w[D];this.addGroup(j.start,j.count,j.materialIndex)}const C=n.boundingBox;C!==null&&(this.boundingBox=C.clone());const P=n.boundingSphere;return P!==null&&(this.boundingSphere=P.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Yc=new or,lc=new Qc,Mu=new Pa,xf=new Se,Ch=new Se,Kc=new Se,Tu=new Se,j_=new Se,Mv=new Se,Tv=new Jt,Iv=new Jt,Mh=new Jt,Pv=new Se,z_=new Se,Rv=new Se,Pm=new Se,Rm=new Se;class Ut extends Nr{constructor(n=new hr,c=new qc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=c,this.updateMorphTargets()}copy(n,c){return super.copy(n,c),n.isMesh?(n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=n.material,this.geometry=n.geometry,this):this}updateMorphTargets(){const n=this.geometry.morphAttributes,c=Object.keys(n);if(c.length>0){const d=n[c[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,v=d.length;m<v;m++){const w=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[w]=m}}}}getVertexPosition(n,c){const d=this.geometry,m=d.attributes.position,v=d.morphAttributes.position,w=d.morphTargetsRelative;c.fromBufferAttribute(m,n);const C=this.morphTargetInfluences;if(v&&C){Mv.set(0,0,0);for(let P=0,D=v.length;P<D;P++){const B=C[P],j=v[P];B!==0&&(j_.fromBufferAttribute(j,n),w?Mv.addScaledVector(j_,B):Mv.addScaledVector(j_.sub(c),B))}c.add(Mv)}return c}raycast(n,c){const d=this.geometry,m=this.material,v=this.matrixWorld;if(m!==void 0){if(d.boundingSphere===null&&d.computeBoundingSphere(),Mu.copy(d.boundingSphere),Mu.applyMatrix4(v),lc.copy(n.ray).recast(n.near),Mu.containsPoint(lc.origin)===!1&&(lc.intersectSphere(Mu,xf)===null||lc.origin.distanceToSquared(xf)>(n.far-n.near)**2))return;Yc.copy(v).invert(),lc.copy(n.ray).applyMatrix4(Yc),d.boundingBox!==null&&lc.intersectsBox(d.boundingBox)===!1||this._computeIntersections(n,c,lc)}}_computeIntersections(n,c,d){let m;const v=this.geometry,w=this.material,C=v.index,P=v.attributes.position,D=v.attributes.uv,B=v.attributes.uv1,j=v.attributes.normal,F=v.groups,z=v.drawRange;if(C!==null)if(Array.isArray(w))for(let G=0,W=F.length;G<W;G++){const Q=F[G],$=w[Q.materialIndex];for(let Y=Math.max(Q.start,z.start),q=Math.min(C.count,Math.min(Q.start+Q.count,z.start+z.count));Y<q;Y+=3)m=Dm(this,$,n,d,D,B,j,C.getX(Y),C.getX(Y+1),C.getX(Y+2)),m&&(m.faceIndex=Math.floor(Y/3),m.face.materialIndex=Q.materialIndex,c.push(m))}else for(let G=Math.max(0,z.start),W=Math.min(C.count,z.start+z.count);G<W;G+=3)m=Dm(this,w,n,d,D,B,j,C.getX(G),C.getX(G+1),C.getX(G+2)),m&&(m.faceIndex=Math.floor(G/3),c.push(m));else if(P!==void 0)if(Array.isArray(w))for(let G=0,W=F.length;G<W;G++){const Q=F[G],$=w[Q.materialIndex];for(let Y=Math.max(Q.start,z.start),q=Math.min(P.count,Math.min(Q.start+Q.count,z.start+z.count));Y<q;Y+=3)m=Dm(this,$,n,d,D,B,j,Y,Y+1,Y+2),m&&(m.faceIndex=Math.floor(Y/3),m.face.materialIndex=Q.materialIndex,c.push(m))}else for(let G=Math.max(0,z.start),W=Math.min(P.count,z.start+z.count);G<W;G+=3)m=Dm(this,w,n,d,D,B,j,G,G+1,G+2),m&&(m.faceIndex=Math.floor(G/3),c.push(m))}}function Dm(b,n,c,d,m,v,w,C,P,D){b.getVertexPosition(C,Ch),b.getVertexPosition(P,Kc),b.getVertexPosition(D,Tu);const B=function(j,F,z,G,W,Q,$,Y){let q;if(q=F.side===Ce?G.intersectTriangle($,Q,W,!0,Y):G.intersectTriangle(W,Q,$,F.side===lt,Y),q===null)return null;Rm.copy(Y),Rm.applyMatrix4(j.matrixWorld);const be=z.ray.origin.distanceTo(Rm);return be<z.near||be>z.far?null:{distance:be,point:Rm.clone(),object:j}}(b,n,c,d,Ch,Kc,Tu,Pm);if(B){m&&(Tv.fromBufferAttribute(m,C),Iv.fromBufferAttribute(m,P),Mh.fromBufferAttribute(m,D),B.uv=bs.getInterpolation(Pm,Ch,Kc,Tu,Tv,Iv,Mh,new Jt)),v&&(Tv.fromBufferAttribute(v,C),Iv.fromBufferAttribute(v,P),Mh.fromBufferAttribute(v,D),B.uv1=bs.getInterpolation(Pm,Ch,Kc,Tu,Tv,Iv,Mh,new Jt),B.uv2=B.uv1),w&&(Pv.fromBufferAttribute(w,C),z_.fromBufferAttribute(w,P),Rv.fromBufferAttribute(w,D),B.normal=bs.getInterpolation(Pm,Ch,Kc,Tu,Pv,z_,Rv,new Se),B.normal.dot(d.direction)>0&&B.normal.multiplyScalar(-1));const j={a:C,b:P,c:D,normal:new Se,materialIndex:0};bs.getNormal(Ch,Kc,Tu,j.normal),B.face=j}return B}class eo extends hr{constructor(n=1,c=1,d=1,m=1,v=1,w=1){super(),this.type="BoxGeometry",this.parameters={width:n,height:c,depth:d,widthSegments:m,heightSegments:v,depthSegments:w};const C=this;m=Math.floor(m),v=Math.floor(v),w=Math.floor(w);const P=[],D=[],B=[],j=[];let F=0,z=0;function G(W,Q,$,Y,q,be,we,me,Be,Ze,et){const ft=be/Be,Le=we/Ze,Gt=be/2,Ht=we/2,ri=me/2,hi=Be+1,ei=Ze+1;let Xt=0,oi=0;const Pt=new Se;for(let Nt=0;Nt<ei;Nt++){const ci=Nt*Le-Ht;for(let pi=0;pi<hi;pi++){const $i=pi*ft-Gt;Pt[W]=$i*Y,Pt[Q]=ci*q,Pt[$]=ri,D.push(Pt.x,Pt.y,Pt.z),Pt[W]=0,Pt[Q]=0,Pt[$]=me>0?1:-1,B.push(Pt.x,Pt.y,Pt.z),j.push(pi/Be),j.push(1-Nt/Ze),Xt+=1}}for(let Nt=0;Nt<Ze;Nt++)for(let ci=0;ci<Be;ci++){const pi=F+ci+hi*Nt,$i=F+ci+hi*(Nt+1),yi=F+(ci+1)+hi*(Nt+1),qi=F+(ci+1)+hi*Nt;P.push(pi,$i,qi),P.push($i,yi,qi),oi+=6}C.addGroup(z,oi,et),z+=oi,F+=Xt}G("z","y","x",-1,-1,d,c,n,w,v,0),G("z","y","x",1,-1,d,c,-n,w,v,1),G("x","z","y",1,1,n,d,c,m,w,2),G("x","z","y",1,-1,n,d,-c,m,w,3),G("x","y","z",1,-1,n,c,d,m,v,4),G("x","y","z",-1,-1,n,c,-d,m,v,5),this.setIndex(P),this.setAttribute("position",new pe(D,3)),this.setAttribute("normal",new pe(B,3)),this.setAttribute("uv",new pe(j,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new eo(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)}}function Iu(b){const n={};for(const c in b){n[c]={};for(const d in b[c]){const m=b[c][d];m&&(m.isColor||m.isMatrix3||m.isMatrix4||m.isVector2||m.isVector3||m.isVector4||m.isTexture||m.isQuaternion)?m.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),n[c][d]=null):n[c][d]=m.clone():Array.isArray(m)?n[c][d]=m.slice():n[c][d]=m}}return n}function Ps(b){const n={};for(let c=0;c<b.length;c++){const d=Iu(b[c]);for(const m in d)n[m]=d[m]}return n}function to(b){return b.getRenderTarget()===null?b.outputColorSpace:an}const Bm={clone:Iu,merge:Ps};class cc extends Gs{constructor(n){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,n!==void 0&&this.setValues(n)}copy(n){return super.copy(n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=Iu(n.uniforms),this.uniformsGroups=function(c){const d=[];for(let m=0;m<c.length;m++)d.push(c[m].clone());return d}(n.uniformsGroups),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.fog=n.fog,this.lights=n.lights,this.clipping=n.clipping,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this}toJSON(n){const c=super.toJSON(n);c.glslVersion=this.glslVersion,c.uniforms={};for(const m in this.uniforms){const v=this.uniforms[m].value;v&&v.isTexture?c.uniforms[m]={type:"t",value:v.toJSON(n).uuid}:v&&v.isColor?c.uniforms[m]={type:"c",value:v.getHex()}:v&&v.isVector2?c.uniforms[m]={type:"v2",value:v.toArray()}:v&&v.isVector3?c.uniforms[m]={type:"v3",value:v.toArray()}:v&&v.isVector4?c.uniforms[m]={type:"v4",value:v.toArray()}:v&&v.isMatrix3?c.uniforms[m]={type:"m3",value:v.toArray()}:v&&v.isMatrix4?c.uniforms[m]={type:"m4",value:v.toArray()}:c.uniforms[m]={value:v}}Object.keys(this.defines).length>0&&(c.defines=this.defines),c.vertexShader=this.vertexShader,c.fragmentShader=this.fragmentShader,c.lights=this.lights,c.clipping=this.clipping;const d={};for(const m in this.extensions)this.extensions[m]===!0&&(d[m]=!0);return Object.keys(d).length>0&&(c.extensions=d),c}}class Dv extends Nr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new or,this.projectionMatrix=new or,this.projectionMatrixInverse=new or,this.coordinateSystem=Go}copy(n,c){return super.copy(n,c),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){this.updateWorldMatrix(!0,!1);const c=this.matrixWorld.elements;return n.set(-c[8],-c[9],-c[10]).normalize()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,c){super.updateWorldMatrix(n,c),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class vn extends Dv{constructor(n=50,c=1,d=.1,m=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=d,this.far=m,this.focus=10,this.aspect=c,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,c){return super.copy(n,c),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const c=.5*this.getFilmHeight()/n;this.fov=2*ec*Math.atan(c),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(.5*_u*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return 2*ec*Math.atan(Math.tan(.5*_u*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(n,c,d,m,v,w){this.aspect=n/c,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=m,this.view.width=v,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let c=n*Math.tan(.5*_u*this.fov)/this.zoom,d=2*c,m=this.aspect*d,v=-.5*m;const w=this.view;if(this.view!==null&&this.view.enabled){const P=w.fullWidth,D=w.fullHeight;v+=w.offsetX*m/P,c-=w.offsetY*d/D,m*=w.width/P,d*=w.height/D}const C=this.filmOffset;C!==0&&(v+=n*C/this.getFilmWidth()),this.projectionMatrix.makePerspective(v,v+m,c,c-d,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const c=super.toJSON(n);return c.object.fov=this.fov,c.object.zoom=this.zoom,c.object.near=this.near,c.object.far=this.far,c.object.focus=this.focus,c.object.aspect=this.aspect,this.view!==null&&(c.object.view=Object.assign({},this.view)),c.object.filmGauge=this.filmGauge,c.object.filmOffset=this.filmOffset,c}}const Hd=-90;class Zc extends Nr{constructor(n,c,d){super(),this.type="CubeCamera",this.renderTarget=d,this.coordinateSystem=null;const m=new vn(Hd,1,n,c);m.layers=this.layers,this.add(m);const v=new vn(Hd,1,n,c);v.layers=this.layers,this.add(v);const w=new vn(Hd,1,n,c);w.layers=this.layers,this.add(w);const C=new vn(Hd,1,n,c);C.layers=this.layers,this.add(C);const P=new vn(Hd,1,n,c);P.layers=this.layers,this.add(P);const D=new vn(Hd,1,n,c);D.layers=this.layers,this.add(D)}updateCoordinateSystem(){const n=this.coordinateSystem,c=this.children.concat(),[d,m,v,w,C,P]=c;for(const D of c)this.remove(D);if(n===Go)d.up.set(0,1,0),d.lookAt(1,0,0),m.up.set(0,1,0),m.lookAt(-1,0,0),v.up.set(0,0,-1),v.lookAt(0,1,0),w.up.set(0,0,1),w.lookAt(0,-1,0),C.up.set(0,1,0),C.lookAt(0,0,1),P.up.set(0,1,0),P.lookAt(0,0,-1);else{if(n!==zc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+n);d.up.set(0,-1,0),d.lookAt(-1,0,0),m.up.set(0,-1,0),m.lookAt(1,0,0),v.up.set(0,0,1),v.lookAt(0,1,0),w.up.set(0,0,-1),w.lookAt(0,-1,0),C.up.set(0,-1,0),C.lookAt(0,0,1),P.up.set(0,-1,0),P.lookAt(0,0,-1)}for(const D of c)this.add(D),D.updateMatrixWorld()}update(n,c){this.parent===null&&this.updateMatrixWorld();const d=this.renderTarget;this.coordinateSystem!==n.coordinateSystem&&(this.coordinateSystem=n.coordinateSystem,this.updateCoordinateSystem());const[m,v,w,C,P,D]=this.children,B=n.getRenderTarget(),j=n.toneMapping,F=n.xr.enabled;n.toneMapping=Vr,n.xr.enabled=!1;const z=d.texture.generateMipmaps;d.texture.generateMipmaps=!1,n.setRenderTarget(d,0),n.render(c,m),n.setRenderTarget(d,1),n.render(c,v),n.setRenderTarget(d,2),n.render(c,w),n.setRenderTarget(d,3),n.render(c,C),n.setRenderTarget(d,4),n.render(c,P),d.texture.generateMipmaps=z,n.setRenderTarget(d,5),n.render(c,D),n.setRenderTarget(B),n.toneMapping=j,n.xr.enabled=F,d.texture.needsPMREMUpdate=!0}}class Pu extends xr{constructor(n,c,d,m,v,w,C,P,D,B){super(n=n!==void 0?n:[],c=c!==void 0?c:ae,d,m,v,w,C,P,D,B),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(n){this.image=n}}class V_ extends zs{constructor(n=1,c={}){super(n,n,c),this.isWebGLCubeRenderTarget=!0;const d={width:n,height:n,depth:1},m=[d,d,d,d,d,d];c.encoding!==void 0&&(gh("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),c.colorSpace=c.encoding===xl?Yi:Ya),this.texture=new Pu(m,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=c.generateMipmaps!==void 0&&c.generateMipmaps,this.texture.minFilter=c.minFilter!==void 0?c.minFilter:pn}fromEquirectangularTexture(n,c){this.texture.type=c.type,this.texture.colorSpace=c.colorSpace,this.texture.generateMipmaps=c.generateMipmaps,this.texture.minFilter=c.minFilter,this.texture.magFilter=c.magFilter;const d={tEquirect:{value:null}},m=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,v=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,w=new eo(5,5,5),C=new cc({name:"CubemapFromEquirect",uniforms:Iu(d),vertexShader:m,fragmentShader:v,side:Ce,blending:Fe});C.uniforms.tEquirect.value=c;const P=new Ut(w,C),D=c.minFilter;return c.minFilter===_l&&(c.minFilter=pn),new Zc(1,10,this).update(n,P),c.minFilter=D,P.geometry.dispose(),P.material.dispose(),this}clear(n,c,d,m){const v=n.getRenderTarget();for(let w=0;w<6;w++)n.setRenderTarget(this,w),n.clear(c,d,m);n.setRenderTarget(v)}}const uc=new Se,Th=new Se,gA=new _r;class ra{constructor(n=new Se(1,0,0),c=0){this.isPlane=!0,this.normal=n,this.constant=c}set(n,c){return this.normal.copy(n),this.constant=c,this}setComponents(n,c,d,m){return this.normal.set(n,c,d),this.constant=m,this}setFromNormalAndCoplanarPoint(n,c){return this.normal.copy(n),this.constant=-c.dot(this.normal),this}setFromCoplanarPoints(n,c,d){const m=uc.subVectors(d,c).cross(Th.subVectors(n,c)).normalize();return this.setFromNormalAndCoplanarPoint(m,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,c){return c.copy(n).addScaledVector(this.normal,-this.distanceToPoint(n))}intersectLine(n,c){const d=n.delta(uc),m=this.normal.dot(d);if(m===0)return this.distanceToPoint(n.start)===0?c.copy(n.start):null;const v=-(n.start.dot(this.normal)+this.constant)/m;return v<0||v>1?null:c.copy(n.start).addScaledVector(d,v)}intersectsLine(n){const c=this.distanceToPoint(n.start),d=this.distanceToPoint(n.end);return c<0&&d>0||d<0&&c>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,c){const d=c||gA.getNormalMatrix(n),m=this.coplanarPoint(uc).applyMatrix4(n),v=this.normal.applyMatrix3(d).normalize();return this.constant=-m.dot(v),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}}const hc=new Pa,Qd=new Se;class Ef{constructor(n=new ra,c=new ra,d=new ra,m=new ra,v=new ra,w=new ra){this.planes=[n,c,d,m,v,w]}set(n,c,d,m,v,w){const C=this.planes;return C[0].copy(n),C[1].copy(c),C[2].copy(d),C[3].copy(m),C[4].copy(v),C[5].copy(w),this}copy(n){const c=this.planes;for(let d=0;d<6;d++)c[d].copy(n.planes[d]);return this}setFromProjectionMatrix(n,c=Go){const d=this.planes,m=n.elements,v=m[0],w=m[1],C=m[2],P=m[3],D=m[4],B=m[5],j=m[6],F=m[7],z=m[8],G=m[9],W=m[10],Q=m[11],$=m[12],Y=m[13],q=m[14],be=m[15];if(d[0].setComponents(P-v,F-D,Q-z,be-$).normalize(),d[1].setComponents(P+v,F+D,Q+z,be+$).normalize(),d[2].setComponents(P+w,F+B,Q+G,be+Y).normalize(),d[3].setComponents(P-w,F-B,Q-G,be-Y).normalize(),d[4].setComponents(P-C,F-j,Q-W,be-q).normalize(),c===Go)d[5].setComponents(P+C,F+j,Q+W,be+q).normalize();else{if(c!==zc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+c);d[5].setComponents(C,j,W,q).normalize()}return this}intersectsObject(n){if(n.boundingSphere!==void 0)n.boundingSphere===null&&n.computeBoundingSphere(),hc.copy(n.boundingSphere).applyMatrix4(n.matrixWorld);else{const c=n.geometry;c.boundingSphere===null&&c.computeBoundingSphere(),hc.copy(c.boundingSphere).applyMatrix4(n.matrixWorld)}return this.intersectsSphere(hc)}intersectsSprite(n){return hc.center.set(0,0,0),hc.radius=.7071067811865476,hc.applyMatrix4(n.matrixWorld),this.intersectsSphere(hc)}intersectsSphere(n){const c=this.planes,d=n.center,m=-n.radius;for(let v=0;v<6;v++)if(c[v].distanceToPoint(d)<m)return!1;return!0}intersectsBox(n){const c=this.planes;for(let d=0;d<6;d++){const m=c[d];if(Qd.x=m.normal.x>0?n.max.x:n.min.x,Qd.y=m.normal.y>0?n.max.y:n.min.y,Qd.z=m.normal.z>0?n.max.z:n.min.z,m.distanceToPoint(Qd)<0)return!1}return!0}containsPoint(n){const c=this.planes;for(let d=0;d<6;d++)if(c[d].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Wd(){let b=null,n=!1,c=null,d=null;function m(v,w){c(v,w),d=b.requestAnimationFrame(m)}return{start:function(){n!==!0&&c!==null&&(d=b.requestAnimationFrame(m),n=!0)},stop:function(){b.cancelAnimationFrame(d),n=!1},setAnimationLoop:function(v){c=v},setContext:function(v){b=v}}}function Om(b,n){const c=n.isWebGL2,d=new WeakMap;return{get:function(m){return m.isInterleavedBufferAttribute&&(m=m.data),d.get(m)},remove:function(m){m.isInterleavedBufferAttribute&&(m=m.data);const v=d.get(m);v&&(b.deleteBuffer(v.buffer),d.delete(m))},update:function(m,v){if(m.isGLBufferAttribute){const C=d.get(m);return void((!C||C.version<m.version)&&d.set(m,{buffer:m.buffer,type:m.type,bytesPerElement:m.elementSize,version:m.version}))}m.isInterleavedBufferAttribute&&(m=m.data);const w=d.get(m);w===void 0?d.set(m,function(C,P){const D=C.array,B=C.usage,j=b.createBuffer();let F;if(b.bindBuffer(P,j),b.bufferData(P,D,B),C.onUploadCallback(),D instanceof Float32Array)F=b.FLOAT;else if(D instanceof Uint16Array)if(C.isFloat16BufferAttribute){if(!c)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");F=b.HALF_FLOAT}else F=b.UNSIGNED_SHORT;else if(D instanceof Int16Array)F=b.SHORT;else if(D instanceof Uint32Array)F=b.UNSIGNED_INT;else if(D instanceof Int32Array)F=b.INT;else if(D instanceof Int8Array)F=b.BYTE;else if(D instanceof Uint8Array)F=b.UNSIGNED_BYTE;else{if(!(D instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+D);F=b.UNSIGNED_BYTE}return{buffer:j,type:F,bytesPerElement:D.BYTES_PER_ELEMENT,version:C.version}}(m,v)):w.version<m.version&&(function(C,P,D){const B=P.array,j=P.updateRange;b.bindBuffer(D,C),j.count===-1?b.bufferSubData(D,0,B):(c?b.bufferSubData(D,j.offset*B.BYTES_PER_ELEMENT,B,j.offset,j.count):b.bufferSubData(D,j.offset*B.BYTES_PER_ELEMENT,B.subarray(j.offset,j.offset+j.count)),j.count=-1),P.onUploadCallback()}(w.buffer,m,v),w.version=m.version)}}}class Jc extends hr{constructor(n=1,c=1,d=1,m=1){super(),this.type="PlaneGeometry",this.parameters={width:n,height:c,widthSegments:d,heightSegments:m};const v=n/2,w=c/2,C=Math.floor(d),P=Math.floor(m),D=C+1,B=P+1,j=n/C,F=c/P,z=[],G=[],W=[],Q=[];for(let $=0;$<B;$++){const Y=$*F-w;for(let q=0;q<D;q++){const be=q*j-v;G.push(be,-Y,0),W.push(0,0,1),Q.push(q/C),Q.push(1-$/P)}}for(let $=0;$<P;$++)for(let Y=0;Y<C;Y++){const q=Y+D*$,be=Y+D*($+1),we=Y+1+D*($+1),me=Y+1+D*$;z.push(q,be,me),z.push(be,we,me)}this.setIndex(z),this.setAttribute("position",new pe(G,3)),this.setAttribute("normal",new pe(W,3)),this.setAttribute("uv",new pe(Q,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new Jc(n.width,n.height,n.widthSegments,n.heightSegments)}}const Er={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},_i={common:{diffuse:{value:new xi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new _r},alphaMap:{value:null},alphaMapTransform:{value:new _r},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new _r}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new _r}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new _r}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new _r},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new _r},normalScale:{value:new Jt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new _r},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new _r}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new _r}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new _r}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new xi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new _r},alphaTest:{value:0},uvTransform:{value:new _r}},sprite:{diffuse:{value:new xi(16777215)},opacity:{value:1},center:{value:new Jt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new _r},alphaMap:{value:null},alphaMapTransform:{value:new _r},alphaTest:{value:0}}},Pn={basic:{uniforms:Ps([_i.common,_i.specularmap,_i.envmap,_i.aomap,_i.lightmap,_i.fog]),vertexShader:Er.meshbasic_vert,fragmentShader:Er.meshbasic_frag},lambert:{uniforms:Ps([_i.common,_i.specularmap,_i.envmap,_i.aomap,_i.lightmap,_i.emissivemap,_i.bumpmap,_i.normalmap,_i.displacementmap,_i.fog,_i.lights,{emissive:{value:new xi(0)}}]),vertexShader:Er.meshlambert_vert,fragmentShader:Er.meshlambert_frag},phong:{uniforms:Ps([_i.common,_i.specularmap,_i.envmap,_i.aomap,_i.lightmap,_i.emissivemap,_i.bumpmap,_i.normalmap,_i.displacementmap,_i.fog,_i.lights,{emissive:{value:new xi(0)},specular:{value:new xi(1118481)},shininess:{value:30}}]),vertexShader:Er.meshphong_vert,fragmentShader:Er.meshphong_frag},standard:{uniforms:Ps([_i.common,_i.envmap,_i.aomap,_i.lightmap,_i.emissivemap,_i.bumpmap,_i.normalmap,_i.displacementmap,_i.roughnessmap,_i.metalnessmap,_i.fog,_i.lights,{emissive:{value:new xi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Er.meshphysical_vert,fragmentShader:Er.meshphysical_frag},toon:{uniforms:Ps([_i.common,_i.aomap,_i.lightmap,_i.emissivemap,_i.bumpmap,_i.normalmap,_i.displacementmap,_i.gradientmap,_i.fog,_i.lights,{emissive:{value:new xi(0)}}]),vertexShader:Er.meshtoon_vert,fragmentShader:Er.meshtoon_frag},matcap:{uniforms:Ps([_i.common,_i.bumpmap,_i.normalmap,_i.displacementmap,_i.fog,{matcap:{value:null}}]),vertexShader:Er.meshmatcap_vert,fragmentShader:Er.meshmatcap_frag},points:{uniforms:Ps([_i.points,_i.fog]),vertexShader:Er.points_vert,fragmentShader:Er.points_frag},dashed:{uniforms:Ps([_i.common,_i.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Er.linedashed_vert,fragmentShader:Er.linedashed_frag},depth:{uniforms:Ps([_i.common,_i.displacementmap]),vertexShader:Er.depth_vert,fragmentShader:Er.depth_frag},normal:{uniforms:Ps([_i.common,_i.bumpmap,_i.normalmap,_i.displacementmap,{opacity:{value:1}}]),vertexShader:Er.meshnormal_vert,fragmentShader:Er.meshnormal_frag},sprite:{uniforms:Ps([_i.sprite,_i.fog]),vertexShader:Er.sprite_vert,fragmentShader:Er.sprite_frag},background:{uniforms:{uvTransform:{value:new _r},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new xi(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:Er.background_vert,fragmentShader:Er.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Er.backgroundCube_vert,fragmentShader:Er.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Er.cube_vert,fragmentShader:Er.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Er.equirect_vert,fragmentShader:Er.equirect_frag},distanceRGBA:{uniforms:Ps([_i.common,_i.displacementmap,{referencePosition:{value:new Se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Er.distanceRGBA_vert,fragmentShader:Er.distanceRGBA_frag},shadow:{uniforms:Ps([_i.lights,_i.fog,{color:{value:new xi(0)},opacity:{value:1}}]),vertexShader:Er.shadow_vert,fragmentShader:Er.shadow_frag}};Pn.physical={uniforms:Ps([Pn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new _r},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new _r},clearcoatNormalScale:{value:new Jt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new _r},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new _r},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new _r},sheen:{value:0},sheenColor:{value:new xi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new _r},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new _r},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new _r},transmissionSamplerSize:{value:new Jt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new _r},attenuationDistance:{value:0},attenuationColor:{value:new xi(0)},specularColor:{value:new xi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new _r},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new _r},anisotropyVector:{value:new Jt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new _r}}]),vertexShader:Er.meshphysical_vert,fragmentShader:Er.meshphysical_frag};const bo={r:0,b:0,g:0};function Lm(b,n,c,d,m,v,w){const C=new xi(0);let P,D,B=v===!0?0:1,j=null,F=0,z=null;function G(W,Q){W.getRGB(bo,to(b)),d.buffers.color.setClear(bo.r,bo.g,bo.b,Q,w)}return{getClearColor:function(){return C},setClearColor:function(W,Q=1){C.set(W),B=Q,G(C,B)},getClearAlpha:function(){return B},setClearAlpha:function(W){B=W,G(C,B)},getPlaneMesh:function(){return P},getBoxMesh:function(){return D},getBoxMesh2:function(){return D===void 0&&(D=new Ut(new eo(1,1,1),new cc({name:"BackgroundCubeMaterial",uniforms:Iu(Pn.backgroundCube.uniforms),vertexShader:Pn.backgroundCube.vertexShader,fragmentShader:Pn.backgroundCube.fragmentShader,side:Ce,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),D.geometry.deleteAttribute("uv"),D.onBeforeRender=function(W,Q,$){this.matrixWorld.copyPosition($.matrixWorld)},Object.defineProperty(D.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),m.update(D)),D},render:function(W,Q){let $=!1,Y=Q.isScene===!0?Q.background:null;const q=Q.isScene&&Q.backgroundColor!==void 0?Q.backgroundColor:null;switch(Y==="environment"&&(Y=Q.environment),Y&&Y.isTexture&&(Y=(Q.backgroundBlurriness>0?c:n).get(Y)),Y===null?G(C,B):Y&&Y.isColor&&(G(Y,1),$=!0),b.xr.getEnvironmentBlendMode()){case"opaque":$=!0;break;case"additive":d.buffers.color.setClear(0,0,0,1,w),$=!0;break;case"alpha-blend":d.buffers.color.setClear(0,0,0,0,w),$=!0}if((b.autoClear||$)&&b.clear(b.autoClearColor,b.autoClearDepth,b.autoClearStencil),Y&&(Y.isCubeTexture||Y.mapping===cr))D===void 0&&(D=new Ut(new eo(1,1,1),new cc({name:"BackgroundCubeMaterial",uniforms:Iu(Pn.backgroundCube.uniforms),vertexShader:Pn.backgroundCube.vertexShader,fragmentShader:Pn.backgroundCube.fragmentShader,side:Ce,depthTest:!1,depthWrite:!1,fog:!1})),D.geometry.deleteAttribute("normal"),D.geometry.deleteAttribute("uv"),D.onBeforeRender=function(be,we,me){this.matrixWorld.copyPosition(me.matrixWorld)},Object.defineProperty(D.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),m.update(D)),D.material.uniforms.envMap.value=Y,D.material.uniforms.envMapRotation.value=Y&&Y.rotation||0,D.material.uniforms.envMapIntensity.value=Y===Q.environment&&Q.envMapIntensity||1,D.material.uniforms.flipEnvMap.value=Y.isCubeTexture&&Y.isRenderTargetTexture===!1?-1:1,D.material.uniforms.backgroundBlurriness.value=Q.backgroundBlurriness,D.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,D.material.toneMapped=Y.colorSpace!==Yi,j===Y&&F===Y.version&&z===b.toneMapping||(D.material.needsUpdate=!0,j=Y,F=Y.version,z=b.toneMapping),D.layers.enableAll(),W.unshift(D,D.geometry,D.material,0,0,null);else if(Y&&Y.isTexture||!Y&&q){P===void 0&&(P=new Ut(new Jc(2,2),new cc({name:"BackgroundMaterial",uniforms:Iu(Pn.background.uniforms),vertexShader:Pn.background.vertexShader,fragmentShader:Pn.background.fragmentShader,side:lt,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),Object.defineProperty(P.material,"map",{get:function(){return this.uniforms.t2D.value}}),m.update(P)),P.material.uniforms.backgroundColor.value.set(q||16777215),P.material.uniforms.t2D.value=Y,P.material.uniforms.backgroundIntensity.value=Q.backgroundIntensity,Y?(P.material.toneMapped=Y.colorSpace!==Yi,P.material.uniforms.flipX.value=Y.userData.flipX||!1,P.material.uniforms.flipY.value=Y.userData.flipY||!1,Y.matrixAutoUpdate===!0&&Y.updateMatrix(),P.material.uniforms.uvTransform.value.copy(Y.matrix),P.material.defines.HAS_TEXTURE="1"):P.material.defines.HAS_TEXTURE&&delete P.material.defines.HAS_TEXTURE;const be=Y?Y.version:-1;j===Y&&F===be&&z===b.toneMapping||(P.material.needsUpdate=!0,j=Y,F=be,z=b.toneMapping),P.layers.enableAll(),W.unshift(P,P.geometry,P.material,0,0,null)}}}}function vA(b,n,c,d){const m=b.getParameter(b.MAX_VERTEX_ATTRIBS),v=d.isWebGL2?null:n.get("OES_vertex_array_object"),w=d.isWebGL2||v!==null,C={},P=z(null);let D=P,B=!1;function j(we){return d.isWebGL2?b.bindVertexArray(we):v.bindVertexArrayOES(we)}function F(we){return d.isWebGL2?b.deleteVertexArray(we):v.deleteVertexArrayOES(we)}function z(we){const me=[],Be=[],Ze=[];for(let et=0;et<m;et++)me[et]=0,Be[et]=0,Ze[et]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:me,enabledAttributes:Be,attributeDivisors:Ze,object:we,attributes:{},index:null}}function G(){const we=D.newAttributes;for(let me=0,Be=we.length;me<Be;me++)we[me]=0}function W(we){Q(we,0)}function Q(we,me){const Be=D.newAttributes,Ze=D.enabledAttributes,et=D.attributeDivisors;Be[we]=1,Ze[we]===0&&(b.enableVertexAttribArray(we),Ze[we]=1),et[we]!==me&&((d.isWebGL2?b:n.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](we,me),et[we]=me)}function $(){const we=D.newAttributes,me=D.enabledAttributes;for(let Be=0,Ze=me.length;Be<Ze;Be++)me[Be]!==we[Be]&&(b.disableVertexAttribArray(Be),me[Be]=0)}function Y(we,me,Be,Ze,et,ft,Le){Le===!0?b.vertexAttribIPointer(we,me,Be,et,ft):b.vertexAttribPointer(we,me,Be,Ze,et,ft)}function q(){be(),B=!0,D!==P&&(D=P,j(D.object))}function be(){P.geometry=null,P.program=null,P.wireframe=!1}return{setup:function(we,me,Be,Ze,et){let ft=!1;if(w){const Le=function(Gt,Ht,ri){const hi=ri.wireframe===!0;let ei=C[Gt.id];ei===void 0&&(ei={},C[Gt.id]=ei);let Xt=ei[Ht.id];Xt===void 0&&(Xt={},ei[Ht.id]=Xt);let oi=Xt[hi];return oi===void 0&&(oi=z(d.isWebGL2?b.createVertexArray():v.createVertexArrayOES()),Xt[hi]=oi),oi}(Ze,Be,me);D!==Le&&(D=Le,j(D.object)),ft=function(Gt,Ht,ri,hi){const ei=D.attributes,Xt=Ht.attributes;let oi=0;const Pt=ri.getAttributes();for(const Nt in Pt)if(Pt[Nt].location>=0){const ci=ei[Nt];let pi=Xt[Nt];if(pi===void 0&&(Nt==="instanceMatrix"&&Gt.instanceMatrix&&(pi=Gt.instanceMatrix),Nt==="instanceColor"&&Gt.instanceColor&&(pi=Gt.instanceColor)),ci===void 0||ci.attribute!==pi||pi&&ci.data!==pi.data)return!0;oi++}return D.attributesNum!==oi||D.index!==hi}(we,Ze,Be,et),ft&&function(Gt,Ht,ri,hi){const ei={},Xt=Ht.attributes;let oi=0;const Pt=ri.getAttributes();for(const Nt in Pt)if(Pt[Nt].location>=0){let ci=Xt[Nt];ci===void 0&&(Nt==="instanceMatrix"&&Gt.instanceMatrix&&(ci=Gt.instanceMatrix),Nt==="instanceColor"&&Gt.instanceColor&&(ci=Gt.instanceColor));const pi={};pi.attribute=ci,ci&&ci.data&&(pi.data=ci.data),ei[Nt]=pi,oi++}D.attributes=ei,D.attributesNum=oi,D.index=hi}(we,Ze,Be,et)}else{const Le=me.wireframe===!0;D.geometry===Ze.id&&D.program===Be.id&&D.wireframe===Le||(D.geometry=Ze.id,D.program=Be.id,D.wireframe=Le,ft=!0)}et!==null&&c.update(et,b.ELEMENT_ARRAY_BUFFER),(ft||B)&&(B=!1,function(Le,Gt,Ht,ri){if(d.isWebGL2===!1&&(Le.isInstancedMesh||ri.isInstancedBufferGeometry)&&n.get("ANGLE_instanced_arrays")===null)return;G();const hi=ri.attributes,ei=Ht.getAttributes(),Xt=Gt.defaultAttributeValues;for(const oi in ei){const Pt=ei[oi];if(Pt.location>=0){let Nt=hi[oi];if(Nt===void 0&&(oi==="instanceMatrix"&&Le.instanceMatrix&&(Nt=Le.instanceMatrix),oi==="instanceColor"&&Le.instanceColor&&(Nt=Le.instanceColor)),Nt!==void 0){const ci=Nt.normalized,pi=Nt.itemSize,$i=c.get(Nt);if($i===void 0)continue;const yi=$i.buffer,qi=$i.type,Ri=$i.bytesPerElement,De=d.isWebGL2===!0&&(qi===b.INT||qi===b.UNSIGNED_INT||Nt.gpuType===vm);if(Nt.isInterleavedBufferAttribute){const Me=Nt.data,Ge=Me.stride,ht=Nt.offset;if(Me.isInstancedInterleavedBuffer){for(let Oe=0;Oe<Pt.locationSize;Oe++)Q(Pt.location+Oe,Me.meshPerAttribute);Le.isInstancedMesh!==!0&&ri._maxInstanceCount===void 0&&(ri._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let Oe=0;Oe<Pt.locationSize;Oe++)W(Pt.location+Oe);b.bindBuffer(b.ARRAY_BUFFER,yi);for(let Oe=0;Oe<Pt.locationSize;Oe++)Y(Pt.location+Oe,pi/Pt.locationSize,qi,ci,Ge*Ri,(ht+pi/Pt.locationSize*Oe)*Ri,De)}else{if(Nt.isInstancedBufferAttribute){for(let Me=0;Me<Pt.locationSize;Me++)Q(Pt.location+Me,Nt.meshPerAttribute);Le.isInstancedMesh!==!0&&ri._maxInstanceCount===void 0&&(ri._maxInstanceCount=Nt.meshPerAttribute*Nt.count)}else for(let Me=0;Me<Pt.locationSize;Me++)W(Pt.location+Me);b.bindBuffer(b.ARRAY_BUFFER,yi);for(let Me=0;Me<Pt.locationSize;Me++)Y(Pt.location+Me,pi/Pt.locationSize,qi,ci,pi*Ri,pi/Pt.locationSize*Me*Ri,De)}}else if(Xt!==void 0){const ci=Xt[oi];if(ci!==void 0)switch(ci.length){case 2:b.vertexAttrib2fv(Pt.location,ci);break;case 3:b.vertexAttrib3fv(Pt.location,ci);break;case 4:b.vertexAttrib4fv(Pt.location,ci);break;default:b.vertexAttrib1fv(Pt.location,ci)}}}}$()}(we,me,Be,Ze),et!==null&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.get(et).buffer))},reset:q,resetDefaultState:be,dispose:function(){q();for(const we in C){const me=C[we];for(const Be in me){const Ze=me[Be];for(const et in Ze)F(Ze[et].object),delete Ze[et];delete me[Be]}delete C[we]}},releaseStatesOfGeometry:function(we){if(C[we.id]===void 0)return;const me=C[we.id];for(const Be in me){const Ze=me[Be];for(const et in Ze)F(Ze[et].object),delete Ze[et];delete me[Be]}delete C[we.id]},releaseStatesOfProgram:function(we){for(const me in C){const Be=C[me];if(Be[we.id]===void 0)continue;const Ze=Be[we.id];for(const et in Ze)F(Ze[et].object),delete Ze[et];delete Be[we.id]}},initAttributes:G,enableAttribute:W,disableUnusedAttributes:$}}function G_(b,n,c,d){const m=d.isWebGL2;let v;this.setMode=function(w){v=w},this.render=function(w,C){b.drawArrays(v,w,C),c.update(C,v,1)},this.renderInstances=function(w,C,P){if(P===0)return;let D,B;if(m)D=b,B="drawArraysInstanced";else if(D=n.get("ANGLE_instanced_arrays"),B="drawArraysInstancedANGLE",D===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");D[B](v,w,C,P),c.update(C,v,P)}}function km(b,n,c){let d;function m(be){if(be==="highp"){if(b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT).precision>0&&b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT).precision>0)return"highp";be="mediump"}return be==="mediump"&&b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT).precision>0&&b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const v=typeof WebGL2RenderingContext<"u"&&b.constructor.name==="WebGL2RenderingContext";let w=c.precision!==void 0?c.precision:"highp";const C=m(w);C!==w&&(console.warn("THREE.WebGLRenderer:",w,"not supported, using",C,"instead."),w=C);const P=v||n.has("WEBGL_draw_buffers"),D=c.logarithmicDepthBuffer===!0,B=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS),j=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),F=b.getParameter(b.MAX_TEXTURE_SIZE),z=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),G=b.getParameter(b.MAX_VERTEX_ATTRIBS),W=b.getParameter(b.MAX_VERTEX_UNIFORM_VECTORS),Q=b.getParameter(b.MAX_VARYING_VECTORS),$=b.getParameter(b.MAX_FRAGMENT_UNIFORM_VECTORS),Y=j>0,q=v||n.has("OES_texture_float");return{isWebGL2:v,drawBuffers:P,getMaxAnisotropy:function(){if(d!==void 0)return d;if(n.has("EXT_texture_filter_anisotropic")===!0){const be=n.get("EXT_texture_filter_anisotropic");d=b.getParameter(be.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d},getMaxPrecision:m,precision:w,logarithmicDepthBuffer:D,maxTextures:B,maxVertexTextures:j,maxTextureSize:F,maxCubemapSize:z,maxAttributes:G,maxVertexUniforms:W,maxVaryings:Q,maxFragmentUniforms:$,vertexTextures:Y,floatFragmentTextures:q,floatVertexTextures:Y&&q,maxSamples:v?b.getParameter(b.MAX_SAMPLES):0}}function Xd(b){const n=this;let c=null,d=0,m=!1,v=!1;const w=new ra,C=new _r,P={value:null,needsUpdate:!1};function D(B,j,F,z){const G=B!==null?B.length:0;let W=null;if(G!==0){if(W=P.value,z!==!0||W===null){const Q=F+4*G,$=j.matrixWorldInverse;C.getNormalMatrix($),(W===null||W.length<Q)&&(W=new Float32Array(Q));for(let Y=0,q=F;Y!==G;++Y,q+=4)w.copy(B[Y]).applyMatrix4($,C),w.normal.toArray(W,q),W[q+3]=w.constant}P.value=W,P.needsUpdate=!0}return n.numPlanes=G,n.numIntersection=0,W}this.uniform=P,this.numPlanes=0,this.numIntersection=0,this.init=function(B,j){const F=B.length!==0||j||d!==0||m;return m=j,d=B.length,F},this.beginShadows=function(){v=!0,D(null)},this.endShadows=function(){v=!1},this.setGlobalState=function(B,j){c=D(B,j,0)},this.setState=function(B,j,F){const z=B.clippingPlanes,G=B.clipIntersection,W=B.clipShadows,Q=b.get(B);if(!m||z===null||z.length===0||v&&!W)v?D(null):(P.value!==c&&(P.value=c,P.needsUpdate=d>0),n.numPlanes=d,n.numIntersection=0);else{const $=v?0:d,Y=4*$;let q=Q.clippingState||null;P.value=q,q=D(z,j,Y,F);for(let be=0;be!==Y;++be)q[be]=c[be];Q.clippingState=q,this.numIntersection=G?this.numPlanes:0,this.numPlanes+=$}}}function Ru(b){let n=new WeakMap;function c(m,v){return v===An?m.mapping=ae:v===ps&&(m.mapping=Gr),m}function d(m){const v=m.target;v.removeEventListener("dispose",d);const w=n.get(v);w!==void 0&&(n.delete(v),w.dispose())}return{get:function(m){if(m&&m.isTexture&&m.isRenderTargetTexture===!1){const v=m.mapping;if(v===An||v===ps){if(n.has(m)){const w=n.get(m).texture;return w.rotation=m.rotation,c(w,m.mapping)}{const w=m.image;if(w&&w.height>0){const C=new V_(w.height/2);return C.fromEquirectangularTexture(b,m),C.texture.rotation=m.rotation,n.set(m,C),m.addEventListener("dispose",d),c(C.texture,m.mapping)}return null}}}return m},dispose:function(){n=new WeakMap}}}class Ao extends Dv{constructor(n=-1,c=1,d=1,m=-1,v=.1,w=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=c,this.top=d,this.bottom=m,this.near=v,this.far=w,this.updateProjectionMatrix()}copy(n,c){return super.copy(n,c),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,c,d,m,v,w){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=c,this.view.offsetX=d,this.view.offsetY=m,this.view.width=v,this.view.height=w,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/2,m=(this.top+this.bottom)/2;let v=d-n,w=d+n,C=m+c,P=m-c;if(this.view!==null&&this.view.enabled){const D=(this.right-this.left)/this.view.fullWidth/this.zoom,B=(this.top-this.bottom)/this.view.fullHeight/this.zoom;v+=D*this.view.offsetX,w=v+D*this.view.width,C-=B*this.view.offsetY,P=C-B*this.view.height}this.projectionMatrix.makeOrthographic(v,w,C,P,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const c=super.toJSON(n);return c.object.zoom=this.zoom,c.object.left=this.left,c.object.right=this.right,c.object.top=this.top,c.object.bottom=this.bottom,c.object.near=this.near,c.object.far=this.far,this.view!==null&&(c.object.view=Object.assign({},this.view)),c}}const H_=[.125,.215,.35,.446,.526,.582],Aa=20,Bv=new Ao,qd=new xi;let Ov=null;const Yd=(1+Math.sqrt(5))/2,Ko=1/Yd,Lv=[new Se(1,1,1),new Se(-1,1,1),new Se(1,1,-1),new Se(-1,1,-1),new Se(0,Yd,Ko),new Se(0,Yd,-Ko),new Se(Ko,0,Yd),new Se(-Ko,0,Yd),new Se(Yd,Ko,0),new Se(-Yd,Ko,0)];class kv{constructor(n){this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(n,c=0,d=.1,m=100){Ov=this._renderer.getRenderTarget(),this._setSize(256);const v=this._allocateTargets();return v.depthBuffer=!0,this._sceneToCubeUV(n,d,m,v),c>0&&this._blur(v,0,0,c),this._applyPMREM(v),this._cleanup(v),v}fromEquirectangular(n,c=null){return this._fromTexture(n,c)}fromCubemap(n,c=null){return this._fromTexture(n,c)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Nv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Dl(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(n){this._lodMax=Math.floor(Math.log2(n)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let n=0;n<this._lodPlanes.length;n++)this._lodPlanes[n].dispose()}_cleanup(n){this._renderer.setRenderTarget(Ov),n.scissorTest=!1,As(n,0,0,n.width,n.height)}_fromTexture(n,c){n.mapping===ae||n.mapping===Gr?this._setSize(n.image.length===0?16:n.image[0].width||n.image[0].image.width):this._setSize(n.image.width/4),Ov=this._renderer.getRenderTarget();const d=c||this._allocateTargets();return this._textureToCubeUV(n,d),this._applyPMREM(d),this._cleanup(d),d}_allocateTargets(){const n=3*Math.max(this._cubeSize,112),c=4*this._cubeSize,d={magFilter:pn,minFilter:pn,generateMipmaps:!1,type:sn,format:en,colorSpace:an,depthBuffer:!1},m=Uv(n,c,d);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==n||this._pingPongRenderTarget.height!==c){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Uv(n,c,d);const{_lodMax:v}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(w){const C=[],P=[],D=[];let B=w;const j=w-4+1+H_.length;for(let F=0;F<j;F++){const z=Math.pow(2,B);P.push(z);let G=1/z;F>w-4?G=H_[F-w+4-1]:F===0&&(G=0),D.push(G);const W=1/(z-2),Q=-W,$=1+W,Y=[Q,Q,$,Q,$,$,Q,Q,$,$,Q,$],q=6,be=6,we=3,me=2,Be=1,Ze=new Float32Array(we*be*q),et=new Float32Array(me*be*q),ft=new Float32Array(Be*be*q);for(let Gt=0;Gt<q;Gt++){const Ht=Gt%3*2/3-1,ri=Gt>2?0:-1,hi=[Ht,ri,0,Ht+2/3,ri,0,Ht+2/3,ri+1,0,Ht,ri,0,Ht+2/3,ri+1,0,Ht,ri+1,0];Ze.set(hi,we*be*Gt),et.set(Y,me*be*Gt);const ei=[Gt,Gt,Gt,Gt,Gt,Gt];ft.set(ei,Be*be*Gt)}const Le=new hr;Le.setAttribute("position",new on(Ze,we)),Le.setAttribute("uv",new on(et,me)),Le.setAttribute("faceIndex",new on(ft,Be)),C.push(Le),B>4&&B--}return{lodPlanes:C,sizeLods:P,sigmas:D}}(v)),this._blurMaterial=function(w,C,P){const D=new Float32Array(Aa),B=new Se(0,1,0);return new cc({name:"SphericalGaussianBlur",defines:{n:Aa,CUBEUV_TEXEL_WIDTH:1/C,CUBEUV_TEXEL_HEIGHT:1/P,CUBEUV_MAX_MIP:`${w}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:D},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:B}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}(v,n,c)}return m}_compileMaterial(n){const c=new Ut(this._lodPlanes[0],n);this._renderer.compile(c,Bv)}_sceneToCubeUV(n,c,d,m){const v=new vn(90,1,c,d),w=[1,-1,1,1,1,1],C=[1,1,1,-1,-1,-1],P=this._renderer,D=P.autoClear,B=P.toneMapping;P.getClearColor(qd),P.toneMapping=Vr,P.autoClear=!1;const j=new qc({name:"PMREM.Background",side:Ce,depthWrite:!1,depthTest:!1}),F=new Ut(new eo,j);let z=!1;const G=n.background;G?G.isColor&&(j.color.copy(G),n.background=null,z=!0):(j.color.copy(qd),z=!0);for(let W=0;W<6;W++){const Q=W%3;Q===0?(v.up.set(0,w[W],0),v.lookAt(C[W],0,0)):Q===1?(v.up.set(0,0,w[W]),v.lookAt(0,C[W],0)):(v.up.set(0,w[W],0),v.lookAt(0,0,C[W]));const $=this._cubeSize;As(m,Q*$,W>2?$:0,$,$),P.setRenderTarget(m),z&&P.render(F,v),P.render(n,v)}F.geometry.dispose(),F.material.dispose(),P.toneMapping=B,P.autoClear=D,n.background=G}_textureToCubeUV(n,c){const d=this._renderer,m=n.mapping===ae||n.mapping===Gr;m?(this._cubemapMaterial===null&&(this._cubemapMaterial=Nv()),this._cubemapMaterial.uniforms.flipEnvMap.value=n.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Dl());const v=m?this._cubemapMaterial:this._equirectMaterial,w=new Ut(this._lodPlanes[0],v);v.uniforms.envMap.value=n;const C=this._cubeSize;As(c,0,0,3*C,2*C),d.setRenderTarget(c),d.render(w,Bv)}_applyPMREM(n){const c=this._renderer,d=c.autoClear;c.autoClear=!1;for(let m=1;m<this._lodPlanes.length;m++){const v=Math.sqrt(this._sigmas[m]*this._sigmas[m]-this._sigmas[m-1]*this._sigmas[m-1]),w=Lv[(m-1)%Lv.length];this._blur(n,m-1,m,v,w)}c.autoClear=d}_blur(n,c,d,m,v){const w=this._pingPongRenderTarget;this._halfBlur(n,w,c,d,m,"latitudinal",v),this._halfBlur(w,n,d,d,m,"longitudinal",v)}_halfBlur(n,c,d,m,v,w,C){const P=this._renderer,D=this._blurMaterial;w!=="latitudinal"&&w!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const B=new Ut(this._lodPlanes[m],D),j=D.uniforms,F=this._sizeLods[d]-1,z=isFinite(v)?Math.PI/(2*F):2*Math.PI/39,G=v/z,W=isFinite(v)?1+Math.floor(3*G):Aa;W>Aa&&console.warn(`sigmaRadians, ${v}, is too large and will clip, as it requested ${W} samples when the maximum is set to 20`);const Q=[];let $=0;for(let be=0;be<Aa;++be){const we=be/G,me=Math.exp(-we*we/2);Q.push(me),be===0?$+=me:be<W&&($+=2*me)}for(let be=0;be<Q.length;be++)Q[be]=Q[be]/$;j.envMap.value=n.texture,j.samples.value=W,j.weights.value=Q,j.latitudinal.value=w==="latitudinal",C&&(j.poleAxis.value=C);const{_lodMax:Y}=this;j.dTheta.value=z,j.mipInt.value=Y-d;const q=this._sizeLods[m];As(c,3*q*(m>Y-4?m-Y+4:0),4*(this._cubeSize-q),3*q,2*q),P.setRenderTarget(c),P.render(B,Bv)}}function Uv(b,n,c){const d=new zs(b,n,c);return d.texture.mapping=cr,d.texture.name="PMREM.cubeUv",d.scissorTest=!0,d}function As(b,n,c,d,m){b.viewport.set(n,c,d,m),b.scissor.set(n,c,d,m)}function Dl(){return new cc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}function Nv(){return new cc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Fe,depthTest:!1,depthWrite:!1})}function Ih(b){let n=new WeakMap,c=null;function d(m){const v=m.target;v.removeEventListener("dispose",d);const w=n.get(v);w!==void 0&&(n.delete(v),w.dispose())}return{get:function(m){if(m&&m.isTexture){const v=m.mapping,w=v===An||v===ps,C=v===ae||v===Gr;if(w||C){if(m.isRenderTargetTexture&&m.needsPMREMUpdate===!0){m.needsPMREMUpdate=!1;let P=n.get(m);return c===null&&(c=new kv(b)),P=w?c.fromEquirectangular(m,P):c.fromCubemap(m,P),n.set(m,P),P.texture}if(n.has(m))return n.get(m).texture;{const P=m.image;if(w&&P&&P.height>0||C&&P&&function(D){let B=0;for(let j=0;j<6;j++)D[j]!==void 0&&B++;return B===6}(P)){c===null&&(c=new kv(b));const D=w?c.fromEquirectangular(m):c.fromCubemap(m);return n.set(m,D),m.addEventListener("dispose",d),D.texture}return null}}}return m},dispose:function(){n=new WeakMap,c!==null&&(c.dispose(),c=null)}}}function _A(b){const n={};function c(d){if(n[d]!==void 0)return n[d];let m;switch(d){case"WEBGL_depth_texture":m=b.getExtension("WEBGL_depth_texture")||b.getExtension("MOZ_WEBGL_depth_texture")||b.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":m=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":m=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":m=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:m=b.getExtension(d)}return n[d]=m,m}return{has:function(d){return c(d)!==null},init:function(d){d.isWebGL2?c("EXT_color_buffer_float"):(c("WEBGL_depth_texture"),c("OES_texture_float"),c("OES_texture_half_float"),c("OES_texture_half_float_linear"),c("OES_standard_derivatives"),c("OES_element_index_uint"),c("OES_vertex_array_object"),c("ANGLE_instanced_arrays")),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture")},get:function(d){const m=c(d);return m===null&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported."),m}}}function Zo(b,n,c,d){const m={},v=new WeakMap;function w(P){const D=P.target;D.index!==null&&n.remove(D.index);for(const j in D.attributes)n.remove(D.attributes[j]);for(const j in D.morphAttributes){const F=D.morphAttributes[j];for(let z=0,G=F.length;z<G;z++)n.remove(F[z])}D.removeEventListener("dispose",w),delete m[D.id];const B=v.get(D);B&&(n.remove(B),v.delete(D)),d.releaseStatesOfGeometry(D),D.isInstancedBufferGeometry===!0&&delete D._maxInstanceCount,c.memory.geometries--}function C(P){const D=[],B=P.index,j=P.attributes.position;let F=0;if(B!==null){const W=B.array;F=B.version;for(let Q=0,$=W.length;Q<$;Q+=3){const Y=W[Q+0],q=W[Q+1],be=W[Q+2];D.push(Y,q,q,be,be,Y)}}else{const W=j.array;F=j.version;for(let Q=0,$=W.length/3-1;Q<$;Q+=3){const Y=Q+0,q=Q+1,be=Q+2;D.push(Y,q,q,be,be,Y)}}const z=new(mh(D)?J:M)(D,1);z.version=F;const G=v.get(P);G&&n.remove(G),v.set(P,z)}return{get:function(P,D){return m[D.id]===!0||(D.addEventListener("dispose",w),m[D.id]=!0,c.memory.geometries++),D},update:function(P){const D=P.attributes;for(const j in D)n.update(D[j],b.ARRAY_BUFFER);const B=P.morphAttributes;for(const j in B){const F=B[j];for(let z=0,G=F.length;z<G;z++)n.update(F[z],b.ARRAY_BUFFER)}},getWireframeAttribute:function(P){const D=v.get(P);if(D){const B=P.index;B!==null&&D.version<B.version&&C(P)}else C(P);return v.get(P)}}}function Q_(b,n,c,d){const m=d.isWebGL2;let v,w,C;this.setMode=function(P){v=P},this.setIndex=function(P){w=P.type,C=P.bytesPerElement},this.render=function(P,D){b.drawElements(v,D,w,P*C),c.update(D,v,1)},this.renderInstances=function(P,D,B){if(B===0)return;let j,F;if(m)j=b,F="drawElementsInstanced";else if(j=n.get("ANGLE_instanced_arrays"),F="drawElementsInstancedANGLE",j===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");j[F](v,D,w,P*C,B),c.update(D,v,B)}}function Q1(b){const n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function(){n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function(c,d,m){switch(n.calls++,d){case b.TRIANGLES:n.triangles+=m*(c/3);break;case b.LINES:n.lines+=m*(c/2);break;case b.LINE_STRIP:n.lines+=m*(c-1);break;case b.LINE_LOOP:n.lines+=m*c;break;case b.POINTS:n.points+=m*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d)}}}}function W1(b,n){return b[0]-n[0]}function Sf(b,n){return Math.abs(n[1])-Math.abs(b[1])}function yA(b,n,c){const d={},m=new Float32Array(8),v=new WeakMap,w=new Tr,C=[];for(let P=0;P<8;P++)C[P]=[P,0];return{update:function(P,D,B){const j=P.morphTargetInfluences;if(n.isWebGL2===!0){const F=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,z=F!==void 0?F.length:0;let G=v.get(D);if(G===void 0||G.count!==z){G!==void 0&&G.texture.dispose();const $=D.morphAttributes.position!==void 0,Y=D.morphAttributes.normal!==void 0,q=D.morphAttributes.color!==void 0,be=D.morphAttributes.position||[],we=D.morphAttributes.normal||[],me=D.morphAttributes.color||[];let Be=0;$===!0&&(Be=1),Y===!0&&(Be=2),q===!0&&(Be=3);let Ze=D.attributes.position.count*Be,et=1;Ze>n.maxTextureSize&&(et=Math.ceil(Ze/n.maxTextureSize),Ze=n.maxTextureSize);const ft=new Float32Array(Ze*et*4*z),Le=new Qo(ft,Ze,et,z);Le.type=bl,Le.needsUpdate=!0;const Gt=4*Be;for(let Ht=0;Ht<z;Ht++){const ri=be[Ht],hi=we[Ht],ei=me[Ht],Xt=Ze*et*4*Ht;for(let oi=0;oi<ri.count;oi++){const Pt=oi*Gt;$===!0&&(w.fromBufferAttribute(ri,oi),ft[Xt+Pt+0]=w.x,ft[Xt+Pt+1]=w.y,ft[Xt+Pt+2]=w.z,ft[Xt+Pt+3]=0),Y===!0&&(w.fromBufferAttribute(hi,oi),ft[Xt+Pt+4]=w.x,ft[Xt+Pt+5]=w.y,ft[Xt+Pt+6]=w.z,ft[Xt+Pt+7]=0),q===!0&&(w.fromBufferAttribute(ei,oi),ft[Xt+Pt+8]=w.x,ft[Xt+Pt+9]=w.y,ft[Xt+Pt+10]=w.z,ft[Xt+Pt+11]=ei.itemSize===4?w.w:1)}}G={count:z,texture:Le,size:new Jt(Ze,et)},v.set(D,G),D.addEventListener("dispose",function Ht(){Le.dispose(),v.delete(D),D.removeEventListener("dispose",Ht)})}let W=0;for(let $=0;$<j.length;$++)W+=j[$];const Q=D.morphTargetsRelative?1:1-W;B.getUniforms().setValue(b,"morphTargetBaseInfluence",Q),B.getUniforms().setValue(b,"morphTargetInfluences",j),B.getUniforms().setValue(b,"morphTargetsTexture",G.texture,c),B.getUniforms().setValue(b,"morphTargetsTextureSize",G.size)}else{const F=j===void 0?0:j.length;let z=d[D.id];if(z===void 0||z.length!==F){z=[];for(let Y=0;Y<F;Y++)z[Y]=[Y,0];d[D.id]=z}for(let Y=0;Y<F;Y++){const q=z[Y];q[0]=Y,q[1]=j[Y]}z.sort(Sf);for(let Y=0;Y<8;Y++)Y<F&&z[Y][1]?(C[Y][0]=z[Y][0],C[Y][1]=z[Y][1]):(C[Y][0]=Number.MAX_SAFE_INTEGER,C[Y][1]=0);C.sort(W1);const G=D.morphAttributes.position,W=D.morphAttributes.normal;let Q=0;for(let Y=0;Y<8;Y++){const q=C[Y],be=q[0],we=q[1];be!==Number.MAX_SAFE_INTEGER&&we?(G&&D.getAttribute("morphTarget"+Y)!==G[be]&&D.setAttribute("morphTarget"+Y,G[be]),W&&D.getAttribute("morphNormal"+Y)!==W[be]&&D.setAttribute("morphNormal"+Y,W[be]),m[Y]=we,Q+=we):(G&&D.hasAttribute("morphTarget"+Y)===!0&&D.deleteAttribute("morphTarget"+Y),W&&D.hasAttribute("morphNormal"+Y)===!0&&D.deleteAttribute("morphNormal"+Y),m[Y]=0)}const $=D.morphTargetsRelative?1:1-Q;B.getUniforms().setValue(b,"morphTargetBaseInfluence",$),B.getUniforms().setValue(b,"morphTargetInfluences",m)}}}}function bA(b,n,c,d){let m=new WeakMap;function v(w){const C=w.target;C.removeEventListener("dispose",v),c.remove(C.instanceMatrix),C.instanceColor!==null&&c.remove(C.instanceColor)}return{update:function(w){const C=d.render.frame,P=w.geometry,D=n.get(w,P);return m.get(D)!==C&&(n.update(D),m.set(D,C)),w.isInstancedMesh&&(w.hasEventListener("dispose",v)===!1&&w.addEventListener("dispose",v),c.update(w.instanceMatrix,b.ARRAY_BUFFER),w.instanceColor!==null&&c.update(w.instanceColor,b.ARRAY_BUFFER)),D},dispose:function(){m=new WeakMap}}}const Um=new xr,Cf=new Qo,W_=new gf,AA=new Pu,Du=[],Kd=[],Mf=new Float32Array(16),Nm=new Float32Array(9),Zd=new Float32Array(4);function $c(b,n,c){const d=b[0];if(d<=0||d>0)return b;const m=n*c;let v=Du[m];if(v===void 0&&(v=new Float32Array(m),Du[m]=v),n!==0){d.toArray(v,0);for(let w=1,C=0;w!==n;++w)C+=c,b[w].toArray(v,C)}return v}function Rn(b,n){if(b.length!==n.length)return!1;for(let c=0,d=b.length;c<d;c++)if(b[c]!==n[c])return!1;return!0}function Rs(b,n){for(let c=0,d=n.length;c<d;c++)b[c]=n[c]}function Jd(b,n){let c=Kd[n];c===void 0&&(c=new Int32Array(n),Kd[n]=c);for(let d=0;d!==n;++d)c[d]=b.allocateTextureUnit();return c}function $d(b,n){const c=this.cache;c[0]!==n&&(b.uniform1f(this.addr,n),c[0]=n)}function X_(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y||(b.uniform2f(this.addr,n.x,n.y),c[0]=n.x,c[1]=n.y);else{if(Rn(c,n))return;b.uniform2fv(this.addr,n),Rs(c,n)}}function Bu(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z||(b.uniform3f(this.addr,n.x,n.y,n.z),c[0]=n.x,c[1]=n.y,c[2]=n.z);else if(n.r!==void 0)c[0]===n.r&&c[1]===n.g&&c[2]===n.b||(b.uniform3f(this.addr,n.r,n.g,n.b),c[0]=n.r,c[1]=n.g,c[2]=n.b);else{if(Rn(c,n))return;b.uniform3fv(this.addr,n),Rs(c,n)}}function wA(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z&&c[3]===n.w||(b.uniform4f(this.addr,n.x,n.y,n.z,n.w),c[0]=n.x,c[1]=n.y,c[2]=n.z,c[3]=n.w);else{if(Rn(c,n))return;b.uniform4fv(this.addr,n),Rs(c,n)}}function xA(b,n){const c=this.cache,d=n.elements;if(d===void 0){if(Rn(c,n))return;b.uniformMatrix2fv(this.addr,!1,n),Rs(c,n)}else{if(Rn(c,d))return;Zd.set(d),b.uniformMatrix2fv(this.addr,!1,Zd),Rs(c,d)}}function q_(b,n){const c=this.cache,d=n.elements;if(d===void 0){if(Rn(c,n))return;b.uniformMatrix3fv(this.addr,!1,n),Rs(c,n)}else{if(Rn(c,d))return;Nm.set(d),b.uniformMatrix3fv(this.addr,!1,Nm),Rs(c,d)}}function Y_(b,n){const c=this.cache,d=n.elements;if(d===void 0){if(Rn(c,n))return;b.uniformMatrix4fv(this.addr,!1,n),Rs(c,n)}else{if(Rn(c,d))return;Mf.set(d),b.uniformMatrix4fv(this.addr,!1,Mf),Rs(c,d)}}function K_(b,n){const c=this.cache;c[0]!==n&&(b.uniform1i(this.addr,n),c[0]=n)}function ep(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y||(b.uniform2i(this.addr,n.x,n.y),c[0]=n.x,c[1]=n.y);else{if(Rn(c,n))return;b.uniform2iv(this.addr,n),Rs(c,n)}}function wo(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z||(b.uniform3i(this.addr,n.x,n.y,n.z),c[0]=n.x,c[1]=n.y,c[2]=n.z);else{if(Rn(c,n))return;b.uniform3iv(this.addr,n),Rs(c,n)}}function Ph(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z&&c[3]===n.w||(b.uniform4i(this.addr,n.x,n.y,n.z,n.w),c[0]=n.x,c[1]=n.y,c[2]=n.z,c[3]=n.w);else{if(Rn(c,n))return;b.uniform4iv(this.addr,n),Rs(c,n)}}function Un(b,n){const c=this.cache;c[0]!==n&&(b.uniform1ui(this.addr,n),c[0]=n)}function EA(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y||(b.uniform2ui(this.addr,n.x,n.y),c[0]=n.x,c[1]=n.y);else{if(Rn(c,n))return;b.uniform2uiv(this.addr,n),Rs(c,n)}}function Z_(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z||(b.uniform3ui(this.addr,n.x,n.y,n.z),c[0]=n.x,c[1]=n.y,c[2]=n.z);else{if(Rn(c,n))return;b.uniform3uiv(this.addr,n),Rs(c,n)}}function SA(b,n){const c=this.cache;if(n.x!==void 0)c[0]===n.x&&c[1]===n.y&&c[2]===n.z&&c[3]===n.w||(b.uniform4ui(this.addr,n.x,n.y,n.z,n.w),c[0]=n.x,c[1]=n.y,c[2]=n.z,c[3]=n.w);else{if(Rn(c,n))return;b.uniform4uiv(this.addr,n),Rs(c,n)}}function CA(b,n,c){const d=this.cache,m=c.allocateTextureUnit();d[0]!==m&&(b.uniform1i(this.addr,m),d[0]=m),c.setTexture2D(n||Um,m)}function MA(b,n,c){const d=this.cache,m=c.allocateTextureUnit();d[0]!==m&&(b.uniform1i(this.addr,m),d[0]=m),c.setTexture3D(n||W_,m)}function X1(b,n,c){const d=this.cache,m=c.allocateTextureUnit();d[0]!==m&&(b.uniform1i(this.addr,m),d[0]=m),c.setTextureCube(n||AA,m)}function q1(b,n,c){const d=this.cache,m=c.allocateTextureUnit();d[0]!==m&&(b.uniform1i(this.addr,m),d[0]=m),c.setTexture2DArray(n||Cf,m)}function Y1(b,n){b.uniform1fv(this.addr,n)}function K1(b,n){const c=$c(n,this.size,2);b.uniform2fv(this.addr,c)}function Z1(b,n){const c=$c(n,this.size,3);b.uniform3fv(this.addr,c)}function J1(b,n){const c=$c(n,this.size,4);b.uniform4fv(this.addr,c)}function J_(b,n){const c=$c(n,this.size,4);b.uniformMatrix2fv(this.addr,!1,c)}function Fv(b,n){const c=$c(n,this.size,9);b.uniformMatrix3fv(this.addr,!1,c)}function _n(b,n){const c=$c(n,this.size,16);b.uniformMatrix4fv(this.addr,!1,c)}function TA(b,n){b.uniform1iv(this.addr,n)}function IA(b,n){b.uniform2iv(this.addr,n)}function jv(b,n){b.uniform3iv(this.addr,n)}function zv(b,n){b.uniform4iv(this.addr,n)}function eu(b,n){b.uniform1uiv(this.addr,n)}function PA(b,n){b.uniform2uiv(this.addr,n)}function Fm(b,n){b.uniform3uiv(this.addr,n)}function tp(b,n){b.uniform4uiv(this.addr,n)}function jm(b,n,c){const d=this.cache,m=n.length,v=Jd(c,m);Rn(d,v)||(b.uniform1iv(this.addr,v),Rs(d,v));for(let w=0;w!==m;++w)c.setTexture2D(n[w]||Um,v[w])}function Vv(b,n,c){const d=this.cache,m=n.length,v=Jd(c,m);Rn(d,v)||(b.uniform1iv(this.addr,v),Rs(d,v));for(let w=0;w!==m;++w)c.setTexture3D(n[w]||W_,v[w])}function zm(b,n,c){const d=this.cache,m=n.length,v=Jd(c,m);Rn(d,v)||(b.uniform1iv(this.addr,v),Rs(d,v));for(let w=0;w!==m;++w)c.setTextureCube(n[w]||AA,v[w])}function Vm(b,n,c){const d=this.cache,m=n.length,v=Jd(c,m);Rn(d,v)||(b.uniform1iv(this.addr,v),Rs(d,v));for(let w=0;w!==m;++w)c.setTexture2DArray(n[w]||Cf,v[w])}class $1{constructor(n,c,d){this.id=n,this.addr=d,this.cache=[],this.setValue=function(m){switch(m){case 5126:return $d;case 35664:return X_;case 35665:return Bu;case 35666:return wA;case 35674:return xA;case 35675:return q_;case 35676:return Y_;case 5124:case 35670:return K_;case 35667:case 35671:return ep;case 35668:case 35672:return wo;case 35669:case 35673:return Ph;case 5125:return Un;case 36294:return EA;case 36295:return Z_;case 36296:return SA;case 35678:case 36198:case 36298:case 36306:case 35682:return CA;case 35679:case 36299:case 36307:return MA;case 35680:case 36300:case 36308:case 36293:return X1;case 36289:case 36303:case 36311:case 36292:return q1}}(c.type)}}class eE{constructor(n,c,d){this.id=n,this.addr=d,this.cache=[],this.size=c.size,this.setValue=function(m){switch(m){case 5126:return Y1;case 35664:return K1;case 35665:return Z1;case 35666:return J1;case 35674:return J_;case 35675:return Fv;case 35676:return _n;case 5124:case 35670:return TA;case 35667:case 35671:return IA;case 35668:case 35672:return jv;case 35669:case 35673:return zv;case 5125:return eu;case 36294:return PA;case 36295:return Fm;case 36296:return tp;case 35678:case 36198:case 36298:case 36306:case 35682:return jm;case 35679:case 36299:case 36307:return Vv;case 35680:case 36300:case 36308:case 36293:return zm;case 36289:case 36303:case 36311:case 36292:return Vm}}(c.type)}}class RA{constructor(n){this.id=n,this.seq=[],this.map={}}setValue(n,c,d){const m=this.seq;for(let v=0,w=m.length;v!==w;++v){const C=m[v];C.setValue(n,c[C.id],d)}}}const Gv=/(\w+)(\])?(\[|\.)?/g;function fr(b,n){b.seq.push(n),b.map[n.id]=n}function $_(b,n,c){const d=b.name,m=d.length;for(Gv.lastIndex=0;;){const v=Gv.exec(d),w=Gv.lastIndex;let C=v[1];const P=v[2]==="]",D=v[3];if(P&&(C|=0),D===void 0||D==="["&&w+2===m){fr(c,D===void 0?new $1(C,b,n):new eE(C,b,n));break}{let B=c.map[C];B===void 0&&(B=new RA(C),fr(c,B)),c=B}}}class ip{constructor(n,c){this.seq=[],this.map={};const d=n.getProgramParameter(c,n.ACTIVE_UNIFORMS);for(let m=0;m<d;++m){const v=n.getActiveUniform(c,m);$_(v,n.getUniformLocation(c,v.name),this)}}setValue(n,c,d,m){const v=this.map[c];v!==void 0&&v.setValue(n,d,m)}setOptional(n,c,d){const m=c[d];m!==void 0&&this.setValue(n,d,m)}static upload(n,c,d,m){for(let v=0,w=c.length;v!==w;++v){const C=c[v],P=d[C.id];P.needsUpdate!==!1&&C.setValue(n,P.value,m)}}static seqWithValue(n,c){const d=[];for(let m=0,v=n.length;m!==v;++m){const w=n[m];w.id in c&&d.push(w)}return d}}function Oa(b,n,c){const d=b.createShader(n);return b.shaderSource(d,c),b.compileShader(d),d}let tE=0;function ey(b){switch(b){case Ya:case an:return["Linear","( value )"];case Yi:return["sRGB","( value )"];case kr:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",b),["Linear","( value )"]}}function Ou(b,n,c){const d=b.getShaderParameter(n,b.COMPILE_STATUS),m=b.getShaderInfoLog(n).trim();if(d&&m==="")return"";const v=/ERROR: 0:(\d+)/.exec(m);if(v){const w=parseInt(v[1]);return c.toUpperCase()+`

`+m+`

`+function(C,P){const D=C.split(`
`),B=[],j=Math.max(P-6,0),F=Math.min(P+6,D.length);for(let z=j;z<F;z++){const G=z+1;B.push(`${G===P?">":" "} ${G}: ${D[z]}`)}return B.join(`
`)}(b.getShaderSource(n),w)}return m}function na(b,n){const c=ey(n);return"vec4 "+b+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function tn(b,n){const c=ey(n);return"vec4 "+b+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function iE(b,n){let c;switch(n){case Qn:c="Linear";break;case nn:c="Reinhard";break;case $r:c="OptimizedCineon";break;case Ga:c="ACESFilmic";break;case No:c="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),c="Linear"}return"vec3 "+b+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function Gm(b){return b!==""}function Tf(b,n){const c=n.numSpotLightShadows+n.numSpotLightMaps-n.numSpotLightShadowsWithMaps;return b.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,n.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,n.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function Hv(b,n){return b.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const Qv=/^[ \t]*#include +<([\w\d./]+)>/gm;function If(b){return b.replace(Qv,Bl)}function Bl(b,n){const c=Er[n];if(c===void 0)throw new Error("Can not resolve #include <"+n+">");return If(c)}const Jo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Pf(b){return b.replace(Jo,ty)}function ty(b,n,c,d){let m="";for(let v=parseInt(n);v<parseInt(c);v++)m+=d.replace(/\[\s*i\s*\]/g,"[ "+v+" ]").replace(/UNROLLED_LOOP_INDEX/g,v);return m}function DA(b){let n="precision "+b.precision+` float;
precision `+b.precision+" int;";return b.precision==="highp"?n+=`
#define HIGH_PRECISION`:b.precision==="mediump"?n+=`
#define MEDIUM_PRECISION`:b.precision==="lowp"&&(n+=`
#define LOW_PRECISION`),n}function Rh(b,n,c,d){const m=b.getContext(),v=c.defines;let w=c.vertexShader,C=c.fragmentShader;const P=function(et){let ft="SHADOWMAP_TYPE_BASIC";return et.shadowMapType===Mt?ft="SHADOWMAP_TYPE_PCF":et.shadowMapType===pt?ft="SHADOWMAP_TYPE_PCF_SOFT":et.shadowMapType===Re&&(ft="SHADOWMAP_TYPE_VSM"),ft}(c),D=function(et){let ft="ENVMAP_TYPE_CUBE";if(et.envMap)switch(et.envMapMode){case ae:case Gr:ft="ENVMAP_TYPE_CUBE";break;case cr:ft="ENVMAP_TYPE_CUBE_UV"}return ft}(c),B=function(et){let ft="ENVMAP_MODE_REFLECTION";return et.envMap&&et.envMapMode===Gr&&(ft="ENVMAP_MODE_REFRACTION"),ft}(c),j=function(et){let ft="ENVMAP_BLENDING_NONE";if(et.envMap)switch(et.combine){case Oi:ft="ENVMAP_BLENDING_MULTIPLY";break;case Lr:ft="ENVMAP_BLENDING_MIX";break;case zr:ft="ENVMAP_BLENDING_ADD"}return ft}(c),F=function(et){const ft=et.envMapCubeUVHeight;if(ft===null)return null;const Le=Math.log2(ft)-2,Gt=1/ft;return{texelWidth:1/(3*Math.max(Math.pow(2,Le),112)),texelHeight:Gt,maxMip:Le}}(c),z=c.isWebGL2?"":function(et){return[et.extensionDerivatives||et.envMapCubeUVHeight||et.bumpMap||et.normalMapTangentSpace||et.clearcoatNormalMap||et.flatShading||et.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(et.extensionFragDepth||et.logarithmicDepthBuffer)&&et.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",et.extensionDrawBuffers&&et.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(et.extensionShaderTextureLOD||et.envMap||et.transmission)&&et.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Gm).join(`
`)}(c),G=function(et){const ft=[];for(const Le in et){const Gt=et[Le];Gt!==!1&&ft.push("#define "+Le+" "+Gt)}return ft.join(`
`)}(v),W=m.createProgram();let Q,$,Y=c.glslVersion?"#version "+c.glslVersion+`
`:"";c.isRawShaderMaterial?(Q=["#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,G].filter(Gm).join(`
`),Q.length>0&&(Q+=`
`),$=[z,"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,G].filter(Gm).join(`
`),$.length>0&&($+=`
`)):(Q=[DA(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,G,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+B:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.displacementMap?"#define USE_DISPLACEMENTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.mapUv?"#define MAP_UV "+c.mapUv:"",c.alphaMapUv?"#define ALPHAMAP_UV "+c.alphaMapUv:"",c.lightMapUv?"#define LIGHTMAP_UV "+c.lightMapUv:"",c.aoMapUv?"#define AOMAP_UV "+c.aoMapUv:"",c.emissiveMapUv?"#define EMISSIVEMAP_UV "+c.emissiveMapUv:"",c.bumpMapUv?"#define BUMPMAP_UV "+c.bumpMapUv:"",c.normalMapUv?"#define NORMALMAP_UV "+c.normalMapUv:"",c.displacementMapUv?"#define DISPLACEMENTMAP_UV "+c.displacementMapUv:"",c.metalnessMapUv?"#define METALNESSMAP_UV "+c.metalnessMapUv:"",c.roughnessMapUv?"#define ROUGHNESSMAP_UV "+c.roughnessMapUv:"",c.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+c.anisotropyMapUv:"",c.clearcoatMapUv?"#define CLEARCOATMAP_UV "+c.clearcoatMapUv:"",c.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+c.clearcoatNormalMapUv:"",c.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+c.clearcoatRoughnessMapUv:"",c.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+c.iridescenceMapUv:"",c.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+c.iridescenceThicknessMapUv:"",c.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+c.sheenColorMapUv:"",c.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+c.sheenRoughnessMapUv:"",c.specularMapUv?"#define SPECULARMAP_UV "+c.specularMapUv:"",c.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+c.specularColorMapUv:"",c.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+c.specularIntensityMapUv:"",c.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+c.transmissionMapUv:"",c.thicknessMapUv?"#define THICKNESSMAP_UV "+c.thicknessMapUv:"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&c.flatShading===!1?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.useLegacyLights?"#define LEGACY_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Gm).join(`
`),$=[z,DA(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,G,c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+D:"",c.envMap?"#define "+B:"",c.envMap?"#define "+j:"",F?"#define CUBEUV_TEXEL_WIDTH "+F.texelWidth:"",F?"#define CUBEUV_TEXEL_HEIGHT "+F.texelHeight:"",F?"#define CUBEUV_MAX_MIP "+F.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropy?"#define USE_ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+P:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.useLegacyLights?"#define LEGACY_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",c.toneMapping!==Vr?"#define TONE_MAPPING":"",c.toneMapping!==Vr?Er.tonemapping_pars_fragment:"",c.toneMapping!==Vr?iE("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",Er.encodings_pars_fragment,tn("linearToOutputTexel",c.outputColorSpace),c.transmissionSamplerMapEncoding?na("transmissionSamplerMapTexelToLinear",c.transmissionSamplerMapEncoding):"",c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(Gm).join(`
`)),w=If(w),w=Tf(w,c),w=Hv(w,c),C=If(C),C=Tf(C,c),C=Hv(C,c),w=Pf(w),C=Pf(C),c.isWebGL2&&c.isRawShaderMaterial!==!0&&(Y=`#version 300 es
`,Q=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Q,$=["#define varying in",c.glslVersion===Vo?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===Vo?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+$);const q=Y+Q+w,be=Y+$+C,we=Oa(m,m.VERTEX_SHADER,q),me=Oa(m,m.FRAGMENT_SHADER,be);if(m.attachShader(W,we),m.attachShader(W,me),c.index0AttributeName!==void 0?m.bindAttribLocation(W,0,c.index0AttributeName):c.morphTargets===!0&&m.bindAttribLocation(W,0,"position"),m.linkProgram(W),b.debug.checkShaderErrors){const et=m.getProgramInfoLog(W).trim(),ft=m.getShaderInfoLog(we).trim(),Le=m.getShaderInfoLog(me).trim();let Gt=!0,Ht=!0;if(m.getProgramParameter(W,m.LINK_STATUS)===!1)if(Gt=!1,typeof b.debug.onShaderError=="function")b.debug.onShaderError(m,W,we,me);else{const ri=Ou(m,we,"vertex"),hi=Ou(m,me,"fragment");console.error("THREE.WebGLProgram: Shader Error "+m.getError()+" - VALIDATE_STATUS "+m.getProgramParameter(W,m.VALIDATE_STATUS)+`

Program Info Log: `+et+`
`+ri+`
`+hi)}else et!==""?console.warn("THREE.WebGLProgram: Program Info Log:",et):ft!==""&&Le!==""||(Ht=!1);Ht&&(this.diagnostics={runnable:Gt,programLog:et,vertexShader:{log:ft,prefix:Q},fragmentShader:{log:Le,prefix:$}})}let Be,Ze;return m.deleteShader(we),m.deleteShader(me),this.getUniforms=function(){return Be===void 0&&(Be=new ip(m,W)),Be},this.getAttributes=function(){return Ze===void 0&&(Ze=function(et,ft){const Le={},Gt=et.getProgramParameter(ft,et.ACTIVE_ATTRIBUTES);for(let Ht=0;Ht<Gt;Ht++){const ri=et.getActiveAttrib(ft,Ht),hi=ri.name;let ei=1;ri.type===et.FLOAT_MAT2&&(ei=2),ri.type===et.FLOAT_MAT3&&(ei=3),ri.type===et.FLOAT_MAT4&&(ei=4),Le[hi]={type:ri.type,location:et.getAttribLocation(ft,hi),locationSize:ei}}return Le}(m,W)),Ze},this.destroy=function(){d.releaseStatesOfProgram(this),m.deleteProgram(W),this.program=void 0},this.type=c.shaderType,this.name=c.shaderName,this.id=tE++,this.cacheKey=n,this.usedTimes=1,this.program=W,this.vertexShader=we,this.fragmentShader=me,this}let iy=0;class ry{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(n){const c=n.vertexShader,d=n.fragmentShader,m=this._getShaderStage(c),v=this._getShaderStage(d),w=this._getShaderCacheForMaterial(n);return w.has(m)===!1&&(w.add(m),m.usedTimes++),w.has(v)===!1&&(w.add(v),v.usedTimes++),this}remove(n){const c=this.materialCache.get(n);for(const d of c)d.usedTimes--,d.usedTimes===0&&this.shaderCache.delete(d.code);return this.materialCache.delete(n),this}getVertexShaderID(n){return this._getShaderStage(n.vertexShader).id}getFragmentShaderID(n){return this._getShaderStage(n.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(n){const c=this.materialCache;let d=c.get(n);return d===void 0&&(d=new Set,c.set(n,d)),d}_getShaderStage(n){const c=this.shaderCache;let d=c.get(n);return d===void 0&&(d=new ny(n),c.set(n,d)),d}}class ny{constructor(n){this.id=iy++,this.code=n,this.usedTimes=0}}function sy(b,n,c,d,m,v,w){const C=new Pl,P=new ry,D=[],B=m.isWebGL2,j=m.logarithmicDepthBuffer,F=m.vertexTextures;let z=m.precision;const G={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function W(Q){return Q===0?"uv":`uv${Q}`}return{getParameters:function(Q,$,Y,q,be){const we=q.fog,me=be.geometry,Be=Q.isMeshStandardMaterial?q.environment:null,Ze=(Q.isMeshStandardMaterial?c:n).get(Q.envMap||Be),et=Ze&&Ze.mapping===cr?Ze.image.height:null,ft=G[Q.type];Q.precision!==null&&(z=m.getMaxPrecision(Q.precision),z!==Q.precision&&console.warn("THREE.WebGLProgram.getParameters:",Q.precision,"not supported, using",z,"instead."));const Le=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,Gt=Le!==void 0?Le.length:0;let Ht,ri,hi,ei,Xt=0;if(me.morphAttributes.position!==void 0&&(Xt=1),me.morphAttributes.normal!==void 0&&(Xt=2),me.morphAttributes.color!==void 0&&(Xt=3),ft){const Ap=Pn[ft];Ht=Ap.vertexShader,ri=Ap.fragmentShader}else Ht=Q.vertexShader,ri=Q.fragmentShader,P.update(Q),hi=P.getVertexShaderID(Q),ei=P.getFragmentShaderID(Q);const oi=b.getRenderTarget(),Pt=b.userData&&b.userData.transmissionRenderTarget,Nt=oi?Array.isArray(oi.texture)?oi.texture[0]:oi.texture:null,ci=be.isInstancedMesh===!0,pi=!!Q.map,$i=!!Q.matcap,yi=!!Ze,qi=!!Q.aoMap,Ri=!!Q.lightMap,De=!!Q.bumpMap,Me=!!Q.normalMap,Ge=!!Q.displacementMap,ht=!!Q.emissiveMap,Oe=!!Q.metalnessMap,ye=!!Q.roughnessMap,ke=Q.anisotropy>0,ze=Q.clearcoat>0,rt=Q.iridescence>0,Et=Q.sheen>0,Vt=Q.transmission>0,Yt=ke&&!!Q.anisotropyMap,Fi=ze&&!!Q.clearcoatMap,Ki=ze&&!!Q.clearcoatNormalMap,Ti=ze&&!!Q.clearcoatRoughnessMap,tr=rt&&!!Q.iridescenceMap,dr=rt&&!!Q.iridescenceThicknessMap,Jr=Et&&!!Q.sheenColorMap,nr=Et&&!!Q.sheenRoughnessMap,qr=!!Q.specularMap,os=!!Q.specularColorMap,Zi=!!Q.specularIntensityMap,Fr=Vt&&!!Q.transmissionMap,ln=Vt&&!!Q.thicknessMap,Cg=!!Q.gradientMap,em=!!Q.alphaMap,sl=Q.alphaTest>0,al=!!Q.extensions,Ju=!!me.attributes.uv1,Dt=!!me.attributes.uv2,bp=!!me.attributes.uv3;return{isWebGL2:B,shaderID:ft,shaderType:Q.type,shaderName:Q.name,vertexShader:Ht,fragmentShader:ri,defines:Q.defines,customVertexShaderID:hi,customFragmentShaderID:ei,isRawShaderMaterial:Q.isRawShaderMaterial===!0,glslVersion:Q.glslVersion,precision:z,instancing:ci,instancingColor:ci&&be.instanceColor!==null,supportsVertexTextures:F,outputColorSpace:oi===null?b.outputColorSpace:oi.isXRRenderTarget===!0||Nt.colorSpace&&Nt.colorSpace!==Yi?Nt.colorSpace:an,map:pi,matcap:$i,envMap:yi,envMapMode:yi&&Ze.mapping,envMapCubeUVHeight:et,aoMap:qi,lightMap:Ri,bumpMap:De,normalMap:Me,displacementMap:F&&Ge,emissiveMap:ht,normalMapObjectSpace:Me&&Q.normalMapType===of,normalMapTangentSpace:Me&&Q.normalMapType===Ca,metalnessMap:Oe,roughnessMap:ye,anisotropy:ke,anisotropyMap:Yt,clearcoat:ze,clearcoatMap:Fi,clearcoatNormalMap:Ki,clearcoatRoughnessMap:Ti,iridescence:rt,iridescenceMap:tr,iridescenceThicknessMap:dr,sheen:Et,sheenColorMap:Jr,sheenRoughnessMap:nr,specularMap:qr,specularColorMap:os,specularIntensityMap:Zi,transmission:Vt,transmissionMap:Fr,thicknessMap:ln,transmissionSamplerMapEncoding:Pt&&Pt.texture.colorSpace||an,gradientMap:Cg,opaque:Q.transparent===!1&&Q.blending===Ct&&!(Q.transmission>0),alphaMap:em,alphaTest:sl,combine:Q.combine,mapUv:pi&&W(Q.map.channel),aoMapUv:qi&&W(Q.aoMap.channel),lightMapUv:Ri&&W(Q.lightMap.channel),bumpMapUv:De&&W(Q.bumpMap.channel),normalMapUv:Me&&W(Q.normalMap.channel),displacementMapUv:Ge&&W(Q.displacementMap.channel),emissiveMapUv:ht&&W(Q.emissiveMap.channel),metalnessMapUv:Oe&&W(Q.metalnessMap.channel),roughnessMapUv:ye&&W(Q.roughnessMap.channel),anisotropyMapUv:Yt&&W(Q.anisotropyMap.channel),clearcoatMapUv:Fi&&W(Q.clearcoatMap.channel),clearcoatNormalMapUv:Ki&&W(Q.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ti&&W(Q.clearcoatRoughnessMap.channel),iridescenceMapUv:tr&&W(Q.iridescenceMap.channel),iridescenceThicknessMapUv:dr&&W(Q.iridescenceThicknessMap.channel),sheenColorMapUv:Jr&&W(Q.sheenColorMap.channel),sheenRoughnessMapUv:nr&&W(Q.sheenRoughnessMap.channel),specularMapUv:qr&&W(Q.specularMap.channel),specularColorMapUv:os&&W(Q.specularColorMap.channel),specularIntensityMapUv:Zi&&W(Q.specularIntensityMap.channel),transmissionMapUv:Fr&&W(Q.transmissionMap.channel),thicknessMapUv:ln&&W(Q.thicknessMap.channel),alphaMapUv:em&&W(Q.alphaMap.channel),vertexTangents:!!me.attributes.tangent&&(Me||ke),vertexColors:Q.vertexColors,vertexAlphas:Q.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,vertexUv1s:Ju,vertexUv2s:Dt,vertexUv3s:bp,pointsUvs:be.isPoints===!0&&!!me.attributes.uv&&(pi||em),fog:!!we,useFog:Q.fog===!0,fogExp2:we&&we.isFogExp2,flatShading:Q.flatShading===!0,sizeAttenuation:Q.sizeAttenuation===!0,logarithmicDepthBuffer:j,skinning:be.isSkinnedMesh===!0,morphTargets:me.morphAttributes.position!==void 0,morphNormals:me.morphAttributes.normal!==void 0,morphColors:me.morphAttributes.color!==void 0,morphTargetsCount:Gt,morphTextureStride:Xt,numDirLights:$.directional.length,numPointLights:$.point.length,numSpotLights:$.spot.length,numSpotLightMaps:$.spotLightMap.length,numRectAreaLights:$.rectArea.length,numHemiLights:$.hemi.length,numDirLightShadows:$.directionalShadowMap.length,numPointLightShadows:$.pointShadowMap.length,numSpotLightShadows:$.spotShadowMap.length,numSpotLightShadowsWithMaps:$.numSpotLightShadowsWithMaps,numClippingPlanes:w.numPlanes,numClipIntersection:w.numIntersection,dithering:Q.dithering,shadowMapEnabled:b.shadowMap.enabled&&Y.length>0,shadowMapType:b.shadowMap.type,toneMapping:Q.toneMapped?b.toneMapping:Vr,useLegacyLights:b.useLegacyLights,premultipliedAlpha:Q.premultipliedAlpha,doubleSided:Q.side===vt,flipSided:Q.side===Ce,useDepthPacking:Q.depthPacking>=0,depthPacking:Q.depthPacking||0,index0AttributeName:Q.index0AttributeName,extensionDerivatives:al&&Q.extensions.derivatives===!0,extensionFragDepth:al&&Q.extensions.fragDepth===!0,extensionDrawBuffers:al&&Q.extensions.drawBuffers===!0,extensionShaderTextureLOD:al&&Q.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:B||d.has("EXT_frag_depth"),rendererExtensionDrawBuffers:B||d.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:B||d.has("EXT_shader_texture_lod"),customProgramCacheKey:Q.customProgramCacheKey()}},getProgramCacheKey:function(Q){const $=[];if(Q.shaderID?$.push(Q.shaderID):($.push(Q.customVertexShaderID),$.push(Q.customFragmentShaderID)),Q.defines!==void 0)for(const Y in Q.defines)$.push(Y),$.push(Q.defines[Y]);return Q.isRawShaderMaterial===!1&&(function(Y,q){Y.push(q.precision),Y.push(q.outputColorSpace),Y.push(q.envMapMode),Y.push(q.envMapCubeUVHeight),Y.push(q.mapUv),Y.push(q.alphaMapUv),Y.push(q.lightMapUv),Y.push(q.aoMapUv),Y.push(q.bumpMapUv),Y.push(q.normalMapUv),Y.push(q.displacementMapUv),Y.push(q.emissiveMapUv),Y.push(q.metalnessMapUv),Y.push(q.roughnessMapUv),Y.push(q.anisotropyMapUv),Y.push(q.clearcoatMapUv),Y.push(q.clearcoatNormalMapUv),Y.push(q.clearcoatRoughnessMapUv),Y.push(q.iridescenceMapUv),Y.push(q.iridescenceThicknessMapUv),Y.push(q.sheenColorMapUv),Y.push(q.sheenRoughnessMapUv),Y.push(q.specularMapUv),Y.push(q.specularColorMapUv),Y.push(q.specularIntensityMapUv),Y.push(q.transmissionMapUv),Y.push(q.thicknessMapUv),Y.push(q.combine),Y.push(q.fogExp2),Y.push(q.sizeAttenuation),Y.push(q.morphTargetsCount),Y.push(q.morphAttributeCount),Y.push(q.numDirLights),Y.push(q.numPointLights),Y.push(q.numSpotLights),Y.push(q.numSpotLightMaps),Y.push(q.numHemiLights),Y.push(q.numRectAreaLights),Y.push(q.numDirLightShadows),Y.push(q.numPointLightShadows),Y.push(q.numSpotLightShadows),Y.push(q.numSpotLightShadowsWithMaps),Y.push(q.shadowMapType),Y.push(q.toneMapping),Y.push(q.numClippingPlanes),Y.push(q.numClipIntersection),Y.push(q.depthPacking)}($,Q),function(Y,q){C.disableAll(),q.isWebGL2&&C.enable(0),q.supportsVertexTextures&&C.enable(1),q.instancing&&C.enable(2),q.instancingColor&&C.enable(3),q.matcap&&C.enable(4),q.envMap&&C.enable(5),q.normalMapObjectSpace&&C.enable(6),q.normalMapTangentSpace&&C.enable(7),q.clearcoat&&C.enable(8),q.iridescence&&C.enable(9),q.alphaTest&&C.enable(10),q.vertexColors&&C.enable(11),q.vertexAlphas&&C.enable(12),q.vertexUv1s&&C.enable(13),q.vertexUv2s&&C.enable(14),q.vertexUv3s&&C.enable(15),q.vertexTangents&&C.enable(16),q.anisotropy&&C.enable(17),Y.push(C.mask),C.disableAll(),q.fog&&C.enable(0),q.useFog&&C.enable(1),q.flatShading&&C.enable(2),q.logarithmicDepthBuffer&&C.enable(3),q.skinning&&C.enable(4),q.morphTargets&&C.enable(5),q.morphNormals&&C.enable(6),q.morphColors&&C.enable(7),q.premultipliedAlpha&&C.enable(8),q.shadowMapEnabled&&C.enable(9),q.useLegacyLights&&C.enable(10),q.doubleSided&&C.enable(11),q.flipSided&&C.enable(12),q.useDepthPacking&&C.enable(13),q.dithering&&C.enable(14),q.transmission&&C.enable(15),q.sheen&&C.enable(16),q.opaque&&C.enable(17),q.pointsUvs&&C.enable(18),Y.push(C.mask)}($,Q),$.push(b.outputColorSpace)),$.push(Q.customProgramCacheKey),$.join()},getUniforms:function(Q){const $=G[Q.type];let Y;if($){const q=Pn[$];Y=Bm.clone(q.uniforms)}else Y=Q.uniforms;return Y},acquireProgram:function(Q,$){let Y;for(let q=0,be=D.length;q<be;q++){const we=D[q];if(we.cacheKey===$){Y=we,++Y.usedTimes;break}}return Y===void 0&&(Y=new Rh(b,$,Q,v),D.push(Y)),Y},releaseProgram:function(Q){if(--Q.usedTimes==0){const $=D.indexOf(Q);D[$]=D[D.length-1],D.pop(),Q.destroy()}},releaseShaderCache:function(Q){P.remove(Q)},programs:D,dispose:function(){P.dispose()}}}function rE(){let b=new WeakMap;return{get:function(n){let c=b.get(n);return c===void 0&&(c={},b.set(n,c)),c},remove:function(n){b.delete(n)},update:function(n,c,d){b.get(n)[c]=d},dispose:function(){b=new WeakMap}}}function nE(b,n){return b.groupOrder!==n.groupOrder?b.groupOrder-n.groupOrder:b.renderOrder!==n.renderOrder?b.renderOrder-n.renderOrder:b.material.id!==n.material.id?b.material.id-n.material.id:b.z!==n.z?b.z-n.z:b.id-n.id}function BA(b,n){return b.groupOrder!==n.groupOrder?b.groupOrder-n.groupOrder:b.renderOrder!==n.renderOrder?b.renderOrder-n.renderOrder:b.z!==n.z?n.z-b.z:b.id-n.id}function OA(){const b=[];let n=0;const c=[],d=[],m=[];function v(w,C,P,D,B,j){let F=b[n];return F===void 0?(F={id:w.id,object:w,geometry:C,material:P,groupOrder:D,renderOrder:w.renderOrder,z:B,group:j},b[n]=F):(F.id=w.id,F.object=w,F.geometry=C,F.material=P,F.groupOrder=D,F.renderOrder=w.renderOrder,F.z=B,F.group=j),n++,F}return{opaque:c,transmissive:d,transparent:m,init:function(){n=0,c.length=0,d.length=0,m.length=0},push:function(w,C,P,D,B,j){const F=v(w,C,P,D,B,j);P.transmission>0?d.push(F):P.transparent===!0?m.push(F):c.push(F)},unshift:function(w,C,P,D,B,j){const F=v(w,C,P,D,B,j);P.transmission>0?d.unshift(F):P.transparent===!0?m.unshift(F):c.unshift(F)},finish:function(){for(let w=n,C=b.length;w<C;w++){const P=b[w];if(P.id===null)break;P.id=null,P.object=null,P.geometry=null,P.material=null,P.group=null}},sort:function(w,C){c.length>1&&c.sort(w||nE),d.length>1&&d.sort(C||BA),m.length>1&&m.sort(C||BA)}}}function LA(){let b=new WeakMap;return{get:function(n,c){const d=b.get(n);let m;return d===void 0?(m=new OA,b.set(n,[m])):c>=d.length?(m=new OA,d.push(m)):m=d[c],m},dispose:function(){b=new WeakMap}}}function Hm(){const b={};return{get:function(n){if(b[n.id]!==void 0)return b[n.id];let c;switch(n.type){case"DirectionalLight":c={direction:new Se,color:new xi};break;case"SpotLight":c={position:new Se,direction:new Se,color:new xi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new Se,color:new xi,distance:0,decay:0};break;case"HemisphereLight":c={direction:new Se,skyColor:new xi,groundColor:new xi};break;case"RectAreaLight":c={color:new xi,position:new Se,halfWidth:new Se,halfHeight:new Se}}return b[n.id]=c,c}}}let kA=0;function ay(b,n){return(n.castShadow?2:0)-(b.castShadow?2:0)+(n.map?1:0)-(b.map?1:0)}function Dh(b,n){const c=new Hm,d=function(){const P={};return{get:function(D){if(P[D.id]!==void 0)return P[D.id];let B;switch(D.type){case"DirectionalLight":case"SpotLight":B={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jt};break;case"PointLight":B={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jt,shadowCameraNear:1,shadowCameraFar:1e3}}return P[D.id]=B,B}}}(),m={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let P=0;P<9;P++)m.probe.push(new Se);const v=new Se,w=new or,C=new or;return{setup:function(P,D){let B=0,j=0,F=0;for(let et=0;et<9;et++)m.probe[et].set(0,0,0);let z=0,G=0,W=0,Q=0,$=0,Y=0,q=0,be=0,we=0,me=0;P.sort(ay);const Be=D===!0?Math.PI:1;for(let et=0,ft=P.length;et<ft;et++){const Le=P[et],Gt=Le.color,Ht=Le.intensity,ri=Le.distance,hi=Le.shadow&&Le.shadow.map?Le.shadow.map.texture:null;if(Le.isAmbientLight)B+=Gt.r*Ht*Be,j+=Gt.g*Ht*Be,F+=Gt.b*Ht*Be;else if(Le.isLightProbe)for(let ei=0;ei<9;ei++)m.probe[ei].addScaledVector(Le.sh.coefficients[ei],Ht);else if(Le.isDirectionalLight){const ei=c.get(Le);if(ei.color.copy(Le.color).multiplyScalar(Le.intensity*Be),Le.castShadow){const Xt=Le.shadow,oi=d.get(Le);oi.shadowBias=Xt.bias,oi.shadowNormalBias=Xt.normalBias,oi.shadowRadius=Xt.radius,oi.shadowMapSize=Xt.mapSize,m.directionalShadow[z]=oi,m.directionalShadowMap[z]=hi,m.directionalShadowMatrix[z]=Le.shadow.matrix,Y++}m.directional[z]=ei,z++}else if(Le.isSpotLight){const ei=c.get(Le);ei.position.setFromMatrixPosition(Le.matrixWorld),ei.color.copy(Gt).multiplyScalar(Ht*Be),ei.distance=ri,ei.coneCos=Math.cos(Le.angle),ei.penumbraCos=Math.cos(Le.angle*(1-Le.penumbra)),ei.decay=Le.decay,m.spot[W]=ei;const Xt=Le.shadow;if(Le.map&&(m.spotLightMap[we]=Le.map,we++,Xt.updateMatrices(Le),Le.castShadow&&me++),m.spotLightMatrix[W]=Xt.matrix,Le.castShadow){const oi=d.get(Le);oi.shadowBias=Xt.bias,oi.shadowNormalBias=Xt.normalBias,oi.shadowRadius=Xt.radius,oi.shadowMapSize=Xt.mapSize,m.spotShadow[W]=oi,m.spotShadowMap[W]=hi,be++}W++}else if(Le.isRectAreaLight){const ei=c.get(Le);ei.color.copy(Gt).multiplyScalar(Ht),ei.halfWidth.set(.5*Le.width,0,0),ei.halfHeight.set(0,.5*Le.height,0),m.rectArea[Q]=ei,Q++}else if(Le.isPointLight){const ei=c.get(Le);if(ei.color.copy(Le.color).multiplyScalar(Le.intensity*Be),ei.distance=Le.distance,ei.decay=Le.decay,Le.castShadow){const Xt=Le.shadow,oi=d.get(Le);oi.shadowBias=Xt.bias,oi.shadowNormalBias=Xt.normalBias,oi.shadowRadius=Xt.radius,oi.shadowMapSize=Xt.mapSize,oi.shadowCameraNear=Xt.camera.near,oi.shadowCameraFar=Xt.camera.far,m.pointShadow[G]=oi,m.pointShadowMap[G]=hi,m.pointShadowMatrix[G]=Le.shadow.matrix,q++}m.point[G]=ei,G++}else if(Le.isHemisphereLight){const ei=c.get(Le);ei.skyColor.copy(Le.color).multiplyScalar(Ht*Be),ei.groundColor.copy(Le.groundColor).multiplyScalar(Ht*Be),m.hemi[$]=ei,$++}}Q>0&&(n.isWebGL2||b.has("OES_texture_float_linear")===!0?(m.rectAreaLTC1=_i.LTC_FLOAT_1,m.rectAreaLTC2=_i.LTC_FLOAT_2):b.has("OES_texture_half_float_linear")===!0?(m.rectAreaLTC1=_i.LTC_HALF_1,m.rectAreaLTC2=_i.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),m.ambient[0]=B,m.ambient[1]=j,m.ambient[2]=F;const Ze=m.hash;Ze.directionalLength===z&&Ze.pointLength===G&&Ze.spotLength===W&&Ze.rectAreaLength===Q&&Ze.hemiLength===$&&Ze.numDirectionalShadows===Y&&Ze.numPointShadows===q&&Ze.numSpotShadows===be&&Ze.numSpotMaps===we||(m.directional.length=z,m.spot.length=W,m.rectArea.length=Q,m.point.length=G,m.hemi.length=$,m.directionalShadow.length=Y,m.directionalShadowMap.length=Y,m.pointShadow.length=q,m.pointShadowMap.length=q,m.spotShadow.length=be,m.spotShadowMap.length=be,m.directionalShadowMatrix.length=Y,m.pointShadowMatrix.length=q,m.spotLightMatrix.length=be+we-me,m.spotLightMap.length=we,m.numSpotLightShadowsWithMaps=me,Ze.directionalLength=z,Ze.pointLength=G,Ze.spotLength=W,Ze.rectAreaLength=Q,Ze.hemiLength=$,Ze.numDirectionalShadows=Y,Ze.numPointShadows=q,Ze.numSpotShadows=be,Ze.numSpotMaps=we,m.version=kA++)},setupView:function(P,D){let B=0,j=0,F=0,z=0,G=0;const W=D.matrixWorldInverse;for(let Q=0,$=P.length;Q<$;Q++){const Y=P[Q];if(Y.isDirectionalLight){const q=m.directional[B];q.direction.setFromMatrixPosition(Y.matrixWorld),v.setFromMatrixPosition(Y.target.matrixWorld),q.direction.sub(v),q.direction.transformDirection(W),B++}else if(Y.isSpotLight){const q=m.spot[F];q.position.setFromMatrixPosition(Y.matrixWorld),q.position.applyMatrix4(W),q.direction.setFromMatrixPosition(Y.matrixWorld),v.setFromMatrixPosition(Y.target.matrixWorld),q.direction.sub(v),q.direction.transformDirection(W),F++}else if(Y.isRectAreaLight){const q=m.rectArea[z];q.position.setFromMatrixPosition(Y.matrixWorld),q.position.applyMatrix4(W),C.identity(),w.copy(Y.matrixWorld),w.premultiply(W),C.extractRotation(w),q.halfWidth.set(.5*Y.width,0,0),q.halfHeight.set(0,.5*Y.height,0),q.halfWidth.applyMatrix4(C),q.halfHeight.applyMatrix4(C),z++}else if(Y.isPointLight){const q=m.point[j];q.position.setFromMatrixPosition(Y.matrixWorld),q.position.applyMatrix4(W),j++}else if(Y.isHemisphereLight){const q=m.hemi[G];q.direction.setFromMatrixPosition(Y.matrixWorld),q.direction.transformDirection(W),G++}}},state:m}}function oy(b,n){const c=new Dh(b,n),d=[],m=[];return{init:function(){d.length=0,m.length=0},state:{lightsArray:d,shadowsArray:m,lights:c},setupLights:function(v){c.setup(d,v)},setupLightsView:function(v){c.setupView(d,v)},pushLight:function(v){d.push(v)},pushShadow:function(v){m.push(v)}}}function dc(b,n){let c=new WeakMap;return{get:function(d,m=0){const v=c.get(d);let w;return v===void 0?(w=new oy(b,n),c.set(d,[w])):m>=v.length?(w=new oy(b,n),v.push(w)):w=v[m],w},dispose:function(){c=new WeakMap}}}class io extends Gs{constructor(n){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=gs,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(n)}copy(n){return super.copy(n),this.depthPacking=n.depthPacking,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this}}class rp extends Gs{constructor(n){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(n)}copy(n){return super.copy(n),this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this}}const ly=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,xo=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function sE(b,n,c){let d=new Ef;const m=new Jt,v=new Jt,w=new Tr,C=new io({depthPacking:Tn}),P=new rp,D={},B=c.maxTextureSize,j={[lt]:Ce,[Ce]:lt,[vt]:vt},F=new cc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Jt},radius:{value:4}},vertexShader:ly,fragmentShader:xo}),z=F.clone();z.defines.HORIZONTAL_PASS=1;const G=new hr;G.setAttribute("position",new on(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const W=new Ut(G,F),Q=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Mt;let $=this.type;function Y(we,me){const Be=n.update(W);F.defines.VSM_SAMPLES!==we.blurSamples&&(F.defines.VSM_SAMPLES=we.blurSamples,z.defines.VSM_SAMPLES=we.blurSamples,F.needsUpdate=!0,z.needsUpdate=!0),we.mapPass===null&&(we.mapPass=new zs(m.x,m.y)),F.uniforms.shadow_pass.value=we.map.texture,F.uniforms.resolution.value=we.mapSize,F.uniforms.radius.value=we.radius,b.setRenderTarget(we.mapPass),b.clear(),b.renderBufferDirect(me,null,Be,F,W,null),z.uniforms.shadow_pass.value=we.mapPass.texture,z.uniforms.resolution.value=we.mapSize,z.uniforms.radius.value=we.radius,b.setRenderTarget(we.map),b.clear(),b.renderBufferDirect(me,null,Be,z,W,null)}function q(we,me,Be,Ze){let et=null;const ft=Be.isPointLight===!0?we.customDistanceMaterial:we.customDepthMaterial;if(ft!==void 0)et=ft;else if(et=Be.isPointLight===!0?P:C,b.localClippingEnabled&&me.clipShadows===!0&&Array.isArray(me.clippingPlanes)&&me.clippingPlanes.length!==0||me.displacementMap&&me.displacementScale!==0||me.alphaMap&&me.alphaTest>0||me.map&&me.alphaTest>0){const Le=et.uuid,Gt=me.uuid;let Ht=D[Le];Ht===void 0&&(Ht={},D[Le]=Ht);let ri=Ht[Gt];ri===void 0&&(ri=et.clone(),Ht[Gt]=ri),et=ri}return et.visible=me.visible,et.wireframe=me.wireframe,et.side=Ze===Re?me.shadowSide!==null?me.shadowSide:me.side:me.shadowSide!==null?me.shadowSide:j[me.side],et.alphaMap=me.alphaMap,et.alphaTest=me.alphaTest,et.map=me.map,et.clipShadows=me.clipShadows,et.clippingPlanes=me.clippingPlanes,et.clipIntersection=me.clipIntersection,et.displacementMap=me.displacementMap,et.displacementScale=me.displacementScale,et.displacementBias=me.displacementBias,et.wireframeLinewidth=me.wireframeLinewidth,et.linewidth=me.linewidth,Be.isPointLight===!0&&et.isMeshDistanceMaterial===!0&&(b.properties.get(et).light=Be),et}function be(we,me,Be,Ze,et){if(we.visible===!1)return;if(we.layers.test(me.layers)&&(we.isMesh||we.isLine||we.isPoints)&&(we.castShadow||we.receiveShadow&&et===Re)&&(!we.frustumCulled||d.intersectsObject(we))){we.modelViewMatrix.multiplyMatrices(Be.matrixWorldInverse,we.matrixWorld);const Le=n.update(we),Gt=we.material;if(Array.isArray(Gt)){const Ht=Le.groups;for(let ri=0,hi=Ht.length;ri<hi;ri++){const ei=Ht[ri],Xt=Gt[ei.materialIndex];if(Xt&&Xt.visible){const oi=q(we,Xt,Ze,et);b.renderBufferDirect(Be,null,Le,oi,we,ei)}}}else if(Gt.visible){const Ht=q(we,Gt,Ze,et);b.renderBufferDirect(Be,null,Le,Ht,we,null)}}const ft=we.children;for(let Le=0,Gt=ft.length;Le<Gt;Le++)be(ft[Le],me,Be,Ze,et)}this.render=function(we,me,Be){if(Q.enabled===!1||Q.autoUpdate===!1&&Q.needsUpdate===!1||we.length===0)return;const Ze=b.getRenderTarget(),et=b.getActiveCubeFace(),ft=b.getActiveMipmapLevel(),Le=b.state;Le.setBlending(Fe),Le.buffers.color.setClear(1,1,1,1),Le.buffers.depth.setTest(!0),Le.setScissorTest(!1);const Gt=$!==Re&&this.type===Re,Ht=$===Re&&this.type!==Re;for(let ri=0,hi=we.length;ri<hi;ri++){const ei=we[ri],Xt=ei.shadow;if(Xt===void 0){console.warn("THREE.WebGLShadowMap:",ei,"has no shadow.");continue}if(Xt.autoUpdate===!1&&Xt.needsUpdate===!1)continue;m.copy(Xt.mapSize);const oi=Xt.getFrameExtents();if(m.multiply(oi),v.copy(Xt.mapSize),(m.x>B||m.y>B)&&(m.x>B&&(v.x=Math.floor(B/oi.x),m.x=v.x*oi.x,Xt.mapSize.x=v.x),m.y>B&&(v.y=Math.floor(B/oi.y),m.y=v.y*oi.y,Xt.mapSize.y=v.y)),Xt.map===null||Gt===!0||Ht===!0){const Nt=this.type!==Re?{minFilter:dn,magFilter:dn}:{};Xt.map!==null&&Xt.map.dispose(),Xt.map=new zs(m.x,m.y,Nt),Xt.map.texture.name=ei.name+".shadowMap",Xt.camera.updateProjectionMatrix()}b.setRenderTarget(Xt.map),b.clear();const Pt=Xt.getViewportCount();for(let Nt=0;Nt<Pt;Nt++){const ci=Xt.getViewport(Nt);w.set(v.x*ci.x,v.y*ci.y,v.x*ci.z,v.y*ci.w),Le.viewport(w),Xt.updateMatrices(ei,Nt),d=Xt.getFrustum(),be(me,Be,Xt.camera,ei,this.type)}Xt.isPointLightShadow!==!0&&this.type===Re&&Y(Xt,Be),Xt.needsUpdate=!1}$=this.type,Q.needsUpdate=!1,b.setRenderTarget(Ze,et,ft)}}function aE(b,n,c){const d=c.isWebGL2,m=new function(){let ye=!1;const ke=new Tr;let ze=null;const rt=new Tr(0,0,0,0);return{setMask:function(Et){ze===Et||ye||(b.colorMask(Et,Et,Et,Et),ze=Et)},setLocked:function(Et){ye=Et},setClear:function(Et,Vt,Yt,Fi,Ki){Ki===!0&&(Et*=Fi,Vt*=Fi,Yt*=Fi),ke.set(Et,Vt,Yt,Fi),rt.equals(ke)===!1&&(b.clearColor(Et,Vt,Yt,Fi),rt.copy(ke))},reset:function(){ye=!1,ze=null,rt.set(-1,0,0,0)}}},v=new function(){let ye=!1,ke=null,ze=null,rt=null;return{setTest:function(Et){Et?yi(b.DEPTH_TEST):qi(b.DEPTH_TEST)},setMask:function(Et){ke===Et||ye||(b.depthMask(Et),ke=Et)},setFunc:function(Et){if(ze!==Et){switch(Et){case Qe:b.depthFunc(b.NEVER);break;case oe:b.depthFunc(b.ALWAYS);break;case Ie:b.depthFunc(b.LESS);break;case We:b.depthFunc(b.LEQUAL);break;case Wt:b.depthFunc(b.EQUAL);break;case ti:b.depthFunc(b.GEQUAL);break;case mi:b.depthFunc(b.GREATER);break;case rr:b.depthFunc(b.NOTEQUAL);break;default:b.depthFunc(b.LEQUAL)}ze=Et}},setLocked:function(Et){ye=Et},setClear:function(Et){rt!==Et&&(b.clearDepth(Et),rt=Et)},reset:function(){ye=!1,ke=null,ze=null,rt=null}}},w=new function(){let ye=!1,ke=null,ze=null,rt=null,Et=null,Vt=null,Yt=null,Fi=null,Ki=null;return{setTest:function(Ti){ye||(Ti?yi(b.STENCIL_TEST):qi(b.STENCIL_TEST))},setMask:function(Ti){ke===Ti||ye||(b.stencilMask(Ti),ke=Ti)},setFunc:function(Ti,tr,dr){ze===Ti&&rt===tr&&Et===dr||(b.stencilFunc(Ti,tr,dr),ze=Ti,rt=tr,Et=dr)},setOp:function(Ti,tr,dr){Vt===Ti&&Yt===tr&&Fi===dr||(b.stencilOp(Ti,tr,dr),Vt=Ti,Yt=tr,Fi=dr)},setLocked:function(Ti){ye=Ti},setClear:function(Ti){Ki!==Ti&&(b.clearStencil(Ti),Ki=Ti)},reset:function(){ye=!1,ke=null,ze=null,rt=null,Et=null,Vt=null,Yt=null,Fi=null,Ki=null}}},C=new WeakMap,P=new WeakMap;let D={},B={},j=new WeakMap,F=[],z=null,G=!1,W=null,Q=null,$=null,Y=null,q=null,be=null,we=null,me=!1,Be=null,Ze=null,et=null,ft=null,Le=null;const Gt=b.getParameter(b.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ht=!1,ri=0;const hi=b.getParameter(b.VERSION);hi.indexOf("WebGL")!==-1?(ri=parseFloat(/^WebGL (\d)/.exec(hi)[1]),Ht=ri>=1):hi.indexOf("OpenGL ES")!==-1&&(ri=parseFloat(/^OpenGL ES (\d)/.exec(hi)[1]),Ht=ri>=2);let ei=null,Xt={};const oi=b.getParameter(b.SCISSOR_BOX),Pt=b.getParameter(b.VIEWPORT),Nt=new Tr().fromArray(oi),ci=new Tr().fromArray(Pt);function pi(ye,ke,ze,rt){const Et=new Uint8Array(4),Vt=b.createTexture();b.bindTexture(ye,Vt),b.texParameteri(ye,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(ye,b.TEXTURE_MAG_FILTER,b.NEAREST);for(let Yt=0;Yt<ze;Yt++)!d||ye!==b.TEXTURE_3D&&ye!==b.TEXTURE_2D_ARRAY?b.texImage2D(ke+Yt,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,Et):b.texImage3D(ke,0,b.RGBA,1,1,rt,0,b.RGBA,b.UNSIGNED_BYTE,Et);return Vt}const $i={};function yi(ye){D[ye]!==!0&&(b.enable(ye),D[ye]=!0)}function qi(ye){D[ye]!==!1&&(b.disable(ye),D[ye]=!1)}$i[b.TEXTURE_2D]=pi(b.TEXTURE_2D,b.TEXTURE_2D,1),$i[b.TEXTURE_CUBE_MAP]=pi(b.TEXTURE_CUBE_MAP,b.TEXTURE_CUBE_MAP_POSITIVE_X,6),d&&($i[b.TEXTURE_2D_ARRAY]=pi(b.TEXTURE_2D_ARRAY,b.TEXTURE_2D_ARRAY,1,1),$i[b.TEXTURE_3D]=pi(b.TEXTURE_3D,b.TEXTURE_3D,1,1)),m.setClear(0,0,0,1),v.setClear(1),w.setClear(0),yi(b.DEPTH_TEST),v.setFunc(We),Ge(!1),ht(_t),yi(b.CULL_FACE),Me(Fe);const Ri={[ee]:b.FUNC_ADD,[ce]:b.FUNC_SUBTRACT,[Ne]:b.FUNC_REVERSE_SUBTRACT};if(d)Ri[K]=b.MIN,Ri[ie]=b.MAX;else{const ye=n.get("EXT_blend_minmax");ye!==null&&(Ri[K]=ye.MIN_EXT,Ri[ie]=ye.MAX_EXT)}const De={[he]:b.ZERO,[_e]:b.ONE,[He]:b.SRC_COLOR,[It]:b.SRC_ALPHA,[Qt]:b.SRC_ALPHA_SATURATE,[Bt]:b.DST_COLOR,[jt]:b.DST_ALPHA,[gt]:b.ONE_MINUS_SRC_COLOR,[xt]:b.ONE_MINUS_SRC_ALPHA,[Rt]:b.ONE_MINUS_DST_COLOR,[ot]:b.ONE_MINUS_DST_ALPHA};function Me(ye,ke,ze,rt,Et,Vt,Yt,Fi){if(ye!==Fe){if(G===!1&&(yi(b.BLEND),G=!0),ye===Z)Et=Et||ke,Vt=Vt||ze,Yt=Yt||rt,ke===Q&&Et===q||(b.blendEquationSeparate(Ri[ke],Ri[Et]),Q=ke,q=Et),ze===$&&rt===Y&&Vt===be&&Yt===we||(b.blendFuncSeparate(De[ze],De[rt],De[Vt],De[Yt]),$=ze,Y=rt,be=Vt,we=Yt),W=ye,me=!1;else if(ye!==W||Fi!==me){if(Q===ee&&q===ee||(b.blendEquation(b.FUNC_ADD),Q=ee,q=ee),Fi)switch(ye){case Ct:b.blendFuncSeparate(b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);break;case Ft:b.blendFunc(b.ONE,b.ONE);break;case Ue:b.blendFuncSeparate(b.ZERO,b.ONE_MINUS_SRC_COLOR,b.ZERO,b.ONE);break;case $e:b.blendFuncSeparate(b.ZERO,b.SRC_COLOR,b.ZERO,b.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye)}else switch(ye){case Ct:b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);break;case Ft:b.blendFunc(b.SRC_ALPHA,b.ONE);break;case Ue:b.blendFuncSeparate(b.ZERO,b.ONE_MINUS_SRC_COLOR,b.ZERO,b.ONE);break;case $e:b.blendFunc(b.ZERO,b.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye)}$=null,Y=null,be=null,we=null,W=ye,me=Fi}}else G===!0&&(qi(b.BLEND),G=!1)}function Ge(ye){Be!==ye&&(ye?b.frontFace(b.CW):b.frontFace(b.CCW),Be=ye)}function ht(ye){ye!==tt?(yi(b.CULL_FACE),ye!==Ze&&(ye===_t?b.cullFace(b.BACK):ye===it?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK))):qi(b.CULL_FACE),Ze=ye}function Oe(ye,ke,ze){ye?(yi(b.POLYGON_OFFSET_FILL),ft===ke&&Le===ze||(b.polygonOffset(ke,ze),ft=ke,Le=ze)):qi(b.POLYGON_OFFSET_FILL)}return{buffers:{color:m,depth:v,stencil:w},enable:yi,disable:qi,bindFramebuffer:function(ye,ke){return B[ye]!==ke&&(b.bindFramebuffer(ye,ke),B[ye]=ke,d&&(ye===b.DRAW_FRAMEBUFFER&&(B[b.FRAMEBUFFER]=ke),ye===b.FRAMEBUFFER&&(B[b.DRAW_FRAMEBUFFER]=ke)),!0)},drawBuffers:function(ye,ke){let ze=F,rt=!1;if(ye)if(ze=j.get(ke),ze===void 0&&(ze=[],j.set(ke,ze)),ye.isWebGLMultipleRenderTargets){const Et=ye.texture;if(ze.length!==Et.length||ze[0]!==b.COLOR_ATTACHMENT0){for(let Vt=0,Yt=Et.length;Vt<Yt;Vt++)ze[Vt]=b.COLOR_ATTACHMENT0+Vt;ze.length=Et.length,rt=!0}}else ze[0]!==b.COLOR_ATTACHMENT0&&(ze[0]=b.COLOR_ATTACHMENT0,rt=!0);else ze[0]!==b.BACK&&(ze[0]=b.BACK,rt=!0);rt&&(c.isWebGL2?b.drawBuffers(ze):n.get("WEBGL_draw_buffers").drawBuffersWEBGL(ze))},useProgram:function(ye){return z!==ye&&(b.useProgram(ye),z=ye,!0)},setBlending:Me,setMaterial:function(ye,ke){ye.side===vt?qi(b.CULL_FACE):yi(b.CULL_FACE);let ze=ye.side===Ce;ke&&(ze=!ze),Ge(ze),ye.blending===Ct&&ye.transparent===!1?Me(Fe):Me(ye.blending,ye.blendEquation,ye.blendSrc,ye.blendDst,ye.blendEquationAlpha,ye.blendSrcAlpha,ye.blendDstAlpha,ye.premultipliedAlpha),v.setFunc(ye.depthFunc),v.setTest(ye.depthTest),v.setMask(ye.depthWrite),m.setMask(ye.colorWrite);const rt=ye.stencilWrite;w.setTest(rt),rt&&(w.setMask(ye.stencilWriteMask),w.setFunc(ye.stencilFunc,ye.stencilRef,ye.stencilFuncMask),w.setOp(ye.stencilFail,ye.stencilZFail,ye.stencilZPass)),Oe(ye.polygonOffset,ye.polygonOffsetFactor,ye.polygonOffsetUnits),ye.alphaToCoverage===!0?yi(b.SAMPLE_ALPHA_TO_COVERAGE):qi(b.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ge,setCullFace:ht,setLineWidth:function(ye){ye!==et&&(Ht&&b.lineWidth(ye),et=ye)},setPolygonOffset:Oe,setScissorTest:function(ye){ye?yi(b.SCISSOR_TEST):qi(b.SCISSOR_TEST)},activeTexture:function(ye){ye===void 0&&(ye=b.TEXTURE0+Gt-1),ei!==ye&&(b.activeTexture(ye),ei=ye)},bindTexture:function(ye,ke,ze){ze===void 0&&(ze=ei===null?b.TEXTURE0+Gt-1:ei);let rt=Xt[ze];rt===void 0&&(rt={type:void 0,texture:void 0},Xt[ze]=rt),rt.type===ye&&rt.texture===ke||(ei!==ze&&(b.activeTexture(ze),ei=ze),b.bindTexture(ye,ke||$i[ye]),rt.type=ye,rt.texture=ke)},unbindTexture:function(){const ye=Xt[ei];ye!==void 0&&ye.type!==void 0&&(b.bindTexture(ye.type,null),ye.type=void 0,ye.texture=void 0)},compressedTexImage2D:function(){try{b.compressedTexImage2D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},compressedTexImage3D:function(){try{b.compressedTexImage3D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},texImage2D:function(){try{b.texImage2D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},texImage3D:function(){try{b.texImage3D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},updateUBOMapping:function(ye,ke){let ze=P.get(ke);ze===void 0&&(ze=new WeakMap,P.set(ke,ze));let rt=ze.get(ye);rt===void 0&&(rt=b.getUniformBlockIndex(ke,ye.name),ze.set(ye,rt))},uniformBlockBinding:function(ye,ke){const ze=P.get(ke).get(ye);C.get(ke)!==ze&&(b.uniformBlockBinding(ke,ze,ye.__bindingPointIndex),C.set(ke,ze))},texStorage2D:function(){try{b.texStorage2D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},texStorage3D:function(){try{b.texStorage3D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},texSubImage2D:function(){try{b.texSubImage2D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},texSubImage3D:function(){try{b.texSubImage3D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},compressedTexSubImage2D:function(){try{b.compressedTexSubImage2D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},compressedTexSubImage3D:function(){try{b.compressedTexSubImage3D.apply(b,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}},scissor:function(ye){Nt.equals(ye)===!1&&(b.scissor(ye.x,ye.y,ye.z,ye.w),Nt.copy(ye))},viewport:function(ye){ci.equals(ye)===!1&&(b.viewport(ye.x,ye.y,ye.z,ye.w),ci.copy(ye))},reset:function(){b.disable(b.BLEND),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.POLYGON_OFFSET_FILL),b.disable(b.SCISSOR_TEST),b.disable(b.STENCIL_TEST),b.disable(b.SAMPLE_ALPHA_TO_COVERAGE),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ONE,b.ZERO),b.blendFuncSeparate(b.ONE,b.ZERO,b.ONE,b.ZERO),b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.depthMask(!0),b.depthFunc(b.LESS),b.clearDepth(1),b.stencilMask(4294967295),b.stencilFunc(b.ALWAYS,0,4294967295),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.clearStencil(0),b.cullFace(b.BACK),b.frontFace(b.CCW),b.polygonOffset(0,0),b.activeTexture(b.TEXTURE0),b.bindFramebuffer(b.FRAMEBUFFER,null),d===!0&&(b.bindFramebuffer(b.DRAW_FRAMEBUFFER,null),b.bindFramebuffer(b.READ_FRAMEBUFFER,null)),b.useProgram(null),b.lineWidth(1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.viewport(0,0,b.canvas.width,b.canvas.height),D={},ei=null,Xt={},B={},j=new WeakMap,F=[],z=null,G=!1,W=null,Q=null,$=null,Y=null,q=null,be=null,we=null,me=!1,Be=null,Ze=null,et=null,ft=null,Le=null,Nt.set(0,0,b.canvas.width,b.canvas.height),ci.set(0,0,b.canvas.width,b.canvas.height),m.reset(),v.reset(),w.reset()}}}function cy(b,n,c,d,m,v,w){const C=m.isWebGL2,P=m.maxTextures,D=m.maxCubemapSize,B=m.maxTextureSize,j=m.maxSamples,F=n.has("WEBGL_multisampled_render_to_texture")?n.get("WEBGL_multisampled_render_to_texture"):null,z=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),G=new WeakMap;let W;const Q=new WeakMap;let $=!1;try{$=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Y(De,Me){return $?new OffscreenCanvas(De,Me):tc("canvas")}function q(De,Me,Ge,ht){let Oe=1;if((De.width>ht||De.height>ht)&&(Oe=ht/Math.max(De.width,De.height)),Oe<1||Me===!0){if(typeof HTMLImageElement<"u"&&De instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&De instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&De instanceof ImageBitmap){const ye=Me?Ho:Math.floor,ke=ye(Oe*De.width),ze=ye(Oe*De.height);W===void 0&&(W=Y(ke,ze));const rt=Ge?Y(ke,ze):W;return rt.width=ke,rt.height=ze,rt.getContext("2d").drawImage(De,0,0,ke,ze),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+De.width+"x"+De.height+") to ("+ke+"x"+ze+")."),rt}return"data"in De&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+De.width+"x"+De.height+")."),De}return De}function be(De){return fa(De.width)&&fa(De.height)}function we(De,Me){return De.generateMipmaps&&Me&&De.minFilter!==dn&&De.minFilter!==pn}function me(De){b.generateMipmap(De)}function Be(De,Me,Ge,ht,Oe=!1){if(C===!1)return Me;if(De!==null){if(b[De]!==void 0)return b[De];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+De+"'")}let ye=Me;return Me===b.RED&&(Ge===b.FLOAT&&(ye=b.R32F),Ge===b.HALF_FLOAT&&(ye=b.R16F),Ge===b.UNSIGNED_BYTE&&(ye=b.R8)),Me===b.RG&&(Ge===b.FLOAT&&(ye=b.RG32F),Ge===b.HALF_FLOAT&&(ye=b.RG16F),Ge===b.UNSIGNED_BYTE&&(ye=b.RG8)),Me===b.RGBA&&(Ge===b.FLOAT&&(ye=b.RGBA32F),Ge===b.HALF_FLOAT&&(ye=b.RGBA16F),Ge===b.UNSIGNED_BYTE&&(ye=ht===Yi&&Oe===!1?b.SRGB8_ALPHA8:b.RGBA8),Ge===b.UNSIGNED_SHORT_4_4_4_4&&(ye=b.RGBA4),Ge===b.UNSIGNED_SHORT_5_5_5_1&&(ye=b.RGB5_A1)),ye!==b.R16F&&ye!==b.R32F&&ye!==b.RG16F&&ye!==b.RG32F&&ye!==b.RGBA16F&&ye!==b.RGBA32F||n.get("EXT_color_buffer_float"),ye}function Ze(De,Me,Ge){return we(De,Ge)===!0||De.isFramebufferTexture&&De.minFilter!==dn&&De.minFilter!==pn?Math.log2(Math.max(Me.width,Me.height))+1:De.mipmaps!==void 0&&De.mipmaps.length>0?De.mipmaps.length:De.isCompressedTexture&&Array.isArray(De.image)?Me.mipmaps.length:1}function et(De){return De===dn||De===Ha||De===vl?b.NEAREST:b.LINEAR}function ft(De){const Me=De.target;Me.removeEventListener("dispose",ft),function(Ge){const ht=d.get(Ge);if(ht.__webglInit===void 0)return;const Oe=Ge.source,ye=Q.get(Oe);if(ye){const ke=ye[ht.__cacheKey];ke.usedTimes--,ke.usedTimes===0&&Gt(Ge),Object.keys(ye).length===0&&Q.delete(Oe)}d.remove(Ge)}(Me),Me.isVideoTexture&&G.delete(Me)}function Le(De){const Me=De.target;Me.removeEventListener("dispose",Le),function(Ge){const ht=Ge.texture,Oe=d.get(Ge),ye=d.get(ht);if(ye.__webglTexture!==void 0&&(b.deleteTexture(ye.__webglTexture),w.memory.textures--),Ge.depthTexture&&Ge.depthTexture.dispose(),Ge.isWebGLCubeRenderTarget)for(let ke=0;ke<6;ke++)b.deleteFramebuffer(Oe.__webglFramebuffer[ke]),Oe.__webglDepthbuffer&&b.deleteRenderbuffer(Oe.__webglDepthbuffer[ke]);else{if(b.deleteFramebuffer(Oe.__webglFramebuffer),Oe.__webglDepthbuffer&&b.deleteRenderbuffer(Oe.__webglDepthbuffer),Oe.__webglMultisampledFramebuffer&&b.deleteFramebuffer(Oe.__webglMultisampledFramebuffer),Oe.__webglColorRenderbuffer)for(let ke=0;ke<Oe.__webglColorRenderbuffer.length;ke++)Oe.__webglColorRenderbuffer[ke]&&b.deleteRenderbuffer(Oe.__webglColorRenderbuffer[ke]);Oe.__webglDepthRenderbuffer&&b.deleteRenderbuffer(Oe.__webglDepthRenderbuffer)}if(Ge.isWebGLMultipleRenderTargets)for(let ke=0,ze=ht.length;ke<ze;ke++){const rt=d.get(ht[ke]);rt.__webglTexture&&(b.deleteTexture(rt.__webglTexture),w.memory.textures--),d.remove(ht[ke])}d.remove(ht),d.remove(Ge)}(Me)}function Gt(De){const Me=d.get(De);b.deleteTexture(Me.__webglTexture);const Ge=De.source;delete Q.get(Ge)[Me.__cacheKey],w.memory.textures--}let Ht=0;function ri(De,Me){const Ge=d.get(De);if(De.isVideoTexture&&function(ht){const Oe=w.render.frame;G.get(ht)!==Oe&&(G.set(ht,Oe),ht.update())}(De),De.isRenderTargetTexture===!1&&De.version>0&&Ge.__version!==De.version){const ht=De.image;if(ht===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(ht.complete!==!1)return void Nt(Ge,De,Me);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}c.bindTexture(b.TEXTURE_2D,Ge.__webglTexture,b.TEXTURE0+Me)}const hi={[br]:b.REPEAT,[fs]:b.CLAMP_TO_EDGE,[$n]:b.MIRRORED_REPEAT},ei={[dn]:b.NEAREST,[Ha]:b.NEAREST_MIPMAP_NEAREST,[vl]:b.NEAREST_MIPMAP_LINEAR,[pn]:b.LINEAR,[uh]:b.LINEAR_MIPMAP_NEAREST,[_l]:b.LINEAR_MIPMAP_LINEAR},Xt={[ph]:b.NEVER,[Fc]:b.ALWAYS,[Dd]:b.LESS,[El]:b.LEQUAL,[cf]:b.EQUAL,[Bd]:b.GEQUAL,[Am]:b.GREATER,[uf]:b.NOTEQUAL};function oi(De,Me,Ge){if(Ge?(b.texParameteri(De,b.TEXTURE_WRAP_S,hi[Me.wrapS]),b.texParameteri(De,b.TEXTURE_WRAP_T,hi[Me.wrapT]),De!==b.TEXTURE_3D&&De!==b.TEXTURE_2D_ARRAY||b.texParameteri(De,b.TEXTURE_WRAP_R,hi[Me.wrapR]),b.texParameteri(De,b.TEXTURE_MAG_FILTER,ei[Me.magFilter]),b.texParameteri(De,b.TEXTURE_MIN_FILTER,ei[Me.minFilter])):(b.texParameteri(De,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(De,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),De!==b.TEXTURE_3D&&De!==b.TEXTURE_2D_ARRAY||b.texParameteri(De,b.TEXTURE_WRAP_R,b.CLAMP_TO_EDGE),Me.wrapS===fs&&Me.wrapT===fs||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),b.texParameteri(De,b.TEXTURE_MAG_FILTER,et(Me.magFilter)),b.texParameteri(De,b.TEXTURE_MIN_FILTER,et(Me.minFilter)),Me.minFilter!==dn&&Me.minFilter!==pn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Me.compareFunction&&(b.texParameteri(De,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(De,b.TEXTURE_COMPARE_FUNC,Xt[Me.compareFunction])),n.has("EXT_texture_filter_anisotropic")===!0){const ht=n.get("EXT_texture_filter_anisotropic");if(Me.magFilter===dn||Me.minFilter!==vl&&Me.minFilter!==_l||Me.type===bl&&n.has("OES_texture_float_linear")===!1||C===!1&&Me.type===sn&&n.has("OES_texture_half_float_linear")===!1)return;(Me.anisotropy>1||d.get(Me).__currentAnisotropy)&&(b.texParameterf(De,ht.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Me.anisotropy,m.getMaxAnisotropy())),d.get(Me).__currentAnisotropy=Me.anisotropy)}}function Pt(De,Me){let Ge=!1;De.__webglInit===void 0&&(De.__webglInit=!0,Me.addEventListener("dispose",ft));const ht=Me.source;let Oe=Q.get(ht);Oe===void 0&&(Oe={},Q.set(ht,Oe));const ye=function(ke){const ze=[];return ze.push(ke.wrapS),ze.push(ke.wrapT),ze.push(ke.wrapR||0),ze.push(ke.magFilter),ze.push(ke.minFilter),ze.push(ke.anisotropy),ze.push(ke.internalFormat),ze.push(ke.format),ze.push(ke.type),ze.push(ke.generateMipmaps),ze.push(ke.premultiplyAlpha),ze.push(ke.flipY),ze.push(ke.unpackAlignment),ze.push(ke.colorSpace),ze.join()}(Me);if(ye!==De.__cacheKey){Oe[ye]===void 0&&(Oe[ye]={texture:b.createTexture(),usedTimes:0},w.memory.textures++,Ge=!0),Oe[ye].usedTimes++;const ke=Oe[De.__cacheKey];ke!==void 0&&(Oe[De.__cacheKey].usedTimes--,ke.usedTimes===0&&Gt(Me)),De.__cacheKey=ye,De.__webglTexture=Oe[ye].texture}return Ge}function Nt(De,Me,Ge){let ht=b.TEXTURE_2D;(Me.isDataArrayTexture||Me.isCompressedArrayTexture)&&(ht=b.TEXTURE_2D_ARRAY),Me.isData3DTexture&&(ht=b.TEXTURE_3D);const Oe=Pt(De,Me),ye=Me.source;c.bindTexture(ht,De.__webglTexture,b.TEXTURE0+Ge);const ke=d.get(ye);if(ye.version!==ke.__version||Oe===!0){c.activeTexture(b.TEXTURE0+Ge),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,Me.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Me.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,Me.unpackAlignment),b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE);const ze=function(nr){return!C&&(nr.wrapS!==fs||nr.wrapT!==fs||nr.minFilter!==dn&&nr.minFilter!==pn)}(Me)&&be(Me.image)===!1;let rt=q(Me.image,ze,!1,B);rt=Ri(Me,rt);const Et=be(rt)||C,Vt=v.convert(Me.format,Me.colorSpace);let Yt,Fi=v.convert(Me.type),Ki=Be(Me.internalFormat,Vt,Fi,Me.colorSpace);oi(ht,Me,Et);const Ti=Me.mipmaps,tr=C&&Me.isVideoTexture!==!0,dr=ke.__version===void 0||Oe===!0,Jr=Ze(Me,rt,Et);if(Me.isDepthTexture)Ki=b.DEPTH_COMPONENT,C?Ki=Me.type===bl?b.DEPTH_COMPONENT32F:Me.type===Fo?b.DEPTH_COMPONENT24:Me.type===Wn?b.DEPTH24_STENCIL8:b.DEPTH_COMPONENT16:Me.type===bl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Me.format===ai&&Ki===b.DEPTH_COMPONENT&&Me.type!==hu&&Me.type!==Fo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Me.type=Fo,Fi=v.convert(Me.type)),Me.format===Mn&&Ki===b.DEPTH_COMPONENT&&(Ki=b.DEPTH_STENCIL,Me.type!==Wn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Me.type=Wn,Fi=v.convert(Me.type))),dr&&(tr?c.texStorage2D(b.TEXTURE_2D,1,Ki,rt.width,rt.height):c.texImage2D(b.TEXTURE_2D,0,Ki,rt.width,rt.height,0,Vt,Fi,null));else if(Me.isDataTexture)if(Ti.length>0&&Et){tr&&dr&&c.texStorage2D(b.TEXTURE_2D,Jr,Ki,Ti[0].width,Ti[0].height);for(let nr=0,qr=Ti.length;nr<qr;nr++)Yt=Ti[nr],tr?c.texSubImage2D(b.TEXTURE_2D,nr,0,0,Yt.width,Yt.height,Vt,Fi,Yt.data):c.texImage2D(b.TEXTURE_2D,nr,Ki,Yt.width,Yt.height,0,Vt,Fi,Yt.data);Me.generateMipmaps=!1}else tr?(dr&&c.texStorage2D(b.TEXTURE_2D,Jr,Ki,rt.width,rt.height),c.texSubImage2D(b.TEXTURE_2D,0,0,0,rt.width,rt.height,Vt,Fi,rt.data)):c.texImage2D(b.TEXTURE_2D,0,Ki,rt.width,rt.height,0,Vt,Fi,rt.data);else if(Me.isCompressedTexture)if(Me.isCompressedArrayTexture){tr&&dr&&c.texStorage3D(b.TEXTURE_2D_ARRAY,Jr,Ki,Ti[0].width,Ti[0].height,rt.depth);for(let nr=0,qr=Ti.length;nr<qr;nr++)Yt=Ti[nr],Me.format!==en?Vt!==null?tr?c.compressedTexSubImage3D(b.TEXTURE_2D_ARRAY,nr,0,0,0,Yt.width,Yt.height,rt.depth,Vt,Yt.data,0,0):c.compressedTexImage3D(b.TEXTURE_2D_ARRAY,nr,Ki,Yt.width,Yt.height,rt.depth,0,Yt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tr?c.texSubImage3D(b.TEXTURE_2D_ARRAY,nr,0,0,0,Yt.width,Yt.height,rt.depth,Vt,Fi,Yt.data):c.texImage3D(b.TEXTURE_2D_ARRAY,nr,Ki,Yt.width,Yt.height,rt.depth,0,Vt,Fi,Yt.data)}else{tr&&dr&&c.texStorage2D(b.TEXTURE_2D,Jr,Ki,Ti[0].width,Ti[0].height);for(let nr=0,qr=Ti.length;nr<qr;nr++)Yt=Ti[nr],Me.format!==en?Vt!==null?tr?c.compressedTexSubImage2D(b.TEXTURE_2D,nr,0,0,Yt.width,Yt.height,Vt,Yt.data):c.compressedTexImage2D(b.TEXTURE_2D,nr,Ki,Yt.width,Yt.height,0,Yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tr?c.texSubImage2D(b.TEXTURE_2D,nr,0,0,Yt.width,Yt.height,Vt,Fi,Yt.data):c.texImage2D(b.TEXTURE_2D,nr,Ki,Yt.width,Yt.height,0,Vt,Fi,Yt.data)}else if(Me.isDataArrayTexture)tr?(dr&&c.texStorage3D(b.TEXTURE_2D_ARRAY,Jr,Ki,rt.width,rt.height,rt.depth),c.texSubImage3D(b.TEXTURE_2D_ARRAY,0,0,0,0,rt.width,rt.height,rt.depth,Vt,Fi,rt.data)):c.texImage3D(b.TEXTURE_2D_ARRAY,0,Ki,rt.width,rt.height,rt.depth,0,Vt,Fi,rt.data);else if(Me.isData3DTexture)tr?(dr&&c.texStorage3D(b.TEXTURE_3D,Jr,Ki,rt.width,rt.height,rt.depth),c.texSubImage3D(b.TEXTURE_3D,0,0,0,0,rt.width,rt.height,rt.depth,Vt,Fi,rt.data)):c.texImage3D(b.TEXTURE_3D,0,Ki,rt.width,rt.height,rt.depth,0,Vt,Fi,rt.data);else if(Me.isFramebufferTexture){if(dr)if(tr)c.texStorage2D(b.TEXTURE_2D,Jr,Ki,rt.width,rt.height);else{let nr=rt.width,qr=rt.height;for(let os=0;os<Jr;os++)c.texImage2D(b.TEXTURE_2D,os,Ki,nr,qr,0,Vt,Fi,null),nr>>=1,qr>>=1}}else if(Ti.length>0&&Et){tr&&dr&&c.texStorage2D(b.TEXTURE_2D,Jr,Ki,Ti[0].width,Ti[0].height);for(let nr=0,qr=Ti.length;nr<qr;nr++)Yt=Ti[nr],tr?c.texSubImage2D(b.TEXTURE_2D,nr,0,0,Vt,Fi,Yt):c.texImage2D(b.TEXTURE_2D,nr,Ki,Vt,Fi,Yt);Me.generateMipmaps=!1}else tr?(dr&&c.texStorage2D(b.TEXTURE_2D,Jr,Ki,rt.width,rt.height),c.texSubImage2D(b.TEXTURE_2D,0,0,0,Vt,Fi,rt)):c.texImage2D(b.TEXTURE_2D,0,Ki,Vt,Fi,rt);we(Me,Et)&&me(ht),ke.__version=ye.version,Me.onUpdate&&Me.onUpdate(Me)}De.__version=Me.version}function ci(De,Me,Ge,ht,Oe){const ye=v.convert(Ge.format,Ge.colorSpace),ke=v.convert(Ge.type),ze=Be(Ge.internalFormat,ye,ke,Ge.colorSpace);d.get(Me).__hasExternalTextures||(Oe===b.TEXTURE_3D||Oe===b.TEXTURE_2D_ARRAY?c.texImage3D(Oe,0,ze,Me.width,Me.height,Me.depth,0,ye,ke,null):c.texImage2D(Oe,0,ze,Me.width,Me.height,0,ye,ke,null)),c.bindFramebuffer(b.FRAMEBUFFER,De),qi(Me)?F.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,ht,Oe,d.get(Ge).__webglTexture,0,yi(Me)):(Oe===b.TEXTURE_2D||Oe>=b.TEXTURE_CUBE_MAP_POSITIVE_X&&Oe<=b.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&b.framebufferTexture2D(b.FRAMEBUFFER,ht,Oe,d.get(Ge).__webglTexture,0),c.bindFramebuffer(b.FRAMEBUFFER,null)}function pi(De,Me,Ge){if(b.bindRenderbuffer(b.RENDERBUFFER,De),Me.depthBuffer&&!Me.stencilBuffer){let ht=b.DEPTH_COMPONENT16;if(Ge||qi(Me)){const Oe=Me.depthTexture;Oe&&Oe.isDepthTexture&&(Oe.type===bl?ht=b.DEPTH_COMPONENT32F:Oe.type===Fo&&(ht=b.DEPTH_COMPONENT24));const ye=yi(Me);qi(Me)?F.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,ye,ht,Me.width,Me.height):b.renderbufferStorageMultisample(b.RENDERBUFFER,ye,ht,Me.width,Me.height)}else b.renderbufferStorage(b.RENDERBUFFER,ht,Me.width,Me.height);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,De)}else if(Me.depthBuffer&&Me.stencilBuffer){const ht=yi(Me);Ge&&qi(Me)===!1?b.renderbufferStorageMultisample(b.RENDERBUFFER,ht,b.DEPTH24_STENCIL8,Me.width,Me.height):qi(Me)?F.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,ht,b.DEPTH24_STENCIL8,Me.width,Me.height):b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,Me.width,Me.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,De)}else{const ht=Me.isWebGLMultipleRenderTargets===!0?Me.texture:[Me.texture];for(let Oe=0;Oe<ht.length;Oe++){const ye=ht[Oe],ke=v.convert(ye.format,ye.colorSpace),ze=v.convert(ye.type),rt=Be(ye.internalFormat,ke,ze,ye.colorSpace),Et=yi(Me);Ge&&qi(Me)===!1?b.renderbufferStorageMultisample(b.RENDERBUFFER,Et,rt,Me.width,Me.height):qi(Me)?F.renderbufferStorageMultisampleEXT(b.RENDERBUFFER,Et,rt,Me.width,Me.height):b.renderbufferStorage(b.RENDERBUFFER,rt,Me.width,Me.height)}}b.bindRenderbuffer(b.RENDERBUFFER,null)}function $i(De){const Me=d.get(De),Ge=De.isWebGLCubeRenderTarget===!0;if(De.depthTexture&&!Me.__autoAllocateDepthBuffer){if(Ge)throw new Error("target.depthTexture not supported in Cube render targets");(function(ht,Oe){if(Oe&&Oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(b.FRAMEBUFFER,ht),!Oe.depthTexture||!Oe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(Oe.depthTexture).__webglTexture&&Oe.depthTexture.image.width===Oe.width&&Oe.depthTexture.image.height===Oe.height||(Oe.depthTexture.image.width=Oe.width,Oe.depthTexture.image.height=Oe.height,Oe.depthTexture.needsUpdate=!0),ri(Oe.depthTexture,0);const ye=d.get(Oe.depthTexture).__webglTexture,ke=yi(Oe);if(Oe.depthTexture.format===ai)qi(Oe)?F.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,ye,0,ke):b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,ye,0);else{if(Oe.depthTexture.format!==Mn)throw new Error("Unknown depthTexture format");qi(Oe)?F.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,ye,0,ke):b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,ye,0)}})(Me.__webglFramebuffer,De)}else if(Ge){Me.__webglDepthbuffer=[];for(let ht=0;ht<6;ht++)c.bindFramebuffer(b.FRAMEBUFFER,Me.__webglFramebuffer[ht]),Me.__webglDepthbuffer[ht]=b.createRenderbuffer(),pi(Me.__webglDepthbuffer[ht],De,!1)}else c.bindFramebuffer(b.FRAMEBUFFER,Me.__webglFramebuffer),Me.__webglDepthbuffer=b.createRenderbuffer(),pi(Me.__webglDepthbuffer,De,!1);c.bindFramebuffer(b.FRAMEBUFFER,null)}function yi(De){return Math.min(j,De.samples)}function qi(De){const Me=d.get(De);return C&&De.samples>0&&n.has("WEBGL_multisampled_render_to_texture")===!0&&Me.__useRenderToTexture!==!1}function Ri(De,Me){const Ge=De.colorSpace,ht=De.format,Oe=De.type;return De.isCompressedTexture===!0||De.format===da||Ge!==an&&Ge!==Ya&&(Ge===Yi?C===!1?n.has("EXT_sRGB")===!0&&ht===en?(De.format=da,De.minFilter=pn,De.generateMipmaps=!1):Me=Sm.sRGBToLinear(Me):ht===en&&Oe===yl||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Ge===kr||console.error("THREE.WebGLTextures: Unsupported texture color space:",Ge)),Me}this.allocateTextureUnit=function(){const De=Ht;return De>=P&&console.warn("THREE.WebGLTextures: Trying to use "+De+" texture units while this GPU supports only "+P),Ht+=1,De},this.resetTextureUnits=function(){Ht=0},this.setTexture2D=ri,this.setTexture2DArray=function(De,Me){const Ge=d.get(De);De.version>0&&Ge.__version!==De.version?Nt(Ge,De,Me):c.bindTexture(b.TEXTURE_2D_ARRAY,Ge.__webglTexture,b.TEXTURE0+Me)},this.setTexture3D=function(De,Me){const Ge=d.get(De);De.version>0&&Ge.__version!==De.version?Nt(Ge,De,Me):c.bindTexture(b.TEXTURE_3D,Ge.__webglTexture,b.TEXTURE0+Me)},this.setTextureCube=function(De,Me){const Ge=d.get(De);De.version>0&&Ge.__version!==De.version?function(ht,Oe,ye){if(Oe.image.length!==6)return;const ke=Pt(ht,Oe),ze=Oe.source;c.bindTexture(b.TEXTURE_CUBE_MAP,ht.__webglTexture,b.TEXTURE0+ye);const rt=d.get(ze);if(ze.version!==rt.__version||ke===!0){c.activeTexture(b.TEXTURE0+ye),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,Oe.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,Oe.unpackAlignment),b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE);const Et=Oe.isCompressedTexture||Oe.image[0].isCompressedTexture,Vt=Oe.image[0]&&Oe.image[0].isDataTexture,Yt=[];for(let Zi=0;Zi<6;Zi++)Yt[Zi]=Et||Vt?Vt?Oe.image[Zi].image:Oe.image[Zi]:q(Oe.image[Zi],!1,!0,D),Yt[Zi]=Ri(Oe,Yt[Zi]);const Fi=Yt[0],Ki=be(Fi)||C,Ti=v.convert(Oe.format,Oe.colorSpace),tr=v.convert(Oe.type),dr=Be(Oe.internalFormat,Ti,tr,Oe.colorSpace),Jr=C&&Oe.isVideoTexture!==!0,nr=rt.__version===void 0||ke===!0;let qr,os=Ze(Oe,Fi,Ki);if(oi(b.TEXTURE_CUBE_MAP,Oe,Ki),Et){Jr&&nr&&c.texStorage2D(b.TEXTURE_CUBE_MAP,os,dr,Fi.width,Fi.height);for(let Zi=0;Zi<6;Zi++){qr=Yt[Zi].mipmaps;for(let Fr=0;Fr<qr.length;Fr++){const ln=qr[Fr];Oe.format!==en?Ti!==null?Jr?c.compressedTexSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr,0,0,ln.width,ln.height,Ti,ln.data):c.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr,dr,ln.width,ln.height,0,ln.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Jr?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr,0,0,ln.width,ln.height,Ti,tr,ln.data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr,dr,ln.width,ln.height,0,Ti,tr,ln.data)}}}else{qr=Oe.mipmaps,Jr&&nr&&(qr.length>0&&os++,c.texStorage2D(b.TEXTURE_CUBE_MAP,os,dr,Yt[0].width,Yt[0].height));for(let Zi=0;Zi<6;Zi++)if(Vt){Jr?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,0,0,0,Yt[Zi].width,Yt[Zi].height,Ti,tr,Yt[Zi].data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,0,dr,Yt[Zi].width,Yt[Zi].height,0,Ti,tr,Yt[Zi].data);for(let Fr=0;Fr<qr.length;Fr++){const ln=qr[Fr].image[Zi].image;Jr?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr+1,0,0,ln.width,ln.height,Ti,tr,ln.data):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr+1,dr,ln.width,ln.height,0,Ti,tr,ln.data)}}else{Jr?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,0,0,0,Ti,tr,Yt[Zi]):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,0,dr,Ti,tr,Yt[Zi]);for(let Fr=0;Fr<qr.length;Fr++){const ln=qr[Fr];Jr?c.texSubImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr+1,0,0,Ti,tr,ln.image[Zi]):c.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Zi,Fr+1,dr,Ti,tr,ln.image[Zi])}}}we(Oe,Ki)&&me(b.TEXTURE_CUBE_MAP),rt.__version=ze.version,Oe.onUpdate&&Oe.onUpdate(Oe)}ht.__version=Oe.version}(Ge,De,Me):c.bindTexture(b.TEXTURE_CUBE_MAP,Ge.__webglTexture,b.TEXTURE0+Me)},this.rebindTextures=function(De,Me,Ge){const ht=d.get(De);Me!==void 0&&ci(ht.__webglFramebuffer,De,De.texture,b.COLOR_ATTACHMENT0,b.TEXTURE_2D),Ge!==void 0&&$i(De)},this.setupRenderTarget=function(De){const Me=De.texture,Ge=d.get(De),ht=d.get(Me);De.addEventListener("dispose",Le),De.isWebGLMultipleRenderTargets!==!0&&(ht.__webglTexture===void 0&&(ht.__webglTexture=b.createTexture()),ht.__version=Me.version,w.memory.textures++);const Oe=De.isWebGLCubeRenderTarget===!0,ye=De.isWebGLMultipleRenderTargets===!0,ke=be(De)||C;if(Oe){Ge.__webglFramebuffer=[];for(let ze=0;ze<6;ze++)Ge.__webglFramebuffer[ze]=b.createFramebuffer()}else{if(Ge.__webglFramebuffer=b.createFramebuffer(),ye)if(m.drawBuffers){const ze=De.texture;for(let rt=0,Et=ze.length;rt<Et;rt++){const Vt=d.get(ze[rt]);Vt.__webglTexture===void 0&&(Vt.__webglTexture=b.createTexture(),w.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(C&&De.samples>0&&qi(De)===!1){const ze=ye?Me:[Me];Ge.__webglMultisampledFramebuffer=b.createFramebuffer(),Ge.__webglColorRenderbuffer=[],c.bindFramebuffer(b.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer);for(let rt=0;rt<ze.length;rt++){const Et=ze[rt];Ge.__webglColorRenderbuffer[rt]=b.createRenderbuffer(),b.bindRenderbuffer(b.RENDERBUFFER,Ge.__webglColorRenderbuffer[rt]);const Vt=v.convert(Et.format,Et.colorSpace),Yt=v.convert(Et.type),Fi=Be(Et.internalFormat,Vt,Yt,Et.colorSpace,De.isXRRenderTarget===!0),Ki=yi(De);b.renderbufferStorageMultisample(b.RENDERBUFFER,Ki,Fi,De.width,De.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+rt,b.RENDERBUFFER,Ge.__webglColorRenderbuffer[rt])}b.bindRenderbuffer(b.RENDERBUFFER,null),De.depthBuffer&&(Ge.__webglDepthRenderbuffer=b.createRenderbuffer(),pi(Ge.__webglDepthRenderbuffer,De,!0)),c.bindFramebuffer(b.FRAMEBUFFER,null)}}if(Oe){c.bindTexture(b.TEXTURE_CUBE_MAP,ht.__webglTexture),oi(b.TEXTURE_CUBE_MAP,Me,ke);for(let ze=0;ze<6;ze++)ci(Ge.__webglFramebuffer[ze],De,Me,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+ze);we(Me,ke)&&me(b.TEXTURE_CUBE_MAP),c.unbindTexture()}else if(ye){const ze=De.texture;for(let rt=0,Et=ze.length;rt<Et;rt++){const Vt=ze[rt],Yt=d.get(Vt);c.bindTexture(b.TEXTURE_2D,Yt.__webglTexture),oi(b.TEXTURE_2D,Vt,ke),ci(Ge.__webglFramebuffer,De,Vt,b.COLOR_ATTACHMENT0+rt,b.TEXTURE_2D),we(Vt,ke)&&me(b.TEXTURE_2D)}c.unbindTexture()}else{let ze=b.TEXTURE_2D;(De.isWebGL3DRenderTarget||De.isWebGLArrayRenderTarget)&&(C?ze=De.isWebGL3DRenderTarget?b.TEXTURE_3D:b.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),c.bindTexture(ze,ht.__webglTexture),oi(ze,Me,ke),ci(Ge.__webglFramebuffer,De,Me,b.COLOR_ATTACHMENT0,ze),we(Me,ke)&&me(ze),c.unbindTexture()}De.depthBuffer&&$i(De)},this.updateRenderTargetMipmap=function(De){const Me=be(De)||C,Ge=De.isWebGLMultipleRenderTargets===!0?De.texture:[De.texture],ht=De.isWebGLCubeRenderTarget?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;for(let Oe=0,ye=Ge.length;Oe<ye;Oe++){const ke=Ge[Oe],ze=d.get(ke),rt=ze.__webglTexture;ze.__version!==ke.version&&(c.bindTexture(ht,rt),oi(ht,ke,Me),c.unbindTexture(),ze.__version=ke.version),we(ke,Me)&&(c.bindTexture(ht,rt),me(ht),c.unbindTexture())}},this.updateMultisampleRenderTarget=function(De){if(C&&De.samples>0&&qi(De)===!1){const Me=De.isWebGLMultipleRenderTargets?De.texture:[De.texture],Ge=De.width,ht=De.height;let Oe=b.COLOR_BUFFER_BIT;const ye=[],ke=De.stencilBuffer?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT,ze=d.get(De),rt=De.isWebGLMultipleRenderTargets===!0;if(rt)for(let Et=0;Et<Me.length;Et++)c.bindFramebuffer(b.FRAMEBUFFER,ze.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+Et,b.RENDERBUFFER,null),c.bindFramebuffer(b.FRAMEBUFFER,ze.__webglFramebuffer),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+Et,b.TEXTURE_2D,null,0);c.bindFramebuffer(b.READ_FRAMEBUFFER,ze.__webglMultisampledFramebuffer),c.bindFramebuffer(b.DRAW_FRAMEBUFFER,ze.__webglFramebuffer);for(let Et=0;Et<Me.length;Et++){ye.push(b.COLOR_ATTACHMENT0+Et),De.depthBuffer&&ye.push(ke);const Vt=ze.__ignoreDepthValues!==void 0&&ze.__ignoreDepthValues;if(Vt===!1&&(De.depthBuffer&&(Oe|=b.DEPTH_BUFFER_BIT),De.stencilBuffer&&(Oe|=b.STENCIL_BUFFER_BIT)),rt&&b.framebufferRenderbuffer(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,ze.__webglColorRenderbuffer[Et]),Vt===!0&&(b.invalidateFramebuffer(b.READ_FRAMEBUFFER,[ke]),b.invalidateFramebuffer(b.DRAW_FRAMEBUFFER,[ke])),rt){const Yt=d.get(Me[Et]).__webglTexture;b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,Yt,0)}b.blitFramebuffer(0,0,Ge,ht,0,0,Ge,ht,Oe,b.NEAREST),z&&b.invalidateFramebuffer(b.READ_FRAMEBUFFER,ye)}if(c.bindFramebuffer(b.READ_FRAMEBUFFER,null),c.bindFramebuffer(b.DRAW_FRAMEBUFFER,null),rt)for(let Et=0;Et<Me.length;Et++){c.bindFramebuffer(b.FRAMEBUFFER,ze.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+Et,b.RENDERBUFFER,ze.__webglColorRenderbuffer[Et]);const Vt=d.get(Me[Et]).__webglTexture;c.bindFramebuffer(b.FRAMEBUFFER,ze.__webglFramebuffer),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+Et,b.TEXTURE_2D,Vt,0)}c.bindFramebuffer(b.DRAW_FRAMEBUFFER,ze.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=$i,this.setupFrameBufferTexture=ci,this.useMultisampledRTT=qi}function uy(b,n,c){const d=c.isWebGL2;return{convert:function(m,v=Ya){let w;if(m===yl)return b.UNSIGNED_BYTE;if(m===hh)return b.UNSIGNED_SHORT_4_4_4_4;if(m===ef)return b.UNSIGNED_SHORT_5_5_5_1;if(m===$p)return b.BYTE;if(m===ms)return b.SHORT;if(m===hu)return b.UNSIGNED_SHORT;if(m===vm)return b.INT;if(m===Fo)return b.UNSIGNED_INT;if(m===bl)return b.FLOAT;if(m===sn)return d?b.HALF_FLOAT:(w=n.get("OES_texture_half_float"),w!==null?w.HALF_FLOAT_OES:null);if(m===dh)return b.ALPHA;if(m===en)return b.RGBA;if(m===Ot)return b.LUMINANCE;if(m===ql)return b.LUMINANCE_ALPHA;if(m===ai)return b.DEPTH_COMPONENT;if(m===Mn)return b.DEPTH_STENCIL;if(m===da)return w=n.get("EXT_sRGB"),w!==null?w.SRGB_ALPHA_EXT:null;if(m===Fs)return b.RED;if(m===Xi)return b.RED_INTEGER;if(m===Ci)return b.RG;if(m===ea)return b.RG_INTEGER;if(m===du)return b.RGBA_INTEGER;if(m===Qa||m===Wa||m===zi||m===Lc)if(v===Yi){if(w=n.get("WEBGL_compressed_texture_s3tc_srgb"),w===null)return null;if(m===Qa)return w.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(m===Wa)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(m===zi)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(m===Lc)return w.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(w=n.get("WEBGL_compressed_texture_s3tc"),w===null)return null;if(m===Qa)return w.COMPRESSED_RGB_S3TC_DXT1_EXT;if(m===Wa)return w.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(m===zi)return w.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(m===Lc)return w.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(m===Ed||m===Sd||m===Cd||m===tf){if(w=n.get("WEBGL_compressed_texture_pvrtc"),w===null)return null;if(m===Ed)return w.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(m===Sd)return w.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(m===Cd)return w.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(m===tf)return w.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(m===_m)return w=n.get("WEBGL_compressed_texture_etc1"),w!==null?w.COMPRESSED_RGB_ETC1_WEBGL:null;if(m===Br||m===gr){if(w=n.get("WEBGL_compressed_texture_etc"),w===null)return null;if(m===Br)return v===Yi?w.COMPRESSED_SRGB8_ETC2:w.COMPRESSED_RGB8_ETC2;if(m===gr)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:w.COMPRESSED_RGBA8_ETC2_EAC}if(m===Xa||m===Cs||m===jo||m===Xn||m===Mi||m===es||m===kc||m===Yl||m===rf||m===Kl||m===On||m===pu||m===fu||m===nf){if(w=n.get("WEBGL_compressed_texture_astc"),w===null)return null;if(m===Xa)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:w.COMPRESSED_RGBA_ASTC_4x4_KHR;if(m===Cs)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:w.COMPRESSED_RGBA_ASTC_5x4_KHR;if(m===jo)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:w.COMPRESSED_RGBA_ASTC_5x5_KHR;if(m===Xn)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:w.COMPRESSED_RGBA_ASTC_6x5_KHR;if(m===Mi)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:w.COMPRESSED_RGBA_ASTC_6x6_KHR;if(m===es)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:w.COMPRESSED_RGBA_ASTC_8x5_KHR;if(m===kc)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:w.COMPRESSED_RGBA_ASTC_8x6_KHR;if(m===Yl)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:w.COMPRESSED_RGBA_ASTC_8x8_KHR;if(m===rf)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:w.COMPRESSED_RGBA_ASTC_10x5_KHR;if(m===Kl)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:w.COMPRESSED_RGBA_ASTC_10x6_KHR;if(m===On)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:w.COMPRESSED_RGBA_ASTC_10x8_KHR;if(m===pu)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:w.COMPRESSED_RGBA_ASTC_10x10_KHR;if(m===fu)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:w.COMPRESSED_RGBA_ASTC_12x10_KHR;if(m===nf)return v===Yi?w.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:w.COMPRESSED_RGBA_ASTC_12x12_KHR}if(m===ha){if(w=n.get("EXT_texture_compression_bptc"),w===null)return null;if(m===ha)return v===Yi?w.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:w.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(m===Si||m===Zl||m===qa||m===sf){if(w=n.get("EXT_texture_compression_rgtc"),w===null)return null;if(m===ha)return w.COMPRESSED_RED_RGTC1_EXT;if(m===Zl)return w.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(m===qa)return w.COMPRESSED_RED_GREEN_RGTC2_EXT;if(m===sf)return w.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return m===Wn?d?b.UNSIGNED_INT_24_8:(w=n.get("WEBGL_depth_texture"),w!==null?w.UNSIGNED_INT_24_8_WEBGL:null):b[m]!==void 0?b[m]:null}}}class Eo extends vn{constructor(n=[]){super(),this.isArrayCamera=!0,this.cameras=n}}class ws extends Nr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const oE={type:"move"};class hy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ws,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ws,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Se,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Se),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ws,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Se,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Se),this._grip}dispatchEvent(n){return this._targetRay!==null&&this._targetRay.dispatchEvent(n),this._grip!==null&&this._grip.dispatchEvent(n),this._hand!==null&&this._hand.dispatchEvent(n),this}connect(n){if(n&&n.hand){const c=this._hand;if(c)for(const d of n.hand.values())this._getHandJoint(c,d)}return this.dispatchEvent({type:"connected",data:n}),this}disconnect(n){return this.dispatchEvent({type:"disconnected",data:n}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(n,c,d){let m=null,v=null,w=null;const C=this._targetRay,P=this._grip,D=this._hand;if(n&&c.session.visibilityState!=="visible-blurred"){if(D&&n.hand){w=!0;for(const W of n.hand.values()){const Q=c.getJointPose(W,d),$=this._getHandJoint(D,W);Q!==null&&($.matrix.fromArray(Q.transform.matrix),$.matrix.decompose($.position,$.rotation,$.scale),$.matrixWorldNeedsUpdate=!0,$.jointRadius=Q.radius),$.visible=Q!==null}const B=D.joints["index-finger-tip"],j=D.joints["thumb-tip"],F=B.position.distanceTo(j.position),z=.02,G=.005;D.inputState.pinching&&F>z+G?(D.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!D.inputState.pinching&&F<=z-G&&(D.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else P!==null&&n.gripSpace&&(v=c.getPose(n.gripSpace,d),v!==null&&(P.matrix.fromArray(v.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,v.linearVelocity?(P.hasLinearVelocity=!0,P.linearVelocity.copy(v.linearVelocity)):P.hasLinearVelocity=!1,v.angularVelocity?(P.hasAngularVelocity=!0,P.angularVelocity.copy(v.angularVelocity)):P.hasAngularVelocity=!1));C!==null&&(m=c.getPose(n.targetRaySpace,d),m===null&&v!==null&&(m=v),m!==null&&(C.matrix.fromArray(m.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,m.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(m.linearVelocity)):C.hasLinearVelocity=!1,m.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(m.angularVelocity)):C.hasAngularVelocity=!1,this.dispatchEvent(oE)))}return C!==null&&(C.visible=m!==null),P!==null&&(P.visible=v!==null),D!==null&&(D.visible=w!==null),this}_getHandJoint(n,c){if(n.joints[c.jointName]===void 0){const d=new ws;d.matrixAutoUpdate=!1,d.visible=!1,n.joints[c.jointName]=d,n.add(d)}return n.joints[c.jointName]}}class np extends xr{constructor(n,c,d,m,v,w,C,P,D,B){if((B=B!==void 0?B:ai)!==ai&&B!==Mn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");d===void 0&&B===ai&&(d=Fo),d===void 0&&B===Mn&&(d=Wn),super(null,m,v,w,C,P,B,d,D),this.isDepthTexture=!0,this.image={width:n,height:c},this.magFilter=C!==void 0?C:dn,this.minFilter=P!==void 0?P:dn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(n){return super.copy(n),this.compareFunction=n.compareFunction,this}toJSON(n){const c=super.toJSON(n);return this.compareFunction!==null&&(c.compareFunction=this.compareFunction),c}}class Qm extends sr{constructor(n,c){super();const d=this;let m=null,v=1,w=null,C="local-floor",P=1,D=null,B=null,j=null,F=null,z=null,G=null;const W=c.getContextAttributes();let Q=null,$=null;const Y=[],q=[];let be=null;const we=new vn;we.layers.enable(1),we.viewport=new Tr;const me=new vn;me.layers.enable(2),me.viewport=new Tr;const Be=[we,me],Ze=new Eo;Ze.layers.enable(1),Ze.layers.enable(2);let et=null,ft=null;function Le(Pt){const Nt=q.indexOf(Pt.inputSource);if(Nt===-1)return;const ci=Y[Nt];ci!==void 0&&(ci.update(Pt.inputSource,Pt.frame,D||w),ci.dispatchEvent({type:Pt.type,data:Pt.inputSource}))}function Gt(){m.removeEventListener("select",Le),m.removeEventListener("selectstart",Le),m.removeEventListener("selectend",Le),m.removeEventListener("squeeze",Le),m.removeEventListener("squeezestart",Le),m.removeEventListener("squeezeend",Le),m.removeEventListener("end",Gt),m.removeEventListener("inputsourceschange",Ht);for(let Pt=0;Pt<Y.length;Pt++){const Nt=q[Pt];Nt!==null&&(q[Pt]=null,Y[Pt].disconnect(Nt))}et=null,ft=null,n.setRenderTarget(Q),z=null,F=null,j=null,m=null,$=null,oi.stop(),d.isPresenting=!1,d.dispatchEvent({type:"sessionend"})}function Ht(Pt){for(let Nt=0;Nt<Pt.removed.length;Nt++){const ci=Pt.removed[Nt],pi=q.indexOf(ci);pi>=0&&(q[pi]=null,Y[pi].disconnect(ci))}for(let Nt=0;Nt<Pt.added.length;Nt++){const ci=Pt.added[Nt];let pi=q.indexOf(ci);if(pi===-1){for(let yi=0;yi<Y.length;yi++){if(yi>=q.length){q.push(ci),pi=yi;break}if(q[yi]===null){q[yi]=ci,pi=yi;break}}if(pi===-1)break}const $i=Y[pi];$i&&$i.connect(ci)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(Pt){be=Pt},this.getController=function(Pt){let Nt=Y[Pt];return Nt===void 0&&(Nt=new hy,Y[Pt]=Nt),Nt.getTargetRaySpace()},this.getControllerGrip=function(Pt){let Nt=Y[Pt];return Nt===void 0&&(Nt=new hy,Y[Pt]=Nt),Nt.getGripSpace()},this.getHand=function(Pt){let Nt=Y[Pt];return Nt===void 0&&(Nt=new hy,Y[Pt]=Nt),Nt.getHandSpace()},this.setFramebufferScaleFactor=function(Pt){v=Pt,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Pt){C=Pt,d.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return D||w},this.setReferenceSpace=function(Pt){D=Pt},this.getBaseLayer=function(){return F!==null?F:z},this.getBinding=function(){return j},this.getFrame=function(){return G},this.getSession=function(){return m},this.setSession=async function(Pt){if(m=Pt,m!==null){if(Q=n.getRenderTarget(),m.addEventListener("select",Le),m.addEventListener("selectstart",Le),m.addEventListener("selectend",Le),m.addEventListener("squeeze",Le),m.addEventListener("squeezestart",Le),m.addEventListener("squeezeend",Le),m.addEventListener("end",Gt),m.addEventListener("inputsourceschange",Ht),W.xrCompatible!==!0&&await c.makeXRCompatible(),m.renderState.layers===void 0||n.capabilities.isWebGL2===!1){const Nt={antialias:m.renderState.layers!==void 0||W.antialias,alpha:!0,depth:W.depth,stencil:W.stencil,framebufferScaleFactor:v};z=new XRWebGLLayer(m,c,Nt),m.updateRenderState({baseLayer:z}),$=new zs(z.framebufferWidth,z.framebufferHeight,{format:en,type:yl,colorSpace:n.outputColorSpace,stencilBuffer:W.stencil})}else{let Nt=null,ci=null,pi=null;W.depth&&(pi=W.stencil?c.DEPTH24_STENCIL8:c.DEPTH_COMPONENT24,Nt=W.stencil?Mn:ai,ci=W.stencil?Wn:Fo);const $i={colorFormat:c.RGBA8,depthFormat:pi,scaleFactor:v};j=new XRWebGLBinding(m,c),F=j.createProjectionLayer($i),m.updateRenderState({layers:[F]}),$=new zs(F.textureWidth,F.textureHeight,{format:en,type:yl,depthTexture:new np(F.textureWidth,F.textureHeight,ci,void 0,void 0,void 0,void 0,void 0,void 0,Nt),stencilBuffer:W.stencil,colorSpace:n.outputColorSpace,samples:W.antialias?4:0}),n.properties.get($).__ignoreDepthValues=F.ignoreDepthValues}$.isXRRenderTarget=!0,this.setFoveation(P),D=null,w=await m.requestReferenceSpace(C),oi.setContext(m),oi.start(),d.isPresenting=!0,d.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(m!==null)return m.environmentBlendMode};const ri=new Se,hi=new Se;function ei(Pt,Nt){Nt===null?Pt.matrixWorld.copy(Pt.matrix):Pt.matrixWorld.multiplyMatrices(Nt.matrixWorld,Pt.matrix),Pt.matrixWorldInverse.copy(Pt.matrixWorld).invert()}this.updateCameraXR=function(Pt){if(m===null)return Pt;be&&(Pt=be),Ze.near=me.near=we.near=Pt.near,Ze.far=me.far=we.far=Pt.far,et===Ze.near&&ft===Ze.far||(m.updateRenderState({depthNear:Ze.near,depthFar:Ze.far}),et=Ze.near,ft=Ze.far);const Nt=Pt.parent,ci=Ze.cameras;ei(Ze,Nt);for(let pi=0;pi<ci.length;pi++)ei(ci[pi],Nt);return ci.length===2?function(pi,$i,yi){ri.setFromMatrixPosition($i.matrixWorld),hi.setFromMatrixPosition(yi.matrixWorld);const qi=ri.distanceTo(hi),Ri=$i.projectionMatrix.elements,De=yi.projectionMatrix.elements,Me=Ri[14]/(Ri[10]-1),Ge=Ri[14]/(Ri[10]+1),ht=(Ri[9]+1)/Ri[5],Oe=(Ri[9]-1)/Ri[5],ye=(Ri[8]-1)/Ri[0],ke=(De[8]+1)/De[0],ze=Me*ye,rt=Me*ke,Et=qi/(-ye+ke),Vt=Et*-ye;$i.matrixWorld.decompose(pi.position,pi.quaternion,pi.scale),pi.translateX(Vt),pi.translateZ(Et),pi.matrixWorld.compose(pi.position,pi.quaternion,pi.scale),pi.matrixWorldInverse.copy(pi.matrixWorld).invert();const Yt=Me+Et,Fi=Ge+Et,Ki=ze-Vt,Ti=rt+(qi-Vt),tr=ht*Ge/Fi*Yt,dr=Oe*Ge/Fi*Yt;pi.projectionMatrix.makePerspective(Ki,Ti,tr,dr,Yt,Fi),pi.projectionMatrixInverse.copy(pi.projectionMatrix).invert()}(Ze,we,me):Ze.projectionMatrix.copy(we.projectionMatrix),be&&function(pi,$i){const yi=be;$i===null?yi.matrix.copy(pi.matrixWorld):(yi.matrix.copy($i.matrixWorld),yi.matrix.invert(),yi.matrix.multiply(pi.matrixWorld)),yi.matrix.decompose(yi.position,yi.quaternion,yi.scale),yi.updateMatrixWorld(!0);const qi=yi.children;for(let Ri=0,De=qi.length;Ri<De;Ri++)qi[Ri].updateMatrixWorld(!0);yi.projectionMatrix.copy(pi.projectionMatrix),yi.projectionMatrixInverse.copy(pi.projectionMatrixInverse),yi.isPerspectiveCamera&&(yi.fov=2*ec*Math.atan(1/yi.projectionMatrix.elements[5]),yi.zoom=1)}(Ze,Nt),Ze},this.getFoveation=function(){if(F!==null||z!==null)return P},this.setFoveation=function(Pt){P=Pt,F!==null&&(F.fixedFoveation=Pt),z!==null&&z.fixedFoveation!==void 0&&(z.fixedFoveation=Pt)};let Xt=null;this.onPreAnimationFrameCallback=null;const oi=new Wd;oi.setAnimationLoop(function(Pt,Nt){if(d.onPreAnimationFrameCallback&&d.onPreAnimationFrameCallback(Pt,Nt),B=Nt.getViewerPose(D||w),G=Nt,B!==null){const ci=B.views;z!==null&&(n.setRenderTargetFramebuffer($,z.framebuffer),n.setRenderTarget($));let pi=!1;ci.length!==Ze.cameras.length&&(Ze.cameras.length=0,pi=!0);for(let $i=0;$i<ci.length;$i++){const yi=ci[$i];let qi=null;if(z!==null)qi=z.getViewport(yi);else{const De=j.getViewSubImage(F,yi);qi=De.viewport,$i===0&&(n.setRenderTargetTextures($,De.colorTexture,F.ignoreDepthValues?void 0:De.depthStencilTexture),n.setRenderTarget($))}let Ri=Be[$i];Ri===void 0&&(Ri=new vn,Ri.layers.enable($i),Ri.viewport=new Tr,Be[$i]=Ri),Ri.matrix.fromArray(yi.transform.matrix),Ri.matrix.decompose(Ri.position,Ri.quaternion,Ri.scale),Ri.projectionMatrix.fromArray(yi.projectionMatrix),Ri.projectionMatrixInverse.copy(Ri.projectionMatrix).invert(),Ri.viewport.set(qi.x,qi.y,qi.width,qi.height),$i===0&&(Ze.matrix.copy(Ri.matrix),Ze.matrix.decompose(Ze.position,Ze.quaternion,Ze.scale)),pi===!0&&Ze.cameras.push(Ri)}}for(let ci=0;ci<Y.length;ci++){const pi=q[ci],$i=Y[ci];pi!==null&&$i!==void 0&&$i.update(pi,Nt,D||w)}Xt&&Xt(Pt,Nt),Nt.detectedPlanes&&d.dispatchEvent({type:"planesdetected",data:Nt}),G=null}),this.setAnimationLoop=function(Pt){Xt=Pt},this.dispose=function(){}}}function pc(b,n){function c(m,v){m.matrixAutoUpdate===!0&&m.updateMatrix(),v.value.copy(m.matrix)}function d(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map,c(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,c(v.alphaMap,m.alphaMapTransform)),v.bumpMap&&(m.bumpMap.value=v.bumpMap,c(v.bumpMap,m.bumpMapTransform),m.bumpScale.value=v.bumpScale,v.side===Ce&&(m.bumpScale.value*=-1)),v.normalMap&&(m.normalMap.value=v.normalMap,c(v.normalMap,m.normalMapTransform),m.normalScale.value.copy(v.normalScale),v.side===Ce&&m.normalScale.value.negate()),v.displacementMap&&(m.displacementMap.value=v.displacementMap,c(v.displacementMap,m.displacementMapTransform),m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap,c(v.emissiveMap,m.emissiveMapTransform)),v.specularMap&&(m.specularMap.value=v.specularMap,c(v.specularMap,m.specularMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const w=n.get(v).envMap;if(w){m.envMap.value=w;const C=v.envMap||n.get(v).environment||w;m.envMapRotation.value=C?C.rotation:0,m.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio}if(v.lightMap){m.lightMap.value=v.lightMap;const C=b.useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*C,c(v.lightMap,m.lightMapTransform)}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity,c(v.aoMap,m.aoMapTransform))}return{refreshTransformUniform:c,refreshFogUniforms:function(m,v){v.color.getRGB(m.fogColor.value,to(b)),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)},refreshMaterialUniforms:function(m,v,w,C,P){v.isMeshBasicMaterial||v.isMeshLambertMaterial?d(m,v):v.isMeshToonMaterial?(d(m,v),function(D,B){B.gradientMap&&(D.gradientMap.value=B.gradientMap)}(m,v)):v.isMeshPhongMaterial?(d(m,v),function(D,B){D.specular.value.copy(B.specular),D.shininess.value=Math.max(B.shininess,1e-4)}(m,v)):v.isMeshStandardMaterial?(d(m,v),function(D,B){D.metalness.value=B.metalness,B.metalnessMap&&(D.metalnessMap.value=B.metalnessMap,c(B.metalnessMap,D.metalnessMapTransform)),D.roughness.value=B.roughness,B.roughnessMap&&(D.roughnessMap.value=B.roughnessMap,c(B.roughnessMap,D.roughnessMapTransform)),n.get(B).envMap&&(D.envMapIntensity.value=B.envMapIntensity)}(m,v),v.isMeshPhysicalMaterial&&function(D,B,j){D.ior.value=B.ior,B.sheen>0&&(D.sheenColor.value.copy(B.sheenColor).multiplyScalar(B.sheen),D.sheenRoughness.value=B.sheenRoughness,B.sheenColorMap&&(D.sheenColorMap.value=B.sheenColorMap,c(B.sheenColorMap,D.sheenColorMapTransform)),B.sheenRoughnessMap&&(D.sheenRoughnessMap.value=B.sheenRoughnessMap,c(B.sheenRoughnessMap,D.sheenRoughnessMapTransform))),B.clearcoat>0&&(D.clearcoat.value=B.clearcoat,D.clearcoatRoughness.value=B.clearcoatRoughness,B.clearcoatMap&&(D.clearcoatMap.value=B.clearcoatMap,c(B.clearcoatMap,D.clearcoatMapTransform)),B.clearcoatRoughnessMap&&(D.clearcoatRoughnessMap.value=B.clearcoatRoughnessMap,c(B.clearcoatRoughnessMap,D.clearcoatRoughnessMapTransform)),B.clearcoatNormalMap&&(D.clearcoatNormalMap.value=B.clearcoatNormalMap,c(B.clearcoatNormalMap,D.clearcoatNormalMapTransform),D.clearcoatNormalScale.value.copy(B.clearcoatNormalScale),B.side===Ce&&D.clearcoatNormalScale.value.negate())),B.iridescence>0&&(D.iridescence.value=B.iridescence,D.iridescenceIOR.value=B.iridescenceIOR,D.iridescenceThicknessMinimum.value=B.iridescenceThicknessRange[0],D.iridescenceThicknessMaximum.value=B.iridescenceThicknessRange[1],B.iridescenceMap&&(D.iridescenceMap.value=B.iridescenceMap,c(B.iridescenceMap,D.iridescenceMapTransform)),B.iridescenceThicknessMap&&(D.iridescenceThicknessMap.value=B.iridescenceThicknessMap,c(B.iridescenceThicknessMap,D.iridescenceThicknessMapTransform))),B.transmission>0&&(D.transmission.value=B.transmission,D.transmissionSamplerMap.value=j.texture,D.transmissionSamplerSize.value.set(j.width,j.height),B.transmissionMap&&(D.transmissionMap.value=B.transmissionMap,c(B.transmissionMap,D.transmissionMapTransform)),D.thickness.value=B.thickness,B.thicknessMap&&(D.thicknessMap.value=B.thicknessMap,c(B.thicknessMap,D.thicknessMapTransform)),D.attenuationDistance.value=B.attenuationDistance,D.attenuationColor.value.copy(B.attenuationColor)),B.anisotropy>0&&(D.anisotropyVector.value.set(B.anisotropy*Math.cos(B.anisotropyRotation),B.anisotropy*Math.sin(B.anisotropyRotation)),B.anisotropyMap&&(D.anisotropyMap.value=B.anisotropyMap,c(B.anisotropyMap,D.anisotropyMapTransform))),D.specularIntensity.value=B.specularIntensity,D.specularColor.value.copy(B.specularColor),B.specularColorMap&&(D.specularColorMap.value=B.specularColorMap,c(B.specularColorMap,D.specularColorMapTransform)),B.specularIntensityMap&&(D.specularIntensityMap.value=B.specularIntensityMap,c(B.specularIntensityMap,D.specularIntensityMapTransform))}(m,v,P)):v.isMeshMatcapMaterial?(d(m,v),function(D,B){B.matcap&&(D.matcap.value=B.matcap)}(m,v)):v.isMeshDepthMaterial?d(m,v):v.isMeshDistanceMaterial?(d(m,v),function(D,B){const j=n.get(B).light;D.referencePosition.value.setFromMatrixPosition(j.matrixWorld),D.nearDistance.value=j.shadow.camera.near,D.farDistance.value=j.shadow.camera.far}(m,v)):v.isMeshNormalMaterial?d(m,v):v.isLineBasicMaterial?(function(D,B){D.diffuse.value.copy(B.color),D.opacity.value=B.opacity,B.map&&(D.map.value=B.map,c(B.map,D.mapTransform))}(m,v),v.isLineDashedMaterial&&function(D,B){D.dashSize.value=B.dashSize,D.totalSize.value=B.dashSize+B.gapSize,D.scale.value=B.scale}(m,v)):v.isPointsMaterial?function(D,B,j,F){D.diffuse.value.copy(B.color),D.opacity.value=B.opacity,D.size.value=B.size*j,D.scale.value=.5*F,B.map&&(D.map.value=B.map,c(B.map,D.uvTransform)),B.alphaMap&&(D.alphaMap.value=B.alphaMap,c(B.alphaMap,D.alphaMapTransform)),B.alphaTest>0&&(D.alphaTest.value=B.alphaTest)}(m,v,w,C):v.isSpriteMaterial?function(D,B){D.diffuse.value.copy(B.color),D.opacity.value=B.opacity,D.rotation.value=B.rotation,B.map&&(D.map.value=B.map,c(B.map,D.mapTransform)),B.alphaMap&&(D.alphaMap.value=B.alphaMap,c(B.alphaMap,D.alphaMapTransform)),B.alphaTest>0&&(D.alphaTest.value=B.alphaTest)}(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.transmission!==void 0&&(m.transmission&&(m.transmission.value=v.transmission),m.transmissionSamplerMap&&P&&(m.transmissionSamplerMap.value=P?P.texture:null),m.transmissionSamplerSize&&P&&m.transmissionSamplerSize.value.set(P.width,P.height)),v.uniformsNeedUpdate=!1)}}}function Rf(b,n,c,d){let m={},v={},w=[];const C=c.isWebGL2?b.getParameter(b.MAX_UNIFORM_BUFFER_BINDINGS):0;function P(j,F,z){const G=j.value;if(z[F]===void 0){if(typeof G=="number")z[F]=G;else{const W=Array.isArray(G)?G:[G],Q=[];for(let $=0;$<W.length;$++)Q.push(W[$].clone());z[F]=Q}return!0}if(typeof G=="number"){if(z[F]!==G)return z[F]=G,!0}else{const W=Array.isArray(z[F])?z[F]:[z[F]],Q=Array.isArray(G)?G:[G];for(let $=0;$<W.length;$++){const Y=W[$];if(Y.equals(Q[$])===!1)return Y.copy(Q[$]),!0}}return!1}function D(j){const F={boundary:0,storage:0};return typeof j=="number"?(F.boundary=4,F.storage=4):j.isVector2?(F.boundary=8,F.storage=8):j.isVector3||j.isColor?(F.boundary=16,F.storage=12):j.isVector4?(F.boundary=16,F.storage=16):j.isMatrix3?(F.boundary=48,F.storage=48):j.isMatrix4?(F.boundary=64,F.storage=64):j.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",j),F}function B(j){const F=j.target;F.removeEventListener("dispose",B);const z=w.indexOf(F.__bindingPointIndex);w.splice(z,1),b.deleteBuffer(m[F.id]),delete m[F.id],delete v[F.id]}return{bind:function(j,F){const z=F.program;d.uniformBlockBinding(j,z)},update:function(j,F){let z=m[j.id];z===void 0&&(function(Q){const $=Q.uniforms;let Y=0,q=0;for(let be=0,we=$.length;be<we;be++){const me=$[be],Be={boundary:0,storage:0},Ze=Array.isArray(me.value)?me.value:[me.value];for(let et=0,ft=Ze.length;et<ft;et++){const Le=D(Ze[et]);Be.boundary+=Le.boundary,Be.storage+=Le.storage}me.__data=new Float32Array(Be.storage/Float32Array.BYTES_PER_ELEMENT),me.__offset=Y,be>0&&(q=Y%16,q!==0&&16-q-Be.boundary<0&&(Y+=16-q,me.__offset=Y)),Y+=Be.storage}q=Y%16,q>0&&(Y+=16-q),Q.__size=Y,Q.__cache={}}(j),z=function(Q){const $=function(){for(let we=0;we<C;we++)if(w.indexOf(we)===-1)return w.push(we),we;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Q.__bindingPointIndex=$;const Y=b.createBuffer(),q=Q.__size,be=Q.usage;return b.bindBuffer(b.UNIFORM_BUFFER,Y),b.bufferData(b.UNIFORM_BUFFER,q,be),b.bindBuffer(b.UNIFORM_BUFFER,null),b.bindBufferBase(b.UNIFORM_BUFFER,$,Y),Y}(j),m[j.id]=z,j.addEventListener("dispose",B));const G=F.program;d.updateUBOMapping(j,G);const W=n.render.frame;v[j.id]!==W&&(function(Q){const $=m[Q.id],Y=Q.uniforms,q=Q.__cache;b.bindBuffer(b.UNIFORM_BUFFER,$);for(let be=0,we=Y.length;be<we;be++){const me=Y[be];if(P(me,be,q)===!0){const Be=me.__offset,Ze=Array.isArray(me.value)?me.value:[me.value];let et=0;for(let ft=0;ft<Ze.length;ft++){const Le=Ze[ft],Gt=D(Le);typeof Le=="number"?(me.__data[0]=Le,b.bufferSubData(b.UNIFORM_BUFFER,Be+et,me.__data)):Le.isMatrix3?(me.__data[0]=Le.elements[0],me.__data[1]=Le.elements[1],me.__data[2]=Le.elements[2],me.__data[3]=Le.elements[0],me.__data[4]=Le.elements[3],me.__data[5]=Le.elements[4],me.__data[6]=Le.elements[5],me.__data[7]=Le.elements[0],me.__data[8]=Le.elements[6],me.__data[9]=Le.elements[7],me.__data[10]=Le.elements[8],me.__data[11]=Le.elements[0]):(Le.toArray(me.__data,et),et+=Gt.storage/Float32Array.BYTES_PER_ELEMENT)}b.bufferSubData(b.UNIFORM_BUFFER,Be,me.__data)}}b.bindBuffer(b.UNIFORM_BUFFER,null)}(j),v[j.id]=W)},dispose:function(){for(const j in m)b.deleteBuffer(m[j]);w=[],m={},v={}}}}function sp(){const b=tc("canvas");return b.style.display="block",b}class ro{constructor(n={}){const{canvas:c=sp(),context:d=null,depth:m=!0,stencil:v=!0,alpha:w=!1,antialias:C=!1,premultipliedAlpha:P=!0,preserveDrawingBuffer:D=!1,powerPreference:B="default",failIfMajorPerformanceCaveat:j=!1}=n;let F;this.isWebGLRenderer=!0,F=d!==null?d.getContextAttributes().alpha:w;const z=new Uint32Array(4),G=new Int32Array(4);let W=null,Q=null;const $=[],Y=[];this.domElement=c,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Yi,this.useLegacyLights=!0,this.toneMapping=Vr,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const q=this;let be=!1,we=0,me=0,Be=null,Ze=-1,et=null;const ft=new Tr,Le=new Tr;let Gt=null;const Ht=new xi(0);let ri=0,hi=c.width,ei=c.height,Xt=1,oi=null,Pt=null;const Nt=new Tr(0,0,hi,ei),ci=new Tr(0,0,hi,ei);let pi=!1;const $i=new Ef;let yi=!1,qi=!1,Ri=null;const De=new or,Me=new Jt,Ge=new Se,ht={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Oe(){return Be===null?Xt:1}let ye,ke,ze,rt,Et,Vt,Yt,Fi,Ki,Ti,tr,dr,Jr,nr,qr,os,Zi,Fr,ln,Cg,em,sl,al,Ju,Dt=d;function bp(Pe,Lt){for(let Kt=0;Kt<Pe.length;Kt++){const qt=Pe[Kt],ii=c.getContext(qt,Lt);if(ii!==null)return ii}return null}try{const Pe={alpha:!0,depth:m,stencil:v,antialias:C,premultipliedAlpha:P,preserveDrawingBuffer:D,powerPreference:B,failIfMajorPerformanceCaveat:j};if("setAttribute"in c&&c.setAttribute("data-engine",`three.js r${Ke}`),c.addEventListener("webglcontextlost",wp,!1),c.addEventListener("webglcontextrestored",k0,!1),c.addEventListener("webglcontextcreationerror",eb,!1),Dt===null){const Lt=["webgl2","webgl","experimental-webgl"];if(q.isWebGL1Renderer===!0&&Lt.shift(),Dt=bp(Lt,Pe),Dt===null)throw bp(Lt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Dt instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Dt.getShaderPrecisionFormat===void 0&&(Dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Pe){throw console.error("THREE.WebGLRenderer: "+Pe.message),Pe}function Ap(){ye=new _A(Dt),ke=new km(Dt,ye,n),ye.init(ke),sl=new uy(Dt,ye,ke),ze=new aE(Dt,ye,ke),rt=new Q1(Dt),Et=new rE,Vt=new cy(Dt,ye,ze,Et,ke,sl,rt),Yt=new Ru(q),Fi=new Ih(q),Ki=new Om(Dt,ke),al=new vA(Dt,ye,Ki,ke),Ti=new Zo(Dt,Ki,rt,al),tr=new bA(Dt,Ti,Ki,rt),ln=new yA(Dt,ke,Vt),os=new Xd(Et),dr=new sy(q,Yt,Fi,ye,ke,al,os),Jr=new pc(q,Et),nr=new LA,qr=new dc(ye,ke),Fr=new Lm(q,Yt,Fi,ze,tr,F,P),Zi=new sE(q,tr,ke),Ju=new Rf(Dt,rt,ke,ze),Cg=new G_(Dt,ye,rt,ke),em=new Q_(Dt,ye,rt,ke),rt.programs=dr.programs,q.capabilities=ke,q.extensions=ye,q.properties=Et,q.renderLists=nr,q.shadowMap=Zi,q.state=ze,q.info=rt,q.background=Fr,q.cubemaps=Yt,q.cubeuvmaps=Fi,q.materials=Jr}Ap();const Bs=new Qm(q,Dt);function wp(Pe){Pe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),be=!0,q.onContextLost(Pe)}function k0(){console.log("THREE.WebGLRenderer: Context Restored."),be=!1;const Pe=q.info?q.info.autoReset:void 0,Lt=Zi.enabled,Kt=Zi.autoUpdate,qt=Zi.needsUpdate,ii=Zi.type;Ap(),q.info&&Pe!==void 0&&(q.info.autoReset=Pe),Zi.enabled=Lt,Zi.autoUpdate=Kt,Zi.needsUpdate=qt,Zi.type=ii,q.onContextRestore&&q.onContextRestore(),console.log("restored")}function eb(Pe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Pe.statusMessage),q.onContextCreationError(Pe)}function U0(Pe){const Lt=Pe.target;Lt.removeEventListener("dispose",U0),function(Kt){(function(qt){const ii=Et.get(qt).programs;ii!==void 0&&(ii.forEach(function(Ei){dr.releaseProgram(Ei)}),qt.isShaderMaterial&&dr.releaseShaderCache(qt))})(Kt),Et.remove(Kt)}(Lt)}this.xr=Bs,this.getContext=function(){return Dt},this.getContextAttributes=function(){return Dt.getContextAttributes()},this.forceContextLoss=function(){const Pe=ye.get("WEBGL_lose_context");Pe&&Pe.loseContext()},this.forceContextRestore=function(){const Pe=ye.get("WEBGL_lose_context");Pe&&Pe.restoreContext()},this.getPixelRatio=function(){return Xt},this.setPixelRatio=function(Pe){Pe!==void 0&&(Xt=Pe,this.setSize(hi,ei,!1))},this.getSize=function(Pe){return Pe.set(hi,ei)},this.setSize=function(Pe,Lt,Kt=!0){Bs.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(hi=Pe,ei=Lt,c.width=Math.floor(Pe*Xt),c.height=Math.floor(Lt*Xt),Kt===!0&&(c.style.width=Pe+"px",c.style.height=Lt+"px"),this.setViewport(0,0,Pe,Lt))},this.getDrawingBufferSize=function(Pe){return Pe.set(hi*Xt,ei*Xt).floor()},this.setDrawingBufferSize=function(Pe,Lt,Kt){hi=Pe,ei=Lt,Xt=Kt,c.width=Math.floor(Pe*Kt),c.height=Math.floor(Lt*Kt),this.setViewport(0,0,Pe,Lt)},this.getCurrentViewport=function(Pe){return Pe.copy(ft)},this.getViewport=function(Pe){return Pe.copy(Nt)},this.setViewport=function(Pe,Lt,Kt,qt){Pe.isVector4?Nt.set(Pe.x,Pe.y,Pe.z,Pe.w):Nt.set(Pe,Lt,Kt,qt),ze.viewport(ft.copy(Nt).multiplyScalar(Xt).floor())},this.getScissor=function(Pe){return Pe.copy(ci)},this.setScissor=function(Pe,Lt,Kt,qt){Pe.isVector4?ci.set(Pe.x,Pe.y,Pe.z,Pe.w):ci.set(Pe,Lt,Kt,qt),ze.scissor(Le.copy(ci).multiplyScalar(Xt).floor())},this.getScissorTest=function(){return pi},this.setScissorTest=function(Pe){ze.setScissorTest(pi=Pe)},this.setOpaqueSort=function(Pe){oi=Pe},this.setTransparentSort=function(Pe){Pt=Pe},this.getClearColor=function(Pe){return Pe.copy(Fr.getClearColor())},this.setClearColor=function(){Fr.setClearColor.apply(Fr,arguments)},this.getClearAlpha=function(){return Fr.getClearAlpha()},this.setClearAlpha=function(){Fr.setClearAlpha.apply(Fr,arguments)},this.clear=function(Pe=!0,Lt=!0,Kt=!0){let qt=0;if(Pe){let ii=!1;if(Be!==null){const Ei=Be.texture.format;ii=Ei===du||Ei===ea||Ei===Xi}if(ii){const Ei=Be.texture.type,Cr=Ei===yl||Ei===Fo||Ei===hu||Ei===Wn||Ei===hh||Ei===ef,ir=Fr.getClearColor(),wr=Fr.getClearAlpha(),jr=ir.r,Rr=ir.g,mr=ir.b,ls=Et.get(Be).__webglFramebuffer;Cr?(z[0]=jr,z[1]=Rr,z[2]=mr,z[3]=wr,Dt.clearBufferuiv(Dt.COLOR,ls,z)):(G[0]=jr,G[1]=Rr,G[2]=mr,G[3]=wr,Dt.clearBufferiv(Dt.COLOR,ls,G))}else qt|=Dt.COLOR_BUFFER_BIT}Lt&&(qt|=Dt.DEPTH_BUFFER_BIT),Kt&&(qt|=Dt.STENCIL_BUFFER_BIT),Dt.clear(qt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){c.removeEventListener("webglcontextlost",wp,!1),c.removeEventListener("webglcontextrestored",k0,!1),c.removeEventListener("webglcontextcreationerror",eb,!1),nr.dispose(),qr.dispose(),Et.dispose(),Yt.dispose(),Fi.dispose(),tr.dispose(),al.dispose(),Ju.dispose(),dr.dispose(),Bs.dispose(),Bs.removeEventListener("sessionstart",ib),Bs.removeEventListener("sessionend",N0),Ri&&(Ri.dispose(),Ri=null),su.stop()},this.renderBufferDirect=function(Pe,Lt,Kt,qt,ii,Ei){Lt===null&&(Lt=ht);const Cr=ii.isMesh&&ii.matrixWorld.determinant()<0,ir=function(Kn,Ws,Po,Vi,cs){Ws.isScene!==!0&&(Ws=ht),Vt.resetTextureUnits();const tm=Ws.fog,Cw=Vi.userData&&Vi.userData.envMapSlotKey&&Ws.textureSlots&&Ws.textureSlots[Vi.userData.envMapSlotKey]?Ws.textureSlots[Vi.userData.envMapSlotKey]:Vi.isMeshStandardMaterial?Ws.environment:null,Ep=Be===null?q.outputColorSpace:Be.isXRRenderTarget===!0||Be.texture.colorSpace&&Be.texture.colorSpace!==Yi?Be.texture.colorSpace:an,Tg=(Vi.isMeshStandardMaterial?Fi:Yt).get(Vi.envMap||Cw),F0=Vi.vertexColors===!0&&!!Po.attributes.color&&Po.attributes.color.itemSize===4,Mw=!!Po.attributes.tangent&&(!!Vi.normalMap||Vi.anisotropy>0),im=!!Po.morphAttributes.position,j0=!!Po.morphAttributes.normal,sb=!!Po.morphAttributes.color,Tw=Vi.toneMapped?q.toneMapping:Vr,z0=Po.morphAttributes.position||Po.morphAttributes.normal||Po.morphAttributes.color,Iw=z0!==void 0?z0.length:0,Or=Et.get(Vi),Pw=Q.state.lights;if(yi===!0&&(qi===!0||Kn!==et)){const Fa=Kn===et&&Vi.id===Ze;os.setState(Vi,Kn,Fa)}let $u=!1;Vi.version===Or.__version?Or.needsLights&&Or.lightsStateVersion!==Pw.state.version||Or.outputColorSpace!==Ep||cs.isInstancedMesh&&Or.instancing===!1?$u=!0:cs.isInstancedMesh||Or.instancing!==!0?cs.isSkinnedMesh&&Or.skinning===!1?$u=!0:cs.isSkinnedMesh||Or.skinning!==!0?Or.envMap!==Tg||Vi.fog===!0&&Or.fog!==tm?$u=!0:Or.numClippingPlanes===void 0||Or.numClippingPlanes===os.numPlanes&&Or.numIntersection===os.numIntersection?(Or.vertexAlphas!==F0||Or.vertexTangents!==Mw||Or.morphTargets!==im||Or.morphNormals!==j0||Or.morphColors!==sb||Or.toneMapping!==Tw||ke.isWebGL2===!0&&Or.morphTargetsCount!==Iw)&&($u=!0):$u=!0:$u=!0:$u=!0:($u=!0,Or.__version=Vi.version);let qh=Or.currentProgram;$u===!0&&(qh=Mg(Vi,Ws,cs));let Rw=!1,Ig=!1,ll=!1;const Na=qh.getUniforms(),Yh=Or.uniforms;if(ze.useProgram(qh.program)&&(Rw=!0,Ig=!0,ll=!0),Vi.id!==Ze&&(Ze=Vi.id,Ig=!0),Rw||et!==Kn){if(Na.setValue(Dt,"projectionMatrix",Kn.projectionMatrix),ke.logarithmicDepthBuffer&&Na.setValue(Dt,"logDepthBufFC",2/(Math.log(Kn.far+1)/Math.LN2)),et!==Kn&&(et=Kn,Ig=!0,ll=!0),Vi.isShaderMaterial||Vi.isMeshPhongMaterial||Vi.isMeshToonMaterial||Vi.isMeshStandardMaterial||Vi.envMap){const Fa=Na.map.cameraPosition;Fa!==void 0&&Fa.setValue(Dt,Ge.setFromMatrixPosition(Kn.matrixWorld))}(Vi.isMeshPhongMaterial||Vi.isMeshToonMaterial||Vi.isMeshLambertMaterial||Vi.isMeshBasicMaterial||Vi.isMeshStandardMaterial||Vi.isShaderMaterial)&&Na.setValue(Dt,"isOrthographic",Kn.isOrthographicCamera===!0),(Vi.isMeshPhongMaterial||Vi.isMeshToonMaterial||Vi.isMeshLambertMaterial||Vi.isMeshBasicMaterial||Vi.isMeshStandardMaterial||Vi.isShaderMaterial||Vi.isShadowMaterial||cs.isSkinnedMesh)&&Na.setValue(Dt,"viewMatrix",Kn.matrixWorldInverse)}if(cs.isSkinnedMesh){Na.setOptional(Dt,cs,"bindMatrix"),Na.setOptional(Dt,cs,"bindMatrixInverse");const Fa=cs.skeleton;Fa&&(ke.floatVertexTextures?(Fa.boneTexture===null&&Fa.computeBoneTexture(),Na.setValue(Dt,"boneTexture",Fa.boneTexture,Vt),Na.setValue(Dt,"boneTextureSize",Fa.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const V0=Po.morphAttributes;var au,cl;(V0.position!==void 0||V0.normal!==void 0||V0.color!==void 0&&ke.isWebGL2===!0)&&ln.update(cs,Po,qh),(Ig||Or.receiveShadow!==cs.receiveShadow)&&(Or.receiveShadow=cs.receiveShadow,Na.setValue(Dt,"receiveShadow",cs.receiveShadow)),Vi.isMeshGouraudMaterial&&Vi.envMap!==null&&(Yh.envMap.value=Tg,Yh.flipEnvMap.value=Tg.isCubeTexture&&Tg.isRenderTargetTexture===!1?-1:1),Ig&&(Na.setValue(Dt,"toneMappingExposure",q.toneMappingExposure),Or.needsLights&&(cl=ll,(au=Yh).ambientLightColor.needsUpdate=cl,au.lightProbe.needsUpdate=cl,au.directionalLights.needsUpdate=cl,au.directionalLightShadows.needsUpdate=cl,au.pointLights.needsUpdate=cl,au.pointLightShadows.needsUpdate=cl,au.spotLights.needsUpdate=cl,au.spotLightShadows.needsUpdate=cl,au.rectAreaLights.needsUpdate=cl,au.hemisphereLights.needsUpdate=cl),tm&&Vi.fog===!0&&Jr.refreshFogUniforms(Yh,tm),Jr.refreshMaterialUniforms(Yh,Vi,Xt,ei,q.userData.transmissionRenderTarget||Ri),ip.upload(Dt,Or.uniformsList,Yh,Vt)),Vi.isShaderMaterial&&Vi.uniformsNeedUpdate===!0&&(ip.upload(Dt,Or.uniformsList,Yh,Vt),Vi.uniformsNeedUpdate=!1),Vi.isSpriteMaterial&&Na.setValue(Dt,"center",cs.center),Na.setValue(Dt,"modelViewMatrix",cs.modelViewMatrix),Na.setValue(Dt,"normalMatrix",cs.normalMatrix),Na.setValue(Dt,"modelMatrix",cs.matrixWorld);const ab=Vi.extraUniformsToUpload;if(ab&&Object.entries(ab).forEach(([Fa,Sp])=>Na.setValue(Dt,Fa,Sp.value,Vt)),Vi.isShaderMaterial||Vi.isRawShaderMaterial){const Fa=Vi.uniformsGroups;for(let Sp=0,Dw=Fa.length;Sp<Dw;Sp++)if(ke.isWebGL2){const Bw=Fa[Sp];Ju.update(Bw,qh),Ju.bind(Bw,qh)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return qh}(Pe,Lt,Kt,qt,ii);ze.setMaterial(qt,Cr);let wr=Kt.index,jr=1;qt.wireframe===!0&&(wr=Ti.getWireframeAttribute(Kt),jr=2);const Rr=Kt.drawRange,mr=Kt.attributes.position;let ls=Rr.start*jr,ol=(Rr.start+Rr.count)*jr;Ei!==null&&(ls=Math.max(ls,Ei.start*jr),ol=Math.min(ol,(Ei.start+Ei.count)*jr)),wr!==null?(ls=Math.max(ls,0),ol=Math.min(ol,wr.count)):mr!=null&&(ls=Math.max(ls,0),ol=Math.min(ol,mr.count));const Qs=ol-ls;if(Qs<0||Qs===1/0)return;let Xh;al.setup(ii,qt,ir,Kt,wr);let Es=Cg;if(wr!==null&&(Xh=Ki.get(wr),Es=em,Es.setIndex(Xh)),ii.isMesh)qt.wireframe===!0?(ze.setLineWidth(qt.wireframeLinewidth*Oe()),Es.setMode(Dt.LINES)):Es.setMode(Dt.TRIANGLES);else if(ii.isLine){let Kn=qt.linewidth;Kn===void 0&&(Kn=1),ze.setLineWidth(Kn*Oe()),ii.isLineSegments?Es.setMode(Dt.LINES):ii.isLineLoop?Es.setMode(Dt.LINE_LOOP):Es.setMode(Dt.LINE_STRIP)}else ii.isPoints?Es.setMode(Dt.POINTS):ii.isSprite&&Es.setMode(Dt.TRIANGLES);if(ii.isInstancedMesh)Es.renderInstances(ls,Qs,ii.count);else if(Kt.isInstancedBufferGeometry){const Kn=Kt._maxInstanceCount!==void 0?Kt._maxInstanceCount:1/0,Ws=Math.min(Kt.instanceCount,Kn);Es.renderInstances(ls,Qs,Ws)}else Es.render(ls,Qs)},this.compile=function(Pe,Lt){function Kt(qt,ii,Ei){qt.transparent===!0&&qt.side===vt&&qt.forceSinglePass===!1?(qt.side=Ce,qt.needsUpdate=!0,Mg(qt,ii,Ei),qt.side=lt,qt.needsUpdate=!0,Mg(qt,ii,Ei),qt.side=vt):Mg(qt,ii,Ei)}Q=qr.get(Pe),Q.init(),Y.push(Q),Pe.traverseVisible(function(qt){qt.isLight&&qt.layers.test(Lt.layers)&&(Q.pushLight(qt),qt.castShadow&&Q.pushShadow(qt))}),Q.setupLights(q.useLegacyLights),Pe.traverse(function(qt){const ii=qt.material;if(ii)if(Array.isArray(ii))for(let Ei=0;Ei<ii.length;Ei++)Kt(ii[Ei],Pe,qt);else Kt(ii,Pe,qt)}),Y.pop(),Q=null};let tb=null;function ib(){su.stop()}function N0(){su.start()}const su=new Wd;function rb(Pe,Lt,Kt,qt){if(Pe.visible===!1)return;if(Pe.layers.test(Lt.layers)){if(Pe.isGroup)Kt=Pe.renderOrder;else if(Pe.isLOD)Pe.autoUpdate===!0&&Pe.update(Lt);else if(Pe.isLight)Q.pushLight(Pe),Pe.castShadow&&Q.pushShadow(Pe);else if(Pe.isSprite){if(!Pe.frustumCulled||$i.intersectsSprite(Pe)){qt&&Ge.setFromMatrixPosition(Pe.matrixWorld).applyMatrix4(De);const Ei=tr.update(Pe),Cr=Pe.material;Cr.visible&&W.push(Pe,Ei,Cr,Kt,Ge.z,null)}}else if((Pe.isMesh||Pe.isLine||Pe.isPoints)&&(!Pe.frustumCulled||$i.intersectsObject(Pe))){Pe.isSkinnedMesh&&Pe.skeleton.frame!==rt.render.frame&&(Pe.skeleton.update(),Pe.skeleton.frame=rt.render.frame);const Ei=tr.update(Pe),Cr=Pe.material;if(qt&&(Pe.boundingSphere!==void 0?(Pe.boundingSphere===null&&Pe.computeBoundingSphere(),Ge.copy(Pe.boundingSphere.center)):(Ei.boundingSphere===null&&Ei.computeBoundingSphere(),Ge.copy(Ei.boundingSphere.center)),Ge.applyMatrix4(Pe.matrixWorld).applyMatrix4(De)),Array.isArray(Cr)){const ir=Ei.groups;for(let wr=0,jr=ir.length;wr<jr;wr++){const Rr=ir[wr],mr=Cr[Rr.materialIndex];mr&&mr.visible&&W.push(Pe,Ei,mr,Kt,Ge.z,Rr)}}else Cr.visible&&W.push(Pe,Ei,Cr,Kt,Ge.z,null)}}const ii=Pe.children;for(let Ei=0,Cr=ii.length;Ei<Cr;Ei++)rb(ii[Ei],Lt,Kt,qt)}function Ew(Pe,Lt,Kt,qt){const ii=Pe.opaque,Ei=Pe.transmissive,Cr=Pe.transparent;if(Q.setupLightsView(Kt),yi===!0&&os.setGlobalState(q.clippingPlanes,Kt),q.userData.transmissionRender===void 0&&q.userData.renderTransmissionPass!==!1&&Ei.length>0&&function(ir,wr,jr,Rr){console.warn("three.js internal render transmission pass should not be called");const mr=ke.isWebGL2;Ri===null&&(Ri=new zs(1,1,{generateMipmaps:!0,type:ye.has("EXT_color_buffer_half_float")?sn:yl,minFilter:_l,samples:mr&&C===!0?4:0})),q.getDrawingBufferSize(Me),mr?Ri.setSize(Me.x,Me.y):Ri.setSize(Ho(Me.x),Ho(Me.y));const ls=q.getRenderTarget();q.setRenderTarget(Ri),q.getClearColor(Ht),ri=q.getClearAlpha(),ri<1&&q.setClearColor(16777215,.5),q.clear();const ol=q.toneMapping;q.toneMapping=Vr,xp(ir,jr,Rr),Vt.updateMultisampleRenderTarget(Ri),Vt.updateRenderTargetMipmap(Ri);let Qs=!1;for(let Xh=0,Es=wr.length;Xh<Es;Xh++){const Kn=wr[Xh],Ws=Kn.object,Po=Kn.geometry,Vi=Kn.material,cs=Kn.group;if(Vi.side===vt&&Ws.layers.test(Rr.layers)){const tm=Vi.side;Vi.side=Ce,Vi.needsUpdate=!0,Sw(Ws,jr,Rr,Po,Vi,cs),Vi.side=tm,Vi.needsUpdate=!0,Qs=!0}}Qs===!0&&(Vt.updateMultisampleRenderTarget(Ri),Vt.updateRenderTargetMipmap(Ri)),q.setRenderTarget(ls),q.setClearColor(Ht,ri),q.toneMapping=ol}([...ii,...Cr],Ei,Lt,Kt),qt&&ze.viewport(ft.copy(qt)),q.userData.opaqueRender!==!1&&ii.length>0&&xp(ii,Lt,Kt),q.userData.transparentRender!==!1&&Cr.length>0&&xp(Cr,Lt,Kt),q.userData.transmissionRender!==!1&&Ei.length>0){Ri||(Ri=new zs(1,1));const ir=(q.userData.transmissionRenderTarget||Ri).texture,wr=ke.isWebGL2,jr=ir.generateMipmaps,Rr=ir.minFilter;wr&&q.userData.blurTransmissionTarget&&q.userData.transmissionRenderTarget&&(ir.generateMipmaps=!0,ir.minFilter=_l,ir.needsUpdate=!0,Vt.updateMultisampleRenderTarget(q.userData.transmissionRenderTarget),Vt.updateRenderTargetMipmap(q.userData.transmissionRenderTarget)),xp(Ei,Lt,Kt),wr&&q.userData.blurTransmissionTarget&&q.userData.transmissionRenderTarget&&(ir.generateMipmaps=jr,ir.minFilter=Rr,ir.needsUpdate=!0,Vt.updateMultisampleRenderTarget(q.userData.transmissionRenderTarget),Vt.updateRenderTargetMipmap(q.userData.transmissionRenderTarget))}ze.buffers.depth.setTest(!0),ze.buffers.depth.setMask(!0),ze.buffers.color.setMask(!0),ze.setPolygonOffset(!1)}function xp(Pe,Lt,Kt){const qt={...q.userData};q.userData.opaqueRender=void 0,q.userData.transparentRender=void 0,q.userData.transmissionRender=void 0,q.userData.backgroundRender=void 0;const ii=Lt.isScene===!0?Lt.overrideMaterial:null;for(let Ei=0,Cr=Pe.length;Ei<Cr;Ei++){const ir=Pe[Ei],wr=ir.object,jr=ir.geometry,Rr=ii===null?ir.material:ii,mr=ir.group;wr.layers.test(Kt.layers)&&Sw(wr,Lt,Kt,jr,Rr,mr)}Object.assign(q.userData,qt)}function Sw(Pe,Lt,Kt,qt,ii,Ei){Pe.onBeforeRender(q,Lt,Kt,qt,ii,Ei),Pe.modelViewMatrix.multiplyMatrices(Kt.matrixWorldInverse,Pe.matrixWorld),Pe.normalMatrix.getNormalMatrix(Pe.modelViewMatrix),ii.onBeforeRender(q,Lt,Kt,qt,Pe,Ei),ii.transparent===!0&&ii.side===vt&&ii.forceSinglePass===!1?(ii.side=Ce,ii.needsUpdate=!0,q.renderBufferDirect(Kt,Lt,qt,ii,Pe,Ei),ii.side=lt,ii.needsUpdate=!0,q.renderBufferDirect(Kt,Lt,qt,ii,Pe,Ei),ii.side=vt):q.renderBufferDirect(Kt,Lt,qt,ii,Pe,Ei),Pe.onAfterRender(q,Lt,Kt,qt,ii,Ei),ii.onAfterRender(q,Lt,Kt,qt,Pe,Ei)}function Mg(Pe,Lt,Kt){Lt.isScene!==!0&&(Lt=ht);const qt=Et.get(Pe),ii=Q.state.lights,Ei=Q.state.shadowsArray,Cr=ii.state.version,ir=dr.getParameters(Pe,ii.state,Ei,Lt,Kt),wr=dr.getProgramCacheKey(ir);let jr=qt.programs;qt.environment=Pe.userData&&Pe.userData.envMapSlotKey&&Lt.textureSlots&&Lt.textureSlots[Pe.userData.envMapSlotKey]?Lt.textureSlots[Pe.userData.envMapSlotKey]:Pe.isMeshStandardMaterial?Lt.environment:null,qt.fog=Lt.fog,qt.envMap=(Pe.isMeshStandardMaterial?Fi:Yt).get(Pe.envMap||qt.environment),jr===void 0&&(Pe.addEventListener("dispose",U0),jr=new Map,qt.programs=jr);let Rr=jr.get(wr);if(Rr!==void 0){if(qt.currentProgram===Rr&&qt.lightsStateVersion===Cr)return nb(Pe,ir),Rr}else ir.uniforms=dr.getUniforms(Pe),Pe.onBuild(Kt,ir,q),Pe.onBeforeCompile(ir,q),Rr=dr.acquireProgram(ir,wr),jr.set(wr,Rr),qt.uniforms=ir.uniforms;const mr=qt.uniforms;(Pe.isShaderMaterial||Pe.isRawShaderMaterial)&&Pe.clipping!==!0||(mr.clippingPlanes=os.uniform),nb(Pe,ir),qt.needsLights=function(Qs){return Qs.isMeshLambertMaterial||Qs.isMeshToonMaterial||Qs.isMeshPhongMaterial||Qs.isMeshStandardMaterial||Qs.isShadowMaterial||Qs.isShaderMaterial&&Qs.lights===!0}(Pe),qt.lightsStateVersion=Cr,qt.needsLights&&(mr.ambientLightColor.value=ii.state.ambient,mr.lightProbe.value=ii.state.probe,mr.directionalLights.value=ii.state.directional,mr.directionalLightShadows.value=ii.state.directionalShadow,mr.spotLights.value=ii.state.spot,mr.spotLightShadows.value=ii.state.spotShadow,mr.rectAreaLights.value=ii.state.rectArea,mr.ltc_1.value=ii.state.rectAreaLTC1,mr.ltc_2.value=ii.state.rectAreaLTC2,mr.pointLights.value=ii.state.point,mr.pointLightShadows.value=ii.state.pointShadow,mr.hemisphereLights.value=ii.state.hemi,mr.directionalShadowMap.value=ii.state.directionalShadowMap,mr.directionalShadowMatrix.value=ii.state.directionalShadowMatrix,mr.spotShadowMap.value=ii.state.spotShadowMap,mr.spotLightMatrix.value=ii.state.spotLightMatrix,mr.spotLightMap.value=ii.state.spotLightMap,mr.pointShadowMap.value=ii.state.pointShadowMap,mr.pointShadowMatrix.value=ii.state.pointShadowMatrix);const ls=Rr.getUniforms(),ol=ip.seqWithValue(ls.seq,mr);return qt.currentProgram=Rr,qt.uniformsList=ol,Rr}function nb(Pe,Lt){const Kt=Et.get(Pe);Kt.outputColorSpace=Lt.outputColorSpace,Kt.instancing=Lt.instancing,Kt.skinning=Lt.skinning,Kt.morphTargets=Lt.morphTargets,Kt.morphNormals=Lt.morphNormals,Kt.morphColors=Lt.morphColors,Kt.morphTargetsCount=Lt.morphTargetsCount,Kt.numClippingPlanes=Lt.numClippingPlanes,Kt.numIntersection=Lt.numClipIntersection,Kt.vertexAlphas=Lt.vertexAlphas,Kt.vertexTangents=Lt.vertexTangents,Kt.toneMapping=Lt.toneMapping}su.setAnimationLoop(function(Pe){tb&&tb(Pe)}),typeof self<"u"&&su.setContext(self),this.setAnimationLoop=function(Pe){tb=Pe,Bs.setAnimationLoop(Pe),Pe===null?su.stop():su.start()},Bs.addEventListener("sessionstart",ib),Bs.addEventListener("sessionend",N0),this.render=function(Pe,Lt){if(Lt===void 0||Lt.isCamera===!0){if(be!==!0){if(Pe.matrixWorldAutoUpdate===!0&&Pe.updateMatrixWorld(),Lt.parent===null&&Lt.matrixWorldAutoUpdate===!0&&Lt.updateMatrixWorld(),Bs.enabled===!0&&Bs.isPresenting===!0&&(Lt=Bs.updateCameraXR(Lt)),Pe.isScene===!0&&Pe.onBeforeRender(q,Pe,Lt,Be),Q=qr.get(Pe,Y.length),Q.init(),Y.push(Q),De.multiplyMatrices(Lt.projectionMatrix,Lt.matrixWorldInverse),$i.setFromProjectionMatrix(De),qi=this.localClippingEnabled,yi=os.init(this.clippingPlanes,qi),W=nr.get(Pe,$.length),W.init(),$.push(W),rb(Pe,Lt,0,q.sortObjects),W.finish(),q.sortObjects===!0&&W.sort(oi,Pt),q.userData.shadowMapRender!==!1){yi===!0&&os.beginShadows();const Kt=Q.state.shadowsArray;Kt.length>0&&Zi.render(Kt,Pe,Lt),yi===!0&&os.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,q.userData.backgroundRender!==!1&&Fr.render(W,Pe),q.userData.sceneRender!==!1)if(Q.setupLights(q.useLegacyLights),Lt.isArrayCamera){const Kt=Lt.cameras;for(let qt=0,ii=Kt.length;qt<ii;qt++){const Ei=Kt[qt];Ew(W,Pe,Ei,Ei.viewport)}}else Ew(W,Pe,Lt);Be!==null&&(Vt.updateMultisampleRenderTarget(Be),Vt.updateRenderTargetMipmap(Be)),Pe.isScene===!0&&Pe.onAfterRender(q,Pe,Lt),al.resetDefaultState(),Ze=-1,et=null,Y.pop(),Q=Y.length>0?Y[Y.length-1]:null,$.pop(),W=$.length>0?$[$.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return we},this.getActiveMipmapLevel=function(){return me},this.getRenderTarget=function(){return Be},this.setRenderTargetTextures=function(Pe,Lt,Kt){Et.get(Pe.texture).__webglTexture=Lt,Et.get(Pe.depthTexture).__webglTexture=Kt;const qt=Et.get(Pe);qt.__hasExternalTextures=!0,qt.__hasExternalTextures&&(qt.__autoAllocateDepthBuffer=Kt===void 0,qt.__autoAllocateDepthBuffer||ye.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),qt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Pe,Lt){const Kt=Et.get(Pe);Kt.__webglFramebuffer=Lt,Kt.__useDefaultFramebuffer=Lt===void 0},this.setRenderTarget=function(Pe,Lt=0,Kt=0){Be=Pe,we=Lt,me=Kt;let qt=!0,ii=null,Ei=!1,Cr=!1;if(Pe){const ir=Et.get(Pe);ir.__useDefaultFramebuffer!==void 0?(ze.bindFramebuffer(Dt.FRAMEBUFFER,null),qt=!1):ir.__webglFramebuffer===void 0?Vt.setupRenderTarget(Pe):ir.__hasExternalTextures&&Vt.rebindTextures(Pe,Et.get(Pe.texture).__webglTexture,Et.get(Pe.depthTexture).__webglTexture);const wr=Pe.texture;(wr.isData3DTexture||wr.isDataArrayTexture||wr.isCompressedArrayTexture)&&(Cr=!0);const jr=Et.get(Pe).__webglFramebuffer;Pe.isWebGLCubeRenderTarget?(ii=jr[Lt],Ei=!0):ii=ke.isWebGL2&&Pe.samples>0&&Vt.useMultisampledRTT(Pe)===!1?Et.get(Pe).__webglMultisampledFramebuffer:jr,ft.copy(Pe.viewport),Le.copy(Pe.scissor),Gt=Pe.scissorTest}else ft.copy(Nt).multiplyScalar(Xt).floor(),Le.copy(ci).multiplyScalar(Xt).floor(),Gt=pi;if(ze.bindFramebuffer(Dt.FRAMEBUFFER,ii)&&ke.drawBuffers&&qt&&ze.drawBuffers(Pe,ii),ze.viewport(ft),ze.scissor(Le),ze.setScissorTest(Gt),Ei){const ir=Et.get(Pe.texture);Dt.framebufferTexture2D(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,Dt.TEXTURE_CUBE_MAP_POSITIVE_X+Lt,ir.__webglTexture,Kt)}else if(Cr){const ir=Et.get(Pe.texture),wr=Lt||0;Dt.framebufferTextureLayer(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,ir.__webglTexture,Kt||0,wr)}Ze=-1},this.readRenderTargetPixels=function(Pe,Lt,Kt,qt,ii,Ei,Cr,ir){if(!Pe||!Pe.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let wr=Et.get(Pe).__webglFramebuffer;if(Pe.isWebGLCubeRenderTarget&&Cr!==void 0&&(wr=wr[Cr]),wr){ze.bindFramebuffer(Dt.FRAMEBUFFER,wr);try{const jr=Array.isArray(Pe.texture)?Pe.texture[ir||0]:Pe.texture,Rr=jr.format,mr=jr.type;if(Rr!==en&&sl.convert(Rr)!==Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const ls=mr===sn&&(ye.has("EXT_color_buffer_half_float")||ke.isWebGL2&&ye.has("EXT_color_buffer_float"));if(!(mr===yl||sl.convert(mr)===Dt.getParameter(Dt.IMPLEMENTATION_COLOR_READ_TYPE)||mr===bl&&(ke.isWebGL2||ye.has("OES_texture_float")||ye.has("WEBGL_color_buffer_float"))||ls))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Lt>=0&&Lt<=Pe.width-qt&&Kt>=0&&Kt<=Pe.height-ii&&(Pe.isWebGLMultipleRenderTargets&&Dt.readBuffer(Dt.COLOR_ATTACHMENT0+ir),Dt.readPixels(Lt,Kt,qt,ii,sl.convert(Rr),sl.convert(mr),Ei))}finally{const jr=Be?Et.get(Be).__webglFramebuffer:null;ze.bindFramebuffer(Dt.FRAMEBUFFER,jr)}}},this.copyFramebufferToTexture=function(Pe,Lt,Kt=0){const qt=Math.pow(2,-Kt),ii=Math.floor(Lt.image.width*qt),Ei=Math.floor(Lt.image.height*qt);Vt.setTexture2D(Lt,0),Dt.copyTexSubImage2D(Dt.TEXTURE_2D,Kt,0,0,Pe.x,Pe.y,ii,Ei),ze.unbindTexture()},this.copyTextureToTexture=function(Pe,Lt,Kt,qt=0){const ii=Lt.image.width,Ei=Lt.image.height,Cr=sl.convert(Kt.format),ir=sl.convert(Kt.type);Vt.setTexture2D(Kt,0),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,Kt.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Kt.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,Kt.unpackAlignment),Lt.isDataTexture?Dt.texSubImage2D(Dt.TEXTURE_2D,qt,Pe.x,Pe.y,ii,Ei,Cr,ir,Lt.image.data):Lt.isCompressedTexture?Dt.compressedTexSubImage2D(Dt.TEXTURE_2D,qt,Pe.x,Pe.y,Lt.mipmaps[0].width,Lt.mipmaps[0].height,Cr,Lt.mipmaps[0].data):Dt.texSubImage2D(Dt.TEXTURE_2D,qt,Pe.x,Pe.y,Cr,ir,Lt.image),qt===0&&Kt.generateMipmaps&&Dt.generateMipmap(Dt.TEXTURE_2D),ze.unbindTexture()},this.copyTextureToTexture3D=function(Pe,Lt,Kt,qt,ii=0){if(q.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Ei=Pe.max.x-Pe.min.x+1,Cr=Pe.max.y-Pe.min.y+1,ir=Pe.max.z-Pe.min.z+1,wr=sl.convert(qt.format),jr=sl.convert(qt.type);let Rr;if(qt.isData3DTexture)Vt.setTexture3D(qt,0),Rr=Dt.TEXTURE_3D;else{if(!qt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Vt.setTexture2DArray(qt,0),Rr=Dt.TEXTURE_2D_ARRAY}Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,qt.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,qt.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,qt.unpackAlignment);const mr=Dt.getParameter(Dt.UNPACK_ROW_LENGTH),ls=Dt.getParameter(Dt.UNPACK_IMAGE_HEIGHT),ol=Dt.getParameter(Dt.UNPACK_SKIP_PIXELS),Qs=Dt.getParameter(Dt.UNPACK_SKIP_ROWS),Xh=Dt.getParameter(Dt.UNPACK_SKIP_IMAGES),Es=Kt.isCompressedTexture?Kt.mipmaps[0]:Kt.image;Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,Es.width),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,Es.height),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,Pe.min.x),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,Pe.min.y),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,Pe.min.z),Kt.isDataTexture||Kt.isData3DTexture?Dt.texSubImage3D(Rr,ii,Lt.x,Lt.y,Lt.z,Ei,Cr,ir,wr,jr,Es.data):Kt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Dt.compressedTexSubImage3D(Rr,ii,Lt.x,Lt.y,Lt.z,Ei,Cr,ir,wr,Es.data)):Dt.texSubImage3D(Rr,ii,Lt.x,Lt.y,Lt.z,Ei,Cr,ir,wr,jr,Es),Dt.pixelStorei(Dt.UNPACK_ROW_LENGTH,mr),Dt.pixelStorei(Dt.UNPACK_IMAGE_HEIGHT,ls),Dt.pixelStorei(Dt.UNPACK_SKIP_PIXELS,ol),Dt.pixelStorei(Dt.UNPACK_SKIP_ROWS,Qs),Dt.pixelStorei(Dt.UNPACK_SKIP_IMAGES,Xh),ii===0&&qt.generateMipmaps&&Dt.generateMipmap(Rr),ze.unbindTexture()},this.initTexture=function(Pe){Pe.isCubeTexture?Vt.setTextureCube(Pe,0):Pe.isData3DTexture?Vt.setTexture3D(Pe,0):Pe.isDataArrayTexture||Pe.isCompressedArrayTexture?Vt.setTexture2DArray(Pe,0):Vt.setTexture2D(Pe,0),ze.unbindTexture()},this.resetState=function(){we=0,me=0,Be=null,ze.reset(),al.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Go}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(n){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!n}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Yi?xl:Pd}set outputEncoding(n){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=n===xl?Yi:an}}class Df extends ro{}Df.prototype.isWebGL1Renderer=!0;class Wm{constructor(n,c=25e-5){this.isFogExp2=!0,this.name="",this.color=new xi(n),this.density=c}clone(){return new Wm(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Wv{constructor(n,c=1,d=1e3){this.isFog=!0,this.name="",this.color=new xi(n),this.near=c,this.far=d}clone(){return new Wv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class dy extends Nr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(n,c){return super.copy(n,c),n.background!==null&&(this.background=n.background.clone()),n.environment!==null&&(this.environment=n.environment.clone()),n.fog!==null&&(this.fog=n.fog.clone()),this.backgroundBlurriness=n.backgroundBlurriness,this.backgroundIntensity=n.backgroundIntensity,n.overrideMaterial!==null&&(this.overrideMaterial=n.overrideMaterial.clone()),this.matrixAutoUpdate=n.matrixAutoUpdate,this}toJSON(n){const c=super.toJSON(n);return this.fog!==null&&(c.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(c.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(c.object.backgroundIntensity=this.backgroundIntensity),c}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(n){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=n}}class Xv{constructor(n,c){this.isInterleavedBuffer=!0,this.array=n,this.stride=c,this.count=n!==void 0?n.length/c:0,this.usage=Sl,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ts()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,c,d){n*=this.stride,d*=c.stride;for(let m=0,v=this.stride;m<v;m++)this.array[n+m]=c.array[d+m];return this}set(n,c=0){return this.array.set(n,c),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ts()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const c=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),d=new this.constructor(c,this.stride);return d.setUsage(this.usage),d}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ts()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const no=new Se;class Bh{constructor(n,c,d,m=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=n,this.itemSize=c,this.offset=d,this.normalized=m}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(n){this.data.needsUpdate=n}applyMatrix4(n){for(let c=0,d=this.data.count;c<d;c++)no.fromBufferAttribute(this,c),no.applyMatrix4(n),this.setXYZ(c,no.x,no.y,no.z);return this}applyNormalMatrix(n){for(let c=0,d=this.count;c<d;c++)no.fromBufferAttribute(this,c),no.applyNormalMatrix(n),this.setXYZ(c,no.x,no.y,no.z);return this}transformDirection(n){for(let c=0,d=this.count;c<d;c++)no.fromBufferAttribute(this,c),no.transformDirection(n),this.setXYZ(c,no.x,no.y,no.z);return this}setX(n,c){return this.normalized&&(c=Ji(c,this.array)),this.data.array[n*this.data.stride+this.offset]=c,this}setY(n,c){return this.normalized&&(c=Ji(c,this.array)),this.data.array[n*this.data.stride+this.offset+1]=c,this}setZ(n,c){return this.normalized&&(c=Ji(c,this.array)),this.data.array[n*this.data.stride+this.offset+2]=c,this}setW(n,c){return this.normalized&&(c=Ji(c,this.array)),this.data.array[n*this.data.stride+this.offset+3]=c,this}getX(n){let c=this.data.array[n*this.data.stride+this.offset];return this.normalized&&(c=is(c,this.array)),c}getY(n){let c=this.data.array[n*this.data.stride+this.offset+1];return this.normalized&&(c=is(c,this.array)),c}getZ(n){let c=this.data.array[n*this.data.stride+this.offset+2];return this.normalized&&(c=is(c,this.array)),c}getW(n){let c=this.data.array[n*this.data.stride+this.offset+3];return this.normalized&&(c=is(c,this.array)),c}setXY(n,c,d){return n=n*this.data.stride+this.offset,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array)),this.data.array[n+0]=c,this.data.array[n+1]=d,this}setXYZ(n,c,d,m){return n=n*this.data.stride+this.offset,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array)),this.data.array[n+0]=c,this.data.array[n+1]=d,this.data.array[n+2]=m,this}setXYZW(n,c,d,m,v){return n=n*this.data.stride+this.offset,this.normalized&&(c=Ji(c,this.array),d=Ji(d,this.array),m=Ji(m,this.array),v=Ji(v,this.array)),this.data.array[n+0]=c,this.data.array[n+1]=d,this.data.array[n+2]=m,this.data.array[n+3]=v,this}clone(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const m=d*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)c.push(this.data.array[m+v])}return new on(new this.array.constructor(c),this.itemSize,this.normalized)}return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new Bh(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const c=[];for(let d=0;d<this.count;d++){const m=d*this.data.stride+this.offset;for(let v=0;v<this.itemSize;v++)c.push(this.data.array[m+v])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:c,normalized:this.normalized}}return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class qv extends Gs{constructor(n){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new xi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}let Nn;const yr=new Se,Bf=new Se,ap=new Se,op=new Jt,Xm=new Jt,UA=new or,fc=new Se,qm=new Se,mc=new Se,NA=new Jt,tu=new Jt,FA=new Jt;class Lu extends Nr{constructor(n){if(super(),this.isSprite=!0,this.type="Sprite",Nn===void 0){Nn=new hr;const c=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),d=new Xv(c,5);Nn.setIndex([0,1,2,0,2,3]),Nn.setAttribute("position",new Bh(d,3,0,!1)),Nn.setAttribute("uv",new Bh(d,2,3,!1))}this.geometry=Nn,this.material=n!==void 0?n:new qv,this.center=new Jt(.5,.5)}raycast(n,c){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Bf.setFromMatrixScale(this.matrixWorld),UA.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),ap.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Bf.multiplyScalar(-ap.z);const d=this.material.rotation;let m,v;d!==0&&(v=Math.cos(d),m=Math.sin(d));const w=this.center;Yv(fc.set(-.5,-.5,0),ap,w,Bf,m,v),Yv(qm.set(.5,-.5,0),ap,w,Bf,m,v),Yv(mc.set(.5,.5,0),ap,w,Bf,m,v),NA.set(0,0),tu.set(1,0),FA.set(1,1);let C=n.ray.intersectTriangle(fc,qm,mc,!1,yr);if(C===null&&(Yv(qm.set(-.5,.5,0),ap,w,Bf,m,v),tu.set(0,1),C=n.ray.intersectTriangle(fc,mc,qm,!1,yr),C===null))return;const P=n.ray.origin.distanceTo(yr);P<n.near||P>n.far||c.push({distance:P,point:yr.clone(),uv:bs.getInterpolation(yr,fc,qm,mc,NA,tu,FA,new Jt),face:null,object:this})}copy(n,c){return super.copy(n,c),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}}function Yv(b,n,c,d,m,v){op.subVectors(b,c).addScalar(.5).multiply(d),m!==void 0?(Xm.x=v*op.x-m*op.y,Xm.y=m*op.x+v*op.y):Xm.copy(op),b.copy(n),b.x+=Xm.x,b.y+=Xm.y,b.applyMatrix4(UA)}const gc=new Se,Ym=new Se;class Of extends Nr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const c=n.levels;for(let d=0,m=c.length;d<m;d++){const v=c[d];this.addLevel(v.object.clone(),v.distance,v.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,c=0,d=0){c=Math.abs(c);const m=this.levels;let v;for(v=0;v<m.length&&!(c<m[v].distance);v++);return m.splice(v,0,{distance:c,hysteresis:d,object:n}),this.add(n),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const c=this.levels;if(c.length>0){let d,m;for(d=1,m=c.length;d<m;d++){let v=c[d].distance;if(c[d].object.visible&&(v-=v*c[d].hysteresis),n<v)break}return c[d-1].object}return null}raycast(n,c){if(this.levels.length>0){gc.setFromMatrixPosition(this.matrixWorld);const d=n.ray.origin.distanceTo(gc);this.getObjectForDistance(d).raycast(n,c)}}update(n){const c=this.levels;if(c.length>1){gc.setFromMatrixPosition(n.matrixWorld),Ym.setFromMatrixPosition(this.matrixWorld);const d=gc.distanceTo(Ym)/n.zoom;let m,v;for(c[0].object.visible=!0,m=1,v=c.length;m<v;m++){let w=c[m].distance;if(c[m].object.visible&&(w-=w*c[m].hysteresis),!(d>=w))break;c[m-1].object.visible=!1,c[m].object.visible=!0}for(this._currentLevel=m-1;m<v;m++)c[m].object.visible=!1}}toJSON(n){const c=super.toJSON(n);this.autoUpdate===!1&&(c.object.autoUpdate=!1),c.object.levels=[];const d=this.levels;for(let m=0,v=d.length;m<v;m++){const w=d[m];c.object.levels.push({object:w.object.uuid,distance:w.distance,hysteresis:w.hysteresis})}return c}}const Kv=new Se,Zv=new Tr,Oh=new Tr,lE=new Se,Km=new or,iu=new Se,Zm=new Pa,Jv=new or,ku=new Qc;class jA extends Ut{constructor(n,c){super(n,c),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new or,this.bindMatrixInverse=new or,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const n=this.geometry;this.boundingBox===null&&(this.boundingBox=new ia),this.boundingBox.makeEmpty();const c=n.getAttribute("position");for(let d=0;d<c.count;d++)iu.fromBufferAttribute(c,d),this.applyBoneTransform(d,iu),this.boundingBox.expandByPoint(iu)}computeBoundingSphere(){const n=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Pa),this.boundingSphere.makeEmpty();const c=n.getAttribute("position");for(let d=0;d<c.count;d++)iu.fromBufferAttribute(c,d),this.applyBoneTransform(d,iu),this.boundingSphere.expandByPoint(iu)}copy(n,c){return super.copy(n,c),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}raycast(n,c){const d=this.material,m=this.matrixWorld;d!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Zm.copy(this.boundingSphere),Zm.applyMatrix4(m),n.ray.intersectsSphere(Zm)!==!1&&(Jv.copy(m).invert(),ku.copy(n.ray).applyMatrix4(Jv),this.boundingBox!==null&&ku.intersectsBox(this.boundingBox)===!1||this._computeIntersections(n,c,ku)))}getVertexPosition(n,c){return super.getVertexPosition(n,c),this.applyBoneTransform(n,c),c}bind(n,c){this.skeleton=n,c===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),c=this.matrixWorld),this.bindMatrix.copy(c),this.bindMatrixInverse.copy(c).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Tr,c=this.geometry.attributes.skinWeight;for(let d=0,m=c.count;d<m;d++){n.fromBufferAttribute(c,d);const v=1/n.manhattanLength();v!==1/0?n.multiplyScalar(v):n.set(1,0,0,0),c.setXYZW(d,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(n,c){const d=this.skeleton,m=this.geometry;Zv.fromBufferAttribute(m.attributes.skinIndex,n),Oh.fromBufferAttribute(m.attributes.skinWeight,n),Kv.copy(c).applyMatrix4(this.bindMatrix),c.set(0,0,0);for(let v=0;v<4;v++){const w=Oh.getComponent(v);if(w!==0){const C=Zv.getComponent(v);Km.multiplyMatrices(d.bones[C].matrixWorld,d.boneInverses[C]),c.addScaledVector(lE.copy(Kv).applyMatrix4(Km),w)}}return c.applyMatrix4(this.bindMatrixInverse)}boneTransform(n,c){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(n,c)}}class Lh extends Nr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class La extends xr{constructor(n=null,c=1,d=1,m,v,w,C,P,D=dn,B=dn,j,F){super(null,w,C,P,D,B,m,v,j,F),this.isDataTexture=!0,this.image={data:n,width:c,height:d},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Yn=new or,Zr=new or;class Jm{constructor(n=[],c=[]){this.uuid=ts(),this.bones=n.slice(0),this.boneInverses=c,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const n=this.bones,c=this.boneInverses;if(this.boneMatrices=new Float32Array(16*n.length),c.length===0)this.calculateInverses();else if(n.length!==c.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let d=0,m=this.bones.length;d<m;d++)this.boneInverses.push(new or)}}calculateInverses(){this.boneInverses.length=0;for(let n=0,c=this.bones.length;n<c;n++){const d=new or;this.bones[n]&&d.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(d)}}pose(){for(let n=0,c=this.bones.length;n<c;n++){const d=this.bones[n];d&&d.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,c=this.bones.length;n<c;n++){const d=this.bones[n];d&&(d.parent&&d.parent.isBone?(d.matrix.copy(d.parent.matrixWorld).invert(),d.matrix.multiply(d.matrixWorld)):d.matrix.copy(d.matrixWorld),d.matrix.decompose(d.position,d.quaternion,d.scale))}}update(){const n=this.bones,c=this.boneInverses,d=this.boneMatrices,m=this.boneTexture;for(let v=0,w=n.length;v<w;v++){const C=n[v]?n[v].matrixWorld:Zr;Yn.multiplyMatrices(C,c[v]),Yn.toArray(d,16*v)}m!==null&&(m.needsUpdate=!0)}clone(){return new Jm(this.bones,this.boneInverses)}computeBoneTexture(){let n=Math.sqrt(4*this.bones.length);n=pf(n),n=Math.max(n,4);const c=new Float32Array(n*n*4);c.set(this.boneMatrices);const d=new La(c,n,n,en,bl);return d.needsUpdate=!0,this.boneMatrices=c,this.boneTexture=d,this.boneTextureSize=n,this}getBoneByName(n){for(let c=0,d=this.bones.length;c<d;c++){const m=this.bones[c];if(m.name===n)return m}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,c){this.uuid=n.uuid;for(let d=0,m=n.bones.length;d<m;d++){const v=n.bones[d];let w=c[v];w===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",v),w=new Lh),this.bones.push(w),this.boneInverses.push(new or().fromArray(n.boneInverses[d]))}return this.init(),this}toJSON(){const n={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;const c=this.bones,d=this.boneInverses;for(let m=0,v=c.length;m<v;m++){const w=c[m];n.bones.push(w.uuid);const C=d[m];n.boneInverses.push(C.toArray())}return n}}class lp extends on{constructor(n,c,d,m=1){super(n,c,d),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=m}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}}const cp=new or,$v=new or,e0=[],zA=new ia,t0=new or,Xr=new Ut,$m=new Pa;class i0 extends Ut{constructor(n,c,d){super(n,c),this.isInstancedMesh=!0,this.instanceMatrix=new lp(new Float32Array(16*d),16),this.instanceColor=null,this.sourceTrs=null,this.count=d,this.boundingBox=null,this.boundingSphere=null;for(let m=0;m<d;m++)this.setMatrixAt(m,t0)}computeBoundingBox(){const n=this.geometry,c=this.count;this.boundingBox===null&&(this.boundingBox=new ia),n.boundingBox===null&&n.computeBoundingBox(),this.boundingBox.makeEmpty();for(let d=0;d<c;d++)this.getMatrixAt(d,cp),zA.copy(n.boundingBox).applyMatrix4(cp),this.boundingBox.union(zA)}computeBoundingSphere(){const n=this.geometry,c=this.count;this.boundingSphere===null&&(this.boundingSphere=new Pa),n.boundingSphere===null&&n.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let d=0;d<c;d++)this.getMatrixAt(d,cp),$m.copy(n.boundingSphere).applyMatrix4(cp),this.boundingSphere.union($m)}copy(n,c){return super.copy(n,c),n.isInstancedMesh?(this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this):this}getColorAt(n,c){c.fromArray(this.instanceColor.array,3*n)}getMatrixAt(n,c){c.fromArray(this.instanceMatrix.array,16*n)}raycast(n,c){const d=this.matrixWorld,m=this.count;if(Xr.geometry=this.geometry,Xr.material=this.material,Xr.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),$m.copy(this.boundingSphere),$m.applyMatrix4(d),n.ray.intersectsSphere($m)!==!1))for(let v=0;v<m;v++){this.getMatrixAt(v,cp),$v.multiplyMatrices(d,cp),Xr.matrixWorld=$v,Xr.raycast(n,e0);for(let w=0,C=e0.length;w<C;w++){const P=e0[w];P.instanceId=v,P.object=this,c.push(P)}e0.length=0}}setColorAt(n,c){this.instanceColor===null&&(this.instanceColor=new lp(new Float32Array(3*this.instanceMatrix.count),3)),c.toArray(this.instanceColor.array,3*n)}setMatrixAt(n,c){c.toArray(this.instanceMatrix.array,16*n)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class wa extends Gs{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new xi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}}const Ol=new Se,Lf=new Se,eg=new or,r0=new Qc,kf=new Pa;class Uu extends Nr{constructor(n=new hr,c=new wa){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=c,this.updateMorphTargets()}copy(n,c){return super.copy(n,c),this.material=n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const c=n.attributes.position,d=[0];for(let m=1,v=c.count;m<v;m++)Ol.fromBufferAttribute(c,m-1),Lf.fromBufferAttribute(c,m),d[m]=d[m-1],d[m]+=Ol.distanceTo(Lf);n.setAttribute("lineDistance",new pe(d,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,c){const d=this.geometry,m=this.matrixWorld,v=n.params.Line.threshold,w=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),kf.copy(d.boundingSphere),kf.applyMatrix4(m),kf.radius+=v,n.ray.intersectsSphere(kf)===!1)return;eg.copy(m).invert(),r0.copy(n.ray).applyMatrix4(eg);const C=v/((this.scale.x+this.scale.y+this.scale.z)/3),P=C*C,D=new Se,B=new Se,j=new Se,F=new Se,z=this.isLineSegments?2:1,G=d.index,W=d.attributes.position;if(G!==null)for(let Q=Math.max(0,w.start),$=Math.min(G.count,w.start+w.count)-1;Q<$;Q+=z){const Y=G.getX(Q),q=G.getX(Q+1);if(D.fromBufferAttribute(W,Y),B.fromBufferAttribute(W,q),r0.distanceSqToSegment(D,B,F,j)>P)continue;F.applyMatrix4(this.matrixWorld);const be=n.ray.origin.distanceTo(F);be<n.near||be>n.far||c.push({distance:be,point:j.clone().applyMatrix4(this.matrixWorld),index:Q,face:null,faceIndex:null,object:this})}else for(let Q=Math.max(0,w.start),$=Math.min(W.count,w.start+w.count)-1;Q<$;Q+=z){if(D.fromBufferAttribute(W,Q),B.fromBufferAttribute(W,Q+1),r0.distanceSqToSegment(D,B,F,j)>P)continue;F.applyMatrix4(this.matrixWorld);const Y=n.ray.origin.distanceTo(F);Y<n.near||Y>n.far||c.push({distance:Y,point:j.clone().applyMatrix4(this.matrixWorld),index:Q,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const n=this.geometry.morphAttributes,c=Object.keys(n);if(c.length>0){const d=n[c[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,v=d.length;m<v;m++){const w=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[w]=m}}}}}const n0=new Se,tg=new Se;class vc extends Uu{constructor(n,c){super(n,c),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const c=n.attributes.position,d=[];for(let m=0,v=c.count;m<v;m+=2)n0.fromBufferAttribute(c,m),tg.fromBufferAttribute(c,m+1),d[m]=m===0?0:d[m-1],d[m+1]=d[m]+n0.distanceTo(tg);n.setAttribute("lineDistance",new pe(d,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class s0 extends Uu{constructor(n,c){super(n,c),this.isLineLoop=!0,this.type="LineLoop"}}class ig extends Gs{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new xi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}}const a0=new or,o0=new Qc,up=new Pa,rg=new Se;class py extends Nr{constructor(n=new hr,c=new ig){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=c,this.updateMorphTargets()}copy(n,c){return super.copy(n,c),this.material=n.material,this.geometry=n.geometry,this}raycast(n,c){const d=this.geometry,m=this.matrixWorld,v=n.params.Points.threshold,w=d.drawRange;if(d.boundingSphere===null&&d.computeBoundingSphere(),up.copy(d.boundingSphere),up.applyMatrix4(m),up.radius+=v,n.ray.intersectsSphere(up)===!1)return;a0.copy(m).invert(),o0.copy(n.ray).applyMatrix4(a0);const C=v/((this.scale.x+this.scale.y+this.scale.z)/3),P=C*C,D=d.index,B=d.attributes.position;if(D!==null)for(let j=Math.max(0,w.start),F=Math.min(D.count,w.start+w.count);j<F;j++){const z=D.getX(j);rg.fromBufferAttribute(B,z),fy(rg,z,P,m,n,c,this)}else for(let j=Math.max(0,w.start),F=Math.min(B.count,w.start+w.count);j<F;j++)rg.fromBufferAttribute(B,j),fy(rg,j,P,m,n,c,this)}updateMorphTargets(){const n=this.geometry.morphAttributes,c=Object.keys(n);if(c.length>0){const d=n[c[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,v=d.length;m<v;m++){const w=d[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[w]=m}}}}}function fy(b,n,c,d,m,v,w){const C=o0.distanceSqToPoint(b);if(C<c){const P=new Se;o0.closestPointToPoint(b,P),P.applyMatrix4(d);const D=m.ray.origin.distanceTo(P);if(D<m.near||D>m.far)return;v.push({distance:D,distanceToRay:Math.sqrt(C),point:P,index:n,face:null,object:w})}}class ng extends xr{constructor(n,c,d,m,v,w,C,P,D){super(n,c,d,m,v,w,C,P,D),this.isVideoTexture=!0,this.minFilter=w!==void 0?w:pn,this.magFilter=v!==void 0?v:pn,this.generateMipmaps=!1;const B=this;"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback(function j(){B.needsUpdate=!0,n.requestVideoFrameCallback(j)})}clone(){return new this.constructor(this.image).copy(this)}update(){const n=this.image;!("requestVideoFrameCallback"in n)&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class VA extends xr{constructor(n,c){super({width:n,height:c}),this.isFramebufferTexture=!0,this.magFilter=dn,this.minFilter=dn,this.generateMipmaps=!1,this.needsUpdate=!0}}class l0 extends xr{constructor(n,c,d,m,v,w,C,P,D,B,j,F){super(null,w,C,P,D,B,m,v,j,F),this.isCompressedTexture=!0,this.image={width:c,height:d},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}}class ns extends l0{constructor(n,c,d,m,v,w){super(n,c,d,v,w),this.isCompressedArrayTexture=!0,this.image.depth=m,this.wrapR=fs}}class GA extends xr{constructor(n,c,d,m,v,w,C,P,D){super(n,c,d,m,v,w,C,P,D),this.isCanvasTexture=!0,this.needsUpdate=!0}}class $o{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(n,c){const d=this.getUtoTmapping(n);return this.getPoint(d,c)}getPoints(n=5){const c=[];for(let d=0;d<=n;d++)c.push(this.getPoint(d/n));return c}getSpacedPoints(n=5){const c=[];for(let d=0;d<=n;d++)c.push(this.getPointAt(d/n));return c}getLength(){const n=this.getLengths();return n[n.length-1]}getLengths(n=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const c=[];let d,m=this.getPoint(0),v=0;c.push(0);for(let w=1;w<=n;w++)d=this.getPoint(w/n),v+=d.distanceTo(m),c.push(v),m=d;return this.cacheArcLengths=c,c}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(n,c){const d=this.getLengths();let m=0;const v=d.length;let w;w=c||n*d[v-1];let C,P=0,D=v-1;for(;P<=D;)if(m=Math.floor(P+(D-P)/2),C=d[m]-w,C<0)P=m+1;else{if(!(C>0)){D=m;break}D=m-1}if(m=D,d[m]===w)return m/(v-1);const B=d[m];return(m+(w-B)/(d[m+1]-B))/(v-1)}getTangent(n,c){let d=n-1e-4,m=n+1e-4;d<0&&(d=0),m>1&&(m=1);const v=this.getPoint(d),w=this.getPoint(m),C=c||(v.isVector2?new Jt:new Se);return C.copy(w).sub(v).normalize(),C}getTangentAt(n,c){const d=this.getUtoTmapping(n);return this.getTangent(d,c)}computeFrenetFrames(n,c){const d=new Se,m=[],v=[],w=[],C=new Se,P=new or;for(let z=0;z<=n;z++){const G=z/n;m[z]=this.getTangentAt(G,new Se)}v[0]=new Se,w[0]=new Se;let D=Number.MAX_VALUE;const B=Math.abs(m[0].x),j=Math.abs(m[0].y),F=Math.abs(m[0].z);B<=D&&(D=B,d.set(1,0,0)),j<=D&&(D=j,d.set(0,1,0)),F<=D&&d.set(0,0,1),C.crossVectors(m[0],d).normalize(),v[0].crossVectors(m[0],C),w[0].crossVectors(m[0],v[0]);for(let z=1;z<=n;z++){if(v[z]=v[z-1].clone(),w[z]=w[z-1].clone(),C.crossVectors(m[z-1],m[z]),C.length()>Number.EPSILON){C.normalize();const G=Math.acos(Kr(m[z-1].dot(m[z]),-1,1));v[z].applyMatrix4(P.makeRotationAxis(C,G))}w[z].crossVectors(m[z],v[z])}if(c===!0){let z=Math.acos(Kr(v[0].dot(v[n]),-1,1));z/=n,m[0].dot(C.crossVectors(v[0],v[n]))>0&&(z=-z);for(let G=1;G<=n;G++)v[G].applyMatrix4(P.makeRotationAxis(m[G],z*G)),w[G].crossVectors(m[G],v[G])}return{tangents:m,normals:v,binormals:w}}clone(){return new this.constructor().copy(this)}copy(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}toJSON(){const n={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n}fromJSON(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}}class kh extends $o{constructor(n=0,c=0,d=1,m=1,v=0,w=2*Math.PI,C=!1,P=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=n,this.aY=c,this.xRadius=d,this.yRadius=m,this.aStartAngle=v,this.aEndAngle=w,this.aClockwise=C,this.aRotation=P}getPoint(n,c){const d=c||new Jt,m=2*Math.PI;let v=this.aEndAngle-this.aStartAngle;const w=Math.abs(v)<Number.EPSILON;for(;v<0;)v+=m;for(;v>m;)v-=m;v<Number.EPSILON&&(v=w?0:m),this.aClockwise!==!0||w||(v===m?v=-m:v-=m);const C=this.aStartAngle+n*v;let P=this.aX+this.xRadius*Math.cos(C),D=this.aY+this.yRadius*Math.sin(C);if(this.aRotation!==0){const B=Math.cos(this.aRotation),j=Math.sin(this.aRotation),F=P-this.aX,z=D-this.aY;P=F*B-z*j+this.aX,D=F*j+z*B+this.aY}return d.set(P,D)}copy(n){return super.copy(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}toJSON(){const n=super.toJSON();return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n}fromJSON(n){return super.fromJSON(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}}class c0 extends kh{constructor(n,c,d,m,v,w){super(n,c,d,d,m,v,w),this.isArcCurve=!0,this.type="ArcCurve"}}function my(){let b=0,n=0,c=0,d=0;function m(v,w,C,P){b=v,n=C,c=-3*v+3*w-2*C-P,d=2*v-2*w+C+P}return{initCatmullRom:function(v,w,C,P,D){m(w,C,D*(C-v),D*(P-w))},initNonuniformCatmullRom:function(v,w,C,P,D,B,j){let F=(w-v)/D-(C-v)/(D+B)+(C-w)/B,z=(C-w)/B-(P-w)/(B+j)+(P-C)/j;F*=B,z*=B,m(w,C,F,z)},calc:function(v){const w=v*v;return b+n*v+c*w+d*(w*v)}}}const u0=new Se,gy=new my,vy=new my,_y=new my;class h0 extends $o{constructor(n=[],c=!1,d="centripetal",m=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=n,this.closed=c,this.curveType=d,this.tension=m}getPoint(n,c=new Se){const d=c,m=this.points,v=m.length,w=(v-(this.closed?0:1))*n;let C,P,D=Math.floor(w),B=w-D;this.closed?D+=D>0?0:(Math.floor(Math.abs(D)/v)+1)*v:B===0&&D===v-1&&(D=v-2,B=1),this.closed||D>0?C=m[(D-1)%v]:(u0.subVectors(m[0],m[1]).add(m[0]),C=u0);const j=m[D%v],F=m[(D+1)%v];if(this.closed||D+2<v?P=m[(D+2)%v]:(u0.subVectors(m[v-1],m[v-2]).add(m[v-1]),P=u0),this.curveType==="centripetal"||this.curveType==="chordal"){const z=this.curveType==="chordal"?.5:.25;let G=Math.pow(C.distanceToSquared(j),z),W=Math.pow(j.distanceToSquared(F),z),Q=Math.pow(F.distanceToSquared(P),z);W<1e-4&&(W=1),G<1e-4&&(G=W),Q<1e-4&&(Q=W),gy.initNonuniformCatmullRom(C.x,j.x,F.x,P.x,G,W,Q),vy.initNonuniformCatmullRom(C.y,j.y,F.y,P.y,G,W,Q),_y.initNonuniformCatmullRom(C.z,j.z,F.z,P.z,G,W,Q)}else this.curveType==="catmullrom"&&(gy.initCatmullRom(C.x,j.x,F.x,P.x,this.tension),vy.initCatmullRom(C.y,j.y,F.y,P.y,this.tension),_y.initCatmullRom(C.z,j.z,F.z,P.z,this.tension));return d.set(gy.calc(B),vy.calc(B),_y.calc(B)),d}copy(n){super.copy(n),this.points=[];for(let c=0,d=n.points.length;c<d;c++){const m=n.points[c];this.points.push(m.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let c=0,d=this.points.length;c<d;c++){const m=this.points[c];n.points.push(m.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let c=0,d=n.points.length;c<d;c++){const m=n.points[c];this.points.push(new Se().fromArray(m))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function HA(b,n,c,d,m){const v=.5*(d-n),w=.5*(m-c),C=b*b;return(2*c-2*d+v+w)*(b*C)+(-3*c+3*d-2*v-w)*C+v*b+c}function sg(b,n,c,d){return function(m,v){const w=1-m;return w*w*v}(b,n)+function(m,v){return 2*(1-m)*m*v}(b,c)+function(m,v){return m*m*v}(b,d)}function Uf(b,n,c,d,m){return function(v,w){const C=1-v;return C*C*C*w}(b,n)+function(v,w){const C=1-v;return 3*C*C*v*w}(b,c)+function(v,w){return 3*(1-v)*v*v*w}(b,d)+function(v,w){return v*v*v*w}(b,m)}class Nf extends $o{constructor(n=new Jt,c=new Jt,d=new Jt,m=new Jt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=n,this.v1=c,this.v2=d,this.v3=m}getPoint(n,c=new Jt){const d=c,m=this.v0,v=this.v1,w=this.v2,C=this.v3;return d.set(Uf(n,m.x,v.x,w.x,C.x),Uf(n,m.y,v.y,w.y,C.y)),d}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class yy extends $o{constructor(n=new Se,c=new Se,d=new Se,m=new Se){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=n,this.v1=c,this.v2=d,this.v3=m}getPoint(n,c=new Se){const d=c,m=this.v0,v=this.v1,w=this.v2,C=this.v3;return d.set(Uf(n,m.x,v.x,w.x,C.x),Uf(n,m.y,v.y,w.y,C.y),Uf(n,m.z,v.z,w.z,C.z)),d}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}class Ff extends $o{constructor(n=new Jt,c=new Jt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=n,this.v2=c}getPoint(n,c=new Jt){const d=c;return n===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(n).add(this.v1)),d}getPointAt(n,c){return this.getPoint(n,c)}getTangent(n,c=new Jt){return c.subVectors(this.v2,this.v1).normalize()}getTangentAt(n,c){return this.getTangent(n,c)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class jf extends $o{constructor(n=new Se,c=new Se){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=n,this.v2=c}getPoint(n,c=new Se){const d=c;return n===1?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(n).add(this.v1)),d}getPointAt(n,c){return this.getPoint(n,c)}getTangent(n,c=new Se){return c.subVectors(this.v2,this.v1).normalize()}getTangentAt(n,c){return this.getTangent(n,c)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class d0 extends $o{constructor(n=new Jt,c=new Jt,d=new Jt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=n,this.v1=c,this.v2=d}getPoint(n,c=new Jt){const d=c,m=this.v0,v=this.v1,w=this.v2;return d.set(sg(n,m.x,v.x,w.x),sg(n,m.y,v.y,w.y)),d}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class hp extends $o{constructor(n=new Se,c=new Se,d=new Se){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=n,this.v1=c,this.v2=d}getPoint(n,c=new Se){const d=c,m=this.v0,v=this.v1,w=this.v2;return d.set(sg(n,m.x,v.x,w.x),sg(n,m.y,v.y,w.y),sg(n,m.z,v.z,w.z)),d}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class zf extends $o{constructor(n=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=n}getPoint(n,c=new Jt){const d=c,m=this.points,v=(m.length-1)*n,w=Math.floor(v),C=v-w,P=m[w===0?w:w-1],D=m[w],B=m[w>m.length-2?m.length-1:w+1],j=m[w>m.length-3?m.length-1:w+2];return d.set(HA(C,P.x,D.x,B.x,j.x),HA(C,P.y,D.y,B.y,j.y)),d}copy(n){super.copy(n),this.points=[];for(let c=0,d=n.points.length;c<d;c++){const m=n.points[c];this.points.push(m.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let c=0,d=this.points.length;c<d;c++){const m=this.points[c];n.points.push(m.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let c=0,d=n.points.length;c<d;c++){const m=n.points[c];this.points.push(new Jt().fromArray(m))}return this}}var ag=Object.freeze({__proto__:null,ArcCurve:c0,CatmullRomCurve3:h0,CubicBezierCurve:Nf,CubicBezierCurve3:yy,EllipseCurve:kh,LineCurve:Ff,LineCurve3:jf,QuadraticBezierCurve:d0,QuadraticBezierCurve3:hp,SplineCurve:zf});class QA extends $o{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(n){this.curves.push(n)}closePath(){const n=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);n.equals(c)||this.curves.push(new Ff(c,n))}getPoint(n,c){const d=n*this.getLength(),m=this.getCurveLengths();let v=0;for(;v<m.length;){if(m[v]>=d){const w=m[v]-d,C=this.curves[v],P=C.getLength(),D=P===0?0:1-w/P;return C.getPointAt(D,c)}v++}return null}getLength(){const n=this.getCurveLengths();return n[n.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let c=0;for(let d=0,m=this.curves.length;d<m;d++)c+=this.curves[d].getLength(),n.push(c);return this.cacheLengths=n,n}getSpacedPoints(n=40){const c=[];for(let d=0;d<=n;d++)c.push(this.getPoint(d/n));return this.autoClose&&c.push(c[0]),c}getPoints(n=12){const c=[];let d;for(let m=0,v=this.curves;m<v.length;m++){const w=v[m],C=w.isEllipseCurve?2*n:w.isLineCurve||w.isLineCurve3?1:w.isSplineCurve?n*w.points.length:n,P=w.getPoints(C);for(let D=0;D<P.length;D++){const B=P[D];d&&d.equals(B)||(c.push(B),d=B)}}return this.autoClose&&c.length>1&&!c[c.length-1].equals(c[0])&&c.push(c[0]),c}copy(n){super.copy(n),this.curves=[];for(let c=0,d=n.curves.length;c<d;c++){const m=n.curves[c];this.curves.push(m.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let c=0,d=this.curves.length;c<d;c++){const m=this.curves[c];n.curves.push(m.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let c=0,d=n.curves.length;c<d;c++){const m=n.curves[c];this.curves.push(new ag[m.type]().fromJSON(m))}return this}}class Nu extends QA{constructor(n){super(),this.type="Path",this.currentPoint=new Jt,n&&this.setFromPoints(n)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let c=1,d=n.length;c<d;c++)this.lineTo(n[c].x,n[c].y);return this}moveTo(n,c){return this.currentPoint.set(n,c),this}lineTo(n,c){const d=new Ff(this.currentPoint.clone(),new Jt(n,c));return this.curves.push(d),this.currentPoint.set(n,c),this}quadraticCurveTo(n,c,d,m){const v=new d0(this.currentPoint.clone(),new Jt(n,c),new Jt(d,m));return this.curves.push(v),this.currentPoint.set(d,m),this}bezierCurveTo(n,c,d,m,v,w){const C=new Nf(this.currentPoint.clone(),new Jt(n,c),new Jt(d,m),new Jt(v,w));return this.curves.push(C),this.currentPoint.set(v,w),this}splineThru(n){const c=[this.currentPoint.clone()].concat(n),d=new zf(c);return this.curves.push(d),this.currentPoint.copy(n[n.length-1]),this}arc(n,c,d,m,v,w){const C=this.currentPoint.x,P=this.currentPoint.y;return this.absarc(n+C,c+P,d,m,v,w),this}absarc(n,c,d,m,v,w){return this.absellipse(n,c,d,d,m,v,w),this}ellipse(n,c,d,m,v,w,C,P){const D=this.currentPoint.x,B=this.currentPoint.y;return this.absellipse(n+D,c+B,d,m,v,w,C,P),this}absellipse(n,c,d,m,v,w,C,P){const D=new kh(n,c,d,m,v,w,C,P);if(this.curves.length>0){const j=D.getPoint(0);j.equals(this.currentPoint)||this.lineTo(j.x,j.y)}this.curves.push(D);const B=D.getPoint(1);return this.currentPoint.copy(B),this}copy(n){return super.copy(n),this.currentPoint.copy(n.currentPoint),this}toJSON(){const n=super.toJSON();return n.currentPoint=this.currentPoint.toArray(),n}fromJSON(n){return super.fromJSON(n),this.currentPoint.fromArray(n.currentPoint),this}}class Fu extends hr{constructor(n=[new Jt(0,-.5),new Jt(.5,0),new Jt(0,.5)],c=12,d=0,m=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:n,segments:c,phiStart:d,phiLength:m},c=Math.floor(c),m=Kr(m,0,2*Math.PI);const v=[],w=[],C=[],P=[],D=[],B=1/c,j=new Se,F=new Jt,z=new Se,G=new Se,W=new Se;let Q=0,$=0;for(let Y=0;Y<=n.length-1;Y++)switch(Y){case 0:Q=n[Y+1].x-n[Y].x,$=n[Y+1].y-n[Y].y,z.x=1*$,z.y=-Q,z.z=0*$,W.copy(z),z.normalize(),P.push(z.x,z.y,z.z);break;case n.length-1:P.push(W.x,W.y,W.z);break;default:Q=n[Y+1].x-n[Y].x,$=n[Y+1].y-n[Y].y,z.x=1*$,z.y=-Q,z.z=0*$,G.copy(z),z.x+=W.x,z.y+=W.y,z.z+=W.z,z.normalize(),P.push(z.x,z.y,z.z),W.copy(G)}for(let Y=0;Y<=c;Y++){const q=d+Y*B*m,be=Math.sin(q),we=Math.cos(q);for(let me=0;me<=n.length-1;me++){j.x=n[me].x*be,j.y=n[me].y,j.z=n[me].x*we,w.push(j.x,j.y,j.z),F.x=Y/c,F.y=me/(n.length-1),C.push(F.x,F.y);const Be=P[3*me+0]*be,Ze=P[3*me+1],et=P[3*me+0]*we;D.push(Be,Ze,et)}}for(let Y=0;Y<c;Y++)for(let q=0;q<n.length-1;q++){const be=q+Y*n.length,we=be,me=be+n.length,Be=be+n.length+1,Ze=be+1;v.push(we,me,Ze),v.push(Be,Ze,me)}this.setIndex(v),this.setAttribute("position",new pe(w,3)),this.setAttribute("uv",new pe(C,2)),this.setAttribute("normal",new pe(D,3))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new Fu(n.points,n.segments,n.phiStart,n.phiLength)}}class Vf extends Fu{constructor(n=1,c=1,d=4,m=8){const v=new Nu;v.absarc(0,-c/2,n,1.5*Math.PI,0),v.absarc(0,c/2,n,0,.5*Math.PI),super(v.getPoints(d),m),this.type="CapsuleGeometry",this.parameters={radius:n,height:c,capSegments:d,radialSegments:m}}static fromJSON(n){return new Vf(n.radius,n.length,n.capSegments,n.radialSegments)}}class dp extends hr{constructor(n=1,c=32,d=0,m=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:c,thetaStart:d,thetaLength:m},c=Math.max(3,c);const v=[],w=[],C=[],P=[],D=new Se,B=new Jt;w.push(0,0,0),C.push(0,0,1),P.push(.5,.5);for(let j=0,F=3;j<=c;j++,F+=3){const z=d+j/c*m;D.x=n*Math.cos(z),D.y=n*Math.sin(z),w.push(D.x,D.y,D.z),C.push(0,0,1),B.x=(w[F]/n+1)/2,B.y=(w[F+1]/n+1)/2,P.push(B.x,B.y)}for(let j=1;j<=c;j++)v.push(j,j+1,0);this.setIndex(v),this.setAttribute("position",new pe(w,3)),this.setAttribute("normal",new pe(C,3)),this.setAttribute("uv",new pe(P,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new dp(n.radius,n.segments,n.thetaStart,n.thetaLength)}}class Uh extends hr{constructor(n=1,c=1,d=1,m=32,v=1,w=!1,C=0,P=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:n,radiusBottom:c,height:d,radialSegments:m,heightSegments:v,openEnded:w,thetaStart:C,thetaLength:P};const D=this;m=Math.floor(m),v=Math.floor(v);const B=[],j=[],F=[],z=[];let G=0;const W=[],Q=d/2;let $=0;function Y(q){const be=G,we=new Jt,me=new Se;let Be=0;const Ze=q===!0?n:c,et=q===!0?1:-1;for(let Le=1;Le<=m;Le++)j.push(0,Q*et,0),F.push(0,et,0),z.push(.5,.5),G++;const ft=G;for(let Le=0;Le<=m;Le++){const Gt=Le/m*P+C,Ht=Math.cos(Gt),ri=Math.sin(Gt);me.x=Ze*ri,me.y=Q*et,me.z=Ze*Ht,j.push(me.x,me.y,me.z),F.push(0,et,0),we.x=.5*Ht+.5,we.y=.5*ri*et+.5,z.push(we.x,we.y),G++}for(let Le=0;Le<m;Le++){const Gt=be+Le,Ht=ft+Le;q===!0?B.push(Ht,Ht+1,Gt):B.push(Ht+1,Ht,Gt),Be+=3}D.addGroup($,Be,q===!0?1:2),$+=Be}(function(){const q=new Se,be=new Se;let we=0;const me=(c-n)/d;for(let Be=0;Be<=v;Be++){const Ze=[],et=Be/v,ft=et*(c-n)+n;for(let Le=0;Le<=m;Le++){const Gt=Le/m,Ht=Gt*P+C,ri=Math.sin(Ht),hi=Math.cos(Ht);be.x=ft*ri,be.y=-et*d+Q,be.z=ft*hi,j.push(be.x,be.y,be.z),q.set(ri,me,hi).normalize(),F.push(q.x,q.y,q.z),z.push(Gt,1-et),Ze.push(G++)}W.push(Ze)}for(let Be=0;Be<m;Be++)for(let Ze=0;Ze<v;Ze++){const et=W[Ze][Be],ft=W[Ze+1][Be],Le=W[Ze+1][Be+1],Gt=W[Ze][Be+1];B.push(et,ft,Gt),B.push(ft,Le,Gt),we+=6}D.addGroup($,we,0),$+=we})(),w===!1&&(n>0&&Y(!0),c>0&&Y(!1)),this.setIndex(B),this.setAttribute("position",new pe(j,3)),this.setAttribute("normal",new pe(F,3)),this.setAttribute("uv",new pe(z,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new Uh(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class og extends Uh{constructor(n=1,c=1,d=32,m=1,v=!1,w=0,C=2*Math.PI){super(0,n,c,d,m,v,w,C),this.type="ConeGeometry",this.parameters={radius:n,height:c,radialSegments:d,heightSegments:m,openEnded:v,thetaStart:w,thetaLength:C}}static fromJSON(n){return new og(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)}}class _c extends hr{constructor(n=[],c=[],d=1,m=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:c,radius:d,detail:m};const v=[],w=[];function C(F,z,G,W){const Q=W+1,$=[];for(let Y=0;Y<=Q;Y++){$[Y]=[];const q=F.clone().lerp(G,Y/Q),be=z.clone().lerp(G,Y/Q),we=Q-Y;for(let me=0;me<=we;me++)$[Y][me]=me===0&&Y===Q?q:q.clone().lerp(be,me/we)}for(let Y=0;Y<Q;Y++)for(let q=0;q<2*(Q-Y)-1;q++){const be=Math.floor(q/2);q%2==0?(P($[Y][be+1]),P($[Y+1][be]),P($[Y][be])):(P($[Y][be+1]),P($[Y+1][be+1]),P($[Y+1][be]))}}function P(F){v.push(F.x,F.y,F.z)}function D(F,z){const G=3*F;z.x=n[G+0],z.y=n[G+1],z.z=n[G+2]}function B(F,z,G,W){W<0&&F.x===1&&(w[z]=F.x-1),G.x===0&&G.z===0&&(w[z]=W/2/Math.PI+.5)}function j(F){return Math.atan2(F.z,-F.x)}(function(F){const z=new Se,G=new Se,W=new Se;for(let Q=0;Q<c.length;Q+=3)D(c[Q+0],z),D(c[Q+1],G),D(c[Q+2],W),C(z,G,W,F)})(m),function(F){const z=new Se;for(let G=0;G<v.length;G+=3)z.x=v[G+0],z.y=v[G+1],z.z=v[G+2],z.normalize().multiplyScalar(F),v[G+0]=z.x,v[G+1]=z.y,v[G+2]=z.z}(d),function(){const F=new Se;for(let G=0;G<v.length;G+=3){F.x=v[G+0],F.y=v[G+1],F.z=v[G+2];const W=j(F)/2/Math.PI+.5,Q=(z=F,Math.atan2(-z.y,Math.sqrt(z.x*z.x+z.z*z.z))/Math.PI+.5);w.push(W,1-Q)}var z;(function(){const G=new Se,W=new Se,Q=new Se,$=new Se,Y=new Jt,q=new Jt,be=new Jt;for(let we=0,me=0;we<v.length;we+=9,me+=6){G.set(v[we+0],v[we+1],v[we+2]),W.set(v[we+3],v[we+4],v[we+5]),Q.set(v[we+6],v[we+7],v[we+8]),Y.set(w[me+0],w[me+1]),q.set(w[me+2],w[me+3]),be.set(w[me+4],w[me+5]),$.copy(G).add(W).add(Q).divideScalar(3);const Be=j($);B(Y,me+0,G,Be),B(q,me+2,W,Be),B(be,me+4,Q,Be)}})(),function(){for(let G=0;G<w.length;G+=6){const W=w[G+0],Q=w[G+2],$=w[G+4],Y=Math.max(W,Q,$),q=Math.min(W,Q,$);Y>.9&&q<.1&&(W<.2&&(w[G+0]+=1),Q<.2&&(w[G+2]+=1),$<.2&&(w[G+4]+=1))}}()}(),this.setAttribute("position",new pe(v,3)),this.setAttribute("normal",new pe(v.slice(),3)),this.setAttribute("uv",new pe(w,2)),m===0?this.computeVertexNormals():this.normalizeNormals()}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new _c(n.vertices,n.indices,n.radius,n.details)}}class ru extends _c{constructor(n=1,c=0){const d=(1+Math.sqrt(5))/2,m=1/d;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-m,-d,0,-m,d,0,m,-d,0,m,d,-m,-d,0,-m,d,0,m,-d,0,m,d,0,-d,0,-m,d,0,-m,-d,0,m,d,0,m],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,c),this.type="DodecahedronGeometry",this.parameters={radius:n,detail:c}}static fromJSON(n){return new ru(n.radius,n.detail)}}const Gf=new Se,p0=new Se,pp=new Se,ju=new bs;class WA extends hr{constructor(n=null,c=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:n,thresholdAngle:c},n!==null){const d=Math.pow(10,4),m=Math.cos(_u*c),v=n.getIndex(),w=n.getAttribute("position"),C=v?v.count:w.count,P=[0,0,0],D=["a","b","c"],B=new Array(3),j={},F=[];for(let z=0;z<C;z+=3){v?(P[0]=v.getX(z),P[1]=v.getX(z+1),P[2]=v.getX(z+2)):(P[0]=z,P[1]=z+1,P[2]=z+2);const{a:G,b:W,c:Q}=ju;if(G.fromBufferAttribute(w,P[0]),W.fromBufferAttribute(w,P[1]),Q.fromBufferAttribute(w,P[2]),ju.getNormal(pp),B[0]=`${Math.round(G.x*d)},${Math.round(G.y*d)},${Math.round(G.z*d)}`,B[1]=`${Math.round(W.x*d)},${Math.round(W.y*d)},${Math.round(W.z*d)}`,B[2]=`${Math.round(Q.x*d)},${Math.round(Q.y*d)},${Math.round(Q.z*d)}`,B[0]!==B[1]&&B[1]!==B[2]&&B[2]!==B[0])for(let $=0;$<3;$++){const Y=($+1)%3,q=B[$],be=B[Y],we=ju[D[$]],me=ju[D[Y]],Be=`${q}_${be}`,Ze=`${be}_${q}`;Ze in j&&j[Ze]?(pp.dot(j[Ze].normal)<=m&&(F.push(we.x,we.y,we.z),F.push(me.x,me.y,me.z)),j[Ze]=null):Be in j||(j[Be]={index0:P[$],index1:P[Y],normal:pp.clone()})}}for(const z in j)if(j[z]){const{index0:G,index1:W}=j[z];Gf.fromBufferAttribute(w,G),p0.fromBufferAttribute(w,W),F.push(Gf.x,Gf.y,Gf.z),F.push(p0.x,p0.y,p0.z)}this.setAttribute("position",new pe(F,3))}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}}class fp extends Nu{constructor(n){super(n),this.uuid=ts(),this.type="Shape",this.holes=[]}getPointsHoles(n){const c=[];for(let d=0,m=this.holes.length;d<m;d++)c[d]=this.holes[d].getPoints(n);return c}extractPoints(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}}copy(n){super.copy(n),this.holes=[];for(let c=0,d=n.holes.length;c<d;c++){const m=n.holes[c];this.holes.push(m.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let c=0,d=this.holes.length;c<d;c++){const m=this.holes[c];n.holes.push(m.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let c=0,d=n.holes.length;c<d;c++){const m=n.holes[c];this.holes.push(new Nu().fromJSON(m))}return this}}function by(b,n,c,d,m){let v,w;if(m===function(C,P,D,B){let j=0;for(let F=P,z=D-B;F<D;F+=B)j+=(C[z]-C[F])*(C[F+1]+C[z+1]),z=F;return j}(b,n,c,d)>0)for(v=n;v<c;v+=d)w=ew(v,b[v],b[v+1],w);else for(v=c-d;v>=n;v-=d)w=ew(v,b[v],b[v+1],w);return w&&lg(w,w.next)&&(Vu(w),w=w.next),w}function zu(b,n){if(!b)return b;n||(n=b);let c,d=b;do if(c=!1,d.steiner||!lg(d,d.next)&&Fn(d.prev,d,d.next)!==0)d=d.next;else{if(Vu(d),d=n=d.prev,d===d.next)break;c=!0}while(c||d!==n);return n}function Nh(b,n,c,d,m,v,w){if(!b)return;!w&&v&&function(B,j,F,z){let G=B;do G.z===0&&(G.z=Ay(G.x,G.y,j,F,z)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==B);G.prevZ.nextZ=null,G.prevZ=null,function(W){let Q,$,Y,q,be,we,me,Be,Ze=1;do{for($=W,W=null,be=null,we=0;$;){for(we++,Y=$,me=0,Q=0;Q<Ze&&(me++,Y=Y.nextZ,Y);Q++);for(Be=Ze;me>0||Be>0&&Y;)me!==0&&(Be===0||!Y||$.z<=Y.z)?(q=$,$=$.nextZ,me--):(q=Y,Y=Y.nextZ,Be--),be?be.nextZ=q:W=q,q.prevZ=be,be=q;$=Y}be.nextZ=null,Ze*=2}while(we>1)}(G)}(b,d,m,v);let C,P,D=b;for(;b.prev!==b.next;)if(C=b.prev,P=b.next,v?qA(b,d,m,v):XA(b))n.push(C.i/c|0),n.push(b.i/c|0),n.push(P.i/c|0),Vu(b),b=P.next,D=P.next;else if((b=P)===D){w?w===1?Nh(b=YA(zu(b),n,c),n,c,d,m,v,2):w===2&&KA(b,n,c,d,m,v):Nh(zu(b),n,c,d,m,v,1);break}}function XA(b){const n=b.prev,c=b,d=b.next;if(Fn(n,c,d)>=0)return!1;const m=n.x,v=c.x,w=d.x,C=n.y,P=c.y,D=d.y,B=m<v?m<w?m:w:v<w?v:w,j=C<P?C<D?C:D:P<D?P:D,F=m>v?m>w?m:w:v>w?v:w,z=C>P?C>D?C:D:P>D?P:D;let G=d.next;for(;G!==n;){if(G.x>=B&&G.x<=F&&G.y>=j&&G.y<=z&&Hf(m,C,v,P,w,D,G.x,G.y)&&Fn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function qA(b,n,c,d){const m=b.prev,v=b,w=b.next;if(Fn(m,v,w)>=0)return!1;const C=m.x,P=v.x,D=w.x,B=m.y,j=v.y,F=w.y,z=C<P?C<D?C:D:P<D?P:D,G=B<j?B<F?B:F:j<F?j:F,W=C>P?C>D?C:D:P>D?P:D,Q=B>j?B>F?B:F:j>F?j:F,$=Ay(z,G,n,c,d),Y=Ay(W,Q,n,c,d);let q=b.prevZ,be=b.nextZ;for(;q&&q.z>=$&&be&&be.z<=Y;){if(q.x>=z&&q.x<=W&&q.y>=G&&q.y<=Q&&q!==m&&q!==w&&Hf(C,B,P,j,D,F,q.x,q.y)&&Fn(q.prev,q,q.next)>=0||(q=q.prevZ,be.x>=z&&be.x<=W&&be.y>=G&&be.y<=Q&&be!==m&&be!==w&&Hf(C,B,P,j,D,F,be.x,be.y)&&Fn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;q&&q.z>=$;){if(q.x>=z&&q.x<=W&&q.y>=G&&q.y<=Q&&q!==m&&q!==w&&Hf(C,B,P,j,D,F,q.x,q.y)&&Fn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;be&&be.z<=Y;){if(be.x>=z&&be.x<=W&&be.y>=G&&be.y<=Q&&be!==m&&be!==w&&Hf(C,B,P,j,D,F,be.x,be.y)&&Fn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function YA(b,n,c){let d=b;do{const m=d.prev,v=d.next.next;!lg(m,v)&&$A(m,d,d.next,v)&&ug(m,v)&&ug(v,m)&&(n.push(m.i/c|0),n.push(d.i/c|0),n.push(v.i/c|0),Vu(d),Vu(d.next),d=b=v),d=d.next}while(d!==b);return zu(d)}function KA(b,n,c,d,m,v){let w=b;do{let C=w.next.next;for(;C!==w.prev;){if(w.i!==C.i&&xy(w,C)){let P=f0(w,C);return w=zu(w,w.next),P=zu(P,P.next),Nh(w,n,c,d,m,v,0),void Nh(P,n,c,d,m,v,0)}C=C.next}w=w.next}while(w!==b)}function ZA(b,n){return b.x-n.x}function cE(b,n){const c=function(m,v){let w,C=v,P=-1/0;const D=m.x,B=m.y;do{if(B<=C.y&&B>=C.next.y&&C.next.y!==C.y){const Q=C.x+(B-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(Q<=D&&Q>P&&(P=Q,w=C.x<C.next.x?C:C.next,Q===D))return w}C=C.next}while(C!==v);if(!w)return null;const j=w,F=w.x,z=w.y;let G,W=1/0;C=w;do D>=C.x&&C.x>=F&&D!==C.x&&Hf(B<z?D:P,B,F,z,B<z?P:D,B,C.x,C.y)&&(G=Math.abs(B-C.y)/(D-C.x),ug(C,m)&&(G<W||G===W&&(C.x>w.x||C.x===w.x&&JA(w,C)))&&(w=C,W=G)),C=C.next;while(C!==j);return w}(b,n);if(!c)return n;const d=f0(c,b);return zu(d,d.next),zu(c,c.next)}function JA(b,n){return Fn(b.prev,b,n.prev)<0&&Fn(n.next,b,b.next)<0}function Ay(b,n,c,d,m){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=(b-c)*m|0)|b<<8))|b<<4))|b<<2))|b<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*m|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function wy(b){let n=b,c=b;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==b);return c}function Hf(b,n,c,d,m,v,w,C){return(m-w)*(n-C)>=(b-w)*(v-C)&&(b-w)*(d-C)>=(c-w)*(n-C)&&(c-w)*(v-C)>=(m-w)*(d-C)}function xy(b,n){return b.next.i!==n.i&&b.prev.i!==n.i&&!function(c,d){let m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==d.i&&m.next.i!==d.i&&$A(m,m.next,c,d))return!0;m=m.next}while(m!==c);return!1}(b,n)&&(ug(b,n)&&ug(n,b)&&function(c,d){let m=c,v=!1;const w=(c.x+d.x)/2,C=(c.y+d.y)/2;do m.y>C!=m.next.y>C&&m.next.y!==m.y&&w<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==c);return v}(b,n)&&(Fn(b.prev,b,n.prev)||Fn(b,n.prev,n))||lg(b,n)&&Fn(b.prev,b,b.next)>0&&Fn(n.prev,n,n.next)>0)}function Fn(b,n,c){return(n.y-b.y)*(c.x-n.x)-(n.x-b.x)*(c.y-n.y)}function lg(b,n){return b.x===n.x&&b.y===n.y}function $A(b,n,c,d){const m=Qf(Fn(b,n,c)),v=Qf(Fn(b,n,d)),w=Qf(Fn(c,d,b)),C=Qf(Fn(c,d,n));return m!==v&&w!==C||!(m!==0||!cg(b,c,n))||!(v!==0||!cg(b,d,n))||!(w!==0||!cg(c,b,d))||!(C!==0||!cg(c,n,d))}function cg(b,n,c){return n.x<=Math.max(b.x,c.x)&&n.x>=Math.min(b.x,c.x)&&n.y<=Math.max(b.y,c.y)&&n.y>=Math.min(b.y,c.y)}function Qf(b){return b>0?1:b<0?-1:0}function ug(b,n){return Fn(b.prev,b,b.next)<0?Fn(b,n,b.next)>=0&&Fn(b,b.prev,n)>=0:Fn(b,n,b.prev)<0||Fn(b,b.next,n)<0}function f0(b,n){const c=new m0(b.i,b.x,b.y),d=new m0(n.i,n.x,n.y),m=b.next,v=n.prev;return b.next=n,n.prev=b,c.next=m,m.prev=c,d.next=c,c.prev=d,v.next=d,d.prev=v,d}function ew(b,n,c,d){const m=new m0(b,n,c);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function Vu(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function m0(b,n,c){this.i=b,this.x=n,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class yc{static area(n){const c=n.length;let d=0;for(let m=c-1,v=0;v<c;m=v++)d+=n[m].x*n[v].y-n[v].x*n[m].y;return .5*d}static isClockWise(n){return yc.area(n)<0}static triangulateShape(n,c){const d=[],m=[],v=[];Ey(n),tw(d,n);let w=n.length;c.forEach(Ey);for(let P=0;P<c.length;P++)m.push(w),w+=c[P].length,tw(d,c[P]);const C=function(P,D,B=2){const j=D&&D.length,F=j?D[0]*B:P.length;let z=by(P,0,F,B,!0);const G=[];if(!z||z.next===z.prev)return G;let W,Q,$,Y,q,be,we;if(j&&(z=function(me,Be,Ze,et){const ft=[];let Le,Gt,Ht,ri,hi;for(Le=0,Gt=Be.length;Le<Gt;Le++)Ht=Be[Le]*et,ri=Le<Gt-1?Be[Le+1]*et:me.length,hi=by(me,Ht,ri,et,!1),hi===hi.next&&(hi.steiner=!0),ft.push(wy(hi));for(ft.sort(ZA),Le=0;Le<ft.length;Le++)Ze=cE(ft[Le],Ze);return Ze}(P,D,z,B)),P.length>80*B){W=$=P[0],Q=Y=P[1];for(let me=B;me<F;me+=B)q=P[me],be=P[me+1],q<W&&(W=q),be<Q&&(Q=be),q>$&&($=q),be>Y&&(Y=be);we=Math.max($-W,Y-Q),we=we!==0?32767/we:0}return Nh(z,G,B,W,Q,we,0),G}(d,m);for(let P=0;P<C.length;P+=3)v.push(C.slice(P,P+3));return v}}function Ey(b){const n=b.length;n>2&&b[n-1].equals(b[0])&&b.pop()}function tw(b,n){for(let c=0;c<n.length;c++)b.push(n[c].x),b.push(n[c].y)}class Wf extends hr{constructor(n=new fp([new Jt(.5,.5),new Jt(-.5,.5),new Jt(-.5,-.5),new Jt(.5,-.5)]),c={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:c},n=Array.isArray(n)?n:[n];const d=this,m=[],v=[];for(let C=0,P=n.length;C<P;C++)w(n[C]);function w(C){const P=[],D=c.curveSegments!==void 0?c.curveSegments:12,B=c.steps!==void 0?c.steps:1,j=c.depth!==void 0?c.depth:1;let F=c.bevelEnabled===void 0||c.bevelEnabled,z=c.bevelThickness!==void 0?c.bevelThickness:.2,G=c.bevelSize!==void 0?c.bevelSize:z-.1,W=c.bevelOffset!==void 0?c.bevelOffset:0,Q=c.bevelSegments!==void 0?c.bevelSegments:3;const $=c.extrudePath,Y=c.UVGenerator!==void 0?c.UVGenerator:Sy;let q,be,we,me,Be,Ze=!1;$&&(q=$.getSpacedPoints(B),Ze=!0,F=!1,be=$.computeFrenetFrames(B,!1),we=new Se,me=new Se,Be=new Se),F||(Q=0,z=0,G=0,W=0);const et=C.extractPoints(D);let ft=et.shape;const Le=et.holes;if(!yc.isClockWise(ft)){ft=ft.reverse();for(let Ge=0,ht=Le.length;Ge<ht;Ge++){const Oe=Le[Ge];yc.isClockWise(Oe)&&(Le[Ge]=Oe.reverse())}}const Gt=yc.triangulateShape(ft,Le),Ht=ft;for(let Ge=0,ht=Le.length;Ge<ht;Ge++){const Oe=Le[Ge];ft=ft.concat(Oe)}function ri(Ge,ht,Oe){return ht||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ge.clone().addScaledVector(ht,Oe)}const hi=ft.length,ei=Gt.length;function Xt(Ge,ht,Oe){let ye,ke,ze;const rt=Ge.x-ht.x,Et=Ge.y-ht.y,Vt=Oe.x-Ge.x,Yt=Oe.y-Ge.y,Fi=rt*rt+Et*Et,Ki=rt*Yt-Et*Vt;if(Math.abs(Ki)>Number.EPSILON){const Ti=Math.sqrt(Fi),tr=Math.sqrt(Vt*Vt+Yt*Yt),dr=ht.x-Et/Ti,Jr=ht.y+rt/Ti,nr=((Oe.x-Yt/tr-dr)*Yt-(Oe.y+Vt/tr-Jr)*Vt)/(rt*Yt-Et*Vt);ye=dr+rt*nr-Ge.x,ke=Jr+Et*nr-Ge.y;const qr=ye*ye+ke*ke;if(qr<=2)return new Jt(ye,ke);ze=Math.sqrt(qr/2)}else{let Ti=!1;rt>Number.EPSILON?Vt>Number.EPSILON&&(Ti=!0):rt<-Number.EPSILON?Vt<-Number.EPSILON&&(Ti=!0):Math.sign(Et)===Math.sign(Yt)&&(Ti=!0),Ti?(ye=-Et,ke=rt,ze=Math.sqrt(Fi)):(ye=rt,ke=Et,ze=Math.sqrt(Fi/2))}return new Jt(ye/ze,ke/ze)}const oi=[];for(let Ge=0,ht=Ht.length,Oe=ht-1,ye=Ge+1;Ge<ht;Ge++,Oe++,ye++)Oe===ht&&(Oe=0),ye===ht&&(ye=0),oi[Ge]=Xt(Ht[Ge],Ht[Oe],Ht[ye]);const Pt=[];let Nt,ci=oi.concat();for(let Ge=0,ht=Le.length;Ge<ht;Ge++){const Oe=Le[Ge];Nt=[];for(let ye=0,ke=Oe.length,ze=ke-1,rt=ye+1;ye<ke;ye++,ze++,rt++)ze===ke&&(ze=0),rt===ke&&(rt=0),Nt[ye]=Xt(Oe[ye],Oe[ze],Oe[rt]);Pt.push(Nt),ci=ci.concat(Nt)}for(let Ge=0;Ge<Q;Ge++){const ht=Ge/Q,Oe=z*Math.cos(ht*Math.PI/2),ye=G*Math.sin(ht*Math.PI/2)+W;for(let ke=0,ze=Ht.length;ke<ze;ke++){const rt=ri(Ht[ke],oi[ke],ye);yi(rt.x,rt.y,-Oe)}for(let ke=0,ze=Le.length;ke<ze;ke++){const rt=Le[ke];Nt=Pt[ke];for(let Et=0,Vt=rt.length;Et<Vt;Et++){const Yt=ri(rt[Et],Nt[Et],ye);yi(Yt.x,Yt.y,-Oe)}}}const pi=G+W;for(let Ge=0;Ge<hi;Ge++){const ht=F?ri(ft[Ge],ci[Ge],pi):ft[Ge];Ze?(me.copy(be.normals[0]).multiplyScalar(ht.x),we.copy(be.binormals[0]).multiplyScalar(ht.y),Be.copy(q[0]).add(me).add(we),yi(Be.x,Be.y,Be.z)):yi(ht.x,ht.y,0)}for(let Ge=1;Ge<=B;Ge++)for(let ht=0;ht<hi;ht++){const Oe=F?ri(ft[ht],ci[ht],pi):ft[ht];Ze?(me.copy(be.normals[Ge]).multiplyScalar(Oe.x),we.copy(be.binormals[Ge]).multiplyScalar(Oe.y),Be.copy(q[Ge]).add(me).add(we),yi(Be.x,Be.y,Be.z)):yi(Oe.x,Oe.y,j/B*Ge)}for(let Ge=Q-1;Ge>=0;Ge--){const ht=Ge/Q,Oe=z*Math.cos(ht*Math.PI/2),ye=G*Math.sin(ht*Math.PI/2)+W;for(let ke=0,ze=Ht.length;ke<ze;ke++){const rt=ri(Ht[ke],oi[ke],ye);yi(rt.x,rt.y,j+Oe)}for(let ke=0,ze=Le.length;ke<ze;ke++){const rt=Le[ke];Nt=Pt[ke];for(let Et=0,Vt=rt.length;Et<Vt;Et++){const Yt=ri(rt[Et],Nt[Et],ye);Ze?yi(Yt.x,Yt.y+q[B-1].y,q[B-1].x+Oe):yi(Yt.x,Yt.y,j+Oe)}}}function $i(Ge,ht){let Oe=Ge.length;for(;--Oe>=0;){const ye=Oe;let ke=Oe-1;ke<0&&(ke=Ge.length-1);for(let ze=0,rt=B+2*Q;ze<rt;ze++){const Et=hi*ze,Vt=hi*(ze+1);Ri(ht+ye+Et,ht+ke+Et,ht+ke+Vt,ht+ye+Vt)}}}function yi(Ge,ht,Oe){P.push(Ge),P.push(ht),P.push(Oe)}function qi(Ge,ht,Oe){De(Ge),De(ht),De(Oe);const ye=m.length/3,ke=Y.generateTopUV(d,m,ye-3,ye-2,ye-1);Me(ke[0]),Me(ke[1]),Me(ke[2])}function Ri(Ge,ht,Oe,ye){De(Ge),De(ht),De(ye),De(ht),De(Oe),De(ye);const ke=m.length/3,ze=Y.generateSideWallUV(d,m,ke-6,ke-3,ke-2,ke-1);Me(ze[0]),Me(ze[1]),Me(ze[3]),Me(ze[1]),Me(ze[2]),Me(ze[3])}function De(Ge){m.push(P[3*Ge+0]),m.push(P[3*Ge+1]),m.push(P[3*Ge+2])}function Me(Ge){v.push(Ge.x),v.push(Ge.y)}(function(){const Ge=m.length/3;if(F){let ht=0,Oe=hi*ht;for(let ye=0;ye<ei;ye++){const ke=Gt[ye];qi(ke[2]+Oe,ke[1]+Oe,ke[0]+Oe)}ht=B+2*Q,Oe=hi*ht;for(let ye=0;ye<ei;ye++){const ke=Gt[ye];qi(ke[0]+Oe,ke[1]+Oe,ke[2]+Oe)}}else{for(let ht=0;ht<ei;ht++){const Oe=Gt[ht];qi(Oe[2],Oe[1],Oe[0])}for(let ht=0;ht<ei;ht++){const Oe=Gt[ht];qi(Oe[0]+hi*B,Oe[1]+hi*B,Oe[2]+hi*B)}}d.addGroup(Ge,m.length/3-Ge,0)})(),function(){const Ge=m.length/3;let ht=0;$i(Ht,ht),ht+=Ht.length;for(let Oe=0,ye=Le.length;Oe<ye;Oe++){const ke=Le[Oe];$i(ke,ht),ht+=ke.length}d.addGroup(Ge,m.length/3-Ge,1)}()}this.setAttribute("position",new pe(m,3)),this.setAttribute("uv",new pe(v,2)),this.computeVertexNormals()}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON();return function(c,d,m){if(m.shapes=[],Array.isArray(c))for(let v=0,w=c.length;v<w;v++){const C=c[v];m.shapes.push(C.uuid)}else m.shapes.push(c.uuid);return m.options=Object.assign({},d),d.extrudePath!==void 0&&(m.options.extrudePath=d.extrudePath.toJSON()),m}(this.parameters.shapes,this.parameters.options,n)}static fromJSON(n,c){const d=[];for(let v=0,w=n.shapes.length;v<w;v++){const C=c[n.shapes[v]];d.push(C)}const m=n.options.extrudePath;return m!==void 0&&(n.options.extrudePath=new ag[m.type]().fromJSON(m)),new Wf(d,n.options)}}const Sy={generateTopUV:function(b,n,c,d,m){const v=n[3*c],w=n[3*c+1],C=n[3*d],P=n[3*d+1],D=n[3*m],B=n[3*m+1];return[new Jt(v,w),new Jt(C,P),new Jt(D,B)]},generateSideWallUV:function(b,n,c,d,m,v){const w=n[3*c],C=n[3*c+1],P=n[3*c+2],D=n[3*d],B=n[3*d+1],j=n[3*d+2],F=n[3*m],z=n[3*m+1],G=n[3*m+2],W=n[3*v],Q=n[3*v+1],$=n[3*v+2];return Math.abs(C-B)<Math.abs(w-D)?[new Jt(w,1-P),new Jt(D,1-j),new Jt(F,1-G),new Jt(W,1-$)]:[new Jt(C,1-P),new Jt(B,1-j),new Jt(z,1-G),new Jt(Q,1-$)]}};class Gu extends _c{constructor(n=1,c=0){const d=(1+Math.sqrt(5))/2;super([-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n,c),this.type="IcosahedronGeometry",this.parameters={radius:n,detail:c}}static fromJSON(n){return new Gu(n.radius,n.detail)}}class Fh extends _c{constructor(n=1,c=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],n,c),this.type="OctahedronGeometry",this.parameters={radius:n,detail:c}}static fromJSON(n){return new Fh(n.radius,n.detail)}}class Hu extends hr{constructor(n=.5,c=1,d=32,m=1,v=0,w=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:n,outerRadius:c,thetaSegments:d,phiSegments:m,thetaStart:v,thetaLength:w},d=Math.max(3,d);const C=[],P=[],D=[],B=[];let j=n;const F=(c-n)/(m=Math.max(1,m)),z=new Se,G=new Jt;for(let W=0;W<=m;W++){for(let Q=0;Q<=d;Q++){const $=v+Q/d*w;z.x=j*Math.cos($),z.y=j*Math.sin($),P.push(z.x,z.y,z.z),D.push(0,0,1),G.x=(z.x/c+1)/2,G.y=(z.y/c+1)/2,B.push(G.x,G.y)}j+=F}for(let W=0;W<m;W++){const Q=W*(d+1);for(let $=0;$<d;$++){const Y=$+Q,q=Y,be=Y+d+1,we=Y+d+2,me=Y+1;C.push(q,be,me),C.push(be,we,me)}}this.setIndex(C),this.setAttribute("position",new pe(P,3)),this.setAttribute("normal",new pe(D,3)),this.setAttribute("uv",new pe(B,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new Hu(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)}}class jh extends hr{constructor(n=new fp([new Jt(0,.5),new Jt(-.5,-.5),new Jt(.5,-.5)]),c=12){super(),this.type="ShapeGeometry",this.parameters={shapes:n,curveSegments:c};const d=[],m=[],v=[],w=[];let C=0,P=0;if(Array.isArray(n)===!1)D(n);else for(let B=0;B<n.length;B++)D(n[B]),this.addGroup(C,P,B),C+=P,P=0;function D(B){const j=m.length/3,F=B.extractPoints(c);let z=F.shape;const G=F.holes;yc.isClockWise(z)===!1&&(z=z.reverse());for(let Q=0,$=G.length;Q<$;Q++){const Y=G[Q];yc.isClockWise(Y)===!0&&(G[Q]=Y.reverse())}const W=yc.triangulateShape(z,G);for(let Q=0,$=G.length;Q<$;Q++){const Y=G[Q];z=z.concat(Y)}for(let Q=0,$=z.length;Q<$;Q++){const Y=z[Q];m.push(Y.x,Y.y,0),v.push(0,0,1),w.push(Y.x,Y.y)}for(let Q=0,$=W.length;Q<$;Q++){const Y=W[Q],q=Y[0]+j,be=Y[1]+j,we=Y[2]+j;d.push(q,be,we),P+=3}}this.setIndex(d),this.setAttribute("position",new pe(m,3)),this.setAttribute("normal",new pe(v,3)),this.setAttribute("uv",new pe(w,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON();return function(c,d){if(d.shapes=[],Array.isArray(c))for(let m=0,v=c.length;m<v;m++){const w=c[m];d.shapes.push(w.uuid)}else d.shapes.push(c.uuid);return d}(this.parameters.shapes,n)}static fromJSON(n,c){const d=[];for(let m=0,v=n.shapes.length;m<v;m++){const w=c[n.shapes[m]];d.push(w)}return new jh(d,n.curveSegments)}}class zh extends hr{constructor(n=1,c=32,d=16,m=0,v=2*Math.PI,w=0,C=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:c,heightSegments:d,phiStart:m,phiLength:v,thetaStart:w,thetaLength:C},c=Math.max(3,Math.floor(c)),d=Math.max(2,Math.floor(d));const P=Math.min(w+C,Math.PI);let D=0;const B=[],j=new Se,F=new Se,z=[],G=[],W=[],Q=[];for(let $=0;$<=d;$++){const Y=[],q=$/d;let be=0;$===0&&w===0?be=.5/c:$===d&&P===Math.PI&&(be=-.5/c);for(let we=0;we<=c;we++){const me=we/c;j.x=-n*Math.cos(m+me*v)*Math.sin(w+q*C),j.y=n*Math.cos(w+q*C),j.z=n*Math.sin(m+me*v)*Math.sin(w+q*C),G.push(j.x,j.y,j.z),F.copy(j).normalize(),W.push(F.x,F.y,F.z),Q.push(me+be,1-q),Y.push(D++)}B.push(Y)}for(let $=0;$<d;$++)for(let Y=0;Y<c;Y++){const q=B[$][Y+1],be=B[$][Y],we=B[$+1][Y],me=B[$+1][Y+1];($!==0||w>0)&&z.push(q,be,me),($!==d-1||P<Math.PI)&&z.push(be,we,me)}this.setIndex(z),this.setAttribute("position",new pe(G,3)),this.setAttribute("normal",new pe(W,3)),this.setAttribute("uv",new pe(Q,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new zh(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)}}class hg extends _c{constructor(n=1,c=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],n,c),this.type="TetrahedronGeometry",this.parameters={radius:n,detail:c}}static fromJSON(n){return new hg(n.radius,n.detail)}}class dg extends hr{constructor(n=1,c=.4,d=12,m=48,v=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:c,radialSegments:d,tubularSegments:m,arc:v},d=Math.floor(d),m=Math.floor(m);const w=[],C=[],P=[],D=[],B=new Se,j=new Se,F=new Se;for(let z=0;z<=d;z++)for(let G=0;G<=m;G++){const W=G/m*v,Q=z/d*Math.PI*2;j.x=(n+c*Math.cos(Q))*Math.cos(W),j.y=(n+c*Math.cos(Q))*Math.sin(W),j.z=c*Math.sin(Q),C.push(j.x,j.y,j.z),B.x=n*Math.cos(W),B.y=n*Math.sin(W),F.subVectors(j,B).normalize(),P.push(F.x,F.y,F.z),D.push(G/m),D.push(z/d)}for(let z=1;z<=d;z++)for(let G=1;G<=m;G++){const W=(m+1)*z+G-1,Q=(m+1)*(z-1)+G-1,$=(m+1)*(z-1)+G,Y=(m+1)*z+G;w.push(W,Q,Y),w.push(Q,$,Y)}this.setIndex(w),this.setAttribute("position",new pe(C,3)),this.setAttribute("normal",new pe(P,3)),this.setAttribute("uv",new pe(D,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new dg(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)}}class pg extends hr{constructor(n=1,c=.4,d=64,m=8,v=2,w=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:n,tube:c,tubularSegments:d,radialSegments:m,p:v,q:w},d=Math.floor(d),m=Math.floor(m);const C=[],P=[],D=[],B=[],j=new Se,F=new Se,z=new Se,G=new Se,W=new Se,Q=new Se,$=new Se;for(let q=0;q<=d;++q){const be=q/d*v*Math.PI*2;Y(be,v,w,n,z),Y(be+.01,v,w,n,G),Q.subVectors(G,z),$.addVectors(G,z),W.crossVectors(Q,$),$.crossVectors(W,Q),W.normalize(),$.normalize();for(let we=0;we<=m;++we){const me=we/m*Math.PI*2,Be=-c*Math.cos(me),Ze=c*Math.sin(me);j.x=z.x+(Be*$.x+Ze*W.x),j.y=z.y+(Be*$.y+Ze*W.y),j.z=z.z+(Be*$.z+Ze*W.z),P.push(j.x,j.y,j.z),F.subVectors(j,z).normalize(),D.push(F.x,F.y,F.z),B.push(q/d),B.push(we/m)}}for(let q=1;q<=d;q++)for(let be=1;be<=m;be++){const we=(m+1)*(q-1)+(be-1),me=(m+1)*q+(be-1),Be=(m+1)*q+be,Ze=(m+1)*(q-1)+be;C.push(we,me,Ze),C.push(me,Be,Ze)}function Y(q,be,we,me,Be){const Ze=Math.cos(q),et=Math.sin(q),ft=we/be*q,Le=Math.cos(ft);Be.x=me*(2+Le)*.5*Ze,Be.y=me*(2+Le)*et*.5,Be.z=me*Math.sin(ft)*.5}this.setIndex(C),this.setAttribute("position",new pe(P,3)),this.setAttribute("normal",new pe(D,3)),this.setAttribute("uv",new pe(B,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}static fromJSON(n){return new pg(n.radius,n.tube,n.tubularSegments,n.radialSegments,n.p,n.q)}}class Xf extends hr{constructor(n=new hp(new Se(-1,-1,0),new Se(-1,1,0),new Se(1,1,0)),c=64,d=1,m=8,v=!1){super(),this.type="TubeGeometry",this.parameters={path:n,tubularSegments:c,radius:d,radialSegments:m,closed:v};const w=n.computeFrenetFrames(c,v);this.tangents=w.tangents,this.normals=w.normals,this.binormals=w.binormals;const C=new Se,P=new Se,D=new Jt;let B=new Se;const j=[],F=[],z=[],G=[];function W(Q){B=n.getPointAt(Q/c,B);const $=w.normals[Q],Y=w.binormals[Q];for(let q=0;q<=m;q++){const be=q/m*Math.PI*2,we=Math.sin(be),me=-Math.cos(be);P.x=me*$.x+we*Y.x,P.y=me*$.y+we*Y.y,P.z=me*$.z+we*Y.z,P.normalize(),F.push(P.x,P.y,P.z),C.x=B.x+d*P.x,C.y=B.y+d*P.y,C.z=B.z+d*P.z,j.push(C.x,C.y,C.z)}}(function(){for(let Q=0;Q<c;Q++)W(Q);W(v===!1?c:0),function(){for(let Q=0;Q<=c;Q++)for(let $=0;$<=m;$++)D.x=Q/c,D.y=$/m,z.push(D.x,D.y)}(),function(){for(let Q=1;Q<=c;Q++)for(let $=1;$<=m;$++){const Y=(m+1)*(Q-1)+($-1),q=(m+1)*Q+($-1),be=(m+1)*Q+$,we=(m+1)*(Q-1)+$;G.push(Y,q,we),G.push(q,be,we)}}()})(),this.setIndex(G),this.setAttribute("position",new pe(j,3)),this.setAttribute("normal",new pe(F,3)),this.setAttribute("uv",new pe(z,2))}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}toJSON(){const n=super.toJSON();return n.path=this.parameters.path.toJSON(),n}static fromJSON(n){return new Xf(new ag[n.path.type]().fromJSON(n.path),n.tubularSegments,n.radius,n.radialSegments,n.closed)}}class iw extends hr{constructor(n=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:n},n!==null){const c=[],d=new Set,m=new Se,v=new Se;if(n.index!==null){const w=n.attributes.position,C=n.index;let P=n.groups;P.length===0&&(P=[{start:0,count:C.count,materialIndex:0}]);for(let D=0,B=P.length;D<B;++D){const j=P[D],F=j.start;for(let z=F,G=F+j.count;z<G;z+=3)for(let W=0;W<3;W++){const Q=C.getX(z+W),$=C.getX(z+(W+1)%3);m.fromBufferAttribute(w,Q),v.fromBufferAttribute(w,$),Cy(m,v,d)===!0&&(c.push(m.x,m.y,m.z),c.push(v.x,v.y,v.z))}}}else{const w=n.attributes.position;for(let C=0,P=w.count/3;C<P;C++)for(let D=0;D<3;D++){const B=3*C+D,j=3*C+(D+1)%3;m.fromBufferAttribute(w,B),v.fromBufferAttribute(w,j),Cy(m,v,d)===!0&&(c.push(m.x,m.y,m.z),c.push(v.x,v.y,v.z))}}this.setAttribute("position",new pe(c,3))}}copy(n){return super.copy(n),this.parameters=Object.assign({},n.parameters),this}}function Cy(b,n,c){const d=`${b.x},${b.y},${b.z}-${n.x},${n.y},${n.z}`,m=`${n.x},${n.y},${n.z}-${b.x},${b.y},${b.z}`;return c.has(d)!==!0&&c.has(m)!==!0&&(c.add(d),c.add(m),!0)}var rw=Object.freeze({__proto__:null,BoxGeometry:eo,CapsuleGeometry:Vf,CircleGeometry:dp,ConeGeometry:og,CylinderGeometry:Uh,DodecahedronGeometry:ru,EdgesGeometry:WA,ExtrudeGeometry:Wf,IcosahedronGeometry:Gu,LatheGeometry:Fu,OctahedronGeometry:Fh,PlaneGeometry:Jc,PolyhedronGeometry:_c,RingGeometry:Hu,ShapeGeometry:jh,SphereGeometry:zh,TetrahedronGeometry:hg,TorusGeometry:dg,TorusKnotGeometry:pg,TubeGeometry:Xf,WireframeGeometry:iw});class My extends Gs{constructor(n){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new xi(0),this.transparent=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.fog=n.fog,this}}class nw extends cc{constructor(n){super(n),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class qf extends Gs{constructor(n){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class el extends qf{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Jt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Kr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(c){this.ior=(1+.4*c)/(1-.4*c)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new xi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new xi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new xi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(n)}get anisotropy(){return this._anisotropy}set anisotropy(n){this._anisotropy>0!=n>0&&this.version++,this._anisotropy=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=n.anisotropy,this.anisotropyRotation=n.anisotropyRotation,this.anisotropyMap=n.anisotropyMap,this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}}class Ty extends Gs{constructor(n){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new xi(16777215),this.specular=new xi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class Iy extends Gs{constructor(n){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new xi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}}class g0 extends Gs{constructor(n){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.flatShading=n.flatShading,this}}class mp extends Gs{constructor(n){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new xi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oi,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}}class jn extends Gs{constructor(n){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ca,this.normalScale=new Jt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.flatShading=n.flatShading,this.fog=n.fog,this}}class sw extends wa{constructor(n){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}copy(n){return super.copy(n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this}}function yn(b,n,c){return gp(b)?new b.constructor(b.subarray(n,c!==void 0?c:b.length)):b.slice(n,c)}function Ir(b,n,c){return!b||!c&&b.constructor===n?b:typeof n.BYTES_PER_ELEMENT=="number"?new n(b):Array.prototype.slice.call(b)}function gp(b){return ArrayBuffer.isView(b)&&!(b instanceof DataView)}function Yf(b){const n=b.length,c=new Array(n);for(let d=0;d!==n;++d)c[d]=d;return c.sort(function(d,m){return b[d]-b[m]}),c}function Py(b,n,c){const d=b.length,m=new b.constructor(d);for(let v=0,w=0;w!==d;++v){const C=c[v]*n;for(let P=0;P!==n;++P)m[w++]=b[C+P]}return m}function v0(b,n,c,d){let m=1,v=b[0];for(;v!==void 0&&v[d]===void 0;)v=b[m++];if(v===void 0)return;let w=v[d];if(w!==void 0)if(Array.isArray(w))do w=v[d],w!==void 0&&(n.push(v.time),c.push.apply(c,w)),v=b[m++];while(v!==void 0);else if(w.toArray!==void 0)do w=v[d],w!==void 0&&(n.push(v.time),w.toArray(c,c.length)),v=b[m++];while(v!==void 0);else do w=v[d],w!==void 0&&(n.push(v.time),c.push(w)),v=b[m++];while(v!==void 0)}const uE={arraySlice:yn,convertArray:Ir,isTypedArray:gp,getKeyframeOrder:Yf,sortedArray:Py,flattenJSON:v0,subclip:function(b,n,c,d,m=30){const v=b.clone();v.name=n;const w=[];for(let P=0;P<v.tracks.length;++P){const D=v.tracks[P],B=D.getValueSize(),j=[],F=[];for(let z=0;z<D.times.length;++z){const G=D.times[z]*m;if(!(G<c||G>=d)){j.push(D.times[z]);for(let W=0;W<B;++W)F.push(D.values[z*B+W])}}j.length!==0&&(D.times=Ir(j,D.times.constructor),D.values=Ir(F,D.values.constructor),w.push(D))}v.tracks=w;let C=1/0;for(let P=0;P<v.tracks.length;++P)C>v.tracks[P].times[0]&&(C=v.tracks[P].times[0]);for(let P=0;P<v.tracks.length;++P)v.tracks[P].shift(-1*C);return v.resetDuration(),v},makeClipAdditive:function(b,n=0,c=b,d=30){d<=0&&(d=30);const m=c.tracks.length,v=n/d;for(let w=0;w<m;++w){const C=c.tracks[w],P=C.ValueTypeName;if(P==="bool"||P==="string")continue;const D=b.tracks.find(function($){return $.name===C.name&&$.ValueTypeName===P});if(D===void 0)continue;let B=0;const j=C.getValueSize();C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(B=j/3);let F=0;const z=D.getValueSize();D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(F=z/3);const G=C.times.length-1;let W;if(v<=C.times[0]){const $=B,Y=j-B;W=yn(C.values,$,Y)}else if(v>=C.times[G]){const $=G*j+B,Y=$+j-B;W=yn(C.values,$,Y)}else{const $=C.createInterpolant(),Y=B,q=j-B;$.evaluate(v),W=yn($.resultBuffer,Y,q)}P==="quaternion"&&new Vs().fromArray(W).normalize().conjugate().toArray(W);const Q=D.times.length;for(let $=0;$<Q;++$){const Y=$*z+F;if(P==="quaternion")Vs.multiplyQuaternionsFlat(D.values,Y,W,0,D.values,Y);else{const q=z-2*F;for(let be=0;be<q;++be)D.values[Y+be]-=W[be]}}}return b.blendMode=Td,b}};class Qu{constructor(n,c,d,m){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=m!==void 0?m:new c.constructor(d),this.sampleValues=c,this.valueSize=d,this.settings=null,this.DefaultSettings_={}}evaluate(n){const c=this.parameterPositions;let d=this._cachedIndex,m=c[d],v=c[d-1];e:{t:{let w;i:{r:if(!(n<m)){for(let C=d+2;;){if(m===void 0){if(n<v)break r;return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}if(d===C)break;if(v=m,m=c[++d],n<m)break t}w=c.length;break i}if(n>=v)break e;{const C=c[1];n<C&&(d=2,v=C);for(let P=d-2;;){if(v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===P)break;if(m=v,v=c[--d-1],n>=v)break t}w=d,d=0}}for(;d<w;){const C=d+w>>>1;n<c[C]?w=C:d=C+1}if(m=c[d],v=c[d-1],v===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(m===void 0)return d=c.length,this._cachedIndex=d,this.copySampleValue_(d-1)}this._cachedIndex=d,this.intervalChanged_(d,v,m)}return this.interpolate_(d,v,n,m)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const c=this.resultBuffer,d=this.sampleValues,m=this.valueSize,v=n*m;for(let w=0;w!==m;++w)c[w]=d[v+w];return c}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class fg extends Qu{constructor(n,c,d,m){super(n,c,d,m),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Jl,endingEnd:Jl}}intervalChanged_(n,c,d){const m=this.parameterPositions;let v=n-2,w=n+1,C=m[v],P=m[w];if(C===void 0)switch(this.getSettings_().endingStart){case $l:v=n,C=2*c-d;break;case gu:v=m.length-2,C=c+m[v]-m[v+1];break;default:v=n,C=d}if(P===void 0)switch(this.getSettings_().endingEnd){case $l:w=n,P=2*d-c;break;case gu:w=1,P=d+m[1]-m[0];break;default:w=n-1,P=c}const D=.5*(d-c),B=this.valueSize;this._weightPrev=D/(c-C),this._weightNext=D/(P-d),this._offsetPrev=v*B,this._offsetNext=w*B}interpolate_(n,c,d,m){const v=this.resultBuffer,w=this.sampleValues,C=this.valueSize,P=n*C,D=P-C,B=this._offsetPrev,j=this._offsetNext,F=this._weightPrev,z=this._weightNext,G=(d-c)/(m-c),W=G*G,Q=W*G,$=-F*Q+2*F*W-F*G,Y=(1+F)*Q+(-1.5-2*F)*W+(-.5+F)*G+1,q=(-1-z)*Q+(1.5+z)*W+.5*G,be=z*Q-z*W;for(let we=0;we!==C;++we)v[we]=$*w[B+we]+Y*w[D+we]+q*w[P+we]+be*w[j+we];return v}}class Wu extends Qu{constructor(n,c,d,m){super(n,c,d,m)}interpolate_(n,c,d,m){const v=this.resultBuffer,w=this.sampleValues,C=this.valueSize,P=n*C,D=P-C,B=(d-c)/(m-c),j=1-B;for(let F=0;F!==C;++F)v[F]=w[D+F]*j+w[P+F]*B;return v}}class Kf extends Qu{constructor(n,c,d,m){super(n,c,d,m)}interpolate_(n){return this.copySampleValue_(n-1)}}class sa{constructor(n,c,d,m){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(c===void 0||c.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=Ir(c,this.TimeBufferType),this.values=Ir(d,this.ValueBufferType),this.setInterpolation(m||this.DefaultInterpolation)}static toJSON(n){const c=n.constructor;let d;if(c.toJSON!==this.toJSON)d=c.toJSON(n);else{d={name:n.name,times:Ir(n.times,Array),values:Ir(n.values,Array)};const m=n.getInterpolation();m!==n.DefaultInterpolation&&(d.interpolation=m)}return d.type=n.ValueTypeName,d}InterpolantFactoryMethodDiscrete(n){return new Kf(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new Wu(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new fg(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let c;switch(n){case Al:c=this.InterpolantFactoryMethodDiscrete;break;case Uc:c=this.InterpolantFactoryMethodLinear;break;case Md:c=this.InterpolantFactoryMethodSmooth}if(c===void 0){const d="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(n===this.DefaultInterpolation)throw new Error(d);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",d),this}return this.createInterpolant=c,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Al;case this.InterpolantFactoryMethodLinear:return Uc;case this.InterpolantFactoryMethodSmooth:return Md}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const c=this.times;for(let d=0,m=c.length;d!==m;++d)c[d]+=n}return this}scale(n){if(n!==1){const c=this.times;for(let d=0,m=c.length;d!==m;++d)c[d]*=n}return this}trim(n,c){const d=this.times,m=d.length;let v=0,w=m-1;for(;v!==m&&d[v]<n;)++v;for(;w!==-1&&d[w]>c;)--w;if(++w,v!==0||w!==m){v>=w&&(w=Math.max(w,1),v=w-1);const C=this.getValueSize();this.times=yn(d,v,w),this.values=yn(this.values,v*C,w*C)}return this}validate(){let n=!0;const c=this.getValueSize();c-Math.floor(c)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const d=this.times,m=this.values,v=d.length;v===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let w=null;for(let C=0;C!==v;C++){const P=d[C];if(typeof P=="number"&&isNaN(P)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,C,P),n=!1;break}if(w!==null&&w>P){console.error("THREE.KeyframeTrack: Out of order keys.",this,C,P,w),n=!1;break}w=P}if(m!==void 0&&gp(m))for(let C=0,P=m.length;C!==P;++C){const D=m[C];if(isNaN(D)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,C,D),n=!1;break}}return n}optimize(){const n=yn(this.times),c=yn(this.values),d=this.getValueSize(),m=this.getInterpolation()===Md,v=n.length-1;let w=1;for(let C=1;C<v;++C){let P=!1;const D=n[C];if(D!==n[C+1]&&(C!==1||D!==n[0]))if(m)P=!0;else{const B=C*d,j=B-d,F=B+d;for(let z=0;z!==d;++z){const G=c[B+z];if(G!==c[j+z]||G!==c[F+z]){P=!0;break}}}if(P){if(C!==w){n[w]=n[C];const B=C*d,j=w*d;for(let F=0;F!==d;++F)c[j+F]=c[B+F]}++w}}if(v>0){n[w]=n[v];for(let C=v*d,P=w*d,D=0;D!==d;++D)c[P+D]=c[C+D];++w}return w!==n.length?(this.times=yn(n,0,w),this.values=yn(c,0,w*d)):(this.times=n,this.values=c),this}clone(){const n=yn(this.times,0),c=yn(this.values,0),d=new this.constructor(this.name,n,c);return d.createInterpolant=this.createInterpolant,d}}sa.prototype.TimeBufferType=Float32Array,sa.prototype.ValueBufferType=Float32Array,sa.prototype.DefaultInterpolation=Uc;class Ds extends sa{}Ds.prototype.ValueTypeName="bool",Ds.prototype.ValueBufferType=Array,Ds.prototype.DefaultInterpolation=Al,Ds.prototype.InterpolantFactoryMethodLinear=void 0,Ds.prototype.InterpolantFactoryMethodSmooth=void 0;class _0 extends sa{}_0.prototype.ValueTypeName="color";class Vh extends sa{}Vh.prototype.ValueTypeName="number";class aw extends Qu{constructor(n,c,d,m){super(n,c,d,m)}interpolate_(n,c,d,m){const v=this.resultBuffer,w=this.sampleValues,C=this.valueSize,P=(d-c)/(m-c);let D=n*C;for(let B=D+C;D!==B;D+=4)Vs.slerpFlat(v,0,w,D-C,w,D,P);return v}}class tl extends sa{InterpolantFactoryMethodLinear(n){return new aw(this.times,this.values,this.getValueSize(),n)}}tl.prototype.ValueTypeName="quaternion",tl.prototype.DefaultInterpolation=Uc,tl.prototype.InterpolantFactoryMethodSmooth=void 0;class So extends sa{}So.prototype.ValueTypeName="string",So.prototype.ValueBufferType=Array,So.prototype.DefaultInterpolation=Al,So.prototype.InterpolantFactoryMethodLinear=void 0,So.prototype.InterpolantFactoryMethodSmooth=void 0;class bc extends sa{}bc.prototype.ValueTypeName="vector";class il{constructor(n,c=-1,d,m=js){this.name=n,this.tracks=d,this.duration=c,this.blendMode=m,this.uuid=ts(),this.duration<0&&this.resetDuration()}static parse(n){const c=[],d=n.tracks,m=1/(n.fps||1);for(let w=0,C=d.length;w!==C;++w)c.push(Ry(d[w]).scale(m));const v=new this(n.name,n.duration,c,n.blendMode);return v.uuid=n.uuid,v}static toJSON(n){const c=[],d=n.tracks,m={name:n.name,duration:n.duration,tracks:c,uuid:n.uuid,blendMode:n.blendMode};for(let v=0,w=d.length;v!==w;++v)c.push(sa.toJSON(d[v]));return m}static CreateFromMorphTargetSequence(n,c,d,m){const v=c.length,w=[];for(let C=0;C<v;C++){let P=[],D=[];P.push((C+v-1)%v,C,(C+1)%v),D.push(0,1,0);const B=Yf(P);P=Py(P,1,B),D=Py(D,1,B),m||P[0]!==0||(P.push(v),D.push(D[0])),w.push(new Vh(".morphTargetInfluences["+c[C].name+"]",P,D).scale(1/d))}return new this(n,-1,w)}static findByName(n,c){let d=n;if(!Array.isArray(n)){const m=n;d=m.geometry&&m.geometry.animations||m.animations}for(let m=0;m<d.length;m++)if(d[m].name===c)return d[m];return null}static CreateClipsFromMorphTargetSequences(n,c,d){const m={},v=/^([\w-]*?)([\d]+)$/;for(let C=0,P=n.length;C<P;C++){const D=n[C],B=D.name.match(v);if(B&&B.length>1){const j=B[1];let F=m[j];F||(m[j]=F=[]),F.push(D)}}const w=[];for(const C in m)w.push(this.CreateFromMorphTargetSequence(C,m[C],c,d));return w}static parseAnimation(n,c){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const d=function(B,j,F,z,G){if(F.length!==0){const W=[],Q=[];v0(F,W,Q,z),W.length!==0&&G.push(new B(j,W,Q))}},m=[],v=n.name||"default",w=n.fps||30,C=n.blendMode;let P=n.length||-1;const D=n.hierarchy||[];for(let B=0;B<D.length;B++){const j=D[B].keys;if(j&&j.length!==0)if(j[0].morphTargets){const F={};let z;for(z=0;z<j.length;z++)if(j[z].morphTargets)for(let G=0;G<j[z].morphTargets.length;G++)F[j[z].morphTargets[G]]=-1;for(const G in F){const W=[],Q=[];for(let $=0;$!==j[z].morphTargets.length;++$){const Y=j[z];W.push(Y.time),Q.push(Y.morphTarget===G?1:0)}m.push(new Vh(".morphTargetInfluence["+G+"]",W,Q))}P=F.length*w}else{const F=".bones["+c[B].name+"]";d(bc,F+".position",j,"pos",m),d(tl,F+".quaternion",j,"rot",m),d(bc,F+".scale",j,"scl",m)}}return m.length===0?null:new this(v,P,m,C)}resetDuration(){let n=0;for(let c=0,d=this.tracks.length;c!==d;++c){const m=this.tracks[c];n=Math.max(n,m.times[m.times.length-1])}return this.duration=n,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let c=0;c<this.tracks.length;c++)n=n&&this.tracks[c].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let c=0;c<this.tracks.length;c++)n.push(this.tracks[c].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ry(b){if(b.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=function(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Vh;case"vector":case"vector2":case"vector3":case"vector4":return bc;case"color":return _0;case"quaternion":return tl;case"bool":case"boolean":return Ds;case"string":return So}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}(b.type);if(b.times===void 0){const c=[],d=[];v0(b.keys,c,d,"value"),b.times=c,b.values=d}return n.parse!==void 0?n.parse(b):new n(b.name,b.times,b.values,b.interpolation)}const xn={enabled:!1,files:{},add:function(b,n){this.enabled!==!1&&(this.files[b]=n)},get:function(b,n){return this.enabled===!1?n?Promise.resolve():void 0:n?Promise.resolve(this.files[b]):this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};class mg{constructor(n,c,d){const m=this;let v,w=!1,C=0,P=0;const D=[];this.onStart=void 0,this.onLoad=n,this.onProgress=c,this.onError=d,this.itemStart=function(B){P++,w===!1&&m.onStart!==void 0&&m.onStart(B,C,P),w=!0},this.itemEnd=function(B){C++,m.onProgress!==void 0&&m.onProgress(B,C,P),C===P&&(w=!1,m.onLoad!==void 0&&m.onLoad())},this.itemError=function(B){m.onError!==void 0&&m.onError(B)},this.resolveURL=function(B){return v?v(B):B},this.setURLModifier=function(B){return v=B,this},this.addHandler=function(B,j){return D.push(B,j),this},this.removeHandler=function(B){const j=D.indexOf(B);return j!==-1&&D.splice(j,2),this},this.getHandler=function(B){for(let j=0,F=D.length;j<F;j+=2){const z=D[j],G=D[j+1];if(z.global&&(z.lastIndex=0),z.test(B))return G}return null}}}const Dy=new mg;class Hs{constructor(n){this.manager=n!==void 0?n:Dy,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,c){const d=this;return new Promise(function(m,v){d.load(n,m,c,v)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}}const ka={};class Co extends Error{constructor(n,c){super(n),this.response=c}}class Ac extends Hs{constructor(n){super(n),this.responseType="text",this.useCache=!0}load(n,c,d,m){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n),(this.useCache?xn.get(n,this.responseType,this.mimeType):Promise.resolve(void 0)).then(v=>{if(v!==void 0)return this.manager.itemStart(n),setTimeout(()=>{c&&c(v),this.manager.itemEnd(n)},0),v;if(ka[n]!==void 0)return void ka[n].push({onLoad:c,onProgress:d,onError:m});ka[n]=[],ka[n].push({onLoad:c,onProgress:d,onError:m});const w=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),C=this.mimeType,P=this.responseType;fetch(w).then(D=>{if(D.status===200||D.status===0){if(D.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||D.body===void 0||D.body.getReader===void 0)return D;const B=ka[n],j=D.body.getReader(),F=D.headers.get("Content-Length")||D.headers.get("X-File-Size"),z=F?parseInt(F):0,G=z!==0;let W=0;const Q=new ReadableStream({start($){(function Y(){j.read().then(({done:q,value:be})=>{if(q)$.close();else{W+=be.byteLength;const we=new ProgressEvent("progress",{lengthComputable:G,loaded:W,total:z});for(let me=0,Be=B.length;me<Be;me++){const Ze=B[me];Ze.onProgress&&Ze.onProgress(we)}$.enqueue(be),Y()}})})()}});return new Response(Q)}throw new Co(`fetch for "${D.url}" responded with ${D.status}: ${D.statusText}`,D)}).then(D=>{switch(P){case"arraybuffer":return D.arrayBuffer();case"blob":return D.blob();case"document":return D.text().then(B=>new DOMParser().parseFromString(B,C));case"json":return D.json();default:if(C===void 0)return D.text();{const B=/charset="?([^;"\s]*)"?/i.exec(C),j=B&&B[1]?B[1].toLowerCase():void 0,F=new TextDecoder(j);return D.arrayBuffer().then(z=>F.decode(z))}}}).then(D=>{this.useCache&&xn.add(n,D,this.responseType);const B=ka[n];delete ka[n];for(let j=0,F=B.length;j<F;j++){const z=B[j];z.onLoad&&z.onLoad(D)}}).catch(D=>{const B=ka[n];if(B===void 0)throw this.manager.itemError(n),D;delete ka[n];for(let j=0,F=B.length;j<F;j++){const z=B[j];z.onError&&z.onError(D)}this.manager.itemError(n)}).finally(()=>{this.useCache&&this.manager.itemEnd(n)}),this.useCache&&this.manager.itemStart(n)})}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}}class rl extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=new Ac(this.manager);w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(n,function(C){try{c(v.parse(JSON.parse(C)))}catch(P){m?m(P):console.error(P),v.manager.itemError(n)}},d,m)}parse(n){const c=[];for(let d=0;d<n.length;d++){const m=il.parse(n[d]);c.push(m)}return c}}class By extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=[],C=new l0,P=new Ac(this.manager);P.setPath(this.path),P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setWithCredentials(v.withCredentials);let D=0;function B(j){P.load(n[j],function(F){const z=v.parse(F,!0);w[j]={width:z.width,height:z.height,format:z.format,mipmaps:z.mipmaps},D+=1,D===6&&(z.mipmapCount===1&&(C.minFilter=pn),C.image=w,C.format=z.format,C.needsUpdate=!0,c&&c(C))},d,m)}if(Array.isArray(n))for(let j=0,F=n.length;j<F;++j)B(j);else P.load(n,function(j){const F=v.parse(j,!0);if(F.isCubemap){const z=F.mipmaps.length/F.mipmapCount;for(let G=0;G<z;G++){w[G]={mipmaps:[]};for(let W=0;W<F.mipmapCount;W++)w[G].mipmaps.push(F.mipmaps[G*F.mipmapCount+W]),w[G].format=F.format,w[G].width=F.width,w[G].height=F.height}C.image=w}else C.image.width=F.width,C.image.height=F.height,C.mipmaps=F.mipmaps;F.mipmapCount===1&&(C.minFilter=pn),C.format=F.format,C.needsUpdate=!0,c&&c(C)},d,m);return C}}class gg extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=n;this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const w=this,C=xn.get(n);if(C!==void 0)return w.manager.itemStart(n),setTimeout(function(){c&&c(C),w.manager.itemEnd(n)},0),C;const P=tc("img");function D(){j(),xn.add(n,this),c&&c(this),w.manager.itemEnd(n)}function B(F){j(),m&&m(F),w.manager.itemError(n),w.manager.itemEnd(n)}function j(){P.removeEventListener("load",D,!1),P.removeEventListener("error",B,!1)}return P.addEventListener("load",D,!1),P.addEventListener("error",B,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(P.crossOrigin=this.crossOrigin),w.manager.itemStart(n),xn.get(n,"blob").then(F=>{if(F!==void 0&&!F.type.startsWith("text/plain"))return F.type||(n.endsWith(".svg")||n.startsWith("data:image/svg"))&&(F=new Blob([F],{type:"image/svg+xml"})),void(P.src=URL.createObjectURL(F));const z=new Ac(this.manager);z.useCache=!1,z.setPath(this.path),z.setCrossOrigin(this.crossOrigin),z.setResponseType("blob"),z.load(v,function(G){G.type||(n.endsWith(".svg")||n.startsWith("data:image/svg"))&&(G=new Blob([G],{type:"image/svg+xml"})),xn.add(n,G,"blob"),P.src=URL.createObjectURL(G)},d,G=>{j(),m&&m(G)})}),P}}class hE extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=new Pu;v.colorSpace=Yi;const w=new gg(this.manager);w.setCrossOrigin(this.crossOrigin),w.setPath(this.path);let C=0;function P(D){w.load(n[D],function(B){v.images[D]=B,C++,C===6&&(v.needsUpdate=!0,c&&c(v))},void 0,m)}for(let D=0;D<n.length;++D)P(D);return v}}class ow extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=new La,C=new Ac(this.manager);return C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(v.withCredentials),C.load(n,function(P){const D=v.parse(P);D&&(D.image!==void 0?w.image=D.image:D.data!==void 0&&(w.image.width=D.width,w.image.height=D.height,w.image.data=D.data,w.image.complete=!0),w.wrapS=D.wrapS!==void 0?D.wrapS:fs,w.wrapT=D.wrapT!==void 0?D.wrapT:fs,w.magFilter=D.magFilter!==void 0?D.magFilter:pn,w.minFilter=D.minFilter!==void 0?D.minFilter:pn,w.anisotropy=D.anisotropy!==void 0?D.anisotropy:1,D.colorSpace!==void 0?w.colorSpace=D.colorSpace:D.encoding!==void 0&&(w.encoding=D.encoding),D.flipY!==void 0&&(w.flipY=D.flipY),D.format!==void 0&&(w.format=D.format),D.type!==void 0&&(w.type=D.type),D.mipmaps!==void 0&&(w.mipmaps=D.mipmaps,w.minFilter=_l),D.mipmapCount===1&&(w.minFilter=pn),D.generateMipmaps!==void 0&&(w.generateMipmaps=D.generateMipmaps),w.needsUpdate=!0,c&&c(w,D))},d,m),w}}class Zf extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=new xr,w=new gg(this.manager);return w.setCrossOrigin(this.crossOrigin),w.setPath(this.path),w.load(n,function(C){v.image=C,v.needsUpdate=!0,c!==void 0&&c(v)},d,m),v}}class wc extends Nr{constructor(n,c=1){super(),this.isLight=!0,this.type="Light",this.color=new xi(n),this.intensity=c}dispose(){}copy(n,c){return super.copy(n,c),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const c=super.toJSON(n);return c.object.color=this.color.getHex(),c.object.intensity=this.intensity,this.groundColor!==void 0&&(c.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(c.object.distance=this.distance),this.angle!==void 0&&(c.object.angle=this.angle),this.decay!==void 0&&(c.object.decay=this.decay),this.penumbra!==void 0&&(c.object.penumbra=this.penumbra),this.shadow!==void 0&&(c.object.shadow=this.shadow.toJSON()),c}}class Mo extends wc{constructor(n,c,d){super(n,d),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Nr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new xi(c)}copy(n,c){return super.copy(n,c),this.groundColor.copy(n.groundColor),this}}const Oy=new or,vp=new Se,Ly=new Se;class y0{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Jt(512,512),this.map=null,this.mapPass=null,this.matrix=new or,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ef,this._frameExtents=new Jt(1,1),this._viewportCount=1,this._viewports=[new Tr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const c=this.camera,d=this.matrix;vp.setFromMatrixPosition(n.matrixWorld),c.position.copy(vp),Ly.setFromMatrixPosition(n.target.matrixWorld),c.lookAt(Ly),c.updateMatrixWorld(),Oy.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Oy),d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(Oy)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.normalBias=n.normalBias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}}class b0 extends y0{constructor(){super(new vn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const c=this.camera,d=2*ec*n.angle*this.focus,m=this.mapSize.width/this.mapSize.height,v=n.distance||c.far;d===c.fov&&m===c.aspect&&v===c.far||(c.fov=d,c.aspect=m,c.far=v,c.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}}class ky extends wc{constructor(n,c,d=0,m=Math.PI/3,v=0,w=2){super(n,c),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Nr.DEFAULT_UP),this.updateMatrix(),this.target=new Nr,this.distance=d,this.angle=m,this.penumbra=v,this.decay=w,this.map=null,this.shadow=new b0}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,c){return super.copy(n,c),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}const A0=new or,xc=new Se,vg=new Se;class w0 extends y0{constructor(){super(new vn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Jt(4,2),this._viewportCount=6,this._viewports=[new Tr(2,1,1,1),new Tr(0,1,1,1),new Tr(3,1,1,1),new Tr(1,1,1,1),new Tr(3,0,1,1),new Tr(1,0,1,1)],this._cubeDirections=[new Se(1,0,0),new Se(-1,0,0),new Se(0,0,1),new Se(0,0,-1),new Se(0,1,0),new Se(0,-1,0)],this._cubeUps=[new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,0,1),new Se(0,0,-1)]}updateMatrices(n,c=0){const d=this.camera,m=this.matrix,v=n.distance||d.far;v!==d.far&&(d.far=v,d.updateProjectionMatrix()),xc.setFromMatrixPosition(n.matrixWorld),d.position.copy(xc),vg.copy(d.position),vg.add(this._cubeDirections[c]),d.up.copy(this._cubeUps[c]),d.lookAt(vg),d.updateMatrixWorld(),m.makeTranslation(-xc.x,-xc.y,-xc.z),A0.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(A0)}}class Ec extends wc{constructor(n,c,d=0,m=2){super(n,c),this.isPointLight=!0,this.type="PointLight",this.distance=d,this.decay=m,this.shadow=new w0}get power(){return 4*this.intensity*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,c){return super.copy(n,c),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}}class dE extends y0{constructor(){super(new Ao(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class lw extends wc{constructor(n,c){super(n,c),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Nr.DEFAULT_UP),this.updateMatrix(),this.target=new Nr,this.shadow=new dE}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}class Uy extends wc{constructor(n,c){super(n,c),this.isAmbientLight=!0,this.type="AmbientLight"}}class x0 extends wc{constructor(n,c,d=10,m=10){super(n,c),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=d,this.height=m}get power(){return this.intensity*this.width*this.height*Math.PI}set power(n){this.intensity=n/(this.width*this.height*Math.PI)}copy(n){return super.copy(n),this.width=n.width,this.height=n.height,this}toJSON(n){const c=super.toJSON(n);return c.object.width=this.width,c.object.height=this.height,c}}class Ny{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let n=0;n<9;n++)this.coefficients.push(new Se)}set(n){for(let c=0;c<9;c++)this.coefficients[c].copy(n[c]);return this}zero(){for(let n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this}getAt(n,c){const d=n.x,m=n.y,v=n.z,w=this.coefficients;return c.copy(w[0]).multiplyScalar(.282095),c.addScaledVector(w[1],.488603*m),c.addScaledVector(w[2],.488603*v),c.addScaledVector(w[3],.488603*d),c.addScaledVector(w[4],d*m*1.092548),c.addScaledVector(w[5],m*v*1.092548),c.addScaledVector(w[6],.315392*(3*v*v-1)),c.addScaledVector(w[7],d*v*1.092548),c.addScaledVector(w[8],.546274*(d*d-m*m)),c}getIrradianceAt(n,c){const d=n.x,m=n.y,v=n.z,w=this.coefficients;return c.copy(w[0]).multiplyScalar(.886227),c.addScaledVector(w[1],1.023328*m),c.addScaledVector(w[2],1.023328*v),c.addScaledVector(w[3],1.023328*d),c.addScaledVector(w[4],.858086*d*m),c.addScaledVector(w[5],.858086*m*v),c.addScaledVector(w[6],.743125*v*v-.247708),c.addScaledVector(w[7],.858086*d*v),c.addScaledVector(w[8],.429043*(d*d-m*m)),c}add(n){for(let c=0;c<9;c++)this.coefficients[c].add(n.coefficients[c]);return this}addScaledSH(n,c){for(let d=0;d<9;d++)this.coefficients[d].addScaledVector(n.coefficients[d],c);return this}scale(n){for(let c=0;c<9;c++)this.coefficients[c].multiplyScalar(n);return this}lerp(n,c){for(let d=0;d<9;d++)this.coefficients[d].lerp(n.coefficients[d],c);return this}equals(n){for(let c=0;c<9;c++)if(!this.coefficients[c].equals(n.coefficients[c]))return!1;return!0}copy(n){return this.set(n.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(n,c=0){const d=this.coefficients;for(let m=0;m<9;m++)d[m].fromArray(n,c+3*m);return this}toArray(n=[],c=0){const d=this.coefficients;for(let m=0;m<9;m++)d[m].toArray(n,c+3*m);return n}static getBasisAt(n,c){const d=n.x,m=n.y,v=n.z;c[0]=.282095,c[1]=.488603*m,c[2]=.488603*v,c[3]=.488603*d,c[4]=1.092548*d*m,c[5]=1.092548*m*v,c[6]=.315392*(3*v*v-1),c[7]=1.092548*d*v,c[8]=.546274*(d*d-m*m)}}class To extends wc{constructor(n=new Ny,c=1){super(void 0,c),this.isLightProbe=!0,this.sh=n}copy(n){return super.copy(n),this.sh.copy(n.sh),this}fromJSON(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this}toJSON(n){const c=super.toJSON(n);return c.object.sh=this.sh.toArray(),c}}class E0 extends Hs{constructor(n){super(n),this.textures={}}load(n,c,d,m){const v=this,w=new Ac(v.manager);w.setPath(v.path),w.setRequestHeader(v.requestHeader),w.setWithCredentials(v.withCredentials),w.load(n,function(C){try{c(v.parse(JSON.parse(C)))}catch(P){m?m(P):console.error(P),v.manager.itemError(n)}},d,m)}parse(n){const c=this.textures;function d(w){return c[w]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",w),c[w]}const m=n.metadata&&n.metadata.version<=4.5?an:void 0,v=E0.createMaterialFromType(n.type);if(n.uuid!==void 0&&(v.uuid=n.uuid),n.name!==void 0&&(v.name=n.name),n.color!==void 0&&v.color!==void 0&&v.color.setHex(n.color,m),n.roughness!==void 0&&(v.roughness=n.roughness),n.metalness!==void 0&&(v.metalness=n.metalness),n.sheen!==void 0&&(v.sheen=n.sheen),n.sheenColor!==void 0&&(v.sheenColor=new xi().setHex(n.sheenColor,m)),n.sheenRoughness!==void 0&&(v.sheenRoughness=n.sheenRoughness),n.emissive!==void 0&&v.emissive!==void 0&&v.emissive.setHex(n.emissive,m),n.specular!==void 0&&v.specular!==void 0&&v.specular.setHex(n.specular,m),n.specularIntensity!==void 0&&(v.specularIntensity=n.specularIntensity),n.specularColor!==void 0&&v.specularColor!==void 0&&v.specularColor.setHex(n.specularColor,m),n.shininess!==void 0&&(v.shininess=n.shininess),n.clearcoat!==void 0&&(v.clearcoat=n.clearcoat),n.clearcoatRoughness!==void 0&&(v.clearcoatRoughness=n.clearcoatRoughness),n.iridescence!==void 0&&(v.iridescence=n.iridescence),n.iridescenceIOR!==void 0&&(v.iridescenceIOR=n.iridescenceIOR),n.iridescenceThicknessRange!==void 0&&(v.iridescenceThicknessRange=n.iridescenceThicknessRange),n.transmission!==void 0&&(v.transmission=n.transmission),n.thickness!==void 0&&(v.thickness=n.thickness),n.attenuationDistance!==void 0&&(v.attenuationDistance=n.attenuationDistance),n.attenuationColor!==void 0&&v.attenuationColor!==void 0&&v.attenuationColor.setHex(n.attenuationColor,m),n.anisotropy!==void 0&&(v.anisotropy=n.anisotropy),n.anisotropyRotation!==void 0&&(v.anisotropyRotation=n.anisotropyRotation),n.fog!==void 0&&(v.fog=n.fog),n.flatShading!==void 0&&(v.flatShading=n.flatShading),n.blending!==void 0&&(v.blending=n.blending),n.combine!==void 0&&(v.combine=n.combine),n.side!==void 0&&(v.side=n.side),n.shadowSide!==void 0&&(v.shadowSide=n.shadowSide),n.opacity!==void 0&&(v.opacity=n.opacity),n.transparent!==void 0&&(v.transparent=n.transparent),n.alphaTest!==void 0&&(v.alphaTest=n.alphaTest),n.depthTest!==void 0&&(v.depthTest=n.depthTest),n.depthWrite!==void 0&&(v.depthWrite=n.depthWrite),n.colorWrite!==void 0&&(v.colorWrite=n.colorWrite),n.stencilWrite!==void 0&&(v.stencilWrite=n.stencilWrite),n.stencilWriteMask!==void 0&&(v.stencilWriteMask=n.stencilWriteMask),n.stencilFunc!==void 0&&(v.stencilFunc=n.stencilFunc),n.stencilRef!==void 0&&(v.stencilRef=n.stencilRef),n.stencilFuncMask!==void 0&&(v.stencilFuncMask=n.stencilFuncMask),n.stencilFail!==void 0&&(v.stencilFail=n.stencilFail),n.stencilZFail!==void 0&&(v.stencilZFail=n.stencilZFail),n.stencilZPass!==void 0&&(v.stencilZPass=n.stencilZPass),n.wireframe!==void 0&&(v.wireframe=n.wireframe),n.wireframeLinewidth!==void 0&&(v.wireframeLinewidth=n.wireframeLinewidth),n.wireframeLinecap!==void 0&&(v.wireframeLinecap=n.wireframeLinecap),n.wireframeLinejoin!==void 0&&(v.wireframeLinejoin=n.wireframeLinejoin),n.rotation!==void 0&&(v.rotation=n.rotation),n.linewidth!==1&&(v.linewidth=n.linewidth),n.dashSize!==void 0&&(v.dashSize=n.dashSize),n.gapSize!==void 0&&(v.gapSize=n.gapSize),n.scale!==void 0&&(v.scale=n.scale),n.polygonOffset!==void 0&&(v.polygonOffset=n.polygonOffset),n.polygonOffsetFactor!==void 0&&(v.polygonOffsetFactor=n.polygonOffsetFactor),n.polygonOffsetUnits!==void 0&&(v.polygonOffsetUnits=n.polygonOffsetUnits),n.dithering!==void 0&&(v.dithering=n.dithering),n.alphaToCoverage!==void 0&&(v.alphaToCoverage=n.alphaToCoverage),n.premultipliedAlpha!==void 0&&(v.premultipliedAlpha=n.premultipliedAlpha),n.forceSinglePass!==void 0&&(v.forceSinglePass=n.forceSinglePass),n.visible!==void 0&&(v.visible=n.visible),n.toneMapped!==void 0&&(v.toneMapped=n.toneMapped),n.userData!==void 0&&(v.userData=n.userData),n.vertexColors!==void 0&&(typeof n.vertexColors=="number"?v.vertexColors=n.vertexColors>0:v.vertexColors=n.vertexColors),n.uniforms!==void 0)for(const w in n.uniforms){const C=n.uniforms[w];switch(v.uniforms[w]={},C.type){case"t":v.uniforms[w].value=d(C.value);break;case"c":v.uniforms[w].value=new xi().setHex(C.value,m);break;case"v2":v.uniforms[w].value=new Jt().fromArray(C.value);break;case"v3":v.uniforms[w].value=new Se().fromArray(C.value);break;case"v4":v.uniforms[w].value=new Tr().fromArray(C.value);break;case"m3":v.uniforms[w].value=new _r().fromArray(C.value);break;case"m4":v.uniforms[w].value=new or().fromArray(C.value);break;default:v.uniforms[w].value=C.value}}if(n.defines!==void 0&&(v.defines=n.defines),n.vertexShader!==void 0&&(v.vertexShader=n.vertexShader),n.fragmentShader!==void 0&&(v.fragmentShader=n.fragmentShader),n.glslVersion!==void 0&&(v.glslVersion=n.glslVersion),n.extensions!==void 0)for(const w in n.extensions)v.extensions[w]=n.extensions[w];if(n.lights!==void 0&&(v.lights=n.lights),n.clipping!==void 0&&(v.clipping=n.clipping),n.size!==void 0&&(v.size=n.size),n.sizeAttenuation!==void 0&&(v.sizeAttenuation=n.sizeAttenuation),n.map!==void 0&&(v.map=d(n.map)),n.matcap!==void 0&&(v.matcap=d(n.matcap)),n.alphaMap!==void 0&&(v.alphaMap=d(n.alphaMap)),n.bumpMap!==void 0&&(v.bumpMap=d(n.bumpMap)),n.bumpScale!==void 0&&(v.bumpScale=n.bumpScale),n.normalMap!==void 0&&(v.normalMap=d(n.normalMap)),n.normalMapType!==void 0&&(v.normalMapType=n.normalMapType),n.normalScale!==void 0){let w=n.normalScale;Array.isArray(w)===!1&&(w=[w,w]),v.normalScale=new Jt().fromArray(w)}return n.displacementMap!==void 0&&(v.displacementMap=d(n.displacementMap)),n.displacementScale!==void 0&&(v.displacementScale=n.displacementScale),n.displacementBias!==void 0&&(v.displacementBias=n.displacementBias),n.roughnessMap!==void 0&&(v.roughnessMap=d(n.roughnessMap)),n.metalnessMap!==void 0&&(v.metalnessMap=d(n.metalnessMap)),n.emissiveMap!==void 0&&(v.emissiveMap=d(n.emissiveMap)),n.emissiveIntensity!==void 0&&(v.emissiveIntensity=n.emissiveIntensity),n.specularMap!==void 0&&(v.specularMap=d(n.specularMap)),n.specularIntensityMap!==void 0&&(v.specularIntensityMap=d(n.specularIntensityMap)),n.specularColorMap!==void 0&&(v.specularColorMap=d(n.specularColorMap)),n.envMap!==void 0&&(v.envMap=d(n.envMap)),n.envMapIntensity!==void 0&&(v.envMapIntensity=n.envMapIntensity),n.reflectivity!==void 0&&(v.reflectivity=n.reflectivity),n.refractionRatio!==void 0&&(v.refractionRatio=n.refractionRatio),n.lightMap!==void 0&&(v.lightMap=d(n.lightMap)),n.lightMapIntensity!==void 0&&(v.lightMapIntensity=n.lightMapIntensity),n.aoMap!==void 0&&(v.aoMap=d(n.aoMap)),n.aoMapIntensity!==void 0&&(v.aoMapIntensity=n.aoMapIntensity),n.gradientMap!==void 0&&(v.gradientMap=d(n.gradientMap)),n.clearcoatMap!==void 0&&(v.clearcoatMap=d(n.clearcoatMap)),n.clearcoatRoughnessMap!==void 0&&(v.clearcoatRoughnessMap=d(n.clearcoatRoughnessMap)),n.clearcoatNormalMap!==void 0&&(v.clearcoatNormalMap=d(n.clearcoatNormalMap)),n.clearcoatNormalScale!==void 0&&(v.clearcoatNormalScale=new Jt().fromArray(n.clearcoatNormalScale)),n.iridescenceMap!==void 0&&(v.iridescenceMap=d(n.iridescenceMap)),n.iridescenceThicknessMap!==void 0&&(v.iridescenceThicknessMap=d(n.iridescenceThicknessMap)),n.transmissionMap!==void 0&&(v.transmissionMap=d(n.transmissionMap)),n.thicknessMap!==void 0&&(v.thicknessMap=d(n.thicknessMap)),n.anisotropyMap!==void 0&&(v.anisotropyMap=d(n.anisotropyMap)),n.sheenColorMap!==void 0&&(v.sheenColorMap=d(n.sheenColorMap)),n.sheenRoughnessMap!==void 0&&(v.sheenRoughnessMap=d(n.sheenRoughnessMap)),v}setTextures(n){return this.textures=n,this}static createMaterialFromType(n){return new{ShadowMaterial:My,SpriteMaterial:qv,RawShaderMaterial:nw,ShaderMaterial:cc,PointsMaterial:ig,MeshPhysicalMaterial:el,MeshStandardMaterial:qf,MeshPhongMaterial:Ty,MeshToonMaterial:Iy,MeshNormalMaterial:g0,MeshLambertMaterial:mp,MeshDepthMaterial:io,MeshDistanceMaterial:rp,MeshBasicMaterial:qc,MeshMatcapMaterial:jn,LineDashedMaterial:sw,LineBasicMaterial:wa,Material:Gs}[n]}}class Fy{static decodeText(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let c="";for(let d=0,m=n.length;d<m;d++)c+=String.fromCharCode(n[d]);try{return decodeURIComponent(escape(c))}catch{return c}}static extractUrlBase(n){const c=n.lastIndexOf("/");return c===-1?"./":n.slice(0,c+1)}static resolveURL(n,c){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(c)&&/^\//.test(n)&&(c=c.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:c+n)}}class jy extends hr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(n){return super.copy(n),this.instanceCount=n.instanceCount,this}toJSON(){const n=super.toJSON();return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}}class Ll extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=new Ac(v.manager);w.setPath(v.path),w.setRequestHeader(v.requestHeader),w.setWithCredentials(v.withCredentials),w.load(n,function(C){try{c(v.parse(JSON.parse(C)))}catch(P){m?m(P):console.error(P),v.manager.itemError(n)}},d,m)}parse(n){const c={},d={};function m(j,F){if(c[F]!==void 0)return c[F];const z=j.interleavedBuffers[F],G=function($,Y){if(d[Y]!==void 0)return d[Y];const q=$.arrayBuffers[Y],be=new Uint32Array(q).buffer;return d[Y]=be,be}(j,z.buffer),W=Ml(z.type,G),Q=new Xv(W,z.stride);return Q.uuid=z.uuid,c[F]=Q,Q}const v=n.isInstancedBufferGeometry?new jy:new hr,w=n.data.index;if(w!==void 0){const j=Ml(w.type,w.array);v.setIndex(new on(j,1))}const C=n.data.attributes;for(const j in C){const F=C[j];let z;if(F.isInterleavedBufferAttribute){const G=m(n.data,F.data);z=new Bh(G,F.itemSize,F.offset,F.normalized)}else{const G=Ml(F.type,F.array);z=new(F.isInstancedBufferAttribute?lp:on)(G,F.itemSize,F.normalized)}F.name!==void 0&&(z.name=F.name),F.usage!==void 0&&z.setUsage(F.usage),F.updateRange!==void 0&&(z.updateRange.offset=F.updateRange.offset,z.updateRange.count=F.updateRange.count),v.setAttribute(j,z)}const P=n.data.morphAttributes;if(P)for(const j in P){const F=P[j],z=[];for(let G=0,W=F.length;G<W;G++){const Q=F[G];let $;if(Q.isInterleavedBufferAttribute){const Y=m(n.data,Q.data);$=new Bh(Y,Q.itemSize,Q.offset,Q.normalized)}else{const Y=Ml(Q.type,Q.array);$=new on(Y,Q.itemSize,Q.normalized)}Q.name!==void 0&&($.name=Q.name),z.push($)}v.morphAttributes[j]=z}n.data.morphTargetsRelative&&(v.morphTargetsRelative=!0);const D=n.data.groups||n.data.drawcalls||n.data.offsets;if(D!==void 0)for(let j=0,F=D.length;j!==F;++j){const z=D[j];v.addGroup(z.start,z.count,z.materialIndex)}const B=n.data.boundingSphere;if(B!==void 0){const j=new Se;B.center!==void 0&&j.fromArray(B.center),v.boundingSphere=new Pa(j,B.radius)}return n.name&&(v.name=n.name),n.userData&&(v.userData=n.userData),v}}class pE extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=this.path===""?Fy.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||w;const C=new Ac(this.manager);C.setPath(this.path),C.setRequestHeader(this.requestHeader),C.setWithCredentials(this.withCredentials),C.load(n,function(P){let D=null;try{D=JSON.parse(P)}catch(j){return m!==void 0&&m(j),void console.error("THREE:ObjectLoader: Can't parse "+n+".",j.message)}const B=D.metadata;if(B===void 0||B.type===void 0||B.type.toLowerCase()==="geometry")return m!==void 0&&m(new Error("THREE.ObjectLoader: Can't load "+n)),void console.error("THREE.ObjectLoader: Can't load "+n);v.parse(D,c)},d,m)}async loadAsync(n,c){const d=this.path===""?Fy.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||d;const m=new Ac(this.manager);m.setPath(this.path),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials);const v=await m.loadAsync(n,c),w=JSON.parse(v),C=w.metadata;if(C===void 0||C.type===void 0||C.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+n);return await this.parseAsync(w)}parse(n,c){const d=this.parseAnimations(n.animations),m=this.parseShapes(n.shapes),v=this.parseGeometries(n.geometries,m),w=this.parseImages(n.images,function(){c!==void 0&&c(D)}),C=this.parseTextures(n.textures,w),P=this.parseMaterials(n.materials,C),D=this.parseObject(n.object,v,P,C,d),B=this.parseSkeletons(n.skeletons,D);if(this.bindSkeletons(D,B),c!==void 0){let j=!1;for(const F in w)if(w[F].data instanceof HTMLImageElement){j=!0;break}j===!1&&c(D)}return D}async parseAsync(n){const c=this.parseAnimations(n.animations),d=this.parseShapes(n.shapes),m=this.parseGeometries(n.geometries,d),v=await this.parseImagesAsync(n.images),w=this.parseTextures(n.textures,v),C=this.parseMaterials(n.materials,w),P=this.parseObject(n.object,m,C,w,c),D=this.parseSkeletons(n.skeletons,P);return this.bindSkeletons(P,D),P}parseShapes(n){const c={};if(n!==void 0)for(let d=0,m=n.length;d<m;d++){const v=new fp().fromJSON(n[d]);c[v.uuid]=v}return c}parseSkeletons(n,c){const d={},m={};if(c.traverse(function(v){v.isBone&&(m[v.uuid]=v)}),n!==void 0)for(let v=0,w=n.length;v<w;v++){const C=new Jm().fromJSON(n[v],m);d[C.uuid]=C}return d}parseGeometries(n,c){const d={};if(n!==void 0){const m=new Ll;for(let v=0,w=n.length;v<w;v++){let C;const P=n[v];switch(P.type){case"BufferGeometry":case"InstancedBufferGeometry":C=m.parse(P);break;default:P.type in rw?C=rw[P.type].fromJSON(P,c):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${P.type}"`)}C.uuid=P.uuid,P.name!==void 0&&(C.name=P.name),P.userData!==void 0&&(C.userData=P.userData),d[P.uuid]=C}}return d}parseMaterials(n,c){const d={},m={};if(n!==void 0){const v=new E0;v.setTextures(c);for(let w=0,C=n.length;w<C;w++){const P=n[w];d[P.uuid]===void 0&&(d[P.uuid]=v.parse(P)),m[P.uuid]=d[P.uuid]}}return m}parseAnimations(n){const c={};if(n!==void 0)for(let d=0;d<n.length;d++){const m=n[d],v=il.parse(m);c[v.uuid]=v}return c}parseImages(n,c){const d=this,m={};let v;function w(C){if(typeof C=="string"){const P=C;return function(D){return d.manager.itemStart(D),v.load(D,function(){d.manager.itemEnd(D)},void 0,function(){d.manager.itemError(D),d.manager.itemEnd(D)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(P)?P:d.resourcePath+P)}return C.data?{data:Ml(C.type,C.data),width:C.width,height:C.height,complete:!0}:null}if(n!==void 0&&n.length>0){const C=new mg(c);v=new gg(C),v.setCrossOrigin(this.crossOrigin);for(let P=0,D=n.length;P<D;P++){const B=n[P],j=B.url;if(Array.isArray(j)){const F=[];for(let z=0,G=j.length;z<G;z++){const W=w(j[z]);W!==null&&(W instanceof HTMLImageElement?F.push(W):F.push(new La(W.data,W.width,W.height)))}m[B.uuid]=new yu(F)}else{const F=w(B.url);m[B.uuid]=new yu(F)}}}return m}async parseImagesAsync(n){const c=this,d={};let m;async function v(w){if(typeof w=="string"){const C=w,P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(C)?C:c.resourcePath+C;return await m.loadAsync(P)}return w.data?{data:Ml(w.type,w.data),width:w.width,height:w.height,complete:!0}:null}if(n!==void 0&&n.length>0){m=new gg(this.manager),m.setCrossOrigin(this.crossOrigin);for(let w=0,C=n.length;w<C;w++){const P=n[w],D=P.url;if(Array.isArray(D)){const B=[];for(let j=0,F=D.length;j<F;j++){const z=D[j],G=await v(z);G!==null&&(G instanceof HTMLImageElement?B.push(G):B.push(new La(G.data,G.width,G.height)))}d[P.uuid]=new yu(B)}else{const B=await v(P.url);d[P.uuid]=new yu(B)}}}return d}parseTextures(n,c){function d(v,w){return typeof v=="number"?v:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",v),w[v])}const m={};if(n!==void 0)for(let v=0,w=n.length;v<w;v++){const C=n[v];C.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',C.uuid),c[C.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",C.image);const P=c[C.image],D=P?P.data:void 0;let B;Array.isArray(D)?(B=new Pu,D.length===6&&(B.needsUpdate=!0)):(B=D&&D.data?new La:new xr,D&&D.complete&&(B.needsUpdate=!0)),B.source=P,B.uuid=C.uuid,C.name!==void 0&&(B.name=C.name),C.mapping!==void 0&&(B.mapping=d(C.mapping,fE)),C.channel!==void 0&&(B.channel=C.channel),C.offset!==void 0&&B.offset.fromArray(C.offset),C.repeat!==void 0&&B.repeat.fromArray(C.repeat),C.center!==void 0&&B.center.fromArray(C.center),C.rotation!==void 0&&(B.rotation=C.rotation),C.wrap!==void 0&&(B.wrapS=d(C.wrap[0],zy),B.wrapT=d(C.wrap[1],zy)),C.format!==void 0&&(B.format=C.format),C.internalFormat!==void 0&&(B.internalFormat=C.internalFormat),C.type!==void 0&&(B.type=C.type),C.colorSpace!==void 0?B.colorSpace=C.colorSpace:C.encoding!==void 0&&(B.encoding=C.encoding),C.minFilter!==void 0&&(B.minFilter=d(C.minFilter,nl)),C.magFilter!==void 0&&(B.magFilter=d(C.magFilter,nl)),C.anisotropy!==void 0&&(B.anisotropy=C.anisotropy),C.flipY!==void 0&&(B.flipY=C.flipY),C.generateMipmaps!==void 0&&(B.generateMipmaps=C.generateMipmaps),C.premultiplyAlpha!==void 0&&(B.premultiplyAlpha=C.premultiplyAlpha),C.unpackAlignment!==void 0&&(B.unpackAlignment=C.unpackAlignment),C.compareFunction!==void 0&&(B.compareFunction=C.compareFunction),C.userData!==void 0&&(B.userData=C.userData),m[C.uuid]=B}return m}parseObject(n,c,d,m,v){let w;const C=n.metadata&&n.metadata.version<=4.5?an:void 0;function P(z){return c[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",z),c[z]}function D(z){if(z!==void 0){if(Array.isArray(z)){const G=[];for(let W=0,Q=z.length;W<Q;W++){const $=z[W];d[$]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",$),G.push(d[$])}return G}return d[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",z),d[z]}}function B(z){return m[z]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",z),m[z]}let j,F;switch(n.type){case"Scene":w=new dy,n.background!==void 0&&(Number.isInteger(n.background)?w.background=new xi().setHex(n.background,C):w.background=B(n.background)),n.environment!==void 0&&(w.environment=B(n.environment)),n.fog!==void 0&&(n.fog.type==="Fog"?w.fog=new Wv(n.fog.color,n.fog.near,n.fog.far):n.fog.type==="FogExp2"&&(w.fog=new Wm(n.fog.color,n.fog.density))),n.backgroundBlurriness!==void 0&&(w.backgroundBlurriness=n.backgroundBlurriness),n.backgroundIntensity!==void 0&&(w.backgroundIntensity=n.backgroundIntensity);break;case"PerspectiveCamera":w=new vn(n.fov,n.aspect,n.near,n.far),n.focus!==void 0&&(w.focus=n.focus),n.zoom!==void 0&&(w.zoom=n.zoom),n.filmGauge!==void 0&&(w.filmGauge=n.filmGauge),n.filmOffset!==void 0&&(w.filmOffset=n.filmOffset),n.view!==void 0&&(w.view=Object.assign({},n.view));break;case"OrthographicCamera":w=new Ao(n.left,n.right,n.top,n.bottom,n.near,n.far),n.zoom!==void 0&&(w.zoom=n.zoom),n.view!==void 0&&(w.view=Object.assign({},n.view));break;case"AmbientLight":w=new Uy(n.color,n.intensity);break;case"DirectionalLight":w=new lw(n.color,n.intensity);break;case"PointLight":w=new Ec(n.color,n.intensity,n.distance,n.decay);break;case"RectAreaLight":w=new x0(n.color,n.intensity,n.width,n.height);break;case"SpotLight":w=new ky(n.color,n.intensity,n.distance,n.angle,n.penumbra,n.decay);break;case"HemisphereLight":w=new Mo(n.color,n.groundColor,n.intensity);break;case"LightProbe":w=new To().fromJSON(n);break;case"SkinnedMesh":j=P(n.geometry),F=D(n.material),w=new jA(j,F),n.bindMode!==void 0&&(w.bindMode=n.bindMode),n.bindMatrix!==void 0&&w.bindMatrix.fromArray(n.bindMatrix),n.skeleton!==void 0&&(w.skeleton=n.skeleton);break;case"Mesh":j=P(n.geometry),F=D(n.material),w=new Ut(j,F);break;case"InstancedMesh":j=P(n.geometry),F=D(n.material);const z=n.count,G=n.instanceMatrix,W=n.instanceColor;w=new i0(j,F,z),w.instanceMatrix=new lp(new Float32Array(G.array),16),W!==void 0&&(w.instanceColor=new lp(new Float32Array(W.array),W.itemSize));break;case"LOD":w=new Of;break;case"Line":w=new Uu(P(n.geometry),D(n.material));break;case"LineLoop":w=new s0(P(n.geometry),D(n.material));break;case"LineSegments":w=new vc(P(n.geometry),D(n.material));break;case"PointCloud":case"Points":w=new py(P(n.geometry),D(n.material));break;case"Sprite":w=new Lu(D(n.material));break;case"Group":w=new ws;break;case"Bone":w=new Lh;break;default:w=new Nr}if(w.uuid=n.uuid,n.name!==void 0&&(w.name=n.name),n.matrix!==void 0?(w.matrix.fromArray(n.matrix),n.matrixAutoUpdate!==void 0&&(w.matrixAutoUpdate=n.matrixAutoUpdate),w.matrixAutoUpdate&&w.matrix.decompose(w.position,w.quaternion,w.scale)):(n.position!==void 0&&w.position.fromArray(n.position),n.rotation!==void 0&&w.rotation.fromArray(n.rotation),n.quaternion!==void 0&&w.quaternion.fromArray(n.quaternion),n.scale!==void 0&&w.scale.fromArray(n.scale)),n.up!==void 0&&w.up.fromArray(n.up),n.castShadow!==void 0&&(w.castShadow=n.castShadow),n.receiveShadow!==void 0&&(w.receiveShadow=n.receiveShadow),n.shadow&&(n.shadow.bias!==void 0&&(w.shadow.bias=n.shadow.bias),n.shadow.normalBias!==void 0&&(w.shadow.normalBias=n.shadow.normalBias),n.shadow.radius!==void 0&&(w.shadow.radius=n.shadow.radius),n.shadow.mapSize!==void 0&&w.shadow.mapSize.fromArray(n.shadow.mapSize),n.shadow.camera!==void 0&&(w.shadow.camera=this.parseObject(n.shadow.camera))),n.visible!==void 0&&(w.visible=n.visible),n.frustumCulled!==void 0&&(w.frustumCulled=n.frustumCulled),n.renderOrder!==void 0&&(w.renderOrder=n.renderOrder),n.userData!==void 0&&(w.userData=n.userData),n.layers!==void 0&&(w.layers.mask=n.layers),n.children!==void 0){const z=n.children;for(let G=0;G<z.length;G++)w.add(this.parseObject(z[G],c,d,m,v))}if(n.animations!==void 0){const z=n.animations;for(let G=0;G<z.length;G++){const W=z[G];w.animations.push(v[W])}}if(n.type==="LOD"){n.autoUpdate!==void 0&&(w.autoUpdate=n.autoUpdate);const z=n.levels;for(let G=0;G<z.length;G++){const W=z[G],Q=w.getObjectByProperty("uuid",W.object);Q!==void 0&&w.addLevel(Q,W.distance,W.hysteresis)}}return w}bindSkeletons(n,c){Object.keys(c).length!==0&&n.traverse(function(d){if(d.isSkinnedMesh===!0&&d.skeleton!==void 0){const m=c[d.skeleton];m===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",d.skeleton):d.bind(m,d.bindMatrix)}})}}const fE={UVMapping:hn,CubeReflectionMapping:ae,CubeRefractionMapping:Gr,EquirectangularReflectionMapping:An,EquirectangularRefractionMapping:ps,CubeUVReflectionMapping:cr},zy={RepeatWrapping:br,ClampToEdgeWrapping:fs,MirroredRepeatWrapping:$n},nl={NearestFilter:dn,NearestMipmapNearestFilter:Ha,NearestMipmapLinearFilter:vl,LinearFilter:pn,LinearMipmapNearestFilter:uh,LinearMipmapLinearFilter:_l};class Vy extends Hs{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,c,d,m){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const v=this;xn.get(n,"blob").then(w=>{if(w!==void 0)return v.manager.itemStart(n),void createImageBitmap(w,Object.assign(v.options,{colorSpaceConversion:"none"})).then(function(P){c&&c(P),v.manager.itemEnd(n)}).catch(function(P){m&&m(P),v.manager.itemError(n),v.manager.itemEnd(n)});const C={};C.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",C.headers=this.requestHeader,fetch(n,C).then(function(P){return P.blob()}).then(function(P){return xn.add(n,P,"blob"),createImageBitmap(P,Object.assign(v.options,{colorSpaceConversion:"none"}))}).then(function(P){c&&c(P),v.manager.itemEnd(n)}).catch(function(P){m&&m(P),v.manager.itemError(n),v.manager.itemEnd(n)}),v.manager.itemStart(n)})}}let S0;class Gy{static getContext(){return S0===void 0&&(S0=new(window.AudioContext||window.webkitAudioContext)),S0}static setContext(n){S0=n}}class mE extends Hs{constructor(n){super(n)}load(n,c,d,m){const v=this,w=new Ac(this.manager);function C(P){m?m(P):console.error(P),v.manager.itemError(n)}w.setResponseType("arraybuffer"),w.setPath(this.path),w.setRequestHeader(this.requestHeader),w.setWithCredentials(this.withCredentials),w.load(n,function(P){try{const D=P.slice(0);Gy.getContext().decodeAudioData(D,function(B){c(B)},C)}catch(D){C(D)}},d,m)}}class gE extends To{constructor(n,c,d=1){super(void 0,d),this.isHemisphereLightProbe=!0;const m=new xi().set(n),v=new xi().set(c),w=new Se(m.r,m.g,m.b),C=new Se(v.r,v.g,v.b),P=Math.sqrt(Math.PI),D=P*Math.sqrt(.75);this.sh.coefficients[0].copy(w).add(C).multiplyScalar(P),this.sh.coefficients[1].copy(w).sub(C).multiplyScalar(D)}}class vE extends To{constructor(n,c=1){super(void 0,c),this.isAmbientLightProbe=!0;const d=new xi().set(n);this.sh.coefficients[0].set(d.r,d.g,d.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const cw=new or,Jf=new or,xs=new or;class uw{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new vn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new vn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(n){const c=this._cache;if(c.focus!==n.focus||c.fov!==n.fov||c.aspect!==n.aspect*this.aspect||c.near!==n.near||c.far!==n.far||c.zoom!==n.zoom||c.eyeSep!==this.eyeSep){c.focus=n.focus,c.fov=n.fov,c.aspect=n.aspect*this.aspect,c.near=n.near,c.far=n.far,c.zoom=n.zoom,c.eyeSep=this.eyeSep,xs.copy(n.projectionMatrix);const d=c.eyeSep/2,m=d*c.near/c.focus,v=c.near*Math.tan(_u*c.fov*.5)/c.zoom;let w,C;Jf.elements[12]=-d,cw.elements[12]=d,w=-v*c.aspect+m,C=v*c.aspect+m,xs.elements[0]=2*c.near/(C-w),xs.elements[8]=(C+w)/(C-w),this.cameraL.projectionMatrix.copy(xs),w=-v*c.aspect-m,C=v*c.aspect-m,xs.elements[0]=2*c.near/(C-w),xs.elements[8]=(C+w)/(C-w),this.cameraR.projectionMatrix.copy(xs)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(Jf),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(cw)}}class C0{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const c=nu();n=(c-this.oldTime)/1e3,this.oldTime=c,this.elapsedTime+=n}return n}}function nu(){return(typeof performance>"u"?Date:performance).now()}const Xu=new Se,M0=new Vs,_E=new Se,Gh=new Se;class Hy extends Nr{constructor(){super(),this.type="AudioListener",this.context=Gy.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new C0}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const c=this.context.listener,d=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xu,M0,_E),Gh.set(0,0,-1).applyQuaternion(M0),c.positionX){const m=this.context.currentTime+this.timeDelta;c.positionX.linearRampToValueAtTime(Xu.x,m),c.positionY.linearRampToValueAtTime(Xu.y,m),c.positionZ.linearRampToValueAtTime(Xu.z,m),c.forwardX.linearRampToValueAtTime(Gh.x,m),c.forwardY.linearRampToValueAtTime(Gh.y,m),c.forwardZ.linearRampToValueAtTime(Gh.z,m),c.upX.linearRampToValueAtTime(d.x,m),c.upY.linearRampToValueAtTime(d.y,m),c.upZ.linearRampToValueAtTime(d.z,m)}else c.setPosition(Xu.x,Xu.y,Xu.z),c.setOrientation(Gh.x,Gh.y,Gh.z,d.x,d.y,d.z)}}class T0 extends Nr{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+n;const c=this.context.createBufferSource();return c.buffer=this.buffer,c.loop=this.loop,c.loopStart=this.loopStart,c.loopEnd=this.loopEnd,c.onended=this.onEnded.bind(this),c.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=c,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,c=this.filters.length;n<c;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,c=this.filters.length;n<c;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){if(this.detune=n,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl!==!1)return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl!==!1)return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}}const qu=new Se,Sc=new Vs,hw=new Se,Yu=new Se;class yE extends T0{constructor(n){super(n),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(n){return this.panner.refDistance=n,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(n){return this.panner.rolloffFactor=n,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(n){return this.panner.distanceModel=n,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(n){return this.panner.maxDistance=n,this}setDirectionalCone(n,c,d){return this.panner.coneInnerAngle=n,this.panner.coneOuterAngle=c,this.panner.coneOuterGain=d,this}updateMatrixWorld(n){if(super.updateMatrixWorld(n),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(qu,Sc,hw),Yu.set(0,0,1).applyQuaternion(Sc);const c=this.panner;if(c.positionX){const d=this.context.currentTime+this.listener.timeDelta;c.positionX.linearRampToValueAtTime(qu.x,d),c.positionY.linearRampToValueAtTime(qu.y,d),c.positionZ.linearRampToValueAtTime(qu.z,d),c.orientationX.linearRampToValueAtTime(Yu.x,d),c.orientationY.linearRampToValueAtTime(Yu.y,d),c.orientationZ.linearRampToValueAtTime(Yu.z,d)}else c.setPosition(qu.x,qu.y,qu.z),c.setOrientation(Yu.x,Yu.y,Yu.z)}}class bE{constructor(n,c=2048){this.analyser=n.context.createAnalyser(),this.analyser.fftSize=c,this.data=new Uint8Array(this.analyser.frequencyBinCount),n.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let n=0;const c=this.getFrequencyData();for(let d=0;d<c.length;d++)n+=c[d];return n/c.length}}class I0{constructor(n,c,d){let m,v,w;switch(this.binding=n,this.valueSize=d,c){case"quaternion":m=this._slerp,v=this._slerpAdditive,w=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*d),this._workIndex=5;break;case"string":case"bool":m=this._select,v=this._select,w=this._setAdditiveIdentityOther,this.buffer=new Array(5*d);break;default:m=this._lerp,v=this._lerpAdditive,w=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*d)}this._mixBufferRegion=m,this._mixBufferRegionAdditive=v,this._setIdentity=w,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(n,c){const d=this.buffer,m=this.valueSize,v=n*m+m;let w=this.cumulativeWeight;if(w===0){for(let C=0;C!==m;++C)d[v+C]=d[C];w=c}else{w+=c;const C=c/w;this._mixBufferRegion(d,v,0,C,m)}this.cumulativeWeight=w}accumulateAdditive(n){const c=this.buffer,d=this.valueSize,m=d*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(c,m,0,n,d),this.cumulativeWeightAdditive+=n}apply(n){const c=this.valueSize,d=this.buffer,m=n*c+c,v=this.cumulativeWeight,w=this.cumulativeWeightAdditive,C=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,v<1){const P=c*this._origIndex;this._mixBufferRegion(d,m,P,1-v,c)}w>0&&this._mixBufferRegionAdditive(d,m,this._addIndex*c,1,c);for(let P=c,D=c+c;P!==D;++P)if(d[P]!==d[P+c]){C.setValue(d,m);break}}saveOriginalState(){const n=this.binding,c=this.buffer,d=this.valueSize,m=d*this._origIndex;n.getValue(c,m);for(let v=d,w=m;v!==w;++v)c[v]=c[m+v%d];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const n=3*this.valueSize;this.binding.setValue(this.buffer,n)}_setAdditiveIdentityNumeric(){const n=this._addIndex*this.valueSize,c=n+this.valueSize;for(let d=n;d<c;d++)this.buffer[d]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const n=this._origIndex*this.valueSize,c=this._addIndex*this.valueSize;for(let d=0;d<this.valueSize;d++)this.buffer[c+d]=this.buffer[n+d]}_select(n,c,d,m,v){if(m>=.5)for(let w=0;w!==v;++w)n[c+w]=n[d+w]}_slerp(n,c,d,m){Vs.slerpFlat(n,c,n,c,n,d,m)}_slerpAdditive(n,c,d,m,v){const w=this._workIndex*v;Vs.multiplyQuaternionsFlat(n,w,n,c,n,d),Vs.slerpFlat(n,c,n,c,n,w,m)}_lerp(n,c,d,m,v){const w=1-m;for(let C=0;C!==v;++C){const P=c+C;n[P]=n[P]*w+n[d+C]*m}}_lerpAdditive(n,c,d,m,v){for(let w=0;w!==v;++w){const C=c+w;n[C]=n[C]+n[d+w]*m}}}const Hh="\\[\\]\\.:\\/",AE=new RegExp("["+Hh+"]","g"),Cc="[^"+Hh+"]",dw="[^"+Hh.replace("\\.","")+"]",wE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Cc)+/(WCOD+)?/.source.replace("WCOD",dw)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Cc)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Cc)+"$"),xE=["material","materials","bones","map"];class Qr{constructor(n,c,d){this.path=c,this.parsedPath=d||Qr.parseTrackName(c),this.node=Qr.findNode(n,this.parsedPath.nodeName),this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(n,c,d){return n&&n.isAnimationObjectGroup?new Qr.Composite(n,c,d):new Qr(n,c,d)}static sanitizeNodeName(n){return n.replace(/\s/g,"_").replace(AE,"")}static parseTrackName(n){const c=wE.exec(n);if(c===null)throw new Error("PropertyBinding: Cannot parse trackName: "+n);const d={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]},m=d.nodeName&&d.nodeName.lastIndexOf(".");if(m!==void 0&&m!==-1){const v=d.nodeName.substring(m+1);xE.indexOf(v)!==-1&&(d.nodeName=d.nodeName.substring(0,m),d.objectName=v)}if(d.propertyName===null||d.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+n);return d}static findNode(n,c){if(c===void 0||c===""||c==="."||c===-1||c===n.name||c===n.uuid)return n;if(n.skeleton){const d=n.skeleton.getBoneByName(c);if(d!==void 0)return d}if(n.children){const d=function(v){for(let w=0;w<v.length;w++){const C=v[w];if(C.name===c||C.uuid===c)return C;const P=d(C.children);if(P)return P}return null},m=d(n.children);if(m)return m}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(n,c){n[c]=this.targetObject[this.propertyName]}_getValue_array(n,c){const d=this.resolvedProperty;for(let m=0,v=d.length;m!==v;++m)n[c++]=d[m]}_getValue_arrayElement(n,c){n[c]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(n,c){this.resolvedProperty.toArray(n,c)}_setValue_direct(n,c){this.targetObject[this.propertyName]=n[c]}_setValue_direct_setNeedsUpdate(n,c){this.targetObject[this.propertyName]=n[c],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(n,c){this.targetObject[this.propertyName]=n[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,c){const d=this.resolvedProperty;for(let m=0,v=d.length;m!==v;++m)d[m]=n[c++]}_setValue_array_setNeedsUpdate(n,c){const d=this.resolvedProperty;for(let m=0,v=d.length;m!==v;++m)d[m]=n[c++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,c){const d=this.resolvedProperty;for(let m=0,v=d.length;m!==v;++m)d[m]=n[c++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(n,c){this.resolvedProperty[this.propertyIndex]=n[c]}_setValue_arrayElement_setNeedsUpdate(n,c){this.resolvedProperty[this.propertyIndex]=n[c],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(n,c){this.resolvedProperty[this.propertyIndex]=n[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(n,c){this.resolvedProperty.fromArray(n,c)}_setValue_fromArray_setNeedsUpdate(n,c){this.resolvedProperty.fromArray(n,c),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(n,c){this.resolvedProperty.fromArray(n,c),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(n,c){this.bind(),this.getValue(n,c)}_setValue_unbound(n,c){this.bind(),this.setValue(n,c)}bind(){let n=this.node;const c=this.parsedPath,d=c.objectName,m=c.propertyName;let v=c.propertyIndex;if(n||(n=Qr.findNode(this.rootNode,c.nodeName),this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!n)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(d){let D=c.objectIndex;switch(d){case"materials":if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);n=n.material.materials;break;case"bones":if(!n.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);n=n.skeleton.bones;for(let B=0;B<n.length;B++)if(n[B].name===D){D=B;break}break;case"map":if("map"in n){n=n.map;break}if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);n=n.material.map;break;default:if(n[d]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);n=n[d]}if(D!==void 0){if(n[D]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);n=n[D]}}const w=n[m];if(w===void 0){const D=c.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+D+"."+m+" but it wasn't found.",n)}let C=this.Versioning.None;this.targetObject=n,n.needsUpdate!==void 0?C=this.Versioning.NeedsUpdate:n.matrixWorldNeedsUpdate!==void 0&&(C=this.Versioning.MatrixWorldNeedsUpdate);let P=this.BindingType.Direct;if(v!==void 0){if(m==="morphTargetInfluences"){if(!n.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!n.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);n.morphTargetDictionary[v]!==void 0&&(v=n.morphTargetDictionary[v])}P=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=v}else w.fromArray!==void 0&&w.toArray!==void 0?(P=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(P=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=m;this.getValue=this.GetterByBindingType[P],this.setValue=this.SetterByBindingTypeAndVersioning[P][C]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Qr.Composite=class{constructor(b,n,c){const d=c||Qr.parseTrackName(n);this._targetGroup=b,this._bindings=b.subscribe_(n,d)}getValue(b,n){this.bind();const c=this._targetGroup.nCachedObjects_,d=this._bindings[c];d!==void 0&&d.getValue(b,n)}setValue(b,n){const c=this._bindings;for(let d=this._targetGroup.nCachedObjects_,m=c.length;d!==m;++d)c[d].setValue(b,n)}bind(){const b=this._bindings;for(let n=this._targetGroup.nCachedObjects_,c=b.length;n!==c;++n)b[n].bind()}unbind(){const b=this._bindings;for(let n=this._targetGroup.nCachedObjects_,c=b.length;n!==c;++n)b[n].unbind()}},Qr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Qr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Qr.prototype.GetterByBindingType=[Qr.prototype._getValue_direct,Qr.prototype._getValue_array,Qr.prototype._getValue_arrayElement,Qr.prototype._getValue_toArray],Qr.prototype.SetterByBindingTypeAndVersioning=[[Qr.prototype._setValue_direct,Qr.prototype._setValue_direct_setNeedsUpdate,Qr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Qr.prototype._setValue_array,Qr.prototype._setValue_array_setNeedsUpdate,Qr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Qr.prototype._setValue_arrayElement,Qr.prototype._setValue_arrayElement_setNeedsUpdate,Qr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Qr.prototype._setValue_fromArray,Qr.prototype._setValue_fromArray_setNeedsUpdate,Qr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class EE{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ts(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const n={};this._indicesByUUID=n;for(let d=0,m=arguments.length;d!==m;++d)n[arguments[d].uuid]=d;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const c=this;this.stats={objects:{get total(){return c._objects.length},get inUse(){return this.total-c.nCachedObjects_}},get bindingsPerObject(){return c._bindings.length}}}add(){const n=this._objects,c=this._indicesByUUID,d=this._paths,m=this._parsedPaths,v=this._bindings,w=v.length;let C,P=n.length,D=this.nCachedObjects_;for(let B=0,j=arguments.length;B!==j;++B){const F=arguments[B],z=F.uuid;let G=c[z];if(G===void 0){G=P++,c[z]=G,n.push(F);for(let W=0,Q=w;W!==Q;++W)v[W].push(new Qr(F,d[W],m[W]))}else if(G<D){C=n[G];const W=--D,Q=n[W];c[Q.uuid]=G,n[G]=Q,c[z]=W,n[W]=F;for(let $=0,Y=w;$!==Y;++$){const q=v[$],be=q[W];let we=q[G];q[G]=be,we===void 0&&(we=new Qr(F,d[$],m[$])),q[W]=we}}else n[G]!==C&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=D}remove(){const n=this._objects,c=this._indicesByUUID,d=this._bindings,m=d.length;let v=this.nCachedObjects_;for(let w=0,C=arguments.length;w!==C;++w){const P=arguments[w],D=P.uuid,B=c[D];if(B!==void 0&&B>=v){const j=v++,F=n[j];c[F.uuid]=B,n[B]=F,c[D]=j,n[j]=P;for(let z=0,G=m;z!==G;++z){const W=d[z],Q=W[j],$=W[B];W[B]=Q,W[j]=$}}}this.nCachedObjects_=v}uncache(){const n=this._objects,c=this._indicesByUUID,d=this._bindings,m=d.length;let v=this.nCachedObjects_,w=n.length;for(let C=0,P=arguments.length;C!==P;++C){const D=arguments[C].uuid,B=c[D];if(B!==void 0)if(delete c[D],B<v){const j=--v,F=n[j],z=--w,G=n[z];c[F.uuid]=B,n[B]=F,c[G.uuid]=j,n[j]=G,n.pop();for(let W=0,Q=m;W!==Q;++W){const $=d[W],Y=$[j],q=$[z];$[B]=Y,$[j]=q,$.pop()}}else{const j=--w,F=n[j];j>0&&(c[F.uuid]=B),n[B]=F,n.pop();for(let z=0,G=m;z!==G;++z){const W=d[z];W[B]=W[j],W.pop()}}}this.nCachedObjects_=v}subscribe_(n,c){const d=this._bindingsIndicesByPath;let m=d[n];const v=this._bindings;if(m!==void 0)return v[m];const w=this._paths,C=this._parsedPaths,P=this._objects,D=P.length,B=this.nCachedObjects_,j=new Array(D);m=v.length,d[n]=m,w.push(n),C.push(c),v.push(j);for(let F=B,z=P.length;F!==z;++F){const G=P[F];j[F]=new Qr(G,n,c)}return j}unsubscribe_(n){const c=this._bindingsIndicesByPath,d=c[n];if(d!==void 0){const m=this._paths,v=this._parsedPaths,w=this._bindings,C=w.length-1,P=w[C];c[n[C]]=d,w[d]=P,w.pop(),v[d]=v[C],v.pop(),m[d]=m[C],m.pop()}}}class pw{constructor(n,c,d=null,m=c.blendMode){this._mixer=n,this._clip=c,this._localRoot=d,this.blendMode=m;const v=c.tracks,w=v.length,C=new Array(w),P={endingStart:Jl,endingEnd:Jl};for(let D=0;D!==w;++D){const B=v[D].createInterpolant(null);C[D]=B,B.settings=P}this._interpolantSettings=P,this._interpolants=C,this._propertyBindings=new Array(w),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=af,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(n){return this._startTime=n,this}setLoop(n,c){return this.loop=n,this.repetitions=c,this}setEffectiveWeight(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(n){return this._scheduleFading(n,0,1)}fadeOut(n){return this._scheduleFading(n,1,0)}crossFadeFrom(n,c,d){if(n.fadeOut(c),this.fadeIn(c),d){const m=this._clip.duration,v=n._clip.duration,w=v/m,C=m/v;n.warp(1,w,c),this.warp(C,1,c)}return this}crossFadeTo(n,c,d){return n.crossFadeFrom(this,c,d)}stopFading(){const n=this._weightInterpolant;return n!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}setEffectiveTimeScale(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(n){return this.timeScale=this._clip.duration/n,this.stopWarping()}syncWith(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()}halt(n){return this.warp(this._effectiveTimeScale,0,n)}warp(n,c,d){const m=this._mixer,v=m.time,w=this.timeScale;let C=this._timeScaleInterpolant;C===null&&(C=m._lendControlInterpolant(),this._timeScaleInterpolant=C);const P=C.parameterPositions,D=C.sampleValues;return P[0]=v,P[1]=v+d,D[0]=n/w,D[1]=c/w,this}stopWarping(){const n=this._timeScaleInterpolant;return n!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(n,c,d,m){if(!this.enabled)return void this._updateWeight(n);const v=this._startTime;if(v!==null){const P=(n-v)*d;P<0||d===0?c=0:(this._startTime=null,c=d*P)}c*=this._updateTimeScale(n);const w=this._updateTime(c),C=this._updateWeight(n);if(C>0){const P=this._interpolants,D=this._propertyBindings;if(this.blendMode===Td)for(let B=0,j=P.length;B!==j;++B)P[B].evaluate(w),D[B].accumulateAdditive(C);else for(let B=0,j=P.length;B!==j;++B)P[B].evaluate(w),D[B].accumulate(m,C)}}_updateWeight(n){let c=0;if(this.enabled){c=this.weight;const d=this._weightInterpolant;if(d!==null){const m=d.evaluate(n)[0];c*=m,n>d.parameterPositions[1]&&(this.stopFading(),m===0&&(this.enabled=!1))}}return this._effectiveWeight=c,c}_updateTimeScale(n){let c=0;if(!this.paused){c=this.timeScale;const d=this._timeScaleInterpolant;d!==null&&(c*=d.evaluate(n)[0],n>d.parameterPositions[1]&&(this.stopWarping(),c===0?this.paused=!0:this.timeScale=c))}return this._effectiveTimeScale=c,c}_updateTime(n){const c=this._clip.duration,d=this.loop;let m=this.time+n,v=this._loopCount;const w=d===mu;if(n===0)return v===-1?m:w&&(1&v)==1?c-m:m;if(d===vr){v===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(m>=c)m=c;else{if(!(m<0)){this.time=m;break e}m=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=m,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(v===-1&&(n>=0?(v=0,this._setEndings(!0,this.repetitions===0,w)):this._setEndings(this.repetitions===0,!0,w)),m>=c||m<0){const C=Math.floor(m/c);m-=c*C,v+=Math.abs(C);const P=this.repetitions-v;if(P<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,m=n>0?c:0,this.time=m,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(P===1){const D=n<0;this._setEndings(D,!D,w)}else this._setEndings(!1,!1,w);this._loopCount=v,this.time=m,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:C})}}else this.time=m;if(w&&(1&v)==1)return c-m}return m}_setEndings(n,c,d){const m=this._interpolantSettings;d?(m.endingStart=$l,m.endingEnd=$l):(m.endingStart=n?this.zeroSlopeAtStart?$l:Jl:gu,m.endingEnd=c?this.zeroSlopeAtEnd?$l:Jl:gu)}_scheduleFading(n,c,d){const m=this._mixer,v=m.time;let w=this._weightInterpolant;w===null&&(w=m._lendControlInterpolant(),this._weightInterpolant=w);const C=w.parameterPositions,P=w.sampleValues;return C[0]=v,P[0]=c,C[1]=v+n,P[1]=d,this}}const fw=new Float32Array(1);class mw extends sr{constructor(n){super(),this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(n,c){const d=n._localRoot||this._root,m=n._clip.tracks,v=m.length,w=n._propertyBindings,C=n._interpolants,P=d.uuid,D=this._bindingsByRootAndName;let B=D[P];B===void 0&&(B={},D[P]=B);for(let j=0;j!==v;++j){const F=m[j],z=F.name;let G=B[z];if(G!==void 0)++G.referenceCount,w[j]=G;else{if(G=w[j],G!==void 0){G._cacheIndex===null&&(++G.referenceCount,this._addInactiveBinding(G,P,z));continue}const W=c&&c._propertyBindings[j].binding.parsedPath;G=new I0(Qr.create(d,z,W),F.ValueTypeName,F.getValueSize()),++G.referenceCount,this._addInactiveBinding(G,P,z),w[j]=G}C[j].resultBuffer=G.buffer}}_activateAction(n){if(!this._isActiveAction(n)){if(n._cacheIndex===null){const d=(n._localRoot||this._root).uuid,m=n._clip.uuid,v=this._actionsByClip[m];this._bindAction(n,v&&v.knownActions[0]),this._addInactiveAction(n,m,d)}const c=n._propertyBindings;for(let d=0,m=c.length;d!==m;++d){const v=c[d];v.useCount++==0&&(this._lendBinding(v),v.saveOriginalState())}this._lendAction(n)}}_deactivateAction(n){if(this._isActiveAction(n)){const c=n._propertyBindings;for(let d=0,m=c.length;d!==m;++d){const v=c[d];--v.useCount==0&&(v.restoreOriginalState(),this._takeBackBinding(v))}this._takeBackAction(n)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}}_isActiveAction(n){const c=n._cacheIndex;return c!==null&&c<this._nActiveActions}_addInactiveAction(n,c,d){const m=this._actions,v=this._actionsByClip;let w=v[c];if(w===void 0)w={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,v[c]=w;else{const C=w.knownActions;n._byClipCacheIndex=C.length,C.push(n)}n._cacheIndex=m.length,m.push(n),w.actionByRoot[d]=n}_removeInactiveAction(n){const c=this._actions,d=c[c.length-1],m=n._cacheIndex;d._cacheIndex=m,c[m]=d,c.pop(),n._cacheIndex=null;const v=n._clip.uuid,w=this._actionsByClip,C=w[v],P=C.knownActions,D=P[P.length-1],B=n._byClipCacheIndex;D._byClipCacheIndex=B,P[B]=D,P.pop(),n._byClipCacheIndex=null,delete C.actionByRoot[(n._localRoot||this._root).uuid],P.length===0&&delete w[v],this._removeInactiveBindingsForAction(n)}_removeInactiveBindingsForAction(n){const c=n._propertyBindings;for(let d=0,m=c.length;d!==m;++d){const v=c[d];--v.referenceCount==0&&this._removeInactiveBinding(v)}}_lendAction(n){const c=this._actions,d=n._cacheIndex,m=this._nActiveActions++,v=c[m];n._cacheIndex=m,c[m]=n,v._cacheIndex=d,c[d]=v}_takeBackAction(n){const c=this._actions,d=n._cacheIndex,m=--this._nActiveActions,v=c[m];n._cacheIndex=m,c[m]=n,v._cacheIndex=d,c[d]=v}_addInactiveBinding(n,c,d){const m=this._bindingsByRootAndName,v=this._bindings;let w=m[c];w===void 0&&(w={},m[c]=w),w[d]=n,n._cacheIndex=v.length,v.push(n)}_removeInactiveBinding(n){const c=this._bindings,d=n.binding,m=d.rootNode.uuid,v=d.path,w=this._bindingsByRootAndName,C=w[m],P=c[c.length-1],D=n._cacheIndex;P._cacheIndex=D,c[D]=P,c.pop(),delete C[v],Object.keys(C).length===0&&delete w[m]}_lendBinding(n){const c=this._bindings,d=n._cacheIndex,m=this._nActiveBindings++,v=c[m];n._cacheIndex=m,c[m]=n,v._cacheIndex=d,c[d]=v}_takeBackBinding(n){const c=this._bindings,d=n._cacheIndex,m=--this._nActiveBindings,v=c[m];n._cacheIndex=m,c[m]=n,v._cacheIndex=d,c[d]=v}_lendControlInterpolant(){const n=this._controlInterpolants,c=this._nActiveControlInterpolants++;let d=n[c];return d===void 0&&(d=new Wu(new Float32Array(2),new Float32Array(2),1,fw),d.__cacheIndex=c,n[c]=d),d}_takeBackControlInterpolant(n){const c=this._controlInterpolants,d=n.__cacheIndex,m=--this._nActiveControlInterpolants,v=c[m];n.__cacheIndex=m,c[m]=n,v.__cacheIndex=d,c[d]=v}clipAction(n,c,d){const m=c||this._root,v=m.uuid;let w=typeof n=="string"?il.findByName(m,n):n;const C=w!==null?w.uuid:n,P=this._actionsByClip[C];let D=null;if(d===void 0&&(d=w!==null?w.blendMode:js),P!==void 0){const j=P.actionByRoot[v];if(j!==void 0&&j.blendMode===d)return j;D=P.knownActions[0],w===null&&(w=D._clip)}if(w===null)return null;const B=new pw(this,w,c,d);return this._bindAction(B,D),this._addInactiveAction(B,C,v),B}existingAction(n,c){const d=c||this._root,m=d.uuid,v=typeof n=="string"?il.findByName(d,n):n,w=v?v.uuid:n,C=this._actionsByClip[w];return C!==void 0&&C.actionByRoot[m]||null}stopAllAction(){const n=this._actions;for(let c=this._nActiveActions-1;c>=0;--c)n[c].stop();return this}update(n){n*=this.timeScale;const c=this._actions,d=this._nActiveActions,m=this.time+=n,v=Math.sign(n),w=this._accuIndex^=1;for(let D=0;D!==d;++D)c[D]._update(m,n,v,w);const C=this._bindings,P=this._nActiveBindings;for(let D=0;D!==P;++D)C[D].apply(w);return this}setTime(n){this.time=0;for(let c=0;c<this._actions.length;c++)this._actions[c].time=0;return this.update(n)}getRoot(){return this._root}uncacheClip(n){const c=this._actions,d=n.uuid,m=this._actionsByClip,v=m[d];if(v!==void 0){const w=v.knownActions;for(let C=0,P=w.length;C!==P;++C){const D=w[C];this._deactivateAction(D);const B=D._cacheIndex,j=c[c.length-1];D._cacheIndex=null,D._byClipCacheIndex=null,j._cacheIndex=B,c[B]=j,c.pop(),this._removeInactiveBindingsForAction(D)}delete m[d]}}uncacheRoot(n){const c=n.uuid,d=this._actionsByClip;for(const v in d){const w=d[v].actionByRoot[c];w!==void 0&&(this._deactivateAction(w),this._removeInactiveAction(w))}const m=this._bindingsByRootAndName[c];if(m!==void 0)for(const v in m){const w=m[v];w.restoreOriginalState(),this._removeInactiveBinding(w)}}uncacheAction(n,c){const d=this.existingAction(n,c);d!==null&&(this._deactivateAction(d),this._removeInactiveAction(d))}}class _g{constructor(n){this.value=n}clone(){return new _g(this.value.clone===void 0?this.value:this.value.clone())}}let gw=0;class vw extends sr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:gw++}),this.name="",this.usage=Sl,this.uniforms=[]}add(n){return this.uniforms.push(n),this}remove(n){const c=this.uniforms.indexOf(n);return c!==-1&&this.uniforms.splice(c,1),this}setName(n){return this.name=n,this}setUsage(n){return this.usage=n,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(n){this.name=n.name,this.usage=n.usage;const c=n.uniforms;this.uniforms.length=0;for(let d=0,m=c.length;d<m;d++)this.uniforms.push(c[d].clone());return this}clone(){return new this.constructor().copy(this)}}class kl extends Xv{constructor(n,c,d=1){super(n,c),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=d}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}clone(n){const c=super.clone(n);return c.meshPerAttribute=this.meshPerAttribute,c}toJSON(n){const c=super.toJSON(n);return c.isInstancedInterleavedBuffer=!0,c.meshPerAttribute=this.meshPerAttribute,c}}class P0{constructor(n,c,d,m,v){this.isGLBufferAttribute=!0,this.name="",this.buffer=n,this.type=c,this.itemSize=d,this.elementSize=m,this.count=v,this.version=0}set needsUpdate(n){n===!0&&this.version++}setBuffer(n){return this.buffer=n,this}setType(n,c){return this.type=n,this.elementSize=c,this}setItemSize(n){return this.itemSize=n,this}setCount(n){return this.count=n,this}}class SE{constructor(n,c,d=0,m=1/0){this.ray=new Qc(n,c),this.near=d,this.far=m,this.camera=null,this.layers=new Pl,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,c){this.ray.set(n,c)}setFromCamera(n,c){c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(c).sub(this.ray.origin).normalize(),this.camera=c):c.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld),this.camera=c):console.error("THREE.Raycaster: Unsupported camera type: "+c.type)}intersectObject(n,c=!0,d=[]){return yg(n,this,d,c),d.sort(Qy),d}intersectObjects(n,c=!0,d=[]){for(let m=0,v=n.length;m<v;m++)yg(n[m],this,d,c);return d.sort(Qy),d}}function Qy(b,n){return b.distance-n.distance}function yg(b,n,c,d){if(b.layers.test(n.layers)&&b.raycast(n,c),d===!0){const m=b.children;for(let v=0,w=m.length;v<w;v++)yg(m[v],n,c,!0)}}class _w{constructor(n=1,c=0,d=0){return this.radius=n,this.phi=c,this.theta=d,this}set(n,c,d){return this.radius=n,this.phi=c,this.theta=d,this}copy(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,c,d){return this.radius=Math.sqrt(n*n+c*c+d*d),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,d),this.phi=Math.acos(Kr(c/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class so{constructor(n=1,c=0,d=0){return this.radius=n,this.theta=c,this.y=d,this}set(n,c,d){return this.radius=n,this.theta=c,this.y=d,this}copy(n){return this.radius=n.radius,this.theta=n.theta,this.y=n.y,this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,c,d){return this.radius=Math.sqrt(n*n+d*d),this.theta=Math.atan2(n,d),this.y=c,this}clone(){return new this.constructor().copy(this)}}const Ua=new Jt;class bg{constructor(n=new Jt(1/0,1/0),c=new Jt(-1/0,-1/0)){this.isBox2=!0,this.min=n,this.max=c}set(n,c){return this.min.copy(n),this.max.copy(c),this}setFromPoints(n){this.makeEmpty();for(let c=0,d=n.length;c<d;c++)this.expandByPoint(n[c]);return this}setFromCenterAndSize(n,c){const d=Ua.copy(c).multiplyScalar(.5);return this.min.copy(n).sub(d),this.max.copy(n).add(d),this}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(n){return this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y}getParameter(n,c){return c.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y)}clampPoint(n,c){return c.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,Ua).distanceTo(n)}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}const Ag=new Se,_p=new Se;class Wy{constructor(n=new Se,c=new Se){this.start=n,this.end=c}set(n,c){return this.start.copy(n),this.end.copy(c),this}copy(n){return this.start.copy(n.start),this.end.copy(n.end),this}getCenter(n){return n.addVectors(this.start,this.end).multiplyScalar(.5)}delta(n){return n.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(n,c){return this.delta(c).multiplyScalar(n).add(this.start)}closestPointToPointParameter(n,c){Ag.subVectors(n,this.start),_p.subVectors(this.end,this.start);const d=_p.dot(_p);let m=_p.dot(Ag)/d;return c&&(m=Kr(m,0,1)),m}closestPointToPoint(n,c,d){const m=this.closestPointToPointParameter(n,c);return this.delta(d).multiplyScalar(m).add(this.start)}applyMatrix4(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this}equals(n){return n.start.equals(this.start)&&n.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Xy=new Se;class yw extends Nr{constructor(n,c){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=c,this.type="SpotLightHelper";const d=new hr,m=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let w=0,C=1,P=32;w<P;w++,C++){const D=w/P*Math.PI*2,B=C/P*Math.PI*2;m.push(Math.cos(D),Math.sin(D),1,Math.cos(B),Math.sin(B),1)}d.setAttribute("position",new pe(m,3));const v=new wa({fog:!1,toneMapped:!1});this.cone=new vc(d,v),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const n=this.light.distance?this.light.distance:1e3,c=n*Math.tan(this.light.angle);this.cone.scale.set(c,c,n),Xy.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Xy),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ku=new Se,$f=new or,R0=new or;class CE extends vc{constructor(n){const c=qy(n),d=new hr,m=[],v=[],w=new xi(0,0,1),C=new xi(0,1,0);for(let P=0;P<c.length;P++){const D=c[P];D.parent&&D.parent.isBone&&(m.push(0,0,0),m.push(0,0,0),v.push(w.r,w.g,w.b),v.push(C.r,C.g,C.b))}d.setAttribute("position",new pe(m,3)),d.setAttribute("color",new pe(v,3)),super(d,new wa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=n,this.bones=c,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(n){const c=this.bones,d=this.geometry,m=d.getAttribute("position");R0.copy(this.root.matrixWorld).invert();for(let v=0,w=0;v<c.length;v++){const C=c[v];C.parent&&C.parent.isBone&&($f.multiplyMatrices(R0,C.matrixWorld),Ku.setFromMatrixPosition($f),m.setXYZ(w,Ku.x,Ku.y,Ku.z),$f.multiplyMatrices(R0,C.parent.matrixWorld),Ku.setFromMatrixPosition($f),m.setXYZ(w+1,Ku.x,Ku.y,Ku.z),w+=2)}d.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose()}}function qy(b){const n=[];b.isBone===!0&&n.push(b);for(let c=0;c<b.children.length;c++)n.push.apply(n,qy(b.children[c]));return n}class Yy extends Ut{constructor(n,c,d){super(new zh(c,4,2),new qc({wireframe:!0,fog:!1,toneMapped:!1})),this.light=n,this.color=d,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Dn=new Se,Qh=new xi,Mc=new xi;class Wh extends Nr{constructor(n,c,d){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,this.type="HemisphereLightHelper";const m=new Fh(c);m.rotateY(.5*Math.PI),this.material=new qc({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const v=m.getAttribute("position"),w=new Float32Array(3*v.count);m.setAttribute("color",new on(w,3)),this.add(new Ut(m,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const n=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const c=n.geometry.getAttribute("color");Qh.copy(this.light.color),Mc.copy(this.light.groundColor);for(let d=0,m=c.count;d<m;d++){const v=d<m/2?Qh:Mc;c.setXYZ(d,v.r,v.g,v.b)}c.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),n.lookAt(Dn.setFromMatrixPosition(this.light.matrixWorld).negate())}}class wg extends vc{constructor(n=10,c=10,d=4473924,m=8947848){d=new xi(d),m=new xi(m);const v=c/2,w=n/c,C=n/2,P=[],D=[];for(let j=0,F=0,z=-C;j<=c;j++,z+=w){P.push(-C,0,z,C,0,z),P.push(z,0,-C,z,0,C);const G=j===v?d:m;G.toArray(D,F),F+=3,G.toArray(D,F),F+=3,G.toArray(D,F),F+=3,G.toArray(D,F),F+=3}const B=new hr;B.setAttribute("position",new pe(P,3)),B.setAttribute("color",new pe(D,3)),super(B,new wa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ME extends vc{constructor(n=10,c=16,d=8,m=64,v=4473924,w=8947848){v=new xi(v),w=new xi(w);const C=[],P=[];if(c>1)for(let B=0;B<c;B++){const j=B/c*(2*Math.PI),F=Math.sin(j)*n,z=Math.cos(j)*n;C.push(0,0,0),C.push(F,0,z);const G=1&B?v:w;P.push(G.r,G.g,G.b),P.push(G.r,G.g,G.b)}for(let B=0;B<d;B++){const j=1&B?v:w,F=n-n/d*B;for(let z=0;z<m;z++){let G=z/m*(2*Math.PI),W=Math.sin(G)*F,Q=Math.cos(G)*F;C.push(W,0,Q),P.push(j.r,j.g,j.b),G=(z+1)/m*(2*Math.PI),W=Math.sin(G)*F,Q=Math.cos(G)*F,C.push(W,0,Q),P.push(j.r,j.g,j.b)}}const D=new hr;D.setAttribute("position",new pe(C,3)),D.setAttribute("color",new pe(P,3)),super(D,new wa({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const bw=new Se,D0=new Se,Aw=new Se;class Ky extends Nr{constructor(n,c,d){super(),this.light=n,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,this.type="DirectionalLightHelper",c===void 0&&(c=1);let m=new hr;m.setAttribute("position",new pe([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));const v=new wa({fog:!1,toneMapped:!1});this.lightPlane=new Uu(m,v),this.add(this.lightPlane),m=new hr,m.setAttribute("position",new pe([0,0,0,0,0,1],3)),this.targetLine=new Uu(m,v),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),bw.setFromMatrixPosition(this.light.matrixWorld),D0.setFromMatrixPosition(this.light.target.matrixWorld),Aw.subVectors(D0,bw),this.lightPlane.lookAt(D0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(D0),this.targetLine.scale.z=Aw.length()}}const Io=new Se,zn=new Dv;class Zy extends vc{constructor(n){const c=new hr,d=new wa({color:16777215,vertexColors:!0,toneMapped:!1}),m=[],v=[],w={};function C(G,W){P(G),P(W)}function P(G){m.push(0,0,0),v.push(0,0,0),w[G]===void 0&&(w[G]=[]),w[G].push(m.length/3-1)}C("n1","n2"),C("n2","n4"),C("n4","n3"),C("n3","n1"),C("f1","f2"),C("f2","f4"),C("f4","f3"),C("f3","f1"),C("n1","f1"),C("n2","f2"),C("n3","f3"),C("n4","f4"),C("p","n1"),C("p","n2"),C("p","n3"),C("p","n4"),C("u1","u2"),C("u2","u3"),C("u3","u1"),C("c","t"),C("p","c"),C("cn1","cn2"),C("cn3","cn4"),C("cf1","cf2"),C("cf3","cf4"),c.setAttribute("position",new pe(m,3)),c.setAttribute("color",new pe(v,3)),super(c,d),this.type="CameraHelper",this.camera=n,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=w,this.update();const D=new xi(16755200),B=new xi(16711680),j=new xi(43775),F=new xi(16777215),z=new xi(3355443);this.setColors(D,B,j,F,z)}setColors(n,c,d,m,v){const w=this.geometry.getAttribute("color");w.setXYZ(0,n.r,n.g,n.b),w.setXYZ(1,n.r,n.g,n.b),w.setXYZ(2,n.r,n.g,n.b),w.setXYZ(3,n.r,n.g,n.b),w.setXYZ(4,n.r,n.g,n.b),w.setXYZ(5,n.r,n.g,n.b),w.setXYZ(6,n.r,n.g,n.b),w.setXYZ(7,n.r,n.g,n.b),w.setXYZ(8,n.r,n.g,n.b),w.setXYZ(9,n.r,n.g,n.b),w.setXYZ(10,n.r,n.g,n.b),w.setXYZ(11,n.r,n.g,n.b),w.setXYZ(12,n.r,n.g,n.b),w.setXYZ(13,n.r,n.g,n.b),w.setXYZ(14,n.r,n.g,n.b),w.setXYZ(15,n.r,n.g,n.b),w.setXYZ(16,n.r,n.g,n.b),w.setXYZ(17,n.r,n.g,n.b),w.setXYZ(18,n.r,n.g,n.b),w.setXYZ(19,n.r,n.g,n.b),w.setXYZ(20,n.r,n.g,n.b),w.setXYZ(21,n.r,n.g,n.b),w.setXYZ(22,n.r,n.g,n.b),w.setXYZ(23,n.r,n.g,n.b),w.setXYZ(24,c.r,c.g,c.b),w.setXYZ(25,c.r,c.g,c.b),w.setXYZ(26,c.r,c.g,c.b),w.setXYZ(27,c.r,c.g,c.b),w.setXYZ(28,c.r,c.g,c.b),w.setXYZ(29,c.r,c.g,c.b),w.setXYZ(30,c.r,c.g,c.b),w.setXYZ(31,c.r,c.g,c.b),w.setXYZ(32,d.r,d.g,d.b),w.setXYZ(33,d.r,d.g,d.b),w.setXYZ(34,d.r,d.g,d.b),w.setXYZ(35,d.r,d.g,d.b),w.setXYZ(36,d.r,d.g,d.b),w.setXYZ(37,d.r,d.g,d.b),w.setXYZ(38,m.r,m.g,m.b),w.setXYZ(39,m.r,m.g,m.b),w.setXYZ(40,v.r,v.g,v.b),w.setXYZ(41,v.r,v.g,v.b),w.setXYZ(42,v.r,v.g,v.b),w.setXYZ(43,v.r,v.g,v.b),w.setXYZ(44,v.r,v.g,v.b),w.setXYZ(45,v.r,v.g,v.b),w.setXYZ(46,v.r,v.g,v.b),w.setXYZ(47,v.r,v.g,v.b),w.setXYZ(48,v.r,v.g,v.b),w.setXYZ(49,v.r,v.g,v.b),w.needsUpdate=!0}update(){const n=this.geometry,c=this.pointMap;zn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ss("c",c,n,zn,0,0,-1),ss("t",c,n,zn,0,0,1),ss("n1",c,n,zn,-1,-1,-1),ss("n2",c,n,zn,1,-1,-1),ss("n3",c,n,zn,-1,1,-1),ss("n4",c,n,zn,1,1,-1),ss("f1",c,n,zn,-1,-1,1),ss("f2",c,n,zn,1,-1,1),ss("f3",c,n,zn,-1,1,1),ss("f4",c,n,zn,1,1,1),ss("u1",c,n,zn,.7,1.1,-1),ss("u2",c,n,zn,-.7,1.1,-1),ss("u3",c,n,zn,0,2,-1),ss("cf1",c,n,zn,-1,0,1),ss("cf2",c,n,zn,1,0,1),ss("cf3",c,n,zn,0,-1,1),ss("cf4",c,n,zn,0,1,1),ss("cn1",c,n,zn,-1,0,-1),ss("cn2",c,n,zn,1,0,-1),ss("cn3",c,n,zn,0,-1,-1),ss("cn4",c,n,zn,0,1,-1),n.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ss(b,n,c,d,m,v,w){Io.set(m,v,w).unproject(d);const C=n[b];if(C!==void 0){const P=c.getAttribute("position");for(let D=0,B=C.length;D<B;D++)P.setXYZ(C[D],Io.x,Io.y,Io.z)}}const B0=new ia;class Zu extends vc{constructor(n,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new Float32Array(24),v=new hr;v.setIndex(new on(d,1)),v.setAttribute("position",new on(m,3)),super(v,new wa({color:c,toneMapped:!1})),this.object=n,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(n){if(n!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&B0.setFromObject(this.object),B0.isEmpty())return;const c=B0.min,d=B0.max,m=this.geometry.attributes.position,v=m.array;v[0]=d.x,v[1]=d.y,v[2]=d.z,v[3]=c.x,v[4]=d.y,v[5]=d.z,v[6]=c.x,v[7]=c.y,v[8]=d.z,v[9]=d.x,v[10]=c.y,v[11]=d.z,v[12]=d.x,v[13]=d.y,v[14]=c.z,v[15]=c.x,v[16]=d.y,v[17]=c.z,v[18]=c.x,v[19]=c.y,v[20]=c.z,v[21]=d.x,v[22]=c.y,v[23]=c.z,m.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(n){return this.object=n,this.update(),this}copy(n,c){return super.copy(n,c),this.object=n.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class xg extends vc{constructor(n,c=16776960){const d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new hr;m.setIndex(new on(d,1)),m.setAttribute("position",new pe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(m,new wa({color:c,toneMapped:!1})),this.box=n,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(n){const c=this.box;c.isEmpty()||(c.getCenter(this.position),c.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(n))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Jy extends Uu{constructor(n,c=1,d=16776960){const m=d,v=new hr;v.setAttribute("position",new pe([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),v.computeBoundingSphere(),super(v,new wa({color:m,toneMapped:!1})),this.type="PlaneHelper",this.plane=n,this.size=c;const w=new hr;w.setAttribute("position",new pe([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),w.computeBoundingSphere(),this.add(new Ut(w,new qc({color:m,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(n){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const O0=new Se;let Eg,yp;class L0 extends Nr{constructor(n=new Se(0,0,1),c=new Se(0,0,0),d=1,m=16776960,v=.2*d,w=.2*v){super(),this.type="ArrowHelper",Eg===void 0&&(Eg=new hr,Eg.setAttribute("position",new pe([0,0,0,0,1,0],3)),yp=new Uh(0,.5,1,5,1),yp.translate(0,-.5,0)),this.position.copy(c),this.line=new Uu(Eg,new wa({color:m,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ut(yp,new qc({color:m,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(d,v,w)}setDirection(n){if(n.y>.99999)this.quaternion.set(0,0,0,1);else if(n.y<-.99999)this.quaternion.set(1,0,0,0);else{O0.set(n.z,0,-n.x).normalize();const c=Math.acos(n.y);this.quaternion.setFromAxisAngle(O0,c)}}setLength(n,c=.2*n,d=.2*c){this.line.scale.set(1,Math.max(1e-4,n-c),1),this.line.updateMatrix(),this.cone.scale.set(d,c,d),this.cone.position.y=n,this.cone.updateMatrix()}setColor(n){this.line.material.color.set(n),this.cone.material.color.set(n)}copy(n){return super.copy(n,!1),this.line.copy(n.line),this.cone.copy(n.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class ww extends vc{constructor(n=1){const c=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],d=new hr;d.setAttribute("position",new pe(c,3)),d.setAttribute("color",new pe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(d,new wa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(n,c,d){const m=new xi,v=this.geometry.attributes.color.array;return m.set(n),m.toArray(v,0),m.toArray(v,3),m.set(c),m.toArray(v,6),m.toArray(v,9),m.set(d),m.toArray(v,12),m.toArray(v,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class TE{constructor(){this.type="ShapePath",this.color=new xi,this.subPaths=[],this.currentPath=null}moveTo(n,c){return this.currentPath=new Nu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(n,c),this}lineTo(n,c){return this.currentPath.lineTo(n,c),this}quadraticCurveTo(n,c,d,m){return this.currentPath.quadraticCurveTo(n,c,d,m),this}bezierCurveTo(n,c,d,m,v,w){return this.currentPath.bezierCurveTo(n,c,d,m,v,w),this}splineThru(n){return this.currentPath.splineThru(n),this}toShapes(n){function c(Q,$){const Y=$.length;let q=!1;for(let be=Y-1,we=0;we<Y;be=we++){let me=$[be],Be=$[we],Ze=Be.x-me.x,et=Be.y-me.y;if(Math.abs(et)>Number.EPSILON){if(et<0&&(me=$[we],Ze=-Ze,Be=$[be],et=-et),Q.y<me.y||Q.y>Be.y)continue;if(Q.y===me.y){if(Q.x===me.x)return!0}else{const ft=et*(Q.x-me.x)-Ze*(Q.y-me.y);if(ft===0)return!0;if(ft<0)continue;q=!q}}else{if(Q.y!==me.y)continue;if(Be.x<=Q.x&&Q.x<=me.x||me.x<=Q.x&&Q.x<=Be.x)return!0}}return q}const d=yc.isClockWise,m=this.subPaths;if(m.length===0)return[];let v,w,C;const P=[];if(m.length===1)return w=m[0],C=new fp,C.curves=w.curves,P.push(C),P;let D=!d(m[0].getPoints());D=n?!D:D;const B=[],j=[];let F,z,G=[],W=0;j[W]=void 0,G[W]=[];for(let Q=0,$=m.length;Q<$;Q++)w=m[Q],F=w.getPoints(),v=d(F),v=n?!v:v,v?(!D&&j[W]&&W++,j[W]={s:new fp,p:F},j[W].s.curves=w.curves,D&&W++,G[W]=[]):G[W].push({h:w,p:F[0]});if(!j[0])return function(Q){const $=[];for(let Y=0,q=Q.length;Y<q;Y++){const be=Q[Y],we=new fp;we.curves=be.curves,$.push(we)}return $}(m);if(j.length>1){let Q=!1,$=0;for(let Y=0,q=j.length;Y<q;Y++)B[Y]=[];for(let Y=0,q=j.length;Y<q;Y++){const be=G[Y];for(let we=0;we<be.length;we++){const me=be[we];let Be=!0;for(let Ze=0;Ze<j.length;Ze++)c(me.p,j[Ze].p)&&(Y!==Ze&&$++,Be?(Be=!1,B[Ze].push(me)):Q=!0);Be&&B[Y].push(me)}}$>0&&Q===!1&&(G=B)}for(let Q=0,$=j.length;Q<$;Q++){C=j[Q].s,P.push(C),z=G[Q];for(let Y=0,q=z.length;Y<q;Y++)C.holes.push(z[Y].h)}return P}}class $y extends eo{constructor(n,c,d,m,v,w){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(n,c,d,m,v,w)}}class IE extends Vf{constructor(n,c,d,m){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(n,c,d,m)}}class PE extends dp{constructor(n,c,d,m){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(n,c,d,m)}}class RE extends og{constructor(n,c,d,m,v,w,C){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(n,c,d,m,v,w,C)}}class DE extends Uh{constructor(n,c,d,m,v,w,C,P){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(n,c,d,m,v,w,C,P)}}class BE extends ru{constructor(n,c){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(n,c)}}class Sg extends Wf{constructor(n,c){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(n,c)}}class OE extends Gu{constructor(n,c){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(n,c)}}class xw extends Fu{constructor(n,c,d,m){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(n,c,d,m)}}class LE extends Fh{constructor(n,c){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(n,c)}}class kE extends Jc{constructor(n,c,d,m){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(n,c,d,m)}}class Pr extends _c{constructor(n,c,d,m){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(n,c,d,m)}}class as extends Hu{constructor(n,c,d,m,v,w){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(n,c,d,m,v,w)}}class ao extends jh{constructor(n,c){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(n,c)}}class UE extends zh{constructor(n,c,d,m,v,w,C){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(n,c,d,m,v,w,C)}}class NE extends hg{constructor(n,c){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(n,c)}}class FE extends dg{constructor(n,c,d,m,v){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(n,c,d,m,v)}}class jE extends pg{constructor(n,c,d,m,v,w){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(n,c,d,m,v,w)}}class zE extends Xf{constructor(n,c,d,m,v){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(n,c,d,m,v)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ke}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ke)},553:function(kt,V,p){p.d(V,{_:function(){return ut}});var Ke=p(988);const ct=new WeakMap;class ut extends Ke.aNw{constructor(it){super(it),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(it){return this.decoderPath=it,this}setDecoderConfig(it){return this.decoderConfig=it,this}setWorkerLimit(it){return this.workerLimit=it,this}load(it,dt,At,Mt){const pt=new Ke.hH6(this.manager);pt.setPath(this.path),pt.setResponseType("arraybuffer"),pt.setRequestHeader(this.requestHeader),pt.setWithCredentials(this.withCredentials),pt.load(it,Re=>{this.parse(Re,dt,Mt)},At,Mt)}parse(it,dt,At){this.decodeDracoFile(it,dt,null,null,Ke.KI_).catch(At)}decodeDracoFile(it,dt,At,Mt,pt=Ke.GUF){const Re={attributeIDs:At||this.defaultAttributeIDs,attributeTypes:Mt||this.defaultAttributeTypes,useUniqueIDs:!!At,vertexColorSpace:pt};return this.decodeGeometry(it,Re).then(dt)}decodeGeometry(it,dt){const At=JSON.stringify(dt);if(ct.has(it)){const Ce=ct.get(it);if(Ce.key===At)return Ce.promise;if(it.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let Mt;const pt=this.workerNextTaskID++,Re=it.byteLength,lt=this._getWorker(pt,Re).then(Ce=>(Mt=Ce,new Promise((vt,at)=>{Mt._callbacks[pt]={resolve:vt,reject:at},Mt.postMessage({type:"decode",id:pt,taskConfig:dt,buffer:it},[it])}))).then(Ce=>this._createGeometry(Ce.geometry));return lt.catch(()=>!0).then(()=>{Mt&&pt&&this._releaseTask(Mt,pt)}),ct.set(it,{key:At,promise:lt}),lt}_createGeometry(it){const dt=new Ke.u9r;it.index&&dt.setIndex(new Ke.TlE(it.index.array,1));for(let At=0;At<it.attributes.length;At++){const Mt=it.attributes[At],pt=Mt.name,Re=Mt.array,lt=Mt.itemSize,Ce=new Ke.TlE(Re,lt);pt==="color"&&(this._assignVertexColorSpace(Ce,Mt.vertexColorSpace),Ce.normalized=Re instanceof Float32Array==0),dt.setAttribute(pt,Ce)}return dt}_assignVertexColorSpace(it,dt){if(dt!==Ke.KI_)return;const At=new Ke.Ilk;for(let Mt=0,pt=it.count;Mt<pt;Mt++)At.fromBufferAttribute(it,Mt).convertSRGBToLinear(),it.setXYZ(Mt,At.r,At.g,At.b)}_loadLibrary(it,dt){const At=new Ke.hH6(this.manager);return At.setPath(this.decoderPath),At.setResponseType(dt),At.setWithCredentials(this.withCredentials),new Promise((Mt,pt)=>{At.load(it,Mt,void 0,pt)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const it=typeof WebAssembly!="object"||this.decoderConfig.type==="js",dt=[];return it?dt.push(this._loadLibrary("draco_decoder.js","text")):(dt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),dt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(dt).then(At=>{const Mt=At[0];it||(this.decoderConfig.wasmBinary=At[1]);const pt=tt,Re=["/* draco decoder */",Mt,"","/* worker */",pt.substring(pt.indexOf("{")+1,pt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([Re]))}),this.decoderPending}_getWorker(it,dt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const Mt=new Worker(this.workerSourceURL);Mt._callbacks={},Mt._taskCosts={},Mt._taskLoad=0,Mt.postMessage({type:"init",decoderConfig:this.decoderConfig}),Mt.onmessage=function(pt){const Re=pt.data;switch(Re.type){case"decode":Mt._callbacks[Re.id].resolve(Re);break;case"error":Mt._callbacks[Re.id].reject(Re);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+Re.type+'"')}},this.workerPool.push(Mt)}else this.workerPool.sort(function(Mt,pt){return Mt._taskLoad>pt._taskLoad?-1:1});const At=this.workerPool[this.workerPool.length-1];return At._taskCosts[it]=dt,At._taskLoad+=dt,At})}_releaseTask(it,dt){it._taskLoad-=it._taskCosts[dt],delete it._callbacks[dt],delete it._taskCosts[dt]}debug(){console.log("Task load: ",this.workerPool.map(it=>it._taskLoad))}dispose(){for(let it=0;it<this.workerPool.length;++it)this.workerPool[it].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const tt=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(kt){var V=__webpackgi_module_cache__[kt];if(V!==void 0)return V.exports;var p=__webpackgi_module_cache__[kt]={id:kt,exports:{}};return __webpackgi_modules__[kt].call(p.exports,p,p.exports,__webpackgi_require__),p.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(kt){var V=kt&&kt.__esModule?function(){return kt.default}:function(){return kt};return __webpackgi_require__.d(V,{a:V}),V},getProto=Object.getPrototypeOf?function(kt){return Object.getPrototypeOf(kt)}:function(kt){return kt.__proto__},__webpackgi_require__.t=function(kt,V){if(1&V&&(kt=this(kt)),8&V||typeof kt=="object"&&kt&&(4&V&&kt.__esModule||16&V&&typeof kt.then=="function"))return kt;var p=Object.create(null);__webpackgi_require__.r(p);var Ke={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var ct=2&V&&kt;typeof ct=="object"&&!~leafPrototypes.indexOf(ct);ct=getProto(ct))Object.getOwnPropertyNames(ct).forEach(function(ut){Ke[ut]=function(){return kt[ut]}});return Ke.default=function(){return kt},__webpackgi_require__.d(p,Ke),p},__webpackgi_require__.d=function(kt,V){for(var p in V)__webpackgi_require__.o(V,p)&&!__webpackgi_require__.o(kt,p)&&Object.defineProperty(kt,p,{enumerable:!0,get:V[p]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(kt){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(V,p){return __webpackgi_require__.f[p](kt,V),V},[]))},__webpackgi_require__.u=function(kt){return kt+".mjs"},__webpackgi_require__.o=function(kt,V){return Object.prototype.hasOwnProperty.call(kt,V)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(kt,V,p,Ke){if(inProgress[kt])inProgress[kt].push(V);else{var ct,ut;if(p!==void 0)for(var tt=document.getElementsByTagName("script"),_t=0;_t<tt.length;_t++){var it=tt[_t];if(it.getAttribute("src")==kt||it.getAttribute("data-webpack")==dataWebpackPrefix+p){ct=it;break}}ct||(ut=!0,(ct=document.createElement("script")).type="module",ct.charset="utf-8",ct.timeout=120,__webpackgi_require__.nc&&ct.setAttribute("nonce",__webpackgi_require__.nc),ct.setAttribute("data-webpack",dataWebpackPrefix+p),ct.src=kt),inProgress[kt]=[V];var dt=function(Mt,pt){ct.onerror=ct.onload=null,clearTimeout(At);var Re=inProgress[kt];if(delete inProgress[kt],ct.parentNode&&ct.parentNode.removeChild(ct),Re&&Re.forEach(function(lt){return lt(pt)}),Mt)return Mt(pt)},At=setTimeout(dt.bind(null,void 0,{type:"timeout",target:ct}),12e4);ct.onerror=dt.bind(null,ct.onerror),ct.onload=dt.bind(null,ct.onload),ut&&document.head.appendChild(ct)}},__webpackgi_require__.r=function(kt){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(kt,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(kt,"__esModule",{value:!0})},function(){var kt;if(typeof import.meta.url=="string"&&(kt=import.meta.url),!kt)throw new Error("Automatic publicPath is not supported in this browser");kt=kt.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=kt+"../../"}(),function(){var kt={698:0};__webpackgi_require__.f.j=function(Ke,ct){var ut=__webpackgi_require__.o(kt,Ke)?kt[Ke]:void 0;if(ut!==0)if(ut)ct.push(ut[2]);else{var tt=new Promise(function(dt,At){ut=kt[Ke]=[dt,At]});ct.push(ut[2]=tt);var _t=__webpackgi_require__.p+__webpackgi_require__.u(Ke),it=new Error;__webpackgi_require__.l(_t,function(dt){if(__webpackgi_require__.o(kt,Ke)&&((ut=kt[Ke])!==0&&(kt[Ke]=void 0),ut)){var At=dt&&(dt.type==="load"?"missing":dt.type),Mt=dt&&dt.target&&dt.target.src;it.message="Loading chunk "+Ke+` failed.
(`+At+": "+Mt+")",it.name="ChunkLoadError",it.type=At,it.request=Mt,ut[1](it)}},"chunk-"+Ke,Ke)}};var V=function(Ke,ct){var ut,tt,_t=ct[0],it=ct[1],dt=ct[2],At=0;if(_t.some(function(Mt){return kt[Mt]!==0})){for(ut in it)__webpackgi_require__.o(it,ut)&&(__webpackgi_require__.m[ut]=it[ut]);dt&&dt(__webpackgi_require__)}for(Ke&&Ke(ct);At<_t.length;At++)tt=_t[At],__webpackgi_require__.o(kt,tt)&&kt[tt]&&kt[tt][0](),kt[tt]=0},p=self.webpackChunkwebgi=self.webpackChunkwebgi||[];p.forEach(V.bind(null,0)),p.push=V.bind(null,p.push.bind(p))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var kt;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return Lh},LY2:function(){return p.LY2},GYo:function(){return Gb},GPz:function(){return kx},HRj:function(){return xl},li4:function(){return $T},FO5:function(){return Rp},Nlh:function(){return e2},Mp4:function(){return kc},QvI:function(){return Si},PrA:function(){return gl},JHp:function(){return Lv},bGH:function(){return p.bGH},NDo:function(){return p.NDo},gSk:function(){return p.gSk},WMw:function(){return p.WMw},OTo:function(){return p.OTo},T6w:function(){return p.T6w},Se2:function(){return p.Se2},cum:function(){return p.cum},Mig:function(){return p.Mig},B$7:function(){return ic},i_9:function(){return p.i_9},bBp:function(){return p.bBp},m7l:function(){return p.m7l},sYA:function(){return p.sYA},Xcj:function(){return p.Xcj},mzJ:function(){return p.mzJ},ZZA:function(){return p.ZZA},$Ph:function(){return xo},T__:function(){return p.T__},HkE:function(){return p.HkE},tGC:function(){return p.tGC},g1S:function(){return CM},I$C:function(){return td},QIH:function(){return z_},_JE:function(){return zw},SwW:function(){return W0},ksm:function(){return Ut},jl_:function(){return Gs},b7R:function(){return on},BDV:function(){return Ba},Ea_:function(){return Eh},qff:function(){return Gs},tmC:function(){return wh},BON:function(){return Mv},P40:function(){return Sh},wLL:function(){return Mu},iHO:function(){return qc},BbS:function(){return p.BbS},kqm:function(){return p.kqm},Hmr:function(){return p.Hmr},SJI:function(){return p.SJI},mTL:function(){return p.mTL},y8_:function(){return p.y8_},_Li:function(){return p._Li},w7U:function(){return yA},g56:function(){return Do},bj3:function(){return ch},z81:function(){return p.z81},_MY:function(){return p._MY},L7J:function(){return TC},yEv:function(){return MP},dFZ:function(){return Aa},N$j:function(){return p.N$j},_YM:function(){return p._YM},TUj:function(){return p.TUj},ZzF:function(){return p.ZzF},qzb:function(){return Re},GQ:function(){return p.GQ},nvb:function(){return p.nvb},DvJ:function(){return p.DvJ},fQA:function(){return p.fQA},cPz:function(){return K_},TlE:function(){return p.TlE},u9r:function(){return p.u9r},s4_:function(){return p.s4_},T95:function(){return p.T95},F5w:function(){return Rb},NlP:function(){return Vb},$8Z:function(){return Dp},YYN:function(){return od},CtF:function(){return p.CtF},V1s:function(){return p.V1s},jOv:function(){return Cs},Rki:function(){return p.Rki},pzV:function(){return oA},itZ:function(){return yn},MMq:function(){return gd},qKx:function(){return Ir},Hmi:function(){return Ad},X4S:function(){return Tb},vlJ:function(){return k1},nPO:function(){return zl},zcQ:function(){return i0},GH1:function(){return Ol},ROQ:function(){return p.ROQ},YN5:function(){return p.YN5},BVQ:function(){return p.BVQ},YT8:function(){return p.YT8},_DE:function(){return Om},YGz:function(){return p.YGz},trn:function(){return p.trn},zf8:function(){return p.zf8},uWy:function(){return p.uWy},wYQ:function(){return nl},SUY:function(){return p.SUY},Ilk:function(){return p.Ilk},R2R:function(){return p.R2R},epp:function(){return p.epp},xmJ:function(){return vn},GD$:function(){return bf},Z_g:function(){return p.Z_g},EB7:function(){return p.EB7},DqL:function(){return p.DqL},_3:function(){return p._3},b_z:function(){return p.b_z},OCn:function(){return Dc},N_j:function(){return lk},hNv:function(){return aM},_am:function(){return p._am},kB7:function(){return Df},fY$:function(){return p.fY$},vxC:function(){return p.vxC},BtG:function(){return p.BtG},cBK:function(){return p.cBK},g8_:function(){return p.g8_},AXT:function(){return p.AXT},yj7:function(){return p.yj7},dYG:function(){return p.dYG},tm_:function(){return p.tm_},S2y:function(){return p.S2y},B02:function(){return p.B02},PeU:function(){return p.PeU},Hyl:function(){return p.Hyl},Wqd:function(){return p.Wqd},c0Q:function(){return W2},re0:function(){return X2},Xaj:function(){return p.Xaj},DUb:function(){return Oa},dZ3:function(){return p.dZ3},m_w:function(){return p.m_w},fHI:function(){return p.fHI},LBq:function(){return p.LBq},Qww:function(){return Em.Q},CGV:function(){return V.Damper},JUT:function(){return p.JUT},p3g:function(){return p.p3g},IEO:function(){return p.IEO},yxD:function(){return p.yxD},CUS:function(){return fM},A5E:function(){return p.A5E},zqG:function(){return Cc},PfX:function(){return xe},Q1o:function(){return Gd},jfJ:function(){return p.jfJ},T_J:function(){return p.T_J},tEQ:function(){return p.tEQ},gb4:function(){return ba},qkB:function(){return p.qkB},cvk:function(){return Ko},HWo:function(){return Ih},brP:function(){return p.brP},$YQ:function(){return p.$YQ},X8d:function(){return Hb},Zdt:function(){return aC},yNB:function(){return yr},h7x:function(){return Xr},Ox3:function(){return p.Ox3},qtn:function(){return Ud},cBI:function(){return p.cBI},cU9:function(){return p.cU9},ntt:function(){return p.ntt},DT1:function(){return p.DT1},Kgo:function(){return p.Kgo},ehD:function(){return p.ehD},fhJ:function(){return Dm},y1s:function(){return eo},fSK:function(){return p.fSK},Vdb:function(){return p.Vdb},l8J:function(){return p.l8J},dj0:function(){return p.dj0},QM0:function(){return p.QM0},n94:function(){return Kw},OIS:function(){return QE},q8b:function(){return el},TOt:function(){return p.TOt},xaN:function(){return pt},Ny0:function(){return p.Ny0},NeD:function(){return kS},Zof:function(){return pe},N1Y:function(){return fb},itK:function(){return bA},F1y:function(){return p.F1y},eD:function(){return p.eD},jwo:function(){return p.jwo},dSO:function(){return p.dSO},Bf4:function(){return p.Bf4},USm:function(){return p.USm},pBf:function(){return p.pBf},eBg:function(){return HC},$Vf:function(){return p.$Vf},O7d:function(){return p.O7d},ksq:function(){return G},hFL:function(){return s_},gXf:function(){return HE},hH6:function(){return p.hH6},izP:function(){return Qb},kpi:function(){return $c},DwZ:function(){return Ea},kN3:function(){return cC},e62:function(){return p.e62},a$l:function(){return p.a$l},OM3:function(){return p.OM3},VzW:function(){return p.VzW},ybr:function(){return p.ybr},yo9:function(){return p.yo9},Dzq:function(){return Eo},zCA:function(){return ws},$Bt:function(){return Dl},Wzm:function(){return p.Wzm},Wl3:function(){return p.Wl3},iWj:function(){return p.iWj},DNz:function(){return Mo},m1M:function(){return vr},ylh:function(){return p.ylh},v9Y:function(){return p.v9Y},LSk:function(){return p.LSk},LHE:function(){return tn},KE0:function(){return TS},KCF:function(){return QT},a4n:function(){return hS},NKC:function(){return ky},jrv:function(){return xc},zIH:function(){return ts},Hfk:function(){return Ml},png:function(){return mh},tAj:function(){return Ld},Eb_:function(){return tc},SJj:function(){return Ly},cF0:function(){return pn},BT2:function(){return Q0},_8p:function(){return xM},V5Z:function(){return Uy},s5b:function(){return x0},BHZ:function(){return Um},hkn:function(){return fu},GFY:function(){return qa},hZr:function(){return Yb},Zen:function(){return p.Zen},w$m:function(){return p.w$m},Jjb:function(){return p.Jjb},ksN:function(){return p.ksN},j4z:function(){return p.j4z},OAl:function(){return p.OAl},VLJ:function(){return p.VLJ},C73:function(){return Ul},ZAu:function(){return p.ZAu},ibP:function(){return kn},lth:function(){return mg},_fI:function(){return bf},hUN:function(){return pc},cLu:function(){return p.cLu},vmT:function(){return p.vmT},Qpg:function(){return p.Qpg},So8:function(){return p.So8},eOv:function(){return nA},Wjw:function(){return p.Wjw},cJO:function(){return p.cJO},QRU:function(){return p.QRU},S3k:function(){return p.S3k},OPJ:function(){return t2},PpQ:function(){return p.PpQ},q_9:function(){return Tn},ZRs:function(){return p.ZRs},oqc:function(){return p.oqc},T_x:function(){return Ms},lb7:function(){return p.lb7},L5s:function(){return p.L5s},$TI:function(){return p.$TI},SPe:function(){return p.SPe},aVm:function(){return p.aVm},j87:function(){return p.j87},RNb:function(){return p.RNb},Kz5:function(){return p.Kz5},LYt:function(){return us},vpT:function(){return p.vpT},kB5:function(){return p.kB5},_C8:function(){return p._C8},Syv:function(){return p.Syv},NMF:function(){return p.NMF},pIN:function(){return p.pIN},eMJ:function(){return p.eMJ},rN7:function(){return I0},iUp:function(){return Hh},GFd:function(){return nS},x5V:function(){return p.x5V},tUh:function(){return p.tUh},z8B:function(){return p.z8B},vcl:function(){return xn},GZb:function(){return p.GZb},p7y:function(){return p.p7y},e6l:function(){return Ll},S9g:function(){return p.S9g},D67:function(){return p.D67},Zr5:function(){return p.Zr5},M$G:function(){return p.M$G},vCF:function(){return p.vCF},yt0:function(){return p.yt0},uXU:function(){return p.uXU},_kC:function(){return p._kC},lk7:function(){return p.lk7},USc:function(){return sA},x12:function(){return p.x12},w_R:function(){return rS},Zzh:function(){return p.Zzh},nls:function(){return p.nls},g_z:function(){return p.g_z},U7:function(){return p.U7},FT0:function(){return p.FT0},L1_:function(){return hb},blk:function(){return p.blk},YRm:function(){return Bu},ejS:function(){return p.ejS},wUb:function(){return Xw},zOz:function(){return $d},rnI:function(){return p.rnI},wem:function(){return p.wem},lfu:function(){return p.lfu},FDw:function(){return p.FDw},lRj:function(){return p.lRj},D1R:function(){return p.D1R},qyh:function(){return p.qyh},GUF:function(){return p.GUF},EoG:function(){return p.EoG},aNw:function(){return p.aNw},Zp0:function(){return p.Zp0},lLk:function(){return p.lLk},NHT:function(){return Zr},jAl:function(){return p.jAl},uEv:function(){return p.uEv},YKA:function(){return p.YKA},cRx:function(){return p.cRx},Y8D:function(){return p.Y8D},RsA:function(){return p.RsA},Y0m:function(){return dw},F5T:function(){return p.F5T},EDU:function(){return Y},z$Q:function(){return Mp},KA8:function(){return es},ZqF:function(){return W_},XUj:function(){return Lw},Me$:function(){return Kh},u7G:function(){return p.u7G},PEk:function(){return gs},BG4:function(){return $},M8C:function(){return p.M8C},Vkp:function(){return p.Vkp},yGw:function(){return p.yGw},Sm8:function(){return p.Sm8},Kj0:function(){return p.Kj0},vBJ:function(){return p.vBJ},QfV:function(){return wl},lRF:function(){return p.lRF},Lun:function(){return p.Lun},YBo:function(){return p.YBo},kaV:function(){return p.kaV},RSm:function(){return p.RSm},NDk:function(){return md},xoR:function(){return p.xoR},EJi:function(){return p.EJi},Wid:function(){return p.Wid},iuj:function(){return js},IKL:function(){return p.IKL},r_:function(){return p.r_},OoA:function(){return p.OoA},qhX:function(){return p.qhX},CRe:function(){return Dy},qPT:function(){return Jc},M5h:function(){return p.M5h},Ns1:function(){return p.Ns1},TyD:function(){return p.TyD},vZf:function(){return p.vZf},HTd:function(){return p.HTd},aH4:function(){return p.aH4},YLQ:function(){return p.YLQ},xoQ:function(){return p.xoQ},BVF:function(){return p.BVF},MyG:function(){return p.MyG},jFi:function(){return p.jFi},aCh:function(){return p.aCh},uL9:function(){return p.uL9},TNj:function(){return rl},IFH:function(){return p.IFH},bdR:function(){return p.bdR},RPs:function(){return Rh},kM_:function(){return Wm},O78:function(){return p.O78},M6v:function(){return p.M6v},RvT:function(){return p.RvT},dUE:function(){return p.dUE},oe_:function(){return Qy},BuN:function(){return yg},Tme:function(){return p.Tme},N9P:function(){return Ca},tfP:function(){return pv},Gql:function(){return p.Gql},$XY:function(){return Cl},O9d:function(){return Rn},zEO:function(){return Ya},qfx:function(){return ih},PA7:function(){return p.PA7},REq:function(){return p.REq},pQR:function(){return p.pQR},ghN:function(){return p.ghN},Hy8:function(){return p.Hy8},Wpd:function(){return p.Wpd},LgZ:function(){return p.LgZ},iWC:function(){return p.iWC},mqn:function(){return kL},SKe:function(){return gr},iKG:function(){return p.iKG},rCq:function(){return Mb},_iA:function(){return p._iA},ntZ:function(){return p.ntZ},anP:function(){return p.anP},X2e:function(){return qT},oxT:function(){return Co},FCo:function(){return lu},y$t:function(){return p.y$t},cPb:function(){return p.cPb},lmx:function(){return fr},JOQ:function(){return p.JOQ},BKK:function(){return p.BKK},_12:function(){return p._12},tJx:function(){return p.tJx},mjX:function(){return Cf},cek:function(){return p.cek},qD0:function(){return ta},xG9:function(){return p.xG9},eqi:function(){return V.PointerDragHelper},wI8:function(){return Np},Sgv:function(){return uC},woe:function(){return p.woe},UY4:function(){return p.UY4},aq0:function(){return p.aq0},ujx:function(){return p.ujx},Uol:function(){return p.Uol},JiH:function(){return om},VYz:function(){return p.VYz},B2H:function(){return Sf},_Pm:function(){return Du},EsW:function(){return As},iUV:function(){return p.iUV},tf:function(){return p.tf},ZQ6:function(){return p.ZQ6},mXe:function(){return p.mXe},_fP:function(){return p._fP},iLg:function(){return p.iLg},zbs:function(){return p.zbs},ZTh:function(){return p.ZTh},HdW:function(){return p.HdW},UZH:function(){return p.UZH},mSO:function(){return p.mSO},wk1:function(){return p.wk1},E2K:function(){return p.E2K},FUD:function(){return p.FUD},pKu:function(){return p.pKu},GG6:function(){return p.GG6},Gih:function(){return p.Gih},iiP:function(){return p.iiP},SvJ:function(){return p.SvJ},ptH:function(){return p.ptH},jZA:function(){return p.jZA},y2t:function(){return p.y2t},gi4:function(){return p.gi4},Djp:function(){return p.Djp},BG$:function(){return p.BG$},NYV:function(){return p.NYV},xJs:function(){return p.xJs},bsb:function(){return p.bsb},ekQ:function(){return p.ekQ},CaW:function(){return p.CaW},eaV:function(){return p.eaV},BFQ:function(){return p.BFQ},v3W:function(){return p.v3W},ILR:function(){return p.ILR},G_r:function(){return p.G_r},N3F:function(){return gt},fto:function(){return p.fto},l0P:function(){return p.l0P},vCx:function(){return p.vCx},_AM:function(){return p._AM},wuA:function(){return p.wuA},av9:function(){return p.av9},CtA:function(){return p.CtA},fpq:function(){return uu},BvQ:function(){return Hm},FZJ:function(){return Dh},FIo:function(){return p.FIo},zHn:function(){return p.zHn},iMs:function(){return p.iMs},T_f:function(){return p.T_f},hEm:function(){return p.hEm},D9w:function(){return p.D9w},sHH:function(){return Pg},CdI:function(){return p.CdI},rkc:function(){return Bc},rpg:function(){return p.rpg},ce8:function(){return p.ce8},rOj:function(){return p.rOj},P6m:function(){return eh},JA6:function(){return aa},V4E:function(){return p.V4E},o8S:function(){return p.o8S},flB:function(){return Xn},lGU:function(){return p.lGU},vuL:function(){return p.vuL},KI_:function(){return p.KI_},iLN:function(){return km},X6w:function(){return w0},rz_:function(){return Ec},jsw:function(){return ro},srG:function(){return Pf},i6Z:function(){return rp},vfv:function(){return XE},xsS:function(){return p.xsS},or:function(){return aA},EQj:function(){return Ds},Rnn:function(){return _C},TyN:function(){return fm},ov0:function(){return Y_},WdD:function(){return p.WdD},Vj0:function(){return p.Vj0},jyz:function(){return p.jyz},mTM:function(){return Yl},Mn1:function(){return rf},Hlq:function(){return On},Fi7:function(){return Ro},Tn7:function(){return p.Tn7},bnF:function(){return p.bnF},HW6:function(){return p.HW6},oa8:function(){return p.oa8},T_1:function(){return p.T_1},zHJ:function(){return Vl},iDF:function(){return p.iDF},iAb:function(){return p.iAb},d4E:function(){return Zh},lBg:function(){return iA},JeJ:function(){return EP},FKY:function(){return V.SimpleEventDispatcher},zlZ:function(){return mM},vkg:function(){return Yi},brh:function(){return gM},kZK:function(){return Gl},puG:function(){return rA},VJK:function(){return A_},OdW:function(){return p.OdW},_YX:function(){return p._YX},TUv:function(){return p.TUv},Hw6:function(){return p.Hw6},aLr:function(){return p.aLr},Aip:function(){return p.Aip},xo$:function(){return p.xo$},bIn:function(){return UL},$V:function(){return p.$V},lDi:function(){return p.lDi},gti:function(){return p.gti},PMe:function(){return p.PMe},iwP:function(){return mf},FvO:function(){return p.FvO},jyi:function(){return p.jyi},xeV:function(){return p.xeV},k74:function(){return p.k74},RlZ:function(){return p.RlZ},KhW:function(){return p.KhW},HgB:function(){return p.HgB},W2J:function(){return p.W2J},JWc:function(){return p.JWc},u37:function(){return p.u37},Z6B:function(){return p.Z6B},QZ1:function(){return p.QZ1},Ir4:function(){return p.Ir4},NwF:function(){return p.NwF},Wbm:function(){return p.Wbm},N4l:function(){return p.N4l},Jxm:function(){return GE},ej9:function(){return Tp},QmN:function(){return p.QmN},Y4W:function(){return V.TYPED_ARRAYS},IOt:function(){return p.IOt},NOD:function(){return Zf},L5g:function(){return p.L5g},H$k:function(){return p.H$k},cuP:function(){return la},xEZ:function(){return p.xEZ},dpR:function(){return p.dpR},wOD:function(){return Zo},KNb:function(){return Rm},IiN:function(){return hc},Cne:function(){return p.Cne},XvJ:function(){return p.XvJ},XZw:function(){return p.XZw},FE5:function(){return p.FE5},lUF:function(){return fC},Mck:function(){return Fp},lVp:function(){return RA},Lpo:function(){return jp},CJI:function(){return p.CJI},z$h:function(){return p.z$h},UlW:function(){return p.UlW},WwZ:function(){return p.WwZ},zG7:function(){return To},Lcc:function(){return p.Lcc},WXh:function(){return p.WXh},Vjr:function(){return OS},LuM:function(){return P_},LP5:function(){return QI},ub3:function(){return p.ub3},OV:function(){return fl},G_n:function(){return Ql},xfE:function(){return p.xfE},qlB:function(){return p.qlB},lCJ:function(){return p.lCJ},WTc:function(){return p.WTc},rAo:function(){return p.rAo},LZj:function(){return gA},xWb:function(){return p.xWb},gH0:function(){return p.gH0},rBU:function(){return p.rBU},rDY:function(){return p.rDY},ywz:function(){return p.ywz},wJv:function(){return p.wJv},JQ4:function(){return p.JQ4},k0A:function(){return p.k0A},irR:function(){return p.irR},LsT:function(){return p.LsT},q5h:function(){return Tv},TKh:function(){return j_},tyg:function(){return Tu},Ro5:function(){return Is},Saj:function(){return AA},CHp:function(){return sm},dwk:function(){return p.dwk},t0w:function(){return qb},M7$:function(){return E_},ML4:function(){return Xb},FM8:function(){return p.FM8},Pa4:function(){return p.Pa4},Ltg:function(){return p.Ltg},yC1:function(){return p.yC1},lHq:function(){return tl},fO1:function(){return p.fO1},oMA:function(){return to},JzW:function(){return kt},QEt:function(){return Kf},IFZ:function(){return mm},b5g:function(){return p.b5g},Ywn:function(){return p.Ywn},GVz:function(){return p.GVz},_RZ:function(){return p._RZ},oAp:function(){return p.oAp},kFz:function(){return p.kFz},dd2:function(){return p.dd2},CP7:function(){return p.CP7},fQK:function(){return p.fQK},JCZ:function(){return p.JCZ},Wd$:function(){return lM},t1_:function(){return zC},v27:function(){return q_},Uk6:function(){return p.Uk6},H7Z:function(){return X_},_sL:function(){return p._sL},czO:function(){return cu},Pnf:function(){return p.Pnf},c8b:function(){return p.c8b},_lf:function(){return p._lf},ad5:function(){return p.ad5},sZV:function(){return xf},TfA:function(){return lc},sKX:function(){return Pv},UdM:function(){return Yc},P0y:function(){return Ts},L_r:function(){return p.L_r},zC5:function(){return V.absMax},Bve:function(){return Nw},b5G:function(){return H_},UeO:function(){return ff},qCx:function(){return dP},$nx:function(){return dS},Bk6:function(){return pf},EER:function(){return Ry},y4l:function(){return Nc},P39:function(){return vg},HI1:function(){return V.aesGcmDecrypt},ZYi:function(){return V.aesGcmEncrypt},wXW:function(){return os},r5x:function(){return Jr},MSI:function(){return ln},EUu:function(){return HL},jtH:function(){return qf},T0T:function(){return mp},gAb:function(){return $C},je_:function(){return ZI},wBP:function(){return g0},LU2:function(){return fy},wQL:function(){return QL},Zs7:function(){return su},sMc:function(){return V.arrayBufferToBase64},x7s:function(){return wr},Mnd:function(){return XL},A0_:function(){return qL},d73:function(){return ye},HCD:function(){return ti},YQ8:function(){return xd},RG9:function(){return mi},G2P:function(){return up},XLf:function(){return py},CGN:function(){return rg},RGi:function(){return V.base64ToArrayBuffer},mvg:function(){return ke},Hiy:function(){return Td},XMc:function(){return nr},N7M:function(){return tr},iv:function(){return Zi},n55:function(){return V.blobToDataURL},IaC:function(){return Ge},h9t:function(){return VA},yDW:function(){return l0},gJv:function(){return ng},l$g:function(){return s2},vQi:function(){return z2},$MY:function(){return Md},wJl:function(){return Al},Z7Y:function(){return ig},X7D:function(){return o0},BnX:function(){return a0},uZ5:function(){return kh},zVI:function(){return Et},Wz1:function(){return V.colorToDataUrl},DpF:function(){return Ov},nNb:function(){return Im},cqZ:function(){return Vd},pKN:function(){return Ix},CN8:function(){return Bh},DdI:function(){return IS},rrX:function(){return Px},uqj:function(){return vt},Z9P:function(){return Ne},KlC:function(){return dy},KVn:function(){return He},oau:function(){return N0},aw9:function(){return zr},Aap:function(){return ms},Dxg:function(){return V.copyProps},MjT:function(){return Qn},F7Q:function(){return Uu},IFq:function(){return iM},IJl:function(){return kf},O5A:function(){return V.createCanvasElement},wCn:function(){return V.createDiv},gGT:function(){return r0},hqj:function(){return XT},pEc:function(){return ZT},Bi6:function(){return V.createImage},fi_:function(){return ls},TT:function(){return Dt},q2Z:function(){return RL},NyK:function(){return vl},bgu:function(){return V.createScriptFromURL},kcS:function(){return V.createStyles},rRN:function(){return FS},ivY:function(){return V.css},_s1:function(){return sk},_HO:function(){return Ie},tpL:function(){return We},DMK:function(){return m0},LjN:function(){return Cv},iFs:function(){return F_},qTg:function(){return V.deepAccessObject},J4G:function(){return Ct},Zj8:function(){return VL},Wtl:function(){return Tm},DmK:function(){return Cu},Htt:function(){return nP},Nv0:function(){return Ue},tCp:function(){return $e},Hx7:function(){return br},imt:function(){return ps},US6:function(){return ii},vZs:function(){return qv},TE$:function(){return YL},lmu:function(){return V.downloadBlob},SvO:function(){return V.downloadFile},YQY:function(){return tg},mZN:function(){return s0},VvG:function(){return vc},omp:function(){return V.embedUrlRefs},utz:function(){return rt},TFV:function(){return Bm},hrz:function(){return V.escapeRegExp},H$s:function(){return Z},JKM:function(){return Ap},jZf:function(){return JC},RjL:function(){return I1},RRI:function(){return Ei},RUq:function(){return n2},_t4:function(){return Qa},YHh:function(){return Wa},R8g:function(){return It},f1L:function(){return V.getFileHandle},Bbl:function(){return V.getFilenameFromPath},V9r:function(){return V.getKeyByValue},a95:function(){return V.getNewFileHandle},PZ2:function(){return V.getOrCall},w7A:function(){return V.getPropertyDescriptor},N6S:function(){return ot},Uxp:function(){return Bt},tAz:function(){return jt},R$F:function(){return Qt},N33:function(){return Rt},JFD:function(){return xt},gw2:function(){return Rv},rfc:function(){return V.getTypedArray},wo6:function(){return V.getUrlQueryParam},V4T:function(){return Kr},H4P:function(){return V.glsl},NLp:function(){return A0},swA:function(){return Af},_Z3:function(){return xi},ivc:function(){return Im},rZ1:function(){return Vd},CpZ:function(){return mr},dyc:function(){return V.html},MxZ:function(){return V.htmlToCanvas},btp:function(){return V.htmlToPng},mXy:function(){return V.htmlToSvg},Ej0:function(){return yl},ep4:function(){return Lr},DQP:function(){return $p},VNr:function(){return Vr},V7q:function(){return V.imageBitmapToBase64},hiB:function(){return V.imageDataToCanvas},zEk:function(){return V.imageToCanvas},qfq:function(){return V.imageUrlToImageData},piB:function(){return V.includesAll},IIc:function(){return GL},rrF:function(){return xh},naq:function(){return bs},zlD:function(){return Ft},sXR:function(){return f0},p5I:function(){return Iy},wps:function(){return U1},wuo:function(){return rM},GpE:function(){return V.isPropertyWritable},F4b:function(){return Vu},NN$:function(){return vp},t$v:function(){return Oe},tdn:function(){return Yf},Y9t:function(){return Py},GEo:function(){return n0},GGm:function(){return V.longestCommonPrefix},DH3:function(){return qr},uxM:function(){return V.makeColorSvg},zH3:function(){return V.makeColorSvgCircle},MLs:function(){return Zl},xXG:function(){return Oi},YM4:function(){return Ty},iAx:function(){return V.makeTextSvg},lDn:function(){return oe},P1O:function(){return Fe},iib:function(){return _e},qf5:function(){return he},n4s:function(){return at},fr:function(){return K},Z9s:function(){return ee},oaQ:function(){return eg},CD7:function(){return jf},Rc0:function(){return zu},iPG:function(){return Qf},TIc:function(){return V.mobileAndTabletCheck},xsC:function(){return Cg},zOc:function(){return V.now},i8W:function(){return V.objectHasOwn},r46:function(){return rb},z2C:function(){return V.onChange},N4A:function(){return V.onChange2},hjq:function(){return V.onChange3},_X$:function(){return V.parseFileExtension},_yn:function(){return Kl},Dyg:function(){return V.pathJoin},cUc:function(){return gu},zGw:function(){return xy},Ctq:function(){return Ti},$ch:function(){return KL},k5b:function(){return Yt},kZl:function(){return Ju},OCg:function(){return U0},Kd3:function(){return V.prettyScrollbar},YjH:function(){return ir},Ui8:function(){return SM},YD2:function(){return Ff},vi9:function(){return rP},ij3:function(){return dr},pJq:function(){return V.readFile},YPW:function(){return Fi},_tY:function(){return V.remoteWorkerURL},Bg1:function(){return OL},kon:function(){return V.replaceAll},M3g:function(){return Lf},F2z:function(){return ht},pJF:function(){return r2},knz:function(){return p.knz},Ejo:function(){return V.safeSetProperty},BgY:function(){return $n},qCG:function(){return ae},HD9:function(){return cr},Rgz:function(){return dn},fEB:function(){return Gr},Udc:function(){return Jp},ZQg:function(){return _l},ofC:function(){return Wt},yRy:function(){return V.setUrlQueryParam},_NL:function(){return uk},LCA:function(){return fo},Sy1:function(){return XI},Vs_:function(){return qI},j1w:function(){return of},i8J:function(){return ck},p7C:function(){return Mi},Y8s:function(){return tP},ZAS:function(){return uE},ipH:function(){return ZL},$TF:function(){return aP},uZI:function(){return JL},VWG:function(){return Q},pQ7:function(){return gp},STw:function(){return Nf},jc8:function(){return $l},BL_:function(){return ze},S6:function(){return ak},T8U:function(){return $t},TD6:function(){return mt},BTW:function(){return zL},akS:function(){return V.svgToCanvas},QKE:function(){return V.svgToPng},dKx:function(){return V.svgUrl},doP:function(){return Ga},$jA:function(){return nn},T99:function(){return $r},LJS:function(){return No},VsW:function(){return V.timeout},LZE:function(){return ie},YMc:function(){return sP},aPg:function(){return rr},LFn:function(){return V.toTitleCase},VsX:function(){return ce},wey:function(){return Me},MaE:function(){return Xi},s4x:function(){return ea},FJA:function(){return en},vIA:function(){return Fs},Spv:function(){return zi},w8l:function(){return du},riG:function(){return Ci},Kbh:function(){return ql},BFq:function(){return Lc},t8K:function(){return ai},Q7n:function(){return Ot},KGF:function(){return Mn},e5:function(){return Qe},Rik:function(){return Iv},GZo:function(){return Mh},Bds:function(){return Sv},HTu:function(){return In},cTq:function(){return V.uploadFile},X_Y:function(){return Uc},dA8:function(){return mu},NSm:function(){return Ed},bwS:function(){return Ki},Lks:function(){return $L},Rvq:function(){return iP},P4F:function(){return V.verifyPermission},Pd0:function(){return fa},Pjo:function(){return Vt},Tum:function(){return Ho},dRH:function(){return Ji},RX0:function(){return is},reQ:function(){return ek},cWm:function(){return Fr},NC9:function(){return V.writeFile},$Re:function(){return Ch},Xo9:function(){return Kc},LNO:function(){return Rl},iZP:function(){return wf}}),function(a){a[a.Error=-2]="Error",a[a.Destroyed=-1]="Destroyed",a[a.None=0]="None",a[a.Running=1]="Running",a[a.Paused=2]="Paused"}(kt||(kt={}));var V=__webpackgi_require__(8),p=__webpackgi_require__(988);const Ke={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ct{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ut=new p.iKG(-1,1,1,-1,0,1),tt=new p.u9r;tt.setAttribute("position",new p.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),tt.setAttribute("uv",new p.a$l([0,2,0,0,2,0],2));class _t{constructor(e){this._mesh=new p.Kj0(tt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ut)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class it extends ct{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof p.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=p.rDY.clone(e.uniforms),this.material=new p.jyz({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new _t(this.material),this.useExistingRenderTarget=!1}render(e,t,i){this.uniforms[this.textureID]&&i&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class dt extends ct{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;let o,l;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(o=0,l=1):(o=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class At extends ct{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Mt{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new p.FM8);this._width=i.width,this._height=i.height,(t=new p.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:p.cLu})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new it(Ke),this.clock=new p.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let r=0,s=this.passes.length;r<s;r++){const o=this.passes[r];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const l=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),u.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}dt!==void 0&&(o instanceof dt?i=!0:o instanceof At&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new p.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class pt extends Mt{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const i=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=i)}}class Re extends p.ZzF{expandByObject(e,t=!1,i=!1,r){var s;if(((s=e.userData)===null||s===void 0?void 0:s.bboxVisible)===!1)return this;if(!e.visible&&i)return this;if(r&&r(e))return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),lt.copy(e.boundingBox),lt.applyMatrix4(e.matrixWorld),this.union(lt);else{const l=e.geometry;if(l!==void 0)if(t&&l.attributes!=null&&l.attributes.position!==void 0){const u=l.attributes.position;for(let h=0,f=u.count;h<f;h++)Ce.fromBufferAttribute(u,h).applyMatrix4(e.matrixWorld),this.expandByPoint(Ce)}else l.boundingBox===null&&l.computeBoundingBox(),lt.copy(l.boundingBox),lt.applyMatrix4(e.matrixWorld),this.union(lt)}const o=e.children;for(let l=0,u=o.length;l<u;l++)this.expandByObject(o[l],t,i,r);return this}expandByObjects(e,t=!1,i=!1,r){for(let s=0,o=e.length;s<o;s++)this.expandByObject(e[s],t,i,r);return this}getPoints(){return[new p.Pa4(this.min.x,this.min.y,this.min.z),new p.Pa4(this.min.x,this.min.y,this.max.z),new p.Pa4(this.min.x,this.max.y,this.min.z),new p.Pa4(this.min.x,this.max.y,this.max.z),new p.Pa4(this.max.x,this.min.y,this.min.z),new p.Pa4(this.max.x,this.min.y,this.max.z),new p.Pa4(this.max.x,this.max.y,this.min.z),new p.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),i=new p.TUj;for(const r of t){const s=r.project(e);i.min.min(s),i.max.max(s)}return i}}const lt=new Re,Ce=new p.Pa4;function vt(a,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!a.hasAttribute("position")||!a.hasAttribute("normal")||!a.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(o){if(o.normalized||o.isInterleavedBufferAttribute){const l=new Float32Array(o.count*o.itemSize);for(let u=0,h=0;u<o.count;u++)l[h++]=o.getX(u),l[h++]=o.getY(u),o.itemSize>2&&(l[h++]=o.getZ(u));return l}return o.array instanceof Float32Array?o.array:new Float32Array(o.array)}const r=a.index?a.toNonIndexed():a,s=e.generateTangents(i(r.attributes.position),i(r.attributes.normal),i(r.attributes.uv));if(t)for(let o=3;o<s.length;o+=4)s[o]*=-1;return r.setAttribute("tangent",new p.TlE(s,4)),a!==r&&a.copy(r),a}function at(a,e=!1){const t=a[0].index!==null,i=new Set(Object.keys(a[0].attributes)),r=new Set(Object.keys(a[0].morphAttributes)),s={},o={},l=a[0].morphTargetsRelative,u=new p.u9r;let h=0;for(let f=0;f<a.length;++f){const g=a[f];let _=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const A in g.attributes){if(!i.has(A))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+'. All geometries must have compatible attributes; make sure "'+A+'" attribute exists among all geometries, or in none of them.'),null;s[A]===void 0&&(s[A]=[]),s[A].push(g.attributes[A]),_++}if(_!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". Make sure all geometries have the same number of attributes."),null;if(l!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const A in g.morphAttributes){if(!r.has(A))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+".  .morphAttributes must be consistent throughout all geometries."),null;o[A]===void 0&&(o[A]=[]),o[A].push(g.morphAttributes[A])}if(e){let A;if(t)A=g.index.count;else{if(g.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". The geometry must have either an index or a position attribute"),null;A=g.attributes.position.count}u.addGroup(h,A,f),h+=A}}if(t){let f=0;const g=[];for(let _=0;_<a.length;++_){const A=a[_].index;for(let x=0;x<A.count;++x)g.push(A.getX(x)+f);f+=a[_].attributes.position.count}u.setIndex(g)}for(const f in s){const g=Fe(s[f]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" attribute."),null;u.setAttribute(f,g)}for(const f in o){const g=o[f][0].length;if(g===0)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[f]=[];for(let _=0;_<g;++_){const A=[];for(let E=0;E<o[f].length;++E)A.push(o[f][E][_]);const x=Fe(A);if(!x)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" morphAttribute."),null;u.morphAttributes[f].push(x)}}return u}function Fe(a){let e,t,i,r=-1,s=0;for(let h=0;h<a.length;++h){const f=a[h];if(f.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=f.array.constructor),e!==f.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=f.itemSize),t!==f.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=f.normalized),i!==f.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=f.gpuType),r!==f.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=f.array.length}const o=new e(s);let l=0;for(let h=0;h<a.length;++h)o.set(a[h].array,l),l+=a[h].array.length;const u=new p.TlE(o,t,i);return r!==void 0&&(u.gpuType=r),u}function Ct(a){return a.isInstancedInterleavedBufferAttribute||a.isInterleavedBufferAttribute?Ue(a):a.isInstancedBufferAttribute?new p.lb7().copy(a):new p.TlE().copy(a)}function Ft(a){let e,t=0,i=0;for(let h=0,f=a.length;h<f;++h){const g=a[h];if(e===void 0&&(e=g.array.constructor),e!==g.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=g.array.length,i+=g.itemSize}const r=new p.vpT(new e(t),i);let s=0;const o=[],l=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"];for(let h=0,f=a.length;h<f;h++){const g=a[h],_=g.itemSize,A=g.count,x=new p.kB5(r,_,s,g.normalized);o.push(x),s+=_;for(let E=0;E<A;E++)for(let T=0;T<_;T++)x[u[T]](E,g[l[T]](E))}return o}function Ue(a){const e=a.data.array.constructor,t=a.count,i=a.itemSize,r=a.normalized,s=new e(t*i);let o;o=a.isInstancedInterleavedBufferAttribute?new p.lb7(s,i,r,a.meshPerAttribute):new p.TlE(s,i,r);for(let l=0;l<t;l++)o.setX(l,a.getX(l)),i>=2&&o.setY(l,a.getY(l)),i>=3&&o.setZ(l,a.getZ(l)),i>=4&&o.setW(l,a.getW(l));return o}function $e(a){const e=a.attributes,t=a.morphTargets,i=new Map;for(const r in e){const s=e[r];s.isInterleavedBufferAttribute&&(i.has(s)||i.set(s,Ue(s)),e[r]=i.get(s))}for(const r in t){const s=t[r];s.isInterleavedBufferAttribute&&(i.has(s)||i.set(s,Ue(s)),t[r]=i.get(s))}}function Z(a){let e=0;for(const i in a.attributes){const r=a.getAttribute(i);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const t=a.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function ee(a,e=1e-4){const t=e>0;e=Math.max(e,Number.EPSILON);const i={},r=a.getIndex(),s=a.getAttribute("position"),o=r?r.count:s.count;let l=0;const u=Object.keys(a.attributes),h={},f={},g=[],_=["getX","getY","getZ","getW"],A=["setX","setY","setZ","setW"];for(let R=0,I=u.length;R<I;R++){const S=u[R],O=a.attributes[S];h[S]=new p.TlE(new O.array.constructor(O.count*O.itemSize),O.itemSize,O.normalized);const k=a.morphAttributes[S];k&&(f[S]=new p.TlE(new k.array.constructor(k.count*k.itemSize),k.itemSize,k.normalized))}const x=Math.log10(1/e),E=Math.pow(10,x);for(let R=0;R<o;R++){const I=r?r.getX(R):R;let S="";for(let O=0,k=u.length;O<k&&t;O++){const N=u[O],H=a.getAttribute(N),X=H.itemSize;for(let te=0;te<X;te++)S+=~~(H[_[te]](I)*E)+","}if(t&&S in i)g.push(i[S]);else{for(let O=0,k=u.length;O<k;O++){const N=u[O],H=a.getAttribute(N),X=a.morphAttributes[N],te=H.itemSize,re=h[N],ue=f[N];for(let le=0;le<te;le++){const se=_[le],de=A[le];if(re[de](l,H[se](I)),X)for(let ve=0,fe=X.length;ve<fe;ve++)ue[ve][de](l,X[ve][se](I))}}t&&(i[S]=l),g.push(l),l++}}const T=a.clone();for(const R in a.attributes){const I=h[R];if(T.setAttribute(R,new p.TlE(I.array.slice(0,l*I.itemSize),I.itemSize,I.normalized)),R in f)for(let S=0;S<f[R].length;S++){const O=f[R][S];T.morphAttributes[R][S]=new p.TlE(O.array.slice(0,l*O.itemSize),O.itemSize,O.normalized)}}return T.setIndex(g),T}function ce(a,e){if(e===p.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===p.z$h||e===p.UlW){let t=a.getIndex();if(t===null){const o=[],l=a.getAttribute("position");if(l===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(let u=0;u<l.count;u++)o.push(u);a.setIndex(o),t=a.getIndex()}const i=t.count-2,r=[];if(e===p.z$h)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=a.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}function Ne(a){const e=new p.Pa4,t=new p.Pa4,i=new p.Pa4,r=new p.Pa4,s=new p.Pa4,o=new p.Pa4,l=new p.Pa4,u=new p.Pa4,h=new p.Pa4;function f(Ee,Je,Te,qe,Ve,Ye,Tt,Xe){e.fromBufferAttribute(Je,Ve),t.fromBufferAttribute(Je,Ye),i.fromBufferAttribute(Je,Tt);const Zt=Ee.morphTargetInfluences;if(Te&&Zt){l.set(0,0,0),u.set(0,0,0),h.set(0,0,0);for(let di=0,Ai=Te.length;di<Ai;di++){const Wi=Zt[di],Gi=Te[di];Wi!==0&&(r.fromBufferAttribute(Gi,Ve),s.fromBufferAttribute(Gi,Ye),o.fromBufferAttribute(Gi,Tt),qe?(l.addScaledVector(r,Wi),u.addScaledVector(s,Wi),h.addScaledVector(o,Wi)):(l.addScaledVector(r.sub(e),Wi),u.addScaledVector(s.sub(t),Wi),h.addScaledVector(o.sub(i),Wi)))}e.add(l),t.add(u),i.add(h)}Ee.isSkinnedMesh&&(Ee.applyBoneTransform(Ve,e),Ee.applyBoneTransform(Ye,t),Ee.applyBoneTransform(Tt,i)),Xe[3*Ve+0]=e.x,Xe[3*Ve+1]=e.y,Xe[3*Ve+2]=e.z,Xe[3*Ye+0]=t.x,Xe[3*Ye+1]=t.y,Xe[3*Ye+2]=t.z,Xe[3*Tt+0]=i.x,Xe[3*Tt+1]=i.y,Xe[3*Tt+2]=i.z}const g=a.geometry,_=a.material;let A,x,E;const T=g.index,R=g.attributes.position,I=g.morphAttributes.position,S=g.morphTargetsRelative,O=g.attributes.normal,k=g.morphAttributes.position,N=g.groups,H=g.drawRange;let X,te,re,ue,le,se,de;const ve=new Float32Array(R.count*R.itemSize),fe=new Float32Array(O.count*O.itemSize);if(T!==null)if(Array.isArray(_))for(X=0,re=N.length;X<re;X++)for(le=N[X],se=Math.max(le.start,H.start),de=Math.min(le.start+le.count,H.start+H.count),te=se,ue=de;te<ue;te+=3)A=T.getX(te),x=T.getX(te+1),E=T.getX(te+2),f(a,R,I,S,A,x,E,ve),f(a,O,k,S,A,x,E,fe);else for(se=Math.max(0,H.start),de=Math.min(T.count,H.start+H.count),X=se,re=de;X<re;X+=3)A=T.getX(X),x=T.getX(X+1),E=T.getX(X+2),f(a,R,I,S,A,x,E,ve),f(a,O,k,S,A,x,E,fe);else if(Array.isArray(_))for(X=0,re=N.length;X<re;X++)for(le=N[X],se=Math.max(le.start,H.start),de=Math.min(le.start+le.count,H.start+H.count),te=se,ue=de;te<ue;te+=3)A=te,x=te+1,E=te+2,f(a,R,I,S,A,x,E,ve),f(a,O,k,S,A,x,E,fe);else for(se=Math.max(0,H.start),de=Math.min(R.count,H.start+H.count),X=se,re=de;X<re;X+=3)A=X,x=X+1,E=X+2,f(a,R,I,S,A,x,E,ve),f(a,O,k,S,A,x,E,fe);return{positionAttribute:R,normalAttribute:O,morphedPositionAttribute:new p.a$l(ve,3),morphedNormalAttribute:new p.a$l(fe,3)}}function K(a){if(a.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),a;let e=a.groups;if(e=e.sort((o,l)=>o.materialIndex!==l.materialIndex?o.materialIndex-l.materialIndex:o.start-l.start),a.getIndex()===null){const o=a.getAttribute("position"),l=[];for(let u=0;u<o.count;u+=3)l.push(u,u+1,u+2);a.setIndex(l)}const t=a.getIndex(),i=[];for(let o=0;o<e.length;o++){const l=e[o],u=l.start,h=u+l.count;for(let f=u;f<h;f++)i.push(t.getX(f))}a.dispose(),a.setIndex(i);let r=0;for(let o=0;o<e.length;o++){const l=e[o];l.start=r,r+=l.count}let s=e[0];a.groups=[s];for(let o=1;o<e.length;o++){const l=e[o];s.materialIndex===l.materialIndex?s.count+=l.count:(s=l,a.groups.push(s))}return a}function ie(a,e=Math.PI/3){const t=Math.cos(e),i=100*(1+1e-10),r=[new p.Pa4,new p.Pa4,new p.Pa4],s=new p.Pa4,o=new p.Pa4,l=new p.Pa4,u=new p.Pa4;function h(E){return`${~~(E.x*i)},${~~(E.y*i)},${~~(E.z*i)}`}const f=a.toNonIndexed(),g=f.attributes.position,_={};for(let E=0,T=g.count/3;E<T;E++){const R=3*E,I=r[0].fromBufferAttribute(g,R+0),S=r[1].fromBufferAttribute(g,R+1),O=r[2].fromBufferAttribute(g,R+2);s.subVectors(O,S),o.subVectors(I,S);const k=new p.Pa4().crossVectors(s,o).normalize();for(let N=0;N<3;N++){const H=h(r[N]);H in _||(_[H]=[]),_[H].push(k)}}const A=new Float32Array(3*g.count),x=new p.TlE(A,3,!1);for(let E=0,T=g.count/3;E<T;E++){const R=3*E,I=r[0].fromBufferAttribute(g,R+0),S=r[1].fromBufferAttribute(g,R+1),O=r[2].fromBufferAttribute(g,R+2);s.subVectors(O,S),o.subVectors(I,S),l.crossVectors(s,o).normalize();for(let k=0;k<3;k++){const N=_[h(r[k])];u.set(0,0,0);for(let H=0,X=N.length;H<X;H++){const te=N[H];l.dot(te)>t&&u.add(te)}u.normalize(),x.setXYZ(R+k,u.x,u.y,u.z)}}return f.setAttribute("normal",x),f}function he(a,e=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),at(a,e)}function _e(a){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),Fe(a)}function He(a,e){let t,i;if(Array.isArray(a))for(const s of a){const o=He(s,e);t===void 0||i===void 0?(t=o.min.clone(),i=o.max.clone()):(t.min(o.min),i.max(o.max))}const r=a;if(r.geometry!==void 0){const s=r.geometry.vertices;if(s===void 0&&r.geometry.attributes!==void 0&&"position"in r.geometry.attributes){const o=new p.Pa4,l=r.geometry.attributes.position;for(let u=0;u<l.count*l.itemSize;u+=l.itemSize){o.set(l.array[u],l.array[u+1],l.array[3]);const h=o.applyMatrix4(a.matrixWorld).project(e),f=new p.FM8(h.x,h.y);t===void 0||i===void 0?(t=f.clone(),i=f.clone()):(t.min(f),i.max(f))}}else for(const o of s){const l=o.clone().applyMatrix4(a.matrixWorld).project(e),u=new p.FM8(l.x,l.y);t===void 0||i===void 0?(t=u.clone(),i=u.clone()):(t.min(u),i.max(u))}}if(a.children!==void 0)for(const s of a.children){const o=He(s,e);t===void 0||i===void 0?(t=o.min.clone(),i=o.max.clone()):(t.min(o.min),i.max(o.max))}return new p.TUj(t,i)}const gt="rgbm-16";function It(a){switch(a){case p.aCh:case p.GUF:return["Linear","( value )"];case p.KI_:return["sRGB","( value )"];case gt:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",a),["Linear","( value )"]}}function xt(a,e){let t;return a&&a.isTexture?t=a.colorSpace:a&&a.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=a.texture.colorSpace):t=p.GUF,e&&a&&a.isTexture&&a.format===p.wk1&&a.type===p.ywz&&a.colorSpace===p.KI_&&(t=p.GUF),t}function jt(a,e){const t=It(e);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function ot(a,e,t){return jt(a+"TexelToLinear",xt(e,t))+`
`}function Bt(a,e){return jt(a+"TexelToLinear",e)+`
`}function Rt(a,e){const t=It(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Qt(a,e,t){return Rt(a,xt(e,t))}function Qe({uniforms:a,propKey:e,thisTarget:t=!1}={}){const i=!!a,r=!!e,s=t;return(o,l)=>{const u=h=>{const f=s?h:i?a:h.uniforms||h._uniforms;let g=r?e:l;s&&(g="_"+g);let _=f[g];return _||(_={value:null},f[g]=_),_};Object.defineProperty(o,l,{get(){return u(this).value},set(h){u(this).value=h,(0,V.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function oe(a,e,t=!1,i){const r=!!e,s=!!a;return(o,l)=>{const u=h=>({t:r?e:h.defines||h._defines,p:s?a:l});Object.defineProperty(o,l,{get(){const{t:h,p:f}=u(t?this:this.material);return h[f]},set(h){const{t:f,p:g}=u(t?this:this.material);if((0,V.safeSetProperty)(f,g,h,!0),typeof i=="function"){const _=[g,h];if(i.name){const A=this[i.name];A===i?i.call(this,..._):A.name===`bound ${i.name}`?A(..._):i(..._)}else i(..._)}else(0,V.safeSetProperty)(t?this:this.material,"needsUpdate",!0,!0)}})}}function Ie(a){const e=new p.IEO(new Uint8Array([Math.floor(255*a.r),Math.floor(255*a.g),Math.floor(255*a.b),255]),1,1,p.wk1,p.ywz);return e.needsUpdate=!0,e.colorSpace=p.aCh,e}function We(a){const e=new p.IEO(new Uint8Array([Math.floor(255*a.x),Math.floor(255*a.y),Math.floor(255*a.z),Math.floor(255*a.w)]),1,1,p.wk1,p.ywz);return e.needsUpdate=!0,e}function Wt(a,e,t){const i=a.userData,{backgroundRender:r,transparentRender:s,shadowMapRender:o,mainRenderPass:l,opaqueRender:u,transmissionRender:h,sceneRender:f,screenSpaceRendering:g}=i;e.backgroundRender!==void 0&&(i.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(i.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(i.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(i.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(i.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(i.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(i.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(i.screenSpaceRendering=e.screenSpaceRendering),t(),i.backgroundRender=r,i.transparentRender=s,i.shadowMapRender=o,i.mainRenderPass=l,i.opaqueRender=u,i.sceneRender=f,i.transmissionRender=h,i.screenSpaceRendering=g}function ti(a){const e=new Re().expandByObject(a,!0,!0).getCenter(new p.Pa4);a.position.sub(e),a.updateMatrix(),a.userData.autoCentered=!0,a.userData.isCentered=!0}function mi(a,e,t){const i=.5*new Re().expandByObject(a,!0,!0).getSize(new p.Pa4).length();e===void 0&&(e=a.userData.autoScaleRadius||1);const r=e/i;return isFinite(r)&&(a.userData.pseudoCentered?a.children.forEach(s=>{s.scale.multiplyScalar(r)}):a.scale.multiplyScalar(r),(t||a.userData.isCentered)&&a.position.multiplyScalar(r),a.traverse(s=>{var o,l;s.isLight&&!((l=(o=s.shadow)===null||o===void 0?void 0:o.camera)===null||l===void 0)&&l.right&&(s.shadow.camera.right*=r,s.shadow.camera.left*=r,s.shadow.camera.top*=r,s.shadow.camera.bottom*=r),s.isCamera&&s.right&&(s.right*=r,s.left*=r,s.top*=r,s.bottom*=r)}),a.userData.autoScaled=!0,a.userData.autoScaleRadius=e,a.dispatchEvent({type:"objectUpdate"})),a}function rr(a,e=-1){return ee(a,e)}function Oi(a,e){return{type:"folder",label:e+" Sampler",hidden:()=>!a[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[a[e],"repeat"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[a[e],"offset"],onChange:a==null?void 0:a.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[a[e],"center"],onChange:a==null?void 0:a.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[a[e],"rotation"],onChange:a==null?void 0:a.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[a[e],"colorSpace"],children:[["Linear",p.GUF],["sRGB",p.KI_]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=a[e];t&&(t.needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t,i;return(i=(t=a[e])===null||t===void 0?void 0:t.flipY)!==null&&i!==void 0&&i},setValue:t=>{var i;const r=a[e];if(r&&r.flipY!==t)if(r.image&&ImageBitmap&&r.image instanceof ImageBitmap){const s=r,o=r.source.data;createImageBitmap(o,{imageOrientation:"flipY"}).then(l=>{var u;o.close&&o.close(),s.flipY=t,s.source.data=l,s.source.needsUpdate=!0,s.needsUpdate=!0,(u=a==null?void 0:a.setDirty)===null||u===void 0||u.call(a)})}else r.flipY=t,r.needsUpdate=!0,(i=a==null?void 0:a.setDirty)===null||i===void 0||i.call(a)}}),()=>({type:"dropdown",label:"Wrap S",property:[a[e],"wrapS"],children:[["ClampToEdge",p.uWy],["MirroredRepeat",p.OoA],["Repeat",p.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[a[e],"wrapT"],children:[["ClampToEdge",p.uWy],["MirroredRepeat",p.OoA],["Repeat",p.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[a[e],"anisotropy"],onChange:[()=>{a[e]&&(a[e].needsUpdate=!0),a.needsUpdate=!0},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[a[e],"minFilter"],children:[["Linear",p.wem],["Nearest",p.TyD],["NearestMipmapNearest",p.YLQ],["NearestMipmapLinear",p.vZf],["LinearMipmapNearest",p.qyh],["LinearMipmapLinear",p.D1R]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[a[e],"magFilter"],children:[["Linear",p.wem],["Nearest",p.TyD]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{a[e]&&(a[e].needsUpdate=!0)},a==null?void 0:a.setDirty]})]}}const Lr=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function zr(a,e,t=!0){if(!e)return a;for(const i of Object.keys(e)){if(t&&Lr.includes(i)||i.startsWith("__"))continue;const r=e[i];if(typeof a[i]=="function"||typeof r=="function")continue;const s=!r||r.isTexture||r.isObject3D||r.isMaterial;s||typeof r.clone!="function"?s||typeof r!="object"&&!Array.isArray(r)?a[i]=r:a[i]=zr(Array.isArray(r)?[]:{},r,!1):a[i]=r.clone()}return a}const Vr=["appliedMaterials","uuid"];function Qn(a,e){if(e)for(const t of Object.keys(e))Vr.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}function nn(a,e,t){var i;const r=(i=t==null?void 0:t.data)!==null&&i!==void 0?i:new Uint8ClampedArray(a.height*a.width*4),s=a.data instanceof Float32Array,o=a.data instanceof Uint16Array;for(let l=0;l<r.length;l++)r[l]=s?255*a.data[l]:o?255*p.A5E.fromHalfFloat(a.data[l]):a.data[l],e===p.GUF&&(r[l]=255*(0,V.LinearToSRGB)(r[l]/255));return t??new ImageData(r,a.width,a.height)}function $r(a,e,t=!1){let i;return i=a.isDataTexture?nn(a.image,a.colorSpace):a.image,Ga(i,e,t)}function Ga(a,e,t=!1){const i=document.createElement("canvas");i.width=Math.min(e,a.width),i.height=Math.floor(1+i.width*a.height/a.width);const r=i.getContext("2d");if(!r)return console.error("textureToDataUrl: could not get canvas context"),i;t===!0&&(r.translate(0,i.height),r.scale(1,-1));let s=!1;if(a.data!==void 0){const o=a;if(a.width!==i.width||a.height!==i.height){const l=document.createElement("canvas");l.width=a.width,l.height=a.height;const u=l.getContext("2d");u?(u.putImageData(o,0,0),r.drawImage(l,0,0,i.width,i.height)):(console.error("textureToDataUrl: could not get temp canvas context"),r.putImageData(o,0,0))}else r.putImageData(o,0,0),t&&(s=!0)}else r.drawImage(a,0,0,i.width,i.height);return s?(0,V.canvasFlipY)(i):i}function No(a,e,t,i,r){return $r(a,e,t).toDataURL(i,r)}String.prototype.replaceAll||(String.prototype.replaceAll=function(a,e){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,e):this.replace(new RegExp(a,"g"),e)});const hn=new Map;function ae(a){return(e,t)=>{const i=e.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");hn.has(i)||hn.set(i,[]),hn.get(i).push([a||t,t])}}const Gr={obj:(a,e)=>Object.fromEntries(Object.entries(a).map(([t,i])=>[t,cr(i,!1,e)])),vec4:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isVector4:!0}),vec3:a=>({x:a.x,y:a.y,z:a.z,isVector3:!0}),vec2:a=>({x:a.x,y:a.y,isVector2:!0}),color:a=>({r:a.r,g:a.g,b:a.b,isColor:!0}),quat:a=>({x:a.x,y:a.y,z:a.z,w:a.w,isQuaternion:!0}),texture:(a,e)=>{var t;if(!(a!=null&&a.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[a.uuid])return{uuid:a.uuid,resource:"textures"};if(a.isRenderTargetTexture&&!(!((t=a.userData)===null||t===void 0)&&t.serializableRenderTarget))return;const i=a.source.data,r=!a.isRenderTargetTexture&&a.userData.rootPath;r&&a.source.data&&(a.userData.__embedUrlImagePreviews?a.source.data=$r(a,16,a.flipY):a.source.data=null);const s=a.userData;a.userData={};const o={images:{}};let l={};try{l=a.toJSON(e||o),!e&&l.image&&(l.image=r&&!a.userData.__embedUrlImagePreviews?void 0:o.images[l.image]),l.userData=cr(Qn({},s),!1,e)}catch(u){console.error(u)}return a.userData=s,r&&(e&&!a.userData.__embedUrlImagePreviews&&delete e.images[a.source.uuid],a.source.data=i),e!=null&&e.textures&&!l.resource&&(e.textures[l.uuid]||(e.textures[l.uuid]=l),l={uuid:l.uuid,resource:"textures"}),l},material:(a,e)=>{if(!(a!=null&&a.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[a.uuid])return{uuid:a.uuid,resource:"materials"};a.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const t=e??{textures:{},images:{}},i={},r={};for(const[o,l]of Object.entries(a))if(l!=null&&l.isTexture&&!o.startsWith("__")){const u=Gr.texture(l,t);i[o]=u,r[o]=l,a[o]=u?{isTexture:!0,toJSON:()=>u}:null}let s=a.toJSON(e);for(const[o,l]of Object.entries(r))a[o]=l,delete r[o];if(e){for(const[o,l]of Object.entries(i))l&&(s[o]=l);e!=null&&e.materials&&(e.materials[s.uuid]||(e.materials[s.uuid]=s),s={uuid:s.uuid,resource:"materials"})}else{for(const[o,l]of Object.entries(i))l&&(s[o]=l.uuid);s.textures=Object.values(t.textures),s.images=Object.values(t.images)}return s}},An=a=>(e,t)=>{var i,r;return(r=(i=t==null?void 0:t.copy)===null||i===void 0?void 0:i.call(t,e))!==null&&r!==void 0?r:new a().copy(e)},ps={obj:(a,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(a).map(([i,r])=>[i,br(r,e==null?void 0:e[i],!1,t)]))),vec4:An(p.Ltg),vec3:An(p.Pa4),vec2:An(p.FM8),color:An(p.Ilk),quat:An(p._fP)};function cr(a,e,t){var i,r;if(typeof a=="function")return;if(Array.isArray(a))return a.map(l=>cr(l,!1,t));if(typeof a!="object"){if(typeof a=="number"){if(a===1/0)return"Infinity";if(a===-1/0)return"-Infinity";if(isNaN(a))return"NaN"}return a}if(!a)return a;let s=(i=a.constructor)!==null&&i!==void 0?i:Object;if(s===Object)return Gr.obj(a,t);if(a.isVector2)return Gr.vec2(a);if(a.isVector3)return Gr.vec3(a);if(a.isVector4)return Gr.vec4(a);if(a.isColor)return Gr.color(a);if(a.isQuaternion)return Gr.quat(a);if(a.isTexture)return Gr.texture(a,t);if(a.isMaterial)return Gr.material(a,t);if(!e&&typeof a.toJSON=="function"){const l=a.toJSON(t);return a.serializableClassId&&l&&(l.serializableClassId=a.serializableClassId),l}const o={};for(;s&&s!==Object;)(r=hn.get(s))===null||r===void 0||r.forEach(([l,u])=>{const h=a[u];o[l]=cr(h,!1,t)}),s=Object.getPrototypeOf(s);return a.serializableClassId&&(o.serializableClassId=a.serializableClassId),o}function br(a,e,t,i){var r,s,o;let l=e;if(a===void 0)return l;if(typeof e=="number"){if(a==="Infinity")return 1/0;if(a==="-Infinity")return-1/0;if(a==="NaN")return NaN;if(typeof a=="number"||!a)return a}if(Array.isArray(a)){const f=a.length;Array.isArray(l)||(l=[]);for(let g=0;g<f;g++){const _=a[g],A=l.length>g?br(_,l[g],!1,i):br(_,void 0,!1,i);l.length<=g?l.push(A):l[g]=A}return l}let u=!1;if(a&&a.resource&&typeof a.resource=="string"&&(a=(r=i[a.resource])===null||r===void 0?void 0:r[a.uuid],u=!0),!l&&a&&!u)if(a.serializableClassId){const f=fs.get(a.serializableClassId);f&&(l=f.DataInConstructor?new f(a):new f)}else typeof a!="object"||a.constructor&&a.constructor!==Object||(l={});if(typeof l=="function")return console.error("cannot deserialize over function",l,a),l;if(a&&typeof a=="object"&&!u){if(a.isVector2)return ps.vec2(a,l);if(a.isVector3)return ps.vec3(a,l);if(a.isVector4)return ps.vec4(a,l);if(a.isColor)return ps.color(a,l);if(a.isQuaternion)return ps.quat(a,l)}if(a==null||l==null||typeof l!="object"||l.isTexture)return u&&(a?a.__useCount=a.__useCount?a.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),a;let h=(s=l.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return ps.obj(a,l,i);if(!t&&typeof l.fromJSON=="function")return l.isMaterial&&(Object.entries(a).forEach(([f,g])=>{var _;if(!g||!g.resource||typeof g.resource!="string")return;const A=(_=i[g.resource])===null||_===void 0?void 0:_[g.uuid];a[f]=A||null}),a.userData&&(a.userData=br(a.userData,void 0,!1,i))),l.fromJSON(a,i),l;for(;h&&h!==Object;)(o=hn.get(h))===null||o===void 0||o.forEach(([f,g])=>{const _=l[g],A=br(a[f],_,!1,i);A!==_&&(0,V.safeSetProperty)(l,g,A,!0)}),h=Object.getPrototypeOf(h);return l}const fs=new Map;function $n(a){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=a}},fs.set(a,e),e)}function dn(a,e,t,i){var r,s,o;if(e!=null&&e.extras[a.uuid])return{uuid:a.uuid,resource:"extras"};let l="";if(!((r=a.source)===null||r===void 0)&&r._sourceImgBuffer||a.userData.__sourceBuffer){const h=new Uint8Array(((s=a.source)===null||s===void 0?void 0:s._sourceImgBuffer)||a.userData.__sourceBuffer),f=i||a.userData.mimeType||"";l={data:Array.from(h),type:h.constructor.name,path:((o=a.userData.__sourceBlob)===null||o===void 0?void 0:o.name)||a.userData.rootPath||"file."+f.split("/")[1]},f&&(l.mimeType=f)}else a.userData.rootPath?l=a.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const u={uuid:a.uuid,url:l,userData:Qn({},a.userData),type:a.type,name:t||a.name};return e!=null&&e.extras?(e.extras[a.uuid]=u,{uuid:a.uuid,resource:"extras"}):u}var Ha=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let ch=class extends V.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(a){a!==this._displayCanvasScaling&&(this._displayCanvasScaling=a,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(a){this._pipeline=a,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var a,e,t;const i=this._passes,r=[],s={};for(const o of i){if(o.enabled===!1)continue;const l={after:(a=o.after)!==null&&a!==void 0?a:[],before:(e=o.before)!==null&&e!==void 0?e:[],dependencies:new Set((t=o.required)!==null&&t!==void 0?t:[])};s[o.passId]=l}for(const[o,l]of Object.entries(s)){const u=new Set([...l.after,...l.before]);l.dependencies.forEach(h=>u.has(h)&&u.delete(h)),u.forEach(h=>{const f=s[h];if(f){if(f.dependencies.has(o))throw console.error("cyclic",o,h),"Cyclic dependency";l.dependencies.add(h)}})}for(;;){let o=!1;const l=[...Object.entries(s)];for(const[u,h]of l)if(!r.includes(u)&&(0,V.includesAll)(r,h.dependencies.values())){const f=Math.max(-1,...h.after.map(_=>r.indexOf(_))),g=Math.min(r.length,...h.before.map(_=>{const A=r.indexOf(_);return A<0?r.length:A}));if(f>=g)throw console.error(h,i,r,f,g),"Not possible";r.splice(h.after.length>0?f+1:g,0,u),o=!0,delete s[u]}if(Object.keys(s).length<1)break;if(!o)throw console.error(l,s,r),"Not possible 2"}return this.pipeline=r,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(a,e){const t=a-this._lastTime;this._lastTime=a,this.frameWaitTime-=t,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:a,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(a,e=!0){var t;if(e)for(const i of[...this._passes])a.passId===i.passId&&this.unregisterPass(i);this._passes.push(a),(t=a.onRegister)===null||t===void 0||t.call(a,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(a){var e;const t=this._passes.indexOf(a);t>=0&&((e=a.onUnregister)===null||e===void 0||e.call(a,this),this._passes.splice(t,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:a,canvas:e,alpha:t=!0,targetOptions:i}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new p.FM8(512,512),this._frameCount=0,this.defaultRenderToScreen=!0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new p.CP7({canvas:e,antialias:!1,alpha:t,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=r=>{this.dispatchEvent({type:"contextLost",event:r})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new p.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=p.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=p.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=p._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(i,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new pt(this._renderer,this._composerTarget),a&&this.addEventListener("animationLoop",a)}setSize(a,e,t=!1){!t&&(a?Math.abs(a-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(a&&(this._renderSize.width=a),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled&&this.rendererObject.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(i=>{const r=i,s=r.sizeMultiplier;if(s){const o=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*s);r.setSize(Math.floor(o.width),Math.floor(o.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(a,e,{viewport:t,material:i,shader:r,pass:s,clear:o=!0}={}){const l=this._composer.copyPass,{renderToScreen:u,material:h,uniforms:f,clear:g}=l;i&&(l.material=i);const _=this._renderer.getViewport(new p.Ltg),A=this._renderer.autoClear,x=this._renderer.getRenderTarget();t&&this._renderer.setViewport(new p.Ltg().fromArray(t)),this._renderer.autoClear=!1,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=o,Wt(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{l.render(this._renderer,e??null,{texture:a},0,!1)}),l.renderToScreen=u,l.clear=g,l.material=h,l.uniforms=f,this._renderer.autoClear=A,t&&this._renderer.setViewport(_),this._renderer.setRenderTarget(x)}clearColor({r:a,g:e,b:t,a:i,target:r,depth:s=!0,stencil:o=!0}){var l;const u=this._renderer.getClearColor(new p.Ilk),h=this._renderer.getClearAlpha();this._renderer.setClearColor(new p.Ilk(a??u.r,e??u.g,t??u.b),i??h);const f=this._renderer.getRenderTarget(),g=this._renderer.getActiveCubeFace(),_=this._renderer.getActiveMipmapLevel();r&&typeof r.clear=="function"?r.clear(this._renderer,!0,s,o):(this._renderer.setRenderTarget((l=r)!==null&&l!==void 0?l:null),this._renderer.clear(!0,s,o)),this._renderer.setRenderTarget(f,g,_),this._renderer.setClearColor(u,h)}renderModel(a,e){this._renderer.render(a.modelObject,e.cameraObject)}renderScene(a){const e=a.activeCamera;e&&this.renderModel(a,e)}_updated(){this.dispatchEvent({type:"update"})}render(a){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&((e=t.update)===null||e===void 0||e.call(t));a=a??this.defaultRenderToScreen,this._composer.renderToScreen=a,this._composer.render(),this._composer.renderToScreen=!0,a&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(a=>a.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const a=[];for(const e of this._pipeline){const t=this._passes.find(i=>i.passId===e);t?a.push(t.passObject):console.warn("WebGi BaseRenderer: Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),a.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(a=>a.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(a){this._trackedTargets.push(a)}removeTrackedTarget(a){const e=this._trackedTargets.indexOf(a);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:a,samples:e=0,colorSpace:t=p.aCh,type:i=p.ywz,format:r=p.wk1,depthBuffer:s=!0,depthTexture:o=!1,depthTextureType:l=p.JQ4,depthTextureFormat:u=p.qkB,size:h,textureCount:f=1,...g}={},_=!0){this.isWebGL2||(e=0),a!==void 0&&h!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(h=h||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(a=a||1))).width=Math.floor(h.width),h.height=Math.floor(h.height);const A=o?new p.$YQ(h.width,h.height,l):void 0;A&&(A.format=u);const x=this.createTargetCustom(f>1?{width:h.width,height:h.height,count:f}:h,{samples:e,colorSpace:t,type:i,format:r,depthBuffer:s,depthTexture:A},f>1?p.kFz:p.dd2);return this._processNewTarget(x,a,_),this._setTargetOptions(x,g),x}_processNewTarget(a,e,t){return e!==void 0&&(a.sizeMultiplier=e),t&&this.trackTarget(a),a}disposeTarget(a){if(a){if(a.isTemporary)return this.releaseTempTarget(a);this.removeTrackedTarget(a),a.dispose()}}createTargetCustom({width:a,height:e,count:t},i={},r){var s;const o=this._processNewTarget,l=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let u=[a,e];if(t&&t>1&&u.push(t),(r==null?void 0:r.prototype)===p.oAp.prototype){if(a!==e)throw"Width and height of cube render target must be equal";u=[a]}i={format:p.wk1,minFilter:p.wem,magFilter:p.wem,generateMipmaps:!1,type:p.ywz,colorSpace:p.aCh,...i};const h=[this,...u,i];return new class extends((s=r)!==null&&s!==void 0?s:p.dd2){constructor(f,...g){super(...g),this.renderer=f,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(_=>{_.__target=this,_.userData||(_.userData={}),_.colorSpace=i.colorSpace,_.toJSON=()=>(console.warn("WebGi RenderTarget: Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.userData||(this.texture.userData={}),this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(_){console.warn("WebGi RenderTarget: Render target texture.toJSON might be buggy."),this.source.data.url=l(this.__target,"image/png",90);const A=this.__toJSON.call(this,_);return delete this.source.data.url,A.isRenderTargetTexture=!0,A})}setSize(f,g,_){super.setSize(Math.floor(f),Math.floor(g),_)}clone(f=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const g=super.clone();return g.texture.isRenderTargetTexture=!0,o(g,this.sizeMultiplier||1,f)}}(...h)}getTempTarget(a={}){var e;const t=vl(a);let i;return!((e=this._tempTargets[t])===null||e===void 0)&&e.length&&(i=this._tempTargets[t].pop()),i?this._setTargetOptions(i,a):(i=this.createTarget(a),this._processNewTempTarget(i,t)),i}_processNewTempTarget(a,e){return a.isTemporary=!0,a.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),a}releaseTempTarget(a){const e=a.targetKey;if(!e||!a.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?(this.removeTrackedTarget(a),a.dispose()):this._tempTargets[e].push(a)}updateShaderProperties(a){return this.stableNoise?a.uniforms.frameCount?a.uniforms.frameCount.value=this._totalFrameCount:console.warn("WebGi BaseRenderer: no uniform: frameCount"):a.uniforms.frameCount?a.uniforms.frameCount.value=this.frameCount:console.warn("WebGi BaseRenderer:  no uniform: frameCount"),a.uniforms.frameCount2&&(a.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(a,e){var t,i,r;a.texture.minFilter=(t=e.minFilter)!==null&&t!==void 0?t:p.wem,a.texture.magFilter=(i=e.magFilter)!==null&&i!==void 0?i:p.wem,a.texture.generateMipmaps=(r=e.generateMipmaps)!==null&&r!==void 0&&r,a.texture.generateMipmaps&&a.texture.minFilter===p.wem&&(a.texture.minFilter=p.FDw),a.texture.generateMipmaps||a.texture.minFilter!==p.FDw||(a.texture.minFilter=p.wem)}renderTargetToDataUrl(a,e="image/png",t=90,i=0){const r=document.createElement("canvas");r.width=a.width,r.height=a.height;const s=r.getContext("2d");if(!s)throw new Error("Unable to get 2d context");const o=Array.isArray(a.texture)?a.texture[i]:a.texture,l=s.createImageData(a.width,a.height,{colorSpace:["display-p3","srgb"].includes(o.colorSpace)?o.colorSpace:void 0});if(o.type===p.cLu){const h=new Uint16Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,h,void 0,i),nn({data:h,width:a.width,height:a.height},o.colorSpace,l)}else if(o.type===p.VzW){const h=new Float32Array(a.width*a.height*4);this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,h,void 0,i),nn({data:h,width:a.width,height:a.height},o.colorSpace,l)}else this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,l.data,void 0,i);s.putImageData(l,0,0);const u=r.toDataURL(e,t);return r.remove(),u}renderTargetToBuffer(a,e=0){const t=(Array.isArray(a.texture)?a.texture[e]:a.texture).type===p.cLu?new Uint16Array(a.width*a.height*4):new Uint8Array(a.width*a.height*4);return this._renderer.readRenderTargetPixels(a,0,0,a.width,a.height,t,void 0,e),t}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(a){this.rendererObject.useLegacyLights=a,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(a){console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=a}get renderScale(){return this.displayCanvasScaling}set renderScale(a){this.displayCanvasScaling=a}};function vl(a={}){var e,t;return[a.sizeMultiplier,a.samples,a.colorSpace,a.type,a.format,a.depthBuffer,a.depthTexture,(e=a.size)===null||e===void 0?void 0:e.width,(t=a.size)===null||t===void 0?void 0:t.height].join(";")}function xd(a){var e,t,i,r,s,o,l,u;if(!a.isMaterial&&!a.isBufferGeometry)return;const h=Array.from(a.userData.__appliedMeshes).filter(A=>!A.isInstancedMesh&&!!A.parent&&A.children.length===0&&!Array.isArray(A.material));if(h.length<2)return;const f=A=>{var x;return A.parent.uuid+"_"+A.geometry.uuid+"_"+((x=A.material)===null||x===void 0?void 0:x.uuid)},g=new Map;for(const A of h){const x=f(A);g.has(x)||g.set(x,[]),g.get(x).push(A),A.updateMatrix()}const _=g.keys();for(const A of _){const x=g.get(A),E=x[0];if(!E||x.length<2)continue;const T=new p.SPe(E.geometry,E.material,x.length),R=E.userData;E.userData={},T.copy(E),ms(T.userData,R);const I=E.parent;T.position.set(0,0,0),T.rotation.set(0,0,0),T.scale.set(1,1,1),T.updateMatrix();const S=new Float32Array(3*T.count),O=new Float32Array(4*T.count),k=new Float32Array(3*T.count);for(let N=0;N<x.length;N++){const H=x[N],X=H.matrix;X.determinant()<0&&(X.elements[0]*=-1,X.elements[1]*=-1,X.elements[2]*=-1),T.setMatrixAt(N,X),H.position.toArray(S,3*N),H.quaternion.toArray(O,4*N),H.scale.toArray(k,3*N),H.removeFromParent(),(i=(t=(e=H.material)===null||e===void 0?void 0:e.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||i===void 0||i.delete(H),(o=(s=(r=H.geometry)===null||r===void 0?void 0:r.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||o===void 0||o.delete(H)}(u=(l=T.material.userData)===null||l===void 0?void 0:l.__appliedMeshes)===null||u===void 0||u.add(T),T.geometry.userData.__appliedMeshes.add(T),T.sourceTrs={TRANSLATION:new p.TlE(S,3),ROTATION:new p.TlE(O,4),SCALE:new p.TlE(k,3)},T.instanceMatrix.needsUpdate=!0,I.add(T),I.setDirty()}}Ha([ae()],ch.prototype,"stableNoise",void 0),Ha([ae()],ch.prototype,"useLegacyLights",null),ch=Ha([$n("RenderManager")],ch);class pn{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,r=e;let s=r.sourceTrs;if(!s){const o=new Float32Array(3*r.count),l=new Float32Array(4*r.count),u=new Float32Array(3*r.count),h=new p.yGw,f=new p.Pa4,g=new p._fP,_=new p.Pa4;for(let A=0;A<r.count;A++)r.getMatrixAt(A,h),h.decompose(f,g,_),f.toArray(o,3*A),g.toArray(l,4*A),_.toArray(u,3*A);s={TRANSLATION:new p.TlE(o,3),ROTATION:new p.TlE(l,4),SCALE:new p.TlE(u,3)}}s={TRANSLATION:i.processAccessor(s.TRANSLATION),ROTATION:i.processAccessor(s.ROTATION),SCALE:i.processAccessor(s.SCALE)},r.instanceColor&&(s.COLOR=i.processAccessor(new p.TlE(r.instanceColor.array,3))),i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:s}}}function uh(a,e){if(a.uiConfig)return a.uiConfig;const t={type:"folder",label:()=>a.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[a,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{a.dispatchEvent({type:"select",ui:!0,value:a,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!a.parent,value:()=>{const r=a.parent;r&&r.dispatchEvent({type:"select",ui:!0,value:r})}},{type:"input",label:"Name",property:[a,"name"],onChange:r=>{var s;r.last&&((s=a.setDirty)===null||s===void 0||s.call(a,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!a.isMesh,property:[a,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!a.isMesh,property:[a,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[a,"frustumCulled"]},{type:"vec3",label:"Position",property:[a,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[a,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[a,"scale"]},{type:"input",label:"Render Order",property:[a,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",a.userData.autoScaleRadius||"2",!0],value:r=>{if(!r)return;const s=parseFloat(r);Math.abs(s)>0&&mi(a,s)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&ti(a)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(r=>({type:"button",label:"Rotate "+r+"90",value:()=>{var s;a.rotateOnAxis(new p.Pa4(r.includes("X")?1:0,r.includes("Y")?1:0,r.includes("Z")?1:0),Math.PI/2*(r.includes("-")?-1:1)),(s=a.setDirty)===null||s===void 0||s.call(a,{sceneUpdate:!0,refreshUi:!1})}}))},a.userData.license!==void 0?{type:"input",label:"License/Credits",property:[a.userData,"license"],limitedUi:!0}:{}]},i=a;if(i!=null&&i.isMesh&&e!==!1){const r=[()=>{const s=Object.entries(i.morphTargetDictionary||{});return s.length?{label:"Morph Targets",type:"folder",children:s.map(([o,l])=>({type:"slider",label:o,bounds:[0,1],stepSize:1e-4,property:[i.morphTargetInfluences,l],onChange:u=>{var h;(h=a.setDirty)===null||h===void 0||h.call(a,{sceneUpdate:u.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var s;return(s=i.geometry)===null||s===void 0?void 0:s.uiConfig},()=>{var s;return Array.isArray(i.material)?i.material.length<1?void 0:{label:"Materials",type:"folder",children:i.material.map(o=>o==null?void 0:o.uiConfig).filter(o=>o)}:(s=i.material)===null||s===void 0?void 0:s.uiConfig}];t.children.push(...r)}if(a!=null&&a.isCamera){const r=[{type:"button",label:"Set View",value:()=>{var s;a.dispatchEvent({type:"setView",ui:!0,camera:a}),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var s;return(s=a.userData.iCamera)===null||s===void 0?void 0:s.isActiveCamera},value:()=>{var s;a.dispatchEvent({type:"activateMain",ui:!0,camera:a}),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var s;return!(!((s=a.userData.iCamera)===null||s===void 0)&&s.isActiveCamera)},value:()=>{var s;a.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>{var s;return(s=a.userData.autoLookAtTarget)!==null&&s!==void 0&&s},setValue:s=>{var o;a.userData.autoLookAtTarget=s,(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0)}}];t.children.push(...r)}return a.uiConfig=t,t}function fo(a,e,t){var i;if(!a)return void console.warn("WebGi: setupIModel: object is undefined");if(a.__disposed&&(console.warn("WebGi: re-init/re-add disposed object, things might not work as intended",a),delete a.__disposed),a.userData||(a.userData={}),a.userData.__iModelSetup&&a.modelObject)return a;a.userData.__iModelSetup=!0;let r=[];r.push(()=>{[...a.children].forEach(g=>{var _;(_=g==null?void 0:g.dispose)===null||_===void 0||_.call(g),a.add(g)}),a.parent&&a.removeFromParent()}),a.isLight&&!a.assetType?(a.assetType="light",a.lightObject=a):a.isCamera?(a.assetType="camera",a.cameraObject=a):a.assetType||(a.assetType="model"),a.modelObject||(a.modelObject=a),a.setDirty||(a.setDirty=(g={})=>{a.dispatchEvent({...g,type:"objectUpdate",object:a})},a.userData.setDirty&&console.warn("WebGi: userData.setDirty already defined",a.userData.setDirty,a),a.userData.setDirty=g=>{var _;console.warn("WebGi: userData.setDirty is deprecated, use setDirty directly"),(_=a.setDirty)===null||_===void 0||_.call(a,g)}),a.addEventListener("added",g=>{var _,A,x;const E=(A=(_=a.parent)===null||_===void 0?void 0:_.userData.parentRoot)!==null&&A!==void 0?A:a.parent;E!==a.userData.parentRoot&&a.traverse(T=>{T.userData.parentRoot=E}),(x=a.setDirty)===null||x===void 0||x.call(a,{change:"addedToParent"})}),a.addEventListener("removed",()=>{var g;(g=a.setDirty)===null||g===void 0||g.call(a,{change:"removedFromParent"}),a.userData.parentRoot!==void 0&&a.traverse(_=>{_.userData.parentRoot=void 0})}),r.push(()=>{});const s=a.dispose;a.dispose=()=>{a.dispatchEvent({type:"dispose"}),s==null||s.call(a)},a.userData.dispose&&console.warn("WebGi: userData.dispose already defined"),a.userData.dispose=()=>{var g;console.warn("WebGi: userData.dispose is deprecated, use dispose directly"),(g=a.dispose)===null||g===void 0||g.call(a)};const o=a;!o.isMesh&&!o.isLine||o.userData.__meshSetup||(o.userData.__meshSetup=!0,o.setMaterial||(o.setMaterial=g=>_l(o,g)),o.setGeometry||(o.setGeometry=(g,_=!1)=>Jp(o,g,_),o.setGeometry(o.geometry,!0)),a.userData.setMaterial&&console.warn("WebGi: userData.setMaterial already defined"),a.userData.setMaterial=g=>{var _;console.warn("WebGi: userData.setMaterial is deprecated, use setMaterial directly"),(_=a.setMaterial)===null||_===void 0||_.call(a,g)},a.userData.setGeometry&&console.warn("WebGi: userData.setGeometry already defined"),a.userData.setGeometry=(g,..._)=>{var A;console.warn("WebGi: userData.setGeometry is deprecated, use setGeometry directly"),(A=a.setGeometry)===null||A===void 0||A.call(a,g,..._)},a.userData.__keepShadowDef||(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0),r.push(()=>{var g,_,A,x;const E=((g=o.setMaterial)===null||g===void 0?void 0:g.call(o,void 0))||[],T=(_=o.setGeometry)===null||_===void 0?void 0:_.call(o,void 0);for(const R of E)R&&R.userData&&R.userData.disposeOnIdle!==!1&&R.dispose();T&&T.userData&&T.userData.disposeOnIdle!==!1&&T.dispose(),(A=o.setMaterial)===null||A===void 0||A.call(o,E),(x=o.setGeometry)===null||x===void 0||x.call(o,T)})),a.uiConfig||a.assetType!=="model"&&a.assetType!=="camera"||(uh(a),r.push(()=>{})),a.addEventListener("objectUpdate",({refreshUi:g})=>{var _,A;return g!==!1&&((A=(_=a.uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||A===void 0?void 0:A.call(_,"postFrame",!0,1))}),a.userData.__autoParentDispatchEvents?console.warn("WebGi: object.userData.__autoParentDispatchEvents already set"):(a.userData.__autoParentDispatchEvents=a.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],a.isCamera&&a.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(a.userData.parentRoot=e);const l=a.dispatchEvent;a.dispatchEvent=g=>{var _;!((_=a.userData.__autoParentDispatchEvents)===null||_===void 0)&&_.includes(g.type)&&(g.parentDispatch=!0),g.parentDispatch&&(A=>{var x;const E=(x=a.userData.parentRoot)!==null&&x!==void 0?x:a.parent;E!=null&&E.modelObject&&E.dispatchEvent(A)})(g),l.call(a,g)};const u=a.clone;a.clone=(...g)=>{const _=a.userData;a.userData={};let A=u.call(a,...g);a.userData=_,ms(A.userData,_);const x=a.userData.parentRoot;return x&&x.assetType!=="model"&&console.warn("WebGi: Cloning an object with a parent that is not an IModel is not supported"),A=fo(A,x,t),A.userData.cloneParent=a.uuid,A};const h=a.copy;a.copy=(g,..._)=>{const A=g.userData;g.userData={};const x=h.call(a,g,..._);return g.userData=A,ms(a.userData,g),x};const f=a.add;return a.add=(...g)=>(g.forEach(_=>fo(_,a.userData.parentRoot||a,t)),f.call(a,...g)),(a=(i=t==null?void 0:t(a))!==null&&i!==void 0?i:a).addEventListener("dispose",()=>{r.forEach(g=>g()),r=[]}),[...a.children].forEach(g=>fo(g,a,t)),a}function _l(a,e){var t,i,r,s,o;const l=(Array.isArray(e)?e:[e]).map(f=>f==null?void 0:f.materialObject).filter(f=>f);if(a.material==l||l.length===1&&a.material===l[0])return[];a.userData.__materialUpdater||(a.userData.__materialUpdater=()=>{a.dispatchEvent({type:"materialUpdate"})}),a.userData.__textureUpdater||(a.userData.__textureUpdater=()=>{a.dispatchEvent({type:"textureUpdate"})});const u=Array.isArray(a.material)?[...a.material]:[a.material];for(const f of u)f&&(f.removeEventListener("materialUpdate",a.userData.__materialUpdater),f.removeEventListener("textureUpdate",a.userData.__textureUpdater),(i=(t=f.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||i===void 0||i.delete(a));const h=[];for(const f of l)f.userData.__appliedMeshes||(f.userData.__appliedMeshes=new Set),h.push(f),f&&(f.addEventListener("materialUpdate",a.userData.__materialUpdater),f.addEventListener("textureUpdate",a.userData.__textureUpdater),f.userData.__appliedMeshes.add(a));return a.material=h.length!==1?h:(r=h[0])!==null&&r!==void 0?r:void 0,a.dispatchEvent({type:"materialChanged",material:e,mesh:a}),(o=(s=a.uiConfig)===null||s===void 0?void 0:s.uiRefresh)===null||o===void 0||o.call(s,"postFrame",!0),u}function Jp(a,e,t=!1){var i,r,s,o,l,u,h;a.userData.__objectUpdater||(a.userData.__objectUpdater=_=>{a.dispatchEvent({..._,type:"objectUpdate"})});let f=a.geometry;const g=f;return(f!==e||t)&&(f&&(f.removeEventListener("geometryUpdate",a.userData.__objectUpdater),(r=(i=f.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||r===void 0||r.delete(a)),f=e,f&&!f.userData.__appliedMeshes&&(f.userData.__appliedMeshes=new Set),a.geometry=(s=f)!==null&&s!==void 0?s:void 0,f&&(a.updateMorphTargets(),f.addEventListener("geometryUpdate",a.userData.__objectUpdater),(l=(o=f.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||l===void 0||l.add(a))),e&&!e.uiConfig&&(e.uiConfig=function(_){return{label:"Geometry",type:"folder",children:[{type:"input",property:[_,"uuid"],disabled:!0},{type:"input",property:[_,"name"]},{type:"button",label:"Center Geometry",value:()=>{_.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const A=new p.Pa4;_.center(A),A.negate();const x=_.userData.__appliedMeshes;for(const E of x)E.updateMatrix(),E.position.copy(A).applyMatrix4(E.matrix),E.setDirty&&E.setDirty()}},{type:"button",label:"Compute vertex normals",value:()=>{_.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{_.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{_.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!_.index,value:()=>{var A;if(_.attributes.index)return;const x=parseFloat((A=prompt("Tolerance","-1"))!==null&&A!==void 0?A:"-1");rr(_,x)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!_.index,value:()=>{_.attributes.index&&_.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{_.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||_.setAttribute("uv1",_.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!_.hasAttribute("color"),value:()=>{_.hasAttribute("color")?confirm("Remove color attribute?")&&_.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!_.userData.__appliedMeshes||_.userData.__appliedMeshes.size<2,value:()=>{xd(_)}},{type:"input",label:"Mesh count",get value(){var A,x,E;return(E=(x=(A=_.userData)===null||A===void 0?void 0:A.__appliedMeshes)===null||x===void 0?void 0:x.size)!==null&&E!==void 0?E:0},set value(A){},disabled:!0}]}}(a.geometry)),a.dispatchEvent({type:"geometryChanged",geometry:e}),(h=(u=a.uiConfig)===null||u===void 0?void 0:u.uiRefresh)===null||h===void 0||h.call(u,"postFrame",!0),g===f?void 0:g||void 0}const yl=["appliedMeshes"],$p=["parentRoot","iCamera","iModel"];function ms(a,e){if(e)for(const t of Object.keys(e))$p.includes(t)||t.startsWith("__")||typeof a[t]!="function"&&typeof e[t]!="function"&&(a[t]=e[t]);return a}var hu,vm=new Uint8Array(16);function Fo(){if(!hu&&!(hu=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return hu(vm)}for(var bl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,sn=[],hh=0;hh<256;++hh)sn.push((hh+256).toString(16).substr(1));var ef=function(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(sn[a[e+0]]+sn[a[e+1]]+sn[a[e+2]]+sn[a[e+3]]+"-"+sn[a[e+4]]+sn[a[e+5]]+"-"+sn[a[e+6]]+sn[a[e+7]]+"-"+sn[a[e+8]]+sn[a[e+9]]+"-"+sn[a[e+10]]+sn[a[e+11]]+sn[a[e+12]]+sn[a[e+13]]+sn[a[e+14]]+sn[a[e+15]]).toLowerCase();if(!function(i){return typeof i=="string"&&bl.test(i)}(t))throw TypeError("Stringified UUID is invalid");return t},Wn=function(a,e,t){var i=(a=a||{}).random||(a.rng||Fo)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){t=t||0;for(var r=0;r<16;++r)e[t+r]=i[r];return e}return ef(i)};const dh=new Map;function en(a,e){return(t,i)=>{const r=t.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");dh.has(r)||dh.set(r,[]);const s=dh.get(r);if(!(s.findIndex(o=>o.propKey===i)<0))throw new Error(`Property ${i} already has a uiConfig decorator`);s.push({params:e||{},propKey:i,uiType:a})}}function Ot(a,e){return en("checkbox",{label:a,params:e})}function ql(a,e){return en("monitor",{label:a,params:e})}function ai(a,e,t,i){return en("slider",{label:a,bounds:e,stepSize:t,params:i})}function Mn(a,e,t,i){return en("vec",{label:a,bounds:e,stepSize:t,params:i})}function Fs(a,e,t){return en("dropdown",{label:a,children:e,params:t})}function Xi(a,e){return en("button",{label:a,params:e})}function Ci(a,e){return en("input",{label:a,params:e})}function ea(a,e){return en("color",{label:a,params:e})}function du(a,e){return en("image",{label:a,params:e})}function Qa(a){let e=a==null?void 0:a.constructor;if(!a||!e)return[];const t=[],i=[];for(;e&&e!==Object;)i.push(e),e=Object.getPrototypeOf(e);if(!i.length||Array.isArray(a)){const r=typeof a=="object"?Object.keys(a):Array.isArray(a)?a.map((s,o)=>o):[];for(const s of r){const o=a[s];if(o==null)continue;const l=o==null?void 0:o.uiConfig;if(l)t.push(l);else{const u=Ed(o);u==="folder"?t.push(Wa(s+"",o,void 0,"folder",!0)):u&&t.push({type:u,label:s+"",property:[a,s]})}}}return i.reverse().forEach(r=>{var s;(s=dh.get(r))===null||s===void 0||s.forEach(({params:o,propKey:l,uiType:u})=>{let h;if(!u){const f=a[l];h=f==null?void 0:f.uiConfig,h?t.push(h):f!=null&&((u=Ed(f))==="folder"?h=Wa(l+"",f,void 0,"folder",!0):u&&(h={type:u,label:l+"",property:[a,l]}))}if(h||(h={property:[a,l],type:u||"input"}),o){const f=typeof o.params=="function"?o.params(a):o.params||{};delete o.params,Object.assign(h,{...o,...f})}t.push(h)})}),t}function Wa(a,e,t={},i="folder",r=!1){return{type:i,label:a,children:r?[()=>Qa(e)]:Qa(e),uuid:Wn(),...t}}function zi(a,e,t="folder"){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=Wa(a,this,e||{},t)}}}function Lc(a,e){return zi(a,e,"panel")}function Ed(a){return a==null?null:Array.isArray(a)?"folder":typeof a=="boolean"?"checkbox":typeof a=="number"?"number":typeof a=="string"?"input":typeof a=="function"?"button":typeof a.x=="number"?"vec":typeof a.r=="number"?"color":a.isTexture?"image":typeof a=="object"?"folder":null}const Sd={type:"change"},Cd={type:"start"},tf={type:"end"};class _m extends p.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new p.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new p.Pa4(1/0,1/0,1/0),this.clampMin=new p.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:p.RsA.ROTATE,MIDDLE:p.RsA.DOLLY,RIGHT:p.RsA.PAN},this.touches={ONE:p.QmN.ROTATE,TWO:p.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(wt){wt.addEventListener("keydown",Ai),this._domElementKeyEvents=wt},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ai),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Sd),i.update(),s=r.NONE},this.update=function(){const wt=new p.Pa4,yt=new p._fP().setFromUnitVectors(e.up,new p.Pa4(0,1,0)),li=yt.clone().invert(),ar=new p.Pa4,ge=new p._fP,je=new p.Pa4,nt=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const St=i.object.position;wt.copy(St).sub(i.target),wt.applyQuaternion(yt),l.setFromVector3(wt),i.autoRotate&&s===r.NONE&&X(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(l.theta+=u.theta*i.dampingFactor,l.phi+=u.phi*i.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);let bt=i.minAzimuthAngle,Ae=i.maxAzimuthAngle;isFinite(bt)&&isFinite(Ae)&&(bt<-Math.PI?bt+=nt:bt>Math.PI&&(bt-=nt),Ae<-Math.PI?Ae+=nt:Ae>Math.PI&&(Ae-=nt),l.theta=bt<=Ae?Math.max(bt,Math.min(Ae,l.theta)):l.theta>(bt+Ae)/2?Math.max(bt,l.theta):Math.min(Ae,l.theta)),l.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,l.phi)),l.makeSafe(),Math.abs(u.radius)>0&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*(1+u.radius*(i.enableDamping?i.dampingFactor:1)))),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(u.radius=0)),l.radius*=1+u.radius*(i.enableDamping?i.dampingFactor:1)),Math.abs(h-1)>1e-5&&(i.dollyZoom&&(i.object.zoom=Math.max(Math.max(i.minZoom,.1),Math.min(Math.min(i.maxZoom,20),i.object.zoom*h)),i.object.updateProjectionMatrix(),(i.object.zoom>=Math.min(i.maxZoom,20)||i.object.zoom<=Math.max(i.minZoom,.1))&&(h=1)),l.radius*=h);let st=0;i.autoPushTarget&&l.radius<i.minDistance&&(st=i.minDistance-l.radius),i.autoPullTarget&&l.radius>i.maxDistance&&(st=i.maxDistance-l.radius),l.radius=Math.max(i.minDistance,Math.min(i.maxDistance,l.radius)),i.enableDamping===!0?i.target.addScaledVector(f,i.dampingFactor):i.target.add(f),wt.setFromSpherical(l),wt.applyQuaternion(li),St.copy(i.target).add(wt),i.target.add(wt.normalize().multiplyScalar(-st)),St.clamp(i.clampMin,i.clampMax),i.target.clamp(i.clampMin,i.clampMax),i.object.lookAt(i.target);let zt=!1;return i.enableDamping===!0&&Math.abs(u.theta)+Math.abs(u.phi)+Math.abs(u.radius)+f.length()>.001?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,u.radius*=1-i.dampingFactor,f.multiplyScalar(1-i.dampingFactor),zt=!0):(u.set(0,0,0),f.set(0,0,0)),h=1,!!(g||zt||ar.distanceToSquared(i.object.position)>o||8*(1-ge.dot(i.object.quaternion))>o||je.distanceToSquared(i.target)>0)&&(i.dispatchEvent(Sd),ar.copy(i.object.position),ge.copy(i.object.quaternion),je.copy(i.target),g=!1,!0)}}(),this.stopDamping=function(){u.set(0,0,0),f.set(0,0,0)},this.dispose=function(){i.domElement.removeEventListener("contextmenu",Wi),i.domElement.removeEventListener("pointerdown",Tt),i.domElement.removeEventListener("pointercancel",Zt),i.domElement.removeEventListener("wheel",di),i.domElement.removeEventListener("pointermove",Xe),i.domElement.removeEventListener("pointerup",Zt),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Ai),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,l=new p.$V,u=new p.$V(0,0,0);let h=1;const f=new p.Pa4;let g=!1;const _=new p.FM8,A=new p.FM8,x=new p.FM8,E=new p.FM8,T=new p.FM8,R=new p.FM8,I=new p.FM8,S=new p.FM8,O=new p.FM8,k=[],N={};function H(){return i.enableDamping?1:Math.pow(.95,i.zoomSpeed)}function X(wt){u.theta-=wt}function te(wt){u.phi-=wt}this.rotateUp=te,this.rotateLeft=X;const re=function(){const wt=new p.Pa4;return function(yt,li){wt.setFromMatrixColumn(li,0),wt.multiplyScalar(-yt),f.add(wt)}}(),ue=function(){const wt=new p.Pa4;return function(yt,li){i.screenSpacePanning===!0?wt.setFromMatrixColumn(li,1):(wt.setFromMatrixColumn(li,0),wt.crossVectors(i.object.up,wt)),wt.multiplyScalar(yt),f.add(wt)}}(),le=function(){const wt=new p.Pa4;return function(yt,li){const ar=i.domElement;if(i.object.isPerspectiveCamera){const ge=i.object.position;wt.copy(ge).sub(i.target);let je=wt.length();je*=Math.tan(i.object.fov/2*Math.PI/180),re(2*yt*je/ar.clientHeight,i.object.matrix),ue(2*li*je/ar.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(re(yt*(i.object.right-i.object.left)/i.object.zoom/ar.clientWidth,i.object.matrix),ue(li*(i.object.top-i.object.bottom)/i.object.zoom/ar.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function se(wt,yt=0){i.object.isPerspectiveCamera?(h/=wt,u.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,u.radius-yt))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*wt)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function de(wt,yt=0){i.object.isPerspectiveCamera?(h*=wt,u.radius=Math.max(-i.maxZoomSpeed,Math.min(i.maxZoomSpeed,u.radius+yt))):i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/wt)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ve(wt){_.set(wt.clientX,wt.clientY)}function fe(wt){E.set(wt.clientX,wt.clientY)}function Ee(){if(k.length===1)_.set(k[0].pageX,k[0].pageY);else{const wt=.5*(k[0].pageX+k[1].pageX),yt=.5*(k[0].pageY+k[1].pageY);_.set(wt,yt)}}function Je(){if(k.length===1)E.set(k[0].pageX,k[0].pageY);else{const wt=.5*(k[0].pageX+k[1].pageX),yt=.5*(k[0].pageY+k[1].pageY);E.set(wt,yt)}}function Te(){const wt=k[0].pageX-k[1].pageX,yt=k[0].pageY-k[1].pageY,li=Math.sqrt(wt*wt+yt*yt);I.set(0,li)}function qe(wt){if(k.length==1)A.set(wt.pageX,wt.pageY);else{const li=Ui(wt),ar=.5*(wt.pageX+li.x),ge=.5*(wt.pageY+li.y);A.set(ar,ge)}x.subVectors(A,_).multiplyScalar(i.rotateSpeed);const yt=i.domElement;X(2*Math.PI*x.x/yt.clientHeight),te(2*Math.PI*x.y/yt.clientHeight),_.copy(A)}function Ve(wt){if(k.length===1)T.set(wt.pageX,wt.pageY);else{const yt=Ui(wt),li=.5*(wt.pageX+yt.x),ar=.5*(wt.pageY+yt.y);T.set(li,ar)}R.subVectors(T,E).multiplyScalar(i.panSpeed),le(R.x,R.y),E.copy(T)}function Ye(wt){const yt=Ui(wt),li=wt.pageX-yt.x,ar=wt.pageY-yt.y,ge=Math.sqrt(li*li+ar*ar);S.set(0,ge),O.set(0,Math.pow(S.y/I.y,6*i.zoomSpeed)),se(O.y),I.copy(S)}function Tt(wt){i.enabled!==!1&&(k.length===0&&(i.domElement.setPointerCapture(wt.pointerId),i.domElement.addEventListener("pointermove",Xe),i.domElement.addEventListener("pointerup",Zt)),function(yt){k.push(yt)}(wt),wt.pointerType==="touch"?function(yt){switch(Gi(yt),k.length){case 1:switch(i.touches.ONE){case p.QmN.ROTATE:if(i.enableRotate===!1)return;Ee(),s=r.TOUCH_ROTATE;break;case p.QmN.PAN:if(i.enablePan===!1)return;Je(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case p.QmN.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;i.enableZoom&&Te(),i.enablePan&&Je(),s=r.TOUCH_DOLLY_PAN;break;case p.QmN.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;i.enableZoom&&Te(),i.enableRotate&&Ee(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(Cd)}(wt):function(yt){let li;switch(yt.button){case 0:li=i.mouseButtons.LEFT;break;case 1:li=i.mouseButtons.MIDDLE;break;case 2:li=i.mouseButtons.RIGHT;break;default:li=-1}switch(li){case p.RsA.DOLLY:if(i.enableZoom===!1)return;(function(ar){I.set(ar.clientX,ar.clientY)})(yt),s=r.DOLLY;break;case p.RsA.ROTATE:if(yt.ctrlKey||yt.metaKey||yt.shiftKey){if(i.enablePan===!1)return;fe(yt),s=r.PAN}else{if(i.enableRotate===!1)return;ve(yt),s=r.ROTATE}break;case p.RsA.PAN:if(yt.ctrlKey||yt.metaKey||yt.shiftKey){if(i.enableRotate===!1)return;ve(yt),s=r.ROTATE}else{if(i.enablePan===!1)return;fe(yt),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(Cd)}(wt))}function Xe(wt){i.enabled!==!1&&(wt.pointerType==="touch"?function(yt){switch(Gi(yt),s){case r.TOUCH_ROTATE:if(i.enableRotate===!1)return;qe(yt),i.update();break;case r.TOUCH_PAN:if(i.enablePan===!1)return;Ve(yt),i.update();break;case r.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;(function(li){i.enableZoom&&Ye(li),i.enablePan&&Ve(li)})(yt),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;(function(li){i.enableZoom&&Ye(li),i.enableRotate&&qe(li)})(yt),i.update();break;default:s=r.NONE}}(wt):wt.buttons?function(yt){switch(s){case r.ROTATE:if(i.enableRotate===!1)return;(function(li){A.set(li.clientX,li.clientY),x.subVectors(A,_).multiplyScalar(i.rotateSpeed);const ar=i.domElement;X(2*Math.PI*x.x/ar.clientHeight),te(2*Math.PI*x.y/ar.clientHeight),_.copy(A),i.update()})(yt);break;case r.DOLLY:if(i.enableZoom===!1)return;(function(li){S.set(li.clientX,li.clientY),O.subVectors(S,I),O.y>0?se(H()):O.y<0&&de(H()),I.copy(S),i.update()})(yt);break;case r.PAN:if(i.enablePan===!1)return;(function(li){T.set(li.clientX,li.clientY),R.subVectors(T,E).multiplyScalar(i.panSpeed),le(R.x,R.y),E.copy(T),i.update()})(yt)}}(wt):Zt(wt))}function Zt(wt){(function(yt){delete N[yt.pointerId];for(let li=0;li<k.length;li++)if(k[li].pointerId==yt.pointerId)return void k.splice(li,1)})(wt),k.length===0&&(i.domElement.releasePointerCapture(wt.pointerId),i.domElement.removeEventListener("pointermove",Xe),i.domElement.removeEventListener("pointerup",Zt)),i.dispatchEvent(tf),s=r.NONE}function di(wt){i.enabled!==!1&&i.enableZoom!==!1&&s===r.NONE&&(wt.preventDefault(),i.dispatchEvent(Cd),function(yt){let li=0;switch(yt.deltaMode){case 2:li+=1*yt.deltaY;break;case 1:li+=.4*yt.deltaY;break;default:li+=.01*yt.deltaY}yt.deltaY<0?de(1,li*i.zoomSpeed):yt.deltaY>0&&se(1,-li*i.zoomSpeed),i.update()}(wt),i.dispatchEvent(tf))}function Ai(wt){i.enabled!==!1&&i.enablePan!==!1&&function(yt){let li=!1;switch(yt.code){case i.keys.UP:yt.ctrlKey||yt.metaKey||yt.shiftKey?te(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):le(0,i.keyPanSpeed),li=!0;break;case i.keys.BOTTOM:yt.ctrlKey||yt.metaKey||yt.shiftKey?te(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):le(0,-i.keyPanSpeed),li=!0;break;case i.keys.LEFT:yt.ctrlKey||yt.metaKey||yt.shiftKey?X(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):le(i.keyPanSpeed,0),li=!0;break;case i.keys.RIGHT:yt.ctrlKey||yt.metaKey||yt.shiftKey?X(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):le(-i.keyPanSpeed,0),li=!0}li&&(yt.preventDefault(),i.update())}(wt)}function Wi(wt){i.enabled!==!1&&wt.preventDefault()}function Gi(wt){let yt=N[wt.pointerId];yt===void 0&&(yt=new p.FM8,N[wt.pointerId]=yt),yt.set(wt.pageX,wt.pageY)}function Ui(wt){const yt=wt.pointerId===k[0].pointerId?k[1]:k[0];return N[yt.pointerId]}this.zoomIn=function(wt){se(1,wt*i.zoomSpeed)},this.zoomOut=function(wt){de(1,wt*i.zoomSpeed)},i.domElement.addEventListener("contextmenu",Wi),i.domElement.addEventListener("pointerdown",Tt),i.domElement.addEventListener("pointercancel",Zt),i.domElement.addEventListener("wheel",di,{passive:!1}),this.update()}}var Br=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let gr=class extends _m{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new p.Pa4(-1e4,-1e4,-1e4),this.clampMax=new p.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(a){super.zoomIn(a)}zoomOut(a){super.zoomOut(a)}dispatchEvent(a){super.dispatchEvent(a)}};Br([ae()],gr.prototype,"type",void 0),Br([Ot()],gr.prototype,"enabled",void 0),Br([Ot(),ae()],gr.prototype,"dollyZoom",void 0),Br([Ot(),ae()],gr.prototype,"enableDamping",void 0),Br([Ci(),ae()],gr.prototype,"dampingFactor",void 0),Br([Ot(),ae()],gr.prototype,"autoRotate",void 0),Br([Ci(),ae()],gr.prototype,"autoRotateSpeed",void 0),Br([Ot(),ae()],gr.prototype,"enableZoom",void 0),Br([Ci(),ae()],gr.prototype,"zoomSpeed",void 0),Br([Ci(),ae()],gr.prototype,"maxZoomSpeed",void 0),Br([Ot(),ae()],gr.prototype,"enableRotate",void 0),Br([Ci(),ae()],gr.prototype,"rotateSpeed",void 0),Br([Ot(),ae()],gr.prototype,"enablePan",void 0),Br([Ci(),ae()],gr.prototype,"panSpeed",void 0),Br([Ci(),ae()],gr.prototype,"autoPushTarget",void 0),Br([Ci(),ae()],gr.prototype,"autoPullTarget",void 0),Br([Ci(),ae()],gr.prototype,"minDistance",void 0),Br([Ci(),ae()],gr.prototype,"maxDistance",void 0),Br([Ci(),ae()],gr.prototype,"minZoom",void 0),Br([Ci(),ae()],gr.prototype,"maxZoom",void 0),Br([Ci(),ae()],gr.prototype,"minPolarAngle",void 0),Br([Ci(),ae()],gr.prototype,"maxPolarAngle",void 0),Br([Ci(),ae()],gr.prototype,"minAzimuthAngle",void 0),Br([Ci(),ae()],gr.prototype,"maxAzimuthAngle",void 0),Br([Mn(),ae()],gr.prototype,"clampMin",void 0),Br([Mn(),ae()],gr.prototype,"clampMax",void 0),Br([ae()],gr.prototype,"screenSpacePanning",void 0),Br([ae()],gr.prototype,"keyPanSpeed",void 0),gr=Br([Lc("Orbit Controls")],gr);var Xa=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Cs extends V.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(e){this._camera.modelObject.userData=e}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var i,r;const s={...e};!((i=s.position)===null||i===void 0)&&i.isVector3&&(s.position=[s.position.x,s.position.y,s.position.z]),!((r=s.target)===null||r===void 0)&&r.isVector3&&(s.target=[s.target.x,s.target.y,s.target.z]),Object.keys(s).forEach(o=>o!=="frustumSize"&&s[o]===void 0&&delete s[o]),Object.assign(this._options,s),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty({optionsUpdate:!0})}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const r=this._options.type==="PerspectiveCamera"?new p.cPb:new p.iKG;r.name=this._camera.name,r.near=this._camera.modelObject.near,r.far=this._camera.modelObject.far,r.zoom=this._camera.modelObject.zoom,r.scale.copy(this._camera.modelObject.scale);const s=this._isActiveCamera;s&&this.deactivateMain(),this._camera=this._setCameraObject(r),t=this._camera.modelObject,s&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let i=this._options.aspect;if(i==="auto"&&(i=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=i),this._options.type==="OrthographicCamera"){const r=this._options.frustumSize;r!==void 0?(t.top=r/2,t.bottom=-r/2,t.left=i*r/2,t.right=-i*r/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=fo(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsDisabledBy.size===0&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this.setInteractions(e,"_default")}setInteractions(e,t){const i=this._interactionsDisabledBy.size;e?this._interactionsDisabledBy.delete(t):this._interactionsDisabledBy.add(t),i!==this._interactionsDisabledBy.size&&this.refreshCameraControls(!0)}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,i){var r;super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=l=>{this.setDirty(l)},this._interactionsDisabledBy=new Set,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new p.Pa4(0,0,10),this._target=new p.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(l,u)=>{const h=new gr(l,u.ownerDocument?u:u.documentElement);return h.screenSpacePanning=!0,h}]]),this._positionWorld=new p.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>{var l;return(l=this._camera.userData.autoNearFar)===null||l===void 0||l},setValue:l=>this._camera.userData.autoNearFar=l,onChange:()=>this.setDirty()},{type:"checkbox",label:"Auto Camera Position",getValue:()=>{var l;return(l=this._camera.userData.autoCameraPosition)!==null&&l!==void 0&&l},setValue:l=>this._camera.userData.autoCameraPosition=l,onChange:()=>this.setDirty()},{type:"input",label:()=>{var l;return(l=this._camera.userData.autoNearFar)===null||l===void 0||l?"Min Near":"Near"},getValue:()=>{var l;return(l=this._camera.userData.minNearPlane)!==null&&l!==void 0?l:.5},setValue:l=>this._camera.userData.minNearPlane=l,onChange:()=>this.setDirty()},{type:"input",label:()=>{var l;return(l=this._camera.userData.autoNearFar)===null||l===void 0||l?"Max Far":"Far"},getValue:()=>{var l;return(l=this._camera.userData.maxFarPlane)!==null&&l!==void 0?l:1e3},setValue:l=>this._camera.userData.maxFarPlane=l,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(l=>({label:l===""?"none":l,value:l})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var l;return!((l=this._controls)===null||l===void 0)&&l.zoomIn?{type:"button",label:"Zoom in",value:()=>{var u;(u=this._controls)===null||u===void 0||u.zoomIn(1)}}:{}},()=>{var l;return!((l=this._controls)===null||l===void 0)&&l.zoomOut?{type:"button",label:"Zoom out",value:()=>{var u;(u=this._controls)===null||u===void 0||u.zoomOut(1)}}:{}},()=>{var l;return(l=this._controls)===null||l===void 0?void 0:l.uiConfig}]},this.assetType="model",this.uuid=p.M8C.generateUUID(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=i??document.body;const s=(r={...t})!==null&&r!==void 0?r:this._options;this._camera=this._setCameraObject(e??(s.type==="OrthographicCamera"?new p.iKG(-1,1,1,-1):new p.cPb)),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(s.fov=o.fov,s.focus=o.focus,s.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,s.zoom=o.zoom):o.isOrthographicCamera&&(s.left=o.left,s.right=o.right,s.top=o.top,s.bottom=o.bottom,s.zoom=o.zoom),this.near=o.near,this.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(s)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;!((t=this._controls)===null||t===void 0)&&t.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new p.Pa4))}setControlsCtor(e,t,i=!1){i||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t,i;const r=this._options.controlsMode;this._controls=(t=(e=this._controlsCtors.get(r))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&t!==void 0?t:void 0,this._controls||r===""||console.error("Unable to create controls with mode "+r+". Are you missing a plugin?"),(i=this._controls)===null||i===void 0||i.addEventListener("change",this.setDirty),this._controlsMode=this._controls?r:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(t=this._controls)===null||t===void 0||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,i;if(this._options.controlsEnabled){const r=this._options.controlsMode;this._controls?this._controlsMode===r&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=r}if(this._controls){const r=this.interactionsEnabled;this._controls.enabled=r,r&&this._camera.modelObject.up.copy(p.Tme.DEFAULT_UP)}e&&this.setDirty(),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}setDirty(e){var t,i;this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),(i=(t=this.cameraObject).updateProjectionMatrix)===null||i===void 0||i.call(t),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(r=>{var s;return(s=r==null?void 0:r.uiRefresh)===null||s===void 0?void 0:s.call(r,"postFrame",!1,1)})}activateMain(e=!0){var t,i;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new p.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(i=(t=this._camera).setDirty)===null||i===void 0||i.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,i;const r=this.target;(i=(t=this._controls)===null||t===void 0?void 0:t.target)===null||i===void 0||i.set(r.x,r.y,r.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(r),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,i,r,s;return(i=(t=e.uniforms.cameraPositionWorld)===null||t===void 0?void 0:t.value)===null||i===void 0||i.copy(this._positionWorld),(s=(r=e.uniforms.cameraNearFar)===null||r===void 0?void 0:r.value)===null||s===void 0||s.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){const t={};return ms(t,this.userData),Object.assign({userData:t},cr(this,!0,e))}fromJSON(e,t){return e.userData&&(ms(this.userData,e.userData),delete(e={...e}).userData),e.camOptions&&(this.setCameraOptions(e.camOptions,!1),this.refreshCameraOptions(!1)),br(e,this,!0,t),this.positionUpdated(!1),this.refreshCameraOptions(!1),this.setDirty({change:"deserialize"}),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Xa([ae("camControls")],Cs.prototype,"_controls",void 0),Xa([(0,V.onChange)(Cs.prototype._nearFarChanged)],Cs.prototype,"near",void 0),Xa([(0,V.onChange)(Cs.prototype._nearFarChanged)],Cs.prototype,"far",void 0),Xa([ae("camOptions")],Cs.prototype,"_options",void 0),Xa([ae("position")],Cs.prototype,"_position",void 0),Xa([ae("target")],Cs.prototype,"_target",void 0);var jo=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Xn extends p.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let i=this._cameras.indexOf(e);i<0&&(this._cameras.push(e),i=this._cameras.length-1),this._activeCamera=i}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get renderCamera(){var e;return(e=this._renderCamera)!==null&&e!==void 0?e:this.activeCamera}set renderCamera(e){const t=this._renderCamera;this._renderCamera=e,this.dispatchEvent({type:"renderCameraChange",lastCamera:t,camera:e})}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Re,this._modelBounds=new Re,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new Cs(new p.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.textureSlots={},this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._optionsUpdate=this._optionsUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=fo(new p.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new p.GQ(this.getBounds())}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const i=e.assetType;let r=!1;switch(i){case"model":r=e.modelObject.isCamera,r&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("WebGi RootScene: Unknown asset imported",e,i)}return this.dispatchEvent({type:"addSceneObject",object:e,options:t}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:i=2,addToRoot:r=!1}={}){const s=e;s?(t&&!s.userData.autoScaled&&mi(s,s.userData.autoScaleRadius||i),s.traverse(o=>{o.isMesh&&!o.userData.__keepShadowDef&&(o.castShadow=!0,o.receiveShadow=!0,o.userData.__keepShadowDef=!0)}),r?this.modelObject.add(s):this.modelRoot.add(s),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var t,i;((t=e.dispose)!==null&&t!==void 0?t:(i=e.modelObject)===null||i===void 0?void 0:i.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)===null||e===void 0?void 0:e.mapping)===p.xfE&&(this.environment.mapping=p.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(t=>fo(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")t=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);t=new p.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new p.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate||e!=null&&e.refreshScene?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(e){e.optionsUpdate&&this._optionsUpdate(e),this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({...e,type:"activeCameraUpdate"})}_optionsUpdate(e){if(!this.activeCamera.userData.autoCameraPosition)return;const t=new Re().expandByObject(this.modelRoot.modelObject,!1,!0),i=(t.getCenter(new p.Pa4),t.getSize(new p.Pa4));let r=this.activeCamera.cameraObject,s=1;if(r.isPerspectiveCamera){const u=Math.max(1,r.fov)*(Math.PI/180),h=2*Math.atan(Math.tan(u/2)*r.aspect),f=i.z/2+Math.abs(i.x/2/Math.tan(h/2)),g=i.z/2+Math.abs(i.y/2/Math.tan(u/2));s=1.5*Math.max(f,g)}const o=this.activeCamera.target,l=new p.Pa4().subVectors(o,r.position).normalize();this.activeCamera.position=l.multiplyScalar(-s).add(o)}_onSceneUpdate(e={}){var t,i,r,s;return e.sceneUpdate===!1&&e.refreshScene===!1||!((t=e.object)===null||t===void 0)&&t.isCamera?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(s=(r=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||r===void 0?void 0:r.copy)===null||s===void 0||s.call(r,this._sceneBounds),this._modelBounds=this.getModelBounds(!1,!0),this._sceneBoundingRadius=this._modelBounds.getSize(new p.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)===null||e===void 0||e.dispose()}findObjectsByName(e,t){const i=[];return(t??this.modelObject).traverse(r=>{r.name===e&&i.push(r)}),i}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var i;const r=e.lightObject;r&&((i=r.children)===null||i===void 0||i.length,t?this.add(r):this.modelRoot.add(r))}getBounds(e=!1,t=!0,i=!0,r){return new Re().expandByObject(this.modelObject,e,t,s=>{var o;return!(!i||s.assetType!=="widget")||(o=r==null?void 0:r(s))!==null&&o!==void 0&&o})}getModelBounds(e=!1,t=!0,i=!0,r){return this.modelRoot==null?new Re:new Re().expandByObject(this.modelRoot,e,t,s=>{var o;return!(!i||s.assetType!=="widget")||(o=r==null?void 0:r(s))!==null&&o!==void 0&&o})}refreshActiveCameraNearFar(){var e,t,i,r;const s=this.activeCamera;if(!s)return;if(s.cameraObject.userData.autoNearFar===!1)return s.near=(e=s.cameraObject.userData.minNearPlane)!==null&&e!==void 0?e:.5,void(s.far=(t=s.cameraObject.userData.maxFarPlane)!==null&&t!==void 0?t:1e3);const o=this.getBounds(!1),l=s.cameraObject.getWorldPosition(new p.Pa4).sub(o.getCenter(new p.Pa4)),u=1.5*o.getSize(new p.Pa4).length()/2,h=Math.max(.1,-l.clone().normalize().dot(s.cameraObject.getWorldDirection(new p.Pa4))),f=l.length(),g=Math.max(Math.max((i=s.cameraObject.userData.minNearPlane)!==null&&i!==void 0?i:.5,.001),h*(f-u)),_=Math.min(Math.max(g+u,h*(f+u)),(r=s.cameraObject.userData.maxFarPlane)!==null&&r!==void 0?r:1e3);s.near=g,s.far=_}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return cr(this,!0,e)}fromJSON(e,t){const i=e.environment;return i!==void 0&&(this.setEnvironment(br(i,this.getEnvironment(),!1,t)),delete e.environment),br(e,this,!0,t),e.environment=i,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){var e;return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),(e=this.activeCamera.userData.minNearPlane)!==null&&e!==void 0?e:.5}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}jo([ae()],Xn.prototype,"defaultCamera",void 0),jo([(0,V.onChange2)(Xn.prototype.setDirty),ae()],Xn.prototype,"envMapIntensity",void 0),jo([(0,V.onChange2)(Xn.prototype.setDirty),ae()],Xn.prototype,"fixedEnvMapDirection",void 0),jo([(0,V.onChange2)(Xn.prototype.setDirty),ae()],Xn.prototype,"backgroundIntensity",void 0),jo([ae(),(0,V.onChange)(Xn.prototype._onEnvironmentChange.name)],Xn.prototype,"environment",void 0),jo([ae()],Xn.prototype,"textureSlots",void 0),jo([ae(),(0,V.onChange)(Xn.prototype._onBackgroundChange)],Xn.prototype,"background",void 0),jo([ae(),(0,V.onChange)(Xn.prototype._onBackgroundChange)],Xn.prototype,"backgroundColor",void 0);function Mi(a,e,t,{replaceAll:i=!1,prepend:r=!1,append:s=!1}={}){if(!a.includes(e))return console.error(`${e} not found in shader`),a;let o=t;return r?o=t+e:s&&(o=e+t),i?a.replaceAll(e,o):a.replace(e,o)}class es{static ApplyMaterialExtensions(e,t,i,r){for(const s of i)this.ApplyMaterialExtension(e,t,s,r)}static ApplyMaterialExtension(e,t,i,r){var s,o;let l=(s=(0,V.getOrCall)(i.parsFragmentSnippet,r,e))!==null&&s!==void 0?s:"";l.length&&(t.fragmentShader=Mi(t.fragmentShader,this.VoidMain,`
`+l+`
`,{prepend:!0})),l=(o=(0,V.getOrCall)(i.parsVertexSnippet,r,e))!==null&&o!==void 0?o:"",l.length&&(t.vertexShader=Mi(t.vertexShader,this.VoidMain,`
`+l+`
`,{prepend:!0})),i.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,i.extraUniforms)),i.extraDefines&&function(u,h){let f=!1;h.materialObject&&h.materialObject.defines===void 0&&(h.materialObject.defines={});const g=Object.entries(u);for(const[_,A]of g)A===void 0?h.materialObject.defines[_]!==void 0&&(delete h.materialObject.defines[_],f=!0):h.materialObject.defines[_]!==A&&(h.materialObject.defines[_]=A,f=!0);f&&(h.materialObject.needsUpdate=!0)}(i.extraDefines,e),i.shaderExtender&&i.shaderExtender(t,e,r),e.lastShader=t}static CacheKeyForExtensions(e,t){let i="";for(const r of t)i+=this.CacheKeyForExtension(e,r);return i}static CacheKeyForExtension(e,t){let i="";return t.customCacheKey&&(i+=t.customCacheKey),t.computeCacheKey&&(i+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach(r=>i+=r),i}static RegisterExtensions(e,t){const i=[];if(t)for(const r of t)r.isCompatible&&r.isCompatible(e)&&(i.push(r),r.uuid||(r.uuid=Wn()),r.__setDirty||(r.__setDirty=()=>{r.updateVersion||(r.updateVersion=0),r.updateVersion++}),r.setDirty||(r.setDirty=r.__setDirty));return e.materialExtensions=i,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",r=>function(s,{object:o,renderer:l}){var u;if(s.materialExtensions)for(const h of s.materialExtensions){if((u=h.onObjectRender)===null||u===void 0||u.call(h,o,s,l),s.lastShader){const f=(0,V.getOrCall)(h.updaters)||[];for(const g of f)g&&g.updateShaderProperties(s.lastShader)}h.updateVersion!==s.materialObject.userData["_"+h.uuid+"_version"]&&(s.materialObject.userData["_"+h.uuid+"_version"]=h.updateVersion,s.materialObject.needsUpdate=!0)}}(e,r))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",r=>function(s,{object:o,renderer:l}){var u;if(s.materialExtensions)for(const h of s.materialExtensions)(u=h.onAfterRender)===null||u===void 0||u.call(h,o,s,l)}(e,r))),i}}es.VoidMain="void main()";class kc extends p.jyz{constructor(e,t=!1){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=es.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...es.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){es.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+es.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,i,r,s){super.onBeforeRender(e,t,i,r,s),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}onAfterRender(e,t,i,r,s){super.onAfterRender(e,t,i,r,s),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class Yl extends kc{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class rf extends Yl{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:p.aCh})),this.setDirty())}_setUniformTexSize(e,t){var i,r,s,o;if(!t||!e)return;const l=(r=(i=t.image)===null||i===void 0?void 0:i.width)!==null&&r!==void 0?r:512,u=(o=(s=t.image)===null||s===void 0?void 0:s.height)!==null&&o!==void 0?o:512,h=e.value;h.isVector2||console.warn("uniform is not a Vector2"),h&&Math.abs(h.x-l)+Math.abs(h.y-u)>.1&&(h.x=l,h.y=u,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,i,r,s){var o,l;this._setUniformTexSize(this.uniforms.screenSize,(o=e.getRenderTarget())===null||o===void 0?void 0:o.texture);for(const u of this.textures){const h=u.id,f=(l=this.uniforms[h])===null||l===void 0?void 0:l.value;f&&(this._setUniformTexSize(this.uniforms[h+"Size"],f),f.colorSpace!==u.colorSpace&&(u.colorSpace=f.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,i,r,s)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(i=>{var r,s;return`uniform sampler2D ${i.id}; 
`+Bt((r=i.id)!==null&&r!==void 0?r:"input",(s=i.colorSpace)!==null&&s!==void 0?s:p.aCh)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function Kl(a,...e){const t=a.fragmentShader;return new rf({defines:Object.assign({},a.defines),uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:t},e)}class On extends it{constructor(e,...t){super(e.isMaterial?e:Kl(e,...t),t.length<1?On.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,i,r;(t=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||t===void 0||t.call(e),(r=(i=this.fsQuad)===null||i===void 0?void 0:i.dispose)===null||r===void 0||r.call(i),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,i,r,s){this.enabled&&super.render(e,t||null,i,r,s)}}On.DEFAULT_TEX_ID="tDiffuse",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([Ot("Enabled"),ae()],On.prototype,"enabled",void 0);class pu extends ct{constructor(e,t,i,r,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new p.Ilk}render(e,t,i,r,s,o){if(!this.scene||!this.camera)return;const l=e.autoClear;let u,h;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(h=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),u=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),o){const f=e.getContext();f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,o)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),o){const f=e.getContext();f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,u),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=h),e.autoClear=l}}class fu extends On{constructor(e,t="c = a + b;",i="",r){super({vertexShader:Ke.vertexShader,fragmentShader:V.glsl`
                varying vec2 vUv;
                
                ${i}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:r},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class nf extends Yl{constructor(e=!0){super({vertexShader:`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float getSSCurvature(in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-dx;vec3 xpos=n+dx;vec3 yneg=n-dy;vec3 ypos=n+dy;float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x);return curvature;}void main(){
#glMarker mainStart
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.);
#include <map_fragment>
#ifdef USE_ALPHAMAP
float alphaMapValue=
#ifdef ALPHA_I_RGBA_PACKING
1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));
#else
texture2D(alphaMap,vAlphaMapUv).g;
#endif
#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
diffuseColor.a*=1.-alphaMapValue;
#else
diffuseColor.a*=alphaMapValue;
#endif
#endif
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;B.x=getSSCurvature(normal)*0.5+0.5;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:p.rDY.merge([p.rBU.common,p.rBU.bumpmap,p.rBU.normalmap,p.rBU.displacementmap,{cameraNearFar:{value:new p.FM8(.1,1e3)},flags:{value:new p.Ltg(255,255,255,255)}}]),defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?p.LSk:p.v9Y}),this.normalMapType=p.IOt,this.flatShading=!1,this._updaters=[]}onBeforeRender(e,t,i,r,s){var o,l,u,h,f,g,_,A,x,E,T,R,I;super.onBeforeRender(e,t,i,r,s);let S=s.material;Array.isArray(S)&&(S=S[0]),this.uniforms.map.value=(o=S==null?void 0:S.map)!==null&&o!==void 0?o:null,this.uniforms.map.value&&e.materials.refreshTransformUniform(this.uniforms.map.value,this.uniforms.mapTransform),this.uniforms.alphaMap.value=(l=S==null?void 0:S.alphaMap)!==null&&l!==void 0?l:null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.alphaTest=!S||!S.alphaTest||S.alphaTest<1e-7?.001:S.alphaTest,this.uniforms.alphaTest.value=this.alphaTest,this.uniforms.displacementMap.value=(u=S==null?void 0:S.displacementMap)!==null&&u!==void 0?u:null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(h=S==null?void 0:S.displacementScale)!==null&&h!==void 0?h:1,this.uniforms.displacementBias.value=(f=S==null?void 0:S.displacementBias)!==null&&f!==void 0?f:0,this.uniforms.bumpMap.value=(g=S==null?void 0:S.bumpMap)!==null&&g!==void 0?g:null,this.uniforms.bumpMap.value&&e.materials.refreshTransformUniform(this.uniforms.bumpMap.value,this.uniforms.bumpMapTransform),this.uniforms.bumpScale.value=(_=S==null?void 0:S.bumpScale)!==null&&_!==void 0?_:1,this.uniforms.normalMap.value=(A=S==null?void 0:S.normalMap)!==null&&A!==void 0?A:null,this.uniforms.normalMap.value&&e.materials.refreshTransformUniform(this.uniforms.normalMap.value,this.uniforms.normalMapTransform),this.uniforms.normalScale.value&&this.uniforms.normalScale.value.copy((x=S==null?void 0:S.normalScale)!==null&&x!==void 0?x:new p.FM8(1,1)),this.normalMapType=(E=S==null?void 0:S.normalMapType)!==null&&E!==void 0?E:p.IOt,this.flatShading=(T=S==null?void 0:S.flatShading)!==null&&T!==void 0&&T,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(S!=null&&S.userData.matId?S==null?void 0:S.userData.matId:0)/255,this._updaters.forEach(k=>{k(s,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let O=this.uniforms.alphaMap.value?1:void 0;O!==this.defines.USE_ALPHAMAP&&(O===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=O,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),O=this.uniforms.map.value?1:void 0,O!==this.defines.USE_MAP&&(O===void 0?(delete this.defines.USE_MAP,delete this.defines.MAP_UV):(this.defines.USE_MAP=O,this.defines.MAP_UV="uv"),this.needsUpdate=!0),O=this.uniforms.bumpMap.value?1:void 0,O!==this.defines.USE_BUMPMAP&&(O===void 0?(delete this.defines.USE_BUMPMAP,delete this.defines.BUMPMAP_UV):(this.defines.USE_BUMPMAP=O,this.defines.BUMPMAP_UV="uv"),this.needsUpdate=!0),O=this.uniforms.normalMap.value?1:void 0,O!==this.defines.USE_NORMALMAP&&(O===void 0?(delete this.defines.USE_NORMALMAP,delete this.defines.NORMALMAP_UV):(this.defines.USE_NORMALMAP=O,this.defines.NORMALMAP_UV="uv"),this.needsUpdate=!0),O=this.uniforms.displacementMap.value?1:void 0,O!==this.defines.USE_DISPLACEMENTMAP&&(O===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=O,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),O=S.userData.ALPHA_I_RGBA_PACKING?1:void 0,O!==this.defines.ALPHA_I_RGBA_PACKING&&(O===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=O,this.needsUpdate=!0),O=(R=S.userData.forcedLinearDepth)!==null&&R!==void 0?R:void 0,O!==this.defines.FORCED_LINEAR_DEPTH&&(O===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=O,this.needsUpdate=!0),this.side=(I=S.side)!==null&&I!==void 0?I:p.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);t!==-1&&this._updaters.splice(t,1)}}var ha=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class Si extends V.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}get viewer(){return this._viewer}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=cr(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(br(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,i,r;return(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetManager"))===null||t===void 0?void 0:t.exportPluginPreset(this))!==null&&i!==void 0?i:(r=this.toJSON)===null||r===void 0?void 0:r.call(this)}async importState(e){var t,i;const r=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("AssetManager");r?await r.importPluginPreset(e,this):(i=this.fromJSON)===null||i===void 0||i.call(this,e)}storeState(e,t,i){(t=t||(window?window.localStorage:void 0))?(i===void 0&&(i=this.exportState()),i&&t.setItem(this._storeKey(e),JSON.stringify(i))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const i=t.getItem(this._storeKey(e));i&&await this.importState(JSON.parse(i))}}function Zl(a,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(i){(0,V.safeSetProperty)(e,"dirty",i,!0)},update(){var i,r,s;this.passObject.enabled&&((r=(i=this.passObject).updateShaderProperties)===null||r===void 0||r.call(i,(0,V.getOrCall)(t)),(s=e.update)===null||s===void 0||s.call(this))},onRegister(i){var r,s,o;this.passObject.materialExtension&&((s=(r=a.getPluginByType("AssetManager"))===null||r===void 0?void 0:r.materials)===null||s===void 0||s.registerMaterialExtension(this.passObject.materialExtension)),(o=e.onRegister)===null||o===void 0||o.call(this,i)},onUnregister(i){var r,s,o;this.passObject.materialExtension&&((s=(r=a.getPluginByType("AssetManager"))===null||r===void 0?void 0:r.materials)===null||s===void 0||s.unregisterMaterialExtension(this.passObject.materialExtension)),(o=e.onUnregister)===null||o===void 0||o.call(this,i)},dispose(){var i,r,s;(r=(i=this.passObject).dispose)===null||r===void 0||r.call(i),(s=e.dispose)===null||s===void 0||s.call(this)}}}class qa extends Si{_update(e){var t;return((t=this._pass)===null||t===void 0?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t,i;return(i=(t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)!==null&&i!==void 0?i:this._enabledTemp}set enabled(e){var t;!((t=this._pass)===null||t===void 0)&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(i){i&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Zl(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,i;this._pass&&e.renderer.unregisterPass(this._pass),(i=(t=this._pass)===null||t===void 0?void 0:t.dispose)===null||i===void 0||i.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var t;const i=super.toJSON(e);if(!i.type)return i;const r=this.pass;return r&&(i.pass=cr((t=r==null?void 0:r.passObject)!==null&&t!==void 0?t:r,!1,e)),i}fromJSON(e,t){var i;if(!super.fromJSON(e,t))return null;if(e.pass){const r=this.pass;r&&br(e.pass,(i=r==null?void 0:r.passObject)!==null&&i!==void 0?i:r,!1,t)}return this}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ae()],qa.prototype,"enabled",null);class sf extends pu{constructor(e,t,i=new p.Ilk(1,1,1),r=1){super(void 0,void 0,t,i,r),this.target=e,this._transparentMats=new Set,this._transmissiveMats=new Set}render(e,t,i,r,s){var o;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel();(o=this.scene)===null||o===void 0||o.traverse(({material:f})=>{f&&((f.transparent&&f.userData.renderToDepth||!f.transparent&&f.transmission===0&&f.userData.renderToDepth===!1)&&(this._transparentMats.add(f),f.transparent=!f.transparent),Math.abs(f.transmission||0)>0&&f.userData.renderToDepth&&(this._transmissiveMats.add([f,f.transmission]),f.transmission=0))}),Wt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,r,s)),this._transparentMats.forEach(f=>f.transparent=!f.transparent),this._transparentMats.clear(),this._transmissiveMats.forEach(([f,g])=>f.transmission=g),this._transmissiveMats.clear(),e.setRenderTarget(l,u,h)}}class vr extends qa{get material(){return this._material}passCtor(e){var t,i,r;const s=((t=this._viewer)===null||t===void 0?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,o=e.renderer.createTarget({depthBuffer:!0,samples:((i=this._viewer)===null||i===void 0?void 0:i.useGBufferDepth)&&((r=this._viewer)===null||r===void 0?void 0:r.renderer.composerTarget.samples)||0,type:p.ywz,textureCount:s?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType});return Array.isArray(o.texture)?(o.texture[0].name="gbufferDepthNormal",o.texture[1].name="gbufferFlags",this._gbufferTextures=o.texture):(o.texture.name="gbufferDepthNormal",this._gbufferTextures.push(o.texture)),this._gbufferTarget=o,this._material=new nf(s),this._material.userData.isGBufferMaterial=!0,new sf(o,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0,t=!1,i=p.JQ4){super(),this.renderFlagsBuffer=e,this.renderDepthTexture=t,this.depthTextureType=i,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getDepthTexture(){var e;return(e=this._gbufferTarget)===null||e===void 0?void 0:e.depthTexture}getUnpackSnippet(){return ha}updateShaderProperties(e){var t,i,r;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(t=this.getDepthNormal())!==null&&t!==void 0?t:void 0:(i=this._viewer)===null||i===void 0||i.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(r=this.getFlagsTexture())!==null&&r!==void 0?r:void 0;const s=e.uniforms.tGBufferFlags.value?1:0;s!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=s,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}vr.PluginType="GBuffer";class af extends pu{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:p.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?p.cLu:p.ywz,format:p.wk1,minFilter:p.wem,magFilter:p.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new p.Ilk(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new fu({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,i,r,s){var o;let l=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,i,r,s),this.needsSwap=l,void(e.userData.mainRenderPass=void 0);const u=e.userData;u||console.error("threejs is not patched?");const h=this._viewer.useGBufferDepth;let f;if(h){const _=(o=this._viewer.getPlugin(vr))===null||o===void 0?void 0:o.getTarget();if(_){const A=e.properties.get(_);f=A.__webglDepthRenderbuffer||A.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let g=(_=!1)=>{super.render(e,void 0,i,r,s,f)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(l=!1,e.info&&!e.info.autoReset)throw"renderer.info.autoReset must be true";{const _=e.autoClearDepth;e.autoClearDepth=!h,Wt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},g),e.autoClearDepth=_}if(!h){const _=e.properties.get(i);f=_.__webglDepthRenderbuffer||_.__webglDepthbuffer}g=()=>{super.render(e,void 0,this.transparentTarget,r,s,f)};{const _=this.clear,A=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,Wt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},g),this.clear=_,e.autoClearDepth=A}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,i,r,s),l=!0);{const _=this.clear;this.clear=!1,u.transmissionRenderTarget=l?t:i,u.blurTransmissionTarget=this.blurTransmissionTarget&&u.transmissionRenderTarget.samples===0,Wt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},g),u.blurTransmissionTarget=void 0,u.transmissionRenderTarget=void 0,this.clear=_}(!e.info||e.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,i,r,s),l=!0)}}else{{const _=this.clear,A=e.autoClearDepth;e.autoClearDepth=!h,this.clear=!0,Wt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},g),this.clear=_,e.autoClearDepth=A}{this._viewer.renderer.blit(i.texture,t,{clear:!0});const _=this.clear;this.clear=!1,u.transmissionRenderTarget=t,u.blurTransmissionTarget=this.blurTransmissionTarget,Wt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},g),u.blurTransmissionTarget=void 0,u.transmissionRenderTarget=void 0,this.clear=_}l=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=l,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function mu(a,e){return a.multiplyScalar(a.w*e),a.w=1,a}function Al(a,e){return mu(a,e),new p.Ilk(a.x,a.y,a.z)}function Uc(a,e){const t=Math.max(a.x,Math.max(a.y,a.z));let i=Math.max(Math.min(t/e,1),0);return i=Math.ceil(255*i)/255,a.divideScalar(i*e),a.w=i,a}function Md(a,e){return Uc(new p.Ltg(a.r,a.g,a.b,1),e)}const Jl={name:"",blending:p.bdR,side:p.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:p.k74,blendDst:p.LgZ,blendEquation:p.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:p.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:p.cum,stencilRef:0,stencilFuncMask:255,stencilFail:p.x5V,stencilZFail:p.x5V,stencilZPass:p.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},$l={...Jl,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:p.IOt,normalScale:new p.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},gu={...$l,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new p.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new p.Ilk(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new p.Ilk(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new p.Ilk(1,1,1),specularColorMap:null};class js extends p.EJi{constructor(e){var t;super(e),this.typeSlug=js.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=es.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,i;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(i=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...es.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Oi(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Oi(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Oi(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Oi(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",p.IOt],["ObjectSpace",p.PA7]].map(e=>({label:e[0],value:e[1]}))},Oi(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Oi(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Oi(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Oi(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Oi(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Oi(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Oi(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Oi(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Oi(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Oi(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",p.BVF],["Always",p.Se2],["Less",p.Zr5],["LessEqual",p.vCF],["Equal",p.eD],["GreaterEqual",p.ksN],["Greater",p.w$m],["NotEqual",p.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",p.jFi],["Normal",p.bdR],["Additive",p.WMw],["Subtractive",p.N4l],["Multiply",p.M5h]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Oi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Oi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Oi(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},Oi(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},Oi(this,"iridescenceThicknessMap")]},{type:"folder",label:"Environment",children:[{type:"checkbox",label:"Override Environment",getValue:()=>this.userData.separateEnvMapIntensity===!0,setValue:e=>{this.userData.separateEnvMapIntensity=e,e||delete this.userData.separateEnvMapIntensity},onChange:this.setDirty},{type:"slider",bounds:[0,10],hidden:()=>!this.userData.separateEnvMapIntensity,label:"Environment Intensity",property:[this,"envMapIntensity"]},{type:"dropdown",hidden:()=>!this.userData.separateEnvMapIntensity&&!this.userData.envMapSlotKey,label:"Environment Map",children:["","environment1","environment2"].map(e=>({label:e||"default",value:e})),getValue:()=>this.userData.envMapSlotKey||"",setValue:e=>{this.userData.envMapSlotKey=e,e||delete this.userData.envMapSlotKey,this.setDirty()}}]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",p.Wl3],["Back",p._Li],["Double",p.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t,i;return(i=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&i!==void 0?i:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(cr(this,!1),null,2)],{type:"application/json"});(0,V.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const i=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const s of r)e.vertexShader=Mi(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=Mi(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);es.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+es.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,i,r,s){super.onBeforeRender(e,t,i,r,s),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:r,object:s});const o=this.userData.inverseAlphaMap?1:0;o!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=o,this.needsUpdate=!0)}onAfterRender(e,t,i,r,s){super.onAfterRender(e,t,i,r,s),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}copyProps(e,t=!1,i=!0){if(!t&&!["MeshStandardMaterial",js.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const r={},s=Array.from(Object.keys(gu));(0,V.copyProps)(e,r,s);const o=r.userData;delete r.userData;for(const l of Object.keys(r))r[l]===void 0&&delete r[l];if(this.setValues(r),i)for(const l of Lr)this.userData[l]!==void 0&&this.userData[l];return o&&zr(this.userData,o),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var t,i;const r=this.userData;this.userData={};const s=super.toJSON(e);this.userData=r,s.userData={},zr(s.userData,r),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((t=s.textures)===null||t===void 0?void 0:t.map(l=>[l.uuid,l]))||[]),images:Object.fromEntries(((i=s.images)===null||i===void 0?void 0:i.map(l=>[l.uuid,l]))||[])};s.userData=cr(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=js.TYPE;for(const l of Object.keys(s))s[l]===void 0&&delete s[l];return s}fromJSON(e,t,i=!1){return this.copyProps(e,i)}clone(){return super.clone()}}js.TypeSlug="pmat",js.TYPE="MeshStandardMaterial2";const Td={...Jl,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:p.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class wl extends p.vBJ{constructor(e){var t;super(e),this.typeSlug=wl.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("WebGi: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.materialExtensions=es.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,i;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(i=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...es.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Oi(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",p.jFi],["Normal",p.bdR],["Additive",p.WMw],["Subtractive",p.N4l],["Multiply",p.M5h]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Oi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Oi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Oi(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",p.Wl3],["Back",p._Li],["Double",p.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t,i;return(i=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&i!==void 0?i:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(cr(this,!1),null,2)],{type:"application/json"});(0,V.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const i=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const s of r)e.vertexShader=Mi(e.vertexShader,s[0],"#glMarker "+s[1]+`
`+s[0]);for(const s of i)e.fragmentShader=Mi(e.fragmentShader,s[0],"#glMarker "+s[1]+`
`+s[0]);es.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+es.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,i,r,s){super.onBeforeRender(e,t,i,r,s),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}onAfterRender(e,t,i,r,s){super.onAfterRender(e,t,i,r,s),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",wl.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},r=Array.from(Object.keys(Td));(0,V.copyProps)(e,i,r);const s=i.userData;delete i.userData;for(const o of Object.keys(i))i[o]===void 0&&delete i[o];return this.setValues(i),s&&zr(this.userData,s),this.setDirty(),this}toJSON(e){var t,i;const r=this.userData;this.userData={};const s=super.toJSON(e);this.userData=r,s.userData={},zr(s.userData,r),s.userData.uuid=this.userData.uuid;const o=e||{textures:Object.fromEntries(((t=s.textures)===null||t===void 0?void 0:t.map(l=>[l.uuid,l]))||[]),images:Object.fromEntries(((i=s.images)===null||i===void 0?void 0:i.map(l=>[l.uuid,l]))||[])};s.userData=cr(s.userData,!1,o),e||(Object.keys(o.textures).length>0&&(s.textures=Object.values(o.textures)),Object.keys(o.images).length>0&&(s.images=Object.values(o.images))),s.type=wl.TYPE;for(const l of Object.keys(s))s[l]===void 0&&delete s[l];return s}fromJSON(e,t,i=!1){return this.copyProps(e,i)}clone(){return super.clone()}}wl.TypeSlug="bmat",wl.TYPE="MeshBasicMaterial2";const Id={materialType:js.TYPE,name:"standard",color:"#ffffff"},zo={materialType:wl.TYPE,name:"basic",color:"#ffffff"},Pd={[js.TYPE]:Id.name,MeshStandardMaterial:Id.name,MeshPhysicalMaterial:Id.name,[wl.TYPE]:zo.name,MeshBasicMaterial:zo.name};class xl extends V.SimpleEventDispatcher{constructor(){super(),this._templates=[Id,zo],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const i=this._getMapsForMaterial(t),r=[];i.forEach(s=>{const o=s.userData.__appliedMaterials;o==null||o.delete(t),o&&s.userData.disposeOnIdle!==!1&&o.size===0&&r.push(s)}),r.forEach(s=>{s.dispose()})},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let i=this.findMaterial(e);return i||(i=this.generateFromTemplate(e,t)),i}generateFromTemplate(e,t){const i=this.findTemplate(e);if(i)return this._generateFromTemplate(i,t??{})}generateFromTemplateType(e,t){const i=this._templates.find(r=>r.materialType===e);if(i)return this._generateFromTemplate(i,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(t=>{this._getMapsForMaterial(t).forEach(i=>{let r=i.userData.__appliedMaterials;r||(i.userData.__appliedMaterials=r=new Set),i.addEventListener("update",()=>t.dispatchEvent({type:"textureUpdate",texture:i})),r.add(t)})})}_getMapsForMaterial(e){var t;const i=new Set;for(const r of Object.values(e))r&&r.isTexture&&i.add(r);for(const r of Object.values((t=e.userData)!==null&&t!==void 0?t:{}))r&&r.isTexture&&i.add(r);return i}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("WebGi MaterialManager: Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Wn());const t=this._templates.find(i=>i.templateUUID===e.templateUUID);t?console.warn("WebGi Material Manager: MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(e=!0){const t=this._materials;this._materials=[];for(const i of t)e||!i.userData.runtimeMaterial?i.dispose():this._materials.push(i)}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(i=>typeof e!="string"||t?i.name.match(typeof e=="string"?"^"+e+"$":e)!==null:i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){const i=this._processModel(e,t);return(0,V.safeSetProperty)(e,"modelObject",i),e}_processMaterial(e,t){var i,r;if(!e)return;if(!((i=e.materialObject)===null||i===void 0)&&i.isMaterial)return e;let s=e.mmMaterial;if(!s){const o=((r=e.userData)===null||r===void 0?void 0:r.uuid)||e.uuid;if(s=this.findMaterial(o),s)s.copyProps(e);else{const l=t.useSourceMaterial===!1||!e.isMaterial,u=t.materialTemplate||(l?"standard":Pd[e.type]||"standard");s=this.generateFromTemplate(u,l?{}:e)}e.mmMaterial=s}return s}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),t.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,i=!0,r=!1){const s=cr(e,!1),o=JSON.stringify(s,null,i?0:2),l=(t||e.name||"physical_material")+"."+e.typeSlug,u=new File([o],l,{type:"application/json"});return r&&(0,V.downloadFile)(u),u}applyMaterial(e,t,i=!0){var r;const s=Object.getPrototypeOf(e).constructor.TYPE;let o=this.findMaterialsByName(t,i);(!o||o.length<1)&&(o=[this.findMaterial(t)]);let l=!1;for(const u of o)if(u&&!u.userData.__isVariation&&u!==e)if(Object.getPrototypeOf(u).constructor.TYPE===s){const h=u.name;u.copyProps(e),u.name=h,l=!0}else{const h=u["__"+s]||this.generateFromTemplateType(s);if(!h)continue;const f=u.name;h.copyProps(e),h.name=f;const g=u.userData.__appliedMeshes;for(const _ of[...g??[]])(r=_==null?void 0:_.setMaterial)===null||r===void 0||r.call(_,h),_&&(l=!0);u["__"+s]=h}return l}}class gs extends xl{_generateFromTemplate(e,t){var i,r,s,o,l,u;let h;const f={...e};f.customMaterialExtensions=[...(i=f.customMaterialExtensions)!==null&&i!==void 0?i:[],...this._materialExtensions];const g=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5;g&&(p.epp.enabled=!1);let _={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&(0,V.copyProps)(t,f,Array.from(Object.keys(gu))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(f.roughness=.9,f.metalness=0,!((r=f.userData)===null||r===void 0)&&r.uuid&&delete f.userData.uuid),_=(s=f.userData)===null||s===void 0?void 0:s.uuid,_&&delete f.userData.uuid,h=new js({customMaterialExtensions:f.customMaterialExtensions}).fromJSON(f,void 0,!0),_&&(h.uuid=_),h.userData.uuid=h.uuid,h.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=h);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&(0,V.copyProps)(t,f,Array.from(Object.keys(Td))),_=(o=f.userData)===null||o===void 0?void 0:o.uuid,_&&delete f.userData.uuid,h=new wl({customMaterialExtensions:f.customMaterialExtensions}).fromJSON(f,void 0,!0),_&&(h.uuid=_,f.userData.uuid=_),h.userData.uuid=h.uuid,h.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:_=null,t&&t.userData&&(_=t.userData,delete t.userData),h=((l=e.generator)===null||l===void 0?void 0:l.call(e,f,t))||void 0,t&&_&&(t.userData=_),_&&h&&(zr(h.userData,_),_!=null&&_.uuid&&(h.uuid=_.uuid),_=null),h&&(h.userData.uuid=h.uuid)}if(h){t.runtimeMaterial&&(h.userData.runtimeMaterial=!0);const A=h;if(h.clone=()=>{A.userData.cloneId||(A.userData.cloneId="0"),A.userData.cloneCount||(A.userData.cloneCount=0),A.userData.cloneCount+=1;const x=this.generateFromTemplate(e.name);return x&&(x.copyProps(A),x.userData.cloneId=x.userData.cloneId+"_"+A.userData.cloneCount,x.userData.cloneCount=0,x.name=x.name+"_"+x.userData.cloneId,x.userData.uuid=x.uuid),x==null?void 0:x.materialObject},t){let x=this.findMaterial(t==null?void 0:t.uuid);x&&this.unregisterMaterial(x),x=this.findMaterial((u=t==null?void 0:t.materialObject)===null||u===void 0?void 0:u.uuid),x&&this.unregisterMaterial(x)}}return g&&(p.epp.enabled=!0),h?this.registerMaterialObject(h):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let i=e.material;if(!i&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),i=this._defaultMaterial,e.material=i),i){let r=!0;Array.isArray(i)||(i=[i],r=!1);const s=[];for(const o of i){const l=this._processMaterial(o,t);s.push(l==null?void 0:l.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(r?s:s[0]))}if(t.recursive!==!1)for(let r=0;r<e.modelObject.children.length;r++)e.modelObject.children[r]=this._processModel(e.modelObject.children[r],t);return e}}class Tn{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}constructor(e,t,i,r){this.cls=e,this.ext=t,this.root=i,this.onCtor=r}}class Ca{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:i=!1,autoScale:r=!1,autoScaleRadius:s=2,license:o=""}={}){if(this.assetType="model",this._modelObject=fo(new p.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!i||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||i||(e.userData.isCentered=!0):ti(e),this._modelObject=e;else{i&&console.error("cannot use pseudoCenter and autoCenter at the same time");const l=new Re().expandByObject(e,!0,!0).getCenter(new p.Pa4);this._modelObject.position.copy(l).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}r&&!this._modelObject.userData.autoScaled?mi(this._modelObject,e.userData.autoScaleRadius||s):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=o}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("WebGi Object3DModel: no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,i,r,s;(i=(t=this._modelObject)===null||t===void 0?void 0:t.setDirty)===null||i===void 0||i.call(t,e),(s=(r=this._uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||s===void 0||s.call(r,"postFrame",!0)}setMaterial(e){var t,i;return this._modelObject.isMesh?((i=(t=this._modelObject).setMaterial)===null||i===void 0?void 0:i.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var i,r;if(this._modelObject.isMesh)return(r=(i=this._modelObject).setGeometry)===null||r===void 0?void 0:r.call(i,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("WebGi Object3DModel: updateBounds: NOT IMPLEMENTED, don't use"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=uh(this._modelObject,!1)),this._uiConfig}clone(){return new Ca(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function of(a,e){return[a.modelObject,...a.modelObject.children].forEach(t=>{fo(t,t!==a.modelObject?a:void 0,e)}),a}class Ya{constructor(){this._processors=new Map}add(e,t){var i;this._processors.has(e)||this._processors.set(e,[]),(i=this._processors.get(e))===null||i===void 0||i.push(t)}remove(e,t){const i=this._processors.get(e),r=(i==null?void 0:i.indexOf(t))||(i==null?void 0:i.findIndex(s=>s.process&&s.process===t.process||s.processAsync&&s.processAsync===t.processAsync));!i||!r||r<0||i.splice(r,1)}get(e){var t;return(t=this._processors.get(e))!==null&&t!==void 0?t:[]}async process(e,t,i){var r,s,o,l;const u=this.get(e),h=t.assetType;for(const f of u)f.forAssetType===h&&(t=(s=(r=f.process)===null||r===void 0?void 0:r.call(f,t,i))!==null&&s!==void 0?s:t,t=(l=await((o=f.processAsync)===null||o===void 0?void 0:o.call(f,t,i)))!==null&&l!==void 0?l:t);return t}dispose(){this._processors.clear()}}class Yi extends p.hH6{load(e,t,i,r){return super.load(e,s=>{try{if(typeof s!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(s))}catch(o){r==null||r(o)}},i,r)}}class an extends p.yxD{constructor(e){super(e),this.type=p.cLu}parse(e){const t=function(u,h){switch(u){case 1:console.error("THREE.RGBELoader Read Error: "+(h||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(h||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(h||""));break;default:console.error("THREE.RGBELoader: Error: "+(h||""))}return-1},i=function(u,h,f){h=h||1024;let g=u.pos,_=-1,A=0,x="",E=String.fromCharCode.apply(null,new Uint16Array(u.subarray(g,g+128)));for(;0>(_=E.indexOf(`
`))&&A<h&&g<u.byteLength;)x+=E,A+=E.length,g+=128,E+=String.fromCharCode.apply(null,new Uint16Array(u.subarray(g,g+128)));return-1<_&&(f!==!1&&(u.pos+=A+_+1),x+E.slice(0,_))},r=function(u,h,f,g){const _=u[h+3],A=Math.pow(2,_-128)/255;f[g+0]=u[h+0]*A,f[g+1]=u[h+1]*A,f[g+2]=u[h+2]*A,f[g+3]=1},s=function(u,h,f,g){const _=u[h+3],A=Math.pow(2,_-128)/255;f[g+0]=p.A5E.toHalfFloat(Math.min(u[h+0]*A,65504)),f[g+1]=p.A5E.toHalfFloat(Math.min(u[h+1]*A,65504)),f[g+2]=p.A5E.toHalfFloat(Math.min(u[h+2]*A,65504)),f[g+3]=p.A5E.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const l=function(u){const h=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,f=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,g=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let x,E;if(u.pos>=u.byteLength||!(x=i(u)))return t(1,"no header found");if(!(E=x.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(A.valid|=1,A.programtype=E[1],A.string+=x+`
`;x=i(u),x!==!1;)if(A.string+=x+`
`,x.charAt(0)!=="#"){if((E=x.match(h))&&(A.gamma=parseFloat(E[1])),(E=x.match(f))&&(A.exposure=parseFloat(E[1])),(E=x.match(g))&&(A.valid|=2,A.format=E[1]),(E=x.match(_))&&(A.valid|=4,A.height=parseInt(E[1],10),A.width=parseInt(E[2],10)),2&A.valid&&4&A.valid)break}else A.comments+=x+`
`;return 2&A.valid?4&A.valid?A:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(l!==-1){const u=l.width,h=l.height,f=function(g,_,A){const x=_;if(x<8||x>32767||g[0]!==2||g[1]!==2||128&g[2])return new Uint8Array(g);if(x!==(g[2]<<8|g[3]))return t(3,"wrong scanline width");const E=new Uint8Array(4*_*A);if(!E.length)return t(4,"unable to allocate buffer space");let T=0,R=0;const I=4*x,S=new Uint8Array(4),O=new Uint8Array(I);let k=A;for(;k>0&&R<g.byteLength;){if(R+4>g.byteLength)return t(1);if(S[0]=g[R++],S[1]=g[R++],S[2]=g[R++],S[3]=g[R++],S[0]!=2||S[1]!=2||(S[2]<<8|S[3])!=x)return t(3,"bad rgbe scanline format");let N,H=0;for(;H<I&&R<g.byteLength;){N=g[R++];const te=N>128;if(te&&(N-=128),N===0||H+N>I)return t(3,"bad scanline data");if(te){const re=g[R++];for(let ue=0;ue<N;ue++)O[H++]=re}else O.set(g.subarray(R,R+N),H),H+=N,R+=N}const X=x;for(let te=0;te<X;te++){let re=0;E[T]=O[te+re],re+=x,E[T+1]=O[te+re],re+=x,E[T+2]=O[te+re],re+=x,E[T+3]=O[te+re],T+=4}k--}return E}(o.subarray(o.pos),u,h);if(f!==-1){let g,_,A;switch(this.type){case p.VzW:A=f.length/4;const x=new Float32Array(4*A);for(let T=0;T<A;T++)r(f,4*T,x,4*T);g=x,_=p.VzW;break;case p.cLu:A=f.length/4;const E=new Uint16Array(4*A);for(let T=0;T<A;T++)s(f,4*T,E,4*T);g=E,_=p.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:u,height:h,data:g,header:l.string,gamma:l.gamma,exposure:l.exposure,type:_}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,r){return super.load(e,function(s,o){switch(s.type){case p.VzW:case p.cLu:s.colorSpace=p.GUF,s.minFilter=p.wem,s.magFilter=p.wem,s.generateMipmaps=!1,s.flipY=!0}t&&t(s,o)},i,r)}}function Nc(a){return new Tn(class extends an{constructor(e){super(e),this.setDataType(Rv(a.renderer.rendererObject))}},["hdr"],!1)}class kr extends p.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new vs(t)}),this.register(function(t){return new bm(t)}),this.register(function(t){return new N_(t)}),this.register(function(t){return new lf(t)}),this.register(function(t){return new mo(t)}),this.register(function(t){return new L_(t)}),this.register(function(t){return new Rd(t)}),this.register(function(t){return new ym(t)}),this.register(function(t){return new _v(t)}),this.register(function(t){return new k_(t)}),this.register(function(t){return new yv(t)}),this.register(function(t){return new U_(t)}),this.register(function(t){return new vu(t)}),this.register(function(t){return new ph(t)}),this.register(function(t){return new Dd(t)})}load(e,t,i,r){const s=this;let o;o=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:p.Zp0.extractUrlBase(e),this.manager.itemStart(e);const l=function(h){r?r(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},u=new p.hH6(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(h){try{s.parse(h,o,function(f){t(f),s.manager.itemEnd(e)},l,e)}catch(f){l(f)}},i,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r,s){let o;const l={},u={},h=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(h.decode(new Uint8Array(e,0,4))===cf){try{l[Ar.KHR_BINARY_GLTF]=new El(e)}catch(g){return void(r&&r(g))}o=JSON.parse(l[Ar.KHR_BINARY_GLTF].content)}else o=JSON.parse(h.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const f=new _u(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let g=0;g<this.pluginCallbacks.length;g++){const _=this.pluginCallbacks[g](f);u[_.name]=_,l[_.name]=!0}if(o.extensionsUsed)for(let g=0;g<o.extensionsUsed.length;++g){const _=o.extensionsUsed[g],A=o.extensionsRequired||[];switch(_){case Ar.KHR_MATERIALS_UNLIT:l[_]=new wn;break;case Ar.KHR_DRACO_MESH_COMPRESSION:l[_]=new Am(o,this.dracoLoader);break;case Ar.KHR_TEXTURE_TRANSFORM:l[_]=new uf;break;case Ar.KHR_MESH_QUANTIZATION:l[_]=new Bd;break;default:A.indexOf(_)>=0&&u[_]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}f.setExtensions(l),f.setPlugins(u),f.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function vv(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}kr.ObjectConstructors={DirectionalLight:p.Ox3,PointLight:p.cek,SpotLight:p.PMe,MeshStandardMaterial:p.Wid,MeshBasicMaterial:p.vBJ,MeshPhysicalMaterial:p.EJi,LineBasicMaterial:p.nls,PointsMaterial:p.UY4,PerspectiveCamera:p.cPb,OrthographicCamera:p.iKG};const Ar={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class vu{constructor(e){this.parser=e,this.name=Ar.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const u=new p.Ilk(16777215);o.color!==void 0&&u.fromArray(o.color);const h=o.range!==void 0?o.range:0;switch(o.type){case"directional":l=new kr.ObjectConstructors.DirectionalLight(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new kr.ObjectConstructors.PointLight(u),l.distance=h;break;case"spot":l=new kr.ObjectConstructors.SpotLight(u),l.distance=h,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,l.angle=o.spot.outerConeAngle,l.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return l.position.set(0,0,0),l.decay=2,da(l,o),o.intensity!==void 0&&(l.intensity=o.intensity),l.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(l),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],s=(r.extensions&&r.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(o){return i._getNodeRef(t.cache,s,o)})}}class wn{constructor(){this.name=Ar.KHR_MATERIALS_UNLIT}getMaterialType(){return kr.ObjectConstructors.MeshBasicMaterial}extendParams(e,t,i){const r=[];e.color=new p.Ilk(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,p.KI_))}return Promise.all(r)}}class _v{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class vs{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const l=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new p.FM8(l,l)}return Promise.all(s)}}class yv{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class mo{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new p.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,p.KI_)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),r.extras&&r.extras.sheenFactor!==void 0&&(t.sheen=r.extras.sheenFactor,delete r.extras.sheenFactor),Promise.all(s)}}class L_{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Rd{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const l=o.attenuationColor||[1,1,1];return t.attenuationColor=new p.Ilk(l[0],l[1],l[2]),Promise.all(s)}}class ym{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class k_{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?kr.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const l=o.specularColorFactor||[1,1,1];return t.specularColor=new p.Ilk(l[0],l[1],l[2]),o.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,p.KI_)),Promise.all(s)}}class U_{constructor(e){this.parser=e,this.name=Ar.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?p.EJi:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class bm{constructor(e){this.parser=e,this.name=Ar.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class N_{constructor(e){this.parser=e,this.name=Ar.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],l=r.images[o.source];let u=i.textureLoader;if(l.uri){const h=i.options.manager.getHandler(l.uri);h!==null&&(u=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,o.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class lf{constructor(e){this.parser=e,this.name=Ar.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],l=r.images[o.source];let u=i.textureLoader;if(l.uri){const h=i.options.manager.getHandler(l.uri);h!==null&&(u=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,o.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ph{constructor(e){this.name=Ar.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(l){const u=r.byteOffset||0,h=r.byteLength||0,f=r.count,g=r.byteStride,_=new Uint8Array(l,u,h);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,g,_,r.mode,r.filter).then(function(A){return A.buffer}):o.ready.then(function(){const A=new ArrayBuffer(f*g);return o.decodeGltfBuffer(new Uint8Array(A),f,g,_,r.mode,r.filter),A})})}return null}}class Dd{constructor(e){this.name=Ar.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=t.meshes[i.mesh];for(const u of r.primitives)if(u.mode!==go.TRIANGLES&&u.mode!==go.TRIANGLE_STRIP&&u.mode!==go.TRIANGLE_FAN&&u.mode!==void 0)return null;const s=i.extensions[this.name].attributes,o=[],l={};for(const u in s)o.push(this.parser.getDependency("accessor",s[u]).then(h=>(l[u]=h,l[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(u=>{const h=u.pop(),f=h.isGroup?h.children:[h],g=u[0].count,_=[];for(const A of f){const x=new p.yGw,E=new p.Pa4,T=new p._fP,R=new p.Pa4(1,1,1),I=new p.SPe(A.geometry,A.material,g);for(let S=0;S<g;S++)l.TRANSLATION&&E.fromBufferAttribute(l.TRANSLATION,S),l.ROTATION&&T.fromBufferAttribute(l.ROTATION,S),l.SCALE&&R.fromBufferAttribute(l.SCALE,S),I.setMatrixAt(S,x.compose(E,T,R));I.sourceTrs=l;for(const S in l)S!=="TRANSLATION"&&S!=="ROTATION"&&S!=="SCALE"&&A.geometry.setAttribute(S,l[S]);p.Tme.prototype.copy.call(I,A),this.parser.assignFinalMaterial(I),_.push(I)}return h.isGroup?(h.clear(),h.add(..._),h):_[0]}))}}const cf="glTF";class El{constructor(e){this.name=Ar.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==cf)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const l=s.getUint32(o,!0);o+=4;const u=s.getUint32(o,!0);if(o+=4,u===1313821514){const h=new Uint8Array(e,12+o,l);this.content=i.decode(h)}else if(u===5130562){const h=12+o;this.body=e.slice(h,h+l)}o+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Am{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ar.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},u={},h={};for(const f in o){const g=df[f]||f.toLowerCase();l[g]=o[f]}for(const f in e.attributes){const g=df[f]||f.toLowerCase();if(o[f]!==void 0){const _=i.accessors[e.attributes[f]],A=fh[_.componentType];h[g]=A.name,u[g]=_.normalized===!0}}return t.getDependency("bufferView",s).then(function(f){return new Promise(function(g){r.decodeDracoFile(f,function(_){for(const A in _.attributes){const x=_.attributes[A],E=u[A];E!==void 0&&(x.normalized=E)}g(_)},l,h)})})}}class uf{constructor(){this.name=Ar.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(e.__hasGLTFUuid||(e=e.clone()),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Bd{constructor(){this.name=Ar.KHR_MESH_QUANTIZATION}}class Fc extends p._C8{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,l=this.valueSize,u=2*l,h=3*l,f=r-t,g=(i-t)/f,_=g*g,A=_*g,x=e*h,E=x-h,T=-2*A+3*_,R=A-_,I=1-T,S=R-_+g;for(let O=0;O!==l;O++){const k=o[E+O+l],N=o[E+O+u]*f,H=o[x+O+l],X=o[x+O]*f;s[O]=I*k+S*N+T*H+R*X}return s}}const Sl=new p._fP;class hf extends Fc{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return Sl.fromArray(s).normalize().toArray(s),s}}const go={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},fh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bv={9728:p.TyD,9729:p.wem,9984:p.YLQ,9985:p.qyh,9986:p.aH4,9987:p.D1R},jc={33071:p.uWy,33648:p.OoA,10497:p.rpg},wm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},df={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},vo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Av={CUBICSPLINE:void 0,LINEAR:p.NMF,STEP:p.Syv};function Vo(a,e,t){for(const i in t.extensions)a[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function da(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Go(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)a.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function zc(a){let e;const t=a.extensions&&a.extensions[Ar.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+sr(t.attributes):a.indices+":"+sr(a.attributes)+":"+a.mode,a.targets!==void 0)for(let i=0,r=a.targets.length;i<r;i++)e+=":"+sr(a.targets[i]);return e}function sr(a){let e="";const t=Object.keys(a).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+a[t[i]]+";";return e}function fn(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const wv=new p.yGw;class _u{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new vv,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&s<98?this.textureLoader=new p.dpR(this.options.manager):this.textureLoader=new p.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new p.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const l={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};Vo(s,l,r),da(l,r),Promise.all(i._invokeAll(function(u){return u.afterRoot&&u.afterRoot(l)})).then(function(){e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let l=0,u=o.length;l<u;l++)e[o[l]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,l)=>{const u=this.associations.get(o);u!=null&&this.associations.set(l,u);for(const[h,f]of o.children.entries())s(f,l.children[h])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ar.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(p.Zp0.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=wm[r.type],l=fh[r.componentType],u=r.normalized===!0,h=new l(r.count*o);return Promise.resolve(new p.TlE(h,o,u))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const l=o[0],u=wm[r.type],h=fh[r.componentType],f=h.BYTES_PER_ELEMENT,g=f*u,_=r.byteOffset||0,A=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,x=r.normalized===!0;let E,T;if(A&&A!==g){const R=Math.floor(_/A),I="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+R+":"+r.count;let S=t.cache.get(I);S||(E=new h(l,R*A,r.count*A/f),S=new p.vpT(E,A/f),t.cache.add(I,S)),T=new p.kB5(S,u,_%A/f,x)}else E=l===null?new h(r.count*u):new h(l,_,r.count*u),T=new p.TlE(E,u,x);if(r.sparse!==void 0){const R=wm.SCALAR,I=fh[r.sparse.indices.componentType],S=r.sparse.indices.byteOffset||0,O=r.sparse.values.byteOffset||0,k=new I(o[1],S,r.sparse.count*R),N=new h(o[2],O,r.sparse.count*u);l!==null&&(T=new p.TlE(T.array.slice(),T.itemSize,T.normalized));for(let H=0,X=k.length;H<X;H++){const te=k[H];if(T.setX(te,N[H*u]),u>=2&&T.setY(te,N[H*u+1]),u>=3&&T.setZ(te,N[H*u+2]),u>=4&&T.setW(te,N[H*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,s=t.images[r];let o=this.textureLoader;if(s.uri){const l=i.manager.getHandler(s.uri);l!==null&&(o=l)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],l=s.images[t],u=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[u])return this.textureCache[u];const h=this.loadImageSource(t,i).then(function(f){f.name=o.name||l.name||"",f.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(f.name=l.uri);const g=(s.samplers||{})[o.sampler]||{};return f.magFilter=bv[g.magFilter]||p.wem,f.minFilter=bv[g.minFilter]||p.D1R,f.wrapS=jc[g.wrapS]||p.rpg,f.wrapT=jc[g.wrapT]||p.rpg,g.extras&&g.extras.uuid!==void 0&&(f.uuid=g.extras.uuid,f.__hasGLTFUuid=!0),r.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[u]=h,h}loadImageSource(e,t,i=!1,r=!1){const s=this,o=this.json,l=this.options;if(!r&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(x=>x.clone());const u=o.images[e],h=self.URL||self.webkitURL;u.uri===void 0&&u.extras&&u.extras.uri&&(u.uri=u.extras.uri);let f=u.uri||"",g=!1,_=null;if(u.bufferView===void 0||i&&f){if(u.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else f=s.getDependency("bufferView",u.bufferView).then(function(x){g=!0;const E=new Blob([x],{type:u.mimeType});return f=h.createObjectURL(E),_=E,f});const A=Promise.resolve(f).then(function(x){return new Promise(function(E,T){let R=E;t.isImageBitmapLoader===!0&&(R=function(I){const S=new p.xEZ(I);S.needsUpdate=!0,E(S)}),t.load(p.Zp0.resolveURL(x,l.path),R,void 0,function(I){t.isImageBitmapLoader===!0?(t=new p.dpR(s.options.manager),R=E,t.setCrossOrigin(s.options.crossOrigin),t.setRequestHeader(s.options.requestHeader),t.load(p.Zp0.resolveURL(x,l.path),R,void 0,T)):T(I)})})}).then(function(x){var E;if(g===!0&&h.revokeObjectURL(f),x.userData.mimeType=u.mimeType||((E=u.uri).search(/\.jpe?g($|\?)/i)>0||E.search(/^data\:image\/jpeg/)===0?"image/jpeg":E.search(/\.webp($|\?)/i)>0||E.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),x.flipY=!1,u.extras){if(u.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let T=x;const R=u.extras.flipY&&!T.flipY;createImageBitmap(T.source.data,{imageOrientation:R?"flipY":"none"}).then(function(I){T._newTex&&(T=T._newTex),T.source.data.close&&T.source.data.close(),T.source.data=I,T.source.needsUpdate=!0,T.needsUpdate=!0})}x.flipY=u.extras.flipY,x.needsUpdate=!0,delete u.extras.flipY}u.extras.uuid!==void 0&&(x.source.uuid=u.extras.uuid),u.extras.t_uuid!==void 0&&(x.uuid=u.extras.t_uuid,x.__hasGLTFUuid=!0)}return u.uri&&typeof u.uri=="string"&&g===!1&&!u.uri.startsWith("/")&&(x.userData.rootPath=p.Zp0.resolveURL(u.uri,l.path)),_&&(x.userData.__sourceBlob=_),!i&&u.uri&&u.uri!==f&&s.loadImageSource(e,t,!0,!0).then(function(T){x.source.data&&x.source.data.close&&x.source.data.close(),x.dispose(),x.source=T.source,x.source.needsUpdate=!0,x.needsUpdate=!0,x.uuid=T.uuid,T.__hasGLTFUuid&&(x.__hasGLTFUuid=!0),x.flipY=T.flipY,x.userData=T.userData,x.setDirty&&x.setDirty(),T._newTex=x}),x}).catch(function(x){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),x});return this.sourceCache[e]=A,A}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&((o=o.clone()).channel=i.texCoord),s.extensions[Ar.KHR_TEXTURE_TRANSFORM]){const l=i.extensions!==void 0?i.extensions[Ar.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const u=s.associations.get(o);o=s.extensions[Ar.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),s.associations.set(o,u)}}return r!==void 0&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+i.uuid;let h=this.cache.get(u);h||(h=new kr.ObjectConstructors.PointsMaterial,p.F5T.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,h.sizeAttenuation=!1,this.cache.add(u,h)),i=h}else if(e.isLine){const u="LineBasicMaterial:"+i.uuid;let h=this.cache.get(u);h||(h=new kr.ObjectConstructors.LineBasicMaterial,p.F5T.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,this.cache.add(u,h)),i=h}const l=!(!i.userData||!i.userData.gltfExtensions||!i.userData.gltfExtensions.WEBGI_material_extras);if((r||s||o)&&!l){let u="ClonedMaterial:"+i.uuid+":";r&&(u+="derivative-tangents:"),s&&(u+="vertex-colors:"),o&&(u+="flat-shading:");let h=this.cache.get(u);h||(h=i.clone(),s&&(h.vertexColors=!0),o&&(h.flatShading=!0),r&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(u,h),this.associations.set(h,this.associations.get(i))),i=h}e.material=i}getMaterialType(){return kr.ObjectConstructors.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const l={},u=[];if((s.extensions||{})[Ar.KHR_MATERIALS_UNLIT]){const f=r[Ar.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),u.push(f.extendParams(l,s,t))}else{const f=s.pbrMetallicRoughness||{};if(l.color=new p.Ilk(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){const g=f.baseColorFactor;l.color.fromArray(g),l.opacity=g[3]}f.baseColorTexture!==void 0&&u.push(t.assignTexture(l,"map",f.baseColorTexture,p.KI_)),l.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,l.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(g){return g.getMaterialType&&g.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(g){return g.extendMaterialParams&&g.extendMaterialParams(e,l)})))}s.doubleSided===!0&&(l.side=p.ehD);const h=s.alphaMode||"OPAQUE";if(h==="BLEND"?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,h==="MASK"&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==kr.ObjectConstructors.MeshBasicMaterial&&(u.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new p.FM8(1,1),s.normalTexture.scale!==void 0)){const f=s.normalTexture.scale;l.normalScale.set(f,f)}return s.occlusionTexture!==void 0&&o!==kr.ObjectConstructors.MeshBasicMaterial&&(u.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==kr.ObjectConstructors.MeshBasicMaterial&&(l.emissive=new p.Ilk().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==kr.ObjectConstructors.MeshBasicMaterial&&u.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,p.KI_)),Promise.all(u).then(function(){const f=new o(l);return s.extras&&s.extras.uuid&&(f.uuid=s.extras.uuid),s.name&&(f.name=s.name),da(f,s),t.associations.set(f,{materials:e}),s.extensions&&Vo(r,f,s),f})}createUniqueName(e){const t=p.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(l){return i[Ar.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(u){return ec(u,l,t)})}const o=[];for(let l=0,u=e.length;l<u;l++){const h=e[l],f=zc(h),g=r[f];if(g)o.push(g.promise);else{let _;_=h.extensions&&h.extensions[Ar.KHR_DRACO_MESH_COMPRESSION]?s(h):ec(new p.u9r,h,t),r[f]={primitive:h,promise:_},o.push(_)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,l=[];for(let h=0,f=o.length;h<f;h++){const g=o[h].material===void 0?((u=this.cache).DefaultMaterial===void 0&&(u.DefaultMaterial=new kr.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p.Wl3})),u.DefaultMaterial):this.getDependency("material",o[h].material);l.push(g)}var u;return l.push(t.loadGeometries(o)),Promise.all(l).then(function(h){const f=h.slice(0,h.length-1),g=h[h.length-1],_=[];for(let x=0,E=g.length;x<E;x++){const T=g[x],R=o[x];let I;const S=f[x];if(R.mode===go.TRIANGLES||R.mode===go.TRIANGLE_STRIP||R.mode===go.TRIANGLE_FAN||R.mode===void 0)I=s.isSkinnedMesh===!0?new p.TUv(T,S):new p.Kj0(T,S),I.isSkinnedMesh===!0&&I.normalizeSkinWeights(),R.mode===go.TRIANGLE_STRIP?I.geometry=ce(I.geometry,p.UlW):R.mode===go.TRIANGLE_FAN&&(I.geometry=ce(I.geometry,p.z$h));else if(R.mode===go.LINES)I=new p.ejS(T,S);else if(R.mode===go.LINE_STRIP)I=new p.x12(T,S);else if(R.mode===go.LINE_LOOP)I=new p.blk(T,S);else{if(R.mode!==go.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+R.mode);I=new p.woe(T,S)}Object.keys(I.geometry.morphAttributes).length>0&&Go(I,s),I.name=t.createUniqueName(s.name||"mesh_"+e),I.geometry&&s.extras&&s.extras.isGeometryUserData?(da(I.geometry,s),R.extensions&&Vo(r,I.geometry,R)):(da(I,s),R.extensions&&Vo(r,I,R)),t.assignFinalMaterial(I),_.push(I)}s.extensions&&_.forEach(x=>Vo(r,x,s));for(let x=0,E=_.length;x<E;x++)t.associations.set(_[x],{meshes:e,primitives:x});if(_.length===1)return s.extensions&&Vo(r,_[0],s),_[0];const A=new p.ZAu;s.extensions&&Vo(r,A,s),t.associations.set(A,{meshes:e});for(let x=0,E=_.length;x<E;x++)A.add(_[x]);return A})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return i.type==="perspective"?t=new kr.ObjectConstructors.PerspectiveCamera(p.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new kr.ObjectConstructors.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),da(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,l=[],u=[];for(let h=0,f=o.length;h<f;h++){const g=o[h];if(g){l.push(g);const _=new p.yGw;s!==null&&_.fromArray(s.array,16*h),u.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new p.OdW(l,u)})}loadAnimation(e){const t=this.json.animations[e],i=t.name?t.name:"animation_"+e,r=[],s=[],o=[],l=[],u=[];for(let h=0,f=t.channels.length;h<f;h++){const g=t.channels[h],_=t.samplers[g.sampler],A=g.target,x=A.node,E=t.parameters!==void 0?t.parameters[_.input]:_.input,T=t.parameters!==void 0?t.parameters[_.output]:_.output;A.node!==void 0&&(r.push(this.getDependency("node",x)),s.push(this.getDependency("accessor",E)),o.push(this.getDependency("accessor",T)),l.push(_),u.push(A))}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(u)]).then(function(h){const f=h[0],g=h[1],_=h[2],A=h[3],x=h[4],E=[];for(let T=0,R=f.length;T<R;T++){const I=f[T],S=g[T],O=_[T],k=A[T],N=x[T];if(I===void 0)continue;let H;switch(I.updateMatrix(),vo[N.path]){case vo.weights:H=p.dUE;break;case vo.rotation:H=p.iLg;break;default:H=p.yC1}const X=I.name?I.name:I.uuid,te=k.interpolation!==void 0?Av[k.interpolation]:p.NMF,re=[];vo[N.path]===vo.weights?I.traverse(function(le){le.morphTargetInfluences&&re.push(le.name?le.name:le.uuid)}):re.push(X);let ue=O.array;if(O.normalized){const le=fn(ue.constructor),se=new Float32Array(ue.length);for(let de=0,ve=ue.length;de<ve;de++)se[de]=ue[de]*le;ue=se}for(let le=0,se=re.length;le<se;le++){const de=new H(re[le]+"."+vo[N.path],S.array,ue,te);k.interpolation==="CUBICSPLINE"&&(de.createInterpolant=function(ve){return new(this instanceof p.iLg?hf:Fc)(this.times,this.values,this.getValueSize()/3,ve)},de.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(de)}}return new p.m7l(i,void 0,E)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(l){if(l.isMesh)for(let u=0,h=r.weights.length;u<h;u++)l.morphTargetInfluences[u]=r.weights[u]}),o})}loadNode(e){const t=this,i=this.json.nodes[e],r=t._loadNodeShallow(e),s=[],o=i.children||[];for(let u=0,h=o.length;u<h;u++)s.push(t.getDependency("node",o[u]));const l=i.skin===void 0?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([r,Promise.all(s),l]).then(function(u){const h=u[0],f=u[1],g=u[2];g!==null&&h.traverse(function(_){_.isSkinnedMesh&&_.bind(g,wv)});for(let _=0,A=f.length;_<A;_++)h.add(f[_]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",l=[],u=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return u&&l.push(u),s.camera!==void 0&&l.push(r.getDependency("camera",s.camera).then(function(h){return r._getNodeRef(r.cameraCache,s.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let f;if(f=s.isBone===!0?new p.N$j:h.length>1?new p.ZAu:h.length===1?h[0]:new p.Tme,f!==h[0])for(let g=0,_=h.length;g<_;g++)f.add(h[g]);if(s.name&&(f.userData.name=s.name,f.name=o),da(f,s),s.extensions&&Vo(i,f,s),s.matrix!==void 0){const g=new p.yGw;g.fromArray(s.matrix),f.applyMatrix4(g)}else s.translation!==void 0&&f.position.fromArray(s.translation),s.rotation!==void 0&&f.quaternion.fromArray(s.rotation),s.scale!==void 0&&f.scale.fromArray(s.scale);return r.associations.has(f)||r.associations.set(f,{}),r.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new p.ZAu;i.name&&(s.name=r.createUniqueName(i.name)),da(s,i),i.extensions&&Vo(t,s,i);const o=i.nodes||[],l=[];for(let u=0,h=o.length;u<h;u++)l.push(r.getDependency("node",o[u]));return Promise.all(l).then(function(u){for(let h=0,f=u.length;h<f;h++)s.add(u[h]);return r.associations=(h=>{const f=new Map;for(const[g,_]of r.associations)(g instanceof p.F5T||g instanceof p.xEZ)&&f.set(g,_);return h.traverse(g=>{const _=r.associations.get(g);_!=null&&f.set(g,_)}),f})(s),s})}}function ec(a,e,t){const i=e.attributes,r=[];function s(o,l){return t.getDependency("accessor",o).then(function(u){a.setAttribute(l,u)})}for(const o in i){const l=df[o]||o.toLowerCase();l in a.attributes||r.push(s(i[o],l))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});r.push(o)}return da(a,e),function(o,l,u){const h=l.attributes,f=new p.ZzF;if(h.POSITION===void 0)return;{const A=u.json.accessors[h.POSITION],x=A.min,E=A.max;if(x===void 0||E===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(f.set(new p.Pa4(x[0],x[1],x[2]),new p.Pa4(E[0],E[1],E[2])),A.normalized){const T=fn(fh[A.componentType]);f.min.multiplyScalar(T),f.max.multiplyScalar(T)}}const g=l.targets;if(g!==void 0){const A=new p.Pa4,x=new p.Pa4;for(let E=0,T=g.length;E<T;E++){const R=g[E];if(R.POSITION!==void 0){const I=u.json.accessors[R.POSITION],S=I.min,O=I.max;if(S!==void 0&&O!==void 0){if(x.setX(Math.max(Math.abs(S[0]),Math.abs(O[0]))),x.setY(Math.max(Math.abs(S[1]),Math.abs(O[1]))),x.setZ(Math.max(Math.abs(S[2]),Math.abs(O[2]))),I.normalized){const k=fn(fh[I.componentType]);x.multiplyScalar(k)}A.max(x)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}f.expandByVector(A)}o.boundingBox=f;const _=new p.aLr;f.getCenter(_.center),_.radius=f.min.distanceTo(f.max)/2,o.boundingSphere=_}(a,e,t),Promise.all(r).then(function(){return e.targets!==void 0?function(o,l,u){let h=!1,f=!1,g=!1;for(let E=0,T=l.length;E<T;E++){const R=l[E];if(R.POSITION!==void 0&&(h=!0),R.NORMAL!==void 0&&(f=!0),R.COLOR_0!==void 0&&(g=!0),h&&f&&g)break}if(!h&&!f&&!g)return Promise.resolve(o);const _=[],A=[],x=[];for(let E=0,T=l.length;E<T;E++){const R=l[E];if(h){const I=R.POSITION!==void 0?u.getDependency("accessor",R.POSITION):o.attributes.position;_.push(I)}if(f){const I=R.NORMAL!==void 0?u.getDependency("accessor",R.NORMAL):o.attributes.normal;A.push(I)}if(g){const I=R.COLOR_0!==void 0?u.getDependency("accessor",R.COLOR_0):o.attributes.color;x.push(I)}}return Promise.all([Promise.all(_),Promise.all(A),Promise.all(x)]).then(function(E){const T=E[0],R=E[1],I=E[2];return h&&(o.morphAttributes.position=T),f&&(o.morphAttributes.normal=R),g&&(o.morphAttributes.color=I),o.morphTargetsRelative=!0,o})}(a,e.targets,t):a})}class ts extends kr{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(Kr)}async preparse(e,t){for(const i of this.preparsers)e=await i.process(e,t);return e}parse(e,t,i,r,s){this.preparse.call(this,e,s||t).then(o=>o?super.parse(o,t,i,r):r&&r(new ErrorEvent("no data"))).catch(o=>{console.error(o),r&&r(o??new ErrorEvent("unknown error"))})}transform(e,t){const i=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return i&&e.animations.length>0&&(i.animations=e.animations),i==null||i.traverse(r=>{r.userData.gltfUUID&&(r.uuid=r.userData.gltfUUID,delete r.userData.gltfUUID)}),i}register(e){return super.register(e)}}const Kr={key:(a,e,t)=>a.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(a,e){var t;if(typeof a=="string"||!new TextDecoder().decode(new Uint8Array(a,0,100)).includes("WebGiGLBWrapper"))return a;const i=new El(a),r=JSON.parse(i.content||"{}");let s=i.body||a;const o=(t=r.asset)===null||t===void 0?void 0:t.encryption;if(!o)return s;const l=o.type,u=o.version;if(l==="aesgcm"&&u===1){const h=await(0,V.getOrCall)(this.key,o,r,e)||"";try{s=(await(0,V.aesGcmDecrypt)(new Uint8Array(s),h)).buffer}catch{throw new ErrorEvent("decryption error")}}return s}};class pa extends p.hH6{constructor(e){super(e),this.type=p.cLu}async loadAsync(e,t){const i=await this.parseAsync(e,t,!1),r=new p.IEO(i.data,i.width,i.height,p.wk1,this.type);return r.needsUpdate=!0,r.flipY=!0,r.colorSpace=p.KI_,r.minFilter=p.wem,r.magFilter=p.wem,r.source.data.complete=!0,r}async parseAsync(e,t,i=!1){let r=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const l=await super.loadAsync(e,t);e=URL.createObjectURL(l),r=!0}const s=await(0,V.imageUrlToImageData)(e);r&&URL.revokeObjectURL(e);let o=Uint8Array;return this.type===p.cLu?o=Uint16Array:this.type===p.VzW&&(o=Uint32Array),{data:function(l,u=3,h=Uint16Array,f=!1){let g;const _=l.byteLength>>2,A=new h(_*u);for(let x=0;x<_;x++)g=Math.pow(2,l[4*x+3]-136),f?(A[x*u]=Math.min(l[4*x]*g,65504),A[x*u+1]=Math.min(l[4*x+1]*g,65504),A[x*u+2]=Math.min(l[4*x+2]*g,65504)):(A[x*u]=p.A5E.toHalfFloat(Math.min(l[4*x]*g,65504)),A[x*u+1]=p.A5E.toHalfFloat(Math.min(l[4*x+1]*g,65504)),A[x*u+2]=p.A5E.toHalfFloat(Math.min(l[4*x+2]*g,65504))),u===4&&(A[x*u+3]=p.A5E.toHalfFloat(1));return A}(s.data,4,o,i),width:s.width,height:s.height}}setDataType(e){return this.type=e,this}}class Cl extends p.Gql{constructor(e){super(e),this._imageLoader=new p.S3k(e)}static async LoadRootPathTextures(e,t,i,r=!0){var s;const o=[];for(const l of Array.isArray(e)?e:Object.values(e??{})){const u=(s=l==null?void 0:l.userData)===null||s===void 0?void 0:s.rootPath,h=r&&l.image&&t[l.image];if(!u)continue;const f=i.importPath(u,{processImported:!1}).then(g=>{const _=g==null?void 0:g[0],A=_==null?void 0:_.source;if(!_||!A)return null;const x=new p.Hw6(A.data);return l.image&&(x.uuid=l.image),l.image=x.uuid,h||(t[x.uuid]=x),_.dispose(),x}).catch(g=>(console.error(g),delete l.userData.rootPath,null));h?l.rootPathPromise=f:o.push(f)}await Promise.allSettled(o)}parseTextures2(e,t,i){var r,s;for(const u of e){const h=(r=u==null?void 0:u.userData)===null||r===void 0?void 0:r.rootPath;if(h&&(!u.image||!t[u.image])){const f=new p.Hw6(this._imageLoader.load(h,i));if(!f)continue;u.image&&(f.uuid=u.image),t[f.uuid]=f,u.image=f.uuid}u.userData=br(u.userData,void 0,!1,{images:t})}const o=super.parseTextures(e,t),l={...o};for(const u of e)(s=u.rootPathPromise)===null||s===void 0||s.then(h=>{if(!h)return;const f=l[u.uuid];f.dispose(),f.source=h,f.source.needsUpdate=!0,f.needsUpdate=!0});return o}parseMaterials2(e,t,i){const r={};return e.forEach(s=>{if(!s)return;const o={...s},l=Object.keys(o);for(const h of l)if(h==="map"||h.endsWith("Map")){const f=o[h];typeof f=="string"&&(t[f]?o[h]=t[f]:(console.warn(`Texture ${f} not found`),delete o[h]))}o.userData&&(o.userData=br(o.userData,void 0,!1,{textures:t}),o.userData.cloneId&&o.userData.uuid!==s.uuid&&(o.userData.uuid=s.uuid));const u=i.generateFromTemplateType(o.type,o);u&&(r[s.uuid]=u)}),r}}const fa="WEBGI_viewer";function pf(a){return new Tn(ts,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const i=e,r=new Cl(t.loadingManager);return i.register(Jt(r,a)),i.register(xv()),i.register(_r(r)),i.register(s=>new xm(s)),i.register(s=>new gh(s)),i.register(s=>new vh(s)),i.register(s=>new kd(s)),i.register(s=>{var o,l,u,h,f,g,_,A,x;const E=s.getDependency;s.getDependency=async(O,k)=>{const N=await E.call(s,O,k);if(N&&N.userData){const H=N.userData.gltfExtensions;delete N.userData.gltfExtensions,N.userData=br(N.userData,{},!1,{}),N.userData.gltfExtensions=H}return N};const T=Wn()+".drc",R=Wn()+".ktx2",I=(u=(l=(o=s.json)===null||o===void 0?void 0:o.extensionsRequired)===null||l===void 0?void 0:l.includes)===null||u===void 0?void 0:u.call(l,"KHR_draco_mesh_compression");if(I){const O=t.registerFile(T);O&&i.setDRACOLoader(O)}!((g=(f=(h=s.json)===null||h===void 0?void 0:h.extensionsUsed)===null||f===void 0?void 0:f.includes)===null||g===void 0)&&g.call(f,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(i.setMeshoptDecoder(window.MeshoptDecoder),s.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const S=(x=(A=(_=s.json)===null||_===void 0?void 0:_.extensionsUsed)===null||A===void 0?void 0:A.includes)===null||x===void 0?void 0:x.call(A,"KHR_texture_basisu");if(S){const O=t.registerFile(R);O&&(i.setKTX2Loader(O),s.options.ktx2Loader=O)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async O=>{I&&t.unregisterFile(T),S&&t.unregisterFile(R);const k=await Od(s,a,r);O.scene&&(O.scene.__importedViewerConfig=k)}}}),i})}const Ho="WEBGI_light_extras",is="WEBGI_object3d_extras",Ji="WEBGI_material_extras",xv=a=>e=>({name:"__"+is,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(i=>{i.traverse(r=>{var s,o;if(!r||!r.isObject3D)return;const l=(o=(s=r.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||o===void 0?void 0:o[is];if(!l)return void(r.isLight&&!r.isAmbientLight&&(r.castShadow=!0));const u=l.castShadow!==void 0||l.receiveShadow!==void 0;l.castShadow!==void 0&&(r.castShadow=l.castShadow),l.receiveShadow!==void 0&&(r.receiveShadow=l.receiveShadow),l.visible!==void 0&&(r.visible=l.visible),l.frustumCulled!==void 0&&(r.frustumCulled=l.frustumCulled),l.renderOrder!==void 0&&(r.renderOrder=l.renderOrder),l.layers!==void 0&&(r.layers.mask=l.layers),u&&(r.userData.__keepShadowDef=!0),delete r.userData.gltfExtensions[is]})})}}),Jt=(a,e)=>t=>({name:"__"+Ji,afterRoot:async i=>{var r,s,o;const l=i.scenes||(i.scene?[i.scene]:[]);for(const u of l){const h=(s=(r=u.userData)===null||r===void 0?void 0:r.gltfExtensions)===null||s===void 0?void 0:s[Ji],f=h&&await((o=e.getPlugin(Ut))===null||o===void 0?void 0:o.importConfigResources(h.resources||{}))||{};u.traverse(g=>{var _,A;const x=g==null?void 0:g.material;if(!(x!=null&&x.isMaterial))return;const E=(A=(_=x.userData)===null||_===void 0?void 0:_.gltfExtensions)===null||A===void 0?void 0:A[Ji];E&&(E.emissiveIntensity!==void 0&&(x.emissiveIntensity=E.emissiveIntensity),E.fog!==void 0&&(x.fog=E.fog),E.flatShading!==void 0&&(x.flatShading=E.flatShading),E.blending!==void 0&&(x.blending=E.blending),E.side!==void 0&&(x.side=E.side),E.shadowSide!==void 0&&(x.shadowSide=E.shadowSide),E.depthFunc!==void 0&&(x.depthFunc=E.depthFunc),E.depthTest!==void 0&&(x.depthTest=E.depthTest),E.depthWrite!==void 0&&(x.depthWrite=E.depthWrite),E.colorWrite!==void 0&&(x.colorWrite=E.colorWrite),E.vertexColors!==void 0&&(x.vertexColors=E.vertexColors),E.alphaTest!==void 0&&(x.alphaTest=E.alphaTest),E.envMapIntensity!==void 0&&(x.envMapIntensity=E.envMapIntensity),E.wireframe!==void 0&&(x.wireframe=E.wireframe),E.wireframeLinewidth!==void 0&&(x.wireframeLinewidth=E.wireframeLinewidth),E.wireframeLinecap!==void 0&&(x.wireframeLinecap=E.wireframeLinecap),E.wireframeLinejoin!==void 0&&(x.wireframeLinejoin=E.wireframeLinejoin),E.rotation!==void 0&&(x.rotation=E.rotation),E.polygonOffset!==void 0&&(x.polygonOffset=E.polygonOffset),E.polygonOffsetFactor!==void 0&&(x.polygonOffsetFactor=E.polygonOffsetFactor),E.polygonOffsetUnits!==void 0&&(x.polygonOffsetUnits=E.polygonOffsetUnits),E.dithering!==void 0&&(x.dithering=E.dithering),E.alphaToCoverage!==void 0&&(x.alphaToCoverage=E.alphaToCoverage),E.premultipliedAlpha!==void 0&&(x.premultipliedAlpha=E.premultipliedAlpha),E.toneMapped!==void 0&&(x.toneMapped=E.toneMapped),E.normalScale!==void 0&&x.normalScale!==void 0&&(Array.isArray(E.normalScale)?x.normalScale.fromArray(E.normalScale):typeof E.normalScale=="number"?x.normalScale.set(E.normalScale,E.normalScale):e.console.warn("normalScale is not an array or number",E.normalScale)),E.reflectivity!==void 0&&(x.reflectivity=E.reflectivity),Object.entries(E).forEach(([T,R])=>{T.startsWith("_")||R&&R.resource&&typeof R.resource=="string"&&(x[T]=br(R,x[T],!1,f))}),delete x.userData.gltfExtensions[Ji])}),h&&delete u.userData.gltfExtensions[Ji]}}}),_r=a=>e=>({name:"__"+Ho,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(i=>{i.traverse(r=>{var s,o;if(!r.isLight)return;const l=(o=(s=r.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||o===void 0?void 0:o[Ho];l&&(!r.shadow&&l.shadow&&console.error("Light has no shadow, cannot import",r,l),l.shadow&&r.shadow&&(l.shadow.bias!==void 0&&(r.shadow.bias=l.shadow.bias),l.shadow.normalBias!==void 0&&(r.shadow.normalBias=l.shadow.normalBias),l.shadow.radius!==void 0&&(r.shadow.radius=l.shadow.radius),l.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(l.shadow.mapSize),l.shadow.camera!==void 0&&(r.shadow.camera=a.parseObject(l.shadow.camera))),delete r.userData.gltfExtensions[Ho])})})}});async function Od(a,e,t,i){var r,s,o;if(!i){const g=a.json.scenes||[];if(g.length!==1){for(const _ of g)await Od(a,e,t,_);return}i=g[0]}const l=(r=i.extensions)===null||r===void 0?void 0:r[fa];if(!l)return;const u=[];Object.values(l.resources).forEach(g=>{Object.values(g).forEach(_=>{_.url&&(_.url.type==="Uint16Array"&&_.url.data&&u.push(_.url),_.url.type==="Uint8Array"&&_.url.data&&u.push(_.url))})});for(const g of u){const _=g.data.image,A=a.json.images[_],x=await a.getDependency("bufferView",A.bufferView);if(A.mimeType.startsWith("image/")&&g.type==="Uint16Array"&&g.encoding==="rgbe"){const E=new Blob([x]);let T=URL.createObjectURL(E);(g.encodingVersion||1)<2&&(T="data:image/png;base64,"+btoa(await E.text())),g.data=(await new pa().parseAsync(T,void 0,!0)).data,URL.revokeObjectURL(T),delete g.encoding,delete g.encodingVersion}else g.data=x}const h={textures:{},materials:{}},f=l.resources;if(f.textures&&a.json.textures)for(const[g,_]of[...Object.entries(f.textures)]){if(_.uuid||!g)continue;delete f.textures[g];const A=a.json.textures.findIndex(x=>{var E,T,R,I,S,O,k;return((E=x.extras)===null||E===void 0?void 0:E.uuid)===g||((I=(R=(T=a.json.samplers)===null||T===void 0?void 0:T[x.sampler])===null||R===void 0?void 0:R.extras)===null||I===void 0?void 0:I.uuid)===g||((k=(O=(S=a.json.images)===null||S===void 0?void 0:S[x.source])===null||O===void 0?void 0:O.extras)===null||k===void 0?void 0:k.t_uuid)===g});A>=0&&(h.textures[g]=await a.getDependency("texture",A))}if(f.materials&&a.json.materials)for(const[g,_]of[...Object.entries(f.materials)]){if(_.uuid||!g)continue;delete f.materials[g];const A=a.json.materials.findIndex(x=>{var E;return((E=x.extras)===null||E===void 0?void 0:E.uuid)===g});A>=0&&(h.materials[g]=await a.getDependency("material",A),h.materials[g]=(o=(s=e.getPlugin(Ut))===null||s===void 0?void 0:s.materials)===null||o===void 0?void 0:o.processMaterial(h.materials[g],{}))}return l.resources=await e.getPlugin(Ut).importConfigResources(f||{},t,h),l}const mh="WEBGI_materials_bumpmap",Ld="WEBGI_materials_displacementmap",Ml="WEBGI_materials_alphamap",tc="WEBGI_materials_lightmap";class xm{constructor(e){this.parser=e,this.name=mh}async extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.bumpScale!==void 0&&(t.bumpScale=o.bumpScale),o.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class gh{constructor(e){this.parser=e,this.name=Ld}async extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.displacementScale!==void 0&&(t.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(t.displacementBias=o.displacementBias),o.displacementTexture!==void 0&&s.push(i.assignTexture(t,"displacementMap",o.displacementTexture)),Promise.all(s)}}class vh{constructor(e){this.parser=e,this.name=tc}async extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.lightMapIntensity!==void 0&&(t.lightMapIntensity=o.lightMapIntensity),o.lightMapTexture!==void 0&&s.push(i.assignTexture(t,"lightMap",o.lightMapTexture)),Promise.all(s)}}class kd{constructor(e){this.parser=e,this.name=Ml}async extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.alphaTexture!==void 0&&s.push(i.assignTexture(t,"alphaMap",o.alphaTexture)),Promise.all(s)}}var Em=__webpackgi_require__(23);function ff(){return new Tn(Em.Q,["drc"],!0)}class Ud extends p.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new p.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const i=this.target,r=e.userData;return e.userData={},super.copy(e,t),ms(this.userData,r),i.position.copy(this.target.position),i.updateMatrixWorld(),this.target=i,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:i}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=cr(ms({},t),!1),this.userData={},this.children=i,r.type="DirectionalLight2",r.target=this.target.position.toArray(),Object.assign(r,cr(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const i=e.target,r=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,br(e,this,!0,t),i&&(e.target=i),r&&(r.color!==void 0&&this.color.set(r.color),r.intensity!==void 0&&(this.intensity=r.intensity),e.object=r),this}}class mf extends p.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,i,r,s,o){super(e,t,i,r,s,o),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const i=this.target,r=e.userData;return e.userData={},super.copy(e,t),ms(this.userData,r),i.position.copy(this.target.position),i.updateMatrixWorld(),this.target=i,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:i}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=cr(ms({},t),!1),this.userData={},this.children=i,r.type="SpotLight2",r.target=this.target.position.toArray(),Object.assign(r,cr(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),br(e,this,!0,t),this):this)}}class ta extends p.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,i,r){super(e,t,i,r),this.assetType="light"}copy(e,t){const i=e.userData;return e.userData={},super.copy(e,t),ms(this.userData,i),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const i=super.toJSON(e);return i.userData=cr(ms({},t),!1),this.userData={},i.type="PointLight2",Object.assign(i,cr(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),br(e,this,!0,t),this):this}}class ic extends p.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const i=e.userData;return e.userData={},super.copy(e,t),ms(this.userData,i),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const i=super.toJSON(e);return i.userData=cr(ms({},t),!1),this.userData={},i.type="AmbientLight2",Object.assign(i,cr(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),br(e,this,!0,t),this):this}}class Sm extends p.aNw{load(e,t,i,r){const s=new p.hH6(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(e,o=>{try{t(this.parse(o))}catch(l){r?r(l):console.error(l),this.manager.itemError(e)}},i,r)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,i=null;const r=new p.Pa4(0,0,0),s=new p.Pa4(1,1,1),o=e.split(/[\n\r]+/g);let l=null,u=0;for(let g=0,_=o.length;g<_;g++){const A=o[g].trim(),x=A.split(/\s/g);switch(x[0]){case"TITLE":t=A.substring(7,A.length-1);break;case"LUT_3D_SIZE":const E=x[1];i=parseFloat(E),l=new Uint8Array(i*i*i*4);break;case"DOMAIN_MIN":r.x=parseFloat(x[1]),r.y=parseFloat(x[2]),r.z=parseFloat(x[3]);break;case"DOMAIN_MAX":s.x=parseFloat(x[1]),s.y=parseFloat(x[2]),s.z=parseFloat(x[3]);break;default:const T=parseFloat(x[0]),R=parseFloat(x[1]),I=parseFloat(x[2]);if(T>1||T<0||R>1||R<0||I>1||I<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");l[u+0]=255*T,l[u+1]=255*R,l[u+2]=255*I,l[u+3]=255,u+=4}}const h=new p.IEO;h.image.data=l,h.image.width=i,h.image.height=i*i,h.type=p.ywz,h.magFilter=p.wem,h.minFilter=p.wem,h.wrapS=p.uWy,h.wrapT=p.uWy,h.generateMipmaps=!1,h.needsUpdate=!0;const f=new p.JUT;return f.image.data=l,f.image.width=i,f.image.height=i,f.image.depth=i,f.type=p.ywz,f.magFilter=p.wem,f.minFilter=p.wem,f.wrapS=p.uWy,f.wrapT=p.uWy,f.wrapR=p.uWy,f.generateMipmaps=!1,f.needsUpdate=!0,{title:t,size:i,domainMin:r,domainMax:s,texture:h,texture3D:f}}}let _h=class{constructor({domainMax:a,domainMin:e,size:t,texture:i,texture3D:r,title:s}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=a,this.domainMin=e,this.size=t,this.texture=i,this.texture3D=r,this.title=s,this.uuid=p.M8C.generateUUID(),this.userData.__needsSourceBuffer=!0}fromJSON(a,e){return a.type!==this.type&&console.warn("WebGi LUTCubeLoader2: type mismatch while import",a,this),console.error("not supported"),this}toJSON(a){return dn(this,a,this.texture.name)}};_h=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([$n("LUTCubeTextureWrapper")],_h);class yu extends Sm{parse(e){const t=super.parse(e);return new _h(t)}}var Nd={},Mr=Uint8Array,xr=Uint16Array,Tr=Uint32Array,zs=new Mr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qo=new Mr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rc=new Mr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gf=function(a,e){for(var t=new xr(31),i=0;i<31;++i)t[i]=e+=1<<a[i-1];var r=new Tr(t[30]);for(i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)r[s]=s-t[i]<<5|i;return[t,r]},Ev=gf(zs,2),Vc=Ev[0],Vs=Ev[1];Vc[28]=258,Vs[258]=28;for(var Se=gf(Qo,0),yh=Se[0],vf=Se[1],ia=new xr(32768),Ur=0;Ur<32768;++Ur){var ma=(43690&Ur)>>>1|(21845&Ur)<<1;ma=(61680&(ma=(52428&ma)>>>2|(13107&ma)<<2))>>>4|(3855&ma)<<4,ia[Ur]=((65280&ma)>>>8|(255&ma)<<8)>>>1}var _s=function(a,e,t){for(var i=a.length,r=0,s=new xr(e);r<i;++r)++s[a[r]-1];var o,l=new xr(e);for(r=0;r<e;++r)l[r]=l[r-1]+s[r-1]<<1;if(t){o=new xr(1<<e);var u=15-e;for(r=0;r<i;++r)if(a[r])for(var h=r<<4|a[r],f=e-a[r],g=l[a[r]-1]++<<f,_=g|(1<<f)-1;g<=_;++g)o[ia[g]>>>u]=h}else for(o=new xr(i),r=0;r<i;++r)a[r]&&(o[r]=ia[l[a[r]-1]++]>>>15-a[r]);return o},Ma=new Mr(288);for(Ur=0;Ur<144;++Ur)Ma[Ur]=8;for(Ur=144;Ur<256;++Ur)Ma[Ur]=9;for(Ur=256;Ur<280;++Ur)Ma[Ur]=7;for(Ur=280;Ur<288;++Ur)Ma[Ur]=8;var Wo=new Mr(32);for(Ur=0;Ur<32;++Ur)Wo[Ur]=5;var bu=_s(Ma,9,0),Xo=_s(Ma,9,1),nc=_s(Wo,5,0),Gc=_s(Wo,5,1),Tl=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},ga=function(a,e,t){var i=e/8|0;return(a[i]|a[i+1]<<8)>>(7&e)&t},Au=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},qo=function(a){return(a/8|0)+(7&a&&1)},Ta=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var i=new(a instanceof xr?xr:a instanceof Tr?Tr:Mr)(t-e);return i.set(a.subarray(e,t)),i},wu=function(a,e,t){var i=a.length;if(!i||t&&!t.l&&i<5)return e||new Mr(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new Mr(3*i));var o=function(di){var Ai=e.length;if(di>Ai){var Wi=new Mr(Math.max(2*Ai,di));Wi.set(e),e=Wi}},l=t.f||0,u=t.p||0,h=t.b||0,f=t.l,g=t.d,_=t.m,A=t.n,x=8*i;do{if(!f){t.f=l=ga(a,u,1);var E=ga(a,u+1,3);if(u+=3,!E){var T=a[(ue=qo(u)+4)-4]|a[ue-3]<<8,R=ue+T;if(R>i){if(s)throw"unexpected EOF";break}r&&o(h+T),e.set(a.subarray(ue,R),h),t.b=h+=T,t.p=u=8*R;continue}if(E==1)f=Xo,g=Gc,_=9,A=5;else{if(E!=2)throw"invalid block type";var I=ga(a,u,31)+257,S=ga(a,u+10,15)+4,O=I+ga(a,u+5,31)+1;u+=14;for(var k=new Mr(O),N=new Mr(19),H=0;H<S;++H)N[rc[H]]=ga(a,u+3*H,7);u+=3*S;var X=Tl(N),te=(1<<X)-1,re=_s(N,X,1);for(H=0;H<O;){var ue,le=re[ga(a,u,te)];if(u+=15&le,(ue=le>>>4)<16)k[H++]=ue;else{var se=0,de=0;for(ue==16?(de=3+ga(a,u,3),u+=2,se=k[H-1]):ue==17?(de=3+ga(a,u,7),u+=3):ue==18&&(de=11+ga(a,u,127),u+=7);de--;)k[H++]=se}}var ve=k.subarray(0,I),fe=k.subarray(I);_=Tl(ve),A=Tl(fe),f=_s(ve,_,1),g=_s(fe,A,1)}if(u>x){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var Ee=(1<<_)-1,Je=(1<<A)-1,Te=u;;Te=u){var qe=(se=f[Au(a,u)&Ee])>>>4;if((u+=15&se)>x){if(s)throw"unexpected EOF";break}if(!se)throw"invalid length/literal";if(qe<256)e[h++]=qe;else{if(qe==256){Te=u,f=null;break}var Ve=qe-254;if(qe>264){var Ye=zs[H=qe-257];Ve=ga(a,u,(1<<Ye)-1)+Vc[H],u+=Ye}var Tt=g[Au(a,u)&Je],Xe=Tt>>>4;if(!Tt)throw"invalid distance";if(u+=15&Tt,fe=yh[Xe],Xe>3&&(Ye=Qo[Xe],fe+=Au(a,u)&(1<<Ye)-1,u+=Ye),u>x){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var Zt=h+Ve;h<Zt;h+=4)e[h]=e[h-fe],e[h+1]=e[h+1-fe],e[h+2]=e[h+2-fe],e[h+3]=e[h+3-fe];h=Zt}}t.l=f,t.p=Te,t.b=h,f&&(l=1,t.m=_,t.d=g,t.n=A)}while(!l);return h==e.length?e:Ta(e,0,h)},Ia=function(a,e,t){t<<=7&e;var i=e/8|0;a[i]|=t,a[i+1]|=t>>>8},Hc=function(a,e,t){t<<=7&e;var i=e/8|0;a[i]|=t,a[i+1]|=t>>>8,a[i+2]|=t>>>16},Pa=function(a,e){for(var t=[],i=0;i<a.length;++i)a[i]&&t.push({s:i,f:a[i]});var r=t.length,s=t.slice();if(!r)return[Ka,0];if(r==1){var o=new Mr(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(k,N){return k.f-N.f}),t.push({s:-1,f:25001});var l=t[0],u=t[1],h=0,f=1,g=2;for(t[0]={s:-1,f:l.f+u.f,l,r:u};f!=r-1;)l=t[t[h].f<t[g].f?h++:g++],u=t[h!=f&&t[h].f<t[g].f?h++:g++],t[f++]={s:-1,f:l.f+u.f,l,r:u};var _=s[0].s;for(i=1;i<r;++i)s[i].s>_&&(_=s[i].s);var A=new xr(_+1),x=_o(t[f-1],A,0);if(x>e){i=0;var E=0,T=x-e,R=1<<T;for(s.sort(function(k,N){return A[N.s]-A[k.s]||k.f-N.f});i<r;++i){var I=s[i].s;if(!(A[I]>e))break;E+=R-(1<<x-A[I]),A[I]=e}for(E>>>=T;E>0;){var S=s[i].s;A[S]<e?E-=1<<e-A[S]++-1:++i}for(;i>=0&&E;--i){var O=s[i].s;A[O]==e&&(--A[O],++E)}x=e}return[new Mr(A),x]},_o=function(a,e,t){return a.s==-1?Math.max(_o(a.l,e,t+1),_o(a.r,e,t+1)):e[a.s]=t},Fd=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new xr(++e),i=0,r=a[0],s=1,o=function(u){t[i++]=u},l=1;l<=e;++l)if(a[l]==r&&l!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=a[l]}return[t.subarray(0,i),e]},sc=function(a,e){for(var t=0,i=0;i<e.length;++i)t+=a[i]*e[i];return t},ys=function(a,e,t){var i=t.length,r=qo(e+2);a[r]=255&i,a[r+1]=i>>>8,a[r+2]=255^a[r],a[r+3]=255^a[r+1];for(var s=0;s<i;++s)a[r+s+4]=t[s];return 8*(r+4+i)},bh=function(a,e,t,i,r,s,o,l,u,h,f){Ia(e,f++,t),++r[256];for(var g=Pa(r,15),_=g[0],A=g[1],x=Pa(s,15),E=x[0],T=x[1],R=Fd(_),I=R[0],S=R[1],O=Fd(E),k=O[0],N=O[1],H=new xr(19),X=0;X<I.length;++X)H[31&I[X]]++;for(X=0;X<k.length;++X)H[31&k[X]]++;for(var te=Pa(H,7),re=te[0],ue=te[1],le=19;le>4&&!re[rc[le-1]];--le);var se,de,ve,fe,Ee=h+5<<3,Je=sc(r,Ma)+sc(s,Wo)+o,Te=sc(r,_)+sc(s,E)+o+14+3*le+sc(H,re)+(2*H[16]+3*H[17]+7*H[18]);if(Ee<=Je&&Ee<=Te)return ys(e,f,a.subarray(u,u+h));if(Ia(e,f,1+(Te<Je)),f+=2,Te<Je){se=_s(_,A,0),de=_,ve=_s(E,T,0),fe=E;var qe=_s(re,ue,0);for(Ia(e,f,S-257),Ia(e,f+5,N-1),Ia(e,f+10,le-4),f+=14,X=0;X<le;++X)Ia(e,f+3*X,re[rc[X]]);f+=3*le;for(var Ve=[I,k],Ye=0;Ye<2;++Ye){var Tt=Ve[Ye];for(X=0;X<Tt.length;++X){var Xe=31&Tt[X];Ia(e,f,qe[Xe]),f+=re[Xe],Xe>15&&(Ia(e,f,Tt[X]>>>5&127),f+=Tt[X]>>>12)}}}else se=bu,de=Ma,ve=nc,fe=Wo;for(X=0;X<l;++X)if(i[X]>255){Xe=i[X]>>>18&31,Hc(e,f,se[Xe+257]),f+=de[Xe+257],Xe>7&&(Ia(e,f,i[X]>>>23&31),f+=zs[Xe]);var Zt=31&i[X];Hc(e,f,ve[Zt]),f+=fe[Zt],Zt>3&&(Hc(e,f,i[X]>>>5&8191),f+=Qo[Zt])}else Hc(e,f,se[i[X]]),f+=de[i[X]];return Hc(e,f,se[256]),f+de[256]},jd=new Tr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ka=new Mr(0),Qc=function(a,e,t,i,r,s){var o=a.length,l=new Mr(i+o+5*(1+Math.ceil(o/7e3))+r),u=l.subarray(i,l.length-r),h=0;if(!e||o<8)for(var f=0;f<=o;f+=65535){var g=f+65535;g<o?h=ys(u,h,a.subarray(f,g)):(u[f]=s,h=ys(u,h,a.subarray(f,o)))}else{for(var _=jd[e-1],A=_>>>13,x=8191&_,E=(1<<t)-1,T=new xr(32768),R=new xr(E+1),I=Math.ceil(t/3),S=2*I,O=function(yt){return(a[yt]^a[yt+1]<<I^a[yt+2]<<S)&E},k=new Tr(25e3),N=new xr(288),H=new xr(32),X=0,te=0,re=(f=0,0),ue=0,le=0;f<o;++f){var se=O(f),de=32767&f,ve=R[se];if(T[de]=ve,R[se]=de,ue<=f){var fe=o-f;if((X>7e3||re>24576)&&fe>423){h=bh(a,u,0,k,N,H,te,re,le,f-le,h),re=X=te=0,le=f;for(var Ee=0;Ee<286;++Ee)N[Ee]=0;for(Ee=0;Ee<30;++Ee)H[Ee]=0}var Je=2,Te=0,qe=x,Ve=de-ve&32767;if(fe>2&&se==O(f-Ve))for(var Ye=Math.min(A,fe)-1,Tt=Math.min(32767,f),Xe=Math.min(258,fe);Ve<=Tt&&--qe&&de!=ve;){if(a[f+Je]==a[f+Je-Ve]){for(var Zt=0;Zt<Xe&&a[f+Zt]==a[f+Zt-Ve];++Zt);if(Zt>Je){if(Je=Zt,Te=Ve,Zt>Ye)break;var di=Math.min(Ve,Zt-2),Ai=0;for(Ee=0;Ee<di;++Ee){var Wi=f-Ve+Ee+32768&32767,Gi=Wi-T[Wi]+32768&32767;Gi>Ai&&(Ai=Gi,ve=Wi)}}}Ve+=(de=ve)-(ve=T[de])+32768&32767}if(Te){k[re++]=268435456|Vs[Je]<<18|vf[Te];var Ui=31&Vs[Je],wt=31&vf[Te];te+=zs[Ui]+Qo[wt],++N[257+Ui],++H[wt],ue=f+Je,++X}else k[re++]=a[f],++N[a[f]]}}h=bh(a,u,s,k,N,H,te,re,le,f-le,h),!s&&7&h&&(h=ys(u,h+1,Ka))}return Ta(l,0,i+qo(h)+r)},or=function(){for(var a=new Int32Array(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(1&t&&-306674912)^t>>>1;a[e]=t}return a}(),Yo=function(){var a=-1;return{p:function(e){for(var t=a,i=0;i<e.length;++i)t=or[255&t^e[i]]^t>>>8;a=t},d:function(){return~a}}},rs=function(){var a=1,e=0;return{p:function(t){for(var i=a,r=e,s=t.length,o=0;o!=s;){for(var l=Math.min(o+2655,s);o<l;++o)r+=i+=t[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}a=i,e=r},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Wc=function(a,e,t,i,r){return Qc(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,i,!r)},Il=function(a,e){var t={};for(var i in a)t[i]=a[i];for(var i in e)t[i]=e[i];return t},ac=function(a,e,t){for(var i=a(),r=a.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var l=i[o],u=s[o];if(typeof l=="function"){e+=";"+u+"=";var h=l.toString();if(l.prototype)if(h.indexOf("[native code]")!=-1){var f=h.indexOf(" ",8)+1;e+=h.slice(f,h.indexOf("(",f))}else for(var g in e+=h,l.prototype)e+=";"+u+".prototype."+g+"="+l.prototype[g].toString();else e+=h}else t[u]=l}return[e,t]},Ra=[],Da=function(a,e,t,i){var r;if(!Ra[t]){for(var s="",o={},l=a.length-1,u=0;u<l;++u)s=(r=ac(a[u],s,o))[0],o=r[1];Ra[t]=ac(a[l],s,o)}var h=Il({},Ra[t][1]);return function(f,g,_,A,x){var E=new Worker(Nd[g]||(Nd[g]=URL.createObjectURL(new Blob([f],{type:"text/javascript"}))));return E.onerror=function(T){return x(T.error,null)},E.onmessage=function(T){return x(null,T.data)},E.postMessage(_,A),E}(Ra[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,h,function(f){var g=[];for(var _ in f)(f[_]instanceof Mr||f[_]instanceof xr||f[_]instanceof Tr)&&g.push((f[_]=new f[_].constructor(f[_])).buffer);return g}(h),i)},Xc=function(){return[Mr,xr,Tr,zs,Qo,rc,Vc,yh,Xo,Gc,ia,_s,Tl,ga,Au,qo,Ta,wu,bs,Za,Ja]},xu=function(){return[Mr,xr,Tr,zs,Qo,rc,Vs,vf,bu,Ma,nc,Wo,ia,jd,Ka,_s,Ia,Hc,Pa,_o,Fd,sc,ys,bh,qo,Ta,Qc,Wc,Cu,Za]},Ah=function(){return[Su,ya,Hr,Yo,or]},Pl=function(){return[zd,Nr]},Cm=function(){return[yo,Hr,rs]},Mm=function(){return[yf]},Za=function(a){return postMessage(a,[a.buffer])},Ja=function(a){return a&&a.size&&new Mr(a.size)},oc=function(a,e,t,i,r,s){var o=Da(t,i,r,function(l,u){o.terminate(),s(l,u)});return o.postMessage([a,e],e.consume?[a.buffer]:[]),function(){o.terminate()}},qn=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},Eu=function(a,e,t,i,r){var s,o=Da(a,i,r,function(l,u){l?(o.terminate(),e.ondata.call(e,l)):(u[1]&&o.terminate(),e.ondata.call(e,l,u[0],u[1]))});o.postMessage(t),e.push=function(l,u){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([l,s=u],[l.buffer])},e.terminate=function(){o.terminate()}},va=function(a,e){return a[e]|a[e+1]<<8},Ln=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},_f=function(a,e){return Ln(a,e)+4294967296*Ln(a,e+4)},Hr=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},Su=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&Hr(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var i=0;i<=t.length;++i)a[i+10]=t.charCodeAt(i)}},zd=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;4&e&&(t+=a[10]|2+(a[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!a[t++]);return t+(2&e)},Nr=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},ya=function(a){return 10+(a.filename&&a.filename.length+1||0)},yo=function(a,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=i<<6|(i?32-2*i:1)},yf=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function $a(a,e){return e||typeof a!="function"||(e=a,a={}),this.ondata=e,a}var ba=function(){function a(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(Wc(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}(),Ba=function(){return function(a,e){Eu([xu,function(){return[qn,ba]}],this,$a.call(this,a,e),function(t){var i=new ba(t.data);onmessage=qn(i)},6)}}();function Tm(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[xu],function(i){return Za(Cu(i.data[0],i.data[1]))},0,t)}function Cu(a,e){return Wc(a,e||{},0,0)}var Ms=function(){function a(e){this.s={},this.p=new Mr(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,i=new Mr(t+e.length);i.set(this.p),i.set(e,t),this.p=i},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,i=wu(this.p,this.o,this.s);this.ondata(Ta(i,t,this.s.b),this.d),this.o=Ta(i,this.s.b-32768),this.s.b=this.o.length,this.p=Ta(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}(),wh=function(){return function(a){this.ondata=a,Eu([Xc,function(){return[qn,Ms]}],this,0,function(){var e=new Ms;onmessage=qn(e)},7)}}();function xh(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[Xc],function(i){return Za(bs(i.data[0],Ja(i.data[1])))},1,t)}function bs(a,e){return wu(a,e)}var bf=function(){function a(e,t){this.c=Yo(),this.l=0,this.v=1,ba.call(this,e,t)}return a.prototype.push=function(e,t){ba.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var i=Wc(e,this.o,this.v&&ya(this.o),t&&8,!t);this.v&&(Su(i,this.o),this.v=0),t&&(Hr(i,i.length-8,this.c.d()),Hr(i,i.length-4,this.l)),this.ondata(i,t)},a}(),Gs=function(){return function(a,e){Eu([xu,Ah,function(){return[qn,ba,bf]}],this,$a.call(this,a,e),function(t){var i=new bf(t.data);onmessage=qn(i)},8)}}();function Im(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[xu,Ah,function(){return[Vd]}],function(i){return Za(Vd(i.data[0],i.data[1]))},2,t)}function Vd(a,e){e||(e={});var t=Yo(),i=a.length;t.p(a);var r=Wc(a,e,ya(e),8),s=r.length;return Su(r,e),Hr(r,s-8,t.d()),Hr(r,s-4,i),r}var kn=function(){function a(e){this.v=1,Ms.call(this,e)}return a.prototype.push=function(e,t){if(Ms.prototype.e.call(this,e),this.v){var i=this.p.length>3?zd(this.p):4;if(i>=this.p.length&&!t)return;this.p=this.p.subarray(i),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ms.prototype.c.call(this,t)},a}(),Eh=function(){return function(a){this.ondata=a,Eu([Xc,Pl,function(){return[qn,Ms,kn]}],this,0,function(){var e=new kn;onmessage=qn(e)},9)}}();function Af(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[Xc,Pl,function(){return[xi]}],function(i){return Za(xi(i.data[0]))},3,t)}function xi(a,e){return wu(a.subarray(zd(a),-8),e||new Mr(Nr(a)))}var Ts=function(){function a(e,t){this.c=rs(),this.v=1,ba.call(this,e,t)}return a.prototype.push=function(e,t){ba.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var i=Wc(e,this.o,this.v&&2,t&&4,!t);this.v&&(yo(i,this.o),this.v=0),t&&Hr(i,i.length-4,this.c.d()),this.ondata(i,t)},a}(),qc=function(){return function(a,e){Eu([xu,Cm,function(){return[qn,ba,Ts]}],this,$a.call(this,a,e),function(t){var i=new Ts(t.data);onmessage=qn(i)},10)}}();function Rl(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[xu,Cm,function(){return[wf]}],function(i){return Za(wf(i.data[0],i.data[1]))},4,t)}function wf(a,e){e||(e={});var t=rs();t.p(a);var i=Wc(a,e,2,4);return yo(i,e),Hr(i,i.length-4,t.d()),i}var Is=function(){function a(e){this.v=1,Ms.call(this,e)}return a.prototype.push=function(e,t){if(Ms.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ms.prototype.c.call(this,t)},a}(),Sh=function(){return function(a){this.ondata=a,Eu([Xc,Mm,function(){return[qn,Ms,Is]}],this,0,function(){var e=new Is;onmessage=qn(e)},11)}}();function Sv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return oc(a,e,[Xc,Mm,function(){return[In]}],function(i){return Za(In(i.data[0],Ja(i.data[1])))},5,t)}function In(a,e){return wu((yf(a),a.subarray(2,-4)),e)}var Gd=function(){function a(e){this.G=kn,this.I=Ms,this.Z=Is,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var i=new Mr(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,s=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},a}(),on=function(){function a(e){this.G=Eh,this.I=wh,this.Z=Sh,this.ondata=e}return a.prototype.push=function(e,t){Gd.prototype.push.call(this,e,t)},a}();function Cv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Af(a,e,t):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?xh(a,e,t):Sv(a,e,t)}function F_(a,e){return a[0]==31&&a[1]==139&&a[2]==8?xi(a,e):(15&a[0])!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?bs(a,e):In(a,e)}var L=function(a,e,t,i){for(var r in a){var s=a[r],o=e+r;s instanceof Mr?t[o]=[s,i]:Array.isArray(s)?t[o]=[s[0],Il(i,s[1])]:L(s,o+"/",t,i)}},y=typeof TextEncoder<"u"&&new TextEncoder,M=typeof TextDecoder<"u"&&new TextDecoder,U=0;try{M.decode(Ka,{stream:!0}),U=1}catch{}var J=function(a){for(var e="",t=0;;){var i=a[t++],r=(i>127)+(i>223)+(i>239);if(t+r>a.length)return[e,Ta(a,t-1)];r?r==3?(i=((15&i)<<18|(63&a[t++])<<12|(63&a[t++])<<6|63&a[t++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&a[t++]):String.fromCharCode((15&i)<<12|(63&a[t++])<<6|63&a[t++]):e+=String.fromCharCode(i)}},xe=function(){function a(e){this.ondata=e,U?this.t=new TextDecoder:this.p=Ka}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var i=new Mr(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length);var r=J(i),s=r[0],o=r[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(s,t)}},a}(),pe=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(mt(e),this.d=t||!1)},a}();function mt(a,e){if(e){for(var t=new Mr(a.length),i=0;i<a.length;++i)t[i]=a.charCodeAt(i);return t}if(y)return y.encode(a);var r=a.length,s=new Mr(a.length+(a.length>>1)),o=0,l=function(f){s[o++]=f};for(i=0;i<r;++i){if(o+5>s.length){var u=new Mr(o+8+(r-i<<1));u.set(s),s=u}var h=a.charCodeAt(i);h<128||e?l(h):h<2048?(l(192|h>>6),l(128|63&h)):h>55295&&h<57344?(l(240|(h=65536+(1047552&h)|1023&a.charCodeAt(++i))>>18),l(128|h>>12&63),l(128|h>>6&63),l(128|63&h)):(l(224|h>>12),l(128|h>>6&63),l(128|63&h))}return Ta(s,0,o)}function $t(a,e){if(e){for(var t="",i=0;i<a.length;i+=16384)t+=String.fromCharCode.apply(null,a.subarray(i,i+16384));return t}if(M)return M.decode(a);var r=J(a),s=r[0];if(r[1].length)throw"invalid utf-8 data";return s}var gi=function(a){return a==1?3:a<6?2:a==9?1:0},ur=function(a,e){return e+30+va(a,e+26)+va(a,e+28)},cn=function(a,e,t){var i=va(a,e+28),r=$t(a.subarray(e+46,e+46+i),!(2048&va(a,e+8))),s=e+46+i,o=Ln(a,e+20),l=t&&o==4294967295?mn(a,s):[o,Ln(a,e+24),Ln(a,e+42)],u=l[0],h=l[1],f=l[2];return[va(a,e+10),u,h,r,s+va(a,e+30)+va(a,e+32),f]},mn=function(a,e){for(;va(a,e)!=1;e+=4+va(a,e+2));return[_f(a,e+12),_f(a,e+4),_f(a,e+20)]},gn=function(a){var e=0;if(a)for(var t in a){var i=a[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Wr=function(a,e,t,i,r,s,o,l){var u=i.length,h=t.extra,f=l&&l.length,g=gn(h);Hr(a,e,o!=null?33639248:67324752),e+=4,o!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(s==null&&8),a[e++]=r&&8,a[e++]=255&t.compression,a[e++]=t.compression>>8;var _=new Date(t.mtime==null?Date.now():t.mtime),A=_.getFullYear()-1980;if(A<0||A>119)throw"date not in range 1980-2099";if(Hr(a,e,A<<25|_.getMonth()+1<<21|_.getDate()<<16|_.getHours()<<11|_.getMinutes()<<5|_.getSeconds()>>>1),e+=4,s!=null&&(Hr(a,e,t.crc),Hr(a,e+4,s),Hr(a,e+8,t.size)),Hr(a,e+12,u),Hr(a,e+14,g),e+=16,o!=null&&(Hr(a,e,f),Hr(a,e+6,t.attrs),Hr(a,e+10,o),e+=14),a.set(i,e),e+=u,g)for(var x in h){var E=h[x],T=E.length;Hr(a,e,+x),Hr(a,e+2,T),a.set(E,e+4),e+=4+T}return f&&(a.set(l,e),e+=f),e},hr=function(a,e,t,i,r){Hr(a,e,101010256),Hr(a,e+8,t),Hr(a,e+10,t),Hr(a,e+12,i),Hr(a,e+16,r)},Yc=function(){function a(e){this.filename=e,this.c=Yo(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}(),lc=function(){function a(e,t){var i=this;t||(t={}),Yc.call(this,e),this.d=new ba(t,function(r,s){i.ondata(null,r,s)}),this.compression=8,this.flag=gi(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(i){this.ondata(i,null,t)}},a.prototype.push=function(e,t){Yc.prototype.push.call(this,e,t)},a}(),Mu=function(){function a(e,t){var i=this;t||(t={}),Yc.call(this,e),this.d=new Ba(t,function(r,s,o){i.ondata(r,s,o)}),this.compression=8,this.flag=gi(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){Yc.prototype.push.call(this,e,t)},a}(),xf=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var i=mt(e.filename),r=i.length,s=e.comment,o=s&&mt(s),l=r!=e.filename.length||o&&s.length!=o.length,u=r+gn(e.extra)+30;if(r>65535)throw"filename too long";var h=new Mr(u);Wr(h,0,e,i,l);var f=[h],g=function(){for(var T=0,R=f;T<R.length;T++){var I=R[T];t.ondata(null,I,!1)}f=[]},_=this.d;this.d=0;var A=this.u.length,x=Il(e,{f:i,u:l,o,t:function(){e.terminate&&e.terminate()},r:function(){if(g(),_){var T=t.u[A+1];T?T.r():t.d=1}_=1}}),E=0;e.ondata=function(T,R,I){if(T)t.ondata(T,R,I),t.terminate();else if(E+=R.length,f.push(R),I){var S=new Mr(16);Hr(S,0,134695760),Hr(S,4,e.crc),Hr(S,8,E),Hr(S,12,e.size),f.push(S),x.c=E,x.b=u+E+16,x.crc=e.crc,x.size=e.size,_&&x.r(),_=1}else _&&g()},this.u.push(x)},a.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,i=0,r=0,s=this.u;r<s.length;r++)i+=46+(h=s[r]).f.length+gn(h.extra)+(h.o?h.o.length:0);for(var o=new Mr(i+22),l=0,u=this.u;l<u.length;l++){var h=u[l];Wr(o,e,h,h.f,h.u,h.c,t,h.o),e+=46+h.f.length+gn(h.extra)+(h.o?h.o.length:0),t+=h.b}hr(o,e,this.u.length,i,t),this.ondata(null,o,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},a}();function Ch(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var i={};L(a,"",i,e);var r=Object.keys(i),s=r.length,o=0,l=0,u=s,h=new Array(s),f=[],g=function(){for(var E=0;E<f.length;++E)f[E]()},_=function(){var E=new Mr(l+22),T=o,R=l-o;l=0;for(var I=0;I<u;++I){var S=h[I];try{var O=S.c.length;Wr(E,l,S,S.f,S.u,O);var k=30+S.f.length+gn(S.extra),N=l+k;E.set(S.c,N),Wr(E,o,S,S.f,S.u,O,l,S.m),o+=16+k+(S.m?S.m.length:0),l=N+O}catch(H){return t(H,null)}}hr(E,o,h.length,R,T),t(null,E)};s||_();for(var A=function(E){var T=r[E],R=i[T],I=R[0],S=R[1],O=Yo(),k=I.length;O.p(I);var N=mt(T),H=N.length,X=S.comment,te=X&&mt(X),re=te&&te.length,ue=gn(S.extra),le=S.level==0?0:8,se=function(de,ve){if(de)g(),t(de,null);else{var fe=ve.length;h[E]=Il(S,{size:k,crc:O.d(),c:ve,f:N,m:te,u:H!=T.length||te&&X.length!=re,compression:le}),o+=30+H+ue+fe,l+=76+2*(H+ue)+(re||0)+fe,--s||_()}};if(H>65535&&se("filename too long",null),le)if(k<16e4)try{se(null,Cu(I,S))}catch(de){se(de,null)}else f.push(Tm(I,S,se));else se(null,I)},x=0;x<u;++x)A(x);return g}function Kc(a,e){e||(e={});var t={},i=[];L(a,"",t,e);var r=0,s=0;for(var o in t){var l=t[o],u=l[0],h=l[1],f=h.level==0?0:8,g=(H=mt(o)).length,_=h.comment,A=_&&mt(_),x=A&&A.length,E=gn(h.extra);if(g>65535)throw"filename too long";var T=f?Cu(u,h):u,R=T.length,I=Yo();I.p(u),i.push(Il(h,{size:u.length,crc:I.d(),c:T,f:H,m:A,u:g!=o.length||A&&_.length!=x,o:r,compression:f})),r+=30+g+E+R,s+=76+2*(g+E)+(x||0)+R}for(var S=new Mr(s+22),O=r,k=s-r,N=0;N<i.length;++N){var H=i[N];Wr(S,H.o,H,H.f,H.u,H.c.length);var X=30+H.f.length+gn(H.extra);S.set(H.c,H.o+X),Wr(S,r,H,H.f,H.u,H.c.length,H.o,H.m),r+=16+X+(H.m?H.m.length:0)}return hr(S,r,i.length,k,O),S}var Tu=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}(),j_=function(){function a(){var e=this;this.i=new Ms(function(t,i){e.ondata(null,t,i)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(i){this.ondata(i,e,t)}},a.compression=8,a}(),Mv=function(){function a(e,t){var i=this;t<32e4?this.i=new Ms(function(r,s){i.ondata(null,r,s)}):(this.i=new wh(function(r,s,o){i.ondata(r,s,o)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=Ta(e,0)),this.i.push(e,t)},a.compression=8,a}(),Tv=function(){function a(e){this.onfile=e,this.k=[],this.o={0:Tu},this.p=Ka}return a.prototype.push=function(e,t){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),s=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(s,!this.c):this.k[0].push(s),(e=e.subarray(r)).length)return this.push(e,t)}else{var o=0,l=0,u=void 0,h=void 0;this.p.length?e.length?((h=new Mr(this.p.length+e.length)).set(this.p),h.set(e,this.p.length)):h=this.p:h=e;for(var f=h.length,g=this.c,_=g&&this.d,A=function(){var T,R=Ln(h,l);if(R==67324752){o=1,u=l,x.d=null,x.c=0;var I=va(h,l+6),S=va(h,l+8),O=2048&I,k=8&I,N=va(h,l+26),H=va(h,l+28);if(f>l+30+N+H){var X=[];x.k.unshift(X),o=2;var te,re=Ln(h,l+18),ue=Ln(h,l+22),le=$t(h.subarray(l+30,l+=30+N),!O);re==4294967295?(T=k?[-2]:mn(h,l),re=T[0],ue=T[1]):k&&(re=-1),l+=H,x.c=re;var se={name:le,compression:S,start:function(){if(!se.ondata)throw"no callback";if(re){var de=i.o[S];if(!de)throw"unknown compression type "+S;(te=re<0?new de(le):new de(le,re,ue)).ondata=function(Je,Te,qe){se.ondata(Je,Te,qe)};for(var ve=0,fe=X;ve<fe.length;ve++){var Ee=fe[ve];te.push(Ee,!1)}i.k[0]==X&&i.c?i.d=te:te.push(Ka,!0)}else se.ondata(null,Ka,!0)},terminate:function(){te&&te.terminate&&te.terminate()}};re>=0&&(se.size=re,se.originalSize=ue),x.onfile(se)}return"break"}if(g){if(R==134695760)return u=l+=12+(g==-2&&8),o=3,x.c=0,"break";if(R==33639248)return u=l-=4,o=3,x.c=0,"break"}},x=this;l<f-4&&A()!=="break";++l);if(this.p=Ka,g<0){var E=o?h.subarray(0,u-12-(g==-2&&8)-(Ln(h,u-16)==134695760&&4)):h.subarray(0,l);_?_.push(E,!!o):this.k[+(o==2)].push(E)}if(2&o)return this.push(h.subarray(l),t);this.p=h.subarray(l)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function Iv(a,e){if(typeof e!="function")throw"no callback";for(var t=[],i=function(){for(var _=0;_<t.length;++_)t[_]()},r={},s=a.length-22;Ln(a,s)!=101010256;--s)if(!s||a.length-s>65558)return void e("invalid zip file",null);var o=va(a,s+8);o||e(null,{});var l=o,u=Ln(a,s+16),h=u==4294967295;if(h){if(s=Ln(a,s-12),Ln(a,s)!=101075792)return void e("invalid zip file",null);l=o=Ln(a,s+32),u=Ln(a,s+48)}for(var f=function(_){var A=cn(a,u,h),x=A[0],E=A[1],T=A[2],R=A[3],I=A[4],S=A[5],O=ur(a,S);u=I;var k=function(H,X){H?(i(),e(H,null)):(r[R]=X,--o||e(null,r))};if(x)if(x==8){var N=a.subarray(O,O+E);if(E<32e4)try{k(null,bs(N,new Mr(T)))}catch(H){k(H,null)}else t.push(xh(N,{size:T},k))}else k("unknown compression type "+x,null);else k(null,Ta(a,O,O+E))},g=0;g<l;++g)f();return i}function Mh(a){for(var e={},t=a.length-22;Ln(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var i=va(a,t+8);if(!i)return{};var r=Ln(a,t+16),s=r==4294967295;if(s){if(t=Ln(a,t-12),Ln(a,t)!=101075792)throw"invalid zip file";i=Ln(a,t+32),r=Ln(a,t+48)}for(var o=0;o<i;++o){var l=cn(a,r,s),u=l[0],h=l[1],f=l[2],g=l[3],_=l[4],A=l[5],x=ur(a,A);if(r=_,u){if(u!=8)throw"unknown compression type "+u;e[g]=bs(a.subarray(x,x+h),new Mr(f))}else e[g]=Ta(a,x,x+h)}return e}class Pv extends p.hH6{load(e,t,i,r){return this.setResponseType("arraybuffer"),super.load(e,s=>{const o=Mh(new Uint8Array(s)),l=new Map(Object.entries(o).map(([u,h])=>[u,new File([h],u)]));t==null||t(l)},i,r)}}class z_ extends V.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new Ya,this._logger=console.log,this.Importers=[new Tn(Yi,["json"],!1),new Tn(p.hH6,["txt"],!1),new Tn(pa,["rgbe.png","hdr.png","hdrpng"],!1),new Tn(p.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Tn(yu,["cube"],!1),new Tn(Pv,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new p.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Nc(e)),this.Importers.push(pf(e)),this.Importers.push(ff())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,i){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:i})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,i){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:i})}_urlModifier(e){var t;let i=decodeURI(e);const r=(t=this._rootContext)===null||t===void 0?void 0:t.rootUrl;i.includes("://")||!r||i.startsWith(r)||(i=r+i),i=i.replace("./",""),i=i.replace(/^(\/\/)/,"/"),i=i.replace(/\?.*$/,"");const s=this._fileDatabase.get(i);return s?s.ext?(s.objectUrl||(s.objectUrl=URL.createObjectURL(s)+"#"+i),s.objectUrl):(console.error("Unable to determine file extension",s),e):e}_createLoader(e){const t=this._getImporter(e),i=t==null?void 0:t.ctor(this);return i&&(t==null||t.ext.forEach(r=>{const s=new RegExp(r.startsWith("data:")?"^"+r+"\\/":"\\."+r+"$","i");this._loadingManager.addHandler(s,i)})),i&&(this._loaderCache.push({loader:i,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:i})),i}addEventListener(e,t){if(super.addEventListener(e,t),e==="loaderCreate")for(const i of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:i.loader})}async importFiles(e,t={}){const i=new Map;let{allowedExtensions:r}=t;if(r&&r.length<1&&(r=void 0),e.size===0)return i;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const s=[],o=[];if(e.forEach((l,u)=>{var h;this.registerFile(u,l);const f=l.ext;f&&((h=r==null?void 0:r.includes(f.toLowerCase()))===null||h===void 0||h)&&(this._isRootFileExtension(f)?s.push(u):o.push(u))}),s.length>0)for(const l of s){let u=await this._importFile(l,void 0,t);u&&(u=await this.processImported(u,t)),i.set(l,u)}else for(const l of o){let u=await this._importFile(l,void 0,t);u&&(u=await this.processImported(u,t)),i.set(l,u)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((l,u)=>{this.unregisterFile(u)}),i}registerFile(e,t){var i,r,s;e=e.replace(/\?.*$/,"");const o=(i=t==null?void 0:t.ext)!==null&&i!==void 0?i:(s=(0,V.parseFileExtension)((r=t==null?void 0:t.name)!==null&&r!==void 0?r:e.trim()))===null||s===void 0?void 0:s.toLowerCase();t&&(t.ext||(t.ext=o),this._fileDatabase.set(e,t));let l=this._getLoader(e);if(l||(l=this._createLoader(t??{name:e,ext:o})),l){for(const u of this._loaderCache)if(u.loader===l){u.files.push(e);break}}return l}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,i={},r){var s,o;if(t!=null&&t.__imported)return t.__imported;let l;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const u=this.resolveURL(e),h=e.replace(/\?.*$/,"").trim(),f=(s=i.fileHandler)!==null&&s!==void 0?s:await this._loadingManager.getHandler(h)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0);if(!f)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:u,rootUrl:p.Zp0.extractUrlBase(e),baseUrl:p.Zp0.extractUrlBase(u)},l=await f.loadAsync(e+(i.queryString?(e.includes("?")?"&":"?")+i.queryString:""),g=>{r&&r(g),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:g.loaded||void 0,totalBytes:g.total||void 0,progress:g.total>0?g.loaded/g.total:1})}),f.transform&&(l=await f.transform(l,i)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(u){return console.error("AssetImporter: Unable to import file",e,t),console.error(u),console.error(u==null?void 0:u.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:u}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t&&l){t.__imported=l;let u=[];Array.isArray(l)?u=l:!((o=l.userData)===null||o===void 0)&&o.rootSceneModelRoot?u.push(...l.children):u.push(l),u.forEach(h=>{h.addEventListener&&h.addEventListener("dispose",()=>{t.__imported=void 0})})}if(l&&typeof l=="object"){l.__rootPath=e;const u=t||this._fileDatabase.get(e);u&&(l.__rootBlob=u)}return l}_getImporter(e,t=!1){return this.Importers.find(i=>{if(t&&!i.root)return!1;const r=i.ext.find(s=>{var o,l,u;return e.ext&&s===e.ext.toLowerCase()||((l=(o=e.name)===null||o===void 0?void 0:o.toLowerCase())===null||l===void 0?void 0:l.endsWith("."+s.toLowerCase()))||(s==null?void 0:s.startsWith("data:"))&&((u=e.name)===null||u===void 0?void 0:u.startsWith(s))});return!!r&&(e.ext=r,!0)})}_getLoader(e){var t;return(t=this._loadingManager.getHandler(e.trim()))!==null&&t!==void 0?t:void 0}async importAsset(e,t={},i){var r,s,o;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const f=this._cachedAssets.find(g=>g.path===e.path);f&&Object.assign(e,f)}const h=this._cachedAssets.findIndex(f=>f.path===e.path);h>=0&&this._cachedAssets.splice(h,1),this._cachedAssets.push(e)}let l;if(e!=null&&e.preImported&&(l=await e.preImported),!t.forceImport&&l){const h=await this.processImported(l,t);let f=!1;for(const g of h){if(!((r=g.userData)===null||r===void 0)&&r.rootSceneModelRoot&&[...g.children,...g.__processedChildren||[]].find(_=>_.__disposed)){f=!0;break}if(g.__disposed){f=!0;break}}if(!f||t.reimportDisposed===!1)return h}const u=t.pathOverride||e.path;if(e.preImported=this._importFile(u,typeof((s=e.file)===null||s===void 0?void 0:s.arrayBuffer)=="function"?e.file:void 0,t,i),l=await e.preImported,l&&(this.dispatchEvent({type:"processFileStart",path:u,result:l}),l=await this.processImported(l,t),this.dispatchEvent({type:"processFileEnd",path:u,result:l})),l){const h=[];Array.isArray(l)?h.push(...l):!((o=l.userData)===null||o===void 0)&&o.rootSceneModelRoot?h.push(...l.children):h.push(l),h.forEach(f=>{var g;return(g=f.addEventListener)===null||g===void 0?void 0:g.call(f,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return l}async importSingle(e,t={}){var i;return typeof e=="string"?await this.importSinglePath(e,t):(i=await this.importAsset(e,t))===null||i===void 0?void 0:i[0]}async importSinglePath(e,t){var i;return(i=await this.importPath(e,t))===null||i===void 0?void 0:i[0]}async importPath(e,t={}){const i={...t};delete i.pathOverride,delete i.forceImport,delete i.reimportDisposed,delete i.fileHandler,delete i.importedFile;const r=JSON.stringify(i);let s;return s=this._cachedAssets.find(o=>o.path===e&&o._options===r)||{path:e},s._options=r,t.importedFile&&(s.file=t.importedFile),await this.importAsset(s,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var i,r,s,o,l,u,h,f;let g=e;if(!g)return[];if(t.processImported===!1)return[g];if(Array.isArray(g)){const x=[];for(const E of g)x.push(...await this.processImported(E,t));return x}if(!((i=g.userData)===null||i===void 0)&&i.rootSceneModelRoot){if(t._rootSceneImported=!0,g.__processedChildren&&!t.forceImporterReprocess)return g.__processedChildren;if(!(g.children.length<1))return g.animations&&(g.children[0].animations||(g.children[0].animations=[]),g.children[0].animations.push(...g.animations)),g.__importedViewerConfig&&(g.children[0].__importedViewerConfig=g.__importedViewerConfig),g.userData.__importData&&(g.children[0].userData.__importData=g.userData.__importData),g.__processedChildren=await this.processImported([...g.children],t),g.__processedChildren;if(((r=g.animations)===null||r===void 0?void 0:r.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",g.animations),!g.__importedViewerConfig)return[];g=g.__importedViewerConfig}if(!((s=g.userData)===null||s===void 0)&&s.iModel&&(g=g.userData.iModel),!((o=g.userData)===null||o===void 0)&&o.iMaterial&&(g=g.userData.iMaterial),g.assetImporterProcessed&&!t.forceImporterReprocess)return[g];const _=g.__rootPath,A=g.__rootBlob;if(!g.assetType){if(g.isBufferGeometry&&(g=new p.Kj0(g,new p.Wid)),g.isObject3D)if(g.isLight)g=Pm(g);else{const x=[];g.traverse(E=>{E!==g&&E.isLight&&x.push(E)});for(const E of x)Pm(E);g=new Ca(g,t)}g.isTexture&&(g.assetType="texture",t._testDataTextureComplete&&(g.isDataTexture&&!((l=g.image)===null||l===void 0)&&l.data&&(g.image.complete=!0),!((u=g.image)===null||u===void 0)&&u.complete&&(g.needsUpdate=!0)),t.generateMipmaps!==void 0&&(g.generateMipmaps=t.generateMipmaps),g.generateMipmaps||g.isRenderTargetTexture||(g.minFilter=g.minFilter===p.D1R?p.wem:g.minFilter,g.magFilter=g.magFilter===p.D1R?p.wem:g.magFilter)),g.isMaterial&&(g.assetType="material")}if(g.assetType!=null)return g.userData&&(g.userData.rootPath||!_||_.startsWith("blob:")||_.startsWith("/")||(g.userData.rootPath=_),A&&(g.userData.__sourceBlob=A,g.userData.__needsSourceBuffer&&(g.userData.__sourceBuffer=await A.arrayBuffer(),delete g.userData.__needsSourceBuffer))),g=await this._processors.process(g.assetType,g,{}),g.assetImporterProcessed=!0,[g];if(g instanceof Map)return[...(await this.importFiles(g,t)).values()].flat();if(g.type&&g.type!=="ViewerApp"&&g.type!=="ThreeViewer"){const x=this._viewer.getPluginByType(g.type);if(x){let E=g._importedResources||{};return g.resources&&(E=await((h=this._viewer.getManager())===null||h===void 0?void 0:h.importConfigResources(g.resources)),delete g.resources,g._importedResources=E),typeof x.fromJSON=="function"&&(await Promise.resolve(x.fromJSON(g,E)),g.assetImporterProcessed=!1),[]}}return g.plugins||g.type==="ViewerApp"||g.type==="ThreeViewer"?(g.resources=await((f=this._viewer.getManager())===null||f===void 0?void 0:f.importConfigResources(g.resources)),await this._viewer.getManager().importViewerConfig(g),g.assetImporterProcessed=!1,[]):(console.warn("WebGi AssetImporter: unknown/null asset type: ",g,g.plugins),[g])}dispose(){var e;this.clearCache(),(e=this._processors)===null||e===void 0||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function Rv(a){if(!a)return p.ywz;const e=a.extensions.has("EXT_color_buffer_half_float")||a.capabilities.isWebGL2&&a.extensions.has("EXT_color_buffer_float"),t=a.capabilities.isWebGL2||a.extensions.has("OES_texture_float")||a.extensions.has("WEBGL_color_buffer_float");return e?p.cLu:t?p.VzW:p.ywz}function Pm(a){var e,t;if(!a.isLight||a.assetType==="light")return a;if(a.uiConfig)return console.warn("ui config already exists, not supported",a),a;let i;if(a.children.length,a.isDirectionalLight&&(i=new Ud),a.isAmbientLight&&(i=new ic),a.isSpotLight&&(i=new mf),a.isPointLight&&(i=new ta),i){(t=(e=i.lightObject).copy)===null||t===void 0||t.call(e,a);const r=a.parent;r!=null&&r.isObject3D&&(r.remove(a),a.dispose(),a.userData.iModel=i,r.add(i.lightObject),i.uuid=a.uuid),fo(i.lightObject,r)}else console.warn("unknown light type: ",a);return i}class Rm extends p.u7G{constructor(e){super(e)}async loadAsync(e,t){var i;const r=new p.hH6(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=await r.loadAsync(e,t);try{const o=JSON.parse(s);if(o.images&&this.importer){const l={};let u=o.images;Array.isArray(u)||(u=Object.values(u));for(const h of o.images){if(!h.url||!h.uuid)continue;const f=(i=await this.importer.importPath(h.url,{processImported:!1}))===null||i===void 0?void 0:i[0],g=f==null?void 0:f.source;if(!f||!g)continue;const _=new p.Hw6(g.data);_.uuid=h.uuid,l[_.uuid]=_,f.dispose()}return await Cl.LoadRootPathTextures(o.textures,l||o.images,this.importer),this.parse(o,l)}return this.parse(o)}catch(o){throw console.error(o),this.manager.itemError(e),o}}parse(e,t){var i,r;let s;const o={p:new Promise(f=>{s=f})};if(e.images||e.textures){const f=new Cl(this.manager);let g={};const _=T=>{s(),o.p=void 0,Object.values(g).forEach(R=>{var I;R.isTexture&&!((I=R.image)===null||I===void 0)&&I.complete&&(R.needsUpdate=!0)})};let A=e.images||[];Array.isArray(A)||(A=Object.values(A));const x=t||f.parseImages(A,_);let E=e.textures;Array.isArray(E)||(E=Object.values(E)),g=f.parseTextures2(E,x,_),this.setTextures(g)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const l={...e};if(Object.entries(l).forEach(([f,g])=>{g&&typeof g=="string"&&this.textures[g]&&(l[f]=this.textures[g])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?l.vertexColors=e.vertexColors>0:l.vertexColors=e.vertexColors),e.normalScale!==void 0){const f=e.normalScale;Array.isArray(f)===!1&&(l.normalScale=[f,f])}let u=e.type;u!=="MeshPhysicalMaterial"&&u!=="MeshStandardMaterial"&&u!=="PhysicalMaterial"||(u=js.TYPE),l.userData=br(l.userData,void 0,!1,this);const h=(r=(i=this.materials)===null||i===void 0?void 0:i.generateFromTemplateType(u,l))!==null&&r!==void 0?r:super.parse(e);return this.setTextures({}),h.userData.imageLoadAwaiter=o,h}}class Ut extends V.SimpleEventDispatcher{constructor(e,t,{simpleCache:i=!1,storage:r}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(i||r)&&(i&&(p.CtF.enabled=!0),r&&window.Cache&&typeof window.Cache=="function"&&r instanceof window.Cache)){const s={...p.CtF};p.CtF.get=(o,l,u)=>l?o.startsWith("data:")||o.startsWith("blob")||o.startsWith("chrome-extension")?Promise.resolve(void 0):r.match(o).then(h=>{if(h)switch(l){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(f=>new DOMParser().parseFromString(f,u??"text/html"));case"json":return h.json();default:if(u===void 0)return h.text();{const f=/charset="?([^;"\s]*)"?/i.exec(u),g=f&&f[1]?f[1].toLowerCase():void 0,_=new TextDecoder(g);return h.arrayBuffer().then(A=>_.decode(A))}}}):s.get(o),p.CtF.add=async(o,l,u)=>{if(!u)return s.add(o,l);o.startsWith("data:")||o.startsWith("blob")||o.startsWith("chrome-extension")||(await r.match(o)&&await r.delete(o),await r.put(o,new Response(l,{status:200})))},p.CtF.remove=(o,l)=>{if(!l)return s.remove(o);r.delete(o)}}this.storage=r,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const i=await this._importer.importAsset(e,t);return i?(this.addProcessedAssets(i,t),i):(console.warn("WebGi AssetManager: Unable to import",e,i),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const i=await this._importer.importPath(e,t);return i?(this.addProcessedAssets(i,t),i):(e&&!e.split("?")[0].endsWith(".vjson")&&console.warn("WebGi AssetManager: Unable to import",e,i),[])}addProcessedAssets(e,t){return e.map(i=>{var r;return(r=this._viewer)===null||r===void 0?void 0:r.scene.addSceneObject(i,{...t,allImported:e})})}async addAssetSingle(e,t={}){var i;return e?(i=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,t))===null||i===void 0?void 0:i[0]:void 0}async addImported(e,t={}){var i;return(i=this._importer)===null||i===void 0?void 0:i.processImported(e,t).then(r=>(this.addProcessedAssets(r,t),r))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(i=>i==null?void 0:i[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const i=e.object;i.assetType==="material"&&((t=this._materials)===null||t===void 0||t.processMaterial(i,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new gs,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new z_(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(i,r)=>(of(i,s=>{var o;return(o=this._materials)===null||o===void 0?void 0:o.processModel(s,{recursive:!1})}),i)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(i,r)=>{var s;return!((s=this.materials)===null||s===void 0)&&s.findMaterial(i.uuid)&&(console.warn("WebGi AssetManager: Material with same UUID already exists, creating new UUID"),i.uuid=p.M8C.generateUUID(),i.userData.uuid&&(i.userData.uuid=i.uuid)),this._materials.processMaterial(i,r)}})),this._importer.Importers.push(new Tn(Rm,[js.TypeSlug],!1,i=>(i&&(i.materials=this._materials),i&&(i.importer=this._importer),i)));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new Tn(class extends Yi{async loadAsync(i,r){return t(await super.loadAsync(i,r))}},[Ut.ViewerTypeSlug],!0))}onRemove(e){var t,i;e===this._viewer&&((t=this._importer)===null||t===void 0||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(i=this._materials)===null||i===void 0||i.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},r=this._viewer.toJSON(i);return e||Object.values(i).forEach(s=>{s&&Object.values(s).forEach(o=>{o.url&&(o.url.data instanceof ArrayBuffer||Array.isArray(o.url.data))&&(o.url.type==="Uint16Array"?(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),o.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(o.url.data.buffer)):o.url.type==="Uint8Array"?(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),o.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(o.url.data.buffer)):o.url.data instanceof ArrayBuffer?o.url.data="data:application/octet-stream;base64,"+(0,V.arrayBufferToBase64)(o.url.data.buffer):console.warn("Unsupported buffer type",o.url.type))})}),r.resources=i,r}exportPluginPresets(e){var t;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(t=this._viewer)===null||t===void 0?void 0:t.serializePlugins(i,e),resources:i}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},i=e.toJSON(t);return i.resources=t,i}async importPluginPreset(e,t){var i;const r=e.type;if(!(t=t||((i=this._viewer)===null||i===void 0?void 0:i.getPluginByType(r))))return void console.warn(`WebGi: No plugin found for type ${r} to import preset`);if(!t.fromJSON)return void console.warn(`WebGi: Plugin ${r} does not support importing presets`);const s=e.resources||{};e.resources&&delete e.resources;const o=await this.importConfigResources(s);return await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("WebGi: No viewer or importer");const i=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,i)}applyViewerConfig(e,t){var i;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const r of Object.values(t.materials))r.__useCount?delete r.__useCount:(i=this._materials)===null||i===void 0||i.unregisterMaterial(r);for(const r of Object.values(t.textures))r.__useCount&&delete r.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("WebGi: No viewer or importer")}async importConfigResources(e,t,i){var r,s,o;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const l={};Object.values(e).forEach(h=>{h&&Object.values(h).forEach(f=>{if(!f||!f.url||typeof f.url.data!="string")return;const g=f.url.data.match(/^data:.*;base64,(.*)$/);g!=null&&g[1]?f.url.data=(0,V.base64ToArrayBuffer)(g==null?void 0:g[1]):(f.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",f.url.type,"use base64"),f.url.data=new TextEncoder().encode(f.url.data).buffer)})}),t=t??new Cl(this._importer.loadingManager),l.animations=e.animations?t.parseAnimations(e.animations):{},i&&i.animations&&(l.animations={...l.animations,...i.animations}),l.shapes=e.shapes?t.parseShapes(e.shapes):{},i&&i.shapes&&(l.shapes={...l.shapes,...i.shapes}),l.geometries=e.geometries?t.parseGeometries(e.geometries,l.shapes):{},i&&i.geometries&&(l.geometries={...l.geometries,...i.geometries}),l.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},i&&i.images&&(l.images={...l.images,...i.images}),await Cl.LoadRootPathTextures(e.textures,l.images,this._importer),l.textures=e.textures?t.parseTextures2(Object.values(e.textures),l.images,()=>{Object.values(l.textures).forEach(h=>{var f;h.isTexture&&!((f=h.image)===null||f===void 0)&&f.complete&&(h.needsUpdate=!0)})}):{};for(const h of Object.entries(l.textures))h[1]=(r=await this._importer.processImported(h[1],{}))===null||r===void 0?void 0:r[0],h[1]?l.textures[h[0]]=h[1]:delete l.textures[h[0]];i&&i.textures&&(l.textures={...l.textures,...i.textures});const u=e.materials?Object.values(e.materials):[];for(const h of u)Object.entries(h).forEach(([f,g])=>{g&&g.resource&&g.uuid&&g.resource==="textures"&&(h[f]=g.uuid)});if(l.materials=t.parseMaterials2(u,l.textures,this._materials),i&&i.materials&&(l.materials={...l.materials,...i.materials}),e.object&&(l.object=t.parseObject(e.object,l.geometries,l.materials,l.textures,l.animations),e.skeletons&&(l.skeletons=t.parseSkeletons(e.skeletons,l.object),t.bindSkeletons(l.object,l.skeletons))),e.extras){l.extras=e.extras;for(const h of Object.values(e.extras))if(h.uuid&&h.url)if(typeof h.url=="string"){const f=await((s=this._importer)===null||s===void 0?void 0:s.importPath(h.url));(f==null?void 0:f.length)>0&&(l.extras[h.uuid]=f[0])}else if(h.url.data){const f=new File([(0,V.getTypedArray)(h.url.type,h.url.data)],h.url.path),g=await((o=this._importer)===null||o===void 0?void 0:o.importAsset({path:f.name,file:f}));(g==null?void 0:g.length)>0&&(l.extras[h.uuid]=g[0])}else console.warn("WebGi: invalid URL type while loading extra resource")}return i&&i.extras&&(l.extras={...l.extras,...i.extras}),l.__isLoadedResources=!0,l}}Ut.PluginType="AssetManager",Ut.ViewerTypeSlug="vjson";class Dm{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,i){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),i&&Object.entries(i).forEach(([r,s])=>s&&this.on(r,s))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(i=>i(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,i;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const r=Array.from(((t=e.dataTransfer)===null||t===void 0?void 0:t.files)||[]),s=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.items)||[]);if(r.length!==0||s.length!==0)if(s.length>0){const o=s.map(l=>l.webkitGetAsEntry());this._loadNextEntry(new Map,o)}else this._emit("drop",{files:new Map(r.map(o=>(o.filePath=o.name,[o.filePath,o])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var t;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const i=[].slice.call((t=this._inputEl.files)!==null&&t!==void 0?t:new FileList),r=new Map;i.forEach(s=>{s.filePath=s.webkitRelativePath||s.name,r.set(s.filePath,s)}),this._emit("drop",{files:r})}_loadNextEntry(e,t){const i=t.pop();if(i)if(i.isFile)i.file(r=>{r.filePath=i.fullPath,e.set(i.fullPath,r),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",i.fullPath));else if(i.isDirectory){const r=i.createReader(),s=o=>{o.length?(t=t.concat(o),r.readEntries(s)):this._loadNextEntry(e,t)};r.readEntries(s)}else console.warn("Unknown asset type: "+i.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class eo extends V.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new p.Pa4(.5,.5,3)},this.dependencies=[Ut],this.uiConfig={type:"folder",label:"Drop Options",expanded:!0,children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Dm(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,i,r,s,o,l;if(!e)return;const u=this._viewer;if(!u)return;if(this._allowedExtensions!==void 0)for(const g of e.keys())this._allowedExtensions.includes((i=(t=g.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())!==null&&i!==void 0?i:"")||e.delete(g);if(e.size<1)return;const h=u.getPlugin(Ut),f={type:"drop",files:e};if(this.importerParams.autoImport){const g={allowedExtensions:this.allowedExtensions,...this.importerParams};if(f.imported=await((r=h.importer)===null||r===void 0?void 0:r.importFiles(e,g)),this.importerParams.autoAdd){const _=(l=[...(o=(s=f.imported)===null||s===void 0?void 0:s.values())!==null&&o!==void 0?o:[]].flat(2).filter(A=>!!A))!==null&&l!==void 0?l:[];if(f.assets=h.addProcessedAssets(_,{...this.importerParams}),!g._rootSceneImported)for(const A of f.assets)A.modelObject&&A.modelObject.dispatchEvent({type:"select",value:A.modelObject})}}this.dispatchEvent(f)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}onRemove(e){var t;(t=this._dropzone)===null||t===void 0||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}eo.PluginType="Dropzone";var Iu=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};function Ps(a){return Object.getPrototypeOf(a).constructor.PluginType}class to extends V.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:i=!1,screenShader:r="",...s}){var o;super(),this.console=console,this._state=kt.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(_=>this.resize()):void 0,this._lastSize=new p.FM8,this._onContextRestore=_=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=_=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this.rendersPerFrame=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===Bm&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=_=>{var A;if(!_||!_.object)return;const x=_.object.__importedViewerConfig||((A=_.object.modelObject)===null||A===void 0?void 0:A.__importedViewerConfig);if(!x)return;const E=this.getManager();(function(T,R){var I;const S=(R.version?R.version:"0.0.0").split(".").map(k=>parseInt(k));if(R.type!=="ViewerApp"||S[0]!==0||!(S[1]<7||S[1]===7&&S[2].toString()[0]<"6"))return;const O=new Set;(!((I=T.options)===null||I===void 0)&&I.allImported?T.options.allImported:[T.object]).forEach(k=>k.traverse(N=>{N.material&&O.add(N.material)})),O.forEach(k=>{const N=k.map;if(!N)return;const H=N.repeat,X=N.offset,te=N.center,re=N.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach(ue=>{const le=k[ue];le&&(le.repeat.copy(H),le.offset.copy(X),le.center.copy(te),le.rotation=re,le.needsUpdate=!0)}),k.needsUpdate=!0})})(_,x),E?E.applyViewerConfig(x,x.resources):this.fromJSON(x,x.resources)},this.alert=async _=>alert(_),this.confirm=async _=>confirm(_),this.prompt=async(_,A,x=!0)=>prompt(_,A),this._useRgbm=t,this._useGBufferDepth=i,this._screenShader=r,this._canvas=s.canvas||(0,V.createCanvasElement)();let l=s.container;if(l&&!s.canvas&&l.appendChild(this._canvas),l||(l=(o=this._canvas.parentElement)!==null&&o!==void 0?o:void 0),!l)throw new Error("No container.");this._container=l,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var _;const A=window.location.href,x="https://dev-sandbox.pixotronics.com/webgi/";if(!A.startsWith(x)||(0,V.getUrlQueryParam)("noUpdate")!==null)return!0;const E=(_=A.match(/\/webgi\/([0-9.a-zA-Z-]+)/))===null||_===void 0?void 0:_[1],T=(await(await fetch(x+"version.txt")).text()).split(`
`)[0];if(E&&E!==T){if(confirm(`New version ${T} is available, do you want to open?`)){const R=window.location.href.replace(E,T);return window.location.href=R,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const u=new Cs(void 0,void 0,this._canvas);u.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var _,A;const x=f.scene.activeCamera;if(x&&x.interactionsEnabled){const E=(_=this.getPluginByType("Progressive"))===null||_===void 0?void 0:_.postFrameConvergedRecordingDelta();if(E!==void 0&&E===0)return;(A=x.controls)===null||A===void 0||A.update()}}),this.scene=new Xn(u),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new ch({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:t?gt:p.aCh,type:t?p.ywz:p.cLu,depthBuffer:!i,generateMipmaps:!!e,minFilter:e?p.FDw:p.wem}}),this._isAntialiased=e&&this._renderer.isWebGL2;let h=!0;this._renderer.rendererObject.userData||(h=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!h;const f=this;this.renderFilter={passId:"render",passObject:new af(this,h),update(){const _=this.passObject;_.scene=f.scene.modelObject,_.camera=f.scene.renderCamera.cameraObject}};const g={passId:"screen",after:["render"],required:["render"],passObject:cc(r)};[this.renderFilter,g].forEach(_=>this._renderer.registerPass(_)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",_=>this.setDirty(this.scene,_)),this.scene.addEventListener("sceneMaterialUpdate",_=>this.setDirty(this.scene,_)),this.scene.addEventListener("sceneUpdate",_=>{this.setDirty(this.scene,_),_.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",_=>this.setDirty(this.scene,_)),this._renderer.addEventListener("update",_=>this.setDirty(this._renderer,_)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),s.assetManager&&this.addPluginSync(new Ut(void 0,void 0,typeof s.assetManager=="boolean"?{}:s.assetManager)),s.dropzone&&this.addPluginSync(new eo),this.console.log("WebGi Viewer instance initialized, version: ",to.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:i}){var r,s;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let o=0;o<this.maxFramePerLoop;o++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const h=[this._canvas.clientWidth,this._canvas.clientHeight];if(i){const f=(s=(r=this._renderer.rendererObject.xr.getCamera())===null||r===void 0?void 0:r.cameras[0])===null||s===void 0?void 0:s.viewport;f?(f.x===0&&f.y===0||this.console.warn("x and y must be 0?"),h[0]=f.width,h[1]=f.height,this.console.log("resize for xr",h)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...h),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:i});const l=Object.values(this.plugins).filter(h=>h.dirty);l.length>0&&this.setDirty(l),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const u=this._renderer.dirty;if(u)for(let h=0;h<this.rendersPerFrame;h++){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(this._renderer.defaultRenderToScreen)}catch(f){this.console.error(f),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!u)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ViewerApp: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new p.ROQ(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let i;if(e.prototype){const s=this.getPlugin(e);if(s)return console.error(`Plugin of type ${Ps(s)} already exists, no new plugin created`,s),s;i=new e(...t)}else i=e;const r=Ps(i);if(!r)return this.console.error("PluginType is not defined for",i),i;for(const s of i.dependencies||[])await this.getOrAddPlugin(s);return this.plugins[r]&&(this.console.error(`Plugin of type ${r} already exists, old plugin will be removed and disposed`,this.plugins[r],i),await this.removePlugin(this.plugins[r],!0)),this.plugins[r]=i,await i.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:i}),this.setDirty(i),i}addPluginSync(e,...t){let i;if(e.prototype){const s=this.getPlugin(e);if(s)return console.error(`Plugin of type ${Ps(s)} already exists, no new plugin created`,s),s;i=new e(...t)}else i=e;const r=Ps(i);if(!r)return this.console.error("PluginType is not defined for",i),i;for(const s of i.dependencies||[])this.getOrAddPluginSync(s);return this.plugins[r]&&(this.console.error(`Plugin of type ${r} already exists, old plugin will be removed and disposed`,this.plugins[r],i),this.removePluginSync(this.plugins[r],!0)),this.plugins[r]=i,i.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:i}),this.setDirty(i),i}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const i=Ps(e);this.plugins[i]&&(await e.onRemove(this),delete this.plugins[i],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const i=Ps(e);this.plugins[i]&&(e.onRemove(this),delete this.plugins[i],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){var t;const i=(t=e.userData.iCamera)!==null&&t!==void 0?t:new Cs(e,{controlsMode:"",aspect:"auto"},this._canvas);return e.userData.autoLookAtTarget===void 0?(i.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):i.autoLookAtTarget=e.userData.autoLookAtTarget,i}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise(i=>{const r=async(...s)=>{this.removeEventListener(e,r),i(await(t==null?void 0:t(...s)))};this.addEventListener(e,r)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===Bm)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){var t;if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let i=(t=this._rawBackground)!==null&&t!==void 0?t:this.scene.getBackground();return i?(i!=null&&i.isVector4&&(i=Al(i,7).getHexString()),i!=null&&i.isColor?i.getHexString():this._rawBackground===Bm?this.scene.getEnvironment():i):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(Ut)}resetCamera({rootObject:e,centerOffset:t=new p.Pa4(1,1,1),targetOffset:i=new p.Pa4(0,0,0),...r}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const s=e?new Re().expandByObject(e,!0,!0):this.scene.getBounds(!0),o=s.getCenter(new p.Pa4),l=.5*s.getSize(new p.Pa4).length();o.add(i.clone().multiplyScalar(l)),this.scene.activeCamera.position=new p.Pa4(o.x+t.x*l,o.y+t.y*l,o.z+t.z*l),this.scene.activeCamera.target=o,this.setDirty()}}async fitToView(e,t=1.5,i,r){var s,o;const l=this.getPluginByType("CameraViews");l?await(l==null?void 0:l.animateToFitObject(e,t,i,r,{min:((o=(s=this.scene.activeCamera.getControls())===null||s===void 0?void 0:s.minDistance)!==null&&o!==void 0?o:.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e,t=!1){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new p.Tme,{autoScale:!1,pseudoCenter:!1,addToRoot:t})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var i,r,s,o;if(t!=null&&t.isMaterial){const l=(r=(i=this.getManager())===null||i===void 0?void 0:i.materials)===null||r===void 0?void 0:r.findMaterial(t.uuid);if(l)return l}return(o=(s=this.getManager())===null||s===void 0?void 0:s.materials)===null||o===void 0?void 0:o.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(i=>{var r,s;if(!t||t.includes(i[1].constructor.PluginType))return i[1].serializeWithViewer!==!1?(s=(r=i[1]).toJSON)===null||s===void 0?void 0:s.call(r,e):void 0}).filter(i=>!!i)}deserializePlugins(e,t){return e.forEach(i=>{var r;if(!i.type)return void this.console.warn("Invalid plugin to import ",i);const s=this.getPluginByType(i.type);s&&((r=s.fromJSON)===null||r===void 0||r.call(s,i,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const i=Object.assign({version:to.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},cr(this,!0,e));return i.backgroundIntensity=this.scene.backgroundIntensity,i.useLegacyLights=this.renderer.useLegacyLights,i.background=i.scene.background||i.scene.backgroundColor,i.background==="environment"&&(i.background="envMapBackground"),i}fromJSON(e,t){var i,r,s,o,l;const u={...e};return u.backgroundIntensity!==void 0&&((i=u.scene)===null||i===void 0?void 0:i.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=u.backgroundIntensity,delete u.backgroundIntensity),u.useLegacyLights!==void 0&&((r=u.renderManager)===null||r===void 0?void 0:r.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=u.useLegacyLights,delete u.useLegacyLights),u.background!==void 0&&((s=u.scene)===null||s===void 0?void 0:s.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),u.background==="envMapBackground"?u.background="environment":typeof u.background=="number"?u.background=new p.Ilk().setHex(u.background,p.GUF):typeof u.background=="string"?u.background=new p.Ilk().setStyle(u.background,p.GUF):!((o=u.background)===null||o===void 0)&&o.isColor&&(u.background=new p.Ilk(u.background)),!((l=u.background)===null||l===void 0)&&l.isColor?(this.scene.backgroundColor=u.background,this.scene.background=null):u.background?(this.scene.backgroundColor=new p.Ilk("#ffffff"),u.scene.background=u.background):(this.scene.backgroundColor=null,this.scene.background=null),delete u.background),br(u,this,!0,t),Array.isArray(u.plugins)&&this.deserializePlugins(u.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...i}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,i)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...i}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,i)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}to.VERSION="0.9.20",Iu([ae("renderManager")],to.prototype,"_renderer",void 0),Iu([ae()],to.prototype,"scene",void 0),Iu([(0,V.onChange)(to.prototype._renderEnabledChanged)],to.prototype,"renderEnabled",void 0);const Bm="envMapBackground";function cc(a){return a!=null&&a.isShaderPass2?a:new On({...Ke,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(a)?a[0]:(a==null?void 0:a.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(a)?a[1]:typeof a=="string"?a:(a==null?void 0:a.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class Dv extends On{constructor(e){super({vertexShader:Ke.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=p.Wl3}render(e,t,i,r,s){super.render(e,t,i,r,s),this._lastReadBuffer=i,this.needsSwap=!0}reRender(e,t,i,r){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,i,r)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class vn extends qa{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[vr],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var i,r;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(r=(i=this.pass).update)===null||r===void 0||r.call(i),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var t,i;return!((i=(t=this._viewer)===null||t===void 0?void 0:t.screenShader)===null||i===void 0)&&i.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,V.safeSetProperty)(e.renderer.passes.find(r=>r.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,V.safeSetProperty)(e.renderer.passes.find(t=>t.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var t,i;const r=e.screenShader,s=["",""];this._renderToScreen&&!r.isShaderPass2&&(s[0]=Array.isArray(r)?r[0]:(r==null?void 0:r.pars)||"",s[1]=Array.isArray(r)?r[1]:typeof r=="string"?r:(r==null?void 0:r.main)||"");const o=new Dv(s);return(0,V.safeSetProperty)((i=(t=o.uiConfig)===null||t===void 0?void 0:t.children)===null||i===void 0?void 0:i.find(l=>(l==null?void 0:l.label)==="Enabled"),"hidden",!0,!0),o}_update(e){var t,i,r;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)===null||t===void 0?void 0:t.getPlugin(vr)),this._pass.passObject.material.uniforms.tTransparent.value=((r=(i=this._viewer)===null||i===void 0?void 0:i.renderFilter.passObject.transparentTarget)===null||r===void 0?void 0:r.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t,i;return(i=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&i!==void 0?i:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}vn.PluginType="CombinedPostPlugin";var Hd=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Zc extends Si{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[vn]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(vn))===null||t===void 0||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function Pu(a,e,t){return a&~(1<<e)|(t?1:0)<<e}function V_(a,e){return a&~(1<<e)}Hd([ae("extension")],Zc.prototype,"_extension",void 0),Hd([ae()],Zc.prototype,"enabled",void 0);var uc,Th=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const gA=p.dZ3;let ra=uc=class{constructor(a,e=!0){this.depthTonemap=e,this.toneMapping=p.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(t,i)=>this.enabled?V.glsl`
            ${this.depthTonemap?ha:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=a.getPlugin(vn),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(a,e,t){if(!this.enabled)return;const{toneMapping:i,toneMappingExposure:r,outputColorSpace:s}=t;this._rendererState.toneMapping=i,this._rendererState.toneMappingExposure=r,this._rendererState.outputColorSpace=s;let o=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==o&&(e.materialObject.defines.TONEMAP_BACKGROUND=o,e.materialObject.needsUpdate=!0),o=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==o&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=o,e.materialObject.needsUpdate=!0),o=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==o&&(e.materialObject.defines.DEBUG_DEPTH=o,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputColorSpace=p.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(a,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._setDirty()}};ra.PluginType="Tonemap",Th([Fs("Mode",[["Linear",p.EoG],["Reinhard",p.CdI],["Cineon",p.YGz],["ACESFilmic",p.LY2],["Uncharted2",gA]].map(a=>({label:a[0],value:a[1]})),{limitedUi:!0}),(0,V.onChange)(uc.prototype._setDirty),ae()],ra.prototype,"toneMapping",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),Ot("Tonemap Background",{limitedUi:!0}),ae()],ra.prototype,"tonemapBackground",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),Ot("Clip Background"),ae()],ra.prototype,"clipBackground",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),ai("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),ae()],ra.prototype,"exposure",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),ai("Saturation",[0,2],.01,{limitedUi:!0}),ae()],ra.prototype,"saturation",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),ai("Contrast",[0,2],.01,{limitedUi:!0}),ae()],ra.prototype,"contrast",void 0),Th([(0,V.onChange)(uc.prototype._setDirty),Ot("Render Depth")],ra.prototype,"renderDepth",void 0),ra=uc=Th([zi("Tonemapping")],ra);class hc extends Zc{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),(t=e.getPlugin(vr))===null||t===void 0||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new ra(e,this.depthTonemap)}get exposure(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&t!==void 0?t:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.saturation)!==null&&t!==void 0?t:1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.contrast)!==null&&t!==void 0?t:1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&t!==void 0?t:p.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var i,r;if(e instanceof p.Kj0&&!((i=e.material)===null||i===void 0)&&i.userData){const s=((r=e.material)===null||r===void 0?void 0:r.userData.postTonemap)===!1?0:1;t.w=Pu(t.w,1,s)}}}hc.PluginType="Tonemap",p.WdD.tonemapping_pars_fragment=p.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Qd,Ef=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Wd=Qd=class{constructor(a){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vn),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(this.extraUniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._setDirty()}};Wd.PluginType="ChromaticAberration",Ef([(0,V.onChange)(Qd.prototype._setDirty),Ot("Enable"),ae()],Wd.prototype,"enabled",void 0),Ef([(0,V.onChange)(Qd.prototype._setDirty),ai("Intensity",[0,.1],.001,{limitedUi:!0}),ae()],Wd.prototype,"aberrationIntensity",void 0),Wd=Qd=Ef([zi("ChromaticAberration")],Wd);class Om extends Zc{constructor(){super()}generateExtension(e){return new Wd(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Om.PluginType="ChromaticAberration";class Jc extends Si{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(i=>(i.passId||(console.warn("no id found for pass",i),i.passId=Wn()),e.renderer.registerPass(i,!0),[i.passId,i])))}async onRemove(e){var t;if(this._passes){for(const i of[...Object.values(this._passes)]){const r=i;e.renderer.unregisterPass(r),(t=r==null?void 0:r.dispose)===null||t===void 0||t.call(r)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var t;const i=super.toJSON(e);if(!i.type)return i;const r=Object.entries(this.passes);i.passes={};for(const[s,o]of r)i.passes[s]=cr((t=o==null?void 0:o.passObject)!==null&&t!==void 0?t:o,!1,e);return i}fromJSON(e,t){var i;if(!super.fromJSON(e,t))return null;if(e.passes){const r=Object.entries(this.passes);for(const[s,o]of r)br(e.passes[s],(i=o==null?void 0:o.passObject)!==null&&i!==void 0?i:o,!1,t)}return this}}var Er=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class _i extends On{constructor(e,t,i="rgba"){super({vertexShader:Ke.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new p.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new p.FM8}},defines:{B_SRC_ACCESSOR:i}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,i,r,s){var o,l,u,h;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((o=this.uniforms.tDiffuse.value)===null||o===void 0?void 0:o.image.width)||0,((l=this.uniforms.tDiffuse.value)===null||l===void 0?void 0:l.image.height)||0),super.render(e,t,this._target,r,s),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((u=this.uniforms.tDiffuse.value)===null||u===void 0?void 0:u.image.width)||0,((h=this.uniforms.tDiffuse.value)===null||h===void 0?void 0:h.image.height)||0),super.render(e,this._target,t,r,s))}}Er([ae(),Qe()],_i.prototype,"smoothEnabled",void 0),Er([ae(),Qe()],_i.prototype,"edgeSharpness",void 0);var Pn="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",bo=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,Lm=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,vA=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class G_ extends On{constructor(e,t,i){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1,CHECK_GBUFFER_FLAG:0},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new p.FM8(512,512)},saoData:{value:new p.Ltg},frameCount:{value:0},cameraNearFar:{value:new p.FM8(.1,1e3)},projection:{value:new p.yGw},saoBiasEpsilon:{value:new p.Ltg(1,1,1,1)},sceneBoundingRadius:{value:0}},vertexShader:Pn,fragmentShader:`

${bo}

${i}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec4 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/8)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uvOffset){float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getCavityAO(){float cutoff=-0.65;float curvature=float(getGBufferFlags(vUv).r)/255.;curvature=2.*curvature-1.;curvature=curvature*4.;float smoothCurvature=smoothstep(0.,1.,curvature-cutoff);smoothCurvature+=saoData.x;smoothCurvature=clamp(smoothCurvature,0.,1.);return 1.-smoothCurvature;}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28318)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 uvOffset=uv+floor(screenSpaceRadius*vec2(cos(angle),sin(angle)))/screenSize;
#if CHECK_GBUFFER_FLAG == 1
if(getSelectionBit(getGBufferFlags(uvOffset.xy).a)<1)return 0.;
#endif
vec3 samplePosition=getPositionFromOffset(uvOffset);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction)/(saoBiasEpsilon.w*saoBiasEpsilon.w);float ao=max((dot(centerNormal,direction)/saoBiasEpsilon.w-saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=0.09*saoData.z*saoBiasEpsilon.w/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;float cavityAO=getCavityAO();aoValue=saoData.w>0.?max(aoValue,cavityAO):aoValue;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1.3,useSmallScaleAO:!1,intensitySmallAO:.2,autoRadius:!1,projScale:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(r,s,o)=>{r.defines.SSAO_ENABLED&&(r.fragmentShader=Mi(r.fragmentShader,"#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(r,s,o)=>{var l,u;this.materialExtension.extraUniforms.tSSAOMap.value=(l=this._target)===null||l===void 0?void 0:l.texture;const h=s.materialObject;let f=this.enabled&&o.userData.screenSpaceRendering!==!1&&!(!((u=s.userData)===null||u===void 0)&&u.ssaoDisabled)?1:0;h.defines.SSAO_ENABLED!==f&&(h.defines.SSAO_ENABLED=f,h.needsUpdate=!0),f=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==f&&(this.materialExtension.extraUniforms.tSSAOMap.value=f,h.needsUpdate=!0)},parsFragmentSnippet:r=>{var s;return V.glsl`
             uniform sampler2D tSSAOMap;
             ${ot("tSSAOMap",(s=this._target)===null||s===void 0?void 0:s.texture,r.capabilities.isWebGL2)}
            ${Lm}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:r=>{var s,o;return this.enabled?"1":"0"+((o=(s=this._target)===null||s===void 0?void 0:s.texture)===null||o===void 0?void 0:o.colorSpace)},isCompatible:r=>{var s;return!(!((s=r.materialObject.userData)===null||s===void 0)&&s.ssaoDisabled)&&r.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new _i(this._target,i,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,i,r,s){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,i,r,s),this._smoothEnabled&&this.bilateralPass.render(e,t,i,r,s))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.x=this.parameters.intensitySmallAO,e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius,e.w=this.parameters.useSmallScaleAO,e.z*=this.parameters.projScale;const t=this.material.uniforms.saoBiasEpsilon.value;if(t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff,this.parameters.autoRadius){const i=this.material.uniforms.sceneBoundingRadius.value;t.w=i}else t.w=1}}vA([ae()],G_.prototype,"bilateralPass",void 0),vA([ae()],G_.prototype,"parameters",void 0);class km extends Jc{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[Ut,vr],this.setDirty=this.setDirty.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var t;return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),(t=e.getPlugin(vr))===null||t===void 0||t.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}updateGBuffer(e,t){var i;if(e instanceof p.Kj0&&!((i=e.material)===null||i===void 0)&&i.userData){const r=e.material.userData.ssaoCastDisabled||e.material.userData.pluginsDisabled,s=r?0:1;t.w=Pu(t.w,3,s),r&&this.passes.ssao.passObject&&this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG!==1&&(this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG=1,this.passes.ssao.passObject.material.needsUpdate=!0)}}createPasses(e){var t,i;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Zl(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new G_(e.renderer,this._aoTarget,(i=(t=e.getPlugin(vr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&i!==void 0?i:""),update(){var r;const s=Math.max(1,(r=(e==null?void 0:e.scene.activeCamera.modelObject).fov)!==null&&r!==void 0?r:1),o=((e==null?void 0:e.canvas.height)||1)/(2*Math.tan(.5*s*p.M8C.DEG2RAD));this.passObject.parameters.projScale=o,this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(vr)])}},()=>[e.getPlugin(vr),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssao)===null||t===void 0)&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,i=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[i,"enabled"],onChange:t.setDirty},{type:"checkbox",label:"Enable Cavity",property:[i.parameters,"useSmallScaleAO"],onChange:t.setDirty},{type:"slider",label:"Cavity Brightness",bounds:[0,.5],stepSize:.01,property:[i.parameters,"intensitySmallAO"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,5],property:[i.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,20],property:[i.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[i.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[i.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=i.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>i.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[i.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"checkbox",property:[i.parameters,"autoRadius"],onChange:t.setDirty},{type:"vec4",property:[i.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}km.PluginType="SSAO";var Xd,Ru=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ao=Xd=class extends On{constructor(){super({vertexShader:Ke.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new p.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:ha+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new p.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.2,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(a,e,t,i,r){const s=a.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const o=t;let l=.5,u=o.width*l,h=o.height*l;const f=[];let g=s.getTempTarget({sizeMultiplier:1,type:p.cLu});f.push(g);let _=o;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(a,g,_,i,r),_=g;let A=1;for(;A<this.bloomIterations&&(u/=2,h/=2,l/=2,!(h<2||u<2));A++){g=s.getTempTarget({sizeMultiplier:l,type:p.cLu}),f.push(g),this.material.defines.PASS_STEP=1;let E=this._weights[A];E=this._weights[A-1]!==0?this._weights[A]/this._weights[A-1]:this._weights[A],this.material.uniforms.weight.value=E,this.material.needsUpdate=!0,super.render(a,g,_,i,r),_=g}this.clear=!1;const x=a.autoClear;for(a.autoClear=!1,A-=2;A>=0;A--)g=f[A],f[A]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=p.WMw,this.material.needsUpdate=!0,a.autoClear=!1,super.render(a,g,_,i,r),this.material.blending=p.jFi,s.releaseTempTarget(_),_=g;this.clear=!0,a.autoClear=x,a.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(a,e,_,i,r)):(this.uniforms.tSource.value=o.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(a,e,_,i,r),this.uniforms.tSource.value=null),s.releaseTempTarget(_)}_updateWeights(){if(!this._weights)return;const a=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let i=t*e+.1,r=1.2-i;i=Math.pow(i,this.power),r=Math.pow(r,this.power),this._weights[t]=r*(1-a)+i*a}this.setDirty()}};function H_(a){const e=a==null?void 0:a.userData;return!!e&&(e[Aa.PluginType]||(e[Aa.PluginType]={}),e[Aa.PluginType].enable=!0,a.isMaterial&&(a.needsUpdate=!0),!0)}Ru([Qe()],Ao.prototype,"prefilter",void 0),Ru([ai("Threshold",[0,2]),(0,V.onChange)(Xd.prototype._thresholdsUpdated),ae()],Ao.prototype,"threshold",void 0),Ru([ai("Soft Threshold",[0,1]),(0,V.onChange)(Xd.prototype._thresholdsUpdated),ae()],Ao.prototype,"softThreshold",void 0),Ru([ai("Intensity",[0,3]),ae(),Qe()],Ao.prototype,"intensity",void 0),Ru([ai("Iterations",[0,7],1),(0,V.onChange)(Xd.prototype._updateWeights),ae()],Ao.prototype,"bloomIterations",void 0),Ru([ai("Radius",[0,1],.01),(0,V.onChange)(Xd.prototype._updateWeights),ae()],Ao.prototype,"radius",void 0),Ru([ai("Power",[.2,10],.01),(0,V.onChange)(Xd.prototype._updateWeights),ae()],Ao.prototype,"power",void 0),Ru([Ot("Debug")],Ao.prototype,"bloomDebug",void 0),Ao=Xd=Ru([zi("Bloom")],Ao);class Aa extends qa{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:Wn(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var i,r;return(r=(i=e.materialObject.userData[Aa.PluginType])===null||i===void 0?void 0:i.enable)===null||r===void 0||r},set value(i){var r;const s=e.materialObject.userData[Aa.PluginType];i!==(s==null?void 0:s.enable)&&(s||H_(e.materialObject),e.materialObject.userData[Aa.PluginType].enable=i,(r=t.uiRefresh)===null||r===void 0||r.call(t,"postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new Ao;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){var t,i;await super.onAdded(e),(t=e.getPlugin(vr))===null||t===void 0||t.registerGBufferUpdater(this.updateGBuffer);const r=e.getPlugin(Ut);(i=r==null?void 0:r.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){var i,r,s,o;if(e instanceof p.Kj0&&!((i=e.material)===null||i===void 0)&&i.userData){const l=((s=(r=e.material)===null||r===void 0?void 0:r.userData[Aa.PluginType])===null||s===void 0?void 0:s.enable)===!1||!((o=e.material)===null||o===void 0)&&o.userData.pluginsDisabled?0:1;t.w=Pu(t.w,2,l)}}_update(e){var t,i;return(t=e.getPlugin(vr))===null||t===void 0||t.updateShaderProperties((i=this.pass)===null||i===void 0?void 0:i.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Aa.PluginType="Bloom";var Bv="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",qd=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const Ov={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new p.FM8},cameraNearFar:{value:new p.FM8}},vertexShader:Pn,fragmentShader:ha+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Yd=(Kl({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8}},vertexShader:Pn,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),Kl({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Pn,fragmentShader:bo+`
`+Bv+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(min(vec3(72.),max(vec3(0.),colorSum)),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Ko extends On{constructor(){super(Ov,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Yd,this.nearFarBlurScale=new p.FM8(.25,.25),this.focalDepthRange=new p.FM8(.5,1.5),this.crossCenter=new p.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new p.Ilk(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Kl({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Pn,fragmentShader:ha+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=Kl({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new p.FM8},direction:{value:new p.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Pn,fragmentShader:ha+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,i,r,s){if(!this.enabled)return;const o=e.baseRenderer,l={minFilter:p.TyD,magFilter:p.TyD,type:p.cLu,colorSpace:p.GUF,sizeMultiplier:.5,format:p.wk1,depthBuffer:!1,generateMipmaps:!1},u=o.getTempTarget(l),h=o.getTempTarget(l);if(this.computeCocMaterial.uniforms.colorTexture.value=i.texture,o.blit(void 0,u,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=u.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,h,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=h.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,u,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=u.texture,o.blit(void 0,h,{material:this.dofBlurMaterial});else{const f=o.getTempTarget(l);this.dofBlurMaterial.uniforms.cocTexture.value=u.texture,this.dofBlurMaterial.uniforms.colorTexture.value=u.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,f,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=f.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,h,{material:this.dofBlurMaterial}),o.releaseTempTarget(f)}this.material.uniforms.blurTexture.value=h.texture,this.material.uniforms.cocTexture.value=u.texture,super.render(e,t,i,r,s),o.releaseTempTarget(u),o.releaseTempTarget(h)}}qd([ae(),Qe()],Ko.prototype,"nearFarBlurScale",void 0),qd([ae(),Qe()],Ko.prototype,"focalDepthRange",void 0),qd([Qe()],Ko.prototype,"crossCenter",void 0),qd([Qe()],Ko.prototype,"crossRadius",void 0),qd([Qe()],Ko.prototype,"crossAlpha",void 0),qd([Qe()],Ko.prototype,"crossColor",void 0);class Lv extends On{constructor(e){super({vertexShader:Ke.vertexShader,fragmentShader:V.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new p.Ltg(1,1,1,1)},weight2:{value:new p.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var kv=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const Uv=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class As extends Jc{constructor(e=2*Uv.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const i=t.object;(i.modelObject||i.lightObject)&&(i.modelObject||i.lightObject).traverse(r=>{var s;!((s=r==null?void 0:r.shadow)===null||s===void 0)&&s.camera&&r.shadow.mapSize&&this.trackedJitterCameras.add([r.shadow.camera,r.shadow.mapSize])})},this._jitterCamera=t=>{var i;const r=t.target;if(this.jitter&&r.renderer.frameCount>1){const s=(l,u)=>{const h={...Uv[r.renderer.frameCount%Uv.length]};l.setViewOffset(u.width,u.height,h.x,h.y,u.width,u.height)},o=r.scene.activeCamera.cameraObject;s(o,{width:r.canvas.clientWidth*r.renderer.displayCanvasScaling,height:r.canvas.clientHeight*r.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(l=>s(...l)),this._hasSetOffset=!0,(i=this._viewer)===null||i===void 0||i.renderer.resetShadows()}},this._resetCameraJitter=t=>{const i=t.target;this._hasSetOffset&&(i.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Wa("Progressive",this),this.maxFrameCount=e}async onAdded(e){return await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(t=>e.renderer.disposeTarget(t)),this._lastFrames.clear(),await super.onRemove(e)}get lastFrame(){var e;return this._lastFrames.get((e=this._viewer)===null||e===void 0?void 0:e.scene.renderCamera.cameraObject.uuid)}getLastFrame(e){return e?this._lastFrames.get(e.cameraObject.uuid):this.lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[Zl(e,{passId:"progressive",get dirty(){var i;return t.jitter&&(((i=t._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends Lv{render(i,r,s,o,l){if(t.lastFrame){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((s==null?void 0:s.texture)&&e.renderer.blit(s.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(i,r,s,o,l),e.renderer.blit(r.texture,t.lastFrame,{})}else e.console.error("lastFrame render target undefined")}},update(){if(!t.lastFrame&&e.scene.renderCamera&&t._lastFrames.set(e.scene.renderCamera.cameraObject.uuid,e.renderer.composerTarget.clone(!0)),!t.lastFrame)return void console.error("lastFrame render target undefined");let i=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(i,i,i,i),i=1-i,this.passObject.weights2.set(i,i,i,i),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t,i;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(i=(t=this.lastFrame)===null||t===void 0?void 0:t.texture)!==null&&i!==void 0?i:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}As.PluginType="Progressive",kv([ae(),Ci("Frame count")],As.prototype,"maxFrameCount",void 0),kv([ae(),Ot("Jitter")],As.prototype,"jitter",void 0);class Dl extends qa{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:p.wem,magFilter:p.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState<500&&(this._toSaveFrame=!0),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this.setDirty(),await(0,V.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[As],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var t;const i=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(!i)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==i)return void(this.pointerEnabled=!0);const r=i.getBoundingClientRect(),s=(e.clientX-r.left)/r.width,o=(e.clientY-r.top)/r.height;this.pointerEnabled=s<0||s>1||o<0||o>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,i=e.getPlugin(As),r=new class extends Lv{constructor(){super(...arguments),this._lastTime=0,this._saveNextFrame=!1,this.uiConfig=Wa("Frame Fade",this)}render(s,o,l,u,h){this.needsSwap=!1;const f=t._target;if(!f||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001||e.scene.renderCamera!==e.scene.activeCamera)return;t._toSaveFrame&&(this._saveNextFrame=!0,t._toSaveFrame=!1),this._saveNextFrame&&i.lastFrame&&(e.renderer.blit(i.lastFrame.texture,f),this._lastTime=0,this._saveNextFrame=!1),this.blendTexture=f==null?void 0:f.texture;const g=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(g),this.weights2.w=1,this.weights1.setScalar(1-g),this.weights1.w=1,super.render(s,o,l,u,h),this.needsSwap=!0;const _=(0,V.now)();this._lastTime<10&&(this._lastTime=_-10);const A=_-this._lastTime;this._lastTime=_,t._fadeTimeState-=A}};return r.enabled=!0,r}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<1&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Dl.PluginType="FrameFade";var Nv=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Ih extends qa{passCtor(e){return new Ko}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[vr],this.enableEdit=!1,this._focalPointHit=new p.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new p.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,t=!0,i=!1){var r,s;this._focalPointHit.copy(e),t&&((s=(r=this._viewer)===null||r===void 0?void 0:r.getPlugin(Dl))===null||s===void 0||s.startTransition(this._frameFadeTime)),i&&(this._focalPointHitTime=(0,V.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&t!==void 0?t:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&t!==void 0?t:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&t!==void 0?t:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,i;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(i=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Dl))===null||i===void 0||i.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))===null||t===void 0||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))===null||t===void 0||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var t,i;if(!super._update(e))return!1;const r=(t=this.pass)===null||t===void 0?void 0:t.passObject;if(!r)return!1;const s=e.getPlugin(vr);s==null||s.updateShaderProperties(r.material),r.dofBlurMaterial.uniforms.frameCount&&((i=e.renderer)===null||i===void 0||i.updateShaderProperties(r.dofBlurMaterial));const o=e.scene.renderCamera;if(!o)return!1;o.cameraObject.updateMatrixWorld(!0),o.updateShaderProperties(r.material),o.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),r.focalDepthRange.x=this._tempVec.length(),r.focalDepthRange.x*=o.cameraObject.getWorldDirection(new p.Pa4).dot(this._tempVec.normalize());let l=((0,V.now)()-this._focalPointHitTime)/this.crossFadeTime;if(l=1-Math.min(1,Math.max(0,l)),Math.abs(l-r.crossAlpha)>.01&&(r.crossAlpha=l,this.setDirty()),l>0){const u=this._tempVec.copy(this._focalPointHit).project(o.cameraObject).addScalar(1).divideScalar(2);r.crossCenter.set(u.x,u.y),r.computeCocMaterial.uniformsNeedUpdate=!0,r.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,t,i,r,s;if(this._uiConfig)return this._uiConfig;const o=(t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig;return o?((r=(i=o.children)===null||i===void 0?void 0:i.map(l=>(0,V.getOrCall)(l)))===null||r===void 0||r.flat(2).forEach(l=>l&&(l.onChange=this.setDirty)),(s=o.children)===null||s===void 0||s.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=o,o):{}}}Ih.PluginType="DepthOfField",Nv([ae()],Ih.prototype,"enableEdit",void 0),Nv([ae("focalPoint")],Ih.prototype,"_focalPointHit",void 0),Nv([ae()],Ih.prototype,"crossFadeTime",void 0);var _A=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Zo=class extends Si{addThinFilmLayer(a){return Q_(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new Q1(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new p.Ltg},thinNoiseLayerFactors:{value:new p.Ltg},thinColorNoiseParams:{value:new p.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&!((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm?bo+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(a,e,t)=>{var i;if(!this.enabled||!(!((i=e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm))return;const r="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(r,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+r),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t;const i=(t=e.materialObject.userData)===null||t===void 0?void 0:t._thinFilmLayer;if(!(i!=null&&i.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(i.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(i.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(i.colorNoiseParams),this._uniforms.thinFilmFactor.value=i.filmFactor;const r=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==r&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.isDiamondMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=a.materialObject.userData._thinFilmLayer)===null||i===void 0?void 0:i.hasThinFilm)||!1},set value(i){var r,s;i!==((r=a.materialObject.userData._thinFilmLayer)===null||r===void 0?void 0:r.hasThinFilm)&&(i?Q_(a.materialObject)||e.alert("Cannot add thin film."):a.materialObject.userData._thinFilmLayer&&(a.materialObject.userData._thinFilmLayer.hasThinFilm=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var i;return!(!((i=a.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var i;return!(!((i=a.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var i;return!(!((i=a.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var i;return!(!((i=a.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)},property:[a.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a;(a=this._viewer)===null||a===void 0||a.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(W1)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function Q_(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),a.isMaterial&&(a.needsUpdate=!0),!0}Zo.PluginType="ThinFilmLayerPlugin",Zo.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",_A([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],Zo.prototype,"enabled",void 0),Zo=_A([zi("ThinFilmLayer Materials")],Zo);class Q1{constructor(e){this.parser=e,this.name=Zo.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.userData||(t.userData={}),Q_(t),t.userData._thinFilmLayer=br(r,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const W1=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const i=cr(e.userData._thinFilmLayer,!1);t.extensions[Zo.THIN_FILM_LAYER_GLTF_EXTENSION]=i,a.extensionsUsed[Zo.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class Sf{async apply(e,t,i){var r,s,o,l;if(!t)return void(this.selected=void 0);let u=this.presets.find(h=>function(f,g){return(typeof f=="string"?f:f.path)===(typeof g=="string"?g:g.path)}(h,t));return u||(this.presets.push(t),u=t),this.selected=u,typeof u!="string"?(s=(r=e.getManager())===null||r===void 0?void 0:r.importer)===null||s===void 0?void 0:s.importAsset(u,i):(l=(o=e.getManager())===null||o===void 0?void 0:o.importer)===null||l===void 0?void 0:l.importPath(u,i)}clear(){this.selected=void 0}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class yA extends Sf{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const i=await super.apply(e,t),r=i==null?void 0:i[0];return r&&(r.colorSpace=p.KI_,e.scene.background=r,e.scene.backgroundColor=new p.Ilk(1,1,1)),r}}class bA extends Sf{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const i=await super.apply(e,t),r=i==null?void 0:i[0];return r&&(e.scene.environment=r),r}}class Um extends Sf{constructor(e="envMap"){super(),this.key=e,this.name="GemEnvironment",this.name+=e.split("Map")[1]}async apply(e,t){const i=await super.apply(e,t),r=i==null?void 0:i[0];return(0,V.safeSetProperty)(e.getPluginByType("Diamond"),this.key,r),r}}class Cf extends Sf{async apply(e,t){var i,r;const s=await super.apply(e,t,{processImported:!1});return s?(r=(i=e.getManager())===null||i===void 0?void 0:i.importer)===null||r===void 0?void 0:r.processImported(s):void 0}}class W_ extends Cf{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const i=await super.apply(e,t);return i&&await e.alert("Material Library successfully imported."),i}}class AA extends Sf{constructor(){super(...arguments),this.name="VJSON",this.usePresetCamera=!1}async apply(e,t){const i=e.scene.activeCamera.toJSON(),r=await super.apply(e,t);return this.usePresetCamera||e.scene.activeCamera.fromJSON(i),r}}class Du extends Si{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>{var i;return{label:((i=Kd(t))===null||i===void 0?void 0:i.split("/").pop())||"",value:Kd(t)}})],getValue:()=>Kd(e.selected)||"",setValue:t=>{e.apply(this._viewer,e.presets.find(i=>Kd(i)===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,V.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,V.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,i;await super.onAdded(e),this.presetGroups.push(new yA),this.presetGroups.push(new bA),this.presetGroups.push(new Um),this.presetGroups.push(new Um("envMap2")),this.presetGroups.push(new Um("envMap3")),this.presetGroups.push(new Cf("Ground")),this.presetGroups.push(new Cf("CameraViews")),this.presetGroups.push(new Cf("MaterialConfiguration")),this.presetGroups.push(new W_),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>[t.name,Kd(t.selected)||void 0]).filter(([,t])=>t));return e.type=Du.PluginType,e}async fromJSON(e,t){var i,r;if(!super.fromJSON(e,t))return null;const s={...e};if(delete s.type,s.VJSON&&this._viewer){const l=this.presetGroups.find(h=>h.name==="VJSON"),u=l==null?void 0:l.presets;l&&u&&await l.apply(this._viewer,{path:s.VJSON}),delete s.VJSON}const o=[];for(const[l,u]of Object.entries(s)){const h=this.presetGroups.find(_=>_.name===l),f=h==null?void 0:h.presets;if(!h||!f)continue;const g=typeof u=="string"?{path:u}:u;o.push(h.apply(this._viewer,g))}return await Promise.all(o),(r=(i=this.uiConfig).uiRefresh)===null||r===void 0||r.call(i,"postFrame",!0),this}async loadPresetGroups(e){var t;typeof e=="string"&&e.startsWith("http")&&(e=await fetch(e).then(async i=>i.json()));for(const[i,r]of Object.entries(e)){const s=(t=this.presetGroups.find(o=>o.name===i))===null||t===void 0?void 0:t.presets;s==null||s.push(...r)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(Kd)]).filter(([,e])=>e.length>0))}clear(){this.presetGroups.forEach(e=>{e.clear()})}}function Kd(a){return a&&typeof a!="string"?a.path:a}Du.PluginType="PresetLibraryPlugin";var Mf,Nm=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Zd=Mf=class{constructor(a){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vn),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(this.extraUniforms.grainIntensity.value=this.grainIntensity,this.extraUniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._setDirty()}};Nm([(0,V.onChange)(Mf.prototype._setDirty),Ot("Enable"),ae()],Zd.prototype,"enabled",void 0),Nm([(0,V.onChange)(Mf.prototype._setDirty),Ot("Multiply"),ae()],Zd.prototype,"grainMultiply",void 0),Nm([(0,V.onChange)(Mf.prototype._setDirty),ai("Intensity",[0,20],.01,{limitedUi:!0}),ae()],Zd.prototype,"grainIntensity",void 0),Zd=Mf=Nm([zi("FilmicGrain")],Zd);class $c extends Zc{constructor(){super()}generateExtension(e){return new Zd(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&t!==void 0&&t}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}$c.PluginType="FilmicGrain";class Rn extends V.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;(t=this._scene)===null||t===void 0||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,i,r){super(),this.hoverEnabled=!1,this._mouseDownPos=new p.FM8,this._scene=e,this._camera=i??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=r??(s=>s.userData.userSelectable!==!1&&s.userData.bboxVisible!==!1&&s.material!=null&&s.material.type!=="ShadowMaterial"),this.raycaster=new p.iMs,this.mouse=new p.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",s=>this.onPointerMove(s)),this.domElement.addEventListener("pointerleave",s=>this.onPointerLeave(s)),this.domElement.addEventListener("pointerout",s=>this.onPointerLeave(s)),this.domElement.addEventListener("pointercancel",s=>this.onPointerCancel(s)),this.domElement.addEventListener("pointerenter",s=>this.onPointerEnter(s)),this.domElement.addEventListener("pointerdown",s=>this.onPointerDown(s)),this.domElement.addEventListener("pointerup",s=>this.onPointerUp(s))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,V.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t,i;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=(i=(t=this.checkIntersection())===null||t===void 0?void 0:t.intersects[0].object)!==null&&i!==void 0?i:null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time,this._mouseDownPos.copy(this.mouse))}onDoubleClick(e){console.log("double click")}onPointerUp(e){if(e.isPrimary===!1)return;this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time;const t=this.mouseDownDeltaTime,i=this._mouseDownPos.distanceTo(this.mouse);t<Rn.PointerClickMaxTime&&i<Rn.PointerClickMaxDistance&&this.onPointerClick(e)}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);let i=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const r=[];i=i.filter(u=>!r.includes(u.object.id)&&(r.push(u.object.id),!0));let s,o=null;const l=[];for(const u of i){for(o=u.object,s=u;!(o==null||o.visible&&this.selectionCondition(o));)o=o.parent;o!=null&&l.push(u)}if(i=l,i.length>0){if(o=i[0].object,s=i[0],this._firstHit&&o.id!==this._firstHit.id)o=s.object;else for(let u=0;u<i.length;u++)if(this.selectedObject&&this.selectedObject.id===i[u].object.id){const h=u+1;if(!(h<i.length))return null;s=i[h],o=s.object}this._firstHit=i[0].object}return o&&s&&o?{selectedObject:o,intersect:s,intersects:i,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}Rn.PointerClickMaxTime=200,Rn.PointerClickMaxDistance=.1;const Rs=new p.ZzF,Jd=new p.Pa4;class $d extends p.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new p.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new p.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new p.$TI(t,6,1);return this.setAttribute("instanceStart",new p.kB5(i,3,0)),this.setAttribute("instanceEnd",new p.kB5(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new p.$TI(t,6,1);return this.setAttribute("instanceColorStart",new p.kB5(i,3,0)),this.setAttribute("instanceColorEnd",new p.kB5(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new p.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new p.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Rs.setFromBufferAttribute(t),this.boundingBox.union(Rs))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new p.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Jd.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Jd)),Jd.fromBufferAttribute(t,s),r=Math.max(r,i.distanceToSquared(Jd));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class X_ extends $d{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new p.Uk6(e))}}p.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new p.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},p.Vj0.line={uniforms:p.rDY.merge([p.rBU.common,p.rBU.fog,p.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Bu extends p.jyz{constructor(e){super({type:"LineMaterial",uniforms:p.rDY.clone(p.Vj0.line.uniforms),vertexShader:p.Vj0.line.vertexShader,fragmentShader:p.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const wA=new p.Pa4,xA=new p.Pa4;class q_ extends p.Kj0{constructor(e=new $d,t=new Bu({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,l=0,u=t.count;o<u;o++,l+=2)wA.fromBufferAttribute(t,o),xA.fromBufferAttribute(i,o),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+wA.distanceTo(xA);const s=new p.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new p.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new p.kB5(s,1,1)),this}}class Y_ extends p.ZAu{_updater(){const e=this._object;if(e){const t=new Re().expandByObject(e,!1);t.getCenter(this.position);const i=t.getBoundingSphere(new p.aLr).radius;this.scale.setScalar(i*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new X_(e);this._geometry=t;const i=new Bu({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new p.FM8(1024,1024),dashed:!1,toneMapped:!1}),r=new q_(t,i);r.computeLineDistances(),r.scale.set(1,1,1),r.visible=!0,this.add(r)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)===null||t===void 0||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class K_ extends Y_{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new p.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Re().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const ep=new p.iMs,wo=new p.Pa4,Ph=new p.Pa4,Un=new p._fP,EA={X:new p.Pa4(1,0,0),Y:new p.Pa4(0,1,0),Z:new p.Pa4(0,0,1)},Z_={type:"change"},SA={type:"mouseDown"},CA={type:"mouseUp",mode:null},MA={type:"objectChange"};class X1 extends p.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new $1;this._gizmo=i,this.add(i);const r=new eE;this._plane=r,this.add(r);const s=this;function o(R,I){let S=I;Object.defineProperty(s,R,{get:function(){return S!==void 0?S:I},set:function(O){S!==O&&(S=O,r[R]=O,i[R]=O,s.dispatchEvent({type:R+"-changed",value:O}),s.dispatchEvent(Z_))}}),s[R]=I,r[R]=I,i[R]=I}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const l=new p.Pa4,u=new p.Pa4,h=new p._fP,f=new p._fP,g=new p.Pa4,_=new p._fP,A=new p.Pa4,x=new p.Pa4,E=new p.Pa4,T=new p.Pa4;o("worldPosition",l),o("worldPositionStart",u),o("worldQuaternion",h),o("worldQuaternionStart",f),o("cameraPosition",g),o("cameraQuaternion",_),o("pointStart",A),o("pointEnd",x),o("rotationAxis",E),o("rotationAngle",0),o("eye",T),this._offset=new p.Pa4,this._startNorm=new p.Pa4,this._endNorm=new p.Pa4,this._cameraScale=new p.Pa4,this._parentPosition=new p.Pa4,this._parentQuaternion=new p._fP,this._parentQuaternionInv=new p._fP,this._parentScale=new p.Pa4,this._worldScaleStart=new p.Pa4,this._worldQuaternionInv=new p._fP,this._worldScale=new p.Pa4,this._positionStart=new p.Pa4,this._quaternionStart=new p._fP,this._scaleStart=new p.Pa4,this._getPointer=q1.bind(this),this._onPointerDown=K1.bind(this),this._onPointerHover=Y1.bind(this),this._onPointerMove=Z1.bind(this),this._onPointerUp=J1.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;ep.setFromCamera(e,this.camera);const t=J_(this._gizmo.picker[this.mode],ep);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){ep.setFromCamera(e,this.camera);const t=J_(this._plane,ep,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,SA.mode=this.mode,this.dispatchEvent(SA)}}pointerMove(e){const t=this.axis,i=this.mode,r=this.object;let s=this.space;if(i==="scale"?s="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(s="world"),r===void 0||t===null||this.dragging===!1||e.button!==-1)return;ep.setFromCamera(e,this.camera);const o=J_(this._plane,ep,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(r.position.applyQuaternion(Un.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),s==="world"&&(r.parent&&r.position.add(wo.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(wo.setFromMatrixPosition(r.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Ph.set(l,l,l)}else wo.copy(this.pointStart),Ph.copy(this.pointEnd),wo.applyQuaternion(this._worldQuaternionInv),Ph.applyQuaternion(this._worldQuaternionInv),Ph.divide(wo),t.search("X")===-1&&(Ph.x=1),t.search("Y")===-1&&(Ph.y=1),t.search("Z")===-1&&(Ph.z=1);r.scale.copy(this._scaleStart).multiply(Ph),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(wo.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(wo.copy(this.rotationAxis).cross(this.eye))*l):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(EA[t]),wo.copy(EA[t]),s==="local"&&wo.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(wo.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(Un.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(Un.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Z_),this.dispatchEvent(MA)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(CA.mode=this.mode,this.dispatchEvent(CA)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Z_),this.dispatchEvent(MA),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ep}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function q1(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function Y1(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a))}}function K1(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function Z1(a){this.enabled&&this.pointerMove(this._getPointer(a))}function J1(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function J_(a,e,t){const i=e.intersectObject(a,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||t)return i[r];return!1}const Fv=new p.USm,_n=new p.Pa4(0,1,0),TA=new p.Pa4(0,0,0),IA=new p.yGw,jv=new p._fP,zv=new p._fP,eu=new p.Pa4,PA=new p.yGw,Fm=new p.Pa4(1,0,0),tp=new p.Pa4(0,1,0),jm=new p.Pa4(0,0,1),Vv=new p.Pa4,zm=new p.Pa4,Vm=new p.Pa4;class $1 extends p.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new p.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new p.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const r=t.clone();r.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const u=e.clone();u.color.setHex(16711680),u.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const g=e.clone();g.opacity=.25;const _=e.clone();_.color.setHex(16776960),_.opacity=.25,e.clone().color.setHex(16776960);const A=e.clone();A.color.setHex(7895160);const x=new p.fHI(0,.04,.1,12);x.translate(0,.05,0);const E=new p.DvJ(.08,.08,.08);E.translate(0,.04,0);const T=new p.u9r;T.setAttribute("position",new p.a$l([0,0,0,1,0,0],3));const R=new p.fHI(.0075,.0075,.5,3);function I(se,de){const ve=new p.XvJ(se,.0075,3,64,de*Math.PI*2);return ve.rotateY(Math.PI/2),ve.rotateX(Math.PI/2),ve}R.translate(0,.25,0);const S={X:[[new p.Kj0(x,s),[.5,0,0],[0,0,-Math.PI/2]],[new p.Kj0(x,s),[-.5,0,0],[0,0,Math.PI/2]],[new p.Kj0(R,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new p.Kj0(x,o),[0,.5,0]],[new p.Kj0(x,o),[0,-.5,0],[Math.PI,0,0]],[new p.Kj0(R,o)]],Z:[[new p.Kj0(x,l),[0,0,.5],[Math.PI/2,0,0]],[new p.Kj0(x,l),[0,0,-.5],[-Math.PI/2,0,0]],[new p.Kj0(R,l),null,[Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.pQR(.1,0),g.clone()),[0,0,0]]],XY:[[new p.Kj0(new p.DvJ(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),u.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},O={X:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,.3,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.pQR(.2,0),i)]],XY:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new p.Kj0(new p.pQR(.01,2),r),null,null,null,"helper"]],END:[[new p.Kj0(new p.pQR(.01,2),r),null,null,null,"helper"]],DELTA:[[new p.x12(function(){const se=new p.u9r;return se.setAttribute("position",new p.a$l([0,0,0,1,1,1],3)),se}(),r),null,null,null,"helper"]],X:[[new p.x12(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p.x12(T,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p.x12(T,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},N={XYZE:[[new p.Kj0(I(.5,1),A),null,[0,Math.PI/2,0]]],X:[[new p.Kj0(I(.5,.5),s)]],Y:[[new p.Kj0(I(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new p.Kj0(I(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new p.Kj0(I(.75,1),_),null,[0,Math.PI/2,0]]]},H={AXIS:[[new p.x12(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},X={XYZE:[[new p.Kj0(new p.xo$(.25,10,8),i)]],X:[[new p.Kj0(new p.XvJ(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new p.Kj0(new p.XvJ(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new p.Kj0(new p.XvJ(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new p.Kj0(new p.XvJ(.75,.1,2,24),i)]]},te={X:[[new p.Kj0(E,s),[.5,0,0],[0,0,-Math.PI/2]],[new p.Kj0(R,s),[0,0,0],[0,0,-Math.PI/2]],[new p.Kj0(E,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(E,o),[0,.5,0]],[new p.Kj0(R,o)],[new p.Kj0(E,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new p.Kj0(E,l),[0,0,.5],[Math.PI/2,0,0]],[new p.Kj0(R,l),[0,0,0],[Math.PI/2,0,0]],[new p.Kj0(E,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new p.Kj0(new p.DvJ(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),u),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.DvJ(.1,.1,.1),g.clone())]]},re={X:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,.3,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new p.Kj0(new p.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new p.Kj0(new p.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new p.Kj0(new p.DvJ(.2,.2,.2),i),[0,0,0]]]},ue={X:[[new p.x12(T,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new p.x12(T,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new p.x12(T,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function le(se){const de=new p.Tme;for(const ve in se)for(let fe=se[ve].length;fe--;){const Ee=se[ve][fe][0].clone(),Je=se[ve][fe][1],Te=se[ve][fe][2],qe=se[ve][fe][3],Ve=se[ve][fe][4];Ee.name=ve,Ee.tag=Ve,Je&&Ee.position.set(Je[0],Je[1],Je[2]),Te&&Ee.rotation.set(Te[0],Te[1],Te[2]),qe&&Ee.scale.set(qe[0],qe[1],qe[2]),Ee.updateMatrix();const Ye=Ee.geometry.clone();Ye.applyMatrix4(Ee.matrix),Ee.geometry=Ye,Ee.renderOrder=1/0,Ee.position.set(0,0,0),Ee.rotation.set(0,0,0),Ee.scale.set(1,1,1),de.add(Ee)}return de}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=le(S)),this.add(this.gizmo.rotate=le(N)),this.add(this.gizmo.scale=le(te)),this.add(this.picker.translate=le(O)),this.add(this.picker.rotate=le(X)),this.add(this.picker.scale=le(re)),this.add(this.helper.translate=le(k)),this.add(this.helper.rotate=le(H)),this.add(this.helper.scale=le(ue)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:zv;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const s=i[r];let o;s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(o*this.size/4),s.tag!=="helper"?(s.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(_n.copy(Fm).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(_n.copy(tp).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(_n.copy(jm).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(_n.copy(jm).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(_n.copy(Fm).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(_n.copy(tp).applyQuaternion(t).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(jv.copy(t),_n.copy(this.eye).applyQuaternion(Un.copy(t).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(IA.lookAt(this.eye,TA,tp)),s.name==="X"&&(Un.setFromAxisAngle(Fm,Math.atan2(-_n.y,_n.z)),Un.multiplyQuaternions(jv,Un),s.quaternion.copy(Un)),s.name==="Y"&&(Un.setFromAxisAngle(tp,Math.atan2(_n.x,_n.z)),Un.multiplyQuaternions(jv,Un),s.quaternion.copy(Un)),s.name==="Z"&&(Un.setFromAxisAngle(jm,Math.atan2(_n.y,_n.x)),Un.multiplyQuaternions(jv,Un),s.quaternion.copy(Un))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(l){return s.name===l}))&&(s.material.color.setHex(16776960),s.material.opacity=1)):(s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(Un.setFromEuler(Fv.set(0,0,0)),s.quaternion.copy(t).multiply(Un),Math.abs(_n.copy(Fm).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(Un.setFromEuler(Fv.set(0,0,Math.PI/2)),s.quaternion.copy(t).multiply(Un),Math.abs(_n.copy(tp).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(Un.setFromEuler(Fv.set(0,Math.PI/2,0)),s.quaternion.copy(t).multiply(Un),Math.abs(_n.copy(jm).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(Un.setFromEuler(Fv.set(0,Math.PI/2,0)),_n.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(IA.lookAt(TA,_n,tp)),s.quaternion.multiply(Un),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),wo.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),wo.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(wo),s.visible=this.dragging):(s.quaternion.copy(t),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1)))}super.updateMatrixWorld(e)}}class eE extends p.Kj0{constructor(){super(new p._12(1e5,1e5,2,2),new p.vBJ({visible:!1,wireframe:!0,side:p.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Vv.copy(Fm).applyQuaternion(t==="local"?this.worldQuaternion:zv),zm.copy(tp).applyQuaternion(t==="local"?this.worldQuaternion:zv),Vm.copy(jm).applyQuaternion(t==="local"?this.worldQuaternion:zv),_n.copy(zm),this.mode){case"translate":case"scale":switch(this.axis){case"X":_n.copy(this.eye).cross(Vv),eu.copy(Vv).cross(_n);break;case"Y":_n.copy(this.eye).cross(zm),eu.copy(zm).cross(_n);break;case"Z":_n.copy(this.eye).cross(Vm),eu.copy(Vm).cross(_n);break;case"XY":eu.copy(Vm);break;case"YZ":eu.copy(Vv);break;case"XZ":_n.copy(Vm),eu.copy(zm);break;case"XYZ":case"E":eu.set(0,0,0)}break;default:eu.set(0,0,0)}eu.length()===0?this.quaternion.copy(this.cameraQuaternion):(PA.lookAt(wo.set(0,0,0),eu,_n),this.quaternion.setFromRotationMatrix(PA)),super.updateMatrixWorld(e)}}class RA extends X1{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(p.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)===null||t===void 0||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const i=e==null?void 0:e.getPlugin(Dl);i&&(t.value?i.disable("TransformControls"):i.enable("TransformControls")),this._scene.activeCamera.setInteractions(!t.value,this.uuid)}),this._keyDownListener=this._keyDownListener.bind(this),this._keyUpListener=this._keyUpListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Gv=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class fr extends Si{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}constructor(e=K_,t=!1,i=!0,r=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=s=>{this._viewer&&(this.enabled?this.dispatchEvent(s):s.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const s=this.getSelectedObject();this.autoFocus&&s&&this.setSelectedObject(s,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=i,this.autoFocus=r}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const i=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=i,(i||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new Rn(e.scene,e.canvas,void 0,t=>{var i,r;if(!t.material)return!1;let s=t,o=!1;for(;s;){if(!s.visible||(((i=s.userData.iModel)!==null&&i!==void 0?i:s).assetType==="model"&&(o=!0),((r=s.userData.iModel)!==null&&r!==void 0?r:s).assetType==="widget")||s.userData.userSelectable===!1||s.userData.bboxVisible===!1)return!1;s=s.parent}return o}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new RA(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var i,r,s;this.dispatchEvent(t);const o=((i=this._picker)===null||i===void 0?void 0:i.selectedObject)||void 0;if(this._pickUi){const h=o==null?void 0:o.uiConfig,f=this.uiConfig;f.children=[...this._uiConfigChildren],h&&f.children.push(h),(r=f.uiRefresh)===null||r===void 0||r.call(f)}const l=this._widget;l&&this._enableWidget&&(o?l.attach(o):l.detach());const u=this._transformControls;u&&!((s=this._viewer)===null||s===void 0)&&s.scene.activeCamera.controls&&(o&&u.enabled?u.attach(o):u.detach()),e.setDirty(),this.autoFocus&&this.focusObject(o)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value===void 0?console.warn("WebGi: e.value must be set for picking, can be null to unselect"):this.setSelectedObject(t.value,this.autoFocus||t.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var i,r,s;const o=t.object,l=this.getSelectedObject();if(l&&(o==null?void 0:o.assetType)==="material"&&typeof(l==null?void 0:l.setMaterial)=="function"&&!((i=l==null?void 0:l.modelObject)===null||i===void 0)&&i.isMesh&&await e.confirm("Applying material: Apply material to the selected object?")){const u=l.material;if(Array.isArray(u))console.warn("WebGi: Dropping on material array not yet fully supported."),l.setMaterial(o);else{let h=Array.from((r=u==null?void 0:u.userData.__appliedMeshes)!==null&&r!==void 0?r:[]);(h.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):h.length<1)&&(h=[l]);for(const f of h)f&&((s=f.setMaterial)===null||s===void 0||s.call(f,o))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const i=this.getSelectedObject();let r=!1;i==null||i.traverseAncestors(s=>{s===e.scene.modelObject&&(r=!0)}),r||this.setSelectedObject(void 0)})}async focusObject(e){var t,i,r,s;const o=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CameraViews");await(o==null?void 0:o.animateToFitObject(e,1.25,1e3,"easeOut",{min:((s=(r=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.getControls())===null||r===void 0?void 0:r.minDistance)!==null&&s!==void 0?s:.5)+.5,max:50}))}enableWidget(e){var t,i,r;if(this._enableWidget=e,e){const s=((t=this._picker)===null||t===void 0?void 0:t.selectedObject)||void 0;s&&((i=this._widget)===null||i===void 0||i.attach(s))}else(r=this._widget)===null||r===void 0||r.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}fr.PluginType="Picking",Gv([ae()],fr.prototype,"enabled",void 0),Gv([ae()],fr.prototype,"autoFocus",void 0);var $_,ip=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Oa=$_=class extends Si{enableCustomBump(a,e,t){var i,r;const s=(i=a.materialObject)===null||i===void 0?void 0:i.userData;if(!s)return!1;if(s._hasCustomBump===void 0){const o=s.__appliedMeshes;let l=!0;if(o)for(const{geometry:u}of o)!u||u.attributes.position&&u.attributes.normal&&u.attributes.uv||(l=!1);if(!l)return!1}return s._hasCustomBump=!0,s._customBumpScale=(r=t??s._customBumpScale)!==null&&r!==void 0?r:.001,s._customBumpMap=e??s._customBumpMap,a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new tE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new p.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(a,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(a,e,t)=>{var i;this.enabled&&e.materialObject.userData._hasCustomBump&&!((i=e.materialObject.userData)===null||i===void 0)&&i._customBumpMap&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),a.vertexShader=Mi(a.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),a.vertexShader=Mi(a.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),a.defines.USE_UV="")},onObjectRender:(a,e)=>{var t;const i=e.materialObject.userData;if(!(i!=null&&i._hasCustomBump))return;const r=a;if(!r.isMesh||!r.geometry)return;const s=!((t=i._customBumpMap)===null||t===void 0)&&t.isTexture?i._customBumpMap:null;this._uniforms.customBumpMap.value=s,this._uniforms.customBumpScale.value=s?i._customBumpScale:0,s&&(s.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(s.matrix));let o=this.enabled&&s?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,i;return(this.enabled?"1":"0")+(!((e=a.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((i=(t=a.materialObject.userData)===null||t===void 0?void 0:t._customBumpMap)===null||i===void 0?void 0:i.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t=this.enableCustomBump,i={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._hasCustomBump||!1},set value(r){var s;r!==a.materialObject.userData._hasCustomBump&&(r?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._hasCustomBump=!1,a.materialObject.needsUpdate=!0),(s=i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!a.materialObject.userData._hasCustomBump,property:[a.materialObject.userData,"_customBumpMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},Oi(a.materialObject.userData,"_customBumpMap")]};return i}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this.enableCustomBumpSelected=()=>{var a,e,t;const i=(t=(e=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(fr))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(i==null?void 0:i.assetType)==="material"&&this.enableCustomBump(i)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(ey)}async onRemove(a){var e,t,i,r,s,o,l,u,h,f,g,_;(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate);const A=(u=(l=(o=(s=a.getPlugin(Ut))===null||s===void 0?void 0:s.exporter)===null||o===void 0?void 0:o.getExporter("gltf","glb"))===null||l===void 0?void 0:l.extensions)===null||u===void 0?void 0:u.indexOf(ey);return A!==void 0&&A!==-1&&((_=(g=(f=(h=a.getPlugin(Ut))===null||h===void 0?void 0:h.exporter)===null||f===void 0?void 0:f.getExporter("gltf","glb"))===null||g===void 0?void 0:g.extensions)===null||_===void 0||_.splice(A,1)),super.onRemove(a)}};Oa.PluginType="CustomBumpMapPlugin",Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",ip([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],Oa.prototype,"enabled",void 0),ip([Ot("Bicubic",a=>({onChange:a.setDirty})),oe("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,$_.prototype.setDirty),ae()],Oa.prototype,"bicubicFiltering",void 0),ip([Xi("Enable CustomBumpMap",a=>({hidden:()=>{var e;return!(!((e=a._viewer)===null||e===void 0)&&e.getPlugin(fr))}}))],Oa.prototype,"enableCustomBumpSelected",void 0),Oa=$_=ip([zi("CustomBumpMap Materials")],Oa);class tE{constructor(e){this.parser=e,this.name=Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){var i;const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],l=s.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=(i=l.customBumpScale)!==null&&i!==void 0?i:0;const u=l.customBumpMap;return u&&o.push(r.assignTexture(t.userData,"_customBumpMap",u).then(h=>{h.colorSpace=p.KI_})),Promise.all(o)}}const ey=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const i={};if(i.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const r={index:a.processTexture(e.userData._customBumpMap)};a.applyTextureTransform(r,e.userData._customBumpMap),i.customBumpMap=r}t.extensions[Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=i,a.extensionsUsed[Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var Ou,na=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let tn=Ou=class extends Si{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(a){this._animationTime=Math.max(0,Math.min(a,this._animationDuration))}_wheel({deltaY:a}){this.enabled&&Math.abs(a)>.001&&(this._scrollAnimationState=-1*Math.sign(a))}_drag(a){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=a.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=a.delta.y*this._viewer.canvas.height/4)}_postFrame(){var a,e;if(!this._viewer)return;const t=this._viewer,i=this.animateOnScroll,r=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!i&&!r)return this._lastFrameTime=0,void(this._fadeDisabled&&((a=this._viewer.getPluginByType("FrameFade"))===null||a===void 0||a.enable(Ou.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const l=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=l-1/30);let u=l-this._lastFrameTime;if(u*=this.animationSpeed,this._lastFrameTime=l,i&&r?u*=(0,V.absMax)(this._scrollAnimationState,this._dragAnimationState):i?u*=this._scrollAnimationState:r&&(u*=this._dragAnimationState),Math.abs(u)<1e-4)return;const h=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(h&&h>0&&(u=h),h===0)return;const f=Math.abs(this.timeScale);this._animationTime+=u*(f>0?f:1)}const s=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const o=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(l=>{l.mixer.setTime(o)}),!(Math.abs(s)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:o}),t.scene.activeCamera.cameraObject.userData.__animatingCamera&&t.scene.activeCamera.setDirty(),t.scene.refreshActiveCameraNearFar(),t.renderer.resetShadows(),t.setDirty(),!this._fadeDisabled){const l=this._viewer.getPluginByType("FrameFade");l&&(l.disable(Ou.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[Ut],this._pointerDragHelper=new V.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=a=>{const e=a.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let t=!1;e.modelObject.traverse(i=>{var r;const s=i.animations;if(s.length<1)return;const o=Math.max(...s.map(h=>h.duration));((r=e.modelObject.userData.gltfAnim_SyncMaxDuration)!==null&&r!==void 0?r:this.syncMaxDuration)&&(s.forEach(h=>h.duration=o),e.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const l=new p.Xcj(this._viewer.scene.modelRoot.modelObject),u=s.map(h=>l.clipAction(h).setLoop(this.loopAnimations?p.YKA:p.jAl,this.loopRepetitions));u.forEach(h=>h.clampWhenFinished=!0),this.animations.push({mixer:l,clips:s,actions:u,duration:o}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new iE(e,this))}async onAdded(a){var e,t,i,r,s,o;(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),a.scene.addEventListener("addSceneObject",this._objectAdded),(o=(s=(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.exporter)===null||r===void 0?void 0:r.getExporter("gltf","glb"))===null||s===void 0?void 0:s.extensions)===null||o===void 0||o.push(Gm),a.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=a.canvas;let l=-1;return Object.defineProperty(a.scene.modelRoot,"currentTimelineMarker",{get:()=>l,set:u=>a.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[l=u]})}),a.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:u})=>{var h;if(!this._viewer)return;if(!u)return this._viewer.scene.activeCamera=(h=this._viewer)===null||h===void 0?void 0:h.scene.defaultCamera,void this._viewer.setDirty();const f=u.camera;f&&(f.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(f))}),super.onAdded(a)}async onRemove(a){for(var e,t;this.animations.length;)this.animations.pop();return a.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),a.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(a)}_onPropertyChange(a=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&a&&this.playAnimation()}onStateChange(){var a,e;(e=(a=this.uiConfig)===null||a===void 0?void 0:a.children)===null||e===void 0||e.map(t=>t&&(0,V.getOrCall)(t)).flat(2).forEach(t=>{var i;return(i=t==null?void 0:t.uiRefresh)===null||i===void 0?void 0:i.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(a,e=!1){return this.playClips([a],e)}async playClips(a,e=!1){const t=[];return this.animations.forEach(({actions:i})=>{i.forEach(r=>{a.includes(r.getClip().name)&&t.push(r)})}),this.playAnimation(e,t)}async playAnimation(a=!1,e){var t;if(!this.enabled)return;let i=!1;this._animationState==="playing"&&(this.stopAnimation(!1),i=!0);let r=0;const s=!e;e||(e=[],this.animations.forEach(({mixer:l,actions:u,clips:h})=>{e.push(...u)})),i?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(l=>{l.reset()}),this._animationTime=0);const o=Wn();this._lastAnimId=o;for(const l of e)l.setLoop(this.loopAnimations?p.YKA:p.jAl,this.loopRepetitions),l.play(),r=Math.max(r,l.getClip().duration/Math.abs(l.timeScale));if(this._animationState="playing",(t=this._viewer)===null||t===void 0||t.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise((l,u)=>{const h=()=>{this.removeEventListener("checkpointEnd",h),l()};this.addEventListener("checkpointEnd",h)})}else{const l=this.loopAnimations?this.loopRepetitions:1;if(r*=l,!isFinite(r))return;await new Promise((u,h)=>{const f=g=>{g.time>=r&&(this.removeEventListener("animationStep",f),u())};this.addEventListener("animationStep",f)})}o===this._lastAnimId&&this.stopAnimation(a)}pauseAnimation(){var a;this._animationState==="playing"?(this._animationState="paused",(a=this._viewer)===null||a===void 0||a.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var a;this._animationState==="paused"?(this._animationState="playing",(a=this._viewer)===null||a===void 0||a.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(a=!1){var e,t;this._animationState="stopped",a?this.resetAnimation():(e=this._viewer)===null||e===void 0||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))===null||t===void 0||t.enable(Ou.PluginType),this._fadeDisabled=!1)}resetAnimation(){var a;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:t,clips:i})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(a=this._viewer)===null||a===void 0||a.setDirty()):this.stopAnimation(!0)}};tn.PluginType="GLTFAnimation",tn.AnimationMarkersExtension="WEBGI_animation_markers",na([ae()],tn.prototype,"autoIncrementTime",void 0),na([ql()],tn.prototype,"animationState",null),na([ql()],tn.prototype,"animationTime",null),na([ql()],tn.prototype,"animationDuration",null),na([(0,V.onChange2)(Ou.prototype._onPropertyChange),Ot("Loop",{limitedUi:!0}),ae()],tn.prototype,"loopAnimations",void 0),na([(0,V.onChange2)(Ou.prototype._onPropertyChange),ae()],tn.prototype,"loopRepetitions",void 0),na([ai("Timescale",[-2,2],.01),ae()],tn.prototype,"timeScale",void 0),na([ai("Speed",[.1,4],.1,{limitedUi:!0}),ae()],tn.prototype,"animationSpeed",void 0),na([Ot(),ae()],tn.prototype,"animateOnScroll",void 0),na([Ot(),ae()],tn.prototype,"animateOnDrag",void 0),na([Fs("Drag Axis",[{label:"x"},{label:"y"}]),ae()],tn.prototype,"dragAxis",void 0),na([Ot(),ae()],tn.prototype,"autoplayOnLoad",void 0),na([Ot("syncMaxDuration(dev)"),ae()],tn.prototype,"syncMaxDuration",void 0),na([(0,V.onChange)(Ou.prototype.onStateChange)],tn.prototype,"_animationState",void 0),na([Xi("Play/Pause",a=>({label:()=>a.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],tn.prototype,"playPauseAnimation",null),na([Xi("Stop",{limitedUi:!0})],tn.prototype,"stopAnimation",null),na([Xi("Reset",{limitedUi:!0})],tn.prototype,"resetAnimation",null),tn=Ou=na([zi("GLTF Animations")],tn);class iE{constructor(e,t){this.parser=e,this.name=tn.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){var t;let i=[];for(const _ of this.parser.json.scenes||[]){if(!_.extensions)continue;const A=_.extensions[this.name];for(const x of(A==null?void 0:A.markers)||[]){const E=x.camera!==void 0?await this.parser.getDependency("camera",x.camera):void 0;x.time===void 0&&(x.time=x.frame/30,console.error("Update timeline markers plugin for correct times.")),i.push({name:x.name,frame:x.frame,time:x.time,camera:E})}}if(i.length<1)return;i=i.sort((_,A)=>_.frame-A.frame);const r=(t=e.scene)!==null&&t!==void 0?t:e.scenes[0];if(!r)return;r.userData.__markers=i;const s=this.plugin.timelineMarkers,o=i.map(_=>_.time);let l=s.length;const u=i.map(_=>l++),h=Math.max(...o)+.01;s.push(...i);const f=new p.dUE(".currentTimelineMarker",o,u,p.Syv),g=new p.m7l("animationTimelineMarker",h,[f]);g.__gltfExport=!1,e.animations.push(g)}}const Gm=a=>({afterParse(e){const t=a.json.scenes[a.json.scene||0];t.extensions=t.extensions||{};const i={markers:[]},r=[];if((Array.isArray(e)?e:[e]).forEach(s=>s.traverse(o=>{o.userData.__markers&&r.push(...o.userData.__markers)})),r.sort((s,o)=>s.frame-o.frame),!(r.length<1)){for(const s of r){const o=s.camera;if(o){const l=a.nodeMap.get(o);if(l===void 0){console.warn("Camera not found in gltf export",o,a.nodeMap);continue}const u=a.json.nodes[l].camera;s.camera=u,i.markers.push(s)}}t.extensions[tn.AnimationMarkersExtension]=i,a.extensionsUsed[tn.AnimationMarkersExtension]=!0}}});var Tf=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Hv=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,Qv=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,If=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Bl=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Jo extends On{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,t,i,r=!1){super({vertexShader:Pn,fragmentShader:`

${If}
${Tf}
${bo}
${Hv}
${i}

${Qv}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!r},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new p.yGw},screenSize:{value:new p.FM8},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:r?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(s,o,l)=>{var u;if(!s.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(u=this._target)===null||u===void 0?void 0:u.texture;const h=o.materialObject;let f=this.material.defines.SSGI_ENABLED;h.defines.SSGI_ENABLED!==f&&(h.defines.SSGI_ENABLED=f,h.needsUpdate=!0),f=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==f&&(this.materialExtension.extraUniforms.tSSGIMap.value=f,h.needsUpdate=!0);const g="vec3 totalDiffuse =";s.fragmentShader=s.fragmentShader.replace(g,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${g}`),s.fragmentShader=s.fragmentShader.replace("#include <aomap_fragment>",""),s.defines.USE_UV=""},onObjectRender:(s,o,l)=>{var u,h,f;const g=o.materialObject,_=!g.transparent&&g.transmission<.001,A=this.enabled&&_&&(this.renderWithCamera||this._renderer.frameCount>1)&&l.userData.screenSpaceRendering!==!1&&!(!((u=g.userData)===null||u===void 0)&&u.ssrtaoDisabled)&&!(!((h=g.userData)===null||h===void 0)&&h.ssaoDisabled)&&!(!((f=g.userData)===null||f===void 0)&&f.pluginsDisabled)?1:0;g.defines.SSRTAO_ENABLED!==A&&(g.defines.SSRTAO_ENABLED=A,g.needsUpdate=!0)},parsFragmentSnippet:s=>{var o;return V.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${ot("tSSGIMap",(o=this._target)===null||o===void 0?void 0:o.texture,s.capabilities.isWebGL2)}

            ${Lm}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:s=>{var o,l,u,h;return this.enabled?"1":"0"+((l=(o=this._target)===null||o===void 0?void 0:o.texture)===null||l===void 0?void 0:l.colorSpace)+((h=(u=this._target)===null||u===void 0?void 0:u.texture)===null||h===void 0?void 0:h.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:s=>{var o;return!(!((o=s.materialObject.userData)===null||o===void 0)&&o.ssaoDisabled)&&s.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Qa(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=r,this.ssgiEnabled=r,this.bilateralPass=new _i(this._target,i,"rgba")}render(e,t,i,r,s){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,i,r,s),this.smoothEnabled&&this.bilateralPass.render(e,t,i,r,s))}}Bl([ae()],Jo.prototype,"bilateralPass",void 0),Bl([ai("Intensity",[0,4]),ae(),Qe()],Jo.prototype,"intensity",void 0),Bl([ai("Power",[0,3]),ae(),Qe()],Jo.prototype,"power",void 0),Bl([Ot("Auto radius"),ae(),Qe()],Jo.prototype,"autoRadius",void 0),Bl([ai("Object Radius",[.01,10]),ae(),Qe()],Jo.prototype,"objectRadius",void 0),Bl([ai("Tolerance",[.1,5]),ae(),Qe()],Jo.prototype,"tolerance",void 0),Bl([ai("Bias",[-.3,.3]),ae(),Qe()],Jo.prototype,"bias",void 0),Bl([ai("Falloff",[1e-4,4]),ae(),Qe()],Jo.prototype,"falloff",void 0),Bl([ai("Ray Count",[1,5],1),ae(),Qe()],Jo.prototype,"rayCount",void 0),Bl([ai("Step count",[1,16],1),ae(),oe("RTAO_STEP_COUNT")],Jo.prototype,"stepCount",void 0),Bl([Ot("Smooth Enabled"),ae()],Jo.prototype,"smoothEnabled",void 0),Bl([Ot("Render with Camera")],Jo.prototype,"renderWithCamera",void 0);class Pf extends Jc{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[Ut,vr,As],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,i;await super.onAdded(e),this.enabled=this._initEnabled,(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssrtgi)===null||t===void 0)&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,i,r;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(t=this._viewer)===null||t===void 0||t.getPluginByType("debug"),[Zl(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Jo(e.renderer,this._rtgiTarget,(r=(i=e.getPlugin(vr))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&r!==void 0?r:"",!0),update:()=>{var s;const o=this.enabled;if(o){const l=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("SSAO");l!=null&&l.enabled&&(l.enabled=!1)}o&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(vr)])}},()=>[e.getPlugin(vr),e.getPlugin(As),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,i,r,s;const o=(i=(t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&i!==void 0?i:{};return(s=(r=o.children)===null||r===void 0?void 0:r.map(l=>(0,V.getOrCall)(l)))===null||s===void 0||s.flat(2).forEach(l=>l&&(l.onChange=this.setDirty)),o}}Pf.PluginType="SSGI";let ty=class extends pu{constructor(a,e,t){super(a,e,t??new DA,new p.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,i,r){this.enabled&&super.render(a,e,t,i,r)}};ty=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([zi("High Precision Normal Buffer")],ty);class DA extends p.RSm{constructor(){super()}onBeforeRender(e,t,i,r,s){var o,l,u;let h=s.material;Array.isArray(h)&&(h=h[0]),this.normalMap=(o=h==null?void 0:h.normalMap)!==null&&o!==void 0?o:null,this.bumpMap=(l=h==null?void 0:h.bumpMap)!==null&&l!==void 0?l:null,this.bumpScale=h==null?void 0:h.bumpScale,h!=null&&h.normalScale&&this.normalScale.copy(h==null?void 0:h.normalScale),this.needsUpdate=!0,this.side=(u=h.side)!==null&&u!==void 0?u:p.ehD}}class Rh extends qa{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:p.cLu,minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,i=new Set,r=new Set;return new class extends ty{render(s,o,l,u,h){const f=s.getRenderTarget(),g=s.getActiveCubeFace(),_=s.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:A})=>{A&&((A.transparent&&A.userData.renderToDepth||!A.transparent&&A.transmission===0&&A.userData.renderToDepth===!1)&&(i.add(A),A.transparent=!A.transparent),Math.abs(A.transmission||0)>0&&A.userData.renderToDepth&&(r.add([A,A.transmission]),A.transmission=0))}),Wt(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(s,o,t,u,h)),i.forEach(A=>A.transparent=!A.transparent),i.clear(),r.forEach(([A,x])=>A.transmission=x),r.clear(),s.setRenderTarget(f,g,_))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,i;return e.renderer.disposeTarget((i=(t=this._normalTarget)===null||t===void 0?void 0:t.dispose)===null||i===void 0?void 0:i.call(t)),super.onRemove(e)}updateShaderProperties(e){var t,i;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(i=(t=this.getNormalBuffer())===null||t===void 0?void 0:t.texture)!==null&&i!==void 0?i:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Rh.PluginType="NormalBufferPlugin";var iy=function(a,e){return iy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},iy(a,e)};function ry(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=a}iy(a,e),a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ny,sy=function(){function a(){}return a._xfnv1a=function(e){for(var t=2166136261,i=0;i<e.length;i++)t=Math.imul(t^e.charCodeAt(i),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},a}(),rE=function(a){function e(t){var i=a.call(this)||this;return i.a=e._xfnv1a(t)(),i}return ry(e,a),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(sy),nE=function(a){function e(t){var i=a.call(this)||this,r=e._xfnv1a(t);return i.a=r(),i.b=r(),i.c=r(),i.d=r(),i}return ry(e,a),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(sy),BA=function(a){function e(t){var i=a.call(this)||this,r=e._xfnv1a(t);return i.a=r(),i.b=r(),i.c=r(),i.d=r(),i}return ry(e,a),e.prototype.next=function(){var t=this.b<<9,i=5*this.a;return i=i<<7|9*(i>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(i>>>0)/4294967296},e}(sy);(function(a){a.sfc32="sfc32",a.mulberry32="mulberry32",a.xoshiro128ss="xoshiro128ss"})(ny||(ny={}));var OA=function(){function a(e,t){t===void 0&&(t=ny.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return a.prototype.next=function(){return this.generator.next()},a.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new nE(this.str);case"mulberry32":return new rE(this.str);case"xoshiro128ss":return new BA(this.str);default:return this.wrap()}},a.prototype.wrap=function(){return{next:function(){return Math.random()}}},a}(),LA=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Hm extends Ud{constructor(e,t,i,r){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new p.Pa4(10,10,10),normalDirection:new p.Pa4(.01,.98,.01).normalize(),direction:new p.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=i??{},this.randomParams=r??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,i=null){const r=new OA(e.toString()),s=new p.FM8(r.next()*Math.PI*2,Math.asin(2*r.next()-1));let o=new p.Pa4(Math.cos(s.x)*Math.cos(s.y),Math.sin(s.y),Math.sin(s.x)*Math.cos(s.y));const l=new p.FM8;for(let u=0;u<5;u++){l.set(r.next(),r.next()),o=kA(l,this._randomParams.normalDirection,.4),r.next()<Math.sqrt(t??this._randomParams.focus)&&(l.set(r.next(),r.next()),o=kA(l,this._randomParams.direction,Math.pow((i??this._randomParams.spread)/2,2)));const h=o.dot(this._randomParams.normalDirection);if(h>0&&h<.4)break}o.normalize(),o.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(o.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new p.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function kA(a,e,t){e=e.clone().normalize();const i=new p.Pa4(0,-e.z,e.y).normalize(),r=new p.Pa4().crossVectors(e,i).normalize(),s=a;s.x=2*s.x*Math.PI,s.y=1-s.y*t;const o=Math.sqrt(1-s.y*s.y);return i.multiplyScalar(Math.cos(s.x)*o).add(r.multiplyScalar(Math.sin(s.x)*o)).add(e.multiplyScalar(s.y))}LA([ae("shadowParams")],Hm.prototype,"_shadowParams",void 0),LA([ae("randomParams")],Hm.prototype,"_randomParams",void 0);var ay=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Dh extends Si{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new Hm("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var t,i,r;if(!this.enabled)return void(this.light.layers.mask=0);const s=(i=(t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)!==null&&i!==void 0?i:0;this.light.randomizePosition(s<5?0:s),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(r=this._cameraHelper)===null||r===void 0||r.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new p.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,i;e?(t=this._viewer)===null||t===void 0||t.scene.setDirty():(i=this._viewer)===null||i===void 0||i.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Dh.PluginType="RandomizedDirectionalLight",ay([ae()],Dh.prototype,"enabled",void 0),ay([ae("rdLight")],Dh.prototype,"light",void 0),ay([ae()],Dh.prototype,"lightLayers",void 0);var oy=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,dc=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let io=class extends On{constructor(a,e,t,i=!0){super({vertexShader:Pn,fragmentShader:`

varying vec2 vUv;

${If}
${Tf}
${bo}
${Hv}
${t}

${Qv}

${oy}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new p.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new p.yGw},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:i?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,s,o)=>{var l,u,h,f,g;let _=!this.enabled||o.userData.screenSpaceRendering===!1||!((l=s.materialObject.userData)===null||l===void 0)&&l.pluginsDisabled||!((u=s.materialObject.userData)===null||u===void 0)&&u.ssreflDisabled?0:1;if(s.materialObject.defines.SSR_ENABLED!==_&&(s.materialObject.defines.SSR_ENABLED=_,s.materialObject.needsUpdate=!0),!r.defines.SSR_ENABLED)return;_=this.material.defines.SSR_STEP_COUNT,s.materialObject.defines.SSR_STEP_COUNT!==_&&(s.materialObject.defines.SSR_STEP_COUNT=_,s.materialObject.needsUpdate=!0),_=this.material.defines.SSR_LOW_QUALITY_FRAMES,s.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==_&&(s.materialObject.defines.SSR_LOW_QUALITY_FRAMES=_,s.materialObject.needsUpdate=!0),_=this.material.defines.PERSPECTIVE_CAMERA,s.materialObject.defines.PERSPECTIVE_CAMERA!==_&&(s.materialObject.defines.PERSPECTIVE_CAMERA=_,s.materialObject.needsUpdate=!0),_=this.material.defines.SSR_INLINE,s.materialObject.defines.SSR_INLINE!==_&&(s.materialObject.defines.SSR_INLINE=_,s.materialObject.needsUpdate=!0),_=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,s.materialObject.defines.SSR_MASK_FRONT_RAYS!==_&&(s.materialObject.defines.SSR_MASK_FRONT_RAYS=_,s.materialObject.needsUpdate=!0),_=!((h=s.materialObject.userData)===null||h===void 0)&&h.ssreflNonPhysical?"1":"0",s.materialObject.defines.SSR_NON_PHYSICAL!==_&&(s.materialObject.defines.SSR_NON_PHYSICAL=_,s.materialObject.needsUpdate=!0),_=(g=(f=this._target)===null||f===void 0?void 0:f.texture)!==null&&g!==void 0?g:null,this.materialExtension.extraUniforms.tSSRMap.value!==_&&(this.materialExtension.extraUniforms.tSSRMap.value=_,s.materialObject.needsUpdate=!0);const A="#glMarker beforeModulation";r.fragmentShader=r.fragmentShader.replace(A,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${A}`)},onObjectRender:(r,s,o)=>{var l,u;const h=!this.enabled||o.userData.screenSpaceRendering===!1||!((l=s.materialObject.userData)===null||l===void 0)&&l.pluginsDisabled||!((u=s.materialObject.userData)===null||u===void 0)&&u.ssreflDisabled?0:1;s.materialObject.defines.SSR_ENABLED!==h&&(s.materialObject.defines.SSR_ENABLED=h,s.materialObject.needsUpdate=!0)},parsFragmentSnippet:(r,s)=>{var o,l,u;return!this.enabled||r.userData.screenSpaceRendering===!1||!((o=s==null?void 0:s.materialObject.userData)===null||o===void 0)&&o.ssreflDisabled||!((l=s==null?void 0:s.materialObject.userData)===null||l===void 0)&&l.pluginsDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+ot("tSSRMap",(u=this._target)===null||u===void 0?void 0:u.texture,r.capabilities.isWebGL2)+ot("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,r.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${If}
    
    #define THREE_PACKING_INCLUDED
    ${Tf}
    
    ${bo}
    ${Hv}
    ${ha}
    
    ${Qv}
    
    ${oy}
// #endif // SSR_INLINE
#endif
`:"")+`
${Lm}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:r=>{var s,o,l;return this.enabled?"1":"0"+((o=(s=this._target)===null||s===void 0?void 0:s.texture)===null||o===void 0?void 0:o.colorSpace)+(this.enabled&&!(!((l=r.materialObject.userData)===null||l===void 0)&&l.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(u=>u+"").join(",")},isCompatible:r=>{var s;return!(!((s=r.materialObject.userData)===null||s===void 0)&&s.ssreflDisabled)&&r.isMeshStandardMaterial2}},this.intensity=1,this.boost=new p.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=a,this._target=e,this.needsSwap=!1,this._inline=i}render(a,e,t,i,r){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(a,this._target,t,i,r),this.needsSwap=!1}}};dc([ai("Intensity",[0,4]),ae(),Qe()],io.prototype,"intensity",void 0),dc([Mn("Boost"),ae(),Qe()],io.prototype,"boost",void 0),dc([ai("Object Radius",[.01,2]),ae(),Qe()],io.prototype,"objectRadius",void 0),dc([Ot("Auto radius"),ae(),Qe()],io.prototype,"autoRadius",void 0),dc([ai("Power",[0,3]),ae(),Qe()],io.prototype,"power",void 0),dc([ai("Tolerance",[.1,5]),ae(),Qe()],io.prototype,"tolerance",void 0),dc([ai("Step count",[1,32],1),ae(),oe("SSR_STEP_COUNT")],io.prototype,"stepCount",void 0),dc([ai("Low Quality Frames",[0,4],1),ae(),oe("SSR_LOW_QUALITY_FRAMES")],io.prototype,"lowQualityFrames",void 0),dc([Ot("Ignore front rays"),ae(),oe("SSR_MASK_FRONT_RAYS")],io.prototype,"maskFrontRays",void 0),dc([ai("Mask front rays factor",[-1,1],.01,a=>({hidden:()=>!a.maskFrontRays})),ae(),Qe()],io.prototype,"maskFrontFactor",void 0),io=dc([zi("Screen Space Reflections")],io);class rp extends Jc{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[Ut,vr,As],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return((t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssr)===null||t===void 0)&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,i;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}createPasses(e){var t,i;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Zl(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new io(e.renderer,this._ssrTarget,(i=(t=e.getPlugin(vr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&i!==void 0?i:"",this.inlineSSR)},()=>[e.getPlugin(vr),e.getPlugin(As),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,i,r,s;const o=(i=(t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&i!==void 0?i:{};return(s=(r=o.children)===null||r===void 0?void 0:r.map(l=>(0,V.getOrCall)(l)))===null||s===void 0||s.flat(2).forEach(l=>l&&(l.onChange=this.setDirty)),o}}rp.PluginType="SSReflection";var ly=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let xo=class extends Si{makeAnisotropic(a){var e;const t=(e=a.materialObject)===null||e===void 0?void 0:e.userData;if(!t)return!1;if(t._isAnisotropic===void 0){const i=t.__appliedMeshes;let r=!0;if(i)for(const{geometry:s}of i)!s||s.index&&s.attributes.position&&s.attributes.normal&&s.attributes.uv||(r=!1),r&&!s.attributes.tangent&&s.computeTangents();if(!r)return!1}return t._isAnisotropic=!0,t._anisotropyFactor===void 0&&(t._anisotropyFactor=1),t._anisotropyNoise===void 0&&(t._anisotropyNoise=0),t._anisotropyDirectionMode===void 0&&(t._anisotropyDirectionMode="DIRECTION"),a.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new sE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var i;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const r=(i=e.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap,s=V.glsl`
                //#if ANISOTROPY_ENABLED
                ${bo}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(r?ot("anisotropyDirectionMap",r,t.capabilities.isWebGL2):"")+`
`;a.fragmentShader=Mi(a.fragmentShader,"#include <common>",s,{append:!0}),a.fragmentShader=a.fragmentShader.replace("#include <lights_fragment_begin>",p.WdD.lights_fragment_begin),a.fragmentShader=Mi(Mi(a.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let o=Mi(p.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");o=Mi(o,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),a.fragmentShader=Mi(a.fragmentShader,"#include <lights_physical_pars_fragment>",o),a.fragmentShader=Mi(a.fragmentShader,"#include <normal_fragment_begin>",p.WdD.normal_fragment_begin),a.fragmentShader=Mi(a.fragmentShader,"#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) || defined( USE_TANGENT )");let l=V.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+p.WdD.lights_fragment_maps;l=Mi(l,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),l=Mi(l,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),a.fragmentShader=Mi(a.fragmentShader,"#include <lights_fragment_maps>",l),a.defines.USE_UV="",a.vertexTangents=!0},onObjectRender:(a,e)=>{var t;const i=e.materialObject.userData;if(!(i!=null&&i._isAnisotropic))return;const r=a;if(!r.isMesh||!r.geometry)return;if(!r.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=i._anisotropyFactor,this._uniforms.anisotropyNoise.value=i._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((t=i._anisotropyDirectionMap)===null||t===void 0)&&t.isTexture?i._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=i._anisotropyDirection;let s=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==s&&(e.materialObject.defines.ANISOTROPY_ENABLED=s,e.materialObject.needsUpdate=!0),s=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==s&&(e.materialObject.defines.ANISOTROPY_DEBUG=s,e.materialObject.needsUpdate=!0),s=i._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(s="CONSTANT"),s=s==="DIRECTION"?2:s==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==s&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=s,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t,i;return(this.enabled?"1":"0")+(!((e=a.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((i=(t=a.materialObject.userData)===null||t===void 0?void 0:t._anisotropyDirectionMap)===null||i===void 0?void 0:i.uuid)},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)===null||a===void 0?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.makeAnisotropic,i={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return a.materialObject.userData._isAnisotropic||!1},set value(r){var s;r!==a.materialObject.userData._isAnisotropic&&(r?t(a)||e.alert("One or more geometries cannot be made anisotropic."):(a.materialObject.userData._isAnisotropic=!1,a.materialObject.needsUpdate=!0),(s=i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!a.materialObject.userData._isAnisotropic,property:[a.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(r=>({label:r})),onChange:()=>{a.materialObject.needsUpdate=!0,this.setDirty()}}]};return i}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this.makeSelectedAnisotropic=()=>{var a,e,t;const i=(t=(e=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(fr))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(i==null?void 0:i.assetType)==="material"&&this.makeAnisotropic(i)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(aE)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};xo.PluginType="AnisotropyPlugin",xo.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",ly([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],xo.prototype,"enabled",void 0),ly([Xi("Make Anisotropy",a=>({hidden:()=>{var e;return!(!((e=a._viewer)===null||e===void 0)&&e.getPlugin(fr))}}))],xo.prototype,"makeSelectedAnisotropic",void 0),xo=ly([zi("Anisotropy Materials")],xo);class sE{constructor(e){this.parser=e,this.name=xo.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){var i,r,s;const o=this.parser,l=o.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=(i=h.anisotropyFactor)!==null&&i!==void 0?i:0,t.userData._anisotropyNoise=(s=(r=h.anisotropyNoiseFactor)!==null&&r!==void 0?r:h.anisotropyNoise)!==null&&s!==void 0?s:0;let{anisotropyDirectionMode:f,anisotropyDirection:g}=h;return f||(f=h.anisotropyTextureMode),g||(g=h.anisotropyRotation),t.userData._anisotropyDirectionMode=f&&typeof(g==null?void 0:g.index)=="number"?f:"CONSTANT",f==="ROTATION"||f==="DIRECTION"?u.push(o.assignTexture(t.userData,"_anisotropyDirectionMap",g).then(_=>{_.colorSpace=p.KI_})):t.userData._anisotropyDirection=g??0,Promise.all(u)}afterRoot(e){var t;return(t=e.scene)===null||t===void 0||t.traverse(i=>{var r,s;if(!(!((s=(r=i.material)===null||r===void 0?void 0:r.userData)===null||s===void 0)&&s._isAnisotropic))return;const o=i.geometry;o.attributes.tangent||(o.computeTangents(),o.attributes.tangent.needsUpdate=!0)}),null}}const aE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const i={};if(i.anisotropyFactor=e.userData._anisotropyFactor||1,i.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,i.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&i.anisotropyDirectionMode!=="CONSTANT"){const r={index:a.processTexture(e.userData._anisotropyDirectionMap)};a.applyTextureTransform(r,e.userData._anisotropyDirectionMap),i.anisotropyDirection=r}else i.anisotropyDirectionMode="CONSTANT",i.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[xo.ANISOTROPY_GLTF_EXTENSION]=i,a.extensionsUsed[xo.ANISOTROPY_GLTF_EXTENSION]=!0}});var cy,uy=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Eo=cy=class extends Si{static AddFragmentClipping(a,e,t,i,r){var s,o,l;const u=(s=a.materialObject)===null||s===void 0?void 0:s.userData;if(!u)return!1;u._fragmentClippingExt||(u._fragmentClippingExt={});const h=u._fragmentClippingExt;return h.clipEnabled=!0,h.clipPosition===void 0&&(h.clipPosition=(o=e==null?void 0:e.toArray())!==null&&o!==void 0?o:[0,0,0,0]),h.clipParams===void 0&&(h.clipParams=(l=t==null?void 0:t.toArray())!==null&&l!==void 0?l:[1,0,0,0]),h.clipMode===void 0&&(h.clipMode=i??ws.Circle),h.clipInvert===void 0&&(h.clipInvert=r!=null&&r),a.materialObject.isMaterial&&(a.needsUpdate=!0),!0}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new oE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut,vr],this._plane=new p.JOQ,this._viewNormalMatrix=new p.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new p.Ltg},fragClippingParams:{value:new p.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&!((t=e==null?void 0:e.materialObject.userData._fragmentClippingExt)===null||t===void 0)&&t.clipEnabled?Lm+V.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${ws.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${ws.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${ws.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${ws.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${ws.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(a,e,t)=>{var i;this.enabled&&!((i=e.materialObject.userData._fragmentClippingExt)===null||i===void 0)&&i.clipEnabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker mainStart",V.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${ws.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${ws.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${ws.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${ws.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${ws.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(a,e)=>{var t,i,r,s,o,l;let u=(t=e.materialObject.userData)===null||t===void 0?void 0:t._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&a&&(u=(r=(i=a.material)===null||i===void 0?void 0:i.userData)===null||r===void 0?void 0:r._fragmentClippingExt),!(u!=null&&u.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(u.clipPosition),u.clipMode===ws.Plane){const f=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(u.clipParams[0],u.clipParams[1],u.clipParams[2]),this._plane.constant=u.clipParams[3],this._viewNormalMatrix.getNormalMatrix(f),this._plane.applyMatrix4(f,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(u.clipParams);((o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.cameraObject)instanceof p.cPb?this._uniforms.fragClippingCamAspect.value=(l=this._viewer)===null||l===void 0?void 0:l.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let h=this.enabled?1:0;h=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==h&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=h,e.materialObject.needsUpdate=!0),h=+u.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==h&&(e.materialObject.defines.FRAG_CLIPPING_MODE=h,e.materialObject.needsUpdate=!0),h=+u.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==h&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._fragmentClippingExt)===null||t===void 0)&&t.clipEnabled?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2||a.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var i;return((i=a.materialObject.userData._fragmentClippingExt)===null||i===void 0?void 0:i.clipEnabled)||!1},setValue:i=>{var r,s;i!==((r=a.materialObject.userData._fragmentClippingExt)===null||r===void 0?void 0:r.clipEnabled)&&(i?cy.AddFragmentClipping(a.materialObject)||e.alert("Cannot add fragment clipping extension."):a.materialObject.userData._fragmentClippingExt&&(a.materialObject.userData._fragmentClippingExt.clipEnabled=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(ws).map(i=>({label:i[0],value:i[1]})),hidden:()=>{var i;return!(!((i=a.materialObject.userData._fragmentClippingExt)===null||i===void 0)&&i.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",hidden:()=>{var i;return!(!((i=a.materialObject.userData._fragmentClippingExt)===null||i===void 0)&&i.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",hidden:()=>{var i;return!(!((i=a.materialObject.userData._fragmentClippingExt)===null||i===void 0)&&i.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var i;return!(!((i=a.materialObject.userData._fragmentClippingExt)===null||i===void 0)&&i.clipEnabled)},property:[a.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s,o,l;await super.onAdded(a);const u=a.getPlugin(Ut);(e=u==null?void 0:u.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=u==null?void 0:u.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=u==null?void 0:u.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(hy),(l=(o=a.getPlugin(vr))===null||o===void 0?void 0:o.material)===null||l===void 0||l.registerMaterialExtensions([this.materialExtension])}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};var ws;Eo.PluginType="FragmentClippingExtensionPlugin1",Eo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",uy([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],Eo.prototype,"enabled",void 0),Eo=cy=uy([zi("FragmentClipping Materials")],Eo),function(a){a[a.Circle=0]="Circle",a[a.Ellipse=1]="Ellipse",a[a.Rectangle=2]="Rectangle",a[a.Plane=3]="Plane",a[a.Sphere=4]="Sphere"}(ws||(ws={}));class oE{constructor(e){this.parser=e,this.name=Eo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.userData||(t.userData={}),Eo.AddFragmentClipping(t),t.userData._fragmentClippingExt=br(r,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const hy=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;t.extensions=t.extensions||{};const i=cr(e.userData._fragmentClippingExt,!1);t.extensions[Eo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=i,a.extensionsUsed[Eo.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var np,Qm=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let pc=np=class extends Si{constructor(a=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new p.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=a,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var a,e,t,i;if(!this._viewer)return;const r=this._viewer.scene.background;if(this.enabled&&r!==this._viewer.scene.environment&&r!=="environment")if(r&&r.isDataTexture)r.mapping=p.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const l=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");l?(l.envmapBg=!0,(e=(a=l.uiConfig).uiRefresh)===null||e===void 0||e.call(a,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const s=(t=this._viewer.renderer.rendererObject.background.getBoxMesh2())===null||t===void 0?void 0:t.material,o=(i=s==null?void 0:s.uniforms)!==null&&i!==void 0?i:p.Vj0.backgroundCube.uniforms;o.tripodHeight||(o.tripodHeight={value:1}),o.worldRadius||(o.worldRadius={value:1}),o.originPosition||(o.originPosition={value:new p.Pa4}),o.tripodHeight.value=this.tripodHeight,o.worldRadius.value=this.worldRadius,o.originPosition.value.copy(this.originPosition),s&&(!this.enabled&&s.defines.HDRi_GROUND_PROJ?delete s.defines.HDRi_GROUND_PROJ:this.enabled&&(s.defines.HDRi_GROUND_PROJ="1"),s.needsUpdate=!0),this._viewer.setDirty()}async onAdded(a){var e,t,i;await super.onAdded(a),!((i=(t=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||t===void 0?void 0:t.rendererObject)===null||i===void 0)&&i.background.getBoxMesh()&&a.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),p.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(p.Vj0.backgroundCube.fragmentShader=Mi(p.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),p.Vj0.backgroundCube.fragmentShader=Mi(p.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),a.scene.addEventListener("environmentChanged",this._paramsChanged)}};pc.PluginType="HDRiGroundPlugin",Qm([ae(),(0,V.onChange)(np.prototype._paramsChanged),Ot("Enabled")],pc.prototype,"enabled",void 0),Qm([ae(),(0,V.onChange)(np.prototype._paramsChanged),ai("World Radius",[1,1e3],.01)],pc.prototype,"worldRadius",void 0),Qm([ae(),(0,V.onChange)(np.prototype._paramsChanged),ai("Tripod height",[0,50],.01)],pc.prototype,"tripodHeight",void 0),Qm([ae(),(0,V.onChange)(np.prototype._paramsChanged),Mn("Origin Position",void 0,.001,a=>({onChange:a._paramsChanged}))],pc.prototype,"originPosition",void 0),pc=np=Qm([zi("HDRi Ground")],pc);var Rf,sp=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let ro=Rf=class extends Si{constructor(a=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[vr,Ut],this.materialExtension={shaderExtender:(e,t,i)=>{if(!e.defines.SSCS_ENABLED)return;const r=V.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,s=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${If}
    
    #define THREE_PACKING_INCLUDED
    ${Tf}
    
    ${ha}
    ${bo}
    
    ${Qv}

#endif
            
            `+p.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${r}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",s),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",p.WdD.lights_fragment_begin),e.fragmentShader=Mi(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=Mi(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,i)=>{var r,s;const o=t.materialObject;let l=!this.enabled||i.userData.screenSpaceRendering===!1||!((r=o.userData)===null||r===void 0)&&r.sscsDisabled||!((s=o.userData)===null||s===void 0)&&s.pluginsDisabled?0:1;o.defines.SSCS_ENABLED!==l&&(o.defines.SSCS_ENABLED=l,o.needsUpdate=!0),l=this._defines.SSCS_STEP_COUNT,o.defines.SSCS_STEP_COUNT!==l&&(o.defines.SSCS_STEP_COUNT=l,o.needsUpdate=!0),l=+this._defines.SSCS_DEBUG,o.defines.SSCS_DEBUG!==l&&(o.defines.SSCS_DEBUG=l,o.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Rf._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,i,r,s;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(vr),(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(As),(i=this._viewer)===null||i===void 0?void 0:i.scene.renderCamera,(r=this._viewer)===null||r===void 0?void 0:r.renderer,(s=this._viewer)===null||s===void 0?void 0:s.scene]}},this.enabled=a,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(a){var e,t;await super.onAdded(a),(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this.materialExtension)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(a)}};ro.PluginType="SSContactShadows",ro._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new p.yGw},cameraPositionWorld:{value:new p.Pa4},cameraNearFar:{value:new p.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},sp([Ot("Enabled"),ae()],ro.prototype,"enabled",void 0),sp([Qe({uniforms:Rf._uniforms,propKey:"sscsRadius"}),ai("Radius",[1e-4,.1],1e-4),ae()],ro.prototype,"radius",void 0),sp([Qe({uniforms:Rf._uniforms,propKey:"sscsIntensity"}),ai("Intensity",[1e-4,1],1e-4),ae()],ro.prototype,"intensity",void 0),sp([Qe({uniforms:Rf._uniforms,propKey:"sscsTolerance"}),ai("Tolerance",[.1,5]),ae()],ro.prototype,"tolerance",void 0),sp([oe("SSCS_DEBUG",void 0,!0),Ot("Debug only SSCS"),ae()],ro.prototype,"onlySSCSDebug",void 0),sp([oe("SSCS_STEP_COUNT",void 0,!0),ai("Step count",[1,8],1),ae()],ro.prototype,"stepCount",void 0),ro=Rf=sp([zi("Screen Space Contact Shadows")],ro);class Df{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new p.xsS,this._mesh=new p.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new Wm}dispose(){var e;(e=this._mesh.geometry)===null||e===void 0||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(t=>{var i;return(i=this._normalsCache[t])===null||i===void 0?void 0:i.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose()),this._normalsCache={}}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}_getPrecisionType(e){return e==="low"?p.ywz:e==="medium"?p.cLu:e==="high"?p.VzW:p.cLu}captureNormalMap(e,t,i=512,r="medium",s){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const o=t==null?void 0:t.split(";").find(h=>this._normalsCache[h]);if(o){const h=this._normalsCache[o];return t==null||t.split(";").forEach(f=>f!==o&&(this._normalsCache[f]=h)),h.width!==i&&console.warn("last cacheKey normalMapRes mismatch, check model",i),e.userData._normalsCaptureMap=h,!1}const l=this._renderer.createTargetCustom({width:i,height:i},{minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1,type:this._getPrecisionType(r)},p.oAp);if(l.attachedGeometries=[],l.autoDispose=Df.AutoDisposeTargets,!l)throw"Unable to create render target";const u=()=>{var h;const f=new p._am(1e-4,100,l);this._scene.add(f);const g=e.userData.normalsCaptureOffsets;g.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(g.center),g.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(g.offsetMatrixInv),g.radius!==void 0&&(this._mesh.material.uniforms.radius.value=g.radius),this._mesh.geometry=e,s!=null&&s.morphTargetInfluences&&!((h=e.morphAttributes)===null||h===void 0)&&h.position&&(this._mesh.morphTargetInfluences=s.morphTargetInfluences,this._mesh.morphTargetDictionary=s.morphTargetDictionary);const _=this._renderer.rendererObject.getClearColor(new p.Ilk),A=this._renderer.rendererObject.getClearAlpha();this._renderer.rendererObject.setClearColor(new p.Ilk(0,0,0),1),f.update(this._renderer.rendererObject,this._scene),this._renderer.rendererObject.setClearColor(_,A),this._mesh.morphTargetInfluences=void 0,this._mesh.morphTargetDictionary=void 0,this._scene.remove(f),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=l};return u(),this._renderer.addEventListener("contextRestored",u),l.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var h,f;l.attachedGeometries=(f=(h=l.attachedGeometries)===null||h===void 0?void 0:h.filter(g=>g!==e))!==null&&f!==void 0?f:[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",u),l.autoDispose&&!l.attachedGeometries.length&&l.dispose()}),t==null||t.split(";").forEach(h=>this._normalsCache[h]=l),l.addEventListener("dispose",()=>{var h;t==null||t.split(";").forEach(f=>delete this._normalsCache[f]),this._renderer.removeEventListener("contextRestored",u),(h=l.attachedGeometries)===null||h===void 0||h.forEach(f=>delete f.userData._normalsCaptureMap)}),!0}}Df.AutoDisposeTargets=!0;class Wm extends p.jyz{constructor(){super({vertexShader:`varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;
#include <morphtarget_pars_vertex>
void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);
#include <begin_vertex>
transformed-=offsetCenter;
#include <morphtarget_vertex>
vec4 offsetPos=offsetMatrixInv*vec4(transformed,1.);vecPosition=(modelMatrix*offsetPos).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetPos;}`,fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:p.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new p.yGw().identity()},offsetCenter:{value:new p.Pa4}}})}}var Wv=__webpackgi_require__(654);function dy(a){const e=new p.Pa4(0,0,0),t=new p.Pa4(0,0,0),i=new p.Pa4(0,0,0),r=new p.Pa4(0,0,0),s=a.getAttribute("position"),o=a.index;if(o)for(let _=Math.max(0,a.drawRange.start),A=Math.min(o.count,a.drawRange.start+a.drawRange.count)-1;_<A/3;_+=3){const x=o.getX(_),E=o.getX(_+1),T=o.getX(_+2);t.set(s.getX(x),s.getY(x),s.getZ(x)),i.set(s.getX(E),s.getY(E),s.getZ(E)),r.set(s.getX(T),s.getY(T),s.getZ(T)),i.sub(t),r.sub(t),r.cross(i),r.normalize(),e.add(r)}else for(let _=0;_<s.count;_+=3)t.set(s.getX(_),s.getY(_),s.getZ(_)),i.set(s.getX(_+1),s.getY(_+1),s.getZ(_+1)),r.set(s.getX(_+2),s.getY(_+2),s.getZ(_+2)),i.sub(t),r.sub(t),r.cross(i),r.normalize(),e.add(r);e.normalize();let l=!1,u=0;for(;!l;){const _=u/3,A=o?o.getX(_):_,x=o?o.getX(_+1):_+1;t.set(s.getX(A),s.getY(A),s.getZ(A)),i.set(s.getX(x),s.getY(x),s.getZ(x)),t.sub(i),t.normalize();const E=e.dot(t);Math.abs(E-1)>.001&&t.length()>.5&&(l=!0),u+=3}i.crossVectors(t,e),i.normalize(),t.crossVectors(e,i),t.normalize();const h=new p.yGw;h.elements[0]=t.x,h.elements[1]=t.y,h.elements[2]=t.z,h.elements[3]=0,h.elements[4]=e.x,h.elements[5]=e.y,h.elements[6]=e.z,h.elements[7]=0,h.elements[8]=i.x,h.elements[9]=i.y,h.elements[10]=i.z,h.elements[11]=0,h.elements[12]=0,h.elements[13]=0,h.elements[14]=0,h.elements[15]=1,a.computeBoundingSphere();const f=a.boundingSphere.radius,g=new p.yGw().makeScale(f,f,f);return h.multiply(g),h}function Xv(a,e,t){const i=new p.Pa4().copy(a),r=new p.Pa4().copy(e),s=new p.Pa4().copy(t);return i.dot(r.cross(s))/6}function no(a,e,t){const i=new p.Pa4().copy(a),r=new p.Pa4().copy(e),s=new p.Pa4().copy(t);return r.sub(i),s.sub(i),s.cross(r),.5*s.length()}function Bh(a){const e=a.getAttribute("position"),t=a.getAttribute("normal");if(e.count/3>1500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),dy(a);const i=new p.Pa4(0,0,0),r=new p.Pa4(0,0,0),s=new p.Pa4(0,0,0),o=a.index,l=[];if(o)for(let R=Math.max(0,a.drawRange.start),I=Math.min(o.count,a.drawRange.start+a.drawRange.count)-1;R<I;R+=3){const S=o.getX(R),O=o.getX(R+1),k=o.getX(R+2);i.set(e.getX(S),e.getY(S),e.getZ(S)),r.set(e.getX(O),e.getY(O),e.getZ(O)),s.set(e.getX(k),e.getY(k),e.getZ(k)),l.push(i.toArray(),r.toArray(),s.toArray())}else for(let R=0;R<e.count;R++)i.set(e.getX(R),e.getY(R),e.getZ(R)),l.push(i.toArray());const u=function(R,I){const S=new p.Pa4;for(let le=0;le<R.length;le+=3)S.x+=R[le],S.y+=R[le+1],S.z+=R[le+2];S.multiplyScalar(1/(R.length/3));const O=new p.Pa4,k=new p.Pa4,N=new p.Pa4,H=new p.Pa4,X=new p.Pa4;let te=0,re=0,ue=I.length;ue%3!=0&&(ue-=ue%3);for(let le=0;le<ue;le+=3){O.set(I[le][0],I[le][1],I[le][2]),k.set(I[le+1][0],I[le+1][1],I[le+1][2]),N.set(I[le+2][0],I[le+2][1],I[le+2][2]),X.copy(O).add(k).add(N);const se=no(O,k,N);X.multiplyScalar(se/3),H.add(X),te+=se,re+=Xv(O,k,N)}return H.multiplyScalar(1/te),{centre:S,com:H,volume:re,area:te}}(e.array,l);if(u.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let R=0;R<t.count;R++)t.setX(R,-t.getX(R)),t.setY(R,-t.getY(R)),t.setZ(R,-t.getZ(R));t.needsUpdate=!0}const h=[];for(let R=0;R<e.array.length;R+=3)h.push([e.array[R],e.array[R+1],e.array[R+2]]);const f=console.log;console.log=()=>{};const g=(0,Wv.getEigenVectors)(h);console.log=f;const _=new p.yGw;_.elements[0]=g[0].vector[0],_.elements[1]=g[0].vector[1],_.elements[2]=g[0].vector[2],_.elements[3]=0,_.elements[4]=g[1].vector[0],_.elements[5]=g[1].vector[1],_.elements[6]=g[1].vector[2],_.elements[7]=0,_.elements[8]=g[2].vector[0],_.elements[9]=g[2].vector[1],_.elements[10]=g[2].vector[2],_.elements[11]=0,_.elements[12]=0,_.elements[13]=0,_.elements[14]=0,_.elements[15]=1;const A=new p.Pa4;A.copy(u.com).sub(u.centre),A.normalize();const x=new p.Pa4(g[2].vector[0],g[2].vector[1],g[2].vector[2]);A.dot(x)<0&&(_.elements[4]=-g[1].vector[0],_.elements[5]=-g[1].vector[1],_.elements[6]=-g[1].vector[2],_.elements[8]=-g[2].vector[0],_.elements[9]=-g[2].vector[1],_.elements[10]=-g[2].vector[2]),a.computeBoundingSphere();const E=a.boundingSphere.radius,T=new p.yGw().makeScale(E,E,E);return _.multiply(T),_}const qv={...Jl,color:new p.Ilk(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new p.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var Nn=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class yr extends p.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,i,r,s){var o,l;super.onBeforeRender(e,t,i,r,s),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((o=this.envMap)===null||o===void 0?void 0:o.rotation)||0)+this.envMapRotationOffset,this.uniforms.envMapRotationQuat.value.setFromEuler(new p.USm(this.envMapRotationOffsetX,this.envMapRotationOffsetY,this.envMapRotationOffsetZ)),this.extraUniformsToUpload.inverseModelMatrix.value.copy(s.matrixWorld).invert();const u=r.userData.normalsCaptureOffsets;u&&(this.extraUniformsToUpload.centerOffset.value.fromArray(u.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(u.offsetMatrix).premultiply(s.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=u.radius);const h=(l=r.userData._normalsCaptureMap)===null||l===void 0?void 0:l.texture;this.normalsCaptureMap!==h&&(this.normalsCaptureMap=h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}onAfterRender(e,t,i,r,s){super.onAfterRender(e,t,i,r,s),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:i,geometry:r,object:s})}constructor(e){var t;super({side:p.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
#include <morphtarget_pars_vertex>
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#ifndef USE_INSTANCING
uniform mat4 modelOffsetMatrixInv;
#endif
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#ifdef USE_MORPHTARGETS
vCenterOffset=transformed;
#include <morphtarget_vertex>
vCenterOffset=transformed-vCenterOffset;
#ifndef USE_INSTANCING
vCenterOffset=(modelOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#ifdef USE_MORPHTARGETS
vCenterOffset=(vModelInstanceOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#define CENTER_OFFSET  (centerOffset + vCenterOffset)
#else
#define CENTER_OFFSET  (centerOffset) 
#endif
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform vec4 envMapRotationQuat;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;vec3 t=2.*cross(envMapRotationQuat.xyz,direction);direction+=envMapRotationQuat.w*t+cross(envMapRotationQuat.xyz,t);
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},envMapRotationQuat:{value:new p._fP},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new p.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new p.Pa4(1,1,1)}}}),this.typeSlug=yr.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new p.Ilk(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.envMapRotationOffsetX=0,this.envMapRotationOffsetY=0,this.envMapRotationOffsetZ=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new p.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new p.yGw().identity()},radius:{value:1},centerOffset:{value:new p.Pa4(0,0,0)},modelOffsetMatrix:{value:new p.yGw().identity()},modelOffsetMatrixInv:{value:new p.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("WebGi DiamondMaterial: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=es.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...es.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){es.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+es.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,i;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate",frameFade:e==null?void 0:e.last}),(i=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=!((e=this.uniforms.envMap.value)===null||e===void 0)&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){var e,t;return(t=(e=this.__envMap[this.envMapIndex])!==null&&e!==void 0?e:this.__envMap[0])!==null&&t!==void 0?t:null}set envMap(e){console.error("Setting separate envmap for individual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=yr.TYPE,t.userData={},zr(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(t=>({label:"env"+(t+1),value:t}))},...Qa(this),{type:"input",label:"Mesh count",get value(){var t,i,r;return(r=(i=(t=e.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&r!==void 0?r:0},set value(t){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const t=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,V.downloadBlob)(t,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(t=>{var i;return(i=t.getUiConfig)===null||i===void 0?void 0:i.call(t,this)})].filter(t=>t),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==yr.TYPE)return console.warn("WebGi DiamondMaterial: Material type is not supported",e),this;const t={},i=Array.from(Object.keys(qv));(0,V.copyProps)(e,t,i);const r=t.userData;return delete t.userData,this.setValues(t),zr(this.userData,r),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}yr.TypeSlug="dmat",yr.TYPE="DiamondMaterial",Nn([ea("Color",{limitedUi:!0}),Qe()],yr.prototype,"color",void 0),Nn([ai("Env Intensity",[0,5],.01,{limitedUi:!0}),Qe()],yr.prototype,"envMapIntensity",void 0),Nn([ai("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,V.onChange2)(yr.prototype.setDirty)],yr.prototype,"envMapRotationOffset",void 0),Nn([ai("Env Rotation Offset X",[-Math.PI,Math.PI],.01),(0,V.onChange2)(yr.prototype.setDirty)],yr.prototype,"envMapRotationOffsetX",void 0),Nn([ai("Env Rotation Offset Y",[-Math.PI,Math.PI],.01),(0,V.onChange2)(yr.prototype.setDirty)],yr.prototype,"envMapRotationOffsetY",void 0),Nn([ai("Env Rotation Offset Z",[-Math.PI,Math.PI],.01),(0,V.onChange2)(yr.prototype.setDirty)],yr.prototype,"envMapRotationOffsetZ",void 0),Nn([ai("Dispersion",[0,.1],1e-4,{limitedUi:!0}),Qe({propKey:"rIndexDelta"})],yr.prototype,"dispersion",void 0),Nn([ai("Absorption",[0,15],.01,{limitedUi:!0}),Qe()],yr.prototype,"absorptionFactor",void 0),Nn([ai("Refractive Index",[0,4],.01,{limitedUi:!0}),Qe()],yr.prototype,"refractiveIndex",void 0),Nn([Qe()],yr.prototype,"squashFactor",void 0),Nn([Qe()],yr.prototype,"geometryFactor",void 0),Nn([ai("Gamma",[.1,4],.01,{limitedUi:!0}),Qe()],yr.prototype,"gammaFactor",void 0),Nn([Mn("RGB Boost",void 0,void 0,{limitedUi:!0}),Qe()],yr.prototype,"boostFactors",void 0),Nn([ai("Transmission",[0,1],.01,{limitedUi:!0}),Qe()],yr.prototype,"transmission",void 0),Nn([ai("Reflectivity",[0,2],.01,{limitedUi:!0}),Qe()],yr.prototype,"reflectivity",void 0),Nn([oe("RAY_BOUNCES",void 0,!0),ai("Ray Bounces",[1,16],1)],yr.prototype,"rayBounces",void 0),Nn([oe("DIA_ORIENT_ENVMAP",void 0,!0),ai("Diamond Oriented Lighting",[0,1],1)],yr.prototype,"diamondOrientedEnvMap",void 0),Nn([Qe({propKey:"tCubeMapNormals"})],yr.prototype,"normalsCaptureMap",void 0),Nn([(0,V.onChange)(yr.prototype.refreshEnvUniform)],yr.prototype,"envMapIndex",void 0);const Bf={ES256:{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}},ES384:{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}},ES512:{name:"ECDSA",namedCurve:"P-521",hash:{name:"SHA-512"}},HS256:{name:"HMAC",hash:{name:"SHA-256"}},HS384:{name:"HMAC",hash:{name:"SHA-384"}},HS512:{name:"HMAC",hash:{name:"SHA-512"}},RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},RS384:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},RS512:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}},ap=function(a){return JSON.parse(atob(a.split(".")[1]))},op=async function(a,e,t){const i=Bf[t.algorithm||"RS512"],r=await crypto.subtle.importKey("jwk",e,i,!0,["verify"]),s=a.split("."),o=new Uint8Array(atob(s[2].replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")).split("").map(u=>u.charCodeAt(0))),l=new Uint8Array((s[0]+"."+s[1]).split("").map(u=>u.charCodeAt(0)));return await crypto.subtle.verify(i,r,o,l)};class Xm{constructor(e,t){this.PRODUCT_ID="IJewel3D_WebGi_V0",this.KEY_TYPE_ID="online-v1",this.TOKEN_FILE="0.txt",this.PUBLIC_KEY_FILE="1.json",this.KEY_SERVER="https://license.ijewel3d.com",this.KEY_SERVER_VERIFY="/api/v1/verify",this.KEY_SERVER_CERTS="/api/v1/certs/"+this.KEY_TYPE_ID,this.id="",this.idHash="",this.appVersion="",this.appName="",this._storage={getItem:async i=>localStorage.getItem(i),setItem:async(i,r)=>(localStorage.setItem(i,r),r)},this.silent=!0,this.appVersion=t,this.appName=e}_getOriginId(){const e=function(t){let i,r,s,o;const l=function(_,A,x){if(_.length!=A)return!1;for(let E=0;E<A;E++)for(let T=0;T<x.length;T+=2)if(E==x[T]&&_.charCodeAt(E)!=x[T+1])return!1;return!0},u=function(_,A,x){return l(A,x,_)},h=function(_,A,x){return u(A,_,x)};for(let _ in t)if(l(_,8,[7,116,5,101,3,117,0,100])){i=_;break}for(let _ in t[i])if(h(_,[5,110,0,100],6)){r=_;break}for(let _ in t[i])if(h(_,[7,110,0,108],8)){s=_;break}if(!("~">r)){for(let _ in t[i][s])if(u([7,101,0,104],_,8)){o=_;break}}if(!i||!t[i])return;const f=t[i][r],g=!!t[i][s]&&t[i][s][o];return f||g||void 0}(window);if(!e)throw new Error("Failed to get origin");return e}_getStorage(){return this._storage}async init(){var e,t;if(this.id=this.id||this._getOriginId(),!this.id)throw new Error("Failed to get machine id");this.idHash=await async function(h){const f=new TextEncoder().encode(h),g=await crypto.subtle.digest("SHA-256",f);return Array.from(new Uint8Array(g)).map(_=>_.toString(16).padStart(2,"0")).join("")}(this.id);const i=this._getStorage(),r=this.idHash+this.TOKEN_FILE;let s=(e=await i.getItem(r))!==null&&e!==void 0?e:await i.setItem(r,"");const o=this.idHash+this.PUBLIC_KEY_FILE,l=(t=await i.getItem(o))!==null&&t!==void 0?t:null;let u=await this.getPublicKey().catch(()=>null);return!u&&l&&(u=JSON.parse(l)),u!==l&&await i.setItem(o,JSON.stringify(u)),u||this._throw(new Error("Failed to get public key")),{token:s,publicKey:u}}async verify(e,t){var i;try{let r,s=(t=t??await this.init()).token;s&&!await op(s,t.publicKey,{algorithm:"RS512",throwError:!1})&&(s=""),s&&(r=ap(s),((i=r.payload)===null||i===void 0?void 0:i.key)!==e&&(s="")),s&&s.length||(s=await this.setLicenseKey(e)),r=ap(s);let o=!1;return o=o||await op(s,t.publicKey,{algorithm:"RS512",throwError:!1}),o=o||await this.verifyData(r),o}catch(r){return this.silent||console.error(r),!1}}async writeToken(e){const t=this.idHash+this.TOKEN_FILE;await this._getStorage().setItem(t,e)}async verifyData(e){var t,i,r;return((t=e.payload)===null||t===void 0?void 0:t.sub)===this.id&&((i=e.payload)===null||i===void 0?void 0:i.app)===this.appName+"_"+this.appVersion&&((r=e.payload)===null||r===void 0?void 0:r.pid)===this.PRODUCT_ID}async _getPublicKeyFromServer(){return fetch(this.KEY_SERVER+this.KEY_SERVER_CERTS).then(e=>e.json()).catch(e=>({error:e}))}async _validateKeyFromServer(e){return await fetch(this.KEY_SERVER+this.KEY_SERVER_VERIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,id:this.id,app:{name:this.appName,version:this.appVersion},pid:this.PRODUCT_ID})}).then(t=>t.json()).catch(t=>({error:t}))}_throw(e){if(!this.silent)throw e;return null}async setLicenseKey(e){const t=await this._validateKeyFromServer(e);if(t.error)return this._throw(t.error);const i=t.token;return i?(await this.writeToken(i),i):this._throw(new Error("Invalid license key, no token"))}async getPublicKey(){const e=await this._getPublicKeyFromServer();return e.error?this._throw(e.error):e.jwk||this._throw(new Error("Invalid public key"))}}var UA=__webpackgi_require__(701),fc=__webpackgi_require__.n(UA),qm=__webpackgi_require__(236),mc=__webpackgi_require__.n(qm),NA=__webpackgi_require__(850),tu=__webpackgi_require__.n(NA),FA=__webpackgi_require__(182),Lu=__webpackgi_require__.n(FA),Yv=__webpackgi_require__(213),gc=__webpackgi_require__.n(Yv),Ym=__webpackgi_require__(27),Of={};Ym.Z&&Ym.Z.locals&&(Of.locals=Ym.Z.locals);var Kv,Zv=0,Oh={};Oh.styleTagTransform=gc(),Oh.setAttributes=tu(),Oh.insert=function(a,e){(e.target||document.head).appendChild(a)},Oh.domAPI=mc(),Oh.insertStyleElement=Lu(),Of.use=function(a){return Oh.options=a||{},Zv++||(Kv=fc()(Ym.Z,Oh)),Of},Of.unuse=function(){Zv>0&&!--Zv&&(Kv(),Kv=null)};var lE=Of,Km=__webpackgi_require__(356),iu={};Km.Z&&Km.Z.locals&&(iu.locals=Km.Z.locals);var Zm,Jv=0,ku={};ku.styleTagTransform=gc(),ku.setAttributes=tu(),ku.insert=function(a,e){(e.target||document.head).appendChild(a)},ku.domAPI=mc(),ku.insertStyleElement=Lu(),iu.use=function(a){return ku.options=a||{},Jv++||(Zm=fc()(Km.Z,ku)),iu},iu.unuse=function(){Jv>0&&!--Jv&&(Zm(),Zm=null)};var jA=iu;class Lh extends Si{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e,t){super(),this.container=t,this.enabled=!0,this.dependencies=[Ut],this.processState=new Map,this._mainDiv=(0,V.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,V.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var t,i,r,s,o,l,u,h,f,g,_,A,x;await super.onAdded(e),((t=this.container)!==null&&t!==void 0?t:e.container).appendChild(this._mainDiv),this._updateMainDiv(this.processState),(r=(i=e.getManager())===null||i===void 0?void 0:i.importer)===null||r===void 0||r.addEventListener("importFile",E=>{E.state!=="done"?this.processState.set(E.path,{state:E.state,progress:E.progress?100*E.progress:void 0}):this.processState.delete(E.path),this._updateMainDiv(this.processState)}),(o=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||o===void 0||o.addEventListener("processFileStart",E=>{this.processState.set(E.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(u=(l=e.getManager())===null||l===void 0?void 0:l.importer)===null||u===void 0||u.addEventListener("processFileEnd",E=>{this.processState.delete(E.path),this._updateMainDiv(this.processState)}),(f=(h=e.getManager())===null||h===void 0?void 0:h.exporter)===null||f===void 0||f.addEventListener("exportFile",E=>{E.state!=="done"?this.processState.set(E.obj.name,{state:E.state,progress:E.progress?100*E.progress:void 0}):this.processState.delete(E.obj.name),this._updateMainDiv(this.processState)}),(g=e.getPluginByType("FileTransferPlugin"))===null||g===void 0||g.addEventListener("transferFile",E=>{E.state!=="done"?this.processState.set(E.path,{state:E.state,progress:E.progress?100*E.progress:void 0}):this.processState.delete(E.path),this._updateMainDiv(this.processState)}),(_=e.getPluginByType("MaterialConfiguratorPlugin"))===null||_===void 0||_.addEventListener("progress",E=>{E.state!=="done"?this.processState.set("MatpreviewGeneration",{state:E.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(A=e.getPluginByType("SwitchNodePlugin"))===null||A===void 0||A.addEventListener("progress",E=>{E.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:E.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(x=e.getPluginByType("ThemePlugin"))===null||x===void 0||x.addEventListener("progress",E=>{E.state!=="done"?this.processState.set("ThemeInit",{state:E.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(e){var t;return this._mainDiv.remove(),(t=this._contentDiv)===null||t===void 0||t.remove(),this.processState.clear(),super.onRemove(e)}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([Ot("Enabled"),(0,V.onChange)(Lh.prototype._onEnabledChange),ae()],Lh.prototype,"enabled",void 0);var La,Yn=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Zr=La=class extends Lh{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(a){super("LoadingScreen",a),this.styles=lE,this.spinners=[{styles:jA,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage="https://static.webgi.xyz/logo.svg",this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["environment.hdr",{state:"adding"}]]),this.loadingElement=(0,V.createDiv)({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=(0,V.createDiv)({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=(0,V.createDiv)({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._temp=document.createElement("template"),this._sceneUpdate=e=>{if(!this._viewer||!e.hierarchyChanged)return;const t=this._viewer.scene.modelRoot.children;t.length===0&&this.showOnSceneEmpty&&this.show(),t.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&(0,V.timeout)(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await(0,V.timeout)(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await(0,V.timeout)(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(a,e){this._temp.innerHTML=e,this._temp.innerHTML.trim()==a.innerHTML.trim()||(a.innerHTML=e)}_updateMainDiv(a,e=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let i="";a.forEach((r,s)=>{i+=(this.showProcessStates?`<span class="loadingScreenProcessState">${r.state}</span>: `:"")+(s||"").split("/").pop()+(this.showProgress&&r.progress?" - "+r.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,i)}else this._setHTML(this.filesElement,"");const t=[...a.values()].filter(i=>i.state==="error");t.length>0&&t.length===a.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),e&&(this.hideOnFilesLoad&&(a.size===0||t.length===a.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():a.size>0&&this.showOnFilesLoading&&this.show())}async onAdded(a){var e;this.styles.use({target:(e=this.container)!==null&&e!==void 0?e:a.container}),this.spinners.forEach(t=>{var i;t.styles.use({target:(i=this.container)!==null&&i!==void 0?i:a.container})}),a.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(a)}async onRemove(a){a.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(a)}};Zr.PluginType="LoadingScreenPlugin",Yn([Fs("Loader",["Spinner 1"].map((a,e)=>({value:e,label:a}))),ae()],Zr.prototype,"loader",void 0),Yn([Ci("Loading text header"),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"loadingTextHeader",void 0),Yn([Ci("Error text header"),ae()],Zr.prototype,"errorTextHeader",void 0),Yn([Ot("Show file names"),ae(),(0,V.onChange)(La.prototype.refresh)],Zr.prototype,"showFileNames",void 0),Yn([Ot("Show process states"),ae(),(0,V.onChange)(La.prototype.refresh)],Zr.prototype,"showProcessStates",void 0),Yn([Ot("Show progress"),ae(),(0,V.onChange)(La.prototype.refresh)],Zr.prototype,"showProgress",void 0),Yn([Ot("Hide on only errors"),ae()],Zr.prototype,"hideOnOnlyErrors",void 0),Yn([Ot("Hide on files load"),ae()],Zr.prototype,"hideOnFilesLoad",void 0),Yn([Ot("Hide on scene object load"),ae()],Zr.prototype,"hideOnSceneObjectLoad",void 0),Yn([Ot("Minimize on scene object load"),ae()],Zr.prototype,"minimizeOnSceneObjectLoad",void 0),Yn([Ot("Show when files start loading"),ae()],Zr.prototype,"showOnFilesLoading",void 0),Yn([Ot("Show when scene empty"),ae()],Zr.prototype,"showOnSceneEmpty",void 0),Yn([Ci("Hide delay (ms)"),ae()],Zr.prototype,"hideDelay",void 0),Yn([ai("Background Opacity",[0,1]),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"backgroundOpacity",void 0),Yn([ai("Background Blur",[0,100]),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"backgroundBlur",void 0),Yn([Ci("Background Color"),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"background",void 0),Yn([Ci("Text Color"),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"textColor",void 0),Yn([Ci("Logo Image"),(0,V.onChange)(La.prototype.refresh),ae()],Zr.prototype,"logoImage",void 0),Yn([Xi("Toggle preview")],Zr.prototype,"togglePreview",null),Yn([Xi("Minimize")],Zr.prototype,"minimize",null),Yn([Xi("Maximize")],Zr.prototype,"maximize",null),Zr=La=Yn([zi("Loading Screen")],Zr);const Jm="iJewel3dSDK_WebGi",lp=to.VERSION,cp="https://playground.ijewel3d.com/logo_black.svg",$v=a=>setTimeout(()=>console.error(new Error(a)),612);class e0 extends Si{setKey(e){this._checking||this._checkPromise?console.warn("Already checking key, ignored"):(this._checking=Date.now(),this._checkPromise=this._check(e),this._checkPromise.then(()=>this._checkPromise=void 0))}async _check(e){await new Xm(Jm,lp).verify(e)||($v(this._errMessage),this._logoContainer=this._createContainerLogo())}_createContainerLogo(){const e=document.createElement("div");e.innerHTML=zA,e.style.position="absolute",e.style.padding="1rem",e.style.left="0",e.style.bottom="0",e.style.width="100%",e.style.height="auto",e.style.display="flex",e.style.alignItems="center",e.style.backgroundColor="rgba(0, 0, 0, 0)",e.style.zIndex="9999",e.style.pointerEvents="none";const t=e.children[0];t.style.width="calc(min(20%, 150px))",t.style.height="auto",t.onclick=()=>{window.open("https://ijewel3d.com/","_top")},this._logoContainer=e;const i=document.getElementById("webgi-logo");return i&&i.remove(),e}constructor(){super(),this._errMessage=`iJewel3D ${Jm} ${lp}. FOR EVALUATION PURPOSES ONLY. For more information visit: https://ijewel3d.com/`,this._checking=0,this._licenseInUse=!1,setInterval(()=>{var e;if(this._checkPromise&&Date.now()-this._checking>15e3&&($v(this._errMessage),this._logoContainer=this._createContainerLogo(),typeof this._checkPromise.cancel=="function"&&this._checkPromise.cancel(),this._checkPromise=void 0),this._logoContainer&&!this._logoContainer.parentElement&&this._viewer&&this._licenseInUse){this._lContainer.appendChild(this._logoContainer);const t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Zr);t&&(t.logoImage=cp)}},5e3)}get _lContainer(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.container;if(!t)return document.body;const i=window.getComputedStyle(t).position;return i!=="absolute"&&i!=="relative"&&i!=="fixed"?document.body:t}use(){var e;if(!this._licenseInUse&&(this._licenseInUse=!0,!this._checking)){$v(this._errMessage),this._logoContainer=this._createContainerLogo(),this._lContainer.appendChild(this._logoContainer);const t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Zr);t&&(t.logoImage=cp)}}unuse(){}async onAdded(e){await super.onAdded(e)}}const zA=`
<!--Notice - iJewel3D License Required to remove attribution. Check the details at https://developer.ijewel3d.com/ -->
<svg width="320" height="150" viewBox="0 0 320 150" fill="none" xmlns="http://www.w3.org/2000/svg">
<g filter="url(#filter0_d_2013_189)">
<path d="M63.0313 37.6615C63.0313 37.0497 62.8369 36.5115 62.4485 36.0465C62.0601 35.5815 61.5625 35.2879 60.9555 35.1411L71.2491 30.8711V79.1495C71.2491 82.3555 70.4357 85.2195 68.7971 87.7275C67.1705 90.2355 64.7063 91.5315 61.4047 91.6175C57.6903 91.3975 55.0441 89.5015 53.4295 85.9275C52.7983 84.4475 52.4707 82.9315 52.4707 81.3655H53.2961C53.2961 82.8455 53.5873 84.2395 54.1701 85.5495C54.8013 86.6875 55.7967 87.4335 57.1319 87.7635C58.4793 88.0935 59.6809 87.9715 60.7613 87.3835C61.5139 86.9075 62.0359 86.1115 62.3635 84.9995C62.6791 83.8855 62.8735 82.7715 62.9219 81.6455C62.9827 80.5335 63.0069 79.7375 63.0069 79.2595L63.0313 37.6615Z" fill="white"/>
<path d="M49.4 38.5287C49.4 37.9169 49.2056 37.3785 48.8172 36.9137C48.4288 36.4487 47.9312 36.1551 47.3242 36.0083L57.6178 31.7383V65.5675L49.4 69.8375V38.5287Z" fill="white"/>
<path d="M106.949 51.1695H82.6592C82.5742 54.4355 83.3026 57.6775 84.8442 60.8955C86.3736 64.1135 88.9228 66.1455 92.4672 66.9895C96.8372 67.5515 100.77 66.4635 104.254 63.7215C104.861 63.1595 105.419 62.5475 105.917 61.8755C105.977 61.7895 106.05 61.7395 106.172 61.7035C106.281 61.6795 106.39 61.7035 106.499 61.7895C106.584 61.8495 106.633 61.9235 106.669 62.0335C106.694 62.1435 106.669 62.2535 106.584 62.3635C106.062 63.0375 105.492 63.6735 104.885 64.2855C101.595 67.9675 97.4562 70.1695 92.4794 70.8915C86.8834 71.0875 82.5014 69.1175 79.2968 64.9695C76.1044 60.8355 74.3928 56.2455 74.1744 51.2295C74.0044 47.2171 74.8178 43.4487 76.6264 39.9495C78.4228 36.4503 81.239 33.9055 85.0506 32.3149C88.1824 31.1403 91.3748 30.7977 94.64 31.2627C99.2284 32.2415 102.567 34.8231 104.642 39.0075C106.257 42.5923 107.034 46.3117 106.949 50.2147V51.1695ZM82.6592 50.3369H98.3544C98.3788 50.2759 98.3908 50.2391 98.3908 50.2147C99.6896 46.7521 100.382 43.3875 100.467 40.0841C100.333 36.0711 98.318 33.4405 94.4458 32.2171C89.8818 31.3239 86.495 32.9267 84.2736 37.0253C82.9748 40.6225 82.4286 44.3663 82.6592 48.2449V50.3369Z" fill="white"/>
<path d="M168.843 32.9737C169.013 32.4965 168.965 32.0561 168.721 31.6523C168.467 31.2485 168.091 31.0283 167.557 31.0039H172.581C171.223 31.1139 170.275 31.7991 169.717 33.0593L155.429 70.4619L155.637 71.0119H146.799L138.411 48.9647L130.193 70.4619L130.401 71.0119H121.564L107.155 33.1817C106.597 31.8969 105.638 31.1751 104.254 31.0039H117.206C116.708 31.0649 116.332 31.2853 116.065 31.6889C115.798 32.0927 115.749 32.5455 115.919 33.0471L129.781 69.2879L137.963 47.8269L132.403 33.1817C131.845 31.8969 130.885 31.1751 129.501 31.0039H142.417C142.029 31.0649 141.713 31.2363 141.459 31.5299C141.203 31.8235 141.083 32.1539 141.083 32.5087C141.083 32.8635 141.107 32.8513 141.167 33.0471L142.417 36.2281L142.829 37.4027L155.029 69.2879L168.843 32.9737Z" fill="white"/>
<path d="M202.55 51.1695H178.262C178.176 54.4355 178.904 57.6775 180.434 60.8955C181.976 64.1135 184.512 66.1455 188.058 66.9895C192.428 67.5515 196.36 66.4635 199.844 63.7215C200.45 63.1595 201.01 62.5475 201.506 61.8755C201.556 61.7895 201.64 61.7395 201.762 61.7035C201.872 61.6795 201.98 61.7035 202.09 61.7895C202.174 61.8495 202.224 61.9235 202.26 62.0335C202.284 62.1435 202.26 62.2535 202.174 62.3635C201.652 63.0375 201.082 63.6735 200.476 64.2855C197.186 67.9675 193.046 70.1695 188.07 70.8915C182.474 71.0875 178.092 69.1175 174.888 64.9695C171.694 60.8355 169.984 56.2455 169.764 51.2295C169.594 47.2171 170.42 43.4487 172.216 39.9495C174.014 36.4503 176.83 33.9055 180.64 32.3149C183.772 31.1403 186.964 30.7977 190.23 31.2627C194.818 32.2415 198.156 34.8231 200.232 39.0075C201.858 42.5923 202.636 46.3117 202.55 50.2147V51.1695ZM178.262 50.3369H193.956C193.982 50.2759 193.994 50.2391 193.994 50.2147C195.292 46.7521 195.984 43.3875 196.068 40.0841C195.936 36.0711 193.92 33.4405 190.048 32.2171C185.484 31.3239 182.086 32.9267 179.876 37.0253C178.578 40.6225 178.03 44.3663 178.262 48.2449V50.3369Z" fill="white"/>
<path d="M214.3 68.798C214.3 69.386 214.494 69.886 214.884 70.302C215.272 70.718 215.758 70.964 216.34 71.012H204.006C204.59 70.952 205.076 70.73 205.464 70.328C205.852 69.924 206.046 69.434 206.046 68.846V17.4478C206.046 16.8606 205.852 16.3588 205.464 15.9184C205.076 15.4902 204.59 15.2332 204.006 15.1476L214.3 11V68.798Z" fill="white"/>
<path d="M60.2022 15.5255L57.1676 13.2007C57.1554 13.1885 57.1432 13.1885 57.1312 13.1763C57.119 13.1641 57.0946 13.1641 57.0826 13.1641H49.1196C49.0954 13.1641 49.0832 13.1641 49.071 13.1763C49.059 13.1885 49.0468 13.1885 49.0346 13.2007L46 15.5255H60.2022Z" fill="white"/>
<path d="M46.0977 16.0044L52.9925 22.1586H53.0047C53.0167 22.1708 53.0289 22.1708 53.0411 22.183C53.0531 22.183 53.0775 22.1952 53.0897 22.1952C53.1017 22.1952 53.1261 22.1954 53.1381 22.183C53.1503 22.183 53.1625 22.1708 53.1745 22.1586H53.1867L60.0815 15.9922H46.0977V16.0044Z" fill="white"/>
<path d="M237.681 55.6091C237.293 55.6091 237.183 55.4611 237.183 55.1691C237.183 54.7531 237.377 54.4211 237.681 54.4211C237.985 54.4211 238.785 54.6431 239.817 54.6431C241.613 54.6431 242.937 53.2111 242.937 50.8739C242.937 48.5369 242.719 48.3901 240.947 48.3901C239.173 48.3901 238.785 49.4791 238.215 50.9227C238.021 51.3631 237.827 51.4971 237.523 51.4971C237.219 51.4971 236.589 51.1551 236.589 50.5067C236.589 49.2465 238.457 47.7539 241.019 47.7539C243.581 47.7539 245.267 48.5003 245.267 51.1311C245.267 53.7611 242.937 54.7531 241.213 54.8991V54.9971C242.719 55.2671 244.479 56.3311 244.479 58.4711C244.479 62.0191 241.601 63.4511 238.627 63.4511C235.653 63.4511 234.027 61.7391 234.027 60.6251C234.027 59.5111 234.621 59.3651 235.157 59.3651C235.691 59.3651 235.679 59.6091 235.799 60.0631C236.297 61.8971 237.099 62.8151 238.725 62.8151C240.351 62.8151 242.027 61.5791 242.027 58.1771C242.027 54.7771 241.553 55.4011 239.611 55.4011C238.689 55.4011 237.997 55.6091 237.681 55.6091Z" fill="white"/>
<path d="M259.105 45.918L259.203 45.9914L255.513 61.1146C255.317 61.8366 255.293 62.3746 255.707 62.3746C256.325 62.3746 257.333 60.7586 257.745 59.9386L258.219 60.2826C257.455 62.0186 256.229 63.5006 254.601 63.5006C252.975 63.5006 253.255 62.5086 253.667 60.8946C253.885 60.0986 254.105 59.2786 254.287 58.4706H254.237C252.915 60.9066 250.997 63.5006 248.387 63.5006C245.777 63.5006 246.201 61.9826 246.201 60.4786C246.201 57.7246 248.521 51.7786 253.825 51.7786C259.129 51.7786 255.305 52.0226 255.695 52.2686L256.727 47.9002C256.895 47.1782 256.871 47.0314 256.313 46.9826L254.991 46.8356L255.087 46.4198L259.105 45.918ZM249.491 62.3506C251.603 62.3506 254.261 57.7866 254.979 55.0086C255.123 54.3606 255.391 53.5166 255.525 52.9286C255.257 52.7566 254.663 52.5126 253.971 52.5126C250.377 52.5126 248.387 58.2146 248.387 60.6726C248.387 61.8106 248.775 62.3366 249.491 62.3506Z" fill="white"/>
<path d="M257.663 71.0129H235.571C226.649 71.0129 219.389 63.6969 219.389 54.7029C219.389 45.7109 226.649 38.3945 235.571 38.3945H257.663C266.585 38.3945 273.843 45.7109 273.843 54.7029C273.843 63.6969 266.585 71.0129 257.663 71.0129ZM235.571 39.3855C227.183 39.3855 220.361 46.2615 220.361 54.7149C220.361 63.1709 227.183 70.0469 235.571 70.0469H257.663C266.051 70.0469 272.871 63.1709 272.871 54.7149C272.871 46.2615 266.051 39.3855 257.663 39.3855H235.571Z" fill="white"/>
</g>
<g filter="url(#filter1_d_2013_189)">
<path d="M17.656 134.564H15.892C13.54 131.344 12 126.584 12 121.768C12 117.148 13.484 112.332 15.892 109H17.656C15.5 112.024 13.988 116.728 13.988 121.768C13.988 126.696 15.444 131.484 17.656 134.564Z" fill="white"/>
<path d="M32.1018 130.169H20.0898V110.121H32.0738V111.969H22.1059V119.193H31.1498V121.013H22.1059V128.321H32.1018V130.169Z" fill="white"/>
<path d="M41.7111 130.169L34.0391 110.121H36.1951L41.5431 124.065C41.9631 125.157 42.3551 126.249 42.8031 127.649C43.2231 126.193 43.7271 124.793 44.0351 124.037L49.3551 110.121H51.4271L43.8111 130.169H41.7111Z" fill="white"/>
<path d="M51.5889 130.169H49.5449L56.9089 110.121H59.4009L66.8489 130.169H64.7489L62.7889 124.849H53.5489L51.5889 130.169ZM57.8889 112.949L54.1649 123.085H62.1449L58.3929 112.949C58.3089 112.669 58.1689 112.333 58.1409 112.137C58.1129 112.305 58.0009 112.669 57.8889 112.949Z" fill="white"/>
<path d="M71.6527 110.121V128.321H80.8647V130.169H69.6367V110.121H71.6527Z" fill="white"/>
<path d="M82.8945 123.197V110.121H84.9105V123.113C84.9105 126.641 86.8425 128.545 90.3425 128.545C93.7585 128.545 95.6905 126.585 95.6905 123.113V110.121H97.7065V123.197C97.7065 127.733 94.9065 130.505 90.3425 130.505C85.6945 130.505 82.8945 127.761 82.8945 123.197Z" fill="white"/>
<path d="M101.601 130.169H99.5566L106.921 110.121H109.413L116.861 130.169H114.761L112.801 124.849H103.561L101.601 130.169ZM107.901 112.949L104.177 123.085H112.157L108.405 112.949C108.321 112.669 108.181 112.333 108.153 112.137C108.125 112.305 108.013 112.669 107.901 112.949Z" fill="white"/>
<path d="M115.715 111.969V110.121H130.079V111.969H123.891V130.169H121.875V111.969H115.715Z" fill="white"/>
<path d="M134.872 110.121V130.169H132.855V110.121H134.872Z" fill="white"/>
<path d="M157.609 120.146C157.609 126.222 153.662 130.506 148.062 130.506C142.434 130.506 138.514 126.222 138.514 120.146C138.514 114.07 142.462 109.758 148.062 109.758C153.69 109.758 157.609 114.042 157.609 120.146ZM155.537 120.146C155.537 115.134 152.486 111.718 148.062 111.718C143.638 111.718 140.614 115.134 140.614 120.146C140.614 125.158 143.638 128.574 148.062 128.574C152.486 128.574 155.537 125.13 155.537 120.146Z" fill="white"/>
<path d="M163.28 130.169H161.264V110.121H163.308L174.34 126.809V110.121H176.328V130.169H174.34L163.28 113.481V130.169Z" fill="white"/>
<path d="M194.508 130.169L186.836 110.121H188.992L194.34 124.065C194.76 125.157 195.152 126.249 195.6 127.649C196.02 126.193 196.524 124.793 196.832 124.037L202.152 110.121H204.224L196.608 130.169H194.508Z" fill="white"/>
<path d="M218.94 130.169H206.928V110.121H218.912V111.969H208.944V119.193H217.988V121.013H208.944V128.321H218.94V130.169Z" fill="white"/>
<path d="M225.051 130.169H223.035V110.121H230.511C234.571 110.121 237.035 112.361 237.035 115.917C237.035 118.801 235.523 120.817 232.947 121.517L237.231 130.169H234.991L230.903 121.853H225.051V130.169ZM225.051 111.941V120.033H230.567C233.339 120.033 234.963 118.521 234.963 115.973C234.963 113.369 233.255 111.941 230.511 111.941H225.051Z" fill="white"/>
<path d="M239.74 115.33C239.74 111.97 242.428 109.758 246.46 109.758C250.072 109.758 252.452 111.774 252.76 115.134H250.716C250.492 112.866 248.952 111.578 246.432 111.578C243.604 111.578 241.756 113.034 241.756 115.302C241.756 117.066 242.792 118.186 244.892 118.718L248.336 119.558C251.472 120.314 253.096 122.106 253.096 124.822C253.096 128.294 250.408 130.506 246.264 130.506C242.372 130.506 239.74 128.462 239.488 125.186H241.56C241.672 127.286 243.52 128.658 246.264 128.658C249.204 128.658 251.08 127.23 251.08 124.934C251.08 123.142 250.072 121.966 247.916 121.462L244.528 120.622C241.392 119.866 239.74 118.074 239.74 115.33Z" fill="white"/>
<path d="M258.739 110.121V130.169H256.723V110.121H258.739Z" fill="white"/>
<path d="M281.477 120.146C281.477 126.222 277.529 130.506 271.929 130.506C266.301 130.506 262.381 126.222 262.381 120.146C262.381 114.07 266.329 109.758 271.929 109.758C277.557 109.758 281.477 114.042 281.477 120.146ZM279.405 120.146C279.405 115.134 276.353 111.718 271.929 111.718C267.505 111.718 264.481 115.134 264.481 120.146C264.481 125.158 267.505 128.574 271.929 128.574C276.353 128.574 279.405 125.13 279.405 120.146Z" fill="white"/>
<path d="M287.149 130.169H285.133V110.121H287.177L298.209 126.809V110.121H300.197V130.169H298.209L287.149 113.481V130.169Z" fill="white"/>
<path d="M304.42 134.564H302.656C304.868 131.484 306.352 126.696 306.352 121.768C306.352 116.728 304.812 112.024 302.656 109H304.42C306.856 112.332 308.312 117.148 308.312 121.768C308.312 126.584 306.772 131.344 304.42 134.564Z" fill="white"/>
</g>
<defs>
<filter id="filter0_d_2013_189" x="35" y="4" width="249.842" height="102.617" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="4"/>
<feGaussianBlur stdDeviation="5.5"/>
<feComposite in2="hardAlpha" operator="out"/>
<feColorMatrix type="matrix" values="0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0.45 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2013_189"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2013_189" result="shape"/>
</filter>
<filter id="filter1_d_2013_189" x="1" y="102" width="318.312" height="47.5625" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
<feOffset dy="4"/>
<feGaussianBlur stdDeviation="5.5"/>
<feComposite in2="hardAlpha" operator="out"/>
<feColorMatrix type="matrix" values="0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0 0.123486 0 0 0 0.45 0"/>
<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2013_189"/>
<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2013_189" result="shape"/>
</filter>
</defs>
</svg>
`;var t0=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Xr extends e0{get envMapRotation(){var e,t;return(t=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&t!==void 0?t:0}set envMapRotation(e){var t;const i=[this.envMap,this.envMap2,this.envMap3];for(const r of i)r&&(r.rotation=e,(t=this._viewer)===null||t===void 0||t.scene.setDirty())}refreshEnvMaps(){var e,t,i;if(!this._viewer)return;const r=this.getEnvMaps(),s=((t=(e=this._viewer.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0?void 0:t.getMaterialsOfType(yr.TypeSlug))||[];for(const o of s)o&&(o.envMaps=r);(i=this._viewer)===null||i===void 0||i.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var e;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const t=((e=this._viewer)===null||e===void 0?void 0:e.scene.environment)||null;return[t,t,t]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const i=[];return e.modelObject.traverse(r=>{var s,o,l,u;const h=(o=(s=r.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||o===void 0?void 0:o[Xr.DIAMOND_GLTF_EXTENSION];h&&r.geometry&&(this.prepareDiamondMesh(r,h),delete r.userData.gltfExtensions[Xr.DIAMOND_GLTF_EXTENSION]),r.material&&!i.includes(r.material)&&!((u=(l=r.material.userData)===null||l===void 0?void 0:l.gltfExtensions)===null||u===void 0)&&u[Xr.DIAMOND_GLTF_EXTENSION]&&(r.material.materialObject||console.warn("WebGi DiamondPlugin: material not processed",r.material),i.push(r.material))}),i.forEach(r=>{const s=r.userData.gltfExtensions[Xr.DIAMOND_GLTF_EXTENSION];s&&this._convertToDiamondMaterial(r,s)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,i;const r=(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject())===null||i===void 0?void 0:i.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==js.TypeSlug},value:async()=>{var e,t,i,r,s,o;const l=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();if(!(l!=null&&l.material))return;const u=await((i=this._viewer)===null||i===void 0?void 0:i.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1)),h=(await((r=this._viewer)===null||r===void 0?void 0:r.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512").toLowerCase(),f=h.endsWith("high")?"high":h.endsWith("low")?"low":"medium";let g=parseInt(h);isFinite(g)||(g=512),g<64&&(g=64),((s=l.material.userData)===null||s===void 0?void 0:s.__appliedMeshes.size)>1&&await((o=this._viewer)===null||o===void 0?void 0:o.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(l.material,{cacheKey:u||void 0,normalMapRes:g,normalMapPrecision:f},{}):this.makeDiamondMesh(l,{cacheKey:u||void 0,normalMapRes:g,normalMapPrecision:f},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,i;const r=(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject())===null||i===void 0?void 0:i.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==yr.TypeSlug},value:async()=>{var e,t,i,r,s,o,l,u;const h=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject(),f=h==null?void 0:h.material;if(!f)return;const g=f.userData._baseMaterial;let _=(s=(r=(i=this._viewer)===null||i===void 0?void 0:i.getManager())===null||r===void 0?void 0:r.materials)===null||s===void 0?void 0:s.findMaterial(g);if(_&&!_.isDiamondMaterial||(_=(o=this._viewer)===null||o===void 0?void 0:o.createPhysicalMaterial({color:f.color})),_){const A=f.userData.__appliedMeshes.size>1&&await((l=this._viewer)===null||l===void 0?void 0:l.confirm("Convert all with this material?"))?Array.from(f.userData.__appliedMeshes):[h];for(const x of A)(u=x==null?void 0:x.setMaterial)===null||u===void 0||u.call(x,_)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var e,t,i,r;const s=(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject())===null||i===void 0?void 0:i.material;return!!Array.isArray(s)||(s==null?void 0:s.typeSlug)!==yr.TypeSlug||((r=s.userData.__appliedMeshes)===null||r===void 0?void 0:r.size)<2},value:async()=>{var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();if(!i)return;const r=i.material;r&&!Array.isArray(r)&&xd(r)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,i;(e=this._viewer)===null||e===void 0||e.setDirty(),(i=(t=this.uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}async onAdded(e){var t,i,r,s,o,l,u;this._normalCapture=new Df(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",_=>{var A,x,E,T,R;if(!((A=_.material)===null||A===void 0)&&A.isDiamondMaterial){const I=_.material,S=_.mesh||_.object;if(S.geometry&&!(!((x=this._normalCapture)===null||x===void 0)&&x.hasCapturedNormalMap(S))){const k=(R=(T=(E=I==null?void 0:I.userData)===null||E===void 0?void 0:E.gltfExtensions)===null||T===void 0?void 0:T[Xr.DIAMOND_GLTF_EXTENSION])!==null&&R!==void 0?R:{};k.cacheKey===void 0&&!S.userData._diamondCacheKey&&(I!=null&&I.name)&&(k.cacheKey=I.name),this.prepareDiamondMesh(S,k)}const O=this.getEnvMaps();I.envMaps=O}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const h=e.getPlugin(Ut);(t=h==null?void 0:h.importer)===null||t===void 0||t.processors.add("model",this._modelProcessor),(i=e.getPlugin(fr))===null||i===void 0||i.addEventListener("selectedObjectChanged",this.refreshUi);const f=this.getEnvMaps,g=new Tn(class extends Yi{async loadAsync(_,A){var x;const E=await super.loadAsync(_,A);return E.type===yr.TYPE||E.isDiamondMaterialParameters?(E.envMap=f(),(x=h==null?void 0:h.materials)===null||x===void 0?void 0:x.generateFromTemplate("diamond",E)):(console.error("Invalid material type for Diamond Material.",E),null)}},[yr.TypeSlug],!1);return(r=h==null?void 0:h.importer)===null||r===void 0||r.Importers.push(g),(l=(o=(s=h==null?void 0:h.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||l===void 0||l.push($m),(u=h==null?void 0:h.materials)===null||u===void 0||u.registerMaterialTemplate({name:"diamond",materialType:yr.TYPE,isDiamondMaterialParameters:!0,generator:(_,A)=>{const x=!(A!=null&&A.metadata||!A.isDiamondMaterialParameters)||(A==null?void 0:A.metadata)&&(A==null?void 0:A.metadata.version)<=4.5,E=A==null?void 0:A.color;x&&typeof A.color=="number"&&(A.color=new p.Ilk().setHex(A.color,p.GUF).getHex());const T=new yr(_);return T.envMaps=this.getEnvMaps(),A&&T.copyProps(A),A.color=E,T}}),super.onAdded(e)}async onRemove(e){var t,i,r,s;return(t=this._normalCapture)===null||t===void 0||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(r=(i=e.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.processors.remove("model",this._modelProcessor),(s=e.getPlugin(fr))===null||s===void 0||s.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:i,normalMapPrecision:r}){var s,o,l;this.use(),e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=i??e.userData._diamondNormalMapRes,e.userData._diamondNormalMapPrecision=r??e.userData._diamondNormalMapPrecision,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const u=(o=(s=this._normalCapture)===null||s===void 0?void 0:s.captureNormalMap(e.geometry,t,i,r,e))!==null&&o!==void 0?o:[void 0,!1],h=(l=this._viewer)===null||l===void 0?void 0:l.getPluginByType("debug");h&&u&&(h.counters.normalsCapture||(h.counters.normalsCapture=0),h.counters.normalsCapture++,console.log("DEBUG: new normal map captured",h.counters.normalsCapture,t),h.addTexture("normal"+h.counters.normalsCapture,()=>{var f,g;return(g=(f=e.geometry)===null||f===void 0?void 0:f.userData._normalsCaptureMap)===null||g===void 0?void 0:g.texture},[40,110*h.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,i){var r,s;Array.from((r=e==null?void 0:e.userData.__appliedMeshes)!==null&&r!==void 0?r:[]).forEach(o=>{o!=null&&o.isMesh&&o.geometry&&this.prepareDiamondMesh(o,t)}),this._convertToDiamondMaterial(e,i),(s=this._viewer)===null||s===void 0||s.setDirty()}makeDiamondMesh(e,t,i){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const r=Array.isArray(e.material)?e.material[0]:e.material,s=this._convertToDiamondMaterial(r,i,!1);e.setMaterial(s)}_convertToDiamondMaterial(e,t={isDiamond:!0},i=!0){var r,s,o,l,u,h,f,g;let _={...t??{}};_.isDiamond||_.isDiamondMaterialParameters?Array.isArray(_.boostFactors)&&(_.boostFactors=new p.Pa4().fromArray(_.boostFactors)):_={isDiamondMaterialParameters:!0},_.color=(s=(r=_.color)!==null&&r!==void 0?r:e==null?void 0:e.color)!==null&&s!==void 0?s:new p.Ilk(1,1,1),_.name=(l=(o=_.name)!==null&&o!==void 0?o:e==null?void 0:e.name)!==null&&l!==void 0?l:"diamond";const A=(f=(h=(u=this._viewer)===null||u===void 0?void 0:u.getManager())===null||h===void 0?void 0:h.materials)===null||f===void 0?void 0:f.generateFromTemplate("diamond",_);if(A&&e&&!e.isDiamondMaterial&&(A.userData._baseMaterial=e.uuid),i){const x=E=>{var T;return(T=E.setMaterial)!==null&&T!==void 0?T:R=>{E.material=R.materialObject}};Array.from((g=e==null?void 0:e.userData.__appliedMeshes)!==null&&g!==void 0?g:[]).forEach(E=>{x(E)(A),this.prepareDiamondMesh(E,t)})}return A}_computeOffsets(e,t,i=!1){var r;if(e.userData.normalsCaptureOffsets){if((0,V.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("WebGi DiamondPlugin: recomputeOffsets",e.userData.normalsCaptureOffsets)}let s;!((r=e.morphAttributes)===null||r===void 0)&&r.position&&(s=e.morphAttributes,e.morphAttributes={}),e.computeBoundingBox();const o=e.boundingBox.getCenter(new p.Pa4).toArray(),l=Bh(e).toArray(),u=new p.yGw().fromArray(l).invert(),h=new p.Pa4().fromArray(o).applyMatrix4(u).toArray(),f={center:o,offsetMatrix:l,offsetMatrixInv:u.toArray(),radius:1,centerOffset:h};return e.userData.normalsCaptureOffsets=f,s&&(e.morphAttributes=s,e.computeBoundingBox()),(0,V.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("WebGi DiamondPlugin: recomputeOffsets",f),f}disposeCacheMap(e){var t;(t=this._normalCapture)===null||t===void 0||t.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)===null||e===void 0||e.disposeAllTargets()}}Xr.PluginType="Diamond",Xr.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",t0([(0,V.onChange)(Xr.prototype.refreshEnvMaps),ae()],Xr.prototype,"envMap",void 0),t0([(0,V.onChange)(Xr.prototype.refreshEnvMaps),ae()],Xr.prototype,"envMap2",void 0),t0([(0,V.onChange)(Xr.prototype.refreshEnvMaps),ae()],Xr.prototype,"envMap3",void 0),t0([(0,V.onChange)(Xr.prototype.refreshEnvMaps),ae()],Xr.prototype,"forceSceneEnvMap",void 0);const $m=a=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[Xr.DIAMOND_GLTF_EXTENSION]=e.toJSON(),a.extensionsUsed[Xr.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var i,r;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const s={};(r=(i=e.userData)===null||i===void 0?void 0:i.gltfExtensions)===null||r===void 0||delete r[Xr.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(s.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondNormalMapPrecision&&(s.normalMapPrecision=e.userData._diamondNormalMapPrecision),e.userData._diamondCacheKey&&(s.cacheKey=e.userData._diamondCacheKey),t.extensions[Xr.DIAMOND_GLTF_EXTENSION]=s,a.extensionsUsed[Xr.DIAMOND_GLTF_EXTENSION]=!0}});class i0{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:i=1,scale:r=1}){var s,o,l;const u=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");u.width=t.width*r*i,u.height=t.height*r*i,t.assumeClientRect&&(t.x*=e.width/(i*e.clientWidth),t.y*=e.height/(i*e.clientHeight),t.width*=e.width/(i*e.clientWidth),t.height*=e.height/(i*e.clientHeight));const h=u.getContext("2d");if(!h)return console.error("snapshot: cannot create context"),u;const f=e.style.background||((s=e.parentElement)===null||s===void 0?void 0:s.style.background)||"";if(f.includes("url")){const g=(o=/url\("(.*)"\)/gi.exec(f))===null||o===void 0?void 0:o[1];if(g){const _=new Image;_.src=g,await new Promise((A,x)=>{_.onload=()=>A(),_.onerror=()=>x(),_.complete&&A()}),h.drawImage(_,_.width*t.x*i/e.width,_.height*t.y*i/e.height,_.width*t.width*i/e.width,_.height*t.height*i/e.height,0,0,u.width,u.height)}}else h.fillStyle=e.style.background||((l=e.parentElement)===null||l===void 0?void 0:l.style.backgroundColor)||"#00000000",h.fillRect(0,0,u.width,u.height);return h==null||h.drawImage(e,t.x*i,t.y*i,t.width*i,t.height*i,0,0,u.width,u.height),this.Debug&&(document.body.appendChild(u),u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.borderWidth="2px",u.style.borderColor="#ff00ff",setTimeout(()=>u.remove(),5e3)),u}static async GetDataUrl(e,{mimeType:t="image/png",...i}){const r=i.cloneCanvas===!1?e:await this.GetClonedCanvas(e,i),s=r.toDataURL(t);return this.Debug||r===e||r.remove(),s}static async GetImage(e,{mimeType:t="image/png",...i}={}){const r=await this.GetDataUrl(e,i);return new Promise((s,o)=>{const l=new Image;l.onload=()=>{s(l)},l.src=r})}static async GetBlob(e,t={}){const i=t.cloneCanvas===!1?e:await this.GetClonedCanvas(e,t),r=await new Promise((s,o)=>{var l;i.toBlob(u=>{u?s(u):o()},(l=t.mimeType)!==null&&l!==void 0?l:"image/png")});return this.Debug||i===e||i.remove(),r}static async GetFile(e,t="image.png",i={}){var r;return i.getDataUrl?await this.GetDataUrl(e,i):new File([await this.GetBlob(e,i)],t,{type:(r=i.mimeType)!==null&&r!==void 0?r:"image/png",lastModified:(0,V.now)()})}}i0.Debug=!1;var wa=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ol=class extends Si{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(a,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(a||this.filename,e)}async getDataUrl(a={}){var e;return a.getDataUrl=!0,(e=await this._getFile("",a))!==null&&e!==void 0?e:""}async _getFile(a,e={}){var t,i,r;const s=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(s){const o=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==o&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const l=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(As);if(e.waitForProgressive&&l&&e.timeout===void 0)for(;!l.isConverged(!0);)await(0,V.timeout)(64);else await(0,V.timeout)((r=e.timeout)!==null&&r!==void 0?r:200);e.displayPixelRatio=1;const u=await i0.GetFile(s,a,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=o,u}}async downloadSnapshot(a,e={waitForProgressive:!0}){const t=await this.getFile(a,e);t&&await this._downloadBlob(t,t.name)}async _downloadBlob(a,e){var t,i;const r=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("FileTransferPlugin");r?await r.exportFile(a,e):(i=this._viewer)===null||i===void 0||i.console.error("FileTransferPlugin required to export/download file")}};Ol.PluginType="CanvasSnipper",wa([Ci("Filename"),ae()],Ol.prototype,"filename",void 0),wa([Xi("Download .png",{limitedUi:!0})],Ol.prototype,"downloadSnapshot",null),Ol=wa([zi("Image Export")],Ol);var Lf=function(a){return function(e){return 1-a(1-e)}},eg=function(a){return function(e){return e<=.5?a(2*e)/2:(2-a(2*(1-e)))/2}},r0=function(a){return function(e){return Math.pow(e,a)}},kf=function(a){return function(e){return e*e*((a+1)*e-a)}},Uu=function(a){var e=kf(a);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},n0=function(a){return a},tg=r0(2),vc=Lf(tg),s0=eg(tg),ig=function(a){return 1-Math.sin(Math.acos(a))},a0=Lf(ig),o0=eg(a0),up=kf(1.525),rg=Lf(up),py=eg(up),fy=Uu(1.525),ng=function(a){if(a===1||a===0)return a;var e=a*a;return a<.36363636363636365?7.5625*e:a<.7272727272727273?9.075*e-9.9*a+3.4:a<.9?12.066481994459833*e-19.63545706371191*a+8.898060941828255:10.8*a*a-20.52*a+10.72},VA=Lf(ng),l0=function(a){return a<.5?.5*(1-ng(1-2*a)):.5*ng(2*a-1)+.5},ns=function(){return ns=Object.assign||function(a){for(var e,t=1,i=arguments.length;t<i;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a},ns.apply(this,arguments)};function GA(a,e){var t={};for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&e.indexOf(i)<0&&(t[i]=a[i]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(a);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(a,i[r])&&(t[i[r]]=a[i[r]])}return t}var $o=function(){},kh=function(a,e,t){return Math.min(Math.max(t,a),e)},c0=.001,my=.01,u0=10,gy=.05,vy=1,_y=12;function h0(a,e){return a*Math.sqrt(1-e*e)}var HA=["duration","bounce"],sg=["stiffness","damping","mass"];function Uf(a,e){return e.some(function(t){return a[t]!==void 0})}function Nf(a){var e=a.from,t=e===void 0?0:e,i=a.to,r=i===void 0?1:i,s=a.restSpeed,o=s===void 0?2:s,l=a.restDelta,u=GA(a,["from","to","restSpeed","restDelta"]),h={done:!1,value:t},f=function(O){var k=ns({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},O);if(!Uf(O,sg)&&Uf(O,HA)){var N=function(H){var X,te,re=H.duration,ue=re===void 0?800:re,le=H.bounce,se=le===void 0?.25:le,de=H.velocity,ve=de===void 0?0:de,fe=H.mass,Ee=fe===void 0?1:fe,Je=1-se;Je=kh(gy,vy,Je),ue=kh(my,u0,ue/1e3),Je<1?(X=function(Ve){var Ye=Ve*Je,Tt=Ye*ue,Xe=Ye-ve,Zt=h0(Ve,Je),di=Math.exp(-Tt);return c0-Xe/Zt*di},te=function(Ve){var Ye=Ve*Je*ue,Tt=Ye*ve+ve,Xe=Math.pow(Je,2)*Math.pow(Ve,2)*ue,Zt=Math.exp(-Ye),di=h0(Math.pow(Ve,2),Je);return(-X(Ve)+c0>0?-1:1)*((Tt-Xe)*Zt)/di}):(X=function(Ve){return Math.exp(-Ve*ue)*((Ve-ve)*ue+1)-c0},te=function(Ve){return Math.exp(-Ve*ue)*(ue*ue*(ve-Ve))});var Te=function(Ve,Ye,Tt){for(var Xe=Tt,Zt=1;Zt<_y;Zt++)Xe-=Ve(Xe)/Ye(Xe);return Xe}(X,te,5/ue);if(ue*=1e3,isNaN(Te))return{stiffness:100,damping:10,duration:ue};var qe=Math.pow(Te,2)*Ee;return{stiffness:qe,damping:2*Je*Math.sqrt(Ee*qe),duration:ue}}(O);(k=ns(ns(ns({},k),N),{velocity:0,mass:1})).isResolvedFromDuration=!0}return k}(u),g=f.stiffness,_=f.damping,A=f.mass,x=f.velocity,E=f.duration,T=f.isResolvedFromDuration,R=yy,I=yy;function S(){var O=x?-x/1e3:0,k=r-t,N=_/(2*Math.sqrt(g*A)),H=Math.sqrt(g/A)/1e3;if(l!=null||(l=Math.abs(r-t)<=1?.01:.4),N<1){var X=h0(H,N);R=function(re){var ue=Math.exp(-N*H*re);return r-ue*((O+N*H*k)/X*Math.sin(X*re)+k*Math.cos(X*re))},I=function(re){var ue=Math.exp(-N*H*re);return N*H*ue*(Math.sin(X*re)*(O+N*H*k)/X+k*Math.cos(X*re))-ue*(Math.cos(X*re)*(O+N*H*k)-X*k*Math.sin(X*re))}}else if(N===1)R=function(re){return r-Math.exp(-H*re)*(k+(O+H*k)*re)};else{var te=H*Math.sqrt(N*N-1);R=function(re){var ue=Math.exp(-N*H*re),le=Math.min(te*re,300);return r-ue*((O+N*H*k)*Math.sinh(le)+te*k*Math.cosh(le))/te}}}return S(),{next:function(O){var k=R(O);if(T)h.done=O>=E;else{var N=1e3*I(O),H=Math.abs(N)<=o,X=Math.abs(r-k)<=l;h.done=H&&X}return h.value=h.done?r:k,h},flipTarget:function(){var O;x=-x,t=(O=[r,t])[0],r=O[1],S()}}}Nf.needsInterpolation=function(a,e){return typeof a=="string"||typeof e=="string"};var yy=function(a){return 0},Ff=function(a,e,t){var i=e-a;return i===0?1:(t-a)/i},jf=function(a,e,t){return-t*a+t*e+a},d0=function(a,e){return function(t){return Math.max(Math.min(t,e),a)}},hp=function(a){return a%1?Number(a.toFixed(5)):a},zf=/(-)?([\d]*\.?[\d])+/g,ag=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,QA=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Nu(a){return typeof a=="string"}var Fu={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},Vf=ns(ns({},Fu),{transform:d0(0,1)}),dp=(ns(ns({},Fu),{default:1}),function(a,e){return function(t){return!!(Nu(t)&&QA.test(t)&&t.startsWith(a)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),Uh=function(a,e,t){return function(i){var r;if(!Nu(i))return i;var s=i.match(zf),o=s[0],l=s[1],u=s[2],h=s[3];return(r={})[a]=parseFloat(o),r[e]=parseFloat(l),r[t]=parseFloat(u),r.alpha=h!==void 0?parseFloat(h):1,r}},og=d0(0,255),_c=ns(ns({},Fu),{transform:function(a){return Math.round(og(a))}}),ru={test:dp("rgb","red"),parse:Uh("red","green","blue"),transform:function(a){var e=a.red,t=a.green,i=a.blue,r=a.alpha,s=r===void 0?1:r;return"rgba("+_c.transform(e)+", "+_c.transform(t)+", "+_c.transform(i)+", "+hp(Vf.transform(s))+")"}},Gf={test:dp("#"),parse:function(a){var e="",t="",i="",r="";return a.length>5?(e=a.substr(1,2),t=a.substr(3,2),i=a.substr(5,2),r=a.substr(7,2)):(e=a.substr(1,1),t=a.substr(2,1),i=a.substr(3,1),r=a.substr(4,1),e+=e,t+=t,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:ru.transform},p0=function(a){return{test:function(e){return Nu(e)&&e.endsWith(a)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+a}}},pp=p0("%"),ju=(ns(ns({},pp),{parse:function(a){return pp.parse(a)/100},transform:function(a){return pp.transform(100*a)}}),{test:dp("hsl","hue"),parse:Uh("hue","saturation","lightness"),transform:function(a){var e=a.hue,t=a.saturation,i=a.lightness,r=a.alpha,s=r===void 0?1:r;return"hsla("+Math.round(e)+", "+pp.transform(hp(t))+", "+pp.transform(hp(i))+", "+hp(Vf.transform(s))+")"}}),WA=function(a,e,t){var i=a*a,r=e*e;return Math.sqrt(Math.max(0,t*(r-i)+i))},fp=[Gf,ru,ju],by=function(a){return fp.find(function(e){return e.test(a)})},zu=function(a,e){var t=by(a),i=by(e);if($o(t.transform===i.transform),!t||!i||t.transform!==i.transform)return function(u){return""+(u>0?e:a)};var r=t.parse(a),s=i.parse(e),o=ns({},r),l=t===ju?jf:WA;return function(u){for(var h in o)h!=="alpha"&&(o[h]=l(r[h],s[h],u));return o.alpha=jf(r.alpha,s.alpha,u),t.transform(o)}},Nh={test:function(a){return ru.test(a)||Gf.test(a)||ju.test(a)},parse:function(a){return ru.test(a)?ru.parse(a):ju.test(a)?ju.parse(a):Gf.parse(a)},transform:function(a){return Nu(a)?a:a.hasOwnProperty("red")?ru.transform(a):ju.transform(a)}},XA="${c}",qA="${n}";function YA(a){typeof a=="number"&&(a=""+a);var e=[],t=0,i=a.match(ag);i&&(t=i.length,a=a.replace(ag,XA),e.push.apply(e,i.map(Nh.parse)));var r=a.match(zf);return r&&(a=a.replace(zf,qA),e.push.apply(e,r.map(Fu.parse))),{values:e,numColors:t,tokenised:a}}function KA(a){return YA(a).values}function ZA(a){var e=YA(a),t=e.values,i=e.numColors,r=e.tokenised,s=t.length;return function(o){for(var l=r,u=0;u<s;u++)l=l.replace(u<i?XA:qA,u<i?Nh.transform(o[u]):hp(o[u]));return l}}var cE=function(a){return typeof a=="number"?0:a},JA={test:function(a){var e,t,i,r;return isNaN(a)&&Nu(a)&&((t=(e=a.match(zf))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((r=(i=a.match(ag))===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0)>0},parse:KA,createTransformer:ZA,getAnimatableNone:function(a){var e=KA(a);return ZA(a)(e.map(cE))}},Ay={x:0,y:0,z:0},wy=function(a){return typeof a=="number"},Hf=function(a,e){return function(t){return e(a(t))}},xy=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return a.reduce(Hf)};function Fn(a,e){return wy(a)?function(t){return jf(a,e,t)}:Nh.test(a)?zu(a,e):Qf(a,e)}var lg=function(a,e){var t=function(s,o,l){if(l||arguments.length===2)for(var u,h=0,f=o.length;h<f;h++)!u&&h in o||(u||(u=Array.prototype.slice.call(o,0,h)),u[h]=o[h]);return s.concat(u||Array.prototype.slice.call(o))}([],a),i=t.length,r=a.map(function(s,o){return Fn(s,e[o])});return function(s){for(var o=0;o<i;o++)t[o]=r[o](s);return t}},$A=function(a,e){var t=ns(ns({},a),e),i={};for(var r in t)a[r]!==void 0&&e[r]!==void 0&&(i[r]=Fn(a[r],e[r]));return function(s){for(var o in i)t[o]=i[o](s);return t}};function cg(a){for(var e=JA.parse(a),t=e.length,i=0,r=0,s=0,o=0;o<t;o++)i||typeof e[o]=="number"?i++:e[o].hue!==void 0?s++:r++;return{parsed:e,numNumbers:i,numRGB:r,numHSL:s}}var Qf=function(a,e){var t=JA.createTransformer(e),i=cg(a),r=cg(e);return i.numHSL===r.numHSL&&i.numRGB===r.numRGB&&i.numNumbers>=r.numNumbers?xy(lg(i.parsed,r.parsed),t):function(s){return""+(s>0?e:a)}},ug=function(a,e){return function(t){return jf(a,e,t)}};function f0(a,e,t){var i=t===void 0?{}:t,r=i.clamp,s=r===void 0||r,o=i.ease,l=i.mixer,u=a.length;$o(u===e.length),$o(!o||!Array.isArray(o)||o.length===u-1),a[0]>a[u-1]&&(a=[].concat(a),e=[].concat(e),a.reverse(),e.reverse());var h=function(g,_,A){for(var x=[],E=A||(typeof(O=g[0])=="number"?ug:typeof O=="string"?Nh.test(O)?zu:Qf:Array.isArray(O)?lg:typeof O=="object"?$A:void 0),T=g.length-1,R=0;R<T;R++){var I=E(g[R],g[R+1]);if(_){var S=Array.isArray(_)?_[R]:_;I=xy(S,I)}x.push(I)}var O;return x}(e,o,l),f=u===2?function(g,_){var A=g[0],x=g[1],E=_[0];return function(T){return E(Ff(A,x,T))}}(a,h):function(g,_){var A=g.length,x=A-1;return function(E){var T=0,R=!1;if(E<=g[0]?R=!0:E>=g[x]&&(T=x-1,R=!0),!R){for(var I=1;I<A&&!(g[I]>E||I===x);I++);T=I-1}var S=Ff(g[T],g[T+1],E);return _[T](S)}}(a,h);return s?function(g){return f(kh(a[0],a[u-1],g))}:f}function ew(a,e){return a.map(function(){return e||s0}).splice(0,a.length-1)}function Vu(a){var e=a.from,t=e===void 0?0:e,i=a.to,r=i===void 0?1:i,s=a.ease,o=a.offset,l=a.duration,u=l===void 0?300:l,h={done:!1,value:t},f=Array.isArray(r)?r:[t,r],g=function(x,E){return x.map(function(T){return T*E})}(o&&o.length===f.length?o:function(x){var E=x.length;return x.map(function(T,R){return R!==0?R/(E-1):0})}(f),u);function _(){return f0(g,f,{ease:Array.isArray(s)?s:ew(f,s)})}var A=_();return{next:function(x){return h.value=A(x),h.done=x>=u,h},flipTarget:function(){f.reverse(),A=_()}}}function m0(a){var e=a.velocity,t=e===void 0?0:e,i=a.from,r=i===void 0?0:i,s=a.power,o=s===void 0?.8:s,l=a.timeConstant,u=l===void 0?350:l,h=a.restDelta,f=h===void 0?.5:h,g=a.modifyTarget,_={done:!1,value:r},A=o*t,x=r+A,E=g===void 0?x:g(x);return E!==x&&(A=E-r),{next:function(T){var R=-A*Math.exp(-T/u);return _.done=!(R>f||R<-f),_.value=_.done?E:E+R,_},flipTarget:function(){}}}var yc={keyframes:Vu,spring:Nf,decay:m0},Ey=1/60*1e3,tw=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},Wf=typeof window<"u"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a(tw())},Ey)},Sy=!0,Gu=!1,Fh=!1,Hu={delta:0,timestamp:0},jh=["read","update","preRender","render","postRender"],zh=jh.reduce(function(a,e){return a[e]=function(t){var i=[],r=[],s=0,o=!1,l=new WeakSet,u={schedule:function(h,f,g){f===void 0&&(f=!1),g===void 0&&(g=!1);var _=g&&o,A=_?i:r;return f&&l.add(h),A.indexOf(h)===-1&&(A.push(h),_&&o&&(s=i.length)),h},cancel:function(h){var f=r.indexOf(h);f!==-1&&r.splice(f,1),l.delete(h)},process:function(h){var f;if(o=!0,i=(f=[r,i])[0],(r=f[1]).length=0,s=i.length)for(var g=0;g<s;g++){var _=i[g];_(h),l.has(_)&&(u.schedule(_),t())}o=!1}};return u}(function(){return Gu=!0}),a},{}),hg=jh.reduce(function(a,e){var t=zh[e];return a[e]=function(i,r,s){return r===void 0&&(r=!1),s===void 0&&(s=!1),Gu||iw(),t.schedule(i,r,s)},a},{}),dg=jh.reduce(function(a,e){return a[e]=zh[e].cancel,a},{}),pg=function(a){return zh[a].process(Hu)},Xf=function(a){Gu=!1,Hu.delta=Sy?Ey:Math.max(Math.min(a-Hu.timestamp,40),1),Hu.timestamp=a,Fh=!0,jh.forEach(pg),Fh=!1,Gu&&(Sy=!1,Wf(Xf))},iw=function(){Gu=!0,Sy=!0,Fh||Wf(Xf)},Cy=function(){return Hu},rw=hg;function My(a,e,t){return t===void 0&&(t=0),a-e-t}var nw=function(a){var e=function(t){var i=t.delta;return a(i)};return{start:function(){return rw.update(e,!0)},stop:function(){return dg.update(e)}}};function qf(a){var e,t,i,r,s,o=a.from,l=a.autoplay,u=l===void 0||l,h=a.driver,f=h===void 0?nw:h,g=a.elapsed,_=g===void 0?0:g,A=a.repeat,x=A===void 0?0:A,E=a.repeatType,T=E===void 0?"loop":E,R=a.repeatDelay,I=R===void 0?0:R,S=a.onPlay,O=a.onStop,k=a.onComplete,N=a.onRepeat,H=a.onUpdate,X=GA(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),te=X.to,re=0,ue=X.duration,le=!1,se=!0,de=function(fe){if(Array.isArray(fe.to))return Vu;if(yc[fe.type])return yc[fe.type];var Ee=new Set(Object.keys(fe));return Ee.has("ease")||Ee.has("duration")&&!Ee.has("dampingRatio")?Vu:Ee.has("dampingRatio")||Ee.has("stiffness")||Ee.has("mass")||Ee.has("damping")||Ee.has("restSpeed")||Ee.has("restDelta")?Nf:Vu}(X);!((t=(e=de).needsInterpolation)===null||t===void 0)&&t.call(e,o,te)&&(s=f0([0,100],[o,te],{clamp:!1}),o=0,te=100);var ve=de(ns(ns({},X),{from:o,to:te}));return u&&(S==null||S(),(i=f(function(fe){if(se||(fe=-fe),_+=fe,!le){var Ee=ve.next(Math.max(0,_));r=Ee.value,s&&(r=s(r)),le=se?Ee.done:_<=0}H==null||H(r),le&&(re===0&&(ue!=null||(ue=_)),re<x?function(Je,Te,qe,Ve){return Ve?Je>=Te+qe:Je<=-qe}(_,ue,I,se)&&(re++,T==="reverse"?_=function(Je,Te,qe,Ve){return qe===void 0&&(qe=0),Ve===void 0&&(Ve=!0),Ve?My(Te+-Je,Te,qe):Te-(Je-Te)+qe}(_,ue,I,se=re%2==0):(_=My(_,ue,I),T==="mirror"&&ve.flipTarget()),le=!1,N&&N()):(i.stop(),k&&k()))})).start()),{stop:function(){O==null||O(),i.stop()}}}const el={linear:n0,easeIn:tg,easeOut:vc,easeInOut:s0,circIn:ig,circOut:a0,circInOut:o0,backIn:up,backOut:rg,backInOut:py,anticipate:fy,bounceOut:ng,bounceIn:VA,bounceInOut:l0,easeInOutSine:function(a){return-(Math.cos(Math.PI*a)-1)/2}};function Ty(a,e,t){const i=a[e],r=()=>{t==null||t()};return i.isColor?s=>{i.set(s),r()}:typeof i.copy=="function"?s=>{i.copy(s),r()}:s=>{a[e]=s,r()}}function Iy(a){return typeof a!="boolean"}async function g0(a,e,t,i,r=!1){e in a||console.error("invalid key",e,a);const s=Ty(a,e),o=r||t.from===void 0?a[e]:t.from,l=u=>{var h;s(u),(h=t.onUpdate)===null||h===void 0||h.call(t,u)};if(Iy(o))return typeof t.to=="function"&&(t={...t,to:t.to(o,a)}),mp({...t,from:o,onUpdate:l},i);{const{duration:u}=t;return(0,V.timeout)(u??0).then(()=>l(t.to))}}async function mp(a,e){const t=a.onComplete,i=a.onStop,r=a.onEnd;return a={...a},new Promise((s,o)=>{a.onComplete=()=>{try{t==null||t()}catch(u){return r==null||r(),void o(u)}r==null||r(),s()},a.onStop=()=>{try{i==null||i()}catch(u){return r==null||r(),void o(u)}r==null||r(),s()};const l=qf(a);e&&e.push(l)})}var jn=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let sw=1,yn=class{constructor(a,e,t,i,r){this.position=new p.Pa4,this.target=new p.Pa4,this.quaternion=new p._fP,this.up=new p.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=Wa(this.name,this),a&&(this.position=a),e&&(this.target=e),t&&(this.up=t),i&&(this.quaternion=i),r&&(this.snap=r),this.name="#view"+sw++}_nameChanged(){var a,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(a=this.uiConfig).uiRefresh)===null||e===void 0||e.call(a))}};jn([ae(),Mn()],yn.prototype,"position",void 0),jn([ae(),Mn()],yn.prototype,"target",void 0),jn([ae(),Mn()],yn.prototype,"quaternion",void 0),jn([ae(),Mn()],yn.prototype,"up",void 0),jn([ae(),Ci()],yn.prototype,"name",void 0),jn([du()],yn.prototype,"snap",void 0),jn([Xi()],yn.prototype,"focusView",void 0),jn([Xi()],yn.prototype,"deleteView",void 0),jn([Xi()],yn.prototype,"updateView",void 0),yn=jn([$n("CameraView")],yn);class Ir extends Si{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(i=>i===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(i=>i===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Qa(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const i=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera;if(!i)return;const r=new p.$V,s=i.position,o=i.target,l=new p._fP().setFromUnitVectors(i.cameraObject.up,new p.Pa4(0,1,0)),u=l.clone().invert(),h=s.clone().sub(o);h.applyQuaternion(l),r.setFromVector3(h),r.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,r.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,r.makeSafe(),h.setFromSpherical(r),h.applyQuaternion(u),s.copy(o).add(h),i.positionUpdated(!1),i.targetUpdated()}}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",t=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.setInteractions(!1,Ir.PluginType):this._viewer.scene.activeCamera.setInteractions(!0,Ir.PluginType)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,t;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(Ir.PluginType),this._fadeDisabled=!1));const i=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=i-1/60);let r=i-this._lastFrameTime;this._lastFrameTime=i,r*=this.animateOnScroll?this._scrollAnimationState:1;const s=(t=this._viewer.getPluginByType("Progressive"))===null||t===void 0?void 0:t.postFrameConvergedRecordingDelta();if(s&&s>0&&(r=s),s!==0&&(r*=1e3,!(r<=0||(this._updaters.forEach(o=>{let l=r;o.time+l<0&&(l=-o.time),o.time+=l,Math.abs(l)>.001&&o.u(l)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const o=this._viewer.getPluginByType("FrameFade");o&&(o.disable(Ir.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,V.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,V.timeout)(2))}async recordAllViews(e,t=!0){var i;if(!this.enabled)return;const r=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");if(r&&r.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!r.isRecording())return new Promise((s,o)=>{const l=()=>{r.removeEventListener("start",u),r.removeEventListener("stop",l),r.removeEventListener("error",h)},u=async()=>{var f;l(),e==null||e(),await this.animateAllViews();const g=await r.stopRecording();if(t){const _=await((f=this._viewer)===null||f===void 0?void 0:f.prompt("Canvas Recorder: Save file as","recording.mp4"));_!==null&&g&&await this._downloadBlob(g,_||"recording.mp4")}s(g)},h=async()=>{l(),o()};r.addEventListener("start",u),r.addEventListener("stop",l),r.addEventListener("error",h),r.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var e,t;if(!this.enabled)return;const i=this.getCurrentCameraView();i.snap=await((t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ol))===null||t===void 0?void 0:t.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(i)}addView(e){var t,i;this._cameraViews.push(e),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0,i){var r,s,o;if(e||(e=(r=this._viewer)===null||r===void 0?void 0:r.scene.activeCamera),!e)return new yn;const l=new p.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const u=e.cameraObject.matrixWorld;l.x=u.elements[4],l.y=u.elements[5],l.z=u.elements[6],l.normalize();const h=e.target.clone(),f=e.position.clone(),g=e.cameraObject.parent;g&&(t?f.applyMatrix4(g.matrixWorld):l.transformDirection(g.matrixWorld.clone().invert()));const _=t?e.cameraObject.getWorldQuaternion(new p._fP):e.cameraObject.quaternion.clone();return i?(i.position.copy(f),i.target.copy(h),i.up.copy(l),i.quaternion.copy(_)):((i=new yn(f,h,l,_,"")).focusView=async()=>i&&this.focusView(i),i.deleteView=()=>i&&this.deleteView(i),i.updateView=()=>this.getCurrentCameraView(e,t,i)),(o=(s=i.uiConfig).uiRefresh)===null||o===void 0||o.call(s,"postFrame",!0),i}setCurrentCameraView(e){var t;const i=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera;i&&(i.position.copy(e.position),i.target.copy(e.target),i.cameraObject.quaternion.copy(e.quaternion),i.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var t,i;const r=this._cameraViews.indexOf(e);r>=0&&this._cameraViews.splice(r,1),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)===null||t===void 0?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,V.timeout)(100)}async animateToView(e,t,i,r=!1){var s,o;const l=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera;if(!l)return;if(this._animating){this._popAnimations.forEach(A=>(A==null?void 0:A.stop)&&A.stop()),this._popAnimations=[];let _=0;for(;this._animating&&(await(0,V.timeout)(100),!(_++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration),t=Math.max(10,t);const u=typeof i=="function"?i:el[i||this.animEase],h=this._driver,f=[];this._popAnimations=[];const g=this._popAnimations;if(this.interpolateMode==="spherical")f.push(async function(_,A,x,E,T,R,I){const S=_.target.clone(),O=new p.Pa4,k=new p.Pa4,N=_.cameraObject.parent,H=_.cameraObject.up.clone(),X=gp({position:_.cameraObject.getWorldPosition(new p.Pa4),up:N?H.transformDirection(N.matrixWorld):H},S),te=gp(A,A.target),re=new p.$V;function ue(){_.position.copy(N?N.worldToLocal(k):k),_.target.copy(O),_.positionUpdated()}return mp({from:0,to:1,duration:x,ease:E,driver:T,onUpdate:le=>{re.phi=Yf(X.phi,te.phi,le),re.theta=Yf(X.theta,te.theta,le),re.radius=p.M8C.lerp(X.radius,te.radius,le),O.copy(S).lerp(A.target,le),k.setFromSpherical(re),k.add(O),ue()},onComplete:()=>{k.copy(A.position),O.copy(A.target),ue()},onStop:()=>{throw new Error("Animation Stopped")}},R)}(l,e,t,u,h,g));else if(this.interpolateMode==="linear"){f.push(mp({from:l.position.clone(),to:e.position.clone(),duration:t,ease:u,driver:h,onUpdate:x=>l.position=x,onComplete:()=>l.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},g)),f.push(mp({from:l.target.clone(),to:e.target.clone(),duration:t,ease:u,driver:h,onUpdate:x=>{l.target=x,l.targetUpdated()},onComplete:()=>{l.target=e.target,l.targetUpdated()}},g));const _=l.cameraObject.quaternion.clone(),A=new p._fP;f.push(mp({from:0,to:1,duration:t,ease:u,driver:h,onUpdate:x=>{A.copy(_).slerp(e.quaternion,x),l.cameraObject.quaternion.copy(A),l.cameraObject.updateProjectionMatrix()},onComplete:()=>{l.cameraObject.quaternion.copy(e.quaternion),l.cameraObject.updateProjectionMatrix()}},g))}await Promise.allSettled(f).catch(_=>{if(r)throw _}),(o=this._viewer)===null||o===void 0||o.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,V.timeout)(10)}fromJSON(e,t){var i,r;return this._cameraViews.forEach(s=>this.deleteView(s)),super.fromJSON(e,t)?(this._cameraViews.forEach(s=>s.focusView=async()=>this.focusView(s)),this._cameraViews.forEach(s=>s.deleteView=()=>this.deleteView(s)),this._cameraViews.forEach(s=>s.updateView=()=>this.getCurrentCameraView(void 0,void 0,s)),(r=(i=this.uiConfig).uiRefresh)===null||r===void 0||r.call(i),this):null}async animateToObject(e,t=4,i,r,s={min:.5,max:5}){if(!this._viewer)return;const o=new Re().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),l=o.getCenter(new p.Pa4),u=o.getSize(new p.Pa4).length()/2;await this.animateToTarget(Math.min(s.max,Math.max(s.min,u*t)),l,i,r)}async animateToFitObject(e,t=1.5,i=1e3,r,s={min:.5,max:50}){if(!this._viewer)return;const o=new Re().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),l=o.getCenter(new p.Pa4),u=o.getSize(new p.Pa4);let h=this._viewer.scene.activeCamera.cameraObject,f=1;if(h.isPerspectiveCamera){const g=Math.max(1,h.fov)*(Math.PI/180),_=2*Math.atan(Math.tan(g/2)*h.aspect),A=u.z/2+Math.abs(u.x/2/Math.tan(_/2)),x=u.z/2+Math.abs(u.y/2/Math.tan(g/2));f=Math.max(A,x)}await this.animateToTarget(Math.min(s.max,Math.max(s.min,f*t)),l,i,r)}async animateToTarget(e,t,i,r){const s=this.getCurrentCameraView();s.target.copy(t);const o=new p.Pa4().subVectors(s.target,s.position).normalize();s.position.copy(o.multiplyScalar(-e).add(s.target)),await this.animateToView(s,i,r)}async _downloadBlob(e,t){var i,r;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,t):(r=this._viewer)===null||r===void 0||r.console.error("FileTransferPlugin required to export/download file")}}function gp(a,e){const t=a.position.clone();t.sub(e);const i=new p.$V().setFromVector3(t);return i.makeSafe(),i}function Yf(a,e,t){const i=e-a;return i>=Math.PI?a+(i-2*Math.PI)*t:i<=-Math.PI?a+(i+2*Math.PI)*t:a+i*t}function Py(a,e,t){const i=(1-t)*Math.cos(a)+t*Math.cos(e),r=(1-t)*Math.sin(a)+t*Math.sin(e);return Math.atan2(r,i)}Ir.PluginType="CameraViews",jn([ae("cameraViews")],Ir.prototype,"_cameraViews",void 0),jn([(0,V.onChange)(Ir.prototype._animationLoop),ae(),Ot("Loop All Views",{limitedUi:!0})],Ir.prototype,"viewLooping",void 0),jn([ae(),Ci("View Pause Time")],Ir.prototype,"viewPauseTime",void 0),jn([ae(),Fs("Ease",Object.keys(el).map(a=>({label:a})))],Ir.prototype,"animEase",void 0),jn([ae(),ai("Duration",[10,1e4],10,{limitedUi:!0})],Ir.prototype,"animDuration",void 0),jn([ae(),ai("RotationOffset",[.2,.75],.01)],Ir.prototype,"rotationOffset",void 0),jn([ae(),Fs("Interpolation",["spherical","linear"].map(a=>({label:a})))],Ir.prototype,"interpolateMode",void 0),jn([Ot(),ae()],Ir.prototype,"seekOnScroll",void 0),jn([Xi("Animate All Views",{limitedUi:!0})],Ir.prototype,"animateAllViews",null),jn([Xi("Record All Views")],Ir.prototype,"recordAllViews",null),jn([Xi("Add Current View")],Ir.prototype,"addCurrentView",null),jn([Xi("Focus Next")],Ir.prototype,"focusNext",void 0),jn([Xi("Focus Previous")],Ir.prototype,"focusPrevious",void 0);const v0=new p.Pa4;function uE(a,e,t){let i=a.dot(e);i=Math.min(Math.max(i,-1),1);const r=Math.acos(i)*t;return v0.copy(a).multiplyScalar(i).sub(e).negate().normalize(),a.multiplyScalar(Math.cos(r)).add(v0.multiplyScalar(Math.sin(r)))}var Qu,fg=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Wu=Qu=class{constructor(a){this.enabled=!1,this.power=.5,this.bgcolor=new p.Ilk(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new p.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?V.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=a.getPlugin(vn),this._setDirty=this._setDirty.bind(this)}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(a,e,t){this.enabled&&(this.extraUniforms.power.value=this.power,this.extraUniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._setDirty()}};Wu.PluginType="Vignette",fg([(0,V.onChange)(Qu.prototype._setDirty),Ot("Enable"),ae()],Wu.prototype,"enabled",void 0),fg([(0,V.onChange)(Qu.prototype._setDirty),ai("Power",[.1,4],.01,{limitedUi:!0}),ae()],Wu.prototype,"power",void 0),fg([(0,V.onChange)(Qu.prototype._setDirty),ea("Color"),ae()],Wu.prototype,"bgcolor",void 0),Wu=Qu=fg([zi("Vignette")],Wu);class Kf extends Zc{constructor(){super()}generateExtension(e){return new Wu(e)}get power(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&t!==void 0?t:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&t!==void 0?t:new p.Ilk}set color(e){this._extension&&(this._extension.bgcolor.set(e),this._extension.setDirty())}}Kf.PluginType="Vignette";var sa=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ds=class extends Si{constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const a=await(0,V.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(a)}async loadScenes(a){var e,t;const i=await Promise.all(a.map(async r=>await r.arrayBuffer()));for(let r=0;r<a.length;r++){const s=a[r];this.scenes.push({[s.name]:new Uint8Array(i[r])}),this.assets[s.name]={path:s.name,file:s}}(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e)}async play(){var a,e;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const t=(a=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin"))!==null&&a!==void 0?a:this._viewer.getPluginByType("LoadingScreenPlugin");t==null||t.enabled,t&&(t.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),r=this._viewer.getPluginByType("GLTFAnimation"),s=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const o of this.scenes){if(!this._isPlaying)break;const l=Object.keys(o);r==null||r.stopAnimation(!1),await(s==null?void 0:s.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const h of l){let f=this.assets[h];f||(f={path:h,file:new File([o[h]],h)},this.assets[h]=f),await((e=this._viewer.getManager())===null||e===void 0?void 0:e.addAssetSingle(f,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,t&&(t.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const u=[(0,V.timeout)(this.minSceneTime)];r&&u.push(r.playAnimation()),s&&u.push(s.animateAllViews()),await Promise.all(u)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const a={};for(const i of this.scenes)for(const r of Object.keys(i)){const s=a[r]?r+"_":r;a[s]=i[s]}const e=Kc(a),t=new Blob([e],{type:"application/zip"});(0,V.downloadBlob)(t,"scenes.glbloop")}async onAdded(a){var e,t;await super.onAdded(a);const i=this;(t=(e=a.getManager())===null||e===void 0?void 0:e.importer)===null||t===void 0||t.Importers.push(new Tn(class extends Pv{load(r,s,o,l){super.load(r,u=>{i.loadScenes([...u.values()]),s==null||s(null),(0,V.timeout)(100).then(i.play)},o,l)}},["glbloop"],!0))}};Ds.PluginType="SceneLoopPlugin",sa([ql("Loaded scenes")],Ds.prototype,"loadedScenes",null),sa([Xi("Load Scenes")],Ds.prototype,"promptLoadScenes",null),sa([ql("Playing")],Ds.prototype,"_isPlaying",void 0),sa([Ci("Min Scene Time")],Ds.prototype,"minSceneTime",void 0),sa([Xi("Play")],Ds.prototype,"play",null),sa([Xi("Stop")],Ds.prototype,"stop",null),sa([Xi("Download Scenes")],Ds.prototype,"downloadScenes",null),Ds=sa([zi("Scene Loop")],Ds);var _0=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Vh=class extends pu{constructor(a,e,t){super(a,e,t??new aw,new p.Ilk(.5,.5,.5),1),this.enabled=!0,this._firstCall=!0}render(a,e,t,i,r){if(!this.enabled||!this.camera)return;const s=this.overrideMaterial;s.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(a,e,t,i,r),s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value)}};_0([Ot("Enabled")],Vh.prototype,"enabled",void 0),Vh=_0([zi("Velocity Buffer (TAA)")],Vh);class aw extends p.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new p.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new p.Vkp},currentProjectionViewMatrix:{value:new p.yGw},lastProjectionViewMatrix:{value:new p.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new p.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,i,r,s){var o,l;const u=this._previousWorldMatrices[s.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(u??s.matrixWorld),u?u.copy(s.matrixWorld):this._previousWorldMatrices[s.uuid]=s.matrixWorld.clone();let h=s.material;Array.isArray(h)&&(h=h[0]),this.uniforms.alphaMap.value=(o=h==null?void 0:h.alphaMap)!==null&&o!==void 0?o:null,this.uniforms.alphaTest.value=!h||!h.alphaTest||h.alphaTest<1e-7?.001:h.alphaTest;let f=this.uniforms.alphaMap.value?1:void 0;f!==this.defines.USE_ALPHAMAP&&(f===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=f,this.needsUpdate=!0),f=h.userData.ALPHA_I_RGBA_PACKING?1:void 0,f!==this.defines.ALPHA_I_RGBA_PACKING&&(f===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=f,this.needsUpdate=!0),this.side=(l=h.side)!==null&&l!==void 0?l:p.ehD}}class tl extends qa{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:p.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const i=new Set,r=new Set;return new class extends Vh{render(s,o,l,u,h){var f;if(e.renderer.frameCount>0)return;const g=s.getRenderTarget(),_=s.getActiveCubeFace(),A=s.getActiveMipmapLevel();(f=this.scene)===null||f===void 0||f.traverse(({material:x})=>{var E,T;if(!x)return;const R=x.userData.renderToDepth&&!x.userData.pluginsDisabled&&!(!((E=x.userData[tl.PluginType])===null||E===void 0)&&E.disabled),I=x.userData.renderToDepth===!1||x.userData.pluginsDisabled||((T=x.userData[tl.PluginType])===null||T===void 0?void 0:T.disabled);(x.transparent&&R||!x.transparent&&!x.transmission&&I)&&(i.add(x),x.transparent=!x.transparent),Math.abs(x.transmission||0)>0&&R&&(r.add([x,x.transmission]),x.transmission=0)}),Wt(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(s,o,t,u,h)),i.forEach(x=>x.transparent=!x.transparent),i.clear(),r.forEach(([x,E])=>x.transmission=E),r.clear(),s.setRenderTarget(g,_,A)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.renderCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.renderCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var i;return e.renderer.disposeTarget((i=t==null?void 0:t.dispose)===null||i===void 0?void 0:i.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t,i;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(i=(t=this.getVelocityBuffer())===null||t===void 0?void 0:t.texture)!==null&&i!==void 0?i:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}tl.PluginType="VelocityBuffer";var So,bc=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let il=So=class{constructor(a){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=a,this._combinedPostPlugin=a.getPlugin(vn),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const a=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=a?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,a),this.extraDefines.USE_LUT=this.lutMap?1:0,e=a?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,a),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=a?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,a),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=a,this._setDirty()}_updateLUTMap(a,e,t,i){if(a){let r=1;i==1?(e.value=a.texture3D,r=a.texture3D.image.width):a.texture&&(e.value=a.texture,r=a.texture.image.width),e.value.needsUpdate=!0,t.value=r}}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function Ry(a){const e=a==null?void 0:a.userData;if(!e)return!1;e[xn.PluginType]||(e[xn.PluginType]={});const t=e[xn.PluginType];return t.enable=!0,t.index===void 0&&(t.index=0),a.isMaterial&&(a.needsUpdate=!0),!0}bc([ae(),(0,V.onChange)(So.prototype._updateParams),Ot("Enable")],il.prototype,"enabled",void 0),bc([ae(),(0,V.onChange)(So.prototype._updateParams),Ot("LUT Background")],il.prototype,"lutBackground",void 0),bc([ae(),(0,V.onChange)(So.prototype._updateParams),ai("Intensity")],il.prototype,"intensity",void 0),bc([(0,V.onChange)(So.prototype._updateParams),du("LUT"),ae()],il.prototype,"lutMap",void 0),bc([(0,V.onChange)(So.prototype._updateParams),du("LUT1"),ae()],il.prototype,"lutMap1",void 0),bc([(0,V.onChange)(So.prototype._updateParams),du("LUT2"),ae()],il.prototype,"lutMap2",void 0),il=So=bc([zi("LUT")],il);class xn extends Zc{_getUiConfig(e){var t,i;const r={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var s,o;return(o=(s=e.materialObject.userData[xn.PluginType])===null||s===void 0?void 0:s.enable)===null||o===void 0||o},set value(s){var o;const l=e.materialObject.userData[xn.PluginType];s!==(l==null?void 0:l.enable)&&(l||Ry(e.materialObject),e.materialObject.userData[xn.PluginType].enable=s,(o=r.uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0))},onChange:(t=this._extension)===null||t===void 0?void 0:t.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(s=>({label:s[0],value:s[1]})),label:"index",hidden:()=>{const s=e.materialObject.userData[xn.PluginType];return!!s&&!s.enable},get value(){var s,o;return(o=(s=e.materialObject.userData[xn.PluginType])===null||s===void 0?void 0:s.index)!==null&&o!==void 0?o:0},set value(s){var o;e.materialObject.userData[xn.PluginType]||Ry(e.materialObject),e.materialObject.userData[xn.PluginType].index=s,(o=r.uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0)},onChange:(i=this._extension)===null||i===void 0?void 0:i.setDirty}]};return r}constructor(){super(),this.materialExtension={uuid:Wn(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+(!((t=e.materialObject.userData[xn.PluginType])===null||t===void 0)&&t.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var t,i;await super.onAdded(e),(t=e.getPlugin(vr))===null||t===void 0||t.registerGBufferUpdater(this.updateGBuffer);const r=e.getPlugin(Ut);(i=r==null?void 0:r.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new il(e)}updateGBuffer(e,t){var i,r;if(e instanceof p.Kj0&&!((i=e.material)===null||i===void 0)&&i.userData){const s=(r=e.material)===null||r===void 0?void 0:r.userData[xn.PluginType];if(s){const o=s.enable===!1?0:1;t.w=Pu(t.w,0,o);for(let u=0;u<3;u++)t.y=V_(t.y,u);let l=s.enable?s.index:0;l=Math.min(l,7),t.y=t.y|l}else t.w=Pu(t.w,0,1)}}}xn.PluginType="LUTPlugin1";class mg{constructor(e){this._zee=new p.Pa4(0,0,1),this._euler=new p.USm,this._q0=new p._fP,this._q1=new p._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new p._fP,this._initQuaternionDest=new p._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=t=>{this.deviceOrientation=t},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new p.FM8;this.getQuaternion(e,this._q2);const t=new p.Pa4(0,0,1);return t.applyQuaternion(this._q2),new p.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new p._fP),!this.deviceOrientation)return t.identity();const i=this.deviceOrientation,r=i.alpha!==null?p.M8C.degToRad(i.alpha):0,s=i.beta!==null?p.M8C.degToRad(i.beta):0,o=i.gamma!==null?p.M8C.degToRad(i.gamma):0,l=this.screenOrientation?p.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,r,s,o,l,e),t}_toQuaternion(e,t,i,r,s,o){this._euler.set(i,t,-r,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const l=document.getElementById("debug");return l&&(l.textContent=s+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),o&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)===null||e===void 0||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new p._fP)}}class Dy{constructor(){this._mousePos=new p.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new p.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var Hs,ka=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Co=Hs=class extends Si{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new p.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new p.Pa4,this._center=new p.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var a,e;if(!this.enabled)return void((e=(a=this._object)._updateProjectionMatrixParallax)===null||e===void 0||e.call(a));const t=this._object,i=t.near;let r=i*Math.tan(.5*p.M8C.DEG2RAD*t.fov)/t.zoom,s=2*r,o=t.aspect*s,l=-.5*o;if(t.view!==null&&t.view.enabled){const h=t.view.fullWidth,f=t.view.fullHeight;l+=t.view.offsetX*o/h,r-=t.view.offsetY*s/f,o*=t.view.width/h,s*=t.view.height/f}l-=this._offX*i/this._focalDistance,r-=this._offY*i/this._focalDistance;const u=t.filmOffset;u!==0&&(l+=i*u/t.getFilmWidth()),t.projectionMatrix.makePerspective(l,l+o,r,r-s,i,t.far),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()},this._preFrame=a=>{this.update(a.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new V.Damper,this._yDamper=new V.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(a){var e,t,i;await super.onAdded(a),mg.IsCompatible()?this._input=new mg(a):this._input=new Dy,a.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),a.addEventListener("preFrame",this._preFrame),(e=this._viewer)===null||e===void 0||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(t=this._viewer)===null||t===void 0||t.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(i=a.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var a,e,t,i;this._object&&!((a=this._object)===null||a===void 0)&&a._updateProjectionMatrixParallax&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.cameraObject,!((t=this._object)===null||t===void 0)&&t.isOrthographicCamera?(i=this._viewer)===null||i===void 0||i.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var a;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(a=this._viewer)===null||a===void 0||a.container.appendChild(this._indicator))}onPointerDown(a){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=a.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=a.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(a){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.setInteractions(!1,Hs.PluginType),this._updateFocalDistance();const e=this._object.matrixWorld.elements,t=new p.Pa4(e[0],e[1],e[2]),i=new p.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let r=this.sensitivity;this.invert&&(r*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*r,a,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*r,a,1);const s=this._object;s.position.add(i.multiplyScalar(this._offY)).add(t.multiplyScalar(this._offX)),s.updateProjectionMatrix(),s.updateMatrixWorld(),this._dirty=!0}_onObjectHit(a){var e,t;a.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(a.intersects.intersect.point),a.intersects.selectedObject=null,(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var i,r;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(r=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||r===void 0||r.call(i,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const a=this._object,e=new p.Pa4;a.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(a.position).dot(e)}_onEnabledChange(){var a,e,t;if(this._viewer){if(this.enabled){if((a=this._input)===null||a===void 0||a.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.setInteractions(!1,Hs.PluginType);const i=this._viewer.getPluginByType("CameraViews"),r=i==null?void 0:i.camViews.find(s=>s.name===this.cameraView);i&&r&&i.setCurrentCameraView(r),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.setInteractions(!0,Hs.PluginType),this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const i=this._object;i.updateProjectionMatrix(),i.updateMatrixWorld()}(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var a;(a=this._input)===null||a===void 0||a.disconnect()}};Co.PluginType="ParallaxCameraControllerPlugin",ka([(0,V.onChange)(Hs.prototype._onEnabledChange),ae(),Ot("Enabled")],Co.prototype,"enabled",void 0),ka([ae(),Ot("enableEdit")],Co.prototype,"enableEdit",void 0),ka([ae(),Ot("Invert")],Co.prototype,"invert",void 0),ka([ae(),ai("Sensitivity",[.1,2],.01)],Co.prototype,"sensitivity",void 0),ka([ae("focalPoint"),Mn("Focal Point Hit",void 0,.001)],Co.prototype,"focalPointHit",void 0),ka([(0,V.onChange)(Hs.prototype._onDampingChange),ae(),ai("Damping",[0,1],.001)],Co.prototype,"damping",void 0),ka([ae(),Ci("Camera View")],Co.prototype,"cameraView",void 0),Co=Hs=ka([zi("Parallax Camera Controller")],Co);var Ac=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let rl=class extends Si{addNoiseBumpMaterial(a){return By(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new gg(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._uniforms={noiseBumpParams:{value:new p.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new p.Ltg(0,1,3,0)},flakeFallOffParams:{value:new p.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&!((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||t===void 0)&&t.hasBump?bo+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(a,e,t)=>{var i;if(!this.enabled||!(!((i=e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump))return;const r="#glMarker beforeAccumulation";a.fragmentShader=a.fragmentShader.replace(r,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+r),a.defines.USE_UV="",a.extensionDerivatives=!0},onObjectRender:(a,e)=>{var t;const i=(t=e.materialObject.userData)===null||t===void 0?void 0:t._noiseBumpMat;if(!(i!=null&&i.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(i.bumpNoiseParams),this._uniforms.noiseBumpScale.value=i.bumpScale,this._uniforms.noiseBumpFlakeScale.value=i.flakeScale,this._uniforms.noiseFlakeClamp.value=i.flakeClamp,this._uniforms.noiseFlakeRadius.value=i.flakeRadius,i.flakeParams&&this._uniforms.flakeParams.value.copy(i.flakeParams),i.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(i.flakeFallOffParams),this._uniforms.useColorFlakes.value=i.useColorFlakes;const r=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==r&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||t===void 0)&&t.hasBump?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.hasBump)||!1},set value(i){var r,s;i!==((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0?void 0:r.hasBump)&&(i?By(a.materialObject)||e.alert("Cannot add noise bump."):a.materialObject.userData._noiseBumpMat&&(a.materialObject.userData._noiseBumpMat.hasBump=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var i;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeParams,"x"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeParams,"y"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeParams,"z"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeParams,"w"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var i;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var r;return!(!((r=a.materialObject.userData._noiseBumpMat)===null||r===void 0)&&r.hasBump)},property:[(i=a.materialObject.userData._noiseBumpMat)===null||i===void 0?void 0:i.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var i;return!(!((i=a.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)},property:[a.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(hE)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function By(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.useColorFlakes===void 0&&(t.useColorFlakes=!1),t.flakeParams===void 0&&(t.flakeParams=new p.Ltg(0,1,3,0)),t.flakeFallOffParams===void 0&&(t.flakeFallOffParams=new p.Pa4(0,1,0)),a.isMaterial&&(a.needsUpdate=!0),!0}rl.PluginType="NoiseBumpMaterialPlugin",rl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",Ac([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],rl.prototype,"enabled",void 0),rl=Ac([zi("NoiseBump Materials")],rl);class gg{constructor(e){this.parser=e,this.name=rl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.userData||(t.userData={}),By(t),t.userData._noiseBumpMat=br(r,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const hE=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const i=cr(e.userData._noiseBumpMat,!1);t.extensions[rl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=i,a.extensionsUsed[rl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class ow extends On{constructor(e,t){super({vertexShader:Ke.vertexShader,fragmentShader:t+`
`+Tf+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if HAS_VELOCITY_BUFFER == 0
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
#else
vec3 c_frag=vec3(0.);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{
#if HAS_VELOCITY_BUFFER == 0
float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,vUv).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new p.FM8},cameraNearFar:{value:new p.FM8},lastProjectionViewMatrix:{value:new p.yGw},currentProjectionViewMatrix:{value:new p.yGw},projection:{value:new p.yGw},inverseViewMatrix:{value:new p.yGw},jitterSample:{value:new p.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new p.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,i,r,s){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const o=this.uniforms.tVelocity.value?1:0;o!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=o,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,i,r,s),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ae(),Qe()],ow.prototype,"feedBack",void 0);class Zf extends qa{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[vr],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(As))throw"Add ProgressivePlugin before TAA";const t=new ow(e.getPlugin(As).lastFrame,e.getPlugin(vr).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,i=this._pass.passObject;if(i.taaEnabled=t<=1&&e.scene.renderCamera===e.scene.activeCamera,!i.taaEnabled)return!1;const r=e.scene.renderCamera;return i.updateShaderProperties([e.getPlugin(vr),r,e.getPluginByType("VelocityBuffer")]),i.target=e.getPlugin(As).lastFrame,i.updateCameraProperties(r==null?void 0:r.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.renderer.stableNoise)!==null&&t!==void 0?t:this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var e;const t=(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig;if(t&&t.children)return t.children.includes(this._stableNoiseConfig)||t.children.push(this._stableNoiseConfig),t}}Zf.PluginType="TAA";var wc=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Mo=class extends Si{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=a=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(a){var e;if(this.isFullScreen())return;const t=a||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return t?(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(a){return this.isFullScreen()?this.exit():this.enter(a)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Mo.PluginType="FullScreenPlugin",wc([Xi("Enter FullScreen")],Mo.prototype,"enter",null),wc([Xi("Exit FullScreen")],Mo.prototype,"exit",null),wc([Xi("Toggle FullScreen")],Mo.prototype,"toggle",null),Mo=wc([zi("Full Screen")],Mo);const Oy=(a,e)=>{const t={};for(const i of a.mappings)for(const r of i.variants)t[e[r]]={material:null,gltfMaterialIndex:i.material};return t},vp="KHR_materials_variants";class Ly{constructor(e){this.parser=e,this.name=vp}async afterRoot(e){const t=this.parser,i=t.json;if(!i.extensions||!i.extensions[this.name])return;const r=(s=>{const o=[],l=new Set;for(const u of s){let h=u,f=0;for(;l.has(h);)h=u+"."+ ++f;l.add(h),o.push(h)}return o})((i.extensions[this.name].variants||[]).map(s=>s.name));for(const s of e.scenes)s.traverse(o=>{const l=t.associations.get(o);if(!l||l.meshes===void 0||l.primitives===void 0)return;const u=i.meshes[l.meshes].primitives[l.primitives].extensions;u&&u[this.name]&&(o.userData._variantMaterials=Oy(u[this.name],r))});await Promise.all(e.scenes.map(async s=>{const o=[];return s.traverse(l=>{return(u=l).material!==void 0&&u.userData&&u.userData._variantMaterials&&o.push((async h=>{const f=h.material,g=h.userData._variantMaterials,_=[];for(const A in g){const x=g[A];if(x.material)continue;const E=x.gltfMaterialIndex;_.push(t.getDependency("material",E).then(T=>{h.material=T,t.assignFinalMaterial(h),g[A].material=h.material}))}return Promise.all(_).then(()=>{h.material=f})})(l));var u}),s.userData.__importData||(s.userData.__importData={}),s.userData.__importData[vp]={names:r},Promise.all(o)}))}}const y0=a=>a.material!==void 0&&a.userData&&a.userData._variantMaterials&&!!Object.values(a.userData._variantMaterials).filter(e=>b0(e==null?void 0:e.material)),b0=a=>a&&a.isMaterial&&!Array.isArray(a);class ky{constructor(e){this.writer=e,this.name=vp,this.variantNames=[]}beforeParse(e){const t=new Set;for(const i of e)i.traverse(r=>{if(!y0(r))return;const s=r.userData._variantMaterials;for(const o in s){const l=s[o];b0(l.material)&&t.add(o)}});t.forEach(i=>this.variantNames.push(i))}writeMesh(e,t){var i;if(!y0(e))return;const r=e.userData,s=r._variantMaterials,o={};for(const h in s){const f=s[h].material;if(!b0(f))continue;const g=this.variantNames.indexOf(h),_=this.writer.processMaterial(f);o[_]||(o[_]={material:_,variants:[]}),o[_].variants.push(g)}const l=Object.values(o).map(h=>h.variants.sort((f,g)=>f-g)&&h).sort((h,f)=>h.material-f.material);if(l.length===0)return;const u=b0(r._originalMaterial)&&(i=this.writer.processMaterial(r._originalMaterial))!==null&&i!==void 0?i:-1;for(const h of t.primitives)u>=0&&(h.material=u),h.extensions=h.extensions||{},h.extensions[this.name]={mappings:l}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const i=this.variantNames.map(r=>({name:r}));t.extensions[this.name]={variants:i},this.writer.extensionsUsed[this.name]=!0}}function A0(a){return new ky(a)}class xc extends Si{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Ut],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var t,i;const r=e.object;(r==null?void 0:r.assetType)==="model"&&r.modelObject&&this._viewer&&(r.modelObject.traverse(s=>{var o,l,u,h,f;if(s.userData._variantMaterials)for(const A of Object.values(s.userData._variantMaterials))A!=null&&A.material&&(A.material=((u=(l=(o=this._viewer)===null||o===void 0?void 0:o.getManager())===null||l===void 0?void 0:l.materials)===null||u===void 0?void 0:u.processMaterial(A.material,{}))||A.material);const g=(f=(h=s.userData)===null||h===void 0?void 0:h.__importData)===null||f===void 0?void 0:f[vp];if(!g)return;const _=g.names||[];for(const A of _)this.variants[A]||(this.variants[A]=[]),this.variants[A].push(s);delete s.userData.__importData[vp]}),(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var t,i,r,s;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const o=e.getPlugin(Ut);(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(A0)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new Ly(t))}async onRemove(e){var t,i,r,s,o,l;e.scene.removeEventListener("addSceneObject",this._objectAdded);const u=e.getPlugin(Ut);(t=u.importer)===null||t===void 0||t.removeEventListener("loaderCreate",this._loaderCreate);const h=(s=(r=(i=u.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0?void 0:s.indexOf(A0);return h!==void 0&&h!==-1&&((l=(o=u.exporter.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||l===void 0||l.splice(h,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,i,r=!0){if(!t&&!i&&this.selectedVariant===e||!e)return;i||(this.selectedVariant=e);const s=i?Array.isArray(i)?i:[i]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const o of s){const l=new Set,u=h=>{var f,g;if(!h.userData._variantMaterials||l.has(h))return;const _=e?(f=h.userData._variantMaterials[e])===null||f===void 0?void 0:f.material:h.userData._originalMaterial;_&&(h.userData._originalMaterial||(h.userData._originalMaterial=h.material),(g=h==null?void 0:h.setMaterial)===null||g===void 0||g.call(h,_)),l.add(h)};r?o.traverse(u):u(o)}}}xc.PluginType="GLTFKHRMaterialVariantsPlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([(0,V.onChange)(xc.prototype._variantChanged)],xc.prototype,"selectedVariant",void 0);function vg(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),a.isMaterial&&(a.needsUpdate=!0),!0}let w0=class extends On{constructor(a,e,t,i){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new p.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},dpr:{value:1},cameraPositionWorld:{value:new p.Pa4(1,1,1)}},vertexShader:Pn,fragmentShader:`

            ${t}

            ${bo}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;uniform float dpr;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.*dpr;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,s,o)=>{var l,u;this.enabled&&!((u=(l=s.materialObject.userData)===null||l===void 0?void 0:l._ssBevel)===null||u===void 0)&&u.hasSSBevel&&(r.fragmentShader=Mi(r.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(r,s,o)=>{var l,u;if(!this.enabled||!(!((u=(l=s.materialObject.userData)===null||l===void 0?void 0:l._ssBevel)===null||u===void 0)&&u.hasSSBevel))return;const h=s.materialObject,f=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==f&&(this.materialExtension.extraUniforms.tSSBevelMap.value=f,h.needsUpdate=!0)},getUiConfig:r=>{const s={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=r.materialObject.userData._ssBevel)===null||o===void 0?void 0:o.hasSSBevel)||!1},set value(o){var l,u;o!==((l=r.materialObject.userData._ssBevel)===null||l===void 0?void 0:l.hasSSBevel)&&(o?vg(r.materialObject)||alert("Cannot add screen space bevel."):r.materialObject.userData._ssBevel&&(r.materialObject.userData._ssBevel.hasSSBevel=!1,r.materialObject.needsUpdate=!0),(u=s.uiRefresh)===null||u===void 0||u.call(s,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var o;return!(!((o=r.materialObject.userData._ssBevel)===null||o===void 0)&&o.hasSSBevel)},property:[r.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return s},parsFragmentSnippet:(r,s)=>{var o,l;return this.enabled&&!((l=(o=s==null?void 0:s.materialObject.userData)===null||o===void 0?void 0:o._ssBevel)===null||l===void 0)&&l.hasSSBevel?V.glsl`
            uniform sampler2D tSSBevelMap;
            ${Lm}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:r=>{var s,o;return(this.enabled?"1":"0")+(!((o=(s=r.materialObject.userData)===null||s===void 0?void 0:s._ssBevel)===null||o===void 0)&&o.hasSSBevel?"1":"0")},isCompatible:r=>r.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=i,this._edgeMaterial=new Yl({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new p.FM8(1,1)},cameraPositionWorld:{value:new p.Pa4(1,1,1)}},vertexShader:Pn,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new Yl({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new p.FM8(.5,.5)},direction:{value:new p.FM8(.5,.5)}},vertexShader:Pn,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(a,e,t,i,r){var s,o;if(!this.enabled)return;const l=a.baseRenderer,u={minFilter:p.wem,magFilter:p.wem,isAntialiased:!1,format:p.wk1,depthBuffer:!1,generateMipmaps:!1},h=l.getTempTarget(u);this._renderEdges(l,h),this._blurEdges(l,h),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(s=this._viewerApp.getPlugin(vr))===null||s===void 0||s.updateShaderProperties(this.material),(o=this._viewerApp.getPlugin(Rh))===null||o===void 0||o.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=h.texture,this.uniforms.dpr.value=this._viewerApp.renderer.displayCanvasScaling,super.render(a,this._target,h,i,r),l.releaseTempTarget(h)}_initsamples(){const a=[];return a.push(new p.FM8(-8,0).multiplyScalar(.125)),a.push(new p.FM8(-6,-4).multiplyScalar(.125)),a.push(new p.FM8(-3,-2).multiplyScalar(.125)),a.push(new p.FM8(-2,-6).multiplyScalar(.125)),a.push(new p.FM8(1,-1).multiplyScalar(.125)),a.push(new p.FM8(2,-5).multiplyScalar(.125)),a.push(new p.FM8(6,-7).multiplyScalar(.125)),a.push(new p.FM8(5,-3).multiplyScalar(.125)),a.push(new p.FM8(4,1).multiplyScalar(.125)),a.push(new p.FM8(7,4).multiplyScalar(.125)),a.push(new p.FM8(3,5).multiplyScalar(.125)),a.push(new p.FM8(0,7).multiplyScalar(.125)),a.push(new p.FM8(-1,3).multiplyScalar(.125)),a.push(new p.FM8(-4,6).multiplyScalar(.125)),a.push(new p.FM8(-7,8).multiplyScalar(.125)),a.push(new p.FM8(-5,2).multiplyScalar(.125)),a}_blurEdges(a,e){var t,i;const r={minFilter:p.wem,magFilter:p.wem,isAntialiased:!1,format:p.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},s=a.getTempTarget(r),o=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,l=((i=e.texture.image)===null||i===void 0?void 0:i.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new p.FM8(o,l),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new p.FM8(1,0),a.blit(void 0,s,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new p.FM8(o/2,l/2),this._separableBlurMaterial.uniforms.colorTexture.value=s.texture,this._separableBlurMaterial.uniforms.direction.value=new p.FM8(0,1),a.blit(void 0,e,{material:this._separableBlurMaterial}),a.releaseTempTarget(s)}_renderEdges(a,e){var t,i,r,s;const o=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,l=((i=e.texture.image)===null||i===void 0?void 0:i.height)||1;this._edgeMaterial.uniforms.screenSize.value=new p.FM8(o,l),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(r=this._viewerApp.getPlugin(vr))===null||r===void 0||r.updateShaderProperties(this._edgeMaterial),(s=this._viewerApp.getPlugin(Rh))===null||s===void 0||s.updateShaderProperties(this._edgeMaterial),a.blit(void 0,e,{material:this._edgeMaterial})}};w0=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([zi("SSBevel")],w0);class Ec extends qa{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Ut,vr,Rh],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new dE(t))}passCtor(e){var t,i;return this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:p.cLu,minFilter:p.TyD,magFilter:p.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,e.getPluginByType("debug"),new w0(e.renderer,this._bevelTarget,(i=(t=e.getPlugin(vr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&i!==void 0?i:"",e)}async onAdded(e){var t,i,r,s,o,l,u,h;await super.onAdded(e);const f=e.getPlugin(Ut);return!((t=this.pass)===null||t===void 0)&&t.passObject.materialExtension&&((i=f==null?void 0:f.materials)===null||i===void 0||i.registerMaterialExtension((r=this.pass)===null||r===void 0?void 0:r.passObject.materialExtension)),(s=f==null?void 0:f.importer)===null||s===void 0||s.addEventListener("loaderCreate",this._loaderCreate),(u=(l=(o=f==null?void 0:f.exporter)===null||o===void 0?void 0:o.getExporter("gltf","glb"))===null||l===void 0?void 0:l.extensions)===null||u===void 0||u.push(lw),(h=e.getPlugin(vr))===null||h===void 0||h.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,i,r;(e=this._viewer)===null||e===void 0||e.setDirty(),(r=(t=this.pass)===null||t===void 0?void 0:(i=t.passObject.materialExtension).setDirty)===null||r===void 0||r.call(i)}_update(e){var t,i;let r=this.enabled;if(r&&!this._lastEnabled){const s=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("NormalBufferPlugin");s&&!s.enabled&&(s.enabled=!0),s||(i=this._viewer)===null||i===void 0||i.console.error("SSBevelPlugin needs NormalBufferPlugin")}return this._lastEnabled=r,r}get uiConfig(){var e,t,i,r,s;const o=(i=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&i!==void 0?i:{};return(s=(r=o.children)===null||r===void 0?void 0:r.map(l=>(0,V.getOrCall)(l)))===null||s===void 0||s.flat(2).forEach(l=>l&&(l.onChange=this.setDirty)),o}updateGBuffer(e,t){var i,r,s;if(e instanceof p.Kj0&&!((i=e.material)===null||i===void 0)&&i.userData){for(let l=3;l<8;l++)t.y=V_(t.y,l);let o=!((r=e.material)===null||r===void 0)&&r.userData._ssBevel?(s=e.material)===null||s===void 0?void 0:s.userData._ssBevel.radius:0;o=Math.min(o,31),o<<=3,t.y=t.y|o}}}Ec.PluginType="SSBevelPlugin",Ec.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class dE{constructor(e){this.parser=e,this.name=Ec.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.userData||(t.userData={}),vg(t),t.userData._ssBevel=br(r,t.userData._ssBevel,!1,{}),Promise.resolve()}}const lw=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const i=cr(e.userData._ssBevel,!1);t.extensions[Ec.SSBEVEL_GLTF_EXTENSION]=i,a.extensionsUsed[Ec.SSBEVEL_GLTF_EXTENSION]=!0}});class Uy{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,i){this.enabled&&(e.fragmentShader=Mi(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class x0 extends Zc{generateExtension(e){return new Uy}}x0.PluginType="GammaCorrection";var Ny=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let To=class extends Si{addTriplanarMapping(a){var e;const t=(e=a.materialObject)===null||e===void 0?void 0:e.userData;return!!t&&(t._triplanarMapping||(t._triplanarMapping={}),t._triplanarMapping.enable=!0,t._triplanarMapping.scaleFactor===void 0&&(t._triplanarMapping.scaleFactor=1),t._triplanarMapping.blendFactor===void 0&&(t._triplanarMapping.blendFactor=1),t._triplanarMapping.offsetFactor===void 0&&(t._triplanarMapping.offsetFactor=0),a.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new E0(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(a,e,t)=>{var i,r;if(!this.enabled||!(!((r=(i=e.materialObject.userData)===null||i===void 0?void 0:i._triplanarMapping)===null||r===void 0)&&r.enable))return;const s=V.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.vertexShader=Mi(a.vertexShader,"#include <common>",s,{prepend:!0});const o=V.glsl`
                // same as worldpos_vertex.glsl.js but added a !
                #if !(defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0)
                vec4 worldPosition = vec4( transformed, 1.0 );
                #ifdef USE_INSTANCING
                worldPosition = instanceMatrix * worldPosition;
                #endif
                worldPosition = modelMatrix * worldPosition;
                #endif
                
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz; 
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;a.vertexShader=Mi(a.vertexShader,"#include <worldpos_vertex>",o,{append:!0});const l=V.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;a.fragmentShader=Mi(a.fragmentShader,"#include <common>",l,{prepend:!0});const u=V.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;a.fragmentShader=Mi(a.fragmentShader,"#include <bumpmap_pars_fragment>",u);let h=Mi(p.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");a.fragmentShader=Mi(a.fragmentShader,"#include <map_fragment>",h),h=Mi(p.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=Mi(a.fragmentShader,"#include <roughnessmap_fragment>",h),h=Mi(p.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),a.fragmentShader=Mi(a.fragmentShader,"#include <metalnessmap_fragment>",h),h=Mi(p.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),a.fragmentShader=Mi(a.fragmentShader,"#include <normal_fragment_maps>",h),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t,i,r,s;const o=e.materialObject.userData;if(!(!((t=o==null?void 0:o._triplanarMapping)===null||t===void 0)&&t.enable))return;const l=a;l.isMesh&&l.geometry&&(this._uniforms.triplanarScale.value=(i=o._triplanarMapping)===null||i===void 0?void 0:i.scaleFactor,this._uniforms.triplanarBlend.value=(r=o._triplanarMapping)===null||r===void 0?void 0:r.blendFactor,this._uniforms.triplanarOffset.value=(s=o._triplanarMapping)===null||s===void 0?void 0:s.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._triplanarMapping)===null||t===void 0)&&t.enable?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)===null||a===void 0?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.addTriplanarMapping,i={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var r;return((r=a.materialObject.userData._triplanarMapping)===null||r===void 0?void 0:r.enable)||!1},set value(r){var s,o;r!==((s=a.materialObject.userData._triplanarMapping)===null||s===void 0?void 0:s.enable)&&(r?t(a)||e.alert("Cannot add Triplanar mapping."):a.materialObject.userData._triplanarMapping&&(a.materialObject.userData._triplanarMapping.enable=!1,a.materialObject.needsUpdate=!0),(o=i.uiRefresh)===null||o===void 0||o.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var r;return!(!((r=a.materialObject.userData._triplanarMapping)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var r;return!(!((r=a.materialObject.userData._triplanarMapping)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var r;return!(!((r=a.materialObject.userData._triplanarMapping)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(Fy)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};To.PluginType="TriplanarUVMappingPlugin",To.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",Ny([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],To.prototype,"enabled",void 0),To=Ny([zi("Triplanar Mapping")],To);class E0{constructor(e){this.parser=e,this.name=To.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];t.userData||(t.userData={});const s=t.userData;return s._triplanarMapping||(s._triplanarMapping={}),s._triplanarMapping.enable=!0,s._triplanarMapping.scaleFactor===void 0&&(s._triplanarMapping.scaleFactor=1),s._triplanarMapping.blendFactor===void 0&&(s._triplanarMapping.blendFactor=1),s._triplanarMapping.offsetFactor===void 0&&(s._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=br(r,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const Fy=a=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!(!((i=e.userData._triplanarMapping)===null||i===void 0)&&i.enable))return;t.extensions=t.extensions||{};const r=cr(e.userData._triplanarMapping,!1);t.extensions[To.TRIPLANAR_GLTF_EXTENSION]=r,a.extensionsUsed[To.TRIPLANAR_GLTF_EXTENSION]=!0}});var jy=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ll=class extends Si{addLayeredMaterial(a){var e;const t=(e=a.materialObject)===null||e===void 0?void 0:e.userData;return!!t&&(t._layeredMaterial||(t._layeredMaterial={}),t._layeredMaterial.enable=!0,t._layeredMaterial.cutoff===void 0&&(t._layeredMaterial.cutoff=-.65),t._layeredMaterial.cavityColor===void 0&&(t._layeredMaterial.cavityColor=new p.Ilk(5789527)),t._layeredMaterial.cavityRoughness===void 0&&(t._layeredMaterial.cavityRoughness=.5),t._layeredMaterial.cavityMetalness===void 0&&(t._layeredMaterial.cavityMetalness=.5),t._layeredMaterial.cavityScale===void 0&&(t._layeredMaterial.cavityScale=1),t._layeredMaterial.stepSize===void 0&&(t._layeredMaterial.stepSize=5),a.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new pE(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._uniforms={cutoff:{value:0},cavityColor:{value:new p.Ilk},cavityRoughness:{value:0},cavityMetalness:{value:0},cavityScale:{value:1},stepSize:{value:1}},this.materialExtension={shaderExtender:(a,e,t)=>{var i,r;if(!this.enabled||!(!((r=(i=e.materialObject.userData)===null||i===void 0?void 0:i._layeredMaterial)===null||r===void 0)&&r.enable))return;const s=V.glsl`
                ${"uniform float cutoff;uniform vec3 cavityColor;uniform float cavityRoughness;uniform float cavityMetalness;uniform float cavityScale;uniform float stepSize;uniform sampler2D cavityMap;float getSSCurvature(in vec3 position,in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-stepSize*dx;vec3 xpos=n+stepSize*dx;vec3 yneg=n-stepSize*dy;vec3 ypos=n+stepSize*dy;float depth=length(position);float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x)*4./depth;return curvature;}"}
            `;a.fragmentShader=Mi(a.fragmentShader,"#include <common>",s,{prepend:!0});const o=V.glsl`
                material.roughness = min( material.roughness, 1.0 );
                float curvature = getSSCurvature(vViewPosition, normal);
                float smoothCurvature = smoothstep(0., 1., curvature - cutoff);
                material.roughness = min( material.roughness, 1.0 );
                curvature = curvature * cavityScale;
                smoothCurvature = smoothCurvature * cavityScale;
                smoothCurvature = min(smoothCurvature, 1.);
                vec3 finalCavityColor = mix(cavityColor, cavityColor*0.5, vec3(smoothCurvature));
                material.roughness = mix(cavityRoughness, material.roughness, smoothCurvature);
                material.diffuseColor = mix(finalCavityColor, material.diffuseColor, smoothCurvature);
            `,l=V.glsl`
                material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
                material.specularColor = mix(material.specularColor, finalCavityColor, (1. - smoothCurvature) * cavityMetalness);
            `;let u=p.WdD.lights_physical_fragment.replace("material.roughness = min( material.roughness, 1.0 );",o);u=u.replace("material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );",l),a.fragmentShader=Mi(a.fragmentShader,"#include <lights_physical_fragment>",u);const h=V.glsl`
                vec3 debugCurvatureColor = vec3(0., 0., 1.);
                float _epsilon = 1e-4;
                vec3 green = vec3(0., 0., 0.);
                vec3 red = vec3(1., 1., 1.);
                //if(curvature > cutoff)debugCurvatureColor = green;
                //if(curvature < cutoff)debugCurvatureColor = red;
                // curvature /= 2.;
                // curvature = curvature * 0.5 + 0.5;
                debugCurvatureColor = smoothstep(green, red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(green, vec3(curvature - cutoff));
                //gl_FragColor = vec4(vec3(curvature), 1./16.);
            `;a.fragmentShader=Mi(a.fragmentShader,"#include <dithering_fragment>",h),a.vertexUvs=!0},onObjectRender:(a,e)=>{var t,i,r,s,o,l,u;const h=e.materialObject.userData;if(!(!((t=h==null?void 0:h._layeredMaterial)===null||t===void 0)&&t.enable))return;const f=a;f.isMesh&&f.geometry&&(this._uniforms.cutoff.value=(i=h._layeredMaterial)===null||i===void 0?void 0:i.cutoff,this._uniforms.cavityRoughness.value=(r=h._layeredMaterial)===null||r===void 0?void 0:r.cavityRoughness,this._uniforms.cavityMetalness.value=(s=h._layeredMaterial)===null||s===void 0?void 0:s.cavityMetalness,this._uniforms.cavityScale.value=(o=h._layeredMaterial)===null||o===void 0?void 0:o.cavityScale,this._uniforms.stepSize.value=(l=h._layeredMaterial)===null||l===void 0?void 0:l.stepSize,this._uniforms.cavityColor.value.copy((u=h._layeredMaterial)===null||u===void 0?void 0:u.cavityColor))},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._layeredMaterial)===null||t===void 0)&&t.enable?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>{var a;return[(a=this._viewer)===null||a===void 0?void 0:a.renderer]},getUiConfig:a=>{const e=this._viewer,t=this.addLayeredMaterial,i={type:"folder",label:"LayeredMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var r;return((r=a.materialObject.userData._layeredMaterial)===null||r===void 0?void 0:r.enable)||!1},set value(r){var s,o;r!==((s=a.materialObject.userData._layeredMaterial)===null||s===void 0?void 0:s.enable)&&(r?t(a)||e.alert("Cannot add Triplanar mapping."):(a.materialObject.userData._layeredMaterial.enable=!1,a.materialObject.needsUpdate=!0),(o=i.uiRefresh)===null||o===void 0||o.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[-1,1],stepSize:.001,label:"cutoff",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"cutoff"],onChange:this.setDirty}),()=>({type:"color",label:"color",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"cavityColor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"roughness",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"cavityRoughness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,20],stepSize:.01,label:"Scale",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"cavityScale"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,100],stepSize:.01,label:"StepSize",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"stepSize"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"metalness",hidden:()=>{var r;return!(!((r=a.materialObject.userData._layeredMaterial)===null||r===void 0)&&r.enable)},property:[a.materialObject.userData._layeredMaterial,"cavityMetalness"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var a;(a=this._viewer)===null||a===void 0||a.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(fE)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};Ll.PluginType="LayeredMaterialPlugin",Ll.LAYERED_MATERIAL_GLTF_EXTENSION="WEBGI_materials_layered",jy([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],Ll.prototype,"enabled",void 0),Ll=jy([zi("Layered Metal")],Ll);class pE{constructor(e){this.parser=e,this.name=Ll.LAYERED_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];t.userData||(t.userData={});const s=t.userData;return s._layeredMaterial||(s._layeredMaterial={}),s._layeredMaterial.enable=!0,t.userData._layeredMaterial=br(r,t.userData._layeredMaterial,!1,{}),Promise.resolve()}}const fE=a=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!(!((i=e.userData._layeredMaterial)===null||i===void 0)&&i.enable))return;t.extensions=t.extensions||{};const r=cr(e.userData._layeredMaterial,!1);t.extensions[Ll.LAYERED_MATERIAL_GLTF_EXTENSION]=r,a.extensionsUsed[Ll.LAYERED_MATERIAL_GLTF_EXTENSION]=!0}});var zy=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let nl=class extends Si{addClearcoatTint(a){return Vy(a.materialObject)}_loaderCreate({loader:a}){a.isGLTFLoader2&&a.register(e=>new S0(e))}constructor(){super(),this.enabled=!0,this.dependencies=[Ut],this._defines={},this._uniforms={ccTintColor:{value:new p.Ilk},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(a,e)=>{var t;return this.enabled&&!((t=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||t===void 0)&&t.enableTint&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(a,e,t)=>{var i;if(!(this.enabled&&!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint&&e.materialObject.clearcoat>0))return;const r="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",s="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";a.fragmentShader.includes(s)&&a.fragmentShader.includes(r)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),a.fragmentShader=a.fragmentShader.replace(s,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),a.fragmentShader=a.fragmentShader.replace(r,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+r),a.defines.USE_UV=""},onObjectRender:(a,e)=>{var t;const i=(t=e.materialObject.userData)===null||t===void 0?void 0:t._clearcoatTint;if(!(i!=null&&i.enableTint))return;this._uniforms.ccTintColor.value.set(i.tintColor),this._uniforms.ccThickness.value=i.thickness,this._uniforms.ccIor.value=i.ior;const r=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==r&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:a=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=a.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||t===void 0)&&t.enableTint?"1":"0")+(a.materialObject.clearcoat>0?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:a=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=a.materialObject.userData._clearcoatTint)===null||i===void 0?void 0:i.enableTint)||!1},set value(i){var r,s;i!==((r=a.materialObject.userData._clearcoatTint)===null||r===void 0?void 0:r.enableTint)&&(i?Vy(a.materialObject)||e.alert("Cannot add clearcoat tint."):a.materialObject.userData._clearcoatTint&&(a.materialObject.userData._clearcoatTint.enableTint=!1,a.materialObject.needsUpdate=!0),(s=t.uiRefresh)===null||s===void 0||s.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var i;return!(!((i=a.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)},property:[a.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var i;return!(!((i=a.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)},property:[a.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var i;return!(!((i=a.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)},property:[a.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var a,e,t;(e=(a=this.materialExtension).setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(a){var e,t,i,r,s;await super.onAdded(a);const o=a.getPlugin(Ut);(e=o==null?void 0:o.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=o==null?void 0:o.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(s=(r=(i=o==null?void 0:o.exporter)===null||i===void 0?void 0:i.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||s===void 0||s.push(Gy)}async onRemove(a){var e,t,i,r;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(i=a.getPlugin(Ut))===null||i===void 0?void 0:i.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(a)}};function Vy(a){const e=a==null?void 0:a.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),a.isMaterial&&(a.needsUpdate=!0),!0}nl.PluginType="ClearcoatTintPlugin",nl.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",zy([Ot("Enabled",a=>({onChange:a.setDirty})),ae()],nl.prototype,"enabled",void 0),nl=zy([zi("ClearcoatTint Materials")],nl);class S0{constructor(e){this.parser=e,this.name=nl.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.userData||(t.userData={}),Vy(t),br(r,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const Gy=a=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const i=cr(e.userData._clearcoatTint,!1);t.extensions[nl.CLEARCOAT_TINT_GLTF_EXTENSION]=i,a.extensionsUsed[nl.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class mE{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=i,this.workers[r].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const gE=0,vE=2;class cw{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Jf{constructor(e,t,i,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,r)}}const xs=[171,75,84,88,32,50,48,187,13,10,26,10];function uw(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}let C0,nu,Xu;const M0={env:{emscripten_notify_memory_growth:function(a){Xu=new Uint8Array(nu.exports.memory.buffer)}}};class _E{init(){return C0||(C0=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Gh).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,M0)).then(this._init):WebAssembly.instantiate(Buffer.from(Gh,"base64"),M0).then(this._init),C0)}_init(e){nu=e.instance,M0.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!nu)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,r=nu.exports.malloc(i);Xu.set(e,r),t=t||Number(nu.exports.ZSTD_findDecompressedSize(r,i));const s=nu.exports.malloc(t),o=nu.exports.ZSTD_decompress(s,t,r,i),l=Xu.slice(s,s+o);return nu.exports.free(r),nu.exports.free(s),l}}const Gh="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Hy=new WeakMap;let T0,qu=0;class Sc extends p.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new mE,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new p.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new p.hH6(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const r=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([s,o])=>{const l=Sc.BasisWorker,u=["/* constants */","let _EngineFormat = "+JSON.stringify(Sc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Sc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Sc.BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),f=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:f},[f]),h})}),qu>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),qu++}return this.transcoderPending}load(e,t,i,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new p.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(Hy.has(o))return Hy.get(o).promise.then(t).catch(r);this.createTexture(o).then(l=>t?t(l):null).catch(r)},i,r)}_createTextureFrom(e,t){const{faces:i,width:r,height:s,format:o,type:l,error:u,dfdTransferFn:h,dfdFlags:f}=e;if(l==="error")return Promise.reject(u);let g;if(t.faceCount===6)g=new p.EB7,g.image=i,g.format=o,g.type=p.ywz;else{const _=i[0].mipmaps;g=t.layerCount>1?new p.Z_g(_,r,s,t.layerCount,o,p.ywz):new p.EB7(_,r,s,o,p.ywz)}return g.minFilter=i[0].mipmaps.length===1?p.wem:p.D1R,g.magFilter=p.wem,g.generateMipmaps=!1,g.needsUpdate=!0,g.colorSpace=h===2?p.KI_:p.aCh,g.premultiplyAlpha=!!(1&f),g}async createTexture(e,t={}){const i=function(o){const l=new Uint8Array(o.buffer,o.byteOffset,xs.length);if(l[0]!==xs[0]||l[1]!==xs[1]||l[2]!==xs[2]||l[3]!==xs[3]||l[4]!==xs[4]||l[5]!==xs[5]||l[6]!==xs[6]||l[7]!==xs[7]||l[8]!==xs[8]||l[9]!==xs[9]||l[10]!==xs[10]||l[11]!==xs[11])throw new Error("Missing KTX 2.0 identifier.");const u=new cw,h=17*Uint32Array.BYTES_PER_ELEMENT,f=new Jf(o,xs.length,h,!0);u.vkFormat=f._nextUint32(),u.typeSize=f._nextUint32(),u.pixelWidth=f._nextUint32(),u.pixelHeight=f._nextUint32(),u.pixelDepth=f._nextUint32(),u.layerCount=f._nextUint32(),u.faceCount=f._nextUint32();const g=f._nextUint32();u.supercompressionScheme=f._nextUint32();const _=f._nextUint32(),A=f._nextUint32(),x=f._nextUint32(),E=f._nextUint32(),T=f._nextUint64(),R=f._nextUint64(),I=new Jf(o,xs.length+h,3*g*8,!0);for(let Tt=0;Tt<g;Tt++)u.levels.push({levelData:new Uint8Array(o.buffer,o.byteOffset+I._nextUint64(),I._nextUint64()),uncompressedByteLength:I._nextUint64()});const S=new Jf(o,_,A,!0),O={vendorId:S._skip(4)._nextUint16(),descriptorType:S._nextUint16(),versionNumber:S._nextUint16(),descriptorBlockSize:S._nextUint16(),colorModel:S._nextUint8(),colorPrimaries:S._nextUint8(),transferFunction:S._nextUint8(),flags:S._nextUint8(),texelBlockDimension:[S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8()],bytesPlane:[S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8()],samples:[]},k=(O.descriptorBlockSize/4-6)/4;for(let Tt=0;Tt<k;Tt++){const Xe={bitOffset:S._nextUint16(),bitLength:S._nextUint8(),channelType:S._nextUint8(),samplePosition:[S._nextUint8(),S._nextUint8(),S._nextUint8(),S._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Xe.channelType?(Xe.sampleLower=S._nextInt32(),Xe.sampleUpper=S._nextInt32()):(Xe.sampleLower=S._nextUint32(),Xe.sampleUpper=S._nextUint32()),O.samples[Tt]=Xe}u.dataFormatDescriptor.length=0,u.dataFormatDescriptor.push(O);const N=new Jf(o,x,E,!0);for(;N._offset<E;){const Tt=N._nextUint32(),Xe=N._scan(Tt),Zt=uw(Xe),di=N._scan(Tt-Xe.byteLength);u.keyValue[Zt]=Zt.match(/^ktx/i)?uw(di):di,N._offset%4&&N._skip(4-N._offset%4)}if(R<=0)return u;const H=new Jf(o,T,R,!0),X=H._nextUint16(),te=H._nextUint16(),re=H._nextUint32(),ue=H._nextUint32(),le=H._nextUint32(),se=H._nextUint32(),de=[];for(let Tt=0;Tt<g;Tt++)de.push({imageFlags:H._nextUint32(),rgbSliceByteOffset:H._nextUint32(),rgbSliceByteLength:H._nextUint32(),alphaSliceByteOffset:H._nextUint32(),alphaSliceByteLength:H._nextUint32()});const ve=T+H._offset,fe=ve+re,Ee=fe+ue,Je=Ee+le,Te=new Uint8Array(o.buffer,o.byteOffset+ve,re),qe=new Uint8Array(o.buffer,o.byteOffset+fe,ue),Ve=new Uint8Array(o.buffer,o.byteOffset+Ee,le),Ye=new Uint8Array(o.buffer,o.byteOffset+Je,se);return u.globalData={endpointCount:X,selectorCount:te,imageDescs:de,endpointsData:Te,selectorsData:qe,tablesData:Ve,extendedData:Ye},u}(new Uint8Array(e));if(i.vkFormat!==0){const o=[],l=[];for(let h=0;h<i.levels.length;h++)l.push(bE(i,h).then(function(f){o[h]=f}));await Promise.all(l);const u=o[0];return u.mipmaps=o.map(h=>({data:h.source.data,width:h.source.data.width,height:h.source.data.height,depth:h.source.data.depth})),u}const r=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(o=>this._createTextureFrom(o.data,i));return Hy.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),qu--,this}}Sc.BasisFormat={ETC1S:0,UASTC_4x4:1},Sc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Sc.EngineFormat={RGBAFormat:p.wk1,RGBA_ASTC_4x4_Format:p.ptH,RGBA_BPTC_Format:p.bsb,RGBA_ETC2_EAC_Format:p.ekQ,RGBA_PVRTC_4BPPV1_Format:p.eaV,RGBA_S3TC_DXT5_Format:p.ILR,RGB_ETC1_Format:p.fto,RGB_ETC2_Format:p.l0P,RGB_PVRTC_4BPPV1_Format:p._AM,RGB_S3TC_DXT1_Format:p.wuA},Sc.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { faces, buffers, width, height, hasAlpha, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						self.postMessage( { type: 'transcode', id: message.id, faces, width, height, hasAlpha, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layerCount = ktx2File.getLayers() || 1;
		const levelCount = ktx2File.getLevels();
		const faceCount = ktx2File.getFaces();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levelCount ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const faces = [];
		const buffers = [];

		for ( let face = 0; face < faceCount; face ++ ) {

			const mipmaps = [];

			for ( let mip = 0; mip < levelCount; mip ++ ) {

				const layerMips = [];

				let mipWidth, mipHeight;

				for ( let layer = 0; layer < layerCount; layer ++ ) {

					const levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );

					if ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {

						console.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );

					}

					if ( levelCount > 1 ) {

						mipWidth = levelInfo.origWidth;
						mipHeight = levelInfo.origHeight;

					} else {

						// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with
						// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.
						// See mrdoob/three.js#25908.
						mipWidth = levelInfo.width;
						mipHeight = levelInfo.height;

					}

					const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
					const status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );

					if ( ! status ) {

						cleanup();
						throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

					}

					layerMips.push( dst );

				}

				const mipData = concat( layerMips );

				mipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );
				buffers.push( mipData.buffer );

			}

			faces.push( { mipmaps, width, height, format: engineFormat } );

		}

		cleanup();

		return { faces, buffers, width, height, hasAlpha, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		if ( arrays.length === 1 ) return arrays[ 0 ];

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const hw={109:p.wk1,97:p.wk1,37:p.wk1,43:p.wk1,103:p.av9,83:p.av9,16:p.av9,22:p.av9,100:p.hEm,76:p.hEm,15:p.hEm,9:p.hEm},Yu={109:p.VzW,97:p.cLu,37:p.ywz,43:p.ywz,103:p.VzW,83:p.cLu,16:p.ywz,22:p.ywz,100:p.VzW,76:p.cLu,15:p.ywz,9:p.ywz},yE={43:p.KI_,22:p.KI_,15:p.KI_};async function bE(a,e=0){const{vkFormat:t}=a,i=Math.max(1,a.pixelWidth>>e),r=Math.max(1,a.pixelHeight>>e),s=Math.max(1,a.pixelDepth>>e);if(hw[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const o=a.levels[e];let l,u;if(a.supercompressionScheme===gE)l=o.levelData;else{if(a.supercompressionScheme!==vE)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");T0||(T0=new Promise(async f=>{const g=new _E;await g.init(),f(g)})),l=(await T0).decode(o.levelData,o.uncompressedByteLength)}u=Yu[t]===p.VzW?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):Yu[t]===p.cLu?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l;const h=s===0?new p.IEO(u,i,r):new p.JUT(u,i,r,s);return h.type=Yu[t],h.format=hw[t],h.colorSpace=yE[t]||p.aCh,h.needsUpdate=!0,Promise.resolve(h)}const I0="KHR_texture_basisu";class Hh extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut]}async onAdded(e){var t,i,r,s,o,l;this._importer||(this._importer=new Tn(class extends Sc{constructor(u){super(u),this.setTranscoderPath(Hh.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(u,h){const f=new Uint8Array(u.slice(0)),g=await super.createTexture(u,h);return g.source._sourceImgBuffer=f,g.userData.mimeType="image/ktx2",g.toJSON=_=>dn(g,_,g.name,"image/ktx2"),g.clone=()=>{throw new Error("ktx2 texture cloning not supported")},g}},["ktx2"],!1)),(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer),(l=(o=(s=(r=e.getManager())===null||r===void 0?void 0:r.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||l===void 0||l.push(AE)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,i;this._importer&&!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}Hh.PluginType="KTX2LoadPlugin",Hh.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const AE=a=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null)return void console.warn("ktx2 export: source already set");const i=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!i)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const r={},s=new Blob([i],{type:"image/ktx2"});r.source=a.processImageBlob(s,e),t.extensions[I0]=r,a.extensionsUsed[I0]=!0}});class Cc extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postRender)}addTexture(e,t,i,r,s,o="postRender",l=!1){var u;this._generators.has(o)||this._generators.set(o,[]),(u=this._generators.get(o))===null||u===void 0||u.push({key:e,fn:t,rect:i?[...i]:void 0,frag:s||r||l?new p.jyz({vertexShader:Ke.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:s??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${l?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${l?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${r??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var i,r;this._generators.set(t,(r=(i=this._generators.get(t))===null||i===void 0?void 0:i.filter(s=>s.key!==e))!==null&&r!==void 0?r:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const i=this._viewer,r=i==null?void 0:i.renderer;r&&i&&((t=this._generators.get(e))===null||t===void 0||t.forEach(({key:s,fn:o,rect:l,frag:u})=>{const h=o(i);if(h){if(h.image&&l){const f=h.image.width/h.image.height;l[2]<1&&l[3]<1&&(l[2]=200),l[2]<1&&(l[2]=l[3]*f),l[3]<1&&(l[3]=l[2]/f)}r.blit(h,void 0,{viewport:l,clear:!1,material:u})}}))}}Cc.PluginType="debug";class dw extends p.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=this.path===""?p.Zp0.extractUrlBase(e):this.path,l=new p.hH6(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{t(s.parse(u,o))}catch(h){r?r(h):console.error(h),s.manager.itemError(e)}},i,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const i=e.split(`
`);let r={};const s=/\s+/,o={};for(let u=0;u<i.length;u++){let h=i[u];if(h=h.trim(),h.length===0||h.charAt(0)==="#")continue;const f=h.indexOf(" ");let g=f>=0?h.substring(0,f):h;g=g.toLowerCase();let _=f>=0?h.substring(f+1):"";if(_=_.trim(),g==="newmtl")r={name:_},o[_]=r;else if(g==="ka"||g==="kd"||g==="ks"||g==="ke"){const A=_.split(s,3);r[g]=[parseFloat(A[0]),parseFloat(A[1]),parseFloat(A[2])]}else r[g]=_}const l=new wE(this.resourcePath||t,this.materialOptions);return l.setCrossOrigin(this.crossOrigin),l.setManager(this.manager),l.setMaterials(o),l}}class wE{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:p.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:p.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const i in e){const r=e[i],s={};t[i]=s;for(const o in r){let l=!0,u=r[o];const h=o.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(u=[u[0]/255,u[1]/255,u[2]/255]),this.options&&this.options.ignoreZeroRGBs&&u[0]===0&&u[1]===0&&u[2]===0&&(l=!1)}l&&(s[h]=u)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,i=this.materialsInfo[e],r={name:e,side:this.side};async function s(u,h){if(r[u])return;const f=t.getTextureParams(h,r);return new Promise((g,_)=>{let A=!1,x=()=>!A&&(A=!0)&&g();const E=t.loadTexture((T=t.baseUrl,typeof(R=f.url)!="string"||R===""?"":/^https?:\/\//i.test(R)?R:T+R),void 0,I=>{r[u]=I,x()},void 0,x);var T,R;setTimeout(x,50),E.repeat.copy(f.scale),E.offset.copy(f.offset),E.wrapS=t.wrap,E.wrapT=t.wrap,u!=="map"&&u!=="emissiveMap"||(E.colorSpace=p.KI_)})}const o=Array.from(Object.keys(i||{}));let l=o.includes("d")||o.includes("D");for(const u of o){const h=i[u];let f;if(h!=="")switch(u.toLowerCase()){case"kd":r.color=new p.Ilk().fromArray(h).convertSRGBToLinear();break;case"ks":r.specular=new p.Ilk().fromArray(h).convertSRGBToLinear();break;case"ke":r.emissive=new p.Ilk().fromArray(h).convertSRGBToLinear();break;case"map_kd":await s("map",h);break;case"map_ks":await s("specularMap",h);break;case"map_ke":await s("emissiveMap",h);break;case"norm":await s("normalMap",h);break;case"map_bump":case"bump":await s("bumpMap",h);break;case"map_d":await s("alphaMap",h),r.transparent=!0;break;case"ns":r.shininess=parseFloat(h);break;case"d":f=parseFloat(h),f<1&&(r.opacity=f,r.transparent=!0);break;case"tr":if(l)break;f=parseFloat(h),this.options&&this.options.invertTrProperty&&(f=1-f),f>0&&(r.opacity=1-f,r.transparent=!0)}}return this.materials[e]=new p.xoR(r),this.materials[e]}getTextureParams(e,t){const i={scale:new p.FM8(1,1),offset:new p.FM8(0,0)},r=e.split(/\s+/);let s;return s=r.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(r[s+1]),r.splice(s,2)),s=r.indexOf("-s"),s>=0&&(i.scale.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),s=r.indexOf("-o"),s>=0&&(i.offset.set(parseFloat(r[s+1]),parseFloat(r[s+2])),r.splice(s,4)),i.url=r.join(" ").trim(),i}loadTexture(e,t,i,r,s){const o=this.manager!==void 0?this.manager:p.tEQ;let l=o.getHandler(e);l===null&&(l=new p.dpR(o)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin);const u=l.load(e,i,r,s);return t!==void 0&&(u.mapping=t),u}}const xE=/^[og]\s*(.+)?/,Qr=/^mtllib /,EE=/^usemtl /,pw=/^usemap /,fw=/\s+/,mw=new p.Pa4,_g=new p.Pa4,gw=new p.Pa4,vw=new p.Pa4,kl=new p.Pa4,P0=new p.Ilk;function SE(){const a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,s){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const l={index:this.materials.length,name:r||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(u){const h={index:typeof u=="number"?u:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),r&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},i&&i.name&&typeof i.clone=="function"){const r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){const i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){const r=this.vertices,s=this.object.geometry.vertices;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[t+0],r[t+1],r[t+2]),s.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const r=this.normals,s=this.object.geometry.normals;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[t+0],r[t+1],r[t+2]),s.push(r[i+0],r[i+1],r[i+2])},addFaceNormal:function(e,t,i){const r=this.vertices,s=this.object.geometry.normals;mw.fromArray(r,e),_g.fromArray(r,t),gw.fromArray(r,i),kl.subVectors(gw,_g),vw.subVectors(mw,_g),kl.cross(vw),kl.normalize(),s.push(kl.x,kl.y,kl.z),s.push(kl.x,kl.y,kl.z),s.push(kl.x,kl.y,kl.z)},addColor:function(e,t,i){const r=this.colors,s=this.object.geometry.colors;r[e]!==void 0&&s.push(r[e+0],r[e+1],r[e+2]),r[t]!==void 0&&s.push(r[t+0],r[t+1],r[t+2]),r[i]!==void 0&&s.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){const r=this.uvs,s=this.object.geometry.uvs;s.push(r[e+0],r[e+1]),s.push(r[t+0],r[t+1]),s.push(r[i+0],r[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,s,o,l,u,h){const f=this.vertices.length;let g=this.parseVertexIndex(e,f),_=this.parseVertexIndex(t,f),A=this.parseVertexIndex(i,f);if(this.addVertex(g,_,A),this.addColor(g,_,A),l!==void 0&&l!==""){const x=this.normals.length;g=this.parseNormalIndex(l,x),_=this.parseNormalIndex(u,x),A=this.parseNormalIndex(h,x),this.addNormal(g,_,A)}else this.addFaceNormal(g,_,A);if(r!==void 0&&r!==""){const x=this.uvs.length;g=this.parseUVIndex(r,x),_=this.parseUVIndex(s,x),A=this.parseUVIndex(o,x),this.addUV(g,_,A),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,r=e.length;i<r;i++){const s=this.parseVertexIndex(e[i],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,r=this.uvs.length;for(let s=0,o=e.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(e[s],i));for(let s=0,o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return a.startObject("",!1),a}class Qy extends p.aNw{constructor(e){super(e),this.materials=null}load(e,t,i,r){const s=this,o=new p.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(l){try{t(await s.parse(l))}catch(u){r?r(u):console.error(u),s.manager.itemError(e)}},i,r)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new SE;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let r=[];for(let o=0,l=i.length;o<l;o++){const u=i[o].trimStart();if(u.length===0)continue;const h=u.charAt(0);if(h!=="#")if(h==="v"){const f=u.split(fw);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(P0.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),t.colors.push(P0.r,P0.g,P0.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if(h==="f"){const f=u.slice(1).trim().split(fw),g=[];for(let A=0,x=f.length;A<x;A++){const E=f[A];if(E.length>0){const T=E.split("/");g.push(T)}}const _=g[0];for(let A=1,x=g.length-1;A<x;A++){const E=g[A],T=g[A+1];t.addFace(_[0],E[0],T[0],_[1],E[1],T[1],_[2],E[2],T[2])}}else if(h==="l"){const f=u.substring(1).trim().split(" ");let g=[];const _=[];if(u.indexOf("/")===-1)g=f;else for(let A=0,x=f.length;A<x;A++){const E=f[A].split("/");E[0]!==""&&g.push(E[0]),E[1]!==""&&_.push(E[1])}t.addLineGeometry(g,_)}else if(h==="p"){const f=u.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((r=xE.exec(u))!==null){const f=(" "+r[0].slice(1).trim()).slice(1);t.startObject(f)}else if(EE.test(u))t.object.startMaterial(u.substring(7).trim(),t.materialLibraries);else if(Qr.test(u)){t.materialLibraries.push(u.substring(7).trim());const f=u.substring(7).trim(),g=this.manager.getHandler(f);if(g){const _=await g.loadAsync(f).catch(A=>{console.warn(A)});_&&this.setMaterials(_)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(pw.test(u))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(r=u.split(" "),r.length>1){const g=r[1].trim().toLowerCase();t.object.smooth=g!=="0"&&g!=="off"}else t.object.smooth=!0;const f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(u==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+u+'"')}}t.finalize();const s=new p.ZAu;if(s.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let o=0,l=t.objects.length;o<l;o++){const u=t.objects[o],h=u.geometry,f=u.materials,g=h.type==="Line",_=h.type==="Points";let A=!1;if(h.vertices.length===0)continue;const x=new p.u9r;x.setAttribute("position",new p.a$l(h.vertices,3)),h.normals.length>0&&x.setAttribute("normal",new p.a$l(h.normals,3)),h.colors.length>0&&(A=!0,x.setAttribute("color",new p.a$l(h.colors,3))),h.hasUVIndices===!0&&x.setAttribute("uv",new p.a$l(h.uvs,2));const E=[];for(let R=0,I=f.length;R<I;R++){const S=f[R],O=S.name+"_"+S.smooth+"_"+A;let k=t.materials[O];if(this.materials!==null)if(k=await this.materials.create(S.name),!g||!k||k instanceof p.nls){if(_&&k&&!(k instanceof p.UY4)){const N=new p.UY4({size:10,sizeAttenuation:!1});p.F5T.prototype.copy.call(N,k),N.color.copy(k.color),N.map=k.map,k=N}}else{const N=new p.nls;p.F5T.prototype.copy.call(N,k),N.color.copy(k.color),k=N}k===void 0&&(k=g?new p.nls:_?new p.UY4({size:1,sizeAttenuation:!1}):new p.xoR,k.name=S.name,k.flatShading=!S.smooth,k.vertexColors=A,t.materials[O]=k),E.push(k)}let T;if(E.length>1){for(let R=0,I=f.length;R<I;R++){const S=f[R];x.addGroup(S.groupStart,S.groupCount,R)}T=g?new p.ejS(x,E):_?new p.woe(x,E):new p.Kj0(x,E)}else T=g?new p.ejS(x,E[0]):_?new p.woe(x,E[0]):new p.Kj0(x,E[0]);T.name=u.name,s.add(T)}else if(t.vertices.length>0){const o=new p.UY4({size:1,sizeAttenuation:!1}),l=new p.u9r;l.setAttribute("position",new p.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new p.a$l(t.colors,3)),o.vertexColors=!0);const u=new p.woe(l,o);s.add(u)}return s}}class yg extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut],this._importer1=new Tn(Qy,["obj"],!0),this._importer2=new Tn(dw,["mtl"],!1)}async onAdded(e){var t,i,r,s;(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer1),(s=(r=e.getManager())===null||r===void 0?void 0:r.importer)===null||s===void 0||s.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,i;!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}yg.PluginType="ObjMtlLoadPlugin";var _w=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};try{URL.revokeObjectURL(_w(""))}catch{_w=function(a){return"data:application/javascript;charset=UTF-8,"+encodeURI(a)}}var so=Uint8Array,Ua=Uint16Array,bg=Uint32Array,Ag=new so([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_p=new so([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Wy=new so([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xy=function(a,e){for(var t=new Ua(31),i=0;i<31;++i)t[i]=e+=1<<a[i-1];var r=new bg(t[30]);for(i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)r[s]=s-t[i]<<5|i;return[t,r]},yw=Xy(Ag,2),Ku=yw[0],$f=yw[1];Ku[28]=258,$f[258]=28;for(var R0=Xy(_p,0),CE=R0[0],qy=R0[1],Yy=new Ua(32768),Dn=0;Dn<32768;++Dn){var Qh=(43690&Dn)>>>1|(21845&Dn)<<1;Qh=(61680&(Qh=(52428&Qh)>>>2|(13107&Qh)<<2))>>>4|(3855&Qh)<<4,Yy[Dn]=((65280&Qh)>>>8|(255&Qh)<<8)>>>1}var Mc=function(a,e,t){for(var i=a.length,r=0,s=new Ua(e);r<i;++r)++s[a[r]-1];var o,l=new Ua(e);for(r=0;r<e;++r)l[r]=l[r-1]+s[r-1]<<1;if(t){o=new Ua(1<<e);var u=15-e;for(r=0;r<i;++r)if(a[r])for(var h=r<<4|a[r],f=e-a[r],g=l[a[r]-1]++<<f,_=g|(1<<f)-1;g<=_;++g)o[Yy[g]>>>u]=h}else for(o=new Ua(i),r=0;r<i;++r)a[r]&&(o[r]=Yy[l[a[r]-1]++]>>>15-a[r]);return o},Wh=new so(288);for(Dn=0;Dn<144;++Dn)Wh[Dn]=8;for(Dn=144;Dn<256;++Dn)Wh[Dn]=9;for(Dn=256;Dn<280;++Dn)Wh[Dn]=7;for(Dn=280;Dn<288;++Dn)Wh[Dn]=8;var wg=new so(32);for(Dn=0;Dn<32;++Dn)wg[Dn]=5;var ME=Mc(Wh,9,0),bw=Mc(Wh,9,1),D0=Mc(wg,5,0),Aw=Mc(wg,5,1),Ky=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Io=function(a,e,t){var i=e/8|0;return(a[i]|a[i+1]<<8)>>(7&e)&t},zn=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(7&e)},Zy=function(a){return(a/8|0)+(7&a&&1)},ss=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var i=new(a instanceof Ua?Ua:a instanceof bg?bg:so)(t-e);return i.set(a.subarray(e,t)),i},B0=function(a,e,t){var i=a.length;if(!i||t&&!t.l&&i<5)return e||new so(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new so(3*i));var o=function(di){var Ai=e.length;if(di>Ai){var Wi=new so(Math.max(2*Ai,di));Wi.set(e),e=Wi}},l=t.f||0,u=t.p||0,h=t.b||0,f=t.l,g=t.d,_=t.m,A=t.n,x=8*i;do{if(!f){t.f=l=Io(a,u,1);var E=Io(a,u+1,3);if(u+=3,!E){var T=a[(ue=Zy(u)+4)-4]|a[ue-3]<<8,R=ue+T;if(R>i){if(s)throw"unexpected EOF";break}r&&o(h+T),e.set(a.subarray(ue,R),h),t.b=h+=T,t.p=u=8*R;continue}if(E==1)f=bw,g=Aw,_=9,A=5;else{if(E!=2)throw"invalid block type";var I=Io(a,u,31)+257,S=Io(a,u+10,15)+4,O=I+Io(a,u+5,31)+1;u+=14;for(var k=new so(O),N=new so(19),H=0;H<S;++H)N[Wy[H]]=Io(a,u+3*H,7);u+=3*S;var X=Ky(N),te=(1<<X)-1,re=Mc(N,X,1);for(H=0;H<O;){var ue,le=re[Io(a,u,te)];if(u+=15&le,(ue=le>>>4)<16)k[H++]=ue;else{var se=0,de=0;for(ue==16?(de=3+Io(a,u,3),u+=2,se=k[H-1]):ue==17?(de=3+Io(a,u,7),u+=3):ue==18&&(de=11+Io(a,u,127),u+=7);de--;)k[H++]=se}}var ve=k.subarray(0,I),fe=k.subarray(I);_=Ky(ve),A=Ky(fe),f=Mc(ve,_,1),g=Mc(fe,A,1)}if(u>x){if(s)throw"unexpected EOF";break}}r&&o(h+131072);for(var Ee=(1<<_)-1,Je=(1<<A)-1,Te=u;;Te=u){var qe=(se=f[zn(a,u)&Ee])>>>4;if((u+=15&se)>x){if(s)throw"unexpected EOF";break}if(!se)throw"invalid length/literal";if(qe<256)e[h++]=qe;else{if(qe==256){Te=u,f=null;break}var Ve=qe-254;if(qe>264){var Ye=Ag[H=qe-257];Ve=Io(a,u,(1<<Ye)-1)+Ku[H],u+=Ye}var Tt=g[zn(a,u)&Je],Xe=Tt>>>4;if(!Tt)throw"invalid distance";if(u+=15&Tt,fe=CE[Xe],Xe>3&&(Ye=_p[Xe],fe+=zn(a,u)&(1<<Ye)-1,u+=Ye),u>x){if(s)throw"unexpected EOF";break}r&&o(h+131072);for(var Zt=h+Ve;h<Zt;h+=4)e[h]=e[h-fe],e[h+1]=e[h+1-fe],e[h+2]=e[h+2-fe],e[h+3]=e[h+3-fe];h=Zt}}t.l=f,t.p=Te,t.b=h,f&&(l=1,t.m=_,t.d=g,t.n=A)}while(!l);return h==e.length?e:ss(e,0,h)},Zu=function(a,e,t){t<<=7&e;var i=e/8|0;a[i]|=t,a[i+1]|=t>>>8},xg=function(a,e,t){t<<=7&e;var i=e/8|0;a[i]|=t,a[i+1]|=t>>>8,a[i+2]|=t>>>16},Jy=function(a,e){for(var t=[],i=0;i<a.length;++i)a[i]&&t.push({s:i,f:a[i]});var r=t.length,s=t.slice();if(!r)return[$y,0];if(r==1){var o=new so(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(k,N){return k.f-N.f}),t.push({s:-1,f:25001});var l=t[0],u=t[1],h=0,f=1,g=2;for(t[0]={s:-1,f:l.f+u.f,l,r:u};f!=r-1;)l=t[t[h].f<t[g].f?h++:g++],u=t[h!=f&&t[h].f<t[g].f?h++:g++],t[f++]={s:-1,f:l.f+u.f,l,r:u};var _=s[0].s;for(i=1;i<r;++i)s[i].s>_&&(_=s[i].s);var A=new Ua(_+1),x=O0(t[f-1],A,0);if(x>e){i=0;var E=0,T=x-e,R=1<<T;for(s.sort(function(k,N){return A[N.s]-A[k.s]||k.f-N.f});i<r;++i){var I=s[i].s;if(!(A[I]>e))break;E+=R-(1<<x-A[I]),A[I]=e}for(E>>>=T;E>0;){var S=s[i].s;A[S]<e?E-=1<<e-A[S]++-1:++i}for(;i>=0&&E;--i){var O=s[i].s;A[O]==e&&(--A[O],++E)}x=e}return[new so(A),x]},O0=function(a,e,t){return a.s==-1?Math.max(O0(a.l,e,t+1),O0(a.r,e,t+1)):e[a.s]=t},Eg=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new Ua(++e),i=0,r=a[0],s=1,o=function(u){t[i++]=u},l=1;l<=e;++l)if(a[l]==r&&l!=e)++s;else{if(!r&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(r),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(r);s=1,r=a[l]}return[t.subarray(0,i),e]},yp=function(a,e){for(var t=0,i=0;i<e.length;++i)t+=a[i]*e[i];return t},L0=function(a,e,t){var i=t.length,r=Zy(e+2);a[r]=255&i,a[r+1]=i>>>8,a[r+2]=255^a[r],a[r+3]=255^a[r+1];for(var s=0;s<i;++s)a[r+s+4]=t[s];return 8*(r+4+i)},ww=function(a,e,t,i,r,s,o,l,u,h,f){Zu(e,f++,t),++r[256];for(var g=Jy(r,15),_=g[0],A=g[1],x=Jy(s,15),E=x[0],T=x[1],R=Eg(_),I=R[0],S=R[1],O=Eg(E),k=O[0],N=O[1],H=new Ua(19),X=0;X<I.length;++X)H[31&I[X]]++;for(X=0;X<k.length;++X)H[31&k[X]]++;for(var te=Jy(H,7),re=te[0],ue=te[1],le=19;le>4&&!re[Wy[le-1]];--le);var se,de,ve,fe,Ee=h+5<<3,Je=yp(r,Wh)+yp(s,wg)+o,Te=yp(r,_)+yp(s,E)+o+14+3*le+yp(H,re)+(2*H[16]+3*H[17]+7*H[18]);if(Ee<=Je&&Ee<=Te)return L0(e,f,a.subarray(u,u+h));if(Zu(e,f,1+(Te<Je)),f+=2,Te<Je){se=Mc(_,A,0),de=_,ve=Mc(E,T,0),fe=E;var qe=Mc(re,ue,0);for(Zu(e,f,S-257),Zu(e,f+5,N-1),Zu(e,f+10,le-4),f+=14,X=0;X<le;++X)Zu(e,f+3*X,re[Wy[X]]);f+=3*le;for(var Ve=[I,k],Ye=0;Ye<2;++Ye){var Tt=Ve[Ye];for(X=0;X<Tt.length;++X){var Xe=31&Tt[X];Zu(e,f,qe[Xe]),f+=re[Xe],Xe>15&&(Zu(e,f,Tt[X]>>>5&127),f+=Tt[X]>>>12)}}}else se=ME,de=Wh,ve=D0,fe=wg;for(X=0;X<l;++X)if(i[X]>255){Xe=i[X]>>>18&31,xg(e,f,se[Xe+257]),f+=de[Xe+257],Xe>7&&(Zu(e,f,i[X]>>>23&31),f+=Ag[Xe]);var Zt=31&i[X];xg(e,f,ve[Zt]),f+=fe[Zt],Zt>3&&(xg(e,f,i[X]>>>5&8191),f+=_p[Zt])}else xg(e,f,se[i[X]]),f+=de[i[X]];return xg(e,f,se[256]),f+de[256]},TE=new bg([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$y=new so(0),IE=function(){var a=1,e=0;return{p:function(t){for(var i=a,r=e,s=t.length,o=0;o!=s;){for(var l=Math.min(o+2655,s);o<l;++o)r+=i+=t[o];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}a=i,e=r},d:function(){return(255&(a%=65521))<<24|a>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},PE=function(a,e,t,i,r){return function(s,o,l,u,h,f){var g=s.length,_=new so(u+g+5*(1+Math.ceil(g/7e3))+h),A=_.subarray(u,_.length-h),x=0;if(!o||g<8)for(var E=0;E<=g;E+=65535){var T=E+65535;T<g?x=L0(A,x,s.subarray(E,T)):(A[E]=f,x=L0(A,x,s.subarray(E,g)))}else{for(var R=TE[o-1],I=R>>>13,S=8191&R,O=(1<<l)-1,k=new Ua(32768),N=new Ua(O+1),H=Math.ceil(l/3),X=2*H,te=function(nt){return(s[nt]^s[nt+1]<<H^s[nt+2]<<X)&O},re=new bg(25e3),ue=new Ua(288),le=new Ua(32),se=0,de=0,ve=(E=0,0),fe=0,Ee=0;E<g;++E){var Je=te(E),Te=32767&E,qe=N[Je];if(k[Te]=qe,N[Je]=Te,fe<=E){var Ve=g-E;if((se>7e3||ve>24576)&&Ve>423){x=ww(s,A,0,re,ue,le,de,ve,Ee,E-Ee,x),ve=se=de=0,Ee=E;for(var Ye=0;Ye<286;++Ye)ue[Ye]=0;for(Ye=0;Ye<30;++Ye)le[Ye]=0}var Tt=2,Xe=0,Zt=S,di=Te-qe&32767;if(Ve>2&&Je==te(E-di))for(var Ai=Math.min(I,Ve)-1,Wi=Math.min(32767,E),Gi=Math.min(258,Ve);di<=Wi&&--Zt&&Te!=qe;){if(s[E+Tt]==s[E+Tt-di]){for(var Ui=0;Ui<Gi&&s[E+Ui]==s[E+Ui-di];++Ui);if(Ui>Tt){if(Tt=Ui,Xe=di,Ui>Ai)break;var wt=Math.min(di,Ui-2),yt=0;for(Ye=0;Ye<wt;++Ye){var li=E-di+Ye+32768&32767,ar=li-k[li]+32768&32767;ar>yt&&(yt=ar,qe=li)}}}di+=(Te=qe)-(qe=k[Te])+32768&32767}if(Xe){re[ve++]=268435456|$f[Tt]<<18|qy[Xe];var ge=31&$f[Tt],je=31&qy[Xe];de+=Ag[ge]+_p[je],++ue[257+ge],++le[je],fe=E+Tt,++se}else re[ve++]=s[E],++ue[s[E]]}}x=ww(s,A,f,re,ue,le,de,ve,Ee,E-Ee,x),!f&&7&x&&(x=L0(A,x+1,$y))}return ss(_,0,u+Zy(x)+h)}(a,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+e.mem,t,i,!r)},RE=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},DE=function(a,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=i<<6|(i?32-2*i:1)},BE=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function Sg(a,e){return B0((BE(a),a.subarray(2,-4)),e)}var OE=typeof TextDecoder<"u"&&new TextDecoder;try{OE.decode($y,{stream:!0})}catch{}function xw(a,e,t){const i=t.length-a-1;if(e>=t[i])return i-1;if(e<=t[a])return a;let r=a,s=i,o=Math.floor((r+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function LE(a,e){let t=1;for(let r=2;r<=a;++r)t*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=a-e;++r)i*=r;return t/i}class kE extends p.Hyl{constructor(e,t,i,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const l=i[o];this.controlPoints[o]=new p.Ltg(l.x,l.y,l.z,l.w)}}getPoint(e,t=new p.Pa4){const i=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(o,l,u,h){const f=xw(o,h,l),g=function(A,x,E,T){const R=[],I=[],S=[];R[0]=1;for(let O=1;O<=E;++O){I[O]=x-T[A+1-O],S[O]=T[A+O]-x;let k=0;for(let N=0;N<O;++N){const H=S[N+1],X=I[O-N],te=R[N]/(H+X);R[N]=k+H*te,k=X*te}R[O]=k}return R}(f,h,o,l),_=new p.Ltg(0,0,0,0);for(let A=0;A<=o;++A){const x=u[f-o+A],E=g[A],T=x.w*E;_.x+=x.x*T,_.y+=x.y*T,_.z+=x.z*T,_.w+=x.w*E}return _}(this.degree,this.knots,this.controlPoints,r);return s.w!==1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t=new p.Pa4){const i=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(o,l,u,h,f){const g=function(_,A,x,E,T){const R=T<_?T:_,I=[],S=xw(_,E,A),O=function(N,H,X,te,re){const ue=[];for(let Ee=0;Ee<=X;++Ee)ue[Ee]=0;const le=[];for(let Ee=0;Ee<=te;++Ee)le[Ee]=ue.slice(0);const se=[];for(let Ee=0;Ee<=X;++Ee)se[Ee]=ue.slice(0);se[0][0]=1;const de=ue.slice(0),ve=ue.slice(0);for(let Ee=1;Ee<=X;++Ee){de[Ee]=H-re[N+1-Ee],ve[Ee]=re[N+Ee]-H;let Je=0;for(let Te=0;Te<Ee;++Te){const qe=ve[Te+1],Ve=de[Ee-Te];se[Ee][Te]=qe+Ve;const Ye=se[Te][Ee-1]/se[Ee][Te];se[Te][Ee]=Je+qe*Ye,Je=Ve*Ye}se[Ee][Ee]=Je}for(let Ee=0;Ee<=X;++Ee)le[0][Ee]=se[Ee][X];for(let Ee=0;Ee<=X;++Ee){let Je=0,Te=1;const qe=[];for(let Ve=0;Ve<=X;++Ve)qe[Ve]=ue.slice(0);qe[0][0]=1;for(let Ve=1;Ve<=te;++Ve){let Ye=0;const Tt=Ee-Ve,Xe=X-Ve;Ee>=Ve&&(qe[Te][0]=qe[Je][0]/se[Xe+1][Tt],Ye=qe[Te][0]*se[Tt][Xe]);const Zt=Ee-1<=Xe?Ve-1:X-Ee;for(let Ai=Tt>=-1?1:-Tt;Ai<=Zt;++Ai)qe[Te][Ai]=(qe[Je][Ai]-qe[Je][Ai-1])/se[Xe+1][Tt+Ai],Ye+=qe[Te][Ai]*se[Tt+Ai][Xe];Ee<=Xe&&(qe[Te][Ve]=-qe[Je][Ve-1]/se[Xe+1][Ee],Ye+=qe[Te][Ve]*se[Ee][Xe]),le[Ve][Ee]=Ye;const di=Je;Je=Te,Te=di}}let fe=X;for(let Ee=1;Ee<=te;++Ee){for(let Je=0;Je<=X;++Je)le[Ee][Je]*=fe;fe*=X-Ee}return le}(S,E,_,R,A),k=[];for(let N=0;N<x.length;++N){const H=x[N].clone(),X=H.w;H.x*=X,H.y*=X,H.z*=X,k[N]=H}for(let N=0;N<=R;++N){const H=k[S-_].clone().multiplyScalar(O[N][0]);for(let X=1;X<=_;++X)H.add(k[S-_+X].clone().multiplyScalar(O[N][X]));I[N]=H}for(let N=R+1;N<=T+1;++N)I[N]=new p.Ltg(0,0,0);return I}(o,l,u,h,f);return function(_){const A=_.length,x=[],E=[];for(let R=0;R<A;++R){const I=_[R];x[R]=new p.Pa4(I.x,I.y,I.z),E[R]=I.w}const T=[];for(let R=0;R<A;++R){const I=x[R].clone();for(let S=1;S<=R;++S)I.sub(T[R-S].clone().multiplyScalar(LE(R,S)*E[S]));T[R]=I.divideScalar(E[0])}return T}(g)}(this.degree,this.knots,this.controlPoints,r,1);return i.copy(s[1]).normalize(),i}}let Pr,as,ao;class UE extends p.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=s.path===""?p.Zp0.extractUrlBase(e):s.path,l=new p.hH6(this.manager);l.setPath(s.path),l.setResponseType("arraybuffer"),l.setRequestHeader(s.requestHeader),l.setWithCredentials(s.withCredentials),l.load(e,function(u){try{t(s.parse(u,o))}catch(h){r?r(h):console.error(h),s.manager.itemError(e)}},i,r)}parse(e,t){if(function(s){const o="Kaydara FBX Binary  \0";return s.byteLength>=o.length&&o===F(s,0,o.length)}(e))Pr=new b().parse(e);else{const s=F(e);if(!function(o){const l=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let u=0;function h(f){const g=o[f-1];return o=o.slice(u+f),u++,g}for(let f=0;f<l.length;++f)if(h(1)===l[f])return!1;return!0}(s))throw new Error("THREE.FBXLoader: Unknown format.");if(d(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(s));Pr=new zE().parse(s)}const i=new p.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),r=new NE(i,this.manager).parse(Pr);return Pr=null,as=null,ao=null,r}}class NE{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){as=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),r=this.parseDeformers(),s=new FE().parse(r);return this.parseScene(r,s,i),ao}parseConnections(){const e=new Map;return"Connections"in Pr&&Pr.Connections.connections.forEach(function(t){const i=t[0],r=t[1],s=t[2];e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:r,relationship:s};e.get(i).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:i,relationship:s};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in Pr.Objects){const i=Pr.Objects.Video;for(const r in i){const s=i[r];if(e[parseInt(r)]=s.RelativeFilename||s.Filename,"Content"in s){const o=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,l=typeof s.Content=="string"&&s.Content!=="";if(o||l){const u=this.parseImage(i[r]);t[s.RelativeFilename||s.Filename]=u}}}}for(const i in e){const r=e[i];t[r]!==void 0?e[i]=t[r]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in Pr.Objects){const i=Pr.Objects.Texture;for(const r in i){const s=this.parseTexture(i[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,l=s!==void 0?s.value:0;if(i.wrapS=o===0?p.rpg:p.uWy,i.wrapT=l===0?p.rpg:p.uWy,"Scaling"in e){const u=e.Scaling.value;i.repeat.x=u[0],i.repeat.y=u[1]}if("Translation"in e){const u=e.Translation.value;i.offset.x=u[0],i.offset.y=u[1]}return i}loadTexture(e,t){let i;const r=this.textureLoader.path,s=as.get(e.id).children;let o;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(i=t[s[0].ID],i.indexOf("blob:")!==0&&i.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const u=this.manager.getHandler(".tga");u===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new p.xEZ):(u.setPath(this.textureLoader.path),o=u.load(i))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new p.xEZ):o=this.textureLoader.load(i);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in Pr.Objects){const i=Pr.Objects.Material;for(const r in i){const s=this.parseMaterial(i[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const i=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!as.has(i))return null;const o=this.parseParameters(e,t,i);let l;switch(s.toLowerCase()){case"phong":l=new p.xoR;break;case"lambert":l=new p.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),l=new p.xoR}return l.setValues(o),l.name=r,l}parseParameters(e,t,i){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new p.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(r.color=new p.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new p.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(r.emissive=new p.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new p.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new p.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return as.get(i).children.forEach(function(o){const l=o.relationship;switch(l){case"Bump":r.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,o.ID),r.map!==void 0&&(r.map.colorSpace=p.KI_);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,o.ID),r.emissiveMap!==void 0&&(r.emissiveMap.colorSpace=p.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=p.dSO,r.envMap.colorSpace=p.KI_);break;case"SpecularColor":r.specularMap=s.getTexture(t,o.ID),r.specularMap!==void 0&&(r.specularMap.colorSpace=p.KI_);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,o.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l)}}),r}getTexture(e,t){return"LayeredTexture"in Pr.Objects&&t in Pr.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=as.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Pr.Objects){const i=Pr.Objects.Deformer;for(const r in i){const s=i[r],o=as.get(parseInt(r));if(s.attrType==="Skin"){const l=this.parseSkeleton(o,i);l.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=o.parents[0].ID,e[r]=l}else if(s.attrType==="BlendShape"){const l={id:r};l.rawTargets=this.parseMorphTargets(o,i),l.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=l}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new p.yGw().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=t[s.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;l.geoID=as.get(parseInt(s.ID)).children.filter(function(u){return u.relationship===void 0})[0].ID,i.push(l)}return i}parseScene(e,t,i){ao=new p.ZAu;const r=this.parseModels(e.skeletons,t,i),s=Pr.Objects.Model,o=this;r.forEach(function(u){const h=s[u.ID];o.setLookAtProperties(u,h),as.get(u.ID).parents.forEach(function(f){const g=r.get(f.ID);g!==void 0&&g.add(u)}),u.parent===null&&ao.add(u)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),ao.traverse(function(u){if(u.userData.transformData){u.parent&&(u.userData.transformData.parentMatrix=u.parent.matrix,u.userData.transformData.parentMatrixWorld=u.parent.matrixWorld);const h=D(u.userData.transformData);u.applyMatrix4(h),u.updateWorldMatrix()}});const l=new jE().parse();ao.children.length===1&&ao.children[0].isGroup&&(ao.children[0].animations=l,ao=ao.children[0]),ao.animations=l}parseModels(e,t,i){const r=new Map,s=Pr.Objects.Model;for(const o in s){const l=parseInt(o),u=s[o],h=as.get(l);let f=this.buildSkeleton(h,e,l,u.attrName);if(!f){switch(u.attrType){case"Camera":f=this.createCamera(h);break;case"Light":f=this.createLight(h);break;case"Mesh":f=this.createMesh(h,t,i);break;case"NurbsCurve":f=this.createCurve(h,t);break;case"LimbNode":case"Root":f=new p.N$j;break;default:f=new p.ZAu}f.name=u.attrName?p.iUV.sanitizeNodeName(u.attrName):"",f.ID=l}this.getTransformData(f,u),r.set(l,f)}return r}buildSkeleton(e,t,i,r){let s=null;return e.parents.forEach(function(o){for(const l in t){const u=t[l];u.rawBones.forEach(function(h,f){if(h.ID===o.ID){const g=s;s=new p.N$j,s.matrixWorld.copy(h.transformLink),s.name=r?p.iUV.sanitizeNodeName(r):"",s.ID=i,u.bones[f]=s,g!==null&&s.add(g)}})}}),s}createCamera(e){let t,i;if(e.children.forEach(function(r){const s=Pr.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)t=new p.Tme;else{let r=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(r=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let l=window.innerWidth,u=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(l=i.AspectWidth.value,u=i.AspectHeight.value);const h=l/u;let f=45;i.FieldOfView!==void 0&&(f=i.FieldOfView.value);const g=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:t=new p.cPb(f,h,s,o),g!==null&&t.setFocalLength(g);break;case 1:t=new p.iKG(-l/2,l/2,u/2,-u/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new p.Tme}}return t}createLight(e){let t,i;if(e.children.forEach(function(r){const s=Pr.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)t=new p.Tme;else{let r;r=i.LightType===void 0?0:i.LightType.value;let s=16777215;i.Color!==void 0&&(s=new p.Ilk().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let l=0;i.FarAttenuationEnd!==void 0&&(l=i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?0:i.FarAttenuationEnd.value);const u=1;switch(r){case 0:t=new p.cek(s,o,l,u);break;case 1:t=new p.Ox3(s,o);break;case 2:let h=Math.PI/3;i.InnerAngle!==void 0&&(h=p.M8C.degToRad(i.InnerAngle.value));let f=0;i.OuterAngle!==void 0&&(f=p.M8C.degToRad(i.OuterAngle.value),f=Math.max(f,1)),t=new p.PMe(s,o,l,h,f,u);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new p.cek(s,o)}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let r,s=null,o=null;const l=[];return e.children.forEach(function(u){t.has(u.ID)&&(s=t.get(u.ID)),i.has(u.ID)&&l.push(i.get(u.ID))}),l.length>1?o=l:l.length>0?o=l[0]:(o=new p.xoR({color:13421772}),l.push(o)),"color"in s.attributes&&l.forEach(function(u){u.vertexColors=!0}),s.FBX_Deformer?(r=new p.TUv(s,o),r.normalizeSkinWeights()):r=new p.Kj0(s,o),r}createCurve(e,t){const i=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),r=new p.nls({color:3342591,linewidth:1});return new p.x12(i,r)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder="RotationOrder"in t?B(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&as.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const r=Pr.Objects.Model[i.ID];if("Lcl_Translation"in r){const s=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),ao.add(e.target)):e.lookAt(new p.Pa4().fromArray(s))}}})}bindSkeleton(e,t,i){const r=this.parsePoseNodes();for(const s in e){const o=e[s];as.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const u=l.ID;as.get(u).parents.forEach(function(h){i.has(h.ID)&&i.get(h.ID).bind(new p.OdW(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Pr.Objects){const t=Pr.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const r=t[i].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new p.yGw().fromArray(s.Matrix.a)}):e[r.Node]=new p.yGw().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Pr&&"AmbientColor"in Pr.GlobalSettings){const e=Pr.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],r=e[2];if(t!==0||i!==0||r!==0){const s=new p.Ilk(t,i,r).convertSRGBToLinear();ao.add(new p.Mig(s,1))}}}}class FE{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Pr.Objects){const i=Pr.Objects.Geometry;for(const r in i){const s=as.get(parseInt(r)),o=this.parseGeometry(s,i[r],e);t.set(parseInt(r),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const r=i.skeletons,s=[],o=e.parents.map(function(g){return Pr.Objects.Model[g.ID]});if(o.length===0)return;const l=e.children.reduce(function(g,_){return r[_.ID]!==void 0&&(g=r[_.ID]),g},null);e.children.forEach(function(g){i.morphTargets[g.ID]!==void 0&&s.push(i.morphTargets[g.ID])});const u=o[0],h={};"RotationOrder"in u&&(h.eulerOrder=B(u.RotationOrder.value)),"InheritType"in u&&(h.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(h.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(h.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(h.scale=u.GeometricScaling.value);const f=D(h);return this.genGeometry(t,l,s,f)}genGeometry(e,t,i,r){const s=new p.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),l=this.genBuffers(o),u=new p.a$l(l.vertex,3);if(u.applyMatrix4(r),s.setAttribute("position",u),l.colors.length>0&&s.setAttribute("color",new p.a$l(l.colors,3)),t&&(s.setAttribute("skinIndex",new p.qlB(l.weightsIndices,4)),s.setAttribute("skinWeight",new p.a$l(l.vertexWeights,4)),s.FBX_Deformer=t),l.normal.length>0){const h=new p.Vkp().getNormalMatrix(r),f=new p.a$l(l.normal,3);f.applyNormalMatrix(h),s.setAttribute("normal",f)}if(l.uvs.forEach(function(h,f){const g=f===0?"uv":`uv${f}`;s.setAttribute(g,new p.a$l(l.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let h=l.materialIndex[0],f=0;if(l.materialIndex.forEach(function(g,_){g!==h&&(s.addGroup(f,_-f,h),h=g,f=_)}),s.groups.length>0){const g=s.groups[s.groups.length-1],_=g.start+g.count;_!==l.materialIndex.length&&s.addGroup(_,l.materialIndex.length-_,h)}s.groups.length===0&&s.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(s,e,i,r),s}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(o,l){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:s,weight:r.weights[l]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,r=0,s=!1,o=[],l=[],u=[],h=[],f=[],g=[];const _=this;return e.vertexIndices.forEach(function(A,x){let E,T=!1;A<0&&(A^=-1,T=!0);let R=[],I=[];if(o.push(3*A,3*A+1,3*A+2),e.color){const S=w(x,i,A,e.color);u.push(S[0],S[1],S[2])}if(e.skeleton){if(e.weightTable[A]!==void 0&&e.weightTable[A].forEach(function(S){I.push(S.weight),R.push(S.id)}),I.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const S=[0,0,0,0],O=[0,0,0,0];I.forEach(function(k,N){let H=k,X=R[N];O.forEach(function(te,re,ue){if(H>te){ue[re]=H,H=te;const le=S[re];S[re]=X,X=le}})}),R=S,I=O}for(;I.length<4;)I.push(0),R.push(0);for(let S=0;S<4;++S)f.push(I[S]),g.push(R[S])}if(e.normal){const S=w(x,i,A,e.normal);l.push(S[0],S[1],S[2])}e.material&&e.material.mappingType!=="AllSame"&&(E=w(x,i,A,e.material)[0],E<0&&(_.negativeMaterialIndices=!0,E=0)),e.uv&&e.uv.forEach(function(S,O){const k=w(x,i,A,S);h[O]===void 0&&(h[O]=[]),h[O].push(k[0]),h[O].push(k[1])}),r++,T&&(r>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),_.genFace(t,e,o,E,l,u,h,f,g,r),i++,r=0,o=[],l=[],u=[],h=[],f=[],g=[])}),t}genFace(e,t,i,r,s,o,l,u,h,f){for(let g=2;g<f;g++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(g-1)]]),e.vertex.push(t.vertexPositions[i[3*(g-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(g-1)+2]]),e.vertex.push(t.vertexPositions[i[3*g]]),e.vertex.push(t.vertexPositions[i[3*g+1]]),e.vertex.push(t.vertexPositions[i[3*g+2]]),t.skeleton&&(e.vertexWeights.push(u[0]),e.vertexWeights.push(u[1]),e.vertexWeights.push(u[2]),e.vertexWeights.push(u[3]),e.vertexWeights.push(u[4*(g-1)]),e.vertexWeights.push(u[4*(g-1)+1]),e.vertexWeights.push(u[4*(g-1)+2]),e.vertexWeights.push(u[4*(g-1)+3]),e.vertexWeights.push(u[4*g]),e.vertexWeights.push(u[4*g+1]),e.vertexWeights.push(u[4*g+2]),e.vertexWeights.push(u[4*g+3]),e.weightsIndices.push(h[0]),e.weightsIndices.push(h[1]),e.weightsIndices.push(h[2]),e.weightsIndices.push(h[3]),e.weightsIndices.push(h[4*(g-1)]),e.weightsIndices.push(h[4*(g-1)+1]),e.weightsIndices.push(h[4*(g-1)+2]),e.weightsIndices.push(h[4*(g-1)+3]),e.weightsIndices.push(h[4*g]),e.weightsIndices.push(h[4*g+1]),e.weightsIndices.push(h[4*g+2]),e.weightsIndices.push(h[4*g+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(g-1)]),e.colors.push(o[3*(g-1)+1]),e.colors.push(o[3*(g-1)+2]),e.colors.push(o[3*g]),e.colors.push(o[3*g+1]),e.colors.push(o[3*g+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[3*(g-1)]),e.normal.push(s[3*(g-1)+1]),e.normal.push(s[3*(g-1)+2]),e.normal.push(s[3*g]),e.normal.push(s[3*g+1]),e.normal.push(s[3*g+2])),t.uv&&t.uv.forEach(function(_,A){e.uvs[A]===void 0&&(e.uvs[A]=[]),e.uvs[A].push(l[A][0]),e.uvs[A].push(l[A][1]),e.uvs[A].push(l[A][2*(g-1)]),e.uvs[A].push(l[A][2*(g-1)+1]),e.uvs[A].push(l[A][2*g]),e.uvs[A].push(l[A][2*g+1])})}addMorphTargets(e,t,i,r){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(o){o.rawTargets.forEach(function(l){const u=Pr.Objects.Geometry[l.geoID];u!==void 0&&s.genMorphGeometry(e,t,u,r,l.name)})})}genMorphGeometry(e,t,i,r,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=i.Vertices!==void 0?i.Vertices.a:[],u=i.Indexes!==void 0?i.Indexes.a:[],h=3*e.attributes.position.count,f=new Float32Array(h);for(let x=0;x<u.length;x++){const E=3*u[x];f[E]=l[3*x],f[E+1]=l[3*x+1],f[E+2]=l[3*x+2]}const g={vertexIndices:o,vertexPositions:f},_=this.genBuffers(g),A=new p.a$l(_.vertex,3);A.name=s||i.attrName,A.applyMatrix4(r),e.morphAttributes.position.push(A)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a;let s=[];i==="IndexToDirect"&&(s=e.ColorIndex.a);for(let o=0,l=new p.Ilk;o<r.length;o+=4)l.fromArray(r,o).convertSRGBToLinear().toArray(r,o);return{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new p.u9r;const i=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let f=0,g=o.length;f<g;f+=4)s.push(new p.Ltg().fromArray(o,f));let l,u;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){l=i,u=r.length-1-l;for(let f=0;f<i;++f)s.push(s[f])}const h=new kE(i,r,s,l,u).getPoints(12*s.length);return new p.u9r().setFromPoints(h)}}class jE{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const r=t[i],s=this.addClip(r);e.push(s)}return e}parseClips(){if(Pr.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Pr.Objects.AnimationCurveNode,t=new Map;for(const i in e){const r=e[i];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=Pr.Objects.AnimationCurve;for(const i in t){const r={id:t[i].id,times:t[i].KeyTime.a.map(m),values:t[i].KeyValueFloat.a},s=as.get(r.id);if(s!==void 0){const o=s.parents[0].ID,l=s.parents[0].relationship;l.match(/X/)?e.get(o).curves.x=r:l.match(/Y/)?e.get(o).curves.y=r:l.match(/Z/)?e.get(o).curves.z=r:l.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=Pr.Objects.AnimationLayer,i=new Map;for(const r in t){const s=[],o=as.get(parseInt(r));o!==void 0&&(o.children.forEach(function(l,u){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(s[u]===void 0){const f=as.get(l.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID;if(f!==void 0){const g=Pr.Objects.Model[f.toString()];if(g===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",l);const _={modelName:g.attrName?p.iUV.sanitizeNodeName(g.attrName):"",ID:g.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ao.traverse(function(A){A.ID===g.id&&(_.transform=A.matrix,A.userData.transformData&&(_.eulerOrder=A.userData.transformData.eulerOrder))}),_.transform||(_.transform=new p.yGw),"PreRotation"in g&&(_.preRotation=g.PreRotation.value),"PostRotation"in g&&(_.postRotation=g.PostRotation.value),s[u]=_}}s[u]&&(s[u][h.attr]=h)}else if(h.curves.morph!==void 0){if(s[u]===void 0){const f=as.get(l.ID).parents.filter(function(T){return T.relationship!==void 0})[0].ID,g=as.get(f).parents[0].ID,_=as.get(g).parents[0].ID,A=as.get(_).parents[0].ID,x=Pr.Objects.Model[A],E={modelName:x.attrName?p.iUV.sanitizeNodeName(x.attrName):"",morphName:Pr.Objects.Deformer[f].attrName};s[u]=E}s[u][h.attr]=h}}}),i.set(parseInt(r),s))}return i}parseAnimStacks(e){const t=Pr.Objects.AnimationStack,i={};for(const r in t){const s=as.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);i[r]={name:t[r].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(r){t=t.concat(i.generateTracks(r))}),new p.m7l(e.name,-1,t)}generateTracks(e){const t=[];let i=new p.Pa4,r=new p._fP,s=new p.Pa4;if(e.transform&&e.transform.decompose(i,r,s),i=i.toArray(),r=new p.USm().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,i,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,i);return new p.yC1(e+"."+r,s,o)}generateRotationTrack(e,t,i,r,s,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(p.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(p.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(p.M8C.degToRad));const l=this.getTimesForAllAxes(t),u=this.getKeyframeTrackValues(l,t,i);r!==void 0&&((r=r.map(p.M8C.degToRad)).push(o),r=new p.USm().fromArray(r),r=new p._fP().setFromEuler(r)),s!==void 0&&((s=s.map(p.M8C.degToRad)).push(o),s=new p.USm().fromArray(s),s=new p._fP().setFromEuler(s).invert());const h=new p._fP,f=new p.USm,g=[];for(let _=0;_<u.length;_+=3)f.set(u[_],u[_+1],u[_+2],o),h.setFromEuler(f),r!==void 0&&h.premultiply(r),s!==void 0&&h.multiply(s),h.toArray(g,_/3*4);return new p.iLg(e+".quaternion",l,g)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(s){return s/100}),r=ao.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new p.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,r){return i-r}),t.length>1){let i=1,r=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==r&&(t[i]=o,r=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const r=i,s=[];let o=-1,l=-1,u=-1;return e.forEach(function(h){if(t.x&&(o=t.x.times.indexOf(h)),t.y&&(l=t.y.times.indexOf(h)),t.z&&(u=t.z.times.indexOf(h)),o!==-1){const f=t.x.values[o];s.push(f),r[0]=f}else s.push(r[0]);if(l!==-1){const f=t.y.values[l];s.push(f),r[1]=f}else s.push(r[1]);if(u!==-1){const f=t.z.values[u];s.push(f),r[2]=f}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],r=e.values[t]-i,s=Math.abs(r);if(s>=180){const o=s/180,l=r/o;let u=i+l;const h=e.times[t-1],f=(e.times[t]-h)/o;let g=h+f;const _=[],A=[];for(;g<e.times[t];)_.push(g),g+=f,A.push(u),u+=l;e.times=z(e.times,t,_),e.values=z(e.values,t,A)}}}}class zE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new c,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),l=r.match(/^[\s\t]*$/);if(o||l)return;const u=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=r.match("^\\t{"+(t.currentIndent-1)+"}}");u?t.parseNodeBegin(r,u):h?t.parseNodeProperty(r,h,i[++s]):f?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(u){return u.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},o=this.parseNodeAttr(r),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in l?(i==="PoseNode"?l.PoseNode.push(s):l[i].id!==void 0&&(l[i]={},l[i][l[i].id]=l[i]),o.id!==""&&(l[i][o.id]=s)):typeof o.id=="number"?(l[i]={},l[i][o.id]=s):i!=="Properties70"&&(l[i]=i==="PoseNode"?[s]:s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:i,type:r}}parseNodeProperty(e,t,i){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name!=="Properties70"){if(r==="C"){const l=s.split(",").slice(1),u=parseInt(l[0]),h=parseInt(l[1]);let f=s.split(",").slice(3);f=f.map(function(g){return g.trim().replace(/^"/,"")}),r="connections",s=[u,h],function(g,_){for(let A=0,x=g.length,E=_.length;A<E;A++,x++)g[x]=_[A]}(s,f),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=j(s))}else this.parseNodeSpecialProperty(e,r,s)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=j(t.a))}parseNodeSpecialProperty(e,t,i){const r=i.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],l=r[2],u=r[3];let h=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=j(h)}this.getPrevNode()[s]={type:o,type2:l,flag:u,value:h},this.setCurrentProp(this.getPrevNode(),s)}}class b{parse(e){const t=new n(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const r=new c;for(;!this.endOfContent(t);){const s=this.parseNode(t,i);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),l=e.getString(o);if(r===0)return null;const u=[];for(let _=0;_<s;_++)u.push(this.parseProperty(e));const h=u.length>0?u[0]:"",f=u.length>1?u[1]:"",g=u.length>2?u[2]:"";for(i.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const _=this.parseNode(e,t);_!==null&&this.parseSubNode(l,i,_)}return i.propertyList=u,typeof h=="number"&&(i.id=h),f!==""&&(i.attrName=f),g!==""&&(i.attrType=g),l!==""&&(i.name=l),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const r=i.propertyList[0];Array.isArray(r)?(t[i.name]=i,i.a=r):t[i.name]=r}else if(e==="Connections"&&i.name==="C"){const r=[];i.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let r=i.propertyList[0],s=i.propertyList[1];const o=i.propertyList[2],l=i.propertyList[3];let u;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),u=s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[r]={type:s,type2:o,flag:l,value:u}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const l=Sg(new Uint8Array(e.getArrayBuffer(o))),u=new n(l.buffer);switch(t){case"b":case"c":return u.getBooleanArray(r);case"d":return u.getFloat64Array(r);case"f":return u.getFloat32Array(r);case"i":return u.getInt32Array(r);case"l":return u.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class n{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const r=i.indexOf(0);return r>=0&&(i=new Uint8Array(this.dv.buffer,t,r)),this._textDecoder.decode(i)}}class c{add(e,t){this[e]=t}}function d(a){const e=a.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function m(a){return a/46186158e3}const v=[];function w(a,e,t,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=a;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return function(l,u,h,f){for(let g=h,_=0;g<f;g++,_++)l[_]=u[g];return l}(v,i.buffer,s,o)}const C=new p.USm,P=new p.Pa4;function D(a){const e=new p.yGw,t=new p.yGw,i=new p.yGw,r=new p.yGw,s=new p.yGw,o=new p.yGw,l=new p.yGw,u=new p.yGw,h=new p.yGw,f=new p.yGw,g=new p.yGw,_=new p.yGw,A=a.inheritType?a.inheritType:0;if(a.translation&&e.setPosition(P.fromArray(a.translation)),a.preRotation){const re=a.preRotation.map(p.M8C.degToRad);re.push(a.eulerOrder||p.USm.DEFAULT_ORDER),t.makeRotationFromEuler(C.fromArray(re))}if(a.rotation){const re=a.rotation.map(p.M8C.degToRad);re.push(a.eulerOrder||p.USm.DEFAULT_ORDER),i.makeRotationFromEuler(C.fromArray(re))}if(a.postRotation){const re=a.postRotation.map(p.M8C.degToRad);re.push(a.eulerOrder||p.USm.DEFAULT_ORDER),r.makeRotationFromEuler(C.fromArray(re)),r.invert()}a.scale&&s.scale(P.fromArray(a.scale)),a.scalingOffset&&l.setPosition(P.fromArray(a.scalingOffset)),a.scalingPivot&&o.setPosition(P.fromArray(a.scalingPivot)),a.rotationOffset&&u.setPosition(P.fromArray(a.rotationOffset)),a.rotationPivot&&h.setPosition(P.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(g.copy(a.parentMatrix),f.copy(a.parentMatrixWorld));const x=t.clone().multiply(i).multiply(r),E=new p.yGw;E.extractRotation(f);const T=new p.yGw;T.copyPosition(f);const R=T.clone().invert().multiply(f),I=E.clone().invert().multiply(R),S=s,O=new p.yGw;if(A===0)O.copy(E).multiply(x).multiply(I).multiply(S);else if(A===1)O.copy(E).multiply(I).multiply(x).multiply(S);else{const re=new p.yGw().scale(new p.Pa4().setFromMatrixScale(g)).clone().invert(),ue=I.clone().multiply(re);O.copy(E).multiply(x).multiply(ue).multiply(S)}const k=h.clone().invert(),N=o.clone().invert();let H=e.clone().multiply(u).multiply(h).multiply(t).multiply(i).multiply(r).multiply(k).multiply(l).multiply(o).multiply(s).multiply(N);const X=new p.yGw().copyPosition(H),te=f.clone().multiply(X);return _.copyPosition(te),H=_.clone().multiply(O),H.premultiply(f.invert()),H}function B(a){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(a=a||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[a]}function j(a){return a.split(",").map(function(e){return parseFloat(e)})}function F(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=a.byteLength),new TextDecoder().decode(new Uint8Array(a,e,t))}function z(a,e,t){return a.slice(0,e).concat(t).concat(a.slice(e))}class G extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut],this._importer=new Tn(UE,["fbx"],!0)}async onAdded(e){var t,i;(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,i,r,s;!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&((s=(r=e.getManager())===null||r===void 0?void 0:r.importer)===null||s===void 0||s.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}G.PluginType="FBXLoadPlugin";const W=new p.cPb(45,1,.1,1e3);function Q(a,e,t,i=7,r=new p.Pa4(0,0,1.5)){t=t??a.scene.modelObject;const s=new Re().expandByObject(t??e,!0,!0),o=s.getCenter(new p.Pa4),l=s.getSize(new p.Pa4);W.position.copy(o).add(r.clone().multiplyScalar(Math.max(l.x,l.y,l.z))),W.lookAt(o),e&&e.traverseVisible(f=>{f.layers.enable(i)}),i>0?W.layers.set(i):W.layers.enableAll();const u=e==null?void 0:e.visible;e&&(e.visible=!0),a.renderer.rendererObject.setRenderTarget(null),a.renderer.rendererObject.render(t,W);const h=a.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=u,e.traverseVisible(f=>{f.layers.disable(i)}),W.layers.enableAll()),a.setDirty(),h}class ${constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new p.Kj0(new p.xo$(1)),cube:new p.Kj0(new p.DvJ(1,1,1)),cylinder:new p.Kj0(new p.fHI(.5,.5,1))};const t=new p.xsS;this._channel=7;const i=new p.vmT(16777215,4473924,1);i.position.set(0,10,0),i.layers.set(this._channel),t.add(i),this._lights.push(i),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const i=this.shapes[t]||new p.Kj0(new p.xo$(1));i.material=e.materialObject,i.geometry.attributes.tangent||i.geometry.computeTangents(),this._scene.add(i),this._scene.environment=this.viewer.scene.environment;const r=i.material.envMapIntensity;typeof r=="number"&&(i.material.envMapIntensity=Math.max(r,2));const s=Q(this.viewer,i,this._scene,this._channel,new p.Pa4(0,0,1.5));return typeof r=="number"&&(i.material.envMapIntensity=r),this._scene.remove(i),i.material=void 0,s}}class Y extends Si{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e))},this.dependencies=[Ut],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"mapping",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"uuid"],onChange:async()=>this.refreshUi()},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys($l).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]},this.addEventListener("deserialize",this.refreshUi),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){var t,i;await super.onAdded(e),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new $(this._viewer),(i=this._picking)===null||i===void 0||i.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi)}reapplyAll(){this.variations.forEach(e=>{var t;return this.applyVariation(e,e.materials[(t=e.selectedIndex)!==null&&t!==void 0?t:0].uuid)})}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)?(e.applyOnLoad===void 0&&(this.applyOnLoad=!1),this.applyOnLoad&&this.reapplyAll(),this):null}async onRemove(e){var t,i;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(i=this._picking)===null||i===void 0||i.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())===null||t===void 0?void 0:t.name)}applyVariation(e,t){var i,r;const s=e.materials.find(l=>l.uuid===t),o=(r=(i=this._viewer)===null||i===void 0?void 0:i.getManager())===null||r===void 0?void 0:r.materials;return!!o&&!!s&&(e.selectedIndex=e.materials.indexOf(s),o.applyMaterial(s,e.uuid))}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const i=(t=e==null?void 0:e.clone)===null||t===void 0?void 0:t.call(e);if(e&&i){let r=this.findVariation(e.uuid);!r&&e.name.length>0&&(r=this.findVariation(e.name)),r||this.variations.push(r={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),r.materials.push(i),this.refreshUi()}}}Y.PluginType="MaterialConfiguratorPlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([ae()],Y.prototype,"variations",void 0);class q{static _initializeStyles(){(0,V.createStyles)(V.css`
  .customContextGrid {
    background: #eeeeee55;
    border: 0.5px solid rgba(220, 220, 220, 0.2);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 6px rgba(12, 12, 12, 0.2);

    color: #111111;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
    backdrop-filter: blur(20px);
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }

  .customContextGridItems:hover {
    color: white;
    //background-color: #017AFF;
    box-shadow: 0 0 7px 0px rgba(64, 64, 64, 0.3);
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 5px;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `,this._container),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,t,i,r,s,o,l){var u;const h=(0,V.mobileAndTabletCheck)(),f=h?.15:.25,g=h?1.5:2.5,_=(0,V.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});_.style.top=s+"px",_.style.left=r+"px",_.style.gap=f+"rem",_.style.width=(g+f)*i-f+"rem",_.dataset.tag=e;for(const A of o){const x=(0,V.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${A.image}" class="customContextGridItemImage">
            `});x.style.width=g+"rem",x.style.height=g+"rem",_.appendChild(x),x.onclick=()=>{var E;return(E=A.onClick)===null||E===void 0?void 0:E.call(A,A.id)},l(x,A,_)}return(u=this.Elements)===null||u===void 0||u.push(_),_}static RemoveAll(e){if(e){const t=this.Elements.filter(i=>i.dataset.tag===e);for(const i of t)i.remove();this.Elements=this.Elements.filter(i=>i.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,V.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const i of this.Elements)i.remove();this._container.innerHTML="",this._initializeStyles();let t=20;e.appendChild(this._container);for(const i of this.Elements)i.style.top=t+"px",this._container.appendChild(i),t+=i.clientHeight+20}}function be(a){if(a==null)return window;if(a.toString()!=="[object Window]"){var e=a.ownerDocument;return e&&e.defaultView||window}return a}function we(a){return a instanceof be(a).Element||a instanceof Element}function me(a){return a instanceof be(a).HTMLElement||a instanceof HTMLElement}function Be(a){return typeof ShadowRoot<"u"&&(a instanceof be(a).ShadowRoot||a instanceof ShadowRoot)}q.Elements=[],q._container=document.createElement("div");var Ze=Math.max,et=Math.min,ft=Math.round;function Le(){var a=navigator.userAgentData;return a!=null&&a.brands?a.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gt(){return!/^((?!chrome|android).)*safari/i.test(Le())}function Ht(a,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=a.getBoundingClientRect(),r=1,s=1;e&&me(a)&&(r=a.offsetWidth>0&&ft(i.width)/a.offsetWidth||1,s=a.offsetHeight>0&&ft(i.height)/a.offsetHeight||1);var o=(we(a)?be(a):window).visualViewport,l=!Gt()&&t,u=(i.left+(l&&o?o.offsetLeft:0))/r,h=(i.top+(l&&o?o.offsetTop:0))/s,f=i.width/r,g=i.height/s;return{width:f,height:g,top:h,right:u+f,bottom:h+g,left:u,x:u,y:h}}function ri(a){var e=be(a);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function hi(a){return a?(a.nodeName||"").toLowerCase():null}function ei(a){return((we(a)?a.ownerDocument:a.document)||window.document).documentElement}function Xt(a){return Ht(ei(a)).left+ri(a).scrollLeft}function oi(a){return be(a).getComputedStyle(a)}function Pt(a){var e=oi(a),t=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+i)}function Nt(a,e,t){t===void 0&&(t=!1);var i,r,s=me(e),o=me(e)&&function(g){var _=g.getBoundingClientRect(),A=ft(_.width)/g.offsetWidth||1,x=ft(_.height)/g.offsetHeight||1;return A!==1||x!==1}(e),l=ei(e),u=Ht(a,o,t),h={scrollLeft:0,scrollTop:0},f={x:0,y:0};return(s||!s&&!t)&&((hi(e)!=="body"||Pt(l))&&(h=(i=e)!==be(i)&&me(i)?{scrollLeft:(r=i).scrollLeft,scrollTop:r.scrollTop}:ri(i)),me(e)?((f=Ht(e,!0)).x+=e.clientLeft,f.y+=e.clientTop):l&&(f.x=Xt(l))),{x:u.left+h.scrollLeft-f.x,y:u.top+h.scrollTop-f.y,width:u.width,height:u.height}}function ci(a){var e=Ht(a),t=a.offsetWidth,i=a.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:a.offsetLeft,y:a.offsetTop,width:t,height:i}}function pi(a){return hi(a)==="html"?a:a.assignedSlot||a.parentNode||(Be(a)?a.host:null)||ei(a)}function $i(a){return["html","body","#document"].indexOf(hi(a))>=0?a.ownerDocument.body:me(a)&&Pt(a)?a:$i(pi(a))}function yi(a,e){var t;e===void 0&&(e=[]);var i=$i(a),r=i===((t=a.ownerDocument)==null?void 0:t.body),s=be(i),o=r?[s].concat(s.visualViewport||[],Pt(i)?i:[]):i,l=e.concat(o);return r?l:l.concat(yi(pi(o)))}function qi(a){return["table","td","th"].indexOf(hi(a))>=0}function Ri(a){return me(a)&&oi(a).position!=="fixed"?a.offsetParent:null}function De(a){for(var e=be(a),t=Ri(a);t&&qi(t)&&oi(t).position==="static";)t=Ri(t);return t&&(hi(t)==="html"||hi(t)==="body"&&oi(t).position==="static")?e:t||function(i){var r=/firefox/i.test(Le());if(/Trident/i.test(Le())&&me(i)&&oi(i).position==="fixed")return null;var s=pi(i);for(Be(s)&&(s=s.host);me(s)&&["html","body"].indexOf(hi(s))<0;){var o=oi(s);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||r&&o.willChange==="filter"||r&&o.filter&&o.filter!=="none")return s;s=s.parentNode}return null}(a)||e}var Me="top",Ge="bottom",ht="right",Oe="left",ye="auto",ke=[Me,Ge,ht,Oe],ze="start",rt="end",Et="clippingParents",Vt="viewport",Yt="popper",Fi="reference",Ki=ke.reduce(function(a,e){return a.concat([e+"-"+ze,e+"-"+rt])},[]),Ti=[].concat(ke,[ye]).reduce(function(a,e){return a.concat([e,e+"-"+ze,e+"-"+rt])},[]),tr="beforeRead",dr="read",Jr="afterRead",nr="beforeMain",qr="main",os="afterMain",Zi="beforeWrite",Fr="write",ln="afterWrite",Cg=[tr,dr,Jr,nr,qr,os,Zi,Fr,ln];function em(a){var e=new Map,t=new Set,i=[];function r(s){t.add(s.name),[].concat(s.requires||[],s.requiresIfExists||[]).forEach(function(o){if(!t.has(o)){var l=e.get(o);l&&r(l)}}),i.push(s)}return a.forEach(function(s){e.set(s.name,s)}),a.forEach(function(s){t.has(s.name)||r(s)}),i}var sl={placement:"bottom",modifiers:[],strategy:"absolute"};function al(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Ju(a){a===void 0&&(a={});var e=a,t=e.defaultModifiers,i=t===void 0?[]:t,r=e.defaultOptions,s=r===void 0?sl:r;return function(o,l,u){u===void 0&&(u=s);var h,f,g={placement:"bottom",orderedModifiers:[],options:Object.assign({},sl,s),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},_=[],A=!1,x={state:g,setOptions:function(T){var R=typeof T=="function"?T(g.options):T;E(),g.options=Object.assign({},s,g.options,R),g.scrollParents={reference:we(o)?yi(o):o.contextElement?yi(o.contextElement):[],popper:yi(l)};var I,S,O=function(k){var N=em(k);return Cg.reduce(function(H,X){return H.concat(N.filter(function(te){return te.phase===X}))},[])}((I=[].concat(i,g.options.modifiers),S=I.reduce(function(k,N){var H=k[N.name];return k[N.name]=H?Object.assign({},H,N,{options:Object.assign({},H.options,N.options),data:Object.assign({},H.data,N.data)}):N,k},{}),Object.keys(S).map(function(k){return S[k]})));return g.orderedModifiers=O.filter(function(k){return k.enabled}),g.orderedModifiers.forEach(function(k){var N=k.name,H=k.options,X=H===void 0?{}:H,te=k.effect;if(typeof te=="function"){var re=te({state:g,name:N,instance:x,options:X});_.push(re||function(){})}}),x.update()},forceUpdate:function(){if(!A){var T=g.elements,R=T.reference,I=T.popper;if(al(R,I)){g.rects={reference:Nt(R,De(I),g.options.strategy==="fixed"),popper:ci(I)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(te){return g.modifiersData[te.name]=Object.assign({},te.data)});for(var S=0;S<g.orderedModifiers.length;S++)if(g.reset!==!0){var O=g.orderedModifiers[S],k=O.fn,N=O.options,H=N===void 0?{}:N,X=O.name;typeof k=="function"&&(g=k({state:g,options:H,name:X,instance:x})||g)}else g.reset=!1,S=-1}}},update:(h=function(){return new Promise(function(T){x.forceUpdate(),T(g)})},function(){return f||(f=new Promise(function(T){Promise.resolve().then(function(){f=void 0,T(h())})})),f}),destroy:function(){E(),A=!0}};if(!al(o,l))return x;function E(){_.forEach(function(T){return T()}),_=[]}return x.setOptions(u).then(function(T){!A&&u.onFirstUpdate&&u.onFirstUpdate(T)}),x}}var Dt=Ju(),bp={passive:!0},Ap={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(a){var e=a.state,t=a.instance,i=a.options,r=i.scroll,s=r===void 0||r,o=i.resize,l=o===void 0||o,u=be(e.elements.popper),h=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&h.forEach(function(f){f.addEventListener("scroll",t.update,bp)}),l&&u.addEventListener("resize",t.update,bp),function(){s&&h.forEach(function(f){f.removeEventListener("scroll",t.update,bp)}),l&&u.removeEventListener("resize",t.update,bp)}},data:{}};function Bs(a){return a.split("-")[0]}function wp(a){return a.split("-")[1]}function k0(a){return["top","bottom"].indexOf(a)>=0?"x":"y"}function eb(a){var e,t=a.reference,i=a.element,r=a.placement,s=r?Bs(r):null,o=r?wp(r):null,l=t.x+t.width/2-i.width/2,u=t.y+t.height/2-i.height/2;switch(s){case Me:e={x:l,y:t.y-i.height};break;case Ge:e={x:l,y:t.y+t.height};break;case ht:e={x:t.x+t.width,y:u};break;case Oe:e={x:t.x-i.width,y:u};break;default:e={x:t.x,y:t.y}}var h=s?k0(s):null;if(h!=null){var f=h==="y"?"height":"width";switch(o){case ze:e[h]=e[h]-(t[f]/2-i[f]/2);break;case rt:e[h]=e[h]+(t[f]/2-i[f]/2)}}return e}var U0={name:"popperOffsets",enabled:!0,phase:"read",fn:function(a){var e=a.state,t=a.name;e.modifiersData[t]=eb({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},tb={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ib(a){var e,t=a.popper,i=a.popperRect,r=a.placement,s=a.variation,o=a.offsets,l=a.position,u=a.gpuAcceleration,h=a.adaptive,f=a.roundOffsets,g=a.isFixed,_=o.x,A=_===void 0?0:_,x=o.y,E=x===void 0?0:x,T=typeof f=="function"?f({x:A,y:E}):{x:A,y:E};A=T.x,E=T.y;var R=o.hasOwnProperty("x"),I=o.hasOwnProperty("y"),S=Oe,O=Me,k=window;if(h){var N=De(t),H="clientHeight",X="clientWidth";N===be(t)&&oi(N=ei(t)).position!=="static"&&l==="absolute"&&(H="scrollHeight",X="scrollWidth"),(r===Me||(r===Oe||r===ht)&&s===rt)&&(O=Ge,E-=(g&&N===k&&k.visualViewport?k.visualViewport.height:N[H])-i.height,E*=u?1:-1),r!==Oe&&(r!==Me&&r!==Ge||s!==rt)||(S=ht,A-=(g&&N===k&&k.visualViewport?k.visualViewport.width:N[X])-i.width,A*=u?1:-1)}var te,re=Object.assign({position:l},h&&tb),ue=f===!0?function(le){var se=le.x,de=le.y,ve=window.devicePixelRatio||1;return{x:ft(se*ve)/ve||0,y:ft(de*ve)/ve||0}}({x:A,y:E}):{x:A,y:E};return A=ue.x,E=ue.y,u?Object.assign({},re,((te={})[O]=I?"0":"",te[S]=R?"0":"",te.transform=(k.devicePixelRatio||1)<=1?"translate("+A+"px, "+E+"px)":"translate3d("+A+"px, "+E+"px, 0)",te)):Object.assign({},re,((e={})[O]=I?E+"px":"",e[S]=R?A+"px":"",e.transform="",e))}var N0={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(a){var e=a.state,t=a.options,i=t.gpuAcceleration,r=i===void 0||i,s=t.adaptive,o=s===void 0||s,l=t.roundOffsets,u=l===void 0||l,h={placement:Bs(e.placement),variation:wp(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ib(Object.assign({},h,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:u})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ib(Object.assign({},h,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},su={name:"applyStyles",enabled:!0,phase:"write",fn:function(a){var e=a.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},s=e.elements[t];me(s)&&hi(s)&&(Object.assign(s.style,i),Object.keys(r).forEach(function(o){var l=r[o];l===!1?s.removeAttribute(o):s.setAttribute(o,l===!0?"":l)}))})},effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],s=e.attributes[i]||{},o=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]).reduce(function(l,u){return l[u]="",l},{});me(r)&&hi(r)&&(Object.assign(r.style,o),Object.keys(s).forEach(function(l){r.removeAttribute(l)}))})}},requires:["computeStyles"]},rb={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(a){var e=a.state,t=a.options,i=a.name,r=t.offset,s=r===void 0?[0,0]:r,o=Ti.reduce(function(f,g){return f[g]=function(_,A,x){var E=Bs(_),T=[Oe,Me].indexOf(E)>=0?-1:1,R=typeof x=="function"?x(Object.assign({},A,{placement:_})):x,I=R[0],S=R[1];return I=I||0,S=(S||0)*T,[Oe,ht].indexOf(E)>=0?{x:S,y:I}:{x:I,y:S}}(g,e.rects,s),f},{}),l=o[e.placement],u=l.x,h=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=u,e.modifiersData.popperOffsets.y+=h),e.modifiersData[i]=o}},Ew={left:"right",right:"left",bottom:"top",top:"bottom"};function xp(a){return a.replace(/left|right|bottom|top/g,function(e){return Ew[e]})}var Sw={start:"end",end:"start"};function Mg(a){return a.replace(/start|end/g,function(e){return Sw[e]})}function nb(a,e){var t=e.getRootNode&&e.getRootNode();if(a.contains(e))return!0;if(t&&Be(t)){var i=e;do{if(i&&a.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Pe(a){return Object.assign({},a,{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height})}function Lt(a,e,t){return e===Vt?Pe(function(i,r){var s=be(i),o=ei(i),l=s.visualViewport,u=o.clientWidth,h=o.clientHeight,f=0,g=0;if(l){u=l.width,h=l.height;var _=Gt();(_||!_&&r==="fixed")&&(f=l.offsetLeft,g=l.offsetTop)}return{width:u,height:h,x:f+Xt(i),y:g}}(a,t)):we(e)?function(i,r){var s=Ht(i,!1,r==="fixed");return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e,t):Pe(function(i){var r,s=ei(i),o=ri(i),l=(r=i.ownerDocument)==null?void 0:r.body,u=Ze(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),h=Ze(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),f=-o.scrollLeft+Xt(i),g=-o.scrollTop;return oi(l||s).direction==="rtl"&&(f+=Ze(s.clientWidth,l?l.clientWidth:0)-u),{width:u,height:h,x:f,y:g}}(ei(a)))}function Kt(a){return Object.assign({},{top:0,right:0,bottom:0,left:0},a)}function qt(a,e){return e.reduce(function(t,i){return t[i]=a,t},{})}function ii(a,e){e===void 0&&(e={});var t=e,i=t.placement,r=i===void 0?a.placement:i,s=t.strategy,o=s===void 0?a.strategy:s,l=t.boundary,u=l===void 0?Et:l,h=t.rootBoundary,f=h===void 0?Vt:h,g=t.elementContext,_=g===void 0?Yt:g,A=t.altBoundary,x=A!==void 0&&A,E=t.padding,T=E===void 0?0:E,R=Kt(typeof T!="number"?T:qt(T,ke)),I=_===Yt?Fi:Yt,S=a.rects.popper,O=a.elements[x?I:_],k=function(se,de,ve,fe){var Ee=de==="clippingParents"?function(Ve){var Ye=yi(pi(Ve)),Tt=["absolute","fixed"].indexOf(oi(Ve).position)>=0&&me(Ve)?De(Ve):Ve;return we(Tt)?Ye.filter(function(Xe){return we(Xe)&&nb(Xe,Tt)&&hi(Xe)!=="body"}):[]}(se):[].concat(de),Je=[].concat(Ee,[ve]),Te=Je[0],qe=Je.reduce(function(Ve,Ye){var Tt=Lt(se,Ye,fe);return Ve.top=Ze(Tt.top,Ve.top),Ve.right=et(Tt.right,Ve.right),Ve.bottom=et(Tt.bottom,Ve.bottom),Ve.left=Ze(Tt.left,Ve.left),Ve},Lt(se,Te,fe));return qe.width=qe.right-qe.left,qe.height=qe.bottom-qe.top,qe.x=qe.left,qe.y=qe.top,qe}(we(O)?O:O.contextElement||ei(a.elements.popper),u,f,o),N=Ht(a.elements.reference),H=eb({reference:N,element:S,strategy:"absolute",placement:r}),X=Pe(Object.assign({},S,H)),te=_===Yt?X:N,re={top:k.top-te.top+R.top,bottom:te.bottom-k.bottom+R.bottom,left:k.left-te.left+R.left,right:te.right-k.right+R.right},ue=a.modifiersData.offset;if(_===Yt&&ue){var le=ue[r];Object.keys(re).forEach(function(se){var de=[ht,Ge].indexOf(se)>=0?1:-1,ve=[Me,Ge].indexOf(se)>=0?"y":"x";re[se]+=le[ve]*de})}return re}var Ei={name:"flip",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,i=a.name;if(!e.modifiersData[i]._skip){for(var r=t.mainAxis,s=r===void 0||r,o=t.altAxis,l=o===void 0||o,u=t.fallbackPlacements,h=t.padding,f=t.boundary,g=t.rootBoundary,_=t.altBoundary,A=t.flipVariations,x=A===void 0||A,E=t.allowedAutoPlacements,T=e.options.placement,R=Bs(T),I=u||(R!==T&&x?function(Ve){if(Bs(Ve)===ye)return[];var Ye=xp(Ve);return[Mg(Ve),Ye,Mg(Ye)]}(T):[xp(T)]),S=[T].concat(I).reduce(function(Ve,Ye){return Ve.concat(Bs(Ye)===ye?function(Tt,Xe){Xe===void 0&&(Xe={});var Zt=Xe,di=Zt.placement,Ai=Zt.boundary,Wi=Zt.rootBoundary,Gi=Zt.padding,Ui=Zt.flipVariations,wt=Zt.allowedAutoPlacements,yt=wt===void 0?Ti:wt,li=wp(di),ar=li?Ui?Ki:Ki.filter(function(nt){return wp(nt)===li}):ke,ge=ar.filter(function(nt){return yt.indexOf(nt)>=0});ge.length===0&&(ge=ar);var je=ge.reduce(function(nt,St){return nt[St]=ii(Tt,{placement:St,boundary:Ai,rootBoundary:Wi,padding:Gi})[Bs(St)],nt},{});return Object.keys(je).sort(function(nt,St){return je[nt]-je[St]})}(e,{placement:Ye,boundary:f,rootBoundary:g,padding:h,flipVariations:x,allowedAutoPlacements:E}):Ye)},[]),O=e.rects.reference,k=e.rects.popper,N=new Map,H=!0,X=S[0],te=0;te<S.length;te++){var re=S[te],ue=Bs(re),le=wp(re)===ze,se=[Me,Ge].indexOf(ue)>=0,de=se?"width":"height",ve=ii(e,{placement:re,boundary:f,rootBoundary:g,altBoundary:_,padding:h}),fe=se?le?ht:Oe:le?Ge:Me;O[de]>k[de]&&(fe=xp(fe));var Ee=xp(fe),Je=[];if(s&&Je.push(ve[ue]<=0),l&&Je.push(ve[fe]<=0,ve[Ee]<=0),Je.every(function(Ve){return Ve})){X=re,H=!1;break}N.set(re,Je)}if(H)for(var Te=function(Ve){var Ye=S.find(function(Tt){var Xe=N.get(Tt);if(Xe)return Xe.slice(0,Ve).every(function(Zt){return Zt})});if(Ye)return X=Ye,"break"},qe=x?3:1;qe>0&&Te(qe)!=="break";qe--);e.placement!==X&&(e.modifiersData[i]._skip=!0,e.placement=X,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Cr(a,e,t){return Ze(a,et(e,t))}var ir={name:"preventOverflow",enabled:!0,phase:"main",fn:function(a){var e=a.state,t=a.options,i=a.name,r=t.mainAxis,s=r===void 0||r,o=t.altAxis,l=o!==void 0&&o,u=t.boundary,h=t.rootBoundary,f=t.altBoundary,g=t.padding,_=t.tether,A=_===void 0||_,x=t.tetherOffset,E=x===void 0?0:x,T=ii(e,{boundary:u,rootBoundary:h,padding:g,altBoundary:f}),R=Bs(e.placement),I=wp(e.placement),S=!I,O=k0(R),k=O==="x"?"y":"x",N=e.modifiersData.popperOffsets,H=e.rects.reference,X=e.rects.popper,te=typeof E=="function"?E(Object.assign({},e.rects,{placement:e.placement})):E,re=typeof te=="number"?{mainAxis:te,altAxis:te}:Object.assign({mainAxis:0,altAxis:0},te),ue=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,le={x:0,y:0};if(N){if(s){var se,de=O==="y"?Me:Oe,ve=O==="y"?Ge:ht,fe=O==="y"?"height":"width",Ee=N[O],Je=Ee+T[de],Te=Ee-T[ve],qe=A?-X[fe]/2:0,Ve=I===ze?H[fe]:X[fe],Ye=I===ze?-X[fe]:-H[fe],Tt=e.elements.arrow,Xe=A&&Tt?ci(Tt):{width:0,height:0},Zt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},di=Zt[de],Ai=Zt[ve],Wi=Cr(0,H[fe],Xe[fe]),Gi=S?H[fe]/2-qe-Wi-di-re.mainAxis:Ve-Wi-di-re.mainAxis,Ui=S?-H[fe]/2+qe+Wi+Ai+re.mainAxis:Ye+Wi+Ai+re.mainAxis,wt=e.elements.arrow&&De(e.elements.arrow),yt=wt?O==="y"?wt.clientTop||0:wt.clientLeft||0:0,li=(se=ue==null?void 0:ue[O])!=null?se:0,ar=Ee+Ui-li,ge=Cr(A?et(Je,Ee+Gi-li-yt):Je,Ee,A?Ze(Te,ar):Te);N[O]=ge,le[O]=ge-Ee}if(l){var je,nt=O==="x"?Me:Oe,St=O==="x"?Ge:ht,bt=N[k],Ae=k==="y"?"height":"width",st=bt+T[nt],zt=bt-T[St],si=[Me,Oe].indexOf(R)!==-1,ni=(je=ue==null?void 0:ue[k])!=null?je:0,vi=si?st:bt-H[Ae]-X[Ae]-ni+re.altAxis,Pi=si?bt+H[Ae]+X[Ae]-ni-re.altAxis:zt,wi=A&&si?function(bi,Hi,ui){var Ii=Cr(bi,Hi,ui);return Ii>ui?ui:Ii}(vi,bt,Pi):Cr(A?vi:st,bt,A?Pi:zt);N[k]=wi,le[k]=wi-bt}e.modifiersData[i]=le}},requiresIfExists:["offset"]},wr={name:"arrow",enabled:!0,phase:"main",fn:function(a){var e,t=a.state,i=a.name,r=a.options,s=t.elements.arrow,o=t.modifiersData.popperOffsets,l=Bs(t.placement),u=k0(l),h=[Oe,ht].indexOf(l)>=0?"height":"width";if(s&&o){var f=function(X,te){return Kt(typeof(X=typeof X=="function"?X(Object.assign({},te.rects,{placement:te.placement})):X)!="number"?X:qt(X,ke))}(r.padding,t),g=ci(s),_=u==="y"?Me:Oe,A=u==="y"?Ge:ht,x=t.rects.reference[h]+t.rects.reference[u]-o[u]-t.rects.popper[h],E=o[u]-t.rects.reference[u],T=De(s),R=T?u==="y"?T.clientHeight||0:T.clientWidth||0:0,I=x/2-E/2,S=f[_],O=R-g[h]-f[A],k=R/2-g[h]/2+I,N=Cr(S,k,O),H=u;t.modifiersData[i]=((e={})[H]=N,e.centerOffset=N-k,e)}},effect:function(a){var e=a.state,t=a.options.element,i=t===void 0?"[data-popper-arrow]":t;i!=null&&(typeof i!="string"||(i=e.elements.popper.querySelector(i)))&&nb(e.elements.popper,i)&&(e.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function jr(a,e,t){return t===void 0&&(t={x:0,y:0}),{top:a.top-e.height-t.y,right:a.right-e.width+t.x,bottom:a.bottom-e.height+t.y,left:a.left-e.width-t.x}}function Rr(a){return[Me,ht,Ge,Oe].some(function(e){return a[e]>=0})}var mr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(a){var e=a.state,t=a.name,i=e.rects.reference,r=e.rects.popper,s=e.modifiersData.preventOverflow,o=ii(e,{elementContext:"reference"}),l=ii(e,{altBoundary:!0}),u=jr(o,i),h=jr(l,r,s),f=Rr(u),g=Rr(h);e.modifiersData[t]={referenceClippingOffsets:u,popperEscapeOffsets:h,isReferenceHidden:f,hasPopperEscaped:g},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":g})}},ls=Ju({defaultModifiers:[Ap,U0,N0,su,rb,Ei,ir,wr,mr]}),ol="tippy-box",Qs="tippy-content",Xh="tippy-backdrop",Es="tippy-arrow",Kn="tippy-svg-arrow",Ws={passive:!0,capture:!0},Po=function(){return document.body};function Vi(a,e,t){if(Array.isArray(a)){var i=a[e];return i??(Array.isArray(t)?t[e]:t)}return a}function cs(a,e){var t={}.toString.call(a);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function tm(a,e){return typeof a=="function"?a.apply(void 0,e):a}function Cw(a,e){return e===0?a:function(i){clearTimeout(t),t=setTimeout(function(){a(i)},e)};var t}function Ep(a){return[].concat(a)}function Tg(a,e){a.indexOf(e)===-1&&a.push(e)}function F0(a){return[].slice.call(a)}function Mw(a){return Object.keys(a).reduce(function(e,t){return a[t]!==void 0&&(e[t]=a[t]),e},{})}function im(){return document.createElement("div")}function j0(a){return["Element","Fragment"].some(function(e){return cs(a,e)})}function sb(a,e){a.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Tw(a,e){a.forEach(function(t){t&&t.setAttribute("data-state",e)})}function z0(a,e,t){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){a[i](r,t)})}function Iw(a,e){for(var t=e;t;){var i;if(a.contains(t))return!0;t=t.getRootNode==null||(i=t.getRootNode())==null?void 0:i.host}return!1}var Or={isTouch:!1},Pw=0;function $u(){Or.isTouch||(Or.isTouch=!0,window.performance&&document.addEventListener("mousemove",qh))}function qh(){var a=performance.now();a-Pw<20&&(Or.isTouch=!1,document.removeEventListener("mousemove",qh)),Pw=a}function Rw(){var a,e=document.activeElement;if((a=e)&&a._tippy&&a._tippy.reference===a){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var Ig=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),ll=Object.assign({appendTo:Po,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),Na=Object.keys(ll);function Yh(a){var e=(a.plugins||[]).reduce(function(t,i){var r,s=i.name,o=i.defaultValue;return s&&(t[s]=a[s]!==void 0?a[s]:(r=ll[s])!=null?r:o),t},{});return Object.assign({},a,e)}function V0(a,e){var t=Object.assign({},e,{content:tm(e.content,[a])},e.ignoreAttributes?{}:function(i,r){return(r?Object.keys(Yh(Object.assign({},ll,{plugins:r}))):Na).reduce(function(s,o){var l=(i.getAttribute("data-tippy-"+o)||"").trim();if(!l)return s;if(o==="content")s[o]=l;else try{s[o]=JSON.parse(l)}catch{s[o]=l}return s},{})}(a,e.plugins));return t.aria=Object.assign({},ll.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var au=function(){return"innerHTML"};function cl(a,e){a[au()]=e}function ab(a){var e=im();return a===!0?e.className=Es:(e.className=Kn,j0(a)?e.appendChild(a):cl(e,a)),e}function Fa(a,e){j0(e.content)?(cl(a,""),a.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?cl(a,e.content):a.textContent=e.content)}function Sp(a){var e=a.firstElementChild,t=F0(e.children);return{box:e,content:t.find(function(i){return i.classList.contains(Qs)}),arrow:t.find(function(i){return i.classList.contains(Es)||i.classList.contains(Kn)}),backdrop:t.find(function(i){return i.classList.contains(Xh)})}}function Dw(a){var e=im(),t=im();t.className=ol,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var i=im();function r(s,o){var l=Sp(e),u=l.box,h=l.content,f=l.arrow;o.theme?u.setAttribute("data-theme",o.theme):u.removeAttribute("data-theme"),typeof o.animation=="string"?u.setAttribute("data-animation",o.animation):u.removeAttribute("data-animation"),o.inertia?u.setAttribute("data-inertia",""):u.removeAttribute("data-inertia"),u.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?u.setAttribute("role",o.role):u.removeAttribute("role"),s.content===o.content&&s.allowHTML===o.allowHTML||Fa(h,a.props),o.arrow?f?s.arrow!==o.arrow&&(u.removeChild(f),u.appendChild(ab(o.arrow))):u.appendChild(ab(o.arrow)):f&&u.removeChild(f)}return i.className=Qs,i.setAttribute("data-state","hidden"),Fa(i,a.props),e.appendChild(t),t.appendChild(i),r(a.props,a.props),{popper:e,onUpdate:r}}Dw.$$tippy=!0;var Bw=1,Ow=[],VE=[];function fP(a,e){var t,i,r,s,o,l,u,h,f=V0(a,Object.assign({},ll,Yh(Mw(e)))),g=!1,_=!1,A=!1,x=!1,E=[],T=Cw(wt,f.interactiveDebounce),R=Bw++,I=(h=f.plugins).filter(function(Ae,st){return h.indexOf(Ae)===st}),S={id:R,reference:a,popper:im(),popperInstance:null,props:f,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:I,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(i),cancelAnimationFrame(r)},setProps:function(Ae){if(!S.state.isDestroyed){Ee("onBeforeUpdate",[S,Ae]),Gi();var st=S.props,zt=V0(a,Object.assign({},st,Mw(Ae),{ignoreAttributes:!0}));S.props=zt,Wi(),st.interactiveDebounce!==zt.interactiveDebounce&&(qe(),T=Cw(wt,zt.interactiveDebounce)),st.triggerTarget&&!zt.triggerTarget?Ep(st.triggerTarget).forEach(function(si){si.removeAttribute("aria-expanded")}):zt.triggerTarget&&a.removeAttribute("aria-expanded"),Te(),fe(),N&&N(st,zt),S.popperInstance&&(ge(),nt().forEach(function(si){requestAnimationFrame(si._tippy.popperInstance.forceUpdate)})),Ee("onAfterUpdate",[S,Ae])}},setContent:function(Ae){S.setProps({content:Ae})},show:function(){var Ae=S.state.isVisible,st=S.state.isDestroyed,zt=!S.state.isEnabled,si=Or.isTouch&&!S.props.touch,ni=Vi(S.props.duration,0,ll.duration);if(!(Ae||st||zt||si||le().hasAttribute("disabled")||(Ee("onShow",[S],!1),S.props.onShow(S)===!1))){if(S.state.isVisible=!0,ue()&&(k.style.visibility="visible"),fe(),Xe(),S.state.isMounted||(k.style.transition="none"),ue()){var vi=de();sb([vi.box,vi.content],0)}var Pi,wi,bi;l=function(){var Hi;if(S.state.isVisible&&!x){if(x=!0,k.offsetHeight,k.style.transition=S.props.moveTransition,ue()&&S.props.animation){var ui=de(),Ii=ui.box,Bi=ui.content;sb([Ii,Bi],ni),Tw([Ii,Bi],"visible")}Je(),Te(),Tg(VE,S),(Hi=S.popperInstance)==null||Hi.forceUpdate(),Ee("onMount",[S]),S.props.animation&&ue()&&function(er,Cn){di(er,function(){S.state.isShown=!0,Ee("onShown",[S])})}(ni)}},wi=S.props.appendTo,bi=le(),(Pi=S.props.interactive&&wi===Po||wi==="parent"?bi.parentNode:tm(wi,[bi])).contains(k)||Pi.appendChild(k),S.state.isMounted=!0,ge()}},hide:function(){var Ae=!S.state.isVisible,st=S.state.isDestroyed,zt=!S.state.isEnabled,si=Vi(S.props.duration,1,ll.duration);if(!(Ae||st||zt)&&(Ee("onHide",[S],!1),S.props.onHide(S)!==!1)){if(S.state.isVisible=!1,S.state.isShown=!1,x=!1,g=!1,ue()&&(k.style.visibility="hidden"),qe(),Zt(),fe(!0),ue()){var ni=de(),vi=ni.box,Pi=ni.content;S.props.animation&&(sb([vi,Pi],si),Tw([vi,Pi],"hidden"))}Je(),Te(),S.props.animation?ue()&&function(wi,bi){di(wi,function(){!S.state.isVisible&&k.parentNode&&k.parentNode.contains(k)&&bi()})}(si,S.unmount):S.unmount()}},hideWithInteractivity:function(Ae){se().addEventListener("mousemove",T),Tg(Ow,T),T(Ae)},enable:function(){S.state.isEnabled=!0},disable:function(){S.hide(),S.state.isEnabled=!1},unmount:function(){S.state.isVisible&&S.hide(),S.state.isMounted&&(je(),nt().forEach(function(Ae){Ae._tippy.unmount()}),k.parentNode&&k.parentNode.removeChild(k),VE=VE.filter(function(Ae){return Ae!==S}),S.state.isMounted=!1,Ee("onHidden",[S]))},destroy:function(){S.state.isDestroyed||(S.clearDelayTimeouts(),S.unmount(),Gi(),delete a._tippy,S.state.isDestroyed=!0,Ee("onDestroy",[S]))}};if(!f.render)return S;var O=f.render(S),k=O.popper,N=O.onUpdate;k.setAttribute("data-tippy-root",""),k.id="tippy-"+S.id,S.popper=k,a._tippy=S,k._tippy=S;var H=I.map(function(Ae){return Ae.fn(S)}),X=a.hasAttribute("aria-expanded");return Wi(),Te(),fe(),Ee("onCreate",[S]),f.showOnCreate&&St(),k.addEventListener("mouseenter",function(){S.props.interactive&&S.state.isVisible&&S.clearDelayTimeouts()}),k.addEventListener("mouseleave",function(){S.props.interactive&&S.props.trigger.indexOf("mouseenter")>=0&&se().addEventListener("mousemove",T)}),S;function te(){var Ae=S.props.touch;return Array.isArray(Ae)?Ae:[Ae,0]}function re(){return te()[0]==="hold"}function ue(){var Ae;return!((Ae=S.props.render)==null||!Ae.$$tippy)}function le(){return u||a}function se(){var Ae,st,zt=le().parentNode;return zt&&(st=Ep(zt)[0])!=null&&(Ae=st.ownerDocument)!=null&&Ae.body?st.ownerDocument:document}function de(){return Sp(k)}function ve(Ae){return S.state.isMounted&&!S.state.isVisible||Or.isTouch||s&&s.type==="focus"?0:Vi(S.props.delay,Ae?0:1,ll.delay)}function fe(Ae){Ae===void 0&&(Ae=!1),k.style.pointerEvents=S.props.interactive&&!Ae?"":"none",k.style.zIndex=""+S.props.zIndex}function Ee(Ae,st,zt){var si;zt===void 0&&(zt=!0),H.forEach(function(ni){ni[Ae]&&ni[Ae].apply(ni,st)}),zt&&(si=S.props)[Ae].apply(si,st)}function Je(){var Ae=S.props.aria;if(Ae.content){var st="aria-"+Ae.content,zt=k.id;Ep(S.props.triggerTarget||a).forEach(function(si){var ni=si.getAttribute(st);if(S.state.isVisible)si.setAttribute(st,ni?ni+" "+zt:zt);else{var vi=ni&&ni.replace(zt,"").trim();vi?si.setAttribute(st,vi):si.removeAttribute(st)}})}}function Te(){!X&&S.props.aria.expanded&&Ep(S.props.triggerTarget||a).forEach(function(Ae){S.props.interactive?Ae.setAttribute("aria-expanded",S.state.isVisible&&Ae===le()?"true":"false"):Ae.removeAttribute("aria-expanded")})}function qe(){se().removeEventListener("mousemove",T),Ow=Ow.filter(function(Ae){return Ae!==T})}function Ve(Ae){if(!Or.isTouch||!A&&Ae.type!=="mousedown"){var st=Ae.composedPath&&Ae.composedPath()[0]||Ae.target;if(!S.props.interactive||!Iw(k,st)){if(Ep(S.props.triggerTarget||a).some(function(zt){return Iw(zt,st)})){if(Or.isTouch||S.state.isVisible&&S.props.trigger.indexOf("click")>=0)return}else Ee("onClickOutside",[S,Ae]);S.props.hideOnClick===!0&&(S.clearDelayTimeouts(),S.hide(),_=!0,setTimeout(function(){_=!1}),S.state.isMounted||Zt())}}}function Ye(){A=!0}function Tt(){A=!1}function Xe(){var Ae=se();Ae.addEventListener("mousedown",Ve,!0),Ae.addEventListener("touchend",Ve,Ws),Ae.addEventListener("touchstart",Tt,Ws),Ae.addEventListener("touchmove",Ye,Ws)}function Zt(){var Ae=se();Ae.removeEventListener("mousedown",Ve,!0),Ae.removeEventListener("touchend",Ve,Ws),Ae.removeEventListener("touchstart",Tt,Ws),Ae.removeEventListener("touchmove",Ye,Ws)}function di(Ae,st){var zt=de().box;function si(ni){ni.target===zt&&(z0(zt,"remove",si),st())}if(Ae===0)return st();z0(zt,"remove",o),z0(zt,"add",si),o=si}function Ai(Ae,st,zt){zt===void 0&&(zt=!1),Ep(S.props.triggerTarget||a).forEach(function(si){si.addEventListener(Ae,st,zt),E.push({node:si,eventType:Ae,handler:st,options:zt})})}function Wi(){var Ae;re()&&(Ai("touchstart",Ui,{passive:!0}),Ai("touchend",yt,{passive:!0})),(Ae=S.props.trigger,Ae.split(/\s+/).filter(Boolean)).forEach(function(st){if(st!=="manual")switch(Ai(st,Ui),st){case"mouseenter":Ai("mouseleave",yt);break;case"focus":Ai(Ig?"focusout":"blur",li);break;case"focusin":Ai("focusout",li)}})}function Gi(){E.forEach(function(Ae){var st=Ae.node,zt=Ae.eventType,si=Ae.handler,ni=Ae.options;st.removeEventListener(zt,si,ni)}),E=[]}function Ui(Ae){var st,zt=!1;if(S.state.isEnabled&&!ar(Ae)&&!_){var si=((st=s)==null?void 0:st.type)==="focus";s=Ae,u=Ae.currentTarget,Te(),!S.state.isVisible&&cs(Ae,"MouseEvent")&&Ow.forEach(function(ni){return ni(Ae)}),Ae.type==="click"&&(S.props.trigger.indexOf("mouseenter")<0||g)&&S.props.hideOnClick!==!1&&S.state.isVisible?zt=!0:St(Ae),Ae.type==="click"&&(g=!zt),zt&&!si&&bt(Ae)}}function wt(Ae){var st=Ae.target,zt=le().contains(st)||k.contains(st);if(Ae.type!=="mousemove"||!zt){var si=nt().concat(k).map(function(ni){var vi,Pi=(vi=ni._tippy.popperInstance)==null?void 0:vi.state;return Pi?{popperRect:ni.getBoundingClientRect(),popperState:Pi,props:f}:null}).filter(Boolean);(function(ni,vi){var Pi=vi.clientX,wi=vi.clientY;return ni.every(function(bi){var Hi=bi.popperRect,ui=bi.popperState,Ii=bi.props.interactiveBorder,Bi=ui.placement.split("-")[0],er=ui.modifiersData.offset;if(!er)return!0;var Cn=Bi==="bottom"?er.top.y:0,un=Bi==="top"?er.bottom.y:0,Qi=Bi==="right"?er.left.x:0,pr=Bi==="left"?er.right.x:0,Dr=Hi.top-wi+Cn>Ii,$s=wi-Hi.bottom-un>Ii,Uo=Hi.left-Pi+Qi>Ii,ua=Pi-Hi.right-pr>Ii;return Dr||$s||Uo||ua})})(si,Ae)&&(qe(),bt(Ae))}}function yt(Ae){ar(Ae)||S.props.trigger.indexOf("click")>=0&&g||(S.props.interactive?S.hideWithInteractivity(Ae):bt(Ae))}function li(Ae){S.props.trigger.indexOf("focusin")<0&&Ae.target!==le()||S.props.interactive&&Ae.relatedTarget&&k.contains(Ae.relatedTarget)||bt(Ae)}function ar(Ae){return!!Or.isTouch&&re()!==Ae.type.indexOf("touch")>=0}function ge(){je();var Ae=S.props,st=Ae.popperOptions,zt=Ae.placement,si=Ae.offset,ni=Ae.getReferenceClientRect,vi=Ae.moveTransition,Pi=ue()?Sp(k).arrow:null,wi=ni?{getBoundingClientRect:ni,contextElement:ni.contextElement||le()}:a,bi=[{name:"offset",options:{offset:si}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!vi}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Hi){var ui=Hi.state;if(ue()){var Ii=de().box;["placement","reference-hidden","escaped"].forEach(function(Bi){Bi==="placement"?Ii.setAttribute("data-placement",ui.placement):ui.attributes.popper["data-popper-"+Bi]?Ii.setAttribute("data-"+Bi,""):Ii.removeAttribute("data-"+Bi)}),ui.attributes.popper={}}}}];ue()&&Pi&&bi.push({name:"arrow",options:{element:Pi,padding:3}}),bi.push.apply(bi,(st==null?void 0:st.modifiers)||[]),S.popperInstance=ls(wi,k,Object.assign({},st,{placement:zt,onFirstUpdate:l,modifiers:bi}))}function je(){S.popperInstance&&(S.popperInstance.destroy(),S.popperInstance=null)}function nt(){return F0(k.querySelectorAll("[data-tippy-root]"))}function St(Ae){S.clearDelayTimeouts(),Ae&&Ee("onTrigger",[S,Ae]),Xe();var st=ve(!0),zt=te(),si=zt[0],ni=zt[1];Or.isTouch&&si==="hold"&&ni&&(st=ni),st?t=setTimeout(function(){S.show()},st):S.show()}function bt(Ae){if(S.clearDelayTimeouts(),Ee("onUntrigger",[S,Ae]),S.state.isVisible){if(!(S.props.trigger.indexOf("mouseenter")>=0&&S.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Ae.type)>=0&&g)){var st=ve(!1);st?i=setTimeout(function(){S.state.isVisible&&S.hide()},st):r=requestAnimationFrame(function(){S.hide()})}}else Zt()}}function G0(a,e){e===void 0&&(e={});var t=ll.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",$u,Ws),window.addEventListener("blur",Rw);var i,r=Object.assign({},e,{plugins:t}),s=(i=a,j0(i)?[i]:function(o){return cs(o,"NodeList")}(i)?F0(i):Array.isArray(i)?i:F0(document.querySelectorAll(i))).reduce(function(o,l){var u=l&&fP(l,r);return u&&o.push(u),o},[]);return j0(a)?s[0]:s}G0.defaultProps=ll,G0.setDefaultProps=function(a){Object.keys(a).forEach(function(e){ll[e]=a[e]})},G0.currentInput=Or;var mP=Object.assign({},su,{effect:function(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),gP=function(a,e){var t;e===void 0&&(e={});var i,r=a,s=[],o=[],l=e.overrides,u=[],h=!1;function f(){o=r.map(function(N){return Ep(N.props.triggerTarget||N.reference)}).reduce(function(N,H){return N.concat(H)},[])}function g(){s=r.map(function(N){return N.reference})}function _(N){r.forEach(function(H){N?H.enable():H.disable()})}function A(N){return r.map(function(H){var X=H.setProps;return H.setProps=function(te){X(te),H.reference===i&&N.setProps(te)},function(){H.setProps=X}})}function x(N,H){var X=o.indexOf(H);if(H!==i){i=H;var te=(l||[]).concat("content").reduce(function(re,ue){return re[ue]=r[X].props[ue],re},{});N.setProps(Object.assign({},te,{getReferenceClientRect:typeof te.getReferenceClientRect=="function"?te.getReferenceClientRect:function(){var re;return(re=s[X])==null?void 0:re.getBoundingClientRect()}}))}}_(!1),g(),f();var E,T,R,I={fn:function(){return{onDestroy:function(){_(!0)},onHidden:function(){i=null},onClickOutside:function(N){N.props.showOnCreate&&!h&&(h=!0,i=null)},onShow:function(N){N.props.showOnCreate&&!h&&(h=!0,x(N,s[0]))},onTrigger:function(N,H){x(N,H.currentTarget)}}}},S=G0(im(),Object.assign({},(E=e,T=["overrides"],R=Object.assign({},E),T.forEach(function(N){delete R[N]}),R),{plugins:[I].concat(e.plugins||[]),triggerTarget:o,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((t=e.popperOptions)==null?void 0:t.modifiers)||[],[mP])})})),O=S.show;S.show=function(N){if(O(),!i&&N==null)return x(S,s[0]);if(!i||N!=null){if(typeof N=="number")return s[N]&&x(S,s[N]);if(r.indexOf(N)>=0){var H=N.reference;return x(S,H)}return s.indexOf(N)>=0?x(S,N):void 0}},S.showNext=function(){var N=s[0];if(!i)return S.show(0);var H=s.indexOf(i);S.show(s[H+1]||N)},S.showPrevious=function(){var N=s[s.length-1];if(!i)return S.show(N);var H=s.indexOf(i),X=s[H-1]||N;S.show(X)};var k=S.setProps;return S.setProps=function(N){l=N.overrides||l,k(N)},S.setInstances=function(N){_(!0),u.forEach(function(H){return H()}),r=N,_(!1),g(),f(),u=A(S),S.setProps({triggerTarget:o})},u=A(S),S};G0.setDefaultProps({render:Dw});var Cp=G0;class ja{static _initialize(){this._inited=!0,(0,V.createStyles)(V.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&e.button===0&&this.Remove()})}static Create(e,t,i){this._inited||this._initialize(),this.Element&&this.Remove();const r=(0,V.createDiv)({id:"customContextMenu",addToBody:!1});r.style.top=i+"px",r.style.left=t+"px";for(const[s,o]of Object.entries(e)){const l=(0,V.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:s});r.appendChild(l),l.onclick=o}return this.Element=r,r}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}ja.Element=void 0,ja._inited=!1;class Mp extends Y{constructor(){super(...arguments),this.enableEditContextMenus=!1}async _refreshUi(){var e;if(!await super._refreshUi())return!1;q.RemoveAll(Mp.PluginType);for(const t of this.variations)q.Create(Mp.PluginType,t.title+(this.enableEditContextMenus?" ("+t.uuid+")":""),5,20,0,t.materials.map(i=>{let r;if(t.preview.startsWith("generate:"))r=this._previewGenerator.generate(i,t.preview.split(":")[1]);else{const s=i[t.preview]||"#ff00ff";r=s.image?(0,V.imageBitmapToBase64)(s.image,100):void 0,r||(r=(0,V.makeColorSvgCircle)(s!=null&&s.isColor?s.getHexString():s))}return{id:i.uuid,image:r,onClick:s=>this.applyVariation(t,s),tooltip:i.name||i.uuid}}),(i,r,s)=>{Cp(i,{placement:"bottom",content:r.tooltip}),i.oncontextmenu=o=>{if(!this.enableEditContextMenus)return;o.preventDefault(),o.stopPropagation();const l=ja.Create({Remove:async()=>{var u;await((u=this._viewer)===null||u===void 0?void 0:u.confirm("Remove material: Remove material from this variation list?"))&&(t.materials=t.materials.filter(h=>h.uuid!==r.id),this.refreshUi(),ja.Remove())},"Remove All":async()=>{var u;await((u=this._viewer)===null||u===void 0?void 0:u.confirm("Remove all: Remove all materials from this variation list?"))&&(t.materials=[],this.refreshUi(),ja.Remove())}},o.clientX,o.clientY);document.body.appendChild(l)},s.oncontextmenu=o=>{if(!this.enableEditContextMenus)return;o.preventDefault(),o.stopPropagation();const l=ja.Create({"Rename mapping":async()=>{var u;const h=await((u=this._viewer)===null||u===void 0?void 0:u.prompt("Change name: New material name to map to",t.uuid,!0));h&&(t.uuid=h,this.refreshUi())},"Rename title":async()=>{var u;const h=await((u=this._viewer)===null||u===void 0?void 0:u.prompt("Change name: New material name to map to",t.title,!0));h&&(t.title=h,this.refreshUi())},"Remove Section":async()=>{var u;await((u=this._viewer)===null||u===void 0?void 0:u.confirm("Remove variations: Remove this category of variations?"))&&(this.removeVariation(t),ja.Remove())}},o.clientX,o.clientY);document.body.appendChild(l)}});return q.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}Mp.PluginType="MaterialConfiguratorPlugin";class GE extends Si{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[Ut],this.variations=[],this._selectedSwitchNode=()=>{var e;const t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;const i=this.variations.map(s=>s.name);let r;return t.traverseAncestors(s=>{r||s.name&&i.includes(s.name)&&(r=s)}),r},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,i;await super.onAdded(e),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),(i=this._picking)===null||i===void 0||i.addEventListener("selectedObjectChanged",()=>{var r,s;(s=(r=this.uiConfig).uiRefresh)===null||s===void 0||s.call(r)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const r of this.variations){if(!r.name)continue;const s=this._viewer.scene.getObjectByName(r.name);if(!s||s.children.length<1)return;r.selected||(r.selected=s.children[0].name||s.children[0].uuid);for(const o of s.children)o.userData.__oldVisible=o.visible,o.visible=(o.name||o.uuid)===r.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const r of this.variations){if(!r.name)continue;const s=this._viewer.scene.getObjectByName(r.name);if(!s||s.children.length<1)return;for(const o of s.children){if(o.userData.__oldVisible===void 0)return;o.visible=o.userData.__oldVisible,delete o.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e),!0)}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([ae()],GE.prototype,"variations",void 0);class Tp extends GE{_refreshUi(){var e;if(!super._refreshUi())return!1;q.RemoveAll(Tp.PluginType);for(const t of this.variations){const i=this._viewer.scene.getObjectByName(t.name);i?(i.children.length<1&&console.warn("SwitchNode does not have enough children",t),q.Create(Tp.PluginType,t.title,Math.min(5,i.children.length),20,0,i.children.map(r=>{const s=t.camView,o=new p.Pa4((s.includes("right")?1:0)-(s.includes("left")?1:0),(s.includes("top")?1:0)-(s.includes("bottom")?1:0),(s.includes("front")?1:0)-(s.includes("back")?1:0));t.camDistance||(t.camDistance=1);const l=Q(this._viewer,r,void 0,7,o.multiplyScalar(.5*t.camDistance));return{id:r.uuid,image:l,onClick:()=>{var u;t.selected=r.name||r.uuid,(u=this._viewer)===null||u===void 0||u.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:r.name||r.uuid}}),(r,s)=>Cp(r,{placement:"bottom",content:s.tooltip}))):console.warn("no object found for variation, skipping",t)}return q.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}Tp.PluginType="SwitchNodePlugin";class Lw extends Si{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))},this.dependencies=[Ut],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var t,i;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new $(this._viewer),(i=this._picking)===null||i===void 0||i.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,i;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(i=this._picking)===null||i===void 0||i.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}Lw.PluginType="MaterialLibraryBasePlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([Ot("Enabled")],Lw.prototype,"enabled",void 0);class Kh extends Lw{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Wn(),children:[...Qa(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Ut).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid},setValue:e=>{var t,i,r,s,o;const l=(r=(i=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Ut))===null||i===void 0?void 0:i.materials)===null||r===void 0?void 0:r.findMaterial(e);if(l)if(this.replaceMaterial)(o=(s=this._selectedObject())===null||s===void 0?void 0:s.setMaterial)===null||o===void 0||o.call(s,l);else{const u=this._selectedMaterial();if(u){const h=u.name,f=u.uuid;u.copyProps(l),u.name=h,u.uuid=f,u.userData.uuid&&(u.userData.uuid=f)}}this._refreshUi()}})]}}async _refreshUi(){var e,t,i;if(!await super._refreshUi())return!1;const r=[js.TypeSlug,yr.TypeSlug],s=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ut))===null||t===void 0?void 0:t.materials,o=r.map(l=>[l,s==null?void 0:s.getMaterialsOfType(l)]);q.RemoveAll(Kh.PluginType);for(const[l,u]of o)q.Create(Kh.PluginType,l,5,20,0,u==null?void 0:u.filter(h=>!h.userData.runtimeMaterial).map(h=>{let f;const g="generate:sphere";if(g.startsWith("generate:"))f=this._previewGenerator.generate(h,g.split(":")[1]);else{const _=h[g]||"#ff00ff";f=_.image?(0,V.imageBitmapToBase64)(_.image,100):void 0,f||(f=(0,V.makeColorSvg)(_))}return{id:h.uuid,image:f,onClick:_=>{const A=s==null?void 0:s.findMaterial(_);if(A){const x=A.userData.__appliedMeshes;if(x!=null&&x.size){const E=x.keys().next().value;E.dispatchEvent({type:"select",value:E})}}},tooltip:h.name||h.uuid}}),(h,f)=>Cp(h,{placement:"bottom",content:f.tooltip}));return q.RebuildUi((i=this._viewer)===null||i===void 0?void 0:i.container),!0}}Kh.PluginType="MaterialLibraryPlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([Ot("Replace Material")],Kh.prototype,"replaceMaterial",void 0);class HE extends p.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",V.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([Qe({propKey:"tLastThis"})],HE.prototype,"lastFrameTexture",void 0);var rm=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Ro extends V.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.shadowMapType=p._MY,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(i,r)=>V.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(i,r,s)=>{this.groundMapMode==="aoMap"?i.fragmentShader=Mi(i.fragmentShader,"#include <aomap_fragment>",Mi(p.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?i.fragmentShader=Mi(i.fragmentShader,"#include <map_fragment>",Mi(p.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(i.fragmentShader=Mi(i.fragmentShader,"#include <alphamap_fragment>",Mi(p.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),i.fragmentShader=Mi(i.fragmentShader,"#include <output_fragment>",V.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&s.capabilities.isWebGL2&&(i.defines.USE_UV="",i.fragmentShader=Mi(i.fragmentShader,"#include <output_fragment>",V.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(i,r)=>{r.materialObject.userData.gMapMode!==this.groundMapMode&&(r.materialObject.userData.gMapMode=this.groundMapMode,r.materialObject.needsUpdate=!0)},isCompatible:i=>i.isMeshStandardMaterial2},this._viewer=e;const t=new Hm(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new p.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new p.Pa4(10,10,10),normalDirection:new p.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new HE({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:p.jFi}),this._shadowBlurMat=new Yl({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new p.FM8(.5,.5)},direction:{value:new p.FM8(.5,.5)}},vertexShader:Pn,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,i;(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e),(i=this._viewer)===null||i===void 0||i.setDirty()}fromJSON(e,t){return br(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:p.ywz,depthBuffer:!1,size:new p.FM8(t,t),sizeMultiplier:void 0,colorSpace:p.aCh,format:p.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const i=this._viewer.renderer.rendererObject,r=i.shadowMap,s=r.type,o=r.needsUpdate,l=r.autoUpdate;r.type=this.shadowMapType,r.needsUpdate=!0,r.autoUpdate=!1;const u=this._viewer.scene,h=new p.S9g;h.disableAll(),u.modelObject.traverse(x=>{x.isLight&&x!==this._light.lightObject&&(x.userData.__gp_layers=x.layers,x.layers=h)});const f=u.activeCamera.cameraObject;if(f.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";f.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),Wt(i,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(u)),f.layers.disable(this._lightLayer);const g=f.layers.mask;f.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const _=this._viewer.renderer.getTempTarget({type:p.ywz,depthBuffer:!1,size:new p.FM8(t,t),colorSpace:p.aCh,format:p.wk1}),A=_.texture.colorSpace;_.texture.colorSpace=p.aCh,this._viewer.renderer.blit(this._target.texture,_,{clear:!0});{const x=e.material,E=e.frustumCulled,T=i.getRenderTarget(),R=i.getActiveCubeFace(),I=i.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,i.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=_.texture,this._shadowMat.needsUpdate=!0,Wt(i,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(u)),i.setRenderTarget(T,R,I),e.frustumCulled=E,e.material=x,this.smoothShadow&&this._applySmoothFilter(this._target,_)}return _.texture.colorSpace=A,this._viewer.renderer.releaseTempTarget(_),e.layers.disable(this._lightLayer),f.layers.mask=g,u.modelObject.traverse(x=>{x.isLight&&x!==this._light.lightObject&&(x.layers=x.userData.__gp_layers,delete x.userData.__gp_layers)}),r.type=s,r.needsUpdate=o,r.autoUpdate=l,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,i,r;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)===null||t===void 0?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((r=this._target)===null||r===void 0?void 0:r.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}rm([ae("randomizedLight")],Ro.prototype,"_light",void 0),rm([(0,V.onChange)(Ro.prototype.reset),ae()],Ro.prototype,"maxFrameNumber",void 0),rm([(0,V.onChange)(Ro.prototype.reset),ae()],Ro.prototype,"smoothShadow",void 0),rm([ae(),(0,V.onChange)(Ro.prototype.reset)],Ro.prototype,"shadowMapType",void 0),rm([(0,V.onChange)(Ro.prototype._groundMapModeChanged),ae()],Ro.prototype,"groundMapMode",void 0),rm([ae(),(0,V.onChange)(Ro.prototype._alphaVignetteChanged)],Ro.prototype,"alphaVignette",void 0),rm([ae(),(0,V.onChange)(Ro.prototype._alphaVignetteChanged)],Ro.prototype,"alphaVignetteAxis",void 0),rm([ae()],Ro.prototype,"maxBakeCount",void 0);var sM=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Pg extends p.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e)}constructor(e,t,i=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new p.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(T,R,I)=>{if(this.enabled){T.vertexShader=Mi(T.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const S="#glMarker beforeModulation";T.fragmentShader=Mi(T.fragmentShader,S,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+S)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?Bv+`
`+bo+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:T=>this.enabled+" "+T.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(T,{materialObject:R})=>{R.userData.__lastTransparent!==R.transparent&&(R.needsUpdate=!0,R.userData.__lastTransparent=R.transparent)},isCompatible:T=>T.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const r=new p.JOQ,s=new p.Pa4,o=new p.Pa4,l=new p.Pa4,u=new p.yGw,h=new p.Pa4(0,0,-1),f=new p.Ltg,g=new p.Pa4,_=new p.Pa4,A=new p.Ltg,x=new p.yGw,E=new p.cPb;p.M8C.isPowerOfTwo(t.texture.image.width)&&p.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(T,R,I)=>{if(!this.enabled||!T.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const S=I.view?Object.assign({},I.view):null;if(S&&I.clearViewOffset&&I.clearViewOffset(),o.setFromMatrixPosition(this.matrixWorld),l.setFromMatrixPosition(I.matrixWorld),u.extractRotation(this.matrixWorld),s.set(0,0,1),s.applyMatrix4(u),g.subVectors(o,l),g.dot(s)>0)return;g.reflect(s).negate(),g.add(o),u.extractRotation(I.matrixWorld),h.set(0,0,-1),h.applyMatrix4(u),h.add(l),_.subVectors(o,h),_.reflect(s).negate(),_.add(o),E.position.copy(g),E.up.set(0,1,0),E.up.applyMatrix4(u),E.up.reflect(s),E.lookAt(_),E.far=2,E.near=0,E.updateMatrixWorld(),E.projectionMatrix.copy(I.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(E.projectionMatrix),x.multiply(E.matrixWorldInverse),x.multiply(this.matrixWorld),r.setFromNormalAndCoplanarPoint(s,o),r.applyMatrix4(E.matrixWorldInverse),f.set(r.normal.x,r.normal.y,r.normal.z,r.constant);const O=E.projectionMatrix;A.x=(Math.sign(f.x)+O.elements[8])/O.elements[0],A.y=(Math.sign(f.y)+O.elements[9])/O.elements[5],A.z=-1,A.w=(1+O.elements[10])/O.elements[14],f.multiplyScalar(2/f.dot(A)),O.elements[2]=f.x,O.elements[6]=f.y,O.elements[10]=f.z+1-i,O.elements[14]=f.w,this.visible=!1;const k=T.getRenderTarget(),N=T.xr.enabled,H=T.shadowMap.autoUpdate;T.xr.enabled=!1,T.shadowMap.autoUpdate=!1,T.setRenderTarget(this._renderTarget),T.state.buffers.depth.setMask(!0),T.autoClear===!1&&T.clear();const X=R.background;this.transparentReflectionBackground&&(R.background=null);const te=!this.transparentReflectionBackground;X!=null&&X.isTexture&&te&&(X.userData||(X.userData={}),X.userData.flipX=!X.userData.flipX),Wt(T,{shadowMapRender:!1,backgroundRender:te,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>T.render(R,E)),X!=null&&X.isTexture&&te&&(X.userData.flipX=!X.userData.flipX||void 0),this.transparentReflectionBackground&&(R.background=X),T.xr.enabled=N,T.shadowMap.autoUpdate=H,T.setRenderTarget(k),S!=null&&S.enabled&&I.setViewOffset&&I.setViewOffset(S.fullWidth,S.fullHeight,S.offsetX,S.offsetY,S.width,S.height);const re=I.viewport;re!==void 0&&T.state.viewport(re),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=x,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new p.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=x}getRenderTarget(){return this._renderTarget}}sM([(0,V.onChange)(Pg.prototype._updateExtension)],Pg.prototype,"enabled",void 0),sM([(0,V.onChange)(Pg.prototype._updateExtension)],Pg.prototype,"reflectorModePhysical",void 0),Pg.prototype.isReflector=!0;var Rg=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Do extends Si{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Ut],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new p._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new p.Kj0(this._geometry)}async onAdded(e){var t,i;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Ut);const r=this._createMesh();r.userData.physicsMass=0,this._iMesh=await((t=this._manager)===null||t===void 0?void 0:t.addImportedSingle(r,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(i=this._iMesh)===null||i===void 0?void 0:i.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,i,r;return this._removeMaterial(),this._geometry.dispose(),(t=this._material)===null||t===void 0||t.dispose(),(r=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||r===void 0||r.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;t&&(t.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,i;if(!this._mesh||!this._viewer)return;let r=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,r=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const s=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const o=s.getCenter(new p.Pa4).sub(new p.Pa4(0,s.getSize(new p.Pa4).y/2+this.yOffset,0));r=r||o.clone().sub(this._mesh.position).length()>1e-4,r&&this._mesh.position.copy(o)}r=r||Math.abs(this._mesh.scale.x-this.size)>1e-4,r&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new p.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(i=(t=this._mesh).setDirty)===null||i===void 0||i.call(t)),this._transformNeedRefresh=!1}else r&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,t,i,r,s,o;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const l=(e=this._material)!==null&&e!==void 0?e:(i=(t=this._manager)===null||t===void 0?void 0:t.materials)===null||i===void 0?void 0:i.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});l&&l.userData.runtimeMaterial;let u=!1;return l!==this._material&&(this._removeMaterial(),l&&(this._material=l),!((r=this._material)===null||r===void 0)&&r.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((o=(s=this._mesh)===null||s===void 0?void 0:s.setMaterial)!==null&&o!==void 0?o:h=>{this._mesh&&(this._mesh.material=h.materialObject)})(this._material)),u=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),u}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}Rg([ae("material")],Do.prototype,"_material",void 0),Rg([(0,V.onChange)(Do.prototype.refreshTransform),ae()],Do.prototype,"visible",void 0),Rg([(0,V.onChange2)(Do.prototype._onSceneUpdate),ae()],Do.prototype,"size",void 0),Rg([(0,V.onChange2)(Do.prototype._onSceneUpdate),ae()],Do.prototype,"yOffset",void 0),Rg([(0,V.onChange)(Do.prototype._refreshOptions2),ae()],Do.prototype,"renderToDepth",void 0),Rg([(0,V.onChange)(Do.prototype._refreshOptions2),ae()],Do.prototype,"tonemapGround",void 0),Rg([(0,V.onChange)(Do.prototype._refreshCameraLimits),ae()],Do.prototype,"limitCameraAboveGround",void 0);var kw=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Ul extends Do{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)===null||e===void 0||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(Cc),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new Pg(this._geometry,this._viewer.renderer.createTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:p.D1R,magFilter:p.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...i)=>{var r,s,o,l,u;let h=(s=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("SSReflection"))===null||s===void 0?void 0:s.passes.ssr.passObject;h&&!h.enabled&&(h=void 0),h&&(h.enabled=!1);let f=(u=(l=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("SSBevelPlugin"))===null||l===void 0?void 0:l.pass)===null||u===void 0?void 0:u.passObject;f&&!f.enabled&&(f=void 0),f&&(f.enabled=!1),t(...i),h&&(h.enabled=!0),f&&(f.enabled=!0)},e}async onAdded(e){var t,i;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(Cc))===null||t===void 0||t.addTexture("bake_ground_1",()=>{var r,s;return(s=(r=this._shadowBaker)===null||r===void 0?void 0:r.light.shadow.map)===null||s===void 0?void 0:s.texture},[100,100,200,200]),(i=e.getPlugin(Cc))===null||i===void 0||i.addTexture("bake_ground_2",()=>{var r,s;return(s=(r=this._shadowBaker)===null||r===void 0?void 0:r.target)===null||s===void 0?void 0:s.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,i,r;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)===null||t===void 0||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const s=this._mesh.materialExtension;s||console.warn("WebGi GroundPlugin: unable to find the extension to unregister"),(r=(i=this._material).unregisterMaterialExtensions)===null||r===void 0||r.call(i,[s]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((t=this._shadowBaker)===null||t===void 0||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Ro(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,i,r;if(!this._viewer)return!1;const s=super._refreshMaterial();if(!this._material)return s;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o.updaters=[this._viewer.scene,this._viewer.renderer],(t=(e=this._material).registerMaterialExtensions)===null||t===void 0||t.call(e,[o]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((r=(i=this._material).registerMaterialExtensions)===null||r===void 0||r.call(i,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),s}_extraUiConfig(){var e,t,i,r,s,o,l,u,h,f,g,_,A,x,E,T,R,I,S,O,k,N,H,X,te,re,ue,le,se,de;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var ve,fe;return(fe=(ve=this._uiConfig)===null||ve===void 0?void 0:ve.uiRefresh)===null||fe===void 0?void 0:fe.call(ve,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var ve;return!(!((ve=this._shadowBaker)===null||ve===void 0)&&ve.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(ve=>({label:ve,value:ve})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"]},{label:"Baked shadow type",type:"dropdown",children:[["Basic",p._MY],["PCF",p._iA],["PCFSoft",p.ntZ],["VSM",p.dwk]].map(ve=>({label:ve[0].toString(),value:ve[1]})),property:[this._shadowBaker,"shadowMapType"]},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)===null||t===void 0?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(r=(i=this._shadowBaker)===null||i===void 0?void 0:i.light)===null||r===void 0?void 0:r.shadowParams,"enabled"],onChange:[(o=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||o===void 0?void 0:o.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(u=(l=this._shadowBaker)===null||l===void 0?void 0:l.light)===null||u===void 0?void 0:u.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(f=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||f===void 0?void 0:f.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(_=(g=this._shadowBaker)===null||g===void 0?void 0:g.light)===null||_===void 0?void 0:_.randomParams,"distanceScale"],onChange:[(x=(A=this._shadowBaker)===null||A===void 0?void 0:A.light)===null||x===void 0?void 0:x.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(T=(E=this._shadowBaker)===null||E===void 0?void 0:E.light)===null||T===void 0?void 0:T.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(I=(R=this._shadowBaker)===null||R===void 0?void 0:R.light)===null||I===void 0?void 0:I.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(O=(S=this._shadowBaker)===null||S===void 0?void 0:S.light)===null||O===void 0?void 0:O.shadowParams,"radius"],onChange:[(N=(k=this._shadowBaker)===null||k===void 0?void 0:k.light)===null||N===void 0?void 0:N.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(X=(H=this._shadowBaker)===null||H===void 0?void 0:H.light)===null||X===void 0?void 0:X.shadowParams,"frustumSize"],onChange:[(re=(te=this._shadowBaker)===null||te===void 0?void 0:te.light)===null||re===void 0?void 0:re.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(le=(ue=this._shadowBaker)===null||ue===void 0?void 0:ue.light)===null||le===void 0?void 0:le.shadowParams,"bias"],onChange:[(de=(se=this._shadowBaker)===null||se===void 0?void 0:se.light)===null||de===void 0?void 0:de.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Ul.PluginType="Ground",kw([(0,V.onChange)(Ul.prototype.refreshOptions),ae()],Ul.prototype,"bakedShadows",void 0),kw([(0,V.onChange)(Ul.prototype.refreshOptions),ae()],Ul.prototype,"groundReflection",void 0),kw([(0,V.onChange)(Ul.prototype.refreshOptions),ae()],Ul.prototype,"physicalReflections",void 0),kw([ae("shadowBaker")],Ul.prototype,"_shadowBaker",void 0);class vP extends p.yxD{constructor(e){super(e),this.type=p.cLu}parse(e){const t=Math.pow(2.7182818,2.2),i={l:0,c:0,lc:0};function r(ge,je,nt,St,bt){for(;nt<ge;)je=je<<8|Te(St,bt),nt+=8;nt-=ge,i.l=je>>nt&(1<<ge)-1,i.c=je,i.lc=nt}const s=new Array(59);function o(ge){return 63&ge}function l(ge){return ge>>6}const u={c:0,lc:0};function h(ge,je,nt,St){ge=ge<<8|Te(nt,St),je+=8,u.c=ge,u.lc=je}const f={c:0,lc:0};function g(ge,je,nt,St,bt,Ae,st,zt,si){if(ge==je){St<8&&(h(nt,St,bt,Ae),nt=u.c,St=u.lc);let ni=nt>>(St-=8);if(ni=new Uint8Array([ni])[0],zt.value+ni>si)return!1;const vi=st[zt.value-1];for(;ni-- >0;)st[zt.value++]=vi}else{if(!(zt.value<si))return!1;st[zt.value++]=ge}f.c=nt,f.lc=St}function _(ge){return 65535&ge}function A(ge){const je=_(ge);return je>32767?je-65536:je}const x={a:0,b:0};function E(ge,je){const nt=A(ge),St=A(je),bt=nt+(1&St)+(St>>1),Ae=bt,st=bt-St;x.a=Ae,x.b=st}function T(ge,je){const nt=_(ge),St=_(je),bt=nt-(St>>1)&65535,Ae=St+bt-32768&65535;x.a=Ae,x.b=bt}function R(ge,je,nt,St,bt,Ae,st){const zt=st<16384,si=nt>bt?bt:nt;let ni,vi,Pi=1;for(;Pi<=si;)Pi<<=1;for(Pi>>=1,ni=Pi,Pi>>=1;Pi>=1;){vi=0;const wi=vi+Ae*(bt-ni),bi=Ae*Pi,Hi=Ae*ni,ui=St*Pi,Ii=St*ni;let Bi,er,Cn,un;for(;vi<=wi;vi+=Hi){let Qi=vi;const pr=vi+St*(nt-ni);for(;Qi<=pr;Qi+=Ii){const Dr=Qi+ui,$s=Qi+bi,Uo=$s+ui;zt?(E(ge[Qi+je],ge[$s+je]),Bi=x.a,Cn=x.b,E(ge[Dr+je],ge[Uo+je]),er=x.a,un=x.b,E(Bi,er),ge[Qi+je]=x.a,ge[Dr+je]=x.b,E(Cn,un),ge[$s+je]=x.a,ge[Uo+je]=x.b):(T(ge[Qi+je],ge[$s+je]),Bi=x.a,Cn=x.b,T(ge[Dr+je],ge[Uo+je]),er=x.a,un=x.b,T(Bi,er),ge[Qi+je]=x.a,ge[Dr+je]=x.b,T(Cn,un),ge[$s+je]=x.a,ge[Uo+je]=x.b)}if(nt&Pi){const Dr=Qi+bi;zt?E(ge[Qi+je],ge[Dr+je]):T(ge[Qi+je],ge[Dr+je]),Bi=x.a,ge[Dr+je]=x.b,ge[Qi+je]=Bi}}if(bt&Pi){let Qi=vi;const pr=vi+St*(nt-ni);for(;Qi<=pr;Qi+=Ii){const Dr=Qi+ui;zt?E(ge[Qi+je],ge[Dr+je]):T(ge[Qi+je],ge[Dr+je]),Bi=x.a,ge[Dr+je]=x.b,ge[Qi+je]=Bi}}ni=Pi,Pi>>=1}return vi}function I(ge,je,nt,St,bt,Ae){const st=nt.value,zt=Je(je,nt),si=Je(je,nt);nt.value+=4;const ni=Je(je,nt);if(nt.value+=4,zt<0||zt>=65537||si<0||si>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const vi=new Array(65537),Pi=new Array(16384);if(function(wi){for(let bi=0;bi<16384;bi++)wi[bi]={},wi[bi].len=0,wi[bi].lit=0,wi[bi].p=null}(Pi),function(wi,bi,Hi,ui,Ii,Bi){const er=bi;let Cn=0,un=0;for(;ui<=Ii;ui++){if(er.value-bi.value>Hi)return!1;r(6,Cn,un,wi,er);const Qi=i.l;if(Cn=i.c,un=i.lc,Bi[ui]=Qi,Qi==63){if(er.value-bi.value>Hi)throw new Error("Something wrong with hufUnpackEncTable");r(8,Cn,un,wi,er);let pr=i.l+6;if(Cn=i.c,un=i.lc,ui+pr>Ii+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pr--;)Bi[ui++]=0;ui--}else if(Qi>=59){let pr=Qi-59+2;if(ui+pr>Ii+1)throw new Error("Something wrong with hufUnpackEncTable");for(;pr--;)Bi[ui++]=0;ui--}}(function(Qi){for(let Dr=0;Dr<=58;++Dr)s[Dr]=0;for(let Dr=0;Dr<65537;++Dr)s[Qi[Dr]]+=1;let pr=0;for(let Dr=58;Dr>0;--Dr){const $s=pr+s[Dr]>>1;s[Dr]=pr,pr=$s}for(let Dr=0;Dr<65537;++Dr){const $s=Qi[Dr];$s>0&&(Qi[Dr]=$s|s[$s]++<<6)}})(Bi)}(ge,nt,St-(nt.value-st),zt,si,vi),ni>8*(St-(nt.value-st)))throw new Error("Something wrong with hufUncompress");(function(wi,bi,Hi,ui){for(;bi<=Hi;bi++){const Ii=l(wi[bi]),Bi=o(wi[bi]);if(Ii>>Bi)throw new Error("Invalid table entry");if(Bi>14){const er=ui[Ii>>Bi-14];if(er.len)throw new Error("Invalid table entry");if(er.lit++,er.p){const Cn=er.p;er.p=new Array(er.lit);for(let un=0;un<er.lit-1;++un)er.p[un]=Cn[un]}else er.p=new Array(1);er.p[er.lit-1]=bi}else if(Bi){let er=0;for(let Cn=1<<14-Bi;Cn>0;Cn--){const un=ui[(Ii<<14-Bi)+er];if(un.len||un.p)throw new Error("Invalid table entry");un.len=Bi,un.lit=bi,er++}}}})(vi,zt,si,Pi),function(wi,bi,Hi,ui,Ii,Bi,er,Cn,un){let Qi=0,pr=0;const Dr=er,$s=Math.trunc(ui.value+(Ii+7)/8);for(;ui.value<$s;)for(h(Qi,pr,Hi,ui),Qi=u.c,pr=u.lc;pr>=14;){const ua=bi[Qi>>pr-14&16383];if(ua.len)pr-=ua.len,g(ua.lit,Bi,Qi,pr,Hi,ui,Cn,un,Dr),Qi=f.c,pr=f.lc;else{if(!ua.p)throw new Error("hufDecode issues");let Kp;for(Kp=0;Kp<ua.lit;Kp++){const gv=o(wi[ua.p[Kp]]);for(;pr<gv&&ui.value<$s;)h(Qi,pr,Hi,ui),Qi=u.c,pr=u.lc;if(pr>=gv&&l(wi[ua.p[Kp]])==(Qi>>pr-gv&(1<<gv)-1)){pr-=gv,g(ua.p[Kp],Bi,Qi,pr,Hi,ui,Cn,un,Dr),Qi=f.c,pr=f.lc;break}}if(Kp==ua.lit)throw new Error("hufDecode issues")}}const Uo=8-Ii&7;for(Qi>>=Uo,pr-=Uo;pr>0;){const ua=bi[Qi<<14-pr&16383];if(!ua.len)throw new Error("hufDecode issues");pr-=ua.len,g(ua.lit,Bi,Qi,pr,Hi,ui,Cn,un,Dr),Qi=f.c,pr=f.lc}}(vi,Pi,ge,nt,ni,si,Ae,bt,{value:0})}function S(ge){for(let je=1;je<ge.length;je++){const nt=ge[je-1]+ge[je]-128;ge[je]=nt}}function O(ge,je){let nt=0,St=Math.floor((ge.length+1)/2),bt=0;const Ae=ge.length-1;for(;!(bt>Ae||(je[bt++]=ge[nt++],bt>Ae));)je[bt++]=ge[St++]}function k(ge){let je=ge.byteLength;const nt=new Array;let St=0;const bt=new DataView(ge);for(;je>0;){const Ae=bt.getInt8(St++);if(Ae<0){const st=-Ae;je-=st+1;for(let zt=0;zt<st;zt++)nt.push(bt.getUint8(St++))}else{const st=Ae;je-=2;const zt=bt.getUint8(St++);for(let si=0;si<st+1;si++)nt.push(zt)}}return nt}function N(ge,je,nt){let St,bt=1;for(;bt<64;)St=je[ge.value],St==65280?bt=64:St>>8==255?bt+=255&St:(nt[bt]=St,bt++),ge.value++}function H(ge){const je=.5*Math.cos(.7853975),nt=.5*Math.cos(3.14159/16),St=.5*Math.cos(3.14159/8),bt=.5*Math.cos(3*3.14159/16),Ae=.5*Math.cos(.981746875),st=.5*Math.cos(3*3.14159/8),zt=.5*Math.cos(1.374445625),si=new Array(4),ni=new Array(4),vi=new Array(4),Pi=new Array(4);for(let wi=0;wi<8;++wi){const bi=8*wi;si[0]=St*ge[bi+2],si[1]=st*ge[bi+2],si[2]=St*ge[bi+6],si[3]=st*ge[bi+6],ni[0]=nt*ge[bi+1]+bt*ge[bi+3]+Ae*ge[bi+5]+zt*ge[bi+7],ni[1]=bt*ge[bi+1]-zt*ge[bi+3]-nt*ge[bi+5]-Ae*ge[bi+7],ni[2]=Ae*ge[bi+1]-nt*ge[bi+3]+zt*ge[bi+5]+bt*ge[bi+7],ni[3]=zt*ge[bi+1]-Ae*ge[bi+3]+bt*ge[bi+5]-nt*ge[bi+7],vi[0]=je*(ge[bi+0]+ge[bi+4]),vi[3]=je*(ge[bi+0]-ge[bi+4]),vi[1]=si[0]+si[3],vi[2]=si[1]-si[2],Pi[0]=vi[0]+vi[1],Pi[1]=vi[3]+vi[2],Pi[2]=vi[3]-vi[2],Pi[3]=vi[0]-vi[1],ge[bi+0]=Pi[0]+ni[0],ge[bi+1]=Pi[1]+ni[1],ge[bi+2]=Pi[2]+ni[2],ge[bi+3]=Pi[3]+ni[3],ge[bi+4]=Pi[3]-ni[3],ge[bi+5]=Pi[2]-ni[2],ge[bi+6]=Pi[1]-ni[1],ge[bi+7]=Pi[0]-ni[0]}for(let wi=0;wi<8;++wi)si[0]=St*ge[16+wi],si[1]=st*ge[16+wi],si[2]=St*ge[48+wi],si[3]=st*ge[48+wi],ni[0]=nt*ge[8+wi]+bt*ge[24+wi]+Ae*ge[40+wi]+zt*ge[56+wi],ni[1]=bt*ge[8+wi]-zt*ge[24+wi]-nt*ge[40+wi]-Ae*ge[56+wi],ni[2]=Ae*ge[8+wi]-nt*ge[24+wi]+zt*ge[40+wi]+bt*ge[56+wi],ni[3]=zt*ge[8+wi]-Ae*ge[24+wi]+bt*ge[40+wi]-nt*ge[56+wi],vi[0]=je*(ge[wi]+ge[32+wi]),vi[3]=je*(ge[wi]-ge[32+wi]),vi[1]=si[0]+si[3],vi[2]=si[1]-si[2],Pi[0]=vi[0]+vi[1],Pi[1]=vi[3]+vi[2],Pi[2]=vi[3]-vi[2],Pi[3]=vi[0]-vi[1],ge[0+wi]=Pi[0]+ni[0],ge[8+wi]=Pi[1]+ni[1],ge[16+wi]=Pi[2]+ni[2],ge[24+wi]=Pi[3]+ni[3],ge[32+wi]=Pi[3]-ni[3],ge[40+wi]=Pi[2]-ni[2],ge[48+wi]=Pi[1]-ni[1],ge[56+wi]=Pi[0]-ni[0]}function X(ge){for(let je=0;je<64;++je){const nt=ge[0][je],St=ge[1][je],bt=ge[2][je];ge[0][je]=nt+1.5747*bt,ge[1][je]=nt-.1873*St-.4682*bt,ge[2][je]=nt+1.8556*St}}function te(ge,je,nt){for(let bt=0;bt<64;++bt)je[nt+bt]=p.A5E.toHalfFloat((St=ge[bt])<=1?Math.sign(St)*Math.pow(Math.abs(St),2.2):Math.sign(St)*Math.pow(t,Math.abs(St)-1));var St}function re(ge){return new DataView(ge.array.buffer,ge.offset.value,ge.size)}function ue(ge){const je=ge.viewer.buffer.slice(ge.offset.value,ge.offset.value+ge.size),nt=new Uint8Array(k(je)),St=new Uint8Array(nt.length);return S(nt),O(nt,St),new DataView(St.buffer)}function le(ge){const je=Sg(ge.array.slice(ge.offset.value,ge.offset.value+ge.size)),nt=new Uint8Array(je.length);return S(je),O(je,nt),new DataView(nt.buffer)}function se(ge){const je=ge.viewer,nt={value:ge.offset.value},St=new Uint16Array(ge.width*ge.scanlineBlockSize*(ge.channels*ge.type)),bt=new Uint8Array(8192);let Ae=0;const st=new Array(ge.channels);for(let Hi=0;Hi<ge.channels;Hi++)st[Hi]={},st[Hi].start=Ae,st[Hi].end=st[Hi].start,st[Hi].nx=ge.width,st[Hi].ny=ge.lines,st[Hi].size=ge.type,Ae+=st[Hi].nx*st[Hi].ny*st[Hi].size;const zt=Zt(je,nt),si=Zt(je,nt);if(si>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(zt<=si)for(let Hi=0;Hi<si-zt+1;Hi++)bt[Hi+zt]=qe(je,nt);const ni=new Uint16Array(65536),vi=function(Hi,ui){let Ii=0;for(let er=0;er<65536;++er)(er==0||Hi[er>>3]&1<<(7&er))&&(ui[Ii++]=er);const Bi=Ii-1;for(;Ii<65536;)ui[Ii++]=0;return Bi}(bt,ni),Pi=Je(je,nt);I(ge.array,je,nt,Pi,St,Ae);for(let Hi=0;Hi<ge.channels;++Hi){const ui=st[Hi];for(let Ii=0;Ii<st[Hi].size;++Ii)R(St,ui.start+Ii,ui.nx,ui.size,ui.ny,ui.nx*ui.size,vi)}(function(Hi,ui,Ii){for(let Bi=0;Bi<Ii;++Bi)ui[Bi]=Hi[ui[Bi]]})(ni,St,Ae);let wi=0;const bi=new Uint8Array(St.buffer.byteLength);for(let Hi=0;Hi<ge.lines;Hi++)for(let ui=0;ui<ge.channels;ui++){const Ii=st[ui],Bi=Ii.nx*Ii.size,er=new Uint8Array(St.buffer,Ii.end*2,Bi*2);bi.set(er,wi),wi+=Bi*2,Ii.end+=Bi}return new DataView(bi.buffer)}function de(ge){const je=Sg(ge.array.slice(ge.offset.value,ge.offset.value+ge.size)),nt=ge.lines*ge.channels*ge.width,St=ge.type==1?new Uint16Array(nt):new Uint32Array(nt);let bt=0,Ae=0;const st=new Array(4);for(let zt=0;zt<ge.lines;zt++)for(let si=0;si<ge.channels;si++){let ni=0;switch(ge.type){case 1:st[0]=bt,st[1]=st[0]+ge.width,bt=st[1]+ge.width;for(let vi=0;vi<ge.width;++vi)ni+=je[st[0]++]<<8|je[st[1]++],St[Ae]=ni,Ae++;break;case 2:st[0]=bt,st[1]=st[0]+ge.width,st[2]=st[1]+ge.width,bt=st[2]+ge.width;for(let vi=0;vi<ge.width;++vi)ni+=je[st[0]++]<<24|je[st[1]++]<<16|je[st[2]++]<<8,St[Ae]=ni,Ae++}}return new DataView(St.buffer)}function ve(ge){const je=ge.viewer,nt={value:ge.offset.value},St=new Uint8Array(ge.width*ge.lines*(ge.channels*ge.type*2)),bt={version:Ve(je,nt),unknownUncompressedSize:Ve(je,nt),unknownCompressedSize:Ve(je,nt),acCompressedSize:Ve(je,nt),dcCompressedSize:Ve(je,nt),rleCompressedSize:Ve(je,nt),rleUncompressedSize:Ve(je,nt),rleRawSize:Ve(je,nt),totalAcUncompressedCount:Ve(je,nt),totalDcUncompressedCount:Ve(je,nt),acCompression:Ve(je,nt)};if(bt.version<2)throw new Error("EXRLoader.parse: "+wt.compression+" version "+bt.version+" is unsupported");const Ae=new Array;let st=Zt(je,nt)-2;for(;st>0;){const ui=fe(je.buffer,nt),Ii=qe(je,nt),Bi=Ii>>2&3,er=new Int8Array([(Ii>>4)-1])[0],Cn=qe(je,nt);Ae.push({name:ui,index:er,type:Cn,compression:Bi}),st-=ui.length+3}const zt=wt.channels,si=new Array(ge.channels);for(let ui=0;ui<ge.channels;++ui){const Ii=si[ui]={},Bi=zt[ui];Ii.name=Bi.name,Ii.compression=0,Ii.decoded=!1,Ii.type=Bi.pixelType,Ii.pLinear=Bi.pLinear,Ii.width=ge.width,Ii.height=ge.lines}const ni={idx:new Array(3)};for(let ui=0;ui<ge.channels;++ui){const Ii=si[ui];for(let Bi=0;Bi<Ae.length;++Bi){const er=Ae[Bi];Ii.name==er.name&&(Ii.compression=er.compression,er.index>=0&&(ni.idx[er.index]=ui),Ii.offset=ui)}}let vi,Pi,wi;if(bt.acCompressedSize>0)switch(bt.acCompression){case 0:vi=new Uint16Array(bt.totalAcUncompressedCount),I(ge.array,je,nt,bt.acCompressedSize,vi,bt.totalAcUncompressedCount);break;case 1:const ui=Sg(ge.array.slice(nt.value,nt.value+bt.totalAcUncompressedCount));vi=new Uint16Array(ui.buffer),nt.value+=bt.totalAcUncompressedCount}if(bt.dcCompressedSize>0){const ui={array:ge.array,offset:nt,size:bt.dcCompressedSize};Pi=new Uint16Array(le(ui).buffer),nt.value+=bt.dcCompressedSize}bt.rleRawSize>0&&(wi=k(Sg(ge.array.slice(nt.value,nt.value+bt.rleCompressedSize)).buffer),nt.value+=bt.rleCompressedSize);let bi=0;const Hi=new Array(si.length);for(let ui=0;ui<Hi.length;++ui)Hi[ui]=new Array;for(let ui=0;ui<ge.lines;++ui)for(let Ii=0;Ii<si.length;++Ii)Hi[Ii].push(bi),bi+=si[Ii].width*ge.type*2;(function(ui,Ii,Bi,er,Cn,un){let Qi=new DataView(un.buffer);const pr=Bi[ui.idx[0]].width,Dr=Bi[ui.idx[0]].height,$s=Math.floor(pr/8),Uo=Math.ceil(pr/8),ua=Math.ceil(Dr/8),Kp=pr-8*(Uo-1),gv=Dr-8*(ua-1),hk={value:0},nM=new Array(3),pA=new Array(3),fA=new Array(3),lh=new Array(3),G1=new Array(3);for(let Jn=0;Jn<3;++Jn)G1[Jn]=Ii[ui.idx[Jn]],nM[Jn]=Jn<1?0:nM[Jn-1]+Uo*ua,pA[Jn]=new Float32Array(64),fA[Jn]=new Uint16Array(64),lh[Jn]=new Uint16Array(64*Uo);for(let Jn=0;Jn<ua;++Jn){let B_=8;Jn==ua-1&&(B_=gv);let O_=8;for(let bn=0;bn<Uo;++bn){bn==Uo-1&&(O_=Kp);for(let Hn=0;Hn<3;++Hn)fA[Hn].fill(0),fA[Hn][0]=Cn[nM[Hn]++],N(hk,er,fA[Hn]),Ni=fA[Hn],(ji=pA[Hn])[0]=Xe(Ni[0]),ji[1]=Xe(Ni[1]),ji[2]=Xe(Ni[5]),ji[3]=Xe(Ni[6]),ji[4]=Xe(Ni[14]),ji[5]=Xe(Ni[15]),ji[6]=Xe(Ni[27]),ji[7]=Xe(Ni[28]),ji[8]=Xe(Ni[2]),ji[9]=Xe(Ni[4]),ji[10]=Xe(Ni[7]),ji[11]=Xe(Ni[13]),ji[12]=Xe(Ni[16]),ji[13]=Xe(Ni[26]),ji[14]=Xe(Ni[29]),ji[15]=Xe(Ni[42]),ji[16]=Xe(Ni[3]),ji[17]=Xe(Ni[8]),ji[18]=Xe(Ni[12]),ji[19]=Xe(Ni[17]),ji[20]=Xe(Ni[25]),ji[21]=Xe(Ni[30]),ji[22]=Xe(Ni[41]),ji[23]=Xe(Ni[43]),ji[24]=Xe(Ni[9]),ji[25]=Xe(Ni[11]),ji[26]=Xe(Ni[18]),ji[27]=Xe(Ni[24]),ji[28]=Xe(Ni[31]),ji[29]=Xe(Ni[40]),ji[30]=Xe(Ni[44]),ji[31]=Xe(Ni[53]),ji[32]=Xe(Ni[10]),ji[33]=Xe(Ni[19]),ji[34]=Xe(Ni[23]),ji[35]=Xe(Ni[32]),ji[36]=Xe(Ni[39]),ji[37]=Xe(Ni[45]),ji[38]=Xe(Ni[52]),ji[39]=Xe(Ni[54]),ji[40]=Xe(Ni[20]),ji[41]=Xe(Ni[22]),ji[42]=Xe(Ni[33]),ji[43]=Xe(Ni[38]),ji[44]=Xe(Ni[46]),ji[45]=Xe(Ni[51]),ji[46]=Xe(Ni[55]),ji[47]=Xe(Ni[60]),ji[48]=Xe(Ni[21]),ji[49]=Xe(Ni[34]),ji[50]=Xe(Ni[37]),ji[51]=Xe(Ni[47]),ji[52]=Xe(Ni[50]),ji[53]=Xe(Ni[56]),ji[54]=Xe(Ni[59]),ji[55]=Xe(Ni[61]),ji[56]=Xe(Ni[35]),ji[57]=Xe(Ni[36]),ji[58]=Xe(Ni[48]),ji[59]=Xe(Ni[49]),ji[60]=Xe(Ni[57]),ji[61]=Xe(Ni[58]),ji[62]=Xe(Ni[62]),ji[63]=Xe(Ni[63]),H(pA[Hn]);X(pA);for(let Hn=0;Hn<3;++Hn)te(pA[Hn],lh[Hn],64*bn)}let Oc=0;for(let bn=0;bn<3;++bn){const Hn=Bi[ui.idx[bn]].type;for(let Zp=8*Jn;Zp<8*Jn+B_;++Zp){Oc=G1[bn][Zp];for(let mA=0;mA<$s;++mA){const wd=64*mA+8*(7&Zp);Qi.setUint16(Oc+0*2*Hn,lh[bn][wd+0],!0),Qi.setUint16(Oc+1*2*Hn,lh[bn][wd+1],!0),Qi.setUint16(Oc+2*2*Hn,lh[bn][wd+2],!0),Qi.setUint16(Oc+3*2*Hn,lh[bn][wd+3],!0),Qi.setUint16(Oc+4*2*Hn,lh[bn][wd+4],!0),Qi.setUint16(Oc+5*2*Hn,lh[bn][wd+5],!0),Qi.setUint16(Oc+6*2*Hn,lh[bn][wd+6],!0),Qi.setUint16(Oc+7*2*Hn,lh[bn][wd+7],!0),Oc+=8*2*Hn}}if($s!=Uo)for(let Zp=8*Jn;Zp<8*Jn+B_;++Zp){const mA=G1[bn][Zp]+8*$s*2*Hn,wd=64*$s+8*(7&Zp);for(let H1=0;H1<O_;++H1)Qi.setUint16(mA+H1*2*Hn,lh[bn][wd+H1],!0)}}}var Ni,ji;const pP=new Uint16Array(pr);Qi=new DataView(un.buffer);for(let Jn=0;Jn<3;++Jn){Bi[ui.idx[Jn]].decoded=!0;const B_=Bi[ui.idx[Jn]].type;if(Bi[Jn].type==2)for(let O_=0;O_<Dr;++O_){const Oc=G1[Jn][O_];for(let bn=0;bn<pr;++bn)pP[bn]=Qi.getUint16(Oc+bn*2*B_,!0);for(let bn=0;bn<pr;++bn)Qi.setFloat32(Oc+bn*2*B_,Xe(pP[bn]),!0)}}})(ni,Hi,si,vi,Pi,St);for(let ui=0;ui<si.length;++ui){const Ii=si[ui];if(!Ii.decoded){if(Ii.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Bi=0,er=0;for(let Cn=0;Cn<ge.lines;++Cn){let un=Hi[ui][Bi];for(let Qi=0;Qi<Ii.width;++Qi){for(let pr=0;pr<2*Ii.type;++pr)St[un++]=wi[er+pr*Ii.width*Ii.height];er++}Bi++}}}}return new DataView(St.buffer)}function fe(ge,je){const nt=new Uint8Array(ge);let St=0;for(;nt[je.value+St]!=0;)St+=1;const bt=new TextDecoder().decode(nt.slice(je.value,je.value+St));return je.value=je.value+St+1,bt}function Ee(ge,je){const nt=ge.getInt32(je.value,!0);return je.value=je.value+4,nt}function Je(ge,je){const nt=ge.getUint32(je.value,!0);return je.value=je.value+4,nt}function Te(ge,je){const nt=ge[je.value];return je.value=je.value+1,nt}function qe(ge,je){const nt=ge.getUint8(je.value);return je.value=je.value+1,nt}const Ve=function(ge,je){let nt;return nt="getBigInt64"in DataView.prototype?Number(ge.getBigInt64(je.value,!0)):ge.getUint32(je.value+4,!0)+Number(ge.getUint32(je.value,!0)<<32),je.value+=8,nt};function Ye(ge,je){const nt=ge.getFloat32(je.value,!0);return je.value+=4,nt}function Tt(ge,je){return p.A5E.toHalfFloat(Ye(ge,je))}function Xe(ge){const je=(31744&ge)>>10,nt=1023&ge;return(ge>>15?-1:1)*(je?je===31?nt?NaN:1/0:Math.pow(2,je-15)*(1+nt/1024):nt/1024*6103515625e-14)}function Zt(ge,je){const nt=ge.getUint16(je.value,!0);return je.value+=2,nt}function di(ge,je){return Xe(Zt(ge,je))}function Ai(ge,je,nt,St,bt){return St==="string"||St==="stringvector"||St==="iccProfile"?function(Ae,st,zt){const si=new TextDecoder().decode(new Uint8Array(Ae).slice(st.value,st.value+zt));return st.value=st.value+zt,si}(je,nt,bt):St==="chlist"?function(Ae,st,zt,si){const ni=zt.value,vi=[];for(;zt.value<ni+si-1;){const Pi=fe(st,zt),wi=Ee(Ae,zt),bi=qe(Ae,zt);zt.value+=3;const Hi=Ee(Ae,zt),ui=Ee(Ae,zt);vi.push({name:Pi,pixelType:wi,pLinear:bi,xSampling:Hi,ySampling:ui})}return zt.value+=1,vi}(ge,je,nt,bt):St==="chromaticities"?function(Ae,st){return{redX:Ye(Ae,st),redY:Ye(Ae,st),greenX:Ye(Ae,st),greenY:Ye(Ae,st),blueX:Ye(Ae,st),blueY:Ye(Ae,st),whiteX:Ye(Ae,st),whiteY:Ye(Ae,st)}}(ge,nt):St==="compression"?function(Ae,st){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][qe(Ae,st)]}(ge,nt):St==="box2i"?function(Ae,st){return{xMin:Je(Ae,st),yMin:Je(Ae,st),xMax:Je(Ae,st),yMax:Je(Ae,st)}}(ge,nt):St==="lineOrder"?function(Ae,st){return["INCREASING_Y"][qe(Ae,st)]}(ge,nt):St==="float"?Ye(ge,nt):St==="v2f"?function(Ae,st){return[Ye(Ae,st),Ye(Ae,st)]}(ge,nt):St==="v3f"?function(Ae,st){return[Ye(Ae,st),Ye(Ae,st),Ye(Ae,st)]}(ge,nt):St==="int"?Ee(ge,nt):St==="rational"?function(Ae,st){return[Ee(Ae,st),Je(Ae,st)]}(ge,nt):St==="timecode"?function(Ae,st){return[Je(Ae,st),Je(Ae,st)]}(ge,nt):St==="preview"?(nt.value+=bt,"skipped"):void(nt.value+=bt)}const Wi=new DataView(e),Gi=new Uint8Array(e),Ui={value:0},wt=function(ge,je,nt){const St={};if(ge.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");St.version=ge.getUint8(4);const bt=ge.getUint8(5);St.spec={singleTile:!!(2&bt),longName:!!(4&bt),deepFormat:!!(8&bt),multiPart:!!(16&bt)},nt.value=8;let Ae=!0;for(;Ae;){const st=fe(je,nt);if(st==0)Ae=!1;else{const zt=fe(je,nt),si=Ai(ge,je,nt,zt,Je(ge,nt));si===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${zt}'.`):St[st]=si}}if(-5&bt)throw console.error("EXRHeader:",St),new Error("THREE.EXRLoader: provided file is currently unsupported.");return St}(Wi,e,Ui),yt=function(ge,je,nt,St,bt){const Ae={size:0,viewer:je,array:nt,offset:St,width:ge.dataWindow.xMax-ge.dataWindow.xMin+1,height:ge.dataWindow.yMax-ge.dataWindow.yMin+1,channels:ge.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:ge.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:p.GUF};switch(ge.compression){case"NO_COMPRESSION":Ae.lines=1,Ae.uncompress=re;break;case"RLE_COMPRESSION":Ae.lines=1,Ae.uncompress=ue;break;case"ZIPS_COMPRESSION":Ae.lines=1,Ae.uncompress=le;break;case"ZIP_COMPRESSION":Ae.lines=16,Ae.uncompress=le;break;case"PIZ_COMPRESSION":Ae.lines=32,Ae.uncompress=se;break;case"PXR24_COMPRESSION":Ae.lines=16,Ae.uncompress=de;break;case"DWAA_COMPRESSION":Ae.lines=32,Ae.uncompress=ve;break;case"DWAB_COMPRESSION":Ae.lines=256,Ae.uncompress=ve;break;default:throw new Error("EXRLoader.parse: "+ge.compression+" is unsupported")}if(Ae.scanlineBlockSize=Ae.lines,Ae.type==1)switch(bt){case p.VzW:Ae.getter=di,Ae.inputSize=2;break;case p.cLu:Ae.getter=Zt,Ae.inputSize=2}else{if(Ae.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Ae.type+" for "+ge.compression+".");switch(bt){case p.VzW:Ae.getter=Ye,Ae.inputSize=4;break;case p.cLu:Ae.getter=Tt,Ae.inputSize=4}}Ae.blockCount=(ge.dataWindow.yMax+1)/Ae.scanlineBlockSize;for(let zt=0;zt<Ae.blockCount;zt++)Ve(je,St);Ae.outputChannels=Ae.channels==3?4:Ae.channels;const st=Ae.width*Ae.height*Ae.outputChannels;switch(bt){case p.VzW:Ae.byteArray=new Float32Array(st),Ae.channels<Ae.outputChannels&&Ae.byteArray.fill(1,0,st);break;case p.cLu:Ae.byteArray=new Uint16Array(st),Ae.channels<Ae.outputChannels&&Ae.byteArray.fill(15360,0,st);break;default:console.error("THREE.EXRLoader: unsupported type: ",bt)}return Ae.bytesPerLine=Ae.width*Ae.inputSize*Ae.channels,Ae.outputChannels==4?(Ae.format=p.wk1,Ae.colorSpace=p.GUF):(Ae.format=p.hEm,Ae.colorSpace=p.aCh),Ae}(wt,Wi,Gi,Ui,this.type),li={value:0},ar={R:0,G:1,B:2,A:3,Y:0};for(let ge=0;ge<yt.height/yt.scanlineBlockSize;ge++){const je=Je(Wi,Ui);yt.size=Je(Wi,Ui),yt.lines=je+yt.scanlineBlockSize>yt.height?yt.height-je:yt.scanlineBlockSize;const nt=yt.size<yt.lines*yt.bytesPerLine?yt.uncompress(yt):re(yt);Ui.value+=yt.size;for(let St=0;St<yt.scanlineBlockSize;St++){const bt=St+ge*yt.scanlineBlockSize;if(bt>=yt.height)break;for(let Ae=0;Ae<yt.channels;Ae++){const st=ar[wt.channels[Ae].name];for(let zt=0;zt<yt.width;zt++){li.value=(St*(yt.channels*yt.width)+Ae*yt.width+zt)*yt.inputSize;const si=(yt.height-1-bt)*(yt.width*yt.outputChannels)+zt*yt.outputChannels+st;yt.byteArray[si]=yt.getter(nt,li)}}}}return{header:wt,width:yt.width,height:yt.height,data:yt.byteArray,format:yt.format,colorSpace:yt.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,r){return super.load(e,function(s,o){s.colorSpace=o.colorSpace,s.minFilter=p.wem,s.magFilter=p.wem,s.generateMipmaps=!1,s.flipY=!1,t&&t(s,o)},i,r)}}class QE extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut]}async onAdded(e){var t,i;this._importer||(this._importer=new Tn(class extends vP{constructor(r){super(r),this.setDataType(Rv(e.renderer.rendererObject))}},["exr"],!1)),(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,i;this._importer&&!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}QE.PluginType="EXRLoadPlugin";const WE=new WeakMap;class _P extends p.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){const s=new p.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,o=>{if(WE.has(o))return WE.get(o).promise.then(t).catch(r);this.decodeObjects(o,e).then(l=>{l.userData.warnings=this.warnings,this.warnings=[],t(l)}).catch(l=>r(l))},i,r)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let i,r;const s=e.byteLength,o=this._getWorker(s).then(l=>(i=l,r=this.workerNextTaskID++,new Promise((u,h)=>{i._callbacks[r]={resolve:u,reject:h},i.postMessage({type:"decode",id:r,buffer:e},[e])}))).then(l=>this._createGeometry(l.data)).catch(l=>{throw l});return o.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),WE.set(e,{url:t,promise:o}),o}parse(e,t,i){this.decodeObjects(e,"").then(r=>{r.userData.warnings=this.warnings,t(r)}).catch(r=>i(r))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const i=JSON.stringify(t);for(let r=0;r<this.materials.length;r++){const s=this.materials[r],o={};if(o.name=s.name,o.color={},o.color.r=s.color.r,o.color.g=s.color.g,o.color.b=s.color.b,o.type=s.type,JSON.stringify(o)===i)return s}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new p.Wid({color:new p.Ilk(1,1,1),metalness:.8,name:"default",side:p.ehD});const t=e.diffuseColor,i=new p.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(i.r=1,i.g=1,i.b=1);const r=new p.Wid({color:i,name:e.name,side:p.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),s=new p.dpR;for(let o=0;o<e.textures.length;o++){const l=e.textures[o];if(l.image!==null){const u=s.load(l.image);switch(l.type){case"Diffuse":r.map=u;break;case"Bump":r.bumpMap=u;break;case"Transparency":r.alphaMap=u,r.transparent=!0;break;case"Emap":r.envMap=u}u.wrapS=l.wrapU===0?p.rpg:p.uWy,u.wrapT=l.wrapV===0?p.rpg:p.uWy,u.repeat.set(l.repeat[0],l.repeat[1])}}return r}_createGeometry(e){const t=new p.Tme,i=[],r=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const l=e.materials;for(let u=0;u<o.length;u++){const h=o[u],f=h.attributes;switch(h.objectType){case"InstanceDefinition":r.push(h);break;case"InstanceReference":s.push(h);break;default:let g;if(f.materialIndex>=0){const A=l[f.materialIndex];let x=this._createMaterial(A);x=this._compareMaterials(x),g=this._createObject(h,x)}else{const A=this._createMaterial();g=this._createObject(h,A)}if(g===void 0)continue;const _=e.layers[f.layerIndex];g.visible=!_||_.visible,f.isInstanceDefinitionObject?i.push(g):t.add(g)}}for(let u=0;u<r.length;u++){const h=r[u];o=[];for(let f=0;f<h.attributes.objectIds.length;f++){const g=h.attributes.objectIds[f];for(let _=0;_<i.length;_++)g===i[_].userData.attributes.id&&o.push(i[_])}for(let f=0;f<s.length;f++){const g=s[f];if(g.geometry.parentIdefId===h.attributes.id){const _=g.geometry.xform.array,A=new p.yGw;if(A.set(..._),o.length===1){const x=o[0].clone(!0);if(x.name=g.attributes.name||x.name,x.applyMatrix4(A),g.attributes.materialIndex>=0&&g.attributes.materialIndex!==o[0].userData.attributes.materialIndex){const E=l[g.attributes.materialIndex],T=this._createMaterial(E);x.material=this._compareMaterials(T)}if(x.userData.defAttributes=x.userData.attributes,x.userData.defObjectType=x.userData.objectType,x.userData.attributes={...x.userData.attributes,...g.attributes},x.userData.objectType=g.objectType,g.attributes.layerIndex!==void 0){const E=e.layers[g.attributes.layerIndex];x.visible=E?E.visible:x.visible}t.add(x)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const x=new p.Tme;x.applyMatrix4(A);for(let E=0;E<o.length;E++)x.add(o[E].clone(!0));t.add(x)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const i=new p.s4_,r=e.attributes;let s,o,l,u;switch(e.objectType){case"Point":case"PointSet":s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")?o=new p.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(l=r.drawColor,u=new p.Ilk(l.r/255,l.g/255,l.b/255),o=new p.UY4({color:u,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const h=new p.woe(s,o);return h.userData.attributes=r,h.userData.objectType=e.objectType,r.name&&(h.name=r.name),h;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;s=i.parse(e.geometry),s.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const f=new p.Kj0(s,t);return f.castShadow=r.castsShadows,f.receiveShadow=r.receivesShadows,f.userData.attributes=r,f.userData.objectType=e.objectType,r.name&&(f.name=r.name,s.name=r.name),f;case"Curve":s=i.parse(e.geometry),l=r.drawColor,u=new p.Ilk(l.r/255,l.g/255,l.b/255),o=new p.nls({color:u}),o=this._compareMaterials(o);const g=new p.x12(s,o);return g.userData.attributes=r,g.userData.objectType=e.objectType,r.name&&(g.name=r.name),g;case"TextDot":s=e.geometry;const _=document.createElement("canvas").getContext("2d"),A=`${s.fontHeight}px ${s.fontFace}`;_.font=A;const x=_.measureText(s.text).width+10,E=s.fontHeight+10,T=window.devicePixelRatio;_.canvas.width=x*T,_.canvas.height=E*T,_.canvas.style.width=x+"px",_.canvas.style.height=E+"px",_.setTransform(T,0,0,T,0,0),_.font=A,_.textBaseline="middle",_.textAlign="center",u=r.drawColor,_.fillStyle=`rgba(${u.r},${u.g},${u.b},${u.a})`,_.fillRect(0,0,x,E),_.fillStyle="white",_.fillText(s.text,x/2,E/2);const R=new p.ROQ(_.canvas);R.minFilter=p.wem,R.wrapS=p.uWy,R.wrapT=p.uWy,o=new p.xeV({map:R,depthTest:!1});const I=new p.jyi(o);return I.position.set(s.point[0],s.point[1],s.point[2]),I.scale.set(x/10,E/10,1),I.userData.attributes=r,I.userData.objectType=e.objectType,r.name&&(I.name=r.name),I;case"Light":let S;switch(s=e.geometry,s.lightStyle.name){case"LightStyle_WorldPoint":S=new p.cek,S.castShadow=r.castsShadows,S.position.set(s.location[0],s.location[1],s.location[2]),S.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":S=new p.PMe,S.castShadow=r.castsShadows,S.position.set(s.location[0],s.location[1],s.location[2]),S.target.position.set(s.direction[0],s.direction[1],s.direction[2]),S.angle=s.spotAngleRadians,S.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":S=new p.T_f;const O=Math.abs(s.width[2]),k=Math.abs(s.length[0]);S.position.set(s.location[0]-k/2,s.location[1],s.location[2]-O/2),S.height=k,S.width=O,S.lookAt(s.direction[0],s.direction[1],s.direction[2]);break;case"LightStyle_WorldDirectional":S=new p.Ox3,S.castShadow=r.castsShadows,S.position.set(s.location[0],s.location[1],s.location[2]),S.target.position.set(s.direction[0],s.direction[1],s.direction[2]),S.shadow.normalBias=.1}return S&&(S.intensity=s.intensity,l=s.diffuse,u=new p.Ilk(l.r/255,l.g/255,l.b/255),S.color=u,S.userData.attributes=r,S.userData.objectType=e.objectType),S}}_initLibrary(){if(!this.libraryPending){const e=new p.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((s,o)=>{e.load("rhino3dm.js",s,void 0,o)}),i=new p.hH6(this.manager);i.setPath(this.libraryPath),i.setResponseType("arraybuffer");const r=new Promise((s,o)=>{i.load("rhino3dm.wasm",s,void 0,o)});this.libraryPending=Promise.all([t,r]).then(([s,o])=>{this.libraryConfig.wasmBinary=o;const l=yP,u=["/* rhino3dm.js */",s,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",libraryConfig:this.libraryConfig}),i.onmessage=r=>{const s=r.data;switch(s.type){case"warning":this.warnings.push(s.data),console.warn(s.data);break;case"decode":i._callbacks[s.id].resolve(s);break;case"error":i._callbacks[s.id].reject(s);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const yP=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var H0,ob=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class aa extends _P{constructor(e){super(e),this.materials=[],this.setLibraryPath(aa.LIBRARY_PATH)}_createMaterial(e){return aa.ImportMaterials?super._createMaterial(e):this.materials[0]||new p.Wid({color:new p.Ilk(1,1,1),metalness:.8,name:"default",side:p.ehD})}async loadAsync(e,t){const i=await super.loadAsync(e,t);i.rotateX(-Math.PI/2),i.userData.materials&&delete i.userData.materials;const r=i.userData.layers;return i.traverse(s=>{var o,l,u,h,f;const g=(o=s.userData.attributes)===null||o===void 0?void 0:o.castsShadows,_=(l=s.userData.attributes)===null||l===void 0?void 0:l.receivesShadows;s.castShadow=g,s.receiveShadow=_;const A=(h=(u=s.userData.attributes)===null||u===void 0?void 0:u.layerIndex)!==null&&h!==void 0?h:(f=s.userData.defAttributes)===null||f===void 0?void 0:f.layerIndex,x=r[A];x&&(s.userData.rhinoLayer=x),s.userData.rhino3dmRoot=i.uuid,this._hideLineMesh(s),this._useInstancedMesh(s),this._useMaterialSource(s,x)}),this.materials=[],i}_useMaterialSource(e,t){var i,r,s,o,l;if(!aa.ImportMaterials)return;const u=e;if(((i=u.material)===null||i===void 0?void 0:i.name)==="default"||aa.ForceLayerMaterials){const h=((r=u.userData.attributes)===null||r===void 0?void 0:r.materialSource)||((s=u.userData.defAttributes)===null||s===void 0?void 0:s.materialSource),f=((o=u.userData.attributes)===null||o===void 0?void 0:o.colorSource)||((l=u.userData.defAttributes)===null||l===void 0?void 0:l.colorSource);if(!aa.ForceLayerMaterials&&!h&&!f)return;aa.ForceLayerMaterials||(h==null?void 0:h.value)===0||(h==null?void 0:h.value)===1&&(f==null?void 0:f.value)===0?t&&(u.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(h==null?void 0:h.value)===3||(h==null?void 0:h.value)===1&&(f==null?void 0:f.value)===3?u.traverseAncestors(g=>{g!=null&&g.material&&(u.material=g.material)}):h&&h.value!==1&&console.warn("Unknown material source",h,u,u.userData.attributes)}}_useInstancedMesh(e){if(!aa.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,i=t.map(r=>r.geometry);i.filter((r,s)=>i.indexOf(r)===s).forEach(r=>{var s;const o=t.filter(u=>u.geometry===r),l=o.length>0?o.filter(u=>u.material===o[0].material):[];if(l.length>1){const u=new p.SPe(r,l[0].material,l.length);u.userData={...l[0].userData},u.userData.instanceUserData=[],u.userData.attributes=u.userData.defAttributes||u.userData.attributes,u.userData.defAttributes&&delete u.userData.defAttributes,u.name=((s=u.userData.attributes)===null||s===void 0?void 0:s.name)||l[0].name,l.forEach((h,f)=>{u.setMatrixAt(f,h.matrix),e.remove(h),u.userData.instanceUserData.push(h.userData)}),e.add(u)}})}_hideLineMesh(e){if(!aa.HideLineMesh||e.children.length<=0)return;const t=[];e.traverse(i=>{i&&(i.isLine||i.isLineSegments||i.isPoints)&&t.push(i)}),t.forEach(i=>{i.userData.visible_3dm=i.visible,i.visible=!1})}}aa.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",aa.ImportMaterials=!0,aa.ForceLayerMaterials=!1,aa.ReplaceWithInstancedMesh=!1,aa.HideLineMesh=!1;let eh=H0=class extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut],this._importer=new Tn(aa,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1}_refresh(){aa.ImportMaterials=this.importMaterials,aa.ForceLayerMaterials=this.forceLayerMaterials,aa.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,aa.HideLineMesh=this.hideLineMesh}async onAdded(a){var e,t;(t=(e=a.getManager())===null||e===void 0?void 0:e.importer)===null||t===void 0||t.Importers.push(this._importer),this._refresh()}async onDispose(a){}async onRemove(a){var e,t;!((t=(e=a.getManager())===null||e===void 0?void 0:e.importer)===null||t===void 0)&&t.Importers&&a.getManager().importer.Importers.splice(a.getManager().importer.Importers.indexOf(this._importer),1)}};eh.PluginType="Rhino3dmLoadPlugin",ob([(0,V.onChange)(H0.prototype._refresh),Ot()],eh.prototype,"importMaterials",void 0),ob([(0,V.onChange)(H0.prototype._refresh),Ot()],eh.prototype,"forceLayerMaterials",void 0),ob([(0,V.onChange)(H0.prototype._refresh),Ot()],eh.prototype,"replaceWithInstancedMesh",void 0),ob([(0,V.onChange)(H0.prototype._refresh),Ot()],eh.prototype,"hideLineMesh",void 0),eh=H0=ob([zi("Rhino 3dm loader")],eh);class bP extends p.aNw{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new p.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(s.parse(l))}catch(u){r?r(u):console.error(u),s.manager.itemError(e)}},i,r)}parse(e){function t(s,o,l){for(let u=0,h=s.length;u<h;u++)if(s[u]!==o.getUint8(l+u))return!1;return!0}const i=function(s){if(typeof s=="string"){const o=new Uint8Array(s.length);for(let l=0;l<s.length;l++)o[l]=255&s.charCodeAt(l);return o.buffer||o}return s}(e);return function(s){const o=new DataView(s);if(84+50*o.getUint32(80,!0)===o.byteLength)return!0;const l=[115,111,108,105,100];for(let u=0;u<5;u++)if(t(l,o,u))return!1;return!0}(i)?function(s){const o=new DataView(s),l=o.getUint32(80,!0);let u,h,f,g,_,A,x,E,T=!1;for(let k=0;k<70;k++)o.getUint32(k,!1)==1129270351&&o.getUint8(k+4)==82&&o.getUint8(k+5)==61&&(T=!0,g=new Float32Array(3*l*3),_=o.getUint8(k+6)/255,A=o.getUint8(k+7)/255,x=o.getUint8(k+8)/255,E=o.getUint8(k+9)/255);const R=new p.u9r,I=new Float32Array(3*l*3),S=new Float32Array(3*l*3),O=new p.Ilk;for(let k=0;k<l;k++){const N=84+50*k,H=o.getFloat32(N,!0),X=o.getFloat32(N+4,!0),te=o.getFloat32(N+8,!0);if(T){const re=o.getUint16(N+48,!0);32768&re?(u=_,h=A,f=x):(u=(31&re)/31,h=(re>>5&31)/31,f=(re>>10&31)/31)}for(let re=1;re<=3;re++){const ue=N+12*re,le=3*k*3+3*(re-1);I[le]=o.getFloat32(ue,!0),I[le+1]=o.getFloat32(ue+4,!0),I[le+2]=o.getFloat32(ue+8,!0),S[le]=H,S[le+1]=X,S[le+2]=te,T&&(O.set(u,h,f).convertSRGBToLinear(),g[le]=O.r,g[le+1]=O.g,g[le+2]=O.b)}}return R.setAttribute("position",new p.TlE(I,3)),R.setAttribute("normal",new p.TlE(S,3)),T&&(R.setAttribute("color",new p.TlE(g,3)),R.hasColors=!0,R.alpha=E),R}(i):function(s){const o=new p.u9r,l=/solid([\s\S]*?)endsolid/g,u=/facet([\s\S]*?)endfacet/g;let h=0;const f=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,g=new RegExp("vertex"+f+f+f,"g"),_=new RegExp("normal"+f+f+f,"g"),A=[],x=[],E=new p.Pa4;let T,R=0,I=0,S=0;for(;(T=l.exec(s))!==null;){I=S;const O=T[0];for(;(T=u.exec(O))!==null;){let H=0,X=0;const te=T[0];for(;(T=_.exec(te))!==null;)E.x=parseFloat(T[1]),E.y=parseFloat(T[2]),E.z=parseFloat(T[3]),X++;for(;(T=g.exec(te))!==null;)A.push(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])),x.push(E.x,E.y,E.z),H++,S++;X!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+h),H!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+h),h++}const k=I,N=S-I;o.addGroup(k,N,R),R++}return o.setAttribute("position",new p.a$l(A,3)),o.setAttribute("normal",new p.a$l(x,3)),o}(typeof(r=e)!="string"?new TextDecoder().decode(r):r);var r}}class XE extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut]}async onAdded(e){var t,i;this._importer||(this._importer=new Tn(bP,["stl"],!0)),(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,i;this._importer&&!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}XE.PluginType="STLLoadPlugin";class Q0 extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from '${Q0.DECODER_URL}';
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}Q0.PluginType="GLTFMeshOptPlugin",Q0.DECODER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_decoder.module.js";var Uw,oo=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let us=Uw=class extends Si{constructor(a=!0){super(),this.animationRunning=!1,this.interactionsDisabled=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this._xDamper=new V.Damper(50),this.pointerIcon=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, -25%);" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z"></path>
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A"></use>
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>
            </g>
        </g>
    </g>
</svg>`,this._activeCameraUpdate=e=>{this.isDisabled()||(e.change==="deserialize"?(this.stopAnimation(),this.startAnimation()):this.lastActionTime=(0,V.now)())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=(0,V.now)()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this._orbitWarning=!1,this.startAnimation=()=>{var e;if(this._viewer&&this.cursorEl&&!this.isDisabled())return((e=this._viewer.scene.activeCamera.controls)===null||e===void 0?void 0:e.type)!=="OrbitControls"&&this.onlyOnOrbitControls?(this._orbitWarning||console.warn("WebGi InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"),void(this._orbitWarning=!0)):void(this._viewer.scene.modelRoot.children.length!==0&&(this.currentSphericalPosition=new p.$V().setFromVector3(new p.Pa4().subVectors(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this.interactionsDisabled=!0,this._viewer.scene.activeCamera.setInteractions(!1,Uw.PluginType)))},this.stopAnimation=()=>{this._viewer&&this.cursorEl&&(this.animationRunning=!1,this.cursorEl.style.opacity="0",this._viewer.scene.activeCamera.setInteractions(!0,Uw.PluginType),this.interactionsDisabled&&(this.interactionsDisabled=!1))},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation(),this.lastActionTime=(0,V.now)())},this._x=0,this._preFrame=async e=>{if(!this._viewer||!this.cursorEl||(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())||(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<(0,V.now)()&&this.startAnimation(),!this.animationRunning))return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const s=this.currentTime/this.animationDuration;this._x=Math.sin(2*Math.PI*s),(s<.25||s>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const s=this.currentSphericalPosition.clone();s.theta+=this._x*this.rotationDistance,this._viewer.scene.activeCamera.position.setFromSpherical(s).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated()}const t=this._viewer.container.getBoundingClientRect(),i=t.width/2+-this._x*Math.min(this.animationDistance,t.width/4),r=t.height/2+this.yOffset*t.height/2;this.cursorEl.style.transform=`translate(${Math.floor(i)}px, ${Math.floor(r)}px)`,this.currentTime+=e.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this._disabledBy=new Set,this.disable=e=>{this._disabledBy.size,this._disabledBy.add(e)},this.enable=e=>{this._disabledBy.size,this._disabledBy.delete(e)},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled,this.enabled=a}async onAdded(a){await super.onAdded(a);{a.plugins.hasOwnProperty("InteractionPointerPlugin")&&delete a.plugins.InteractionPointerPlugin;const e=this;Object.defineProperty(a.plugins,"InteractionPointerPlugin",{get(){return console.warn("WebGi InteractionPromptPlugin: PluginType renamed from InteractionPointerPlugin to InteractionPromptPlugin. Please update your code/vjson."),e},configurable:!0})}this.lastActionTime=1/0,a.addEventListener("preFrame",this._preFrame),a.container.addEventListener("pointerdown",this._pointerDown,!0),a.container.addEventListener("wheel",this._pointerDown,!0),a.scene.addEventListener("addSceneObject",this._addSceneObject),a.scene.addEventListener("activeCameraUpdate",this._activeCameraUpdate),this._initializeCursor()}async onRemove(a){return this.stopAnimation(),a.removeEventListener("preFrame",this._preFrame),a.container.removeEventListener("pointerdown",this._pointerDown,!0),a.container.removeEventListener("wheel",this._pointerDown,!0),a.scene.removeEventListener("addSceneObject",this._addSceneObject),a.scene.removeEventListener("activeCameraUpdate",this._activeCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(a)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this.cursorEl.innerHTML=this.pointerIcon,this._viewer.container.appendChild(this.cursorEl)}};us.PluginType="InteractionPromptPlugin",oo([ae(),Ot()],us.prototype,"enabled",void 0),oo([ae(),Ci()],us.prototype,"animationDuration",void 0),oo([ae(),Ci()],us.prototype,"animationDistance",void 0),oo([ae(),Ci()],us.prototype,"animationPauseDuration",void 0),oo([ae(),Ci()],us.prototype,"rotationDistance",void 0),oo([ae(),Ci()],us.prototype,"yOffset",void 0),oo([ae(),Ot()],us.prototype,"autoStart",void 0),oo([ae(),Ci()],us.prototype,"autoStartDelay",void 0),oo([ae(),Ot()],us.prototype,"autoStop",void 0),oo([ae(),Ot()],us.prototype,"autoStartOnObjectLoad",void 0),oo([ae(),Ot()],us.prototype,"autoStartOnObjectLoadDelay",void 0),oo([ql()],us.prototype,"currentTime",void 0),oo([ql()],us.prototype,"lastActionTime",void 0),oo([ae()],us.prototype,"onlyOnOrbitControls",void 0),oo([Xi()],us.prototype,"startAnimation",void 0),oo([Xi()],us.prototype,"stopAnimation",void 0),us=Uw=oo([zi("Interaction Prompt")],us);class aM extends to{constructor(e){super(e),this.licenseKey=e.licenseKey}async initialize({caching:e=!0,ground:t=!0,bloom:i=!0,depthTonemap:r=!0,enableDrop:s=!1,importPopup:o=!0,debug:l=!1,interactionPrompt:u=!0}={}){l&&await this.addPlugin(Cc),this.getPlugin(Ut)||this.addPluginSync(Ut,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await Nw(this,{ground:t,bloom:i,depthTonemap:r,enableDrop:s,importPopup:o,interactionPrompt:u}),await this.getOrAddPlugin(Du);const h=await this.getOrAddPlugin(Xr);return this.licenseKey&&h.setKey(this.licenseKey),await this.addPlugin(Mp),await this.addPlugin(Tp),await this.addPlugin(Kh),this}}async function Nw(a,{ground:e=!0,bloom:t=!0,depthTonemap:i=!0,enableDrop:r=!1,importPopup:s=!1,interactionPrompt:o=!0}={}){await a.getOrAddPlugin(Ut),s&&await a.getOrAddPlugin(Zr),await a.getOrAddPlugin(vr),await a.getOrAddPlugin(Mo),r&&await a.getOrAddPlugin(eo),await a.addPlugin(new As(32)),await a.getOrAddPlugin(vn),await a.getOrAddPlugin(Om),await a.addPlugin(new hc(i||!a.useRgbm)),await a.getOrAddPlugin(xn),await a.getOrAddPlugin(Kf),await a.getOrAddPlugin($c),await a.getOrAddPlugin(x0),await a.getOrAddPlugin(rp),await a.getOrAddPlugin(km),await a.getOrAddPlugin(Dl),await a.getOrAddPlugin(tn),await a.getOrAddPlugin(xo),await a.getOrAddPlugin(To),await a.getOrAddPlugin(Zo),await a.getOrAddPlugin(Eo),await a.getOrAddPlugin(rl),await a.getOrAddPlugin(Oa),await a.getOrAddPlugin(nl),await a.getOrAddPlugin(xc),await a.getOrAddPlugin(tl,!1),await a.getOrAddPlugin(Zf),await a.getOrAddPlugin(Ir),await a.getOrAddPlugin(Dh,!1),await a.getOrAddPlugin(pc,!1),await a.getOrAddPlugin(Ih,!1),await a.getOrAddPlugin(ro,!1),await a.getOrAddPlugin(Pf,!1),await a.getOrAddPlugin(Rh,!1),await a.getOrAddPlugin(Ec,!1),await a.getOrAddPlugin(Hh),await a.getOrAddPlugin(yg),await a.getOrAddPlugin(G),await a.getOrAddPlugin(eh),await a.getOrAddPlugin(XE),await a.getOrAddPlugin(QE),await a.getOrAddPlugin(Q0),await a.getOrAddPlugin(Ds),await a.getOrAddPlugin(Co),t&&await a.getOrAddPlugin(Aa),e&&await a.getOrAddPlugin(Ul),o&&await a.getOrAddPlugin(us),await a.getOrAddPlugin(Ll),a.renderer.refreshPipeline()}var Fw=__webpackgi_require__(109),lb={};Fw.Z&&Fw.Z.locals&&(lb.locals=Fw.Z.locals);var qE,YE=0,Dg={};Dg.styleTagTransform=gc(),Dg.setAttributes=tu(),Dg.insert=function(a,e){(e.target||document.head).appendChild(a)},Dg.domAPI=mc(),Dg.insertStyleElement=Lu(),lb.use=function(a){return Dg.options=a||{},YE++||(qE=fc()(Fw.Z,Dg)),lb},lb.unuse=function(){YE>0&&!--YE&&(qE(),qE=null)};var oM=lb;let AP=0;class lM extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=AP++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),t=document.createElement("style");t.textContent=V.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
            //.tippy-box[data-theme~='editor']{
            //    margin: 0.25rem !important;
            //    background-color: hsla(230, 10%, 30%, 1.00) !important;
            //    font-size: 0.9rem !important;
            //    color: hsla(230, 5%, 90%, 1.00) !important;
            //}
        `,oM.use({target:this.wrapper}),Cp.setDefaultProps({duration:300,arrow:!0,appendTo:()=>this.wrapper}),this.shadowRoot.append(t,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,V.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new aM({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)===null||e===void 0||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((t=this.canvas)===null||t===void 0||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,i){this.refreshAll()}clearViewer(){var e,t;(e=this.viewer)===null||e===void 0||e.scene.disposeSceneModels(),(t=this.viewer)===null||t===void 0||t.scene.setEnvironment(null),Object.values(this._models).forEach(async i=>i.then(r=>r.forEach(s=>s.dispose&&s.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],i=[],r=[],s=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const l of t)!this._models[l]&&l&&(this._models[l]=this.viewer.getManager().importer.importPath(l,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const o=this.viewer.scene.environment;o?this._environmentFromSource=o:this.viewer.scene.environment=s;for(const[l,u]of Object.entries(this._models))t.includes(l)?i.push(u.then(h=>[l,h])):r.push(u);await Promise.all([Promise.all(i).then(async l=>Promise.all(l.map(async u=>(this._models[u[0]]=this.viewer.getManager().importer.processImported(u[1]),this._models[u[0]])))).then(l=>{for(const u of l)for(const h of u)h&&h.assetType==="model"&&this.viewer.scene.addSceneObject(h)}),Promise.all(r).then(l=>{for(const u of l)for(const h of u)h&&h.assetType==="model"&&h.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),i=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(i&&i.assetType!=="texture"||await this.viewer.scene.setEnvironment(i),t==null||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,i){super.addEventListener(e,t,i),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",lM);var jw=__webpackgi_require__(798),cb={};jw.Z&&jw.Z.locals&&(cb.locals=jw.Z.locals);var KE,ZE=0,Bg={};Bg.styleTagTransform=gc(),Bg.setAttributes=tu(),Bg.insert=function(a,e){(e.target||document.head).appendChild(a)},Bg.domAPI=mc(),Bg.insertStyleElement=Lu(),cb.use=function(a){return Bg.options=a||{},ZE++||(KE=fc()(jw.Z,Bg)),cb},cb.unuse=function(){ZE>0&&!--ZE&&(KE(),KE=null)};var wP=cb;let zw=class extends Lh{constructor(){super("Popup");const a=(0,V.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});a.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(a)}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";a.forEach((t,i)=>{e+=`<span class="processState">${t.state}</span>: ${(i||"").split("/").pop()} ${t.progress?" - "+t.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){wP.use({target:a.container}),await super.onAdded(a)}};zw.PluginType="AssetManagerBasicPopupPlugin",zw=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([zi("Asset manager popup")],zw);var Vw=__webpackgi_require__(44),ub={};Vw.Z&&Vw.Z.locals&&(ub.locals=Vw.Z.locals);var JE,$E=0,Og={};Og.styleTagTransform=gc(),Og.setAttributes=tu(),Og.insert=function(a,e){(e.target||document.head).appendChild(a)},Og.domAPI=mc(),Og.insertStyleElement=Lu(),ub.use=function(a){return Og.options=a||{},$E++||(JE=fc()(Vw.Z,Og)),ub},ub.unuse=function(){$E>0&&!--$E&&(JE(),JE=null)};var xP=ub,cM=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let W0=class extends Lh{constructor(a=!0){super("LoadingBar"),this.showText=a,this.hideOnOnlyErrors=!0}_updateMainDiv(a){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,t=1;a.forEach((r,s)=>{var o;e+=(o=r.progress)!==null&&o!==void 0?o:99,t+=100}),this._contentDiv.innerHTML=this.showText?(100*e/t).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/t).toFixed(0)+"%";const i=[...a.values()].filter(r=>r.state==="error");i.length>0&&i.length===a.size&&this.hideOnOnlyErrors||a.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(a){xP.use({target:a.container}),await super.onAdded(a)}};W0.PluginType="AssetManagerLoadingBarPlugin",cM([Ot("Hide on only errors"),ae()],W0.prototype,"hideOnOnlyErrors",void 0),W0=cM([zi("Asset manager loading bar")],W0);class Zh{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t,i,r;this._basePath=(t=e==null?void 0:e.basePath)!==null&&t!==void 0?t:"",this._assets=(r=(i=e==null?void 0:e.assets)===null||i===void 0?void 0:i.map(s=>this._resolveAsset(s)))!==null&&r!==void 0?r:[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,V.pathJoin)([this._basePath,e.path])}}}class EP extends V.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const i=t.find(r=>{var s,o;return r&&(e.test(r.path)||e.test((o=(s=r.file)===null||s===void 0?void 0:s.name)!==null&&o!==void 0?o:""))});if(i)return i}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const uM=new p.Pa4,hM=new p.Pa4,lo=new p.Ltg,co=new p.Ltg,Jh=new p.Ltg,eS=new p.Pa4,tS=new p.yGw,uo=new p.Zzh,dM=new p.Pa4,Gw=new p.ZzF,Hw=new p.aLr,$h=new p.Ltg;let ed,Lg,Qw,iS,X0,Ww;function pM(a,e,t){return $h.set(0,0,-e,1).applyMatrix4(a.projectionMatrix),$h.multiplyScalar(1/$h.w),$h.x=Lg/t.width,$h.y=Lg/t.height,$h.applyMatrix4(a.projectionMatrixInverse),$h.multiplyScalar(1/$h.w),Math.abs(Math.max($h.x,$h.y))}class Xw extends p.Kj0{constructor(e=new $d,t=new Bu({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,l=0,u=t.count;o<u;o++,l+=2)uM.fromBufferAttribute(t,o),hM.fromBufferAttribute(i,o),r[l]=l===0?0:r[l-1],r[l+1]=r[l]+uM.distanceTo(hM);const s=new p.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new p.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new p.kB5(s,1,1)),this}raycast(e,t){const i=this.material.worldUnits,r=e.camera;r!==null||i||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ed=e.ray;const o=this.matrixWorld,l=this.geometry,u=this.material;let h,f;Lg=u.linewidth+s,l.boundingSphere===null&&l.computeBoundingSphere(),Hw.copy(l.boundingSphere).applyMatrix4(o),h=i?.5*Lg:pM(r,Math.max(r.near,Hw.distanceToPoint(ed.origin)),u.resolution),Hw.radius+=h,ed.intersectsSphere(Hw)!==!1&&(l.boundingBox===null&&l.computeBoundingBox(),Gw.copy(l.boundingBox).applyMatrix4(o),f=i?.5*Lg:pM(r,Math.max(r.near,Gw.distanceToPoint(ed.origin)),u.resolution),Gw.expandByScalar(f),ed.intersectsBox(Gw)!==!1&&(i?function(g,_){const A=g.matrixWorld,x=g.geometry,E=x.attributes.instanceStart,T=x.attributes.instanceEnd;for(let R=0,I=Math.min(x.instanceCount,E.count);R<I;R++){uo.start.fromBufferAttribute(E,R),uo.end.fromBufferAttribute(T,R),uo.applyMatrix4(A);const S=new p.Pa4,O=new p.Pa4;ed.distanceSqToSegment(uo.start,uo.end,O,S),O.distanceTo(S)<.5*Lg&&_.push({point:O,pointOnLine:S,distance:ed.origin.distanceTo(O),object:g,face:null,faceIndex:R,uv:null,uv1:null})}}(this,t):function(g,_,A){const x=_.projectionMatrix,E=g.material.resolution,T=g.matrixWorld,R=g.geometry,I=R.attributes.instanceStart,S=R.attributes.instanceEnd,O=Math.min(R.instanceCount,I.count),k=-_.near;ed.at(1,Jh),Jh.w=1,Jh.applyMatrix4(_.matrixWorldInverse),Jh.applyMatrix4(x),Jh.multiplyScalar(1/Jh.w),Jh.x*=E.x/2,Jh.y*=E.y/2,Jh.z=0,eS.copy(Jh),tS.multiplyMatrices(_.matrixWorldInverse,T);for(let N=0,H=O;N<H;N++){if(lo.fromBufferAttribute(I,N),co.fromBufferAttribute(S,N),lo.w=1,co.w=1,lo.applyMatrix4(tS),co.applyMatrix4(tS),lo.z>k&&co.z>k)continue;if(lo.z>k){const le=lo.z-co.z,se=(lo.z-k)/le;lo.lerp(co,se)}else if(co.z>k){const le=co.z-lo.z,se=(co.z-k)/le;co.lerp(lo,se)}lo.applyMatrix4(x),co.applyMatrix4(x),lo.multiplyScalar(1/lo.w),co.multiplyScalar(1/co.w),lo.x*=E.x/2,lo.y*=E.y/2,co.x*=E.x/2,co.y*=E.y/2,uo.start.copy(lo),uo.start.z=0,uo.end.copy(co),uo.end.z=0;const X=uo.closestPointToPointParameter(eS,!0);uo.at(X,dM);const te=p.M8C.lerp(lo.z,co.z,X),re=te>=-1&&te<=1,ue=eS.distanceTo(dM)<.5*Lg;if(re&&ue){uo.start.fromBufferAttribute(I,N),uo.end.fromBufferAttribute(S,N),uo.start.applyMatrix4(T),uo.end.applyMatrix4(T);const le=new p.Pa4,se=new p.Pa4;ed.distanceSqToSegment(uo.start,uo.end,se,le),A.push({point:se,pointOnLine:le,distance:ed.origin.distanceTo(se),object:g,face:null,faceIndex:N,uv:null,uv1:null})}}}(this,r,t)))}}class hb extends $d{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class rS extends Xw{constructor(e=new hb,t=new Bu({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class SP extends p.DqL{constructor(e){super(e)}parse(e,t){const i=new CP(e,1);return{mipmaps:i.mipmaps(t),width:i.pixelWidth,height:i.pixelHeight,format:i.glInternalFormat,isCubemap:i.numberOfFaces===6,mipmapCount:i.numberOfMipmapLevels}}}class CP{constructor(e,t){this.arrayBuffer=e;const i=new Uint8Array(this.arrayBuffer,0,12);if(i[0]!==171||i[1]!==75||i[2]!==84||i[3]!==88||i[4]!==32||i[5]!==49||i[6]!==49||i[7]!==187||i[8]!==13||i[9]!==10||i[10]!==26||i[11]!==10)return void console.error("texture missing KTX identifier");const r=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*r),o=s.getUint32(0,!0)===67305985;this.glType=s.getUint32(1*r,o),this.glTypeSize=s.getUint32(2*r,o),this.glFormat=s.getUint32(3*r,o),this.glInternalFormat=s.getUint32(4*r,o),this.glBaseInternalFormat=s.getUint32(5*r,o),this.pixelWidth=s.getUint32(6*r,o),this.pixelHeight=s.getUint32(7*r,o),this.pixelDepth=s.getUint32(8*r,o),this.numberOfArrayElements=s.getUint32(9*r,o),this.numberOfFaces=s.getUint32(10*r,o),this.numberOfMipmapLevels=s.getUint32(11*r,o),this.bytesOfKeyValueData=s.getUint32(12*r,o),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let i=64+this.bytesOfKeyValueData,r=this.pixelWidth,s=this.pixelHeight;const o=e?this.numberOfMipmapLevels:1;for(let l=0;l<o;l++){const u=new Int32Array(this.arrayBuffer,i,1)[0];i+=4;for(let h=0;h<this.numberOfFaces;h++){const f=new Uint8Array(this.arrayBuffer,i,u);t.push({data:f,width:r,height:s}),i+=u,i+=3-(u+3)%4}r=Math.max(1,.5*r),s=Math.max(1,.5*s)}return t}}class nS extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[Ut]}async onAdded(e){var t,i;this._importer||(this._importer=new Tn(SP,["ktx"],!1)),(i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0||i.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,i;this._importer&&!((i=(t=e.getManager())===null||t===void 0?void 0:t.importer)===null||i===void 0)&&i.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}nS.PluginType="KTXLoadPlugin";class MP extends p.hH6{constructor(e){super(e),this.responseType="blob"}}class fM extends p.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,i,r){return super.load(e,s=>{try{t==null||t((0,V.blobToDataURL)(s))}catch(o){r==null||r(o)}},i,r)}}class mM{async parseAsync(e,t){var i;return new Blob([JSON.stringify(e,null,(i=t.jsonSpaces)!==null&&i!==void 0?i:2)],{type:"application/json"})}}class gM{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}function sS(a,e=1/0,t=null){iS||(iS=new p._12(2,2,1,1)),X0||(X0=new p.jyz({uniforms:{blitTexture:new p.xWb(a)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),X0.uniforms.blitTexture.value=a,X0.defines.IS_SRGB=a.colorSpace==p.KI_,X0.needsUpdate=!0,Ww||(Ww=new p.Kj0(iS,X0),Ww.frustrumCulled=!1);const i=new p.cPb,r=new p.xsS;r.add(Ww),t||(t=Qw=new p.CP7({antialias:!1})),t.setSize(Math.min(a.image.width,e),Math.min(a.image.height,e)),t.clear(),t.render(r,i);const s=new p.xEZ(t.domElement);return s.minFilter=a.minFilter,s.magFilter=a.magFilter,s.wrapS=a.wrapS,s.wrapT=a.wrapT,s.name=a.name,Qw&&(Qw.dispose(),Qw=null),s}const vM={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class qw{constructor(){this.pluginCallbacks=[],this.register(function(e){return new IP(e)}),this.register(function(e){return new PP(e)}),this.register(function(e){return new BP(e)}),this.register(function(e){return new OP(e)}),this.register(function(e){return new LP(e)}),this.register(function(e){return new kP(e)}),this.register(function(e){return new RP(e)}),this.register(function(e){return new DP(e)}),this.register(function(e){return new UP(e)}),this.register(function(e){return new NP(e)}),this.register(function(e){return new FP(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r,s){const o=s||new wM,l=[];for(let u=0,h=this.pluginCallbacks.length;u<h;u++)l.push(this.pluginCallbacks[u](o));o.setPlugins(l),o.write(e,t,r).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,r,s,t)})}}const aS=5120,oS=5121,lS=5122,cS=5123,uS="KHR_mesh_quantization",Tc={};Tc[p.TyD]=9728,Tc[p.YLQ]=9984,Tc[p.aH4]=9986,Tc[p.wem]=9729,Tc[p.qyh]=9985,Tc[p.D1R]=9987,Tc[p.uWy]=33071,Tc[p.rpg]=10497,Tc[p.OoA]=33648;const _M={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},TP=new p.Ilk;function db(a,e){return a.length===e.length&&a.every(function(t,i){return t===e[i]})}function yM(a){return 4*Math.ceil(a/4)}function Yw(a,e=0){const t=yM(a.byteLength);if(t!==a.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(a)),e!==0)for(let r=a.byteLength;r<t;r++)i[r]=e;return i.buffer}return a}function bM(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function AM(a,e){if(a.toBlob!==void 0)return new Promise(i=>a.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),a.convertToBlob({type:e,quality:t})}class wM{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,s=r.buffers,o=r.json;i=r.options;const l=r.extensionsUsed,u=r.extensionsRequired,h=new Blob(s,{type:"application/octet-stream"}),f=Object.keys(l),g=Object.keys(u);if(f.length>0&&(o.extensionsUsed=f),g.length>0&&(o.extensionsRequired=g),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=h.size),i.binary===!0){const _=new FileReader;_.readAsArrayBuffer(h),_.onloadend=function(){const A=Yw(_.result),x=new DataView(new ArrayBuffer(8));x.setUint32(0,A.byteLength,!0),x.setUint32(4,5130562,!0);const E=Yw((T=JSON.stringify(o),new TextEncoder().encode(T).buffer),32);var T;const R=new DataView(new ArrayBuffer(8));R.setUint32(0,E.byteLength,!0),R.setUint32(4,1313821514,!0);const I=new ArrayBuffer(12),S=new DataView(I);S.setUint32(0,1179937895,!0),S.setUint32(4,2,!0);const O=12+R.byteLength+E.byteLength+x.byteLength+A.byteLength;S.setUint32(8,O,!0);const k=new Blob([I,R,E,x,A],{type:"application/octet-stream"}),N=new FileReader;N.readAsArrayBuffer(k),N.onloadend=function(){t(N.result)}}}else if(o.buffers&&o.buffers.length>0){const _=new FileReader;_.readAsDataURL(h),_.onloadend=function(){const A=_.result;o.buffers[0].uri=A,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,r=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in s.gltfExtensions)t.extensions[o]=s.gltfExtensions[o],r[o]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new p.Pa4;for(let i=0,r=e.count;i<r;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),r=new p.Pa4;for(let s=0,o=i.count;s<o;s++)r.fromBufferAttribute(i,s),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),i.setXYZ(s,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const r={};t.offset.x===0&&t.offset.y===0||(r.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(r.rotation=t.rotation,i=!0),t.repeat.x===1&&t.repeat.y===1||(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(_){return _.colorSpace===p.KI_?function(A){return A<.04045?.0773993808*A:Math.pow(.9478672986*A+.0521327014,2.4)}:function(A){return A}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof p.EB7&&(e=sS(e)),t instanceof p.EB7&&(t=sS(t));const r=e?e.image:null,s=t?t.image:null,o=Math.max(r?r.width:0,s?s.width:0),l=Math.max(r?r.height:0,s?s.height:0),u=bM();u.width=o,u.height=l;const h=u.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,o,l);const f=h.getImageData(0,0,o,l);if(r){h.drawImage(r,0,0,o,l);const _=i(e),A=h.getImageData(0,0,o,l).data;for(let x=2;x<A.length;x+=4)f.data[x]=256*_(A[x]/256)}if(s){h.drawImage(s,0,0,o,l);const _=i(t),A=h.getImageData(0,0,o,l).data;for(let x=1;x<A.length;x+=4)f.data[x]=256*_(A[x]/256)}h.putImageData(f,0,0);const g=(e||t).clone();return g.source=new p.Hw6(u),g.colorSpace=p.aCh,g.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),g}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,s){const o=this.json;let l;switch(o.bufferViews||(o.bufferViews=[]),t){case aS:case oS:l=1;break;case lS:case cS:l=2;break;default:l=4}const u=yM(r*e.itemSize*l),h=new DataView(new ArrayBuffer(u));let f=0;for(let _=i;_<i+r;_++)for(let A=0;A<e.itemSize;A++){let x;e.itemSize>4?x=e.array[_*e.itemSize+A]:(A===0?x=e.getX(_):A===1?x=e.getY(_):A===2?x=e.getZ(_):A===3&&(x=e.getW(_)),e.normalized===!0&&(x=p.M8C.normalize(x,e.array))),t===5126?h.setFloat32(f,x,!0):t===5124?h.setInt32(f,x,!0):t===5125?h.setUint32(f,x,!0):t===lS?h.setInt16(f,x,!0):t===cS?h.setUint16(f,x,!0):t===aS?h.setInt8(f,x):t===oS&&h.setUint8(f,x),f+=l}const g={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:u};return s!==void 0&&(g.target=s),s===34962&&(g.byteStride=e.itemSize*l),this.byteOffset+=u,o.bufferViews.push(g),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(r){const s=new FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){const o=Yw(s.result),l={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,r(i.bufferViews.push(l)-1)}})}processBufferViewImageBuffer(e){const t=this,i=t.json;i.bufferViews||(i.bufferViews=[]),e=Yw(e);const r={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,i.bufferViews.push(r)-1}processAccessor(e,t,i,r){const s=this.json;let o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Int32Array)o=5124;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Int16Array)o=lS;else if(e.array.constructor===Uint16Array)o=cS;else if(e.array.constructor===Int8Array)o=aS;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);o=oS}if(i===void 0&&(i=0),r===void 0&&(r=e.count),r===0)return null;const l=function(g,_,A){const x={min:new Array(g.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(g.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let E=_;E<_+A;E++)for(let T=0;T<g.itemSize;T++){let R;g.itemSize>4?R=g.array[E*g.itemSize+T]:(T===0?R=g.getX(E):T===1?R=g.getY(E):T===2?R=g.getZ(E):T===3&&(R=g.getW(E)),g.normalized===!0&&(R=p.M8C.normalize(R,g.array))),x.min[T]=Math.min(x.min[T],R),x.max[T]=Math.max(x.max[T],R)}return x}(e,i,r);let u;t!==void 0&&(u=e===t.index?34963:34962);const h=this.processBufferView(e,o,i,r,u),f={bufferView:h.id,byteOffset:h.byteOffset,componentType:o,count:r,max:l.max,min:l.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(f.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(f)-1}processImage(e,t,i,r="image/png",s=void 0,o=void 0){if(e!==null){const l=this,u=l.cache,h=l.json,f=l.options,g=l.pending;u.images.has(e)||u.images.set(e,{});const _=u.images.get(e),A=r+":flipY/"+i.toString()+(s||o?";"+s+";"+o:"");if(_[A]!==void 0)return _[A];h.images||(h.images=[]);const x={mimeType:r},E=bM();E.width=Math.min(s||e.width,f.maxTextureSize),E.height=Math.min(o||e.height,f.maxTextureSize);const T=E.getContext("2d");if(i===!0&&(T.translate(0,E.height),T.scale(1,-1)),e.data!==void 0){t!==p.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>f.maxTextureSize||e.height>f.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const I=new Uint8ClampedArray(e.height*e.width*4);for(let S=0;S<I.length;S+=4)I[S+0]=e.data[S+0],I[S+1]=e.data[S+1],I[S+2]=e.data[S+2],I[S+3]=e.data[S+3];T.putImageData(new ImageData(I,e.width,e.height),0,0)}else T.drawImage(e,0,0,E.width,E.height);f.binary===!0?g.push(AM(E,r).then(I=>l.processBufferViewImage(I)).then(I=>{x.bufferView=I})):E.toDataURL!==void 0?x.uri=E.toDataURL(r):g.push(AM(E,r).then(I=>new FileReader().readAsDataURL(I)).then(I=>{x.uri=I}));const R=h.images.push(x)-1;return _[A]=R,R}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Tc[e.magFilter],minFilter:Tc[e.minFilter],wrapS:Tc[e.wrapS],wrapT:Tc[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.options,i=this.cache,r=this.json;if(i.textures.has(e))return i.textures.get(e);r.textures||(r.textures=[]),e instanceof p.EB7&&(e=sS(e,t.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png"),s==="image/jpg"&&(s="image/jpeg");const o={sampler:this.processSampler(e),source:!s||["image/jpeg","image/png"].includes(s)?this.processImage(e.image,e.format,e.flipY,s):null};e.name&&(o.name=e.name),this._invokeAll(function(u){u.writeTexture&&u.writeTexture(e,o)}),o.source===null&&console.error("GLTFExporter: Unsupported mime type: "+s+". Cannot export texture.",e);const l=r.textures.push(o)-1;return i.textures.set(e,l),l}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(db(s,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const l=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),u={index:this.processTexture(l),channel:l.channel};this.applyTextureTransform(u,l),r.pbrMetallicRoughness.metallicRoughnessTexture=u}if(e.map){const l={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(l,e.map),r.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){const l=e.emissive;if(Math.max(l.r,l.g,l.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const u={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(u,e.emissiveMap),r.emissiveTexture=u}}if(e.normalMap){const l={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(l.scale=e.normalScale.x),this.applyTextureTransform(l,e.normalMap),r.normalTexture=l}if(e.aoMap){const l={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(l.strength=e.aoMapIntensity),this.applyTextureTransform(l,e.aoMap),r.occlusionTexture=l}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===p.ehD&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(l){l.writeMaterial&&l.writeMaterial(e,r)});const o=i.materials.push(r)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let S=0,O=e.material.length;S<O;S++)r.push(e.material[S].uuid);else r.push(e.material.uuid);const s=r.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let l;l=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const u={},h={},f=[],g=[],_={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},A=o.getAttribute("normal");A===void 0||this.isNormalizedNormalAttribute(A)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(A)));let x=null;for(let S in o.attributes){if(S.slice(0,5)==="morph")continue;const O=o.attributes[S];if(S=_[S]||S.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(S)||(S="_"+S),t.attributes.has(this.getUID(O))){h[S]=t.attributes.get(this.getUID(O));continue}x=null;const k=O.array;S!=="JOINTS_0"||k instanceof Uint16Array||k instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),x=new p.TlE(new Uint16Array(k),O.itemSize,O.normalized));const N=this.processAccessor(x||O,o);N!==null&&(S.startsWith("_")||this.detectMeshQuantization(S,O),h[S]=N,t.attributes.set(this.getUID(O),N))}if(A!==void 0&&o.setAttribute("normal",A),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const S=[],O=[],k={};if(e.morphTargetDictionary!==void 0)for(const N in e.morphTargetDictionary)k[e.morphTargetDictionary[N]]=N;for(let N=0;N<e.morphTargetInfluences.length;++N){const H={};let X=!1;for(const te in o.morphAttributes){if(te!=="position"&&te!=="normal"){X||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),X=!0);continue}const re=o.morphAttributes[te][N],ue=te.toUpperCase(),le=o.attributes[te];if(t.attributes.has(this.getUID(re,!0))){H[ue]=t.attributes.get(this.getUID(re,!0));continue}const se=re.clone();if(!o.morphTargetsRelative)for(let de=0,ve=re.count;de<ve;de++)for(let fe=0;fe<re.itemSize;fe++)fe===0&&se.setX(de,re.getX(de)-le.getX(de)),fe===1&&se.setY(de,re.getY(de)-le.getY(de)),fe===2&&se.setZ(de,re.getZ(de)-le.getZ(de)),fe===3&&se.setW(de,re.getW(de)-le.getW(de));H[ue]=this.processAccessor(se,o),t.attributes.set(this.getUID(le,!0),H[ue])}g.push(H),S.push(e.morphTargetInfluences[N]),e.morphTargetDictionary!==void 0&&O.push(k[N])}u.weights=S,O.length>0&&(u.extras={},u.extras.targetNames=O)}const E=Array.isArray(e.material);if(E&&o.groups.length===0)return null;const T=E?e.material:[e.material],R=E?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let S=0,O=R.length;S<O;S++){const k={mode:l,attributes:h};if(this.serializeUserData(o,k),g.length>0&&(k.targets=g),o.index!==null){let H=this.getUID(o.index);R[S].start===void 0&&R[S].count===void 0||(H+=":"+R[S].start+":"+R[S].count),t.attributes.has(H)?k.indices=t.attributes.get(H):(k.indices=this.processAccessor(o.index,o,R[S].start,R[S].count),t.attributes.set(H,k.indices)),k.indices===null&&delete k.indices}const N=this.processMaterial(T[R[S].materialIndex]);N!==null&&(k.material=N),f.push(k)}u.primitives=f,i.meshes||(i.meshes=[]),this._invokeAll(function(S){S.writeMesh&&S.writeMesh(e,u)});const I=i.meshes.push(u)-1;return t.meshes.set(s,I),I}detectMeshQuantization(e,t){if(this.extensionsUsed[uS])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const r=e.split("_",1)[0];vM[r]&&vM[r].includes(i)&&(this.extensionsUsed[uS]=!0,this.extensionsRequired[uS]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:p.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const i=this.json,r=this.nodeMap;i.animations||(i.animations=[]);const s=(e=qw.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],l=[];for(let u=0;u<s.length;++u){const h=s[u],f=p.iUV.parseTrackName(h.name);let g=p.iUV.findNode(t,f.nodeName);const _=_M[f.propertyName];if(f.objectName==="bones"&&(g=g.isSkinnedMesh===!0?g.skeleton.getBoneByName(f.objectIndex):void 0),!g||!_)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const A=1;let x,E=h.values.length/h.times.length;_===_M.morphTargetInfluences&&(E/=g.morphTargetInfluences.length),h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(x="CUBICSPLINE",E/=3):x=h.getInterpolation()===p.Syv?"STEP":"LINEAR",l.push({input:this.processAccessor(new p.TlE(h.times,A)),output:this.processAccessor(new p.TlE(h.values,E)),interpolation:x}),o.push({sampler:l.length-1,target:{node:r.get(g),path:_}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:l,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],s=e.skeleton;if(s===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const l=[],u=new Float32Array(16*s.bones.length),h=new p.yGw;for(let f=0;f<s.bones.length;++f)l.push(i.get(s.bones[f])),h.copy(s.boneInverses[f]),h.multiply(e.bindMatrix).toArray(u,16*f);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new p.TlE(u,16)),joints:l,skeleton:i.get(o)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(i.trs){const l=e.quaternion.toArray(),u=e.position.toArray(),h=e.scale.toArray();db(l,[0,0,0,1])||(s.rotation=l),db(u,[0,0,0])||(s.translation=u),db(h,[1,1,1])||(s.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),db(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(s.mesh=l)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let u=0,h=e.children.length;u<h;u++){const f=e.children[u];if(f.visible||i.onlyVisible===!1){const g=this.processNode(f);g!==null&&l.push(g)}}l.length>0&&(s.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,s)});const o=t.nodes.push(s)-1;return r.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const s=[];for(let o=0,l=e.children.length;o<l;o++){const u=e.children[o];if(u.visible||i.onlyVisible===!1){const h=this.processNode(u);h!==null&&s.push(h)}}s.length>0&&(r.nodes=s),this.serializeUserData(e,r)}processObjects(e){const t=new p.xsS;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const i=[];for(let r=0;r<e.length;r++)e[r]instanceof p.xsS?this.processScene(e[r]):i.push(e[r]);i.length>0&&this.processObjects(i);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class IP{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,r=i.json,s=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},s[this.name]=!0);const l=r.extensions[this.name].lights;l.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:l.length-1}}}class PP{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class RP{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),s.clearcoatTexture=o}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(o,e.clearcoatNormalMap),s.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class DP{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),s.iridescenceTexture=o}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class BP{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),s.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class OP{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),s.thicknessTexture=o}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class LP{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}class kP{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(TP)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,r=i.extensionsUsed,s={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),s.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),s.specularColorTexture=o}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class UP{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const i=this.writer,r=i.extensionsUsed,s={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),s.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),s.sheenColorTexture=o}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,r[this.name]=!0}}class NP{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,r=i.extensionsUsed,s={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),s.anisotropyTexture=o}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class FP{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}qw.Utils={GLTFWriter:wM,insertKeyframe:function(a,e){const t=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),r=new a.ValueBufferType(a.values.length+t),s=a.createInterpolant(new a.ValueBufferType(t));let o;if(a.times.length===0){i[0]=e;for(let l=0;l<t;l++)r[l]=0;o=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;i[0]=e,i.set(a.times,1),r.set(s.evaluate(e),0),r.set(a.values,t),o=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;i[i.length-1]=e,i.set(a.times,0),r.set(a.values,0),r.set(s.evaluate(e),a.values.length),o=i.length-1}else for(let l=0;l<a.times.length;l++){if(Math.abs(a.times[l]-e)<.001)return l;if(a.times[l]<e&&a.times[l+1]>e){i.set(a.times.slice(0,l+1),0),i[l+1]=e,i.set(a.times.slice(l+1),l+2),r.set(a.values.slice(0,(l+1)*t),0),r.set(s.evaluate(e),(l+1)*t),r.set(a.values.slice((l+1)*t),(l+2)*t),o=l+1;break}}return a.times=i,a.values=r,o},mergeMorphTargetTracks:function(a,e){const t=[],i={},r=a.tracks;for(let s=0;s<r.length;++s){let o=r[s];const l=p.iUV.parseTrackName(o.name),u=p.iUV.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(p.NMF)}const h=u.morphTargetInfluences.length,f=u.morphTargetDictionary[l.propertyIndex];if(f===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let g;if(i[u.uuid]===void 0){g=o.clone();const A=new g.ValueBufferType(h*g.times.length);for(let x=0;x<g.times.length;x++)A[x*h+f]=g.values[x];g.name=(l.nodeName||"")+".morphTargetInfluences",g.values=A,i[u.uuid]=g,t.push(g);continue}const _=o.createInterpolant(new o.ValueBufferType(1));g=i[u.uuid];for(let A=0;A<g.times.length;A++)g.values[A*h+f]=_.evaluate(g.times[A]);for(let A=0;A<o.times.length;A++){const x=this.insertKeyframe(g,o.times[A]);g.values[x*h+f]=o.values[A]}}return a.tracks=t,a}};class xM extends qw.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new p.Wid}serializeUserData(e,t){const i=e.userData,r={};i.__disposed&&console.error("Serializing a disposed object",e),Object.entries(i).forEach(([o,l])=>{(!l||typeof l=="function"||l.isObject3D||l.isTexture||l.isMaterial||l.assetType!=null||o.startsWith("_")||o!=="uuid"&&(yl.includes(o)||$p.includes(o)||Lr.includes(o)))&&(r[o]=l,delete i[o])});const s=cr(i,!1);Object.entries(r).forEach(([o,l])=>{i[o]=l,delete r[o]}),e.userData=s,super.serializeUserData(e,t),e.userData=i}processObjects(e){var t;e.length===1&&!((t=e[0])===null||t===void 0)&&t.userData.rootSceneModelRoot?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const i=super.processMaterial(t);if(i===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return i;const r=JSON.stringify(this.json.materials[i]),s=JSON.parse(r);this.serializeUserData(e,s),this._invokeAll(l=>{l.writeMaterial&&l.writeMaterial(e,s)});const o=this.json.materials.push(s)-1;return this.cache.materials.set(e,o),o}processImageBlob(e,t){if(!e)return-1;const i=this.cache,r=this.options,s=this.pending,o=this.json,l=t.image;i.images.has(l)||i.images.set(l,{});const u=i.images.get(l),h=e.type+":flipY/"+t.flipY.toString();if(u[h]!==void 0)return u[h];o.images||(o.images=[]);const f={mimeType:e.type};r.binary===!0?s.push(new Promise(_=>{this.processBufferViewImage(e).then(A=>{f.bufferView=A,_()})})):s.push((0,V.blobToDataURL)(e).then(_=>{f.uri=_}));const g=o.images.push(f)-1;return u[h]=g,g}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);const r=e.source.data,s=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const o=super.processTexture(e),l=i.textures[o];if(!l)return console.error("No texture def",o,e),o;const u=i.images?i.images[l.source]:null;if(u&&(u.extras||(u.extras={}),e.source&&(u.extras.uuid=e.source.uuid),u.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=r,e.userData.mimeType=s,!l)return console.error("textureDef is null",o,e),o;if(l.source>=0){const h=this.json.images[l.source];h.uri?console.warn("GLTFWriter2: uri already set",h.uri):(h.uri=e.userData.rootPath,h.mimeType=s,h.extras||(h.extras={}),h.extras.flipY=e.flipY,h.extras.uri=e.userData.rootPath)}else l.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,s)}return l.source<0&&console.error("textureDef.source cannot be saved",l,e),o}processImage(e,t,i,r="image/png"){return e?super.processImage(e,t,i,r,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,i,r="image/png"){const s=this.cache,o=this.json;s.images.has(e)||s.images.set(e,{});const l=s.images.get(e),u=r+":flipY/"+i.toString();if(l[u]!==void 0)return l[u];o.images||(o.images=[]);const h={mimeType:r,uri:t,extras:{flipY:i}},f=o.images.push(h)-1;return l[u]=f,f}}function jP(a,e){(e=e??document.createElement("script")).type=a.type||"text/javascript",e.text=a.text;for(let t=0;t<a.attributes.length;t++){const i=a.attributes[t];e.setAttribute(i.name,i.value)}return e}function EM(a,e=0){const t=(i=a.byteLength,4*Math.ceil(i/4));var i;if(t!==a.byteLength){const r=new Uint8Array(t);if(r.set(new Uint8Array(a)),e!==0)for(let s=a.byteLength;s<t;s++)r[s]=e;return r.buffer}return a}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,e){const t=new Uint8Array(this);e==null&&(e=t.length);const i=new ArrayBuffer(e-a),r=new Uint8Array(i);for(let s=0;s<r.length;s++)r[s]=t[s+a];return i});class hS extends qw{register(e){return super.register(e)}async parseAsync(e,t){var i;if(!e)throw new Error("No object to export");const r=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((s,o)=>this.parse(e,s,o,t));if(r&&typeof r=="object"&&!r.byteLength)return new Blob([JSON.stringify(r,(s,o)=>s.startsWith("__")?void 0:o,(i=t.jsonSpaces)!==null&&i!==void 0?i:2)],{type:"model/gltf+json"});if(r){let s=null;return t.encrypt&&(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey?s=function(o,l){const u=EM(o),h=new DataView(new ArrayBuffer(8));h.setUint32(0,u.byteLength,!0),h.setUint32(4,5130562,!0);const f=EM(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),g=new DataView(new ArrayBuffer(8));g.setUint32(0,f.byteLength,!0),g.setUint32(4,1313821514,!0);const _=new ArrayBuffer(12),A=new DataView(_);A.setUint32(0,1179937895,!0),A.setUint32(4,2,!0);const x=12+g.byteLength+f.byteLength+h.byteLength+u.byteLength;A.setUint32(8,x,!0);const E=new Blob([_,g,f,h,u],{type:"application/octet-stream"});return E.ext="glb",E}(await(0,V.aesGcmEncrypt)(new Uint8Array(r),t.encryptKey)):console.warn("WebGi GLTF Export: encryption key not provided, skipping encryption")),s||(s=new Blob([r],{type:"model/gltf+binary"})),s}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,i,r={}){var s;const o={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!r.embedUrlImages&&r.externalImagesInExtras||!1,embedUrlImages:(s=r.embedUrlImages)!==null&&s!==void 0&&s,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:r};return r.exportExt==="glb"&&(o.binary=!0),r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(l=>l.traverse(u=>{u.uuid&&(u.userData.gltfUUID=u.uuid)})),(Array.isArray(e)?e:[e]).forEach(l=>l.traverse(u=>{if(u.animations)for(const h of u.animations)h.__gltfExport===!1||o.animations.includes(h)||o.animations.push(...u.animations)})),super.parse(e,l=>{r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(u=>u.traverse(h=>{delete h.userData.gltfUUID})),t(Object.assign(l,{__isGLTFOutput:!0}))},i,o,new xM)}}function SM(a,e){const t=a.getPlugin(Ut).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([r,s])=>{e.json.textures.find(o=>{var l,u,h,f,g;return((l=o.extras)===null||l===void 0?void 0:l.uuid)===r||((h=(u=e.json.samplers[o.sampler])===null||u===void 0?void 0:u.extras)===null||h===void 0?void 0:h.uuid)===r||((g=(f=e.json.images[o.source])===null||f===void 0?void 0:f.extras)===null||g===void 0?void 0:g.t_uuid)===r})&&(s.image&&t.resources.images&&t.resources.images[s.image]&&delete t.resources.images[s.image],t.resources.textures[r]={})}),e.json.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([r,s])=>{e.json.materials.find(o=>{var l;return((l=o.extras)===null||l===void 0?void 0:l.uuid)===r})&&(t.resources.materials[r]={})});const i=[];Object.values(t.resources).forEach(r=>{r&&Object.values(r).forEach(s=>{s.url&&(s.url.type==="Uint16Array"&&s.url.data?(s.url.data instanceof Uint16Array||(s.url.data=new Uint16Array(s.url.data)),i.push(s.url)):s.url.type==="Uint8Array"&&s.url.data&&(s.url.data instanceof Uint8Array||(s.url.data=new Uint8Array(s.url.data)),i.push(s.url)))})});for(const r of i){let s="application/octet-stream";if(r.mimeType&&(s=r.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&r.type==="Uint16Array"&&r.width>0&&r.height>0){const h=zP(r.data,4),f=new ImageData(h,r.width,r.height),g=p.PpQ.getDataURL(f,!0).split(",")[1],_=2;s="image/png",_===1||(r.data=Uint8Array.from(atob(g),A=>A.charCodeAt(0))),r.encoding="rgbe",r.encodingVersion=_}e.json.images||(e.json.images=[]);const o={mimeType:s},l=e.json.images.push(o)-1,u=r.data;o.bufferView=e.processBufferViewImageBuffer(u),r.data={image:l}}return t}function zP(a,e=3,t){let i,r,s,o,l;const u=a.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*u);for(let h=0;h<u;h++){i=a[h*e],r=a[h*e+1],s=a[h*e+2],o=Math.max(Math.max(i,r),s);const f=Math.ceil(Math.log2(o));l=Math.pow(2,f-8),t[4*h]=i/l|0,t[4*h+1]=r/l|0,t[4*h+2]=s/l|0,t[4*h+3]=f+128}return t}function dS(a,e,t=hS,i){var r;if(!e)return;const s=a.Exporters.findIndex(l=>l.ext.includes("gltf")||l.ext.includes("glb")),o=[];s>=0?(o.push(...(r=a.Exporters[s].extensions)!==null&&r!==void 0?r:[]),a.Exporters.splice(s,1)):(o.push(HP),o.push(GP),o.push(VP),o.push(l=>new pn(l)),o.push(l=>new QP(l)),o.push(l=>new WP(l)),o.push(l=>new XP(l)),o.push(l=>new qP(l))),a.Exporters.push({ctor:()=>{const l=new t;return o.forEach(u=>l.register(u)),l.register(u=>({afterParse:h=>{var f,g;if(!(!((f=(h=Array.isArray(h)?h[0]:h)==null?void 0:h.userData)===null||f===void 0)&&f.rootSceneModelRoot)||((g=h==null?void 0:h.userData)===null||g===void 0?void 0:g.__exportViewerConfig)===!1)return;const _=u.json.scenes[u.json.scene||0];_.extensions||(_.extensions={}),_.extensions[fa]=SM(e,u),u.extensionsUsed[fa]=!0}})),i==null||i(l),l},ext:["gltf","glb"],extensions:o})}const VP=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const i={};e.shadow&&(i.shadow=e.shadow.toJSON()),Object.keys(i).length>0&&(t.extensions[Ho]=i,a.extensionsUsed[Ho]=!0)}}),GP=a=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const i={};e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.visible===!1&&(i.visible=!1),e.frustumCulled===!1&&(i.frustumCulled=!1),e.renderOrder!==0&&(i.renderOrder=e.renderOrder),e.layers.mask!==1&&(i.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),Object.keys(i).length>0&&(t.extensions[is]=i,a.extensionsUsed[is]=!0)}}),HP=a=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const i={};e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.side!==void 0&&e.side!==p.ehD&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.normalScale!==void 0&&(i.normalScale=[e.normalScale.x,e.normalScale.y]);const r=this.materialExternalResources[e.uuid];r&&Object.entries(r).forEach(([s,o])=>{var l;s.startsWith("_")||(o!=null&&o.userData&&(o.userData.__embedUrlImagePreviews=(l=a.options.exporterOptions)===null||l===void 0?void 0:l.embedUrlImagePreviews),i[s]=cr(o,!1,this.serializedMeta),o!=null&&o.userData&&delete o.userData.__embedUrlImagePreviews)}),Object.keys(i).length>0&&(t.extensions[Ji]=i,a.extensionsUsed[Ji]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!a.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(i=>{i==null||i.traverse(r=>{var s;r&&!((s=r.material)===null||s===void 0)&&s.isMaterial&&t.push(r.material)})}),t.forEach(i=>{i&&(this.materialExternalResources[i.uuid]||(this.materialExternalResources[i.uuid]={}),this.materialExternalResources[i.uuid].__materialRef=i,Object.entries(i).forEach(([r,s])=>{r.startsWith("_")||s&&s.isTexture&&s.userData.rootPath&&(s.userData.rootPath.startsWith("http")||s.userData.rootPath.startsWith("data:"))&&(i[r]=null,this.materialExternalResources[i.uuid][r]=s)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(r=>{const s=r.__materialRef;s&&(Object.entries(r).forEach(([o,l])=>{o.startsWith("_")||l&&(s[o]=l)}),delete this.materialExternalResources[s.uuid])});const i=a.json.scenes[a.json.scene||0];i.extensions||(i.extensions={}),i.extensions[Ji]={resources:this.serializedMeta},a.extensionsUsed[Ji]=!0}});class QP{constructor(e){this.writer=e,this.name=mh}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.bumpScale=e.bumpScale,e.bumpMap){const o={index:i.processTexture(e.bumpMap)};i.applyTextureTransform(o,e.bumpMap),s.bumpTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class WP{constructor(e){this.writer=e,this.name=Ld}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.displacementScale=e.displacementScale,s.displacementBias=e.displacementBias,e.displacementMap){const o={index:i.processTexture(e.displacementMap)};i.applyTextureTransform(o,e.displacementMap),s.displacementTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class XP{constructor(e){this.writer=e,this.name=tc}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const i=this.writer,r=i.extensionsUsed,s={};if(s.lightMapIntensity=e.lightMapIntensity,e.lightMap){const o={index:i.processTexture(e.lightMap)};i.applyTextureTransform(o,e.lightMap),s.lightMapTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}class qP{constructor(e){this.writer=e,this.name=Ml}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const i=this.writer,r=i.extensionsUsed,s={};if(e.alphaMap){const o={index:i.processTexture(e.alphaMap)};i.applyTextureTransform(o,e.alphaMap),s.alphaTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,r[this.name]=!0}}const YP=new TextEncoder;class KP{parse(e,t,i){if(!function(u,h){if(h.isWebGLRenderTarget&&(!u||!u.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!h||!h.isWebGLRenderTarget&&!h.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const f=h.isWebGLRenderTarget?h.texture:h;return f.type!==p.VzW&&f.type!==p.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):f.format===p.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const r=function(u,h={}){const f=u.isTexture?u:u.texture,g=u.isWebGLRenderTarget?u.width:u.image.width,_=u.isWebGLRenderTarget?u.height:u.image.height,A=f.type,x=f.format,E=f.colorSpace,T=h.compression!==void 0?h.compression:3,R=(h.type!==void 0?h.type:p.cLu)===p.VzW?2:1,I={0:1,2:1,3:16}[T];return{width:g,height:_,type:A,format:x,colorSpace:E,compression:T,blockLines:I,dataType:R,dataSize:2*R,numBlocks:Math.ceil(_/I),numInputChannels:4,numOutputChannels:4,flipY:u.isDataTexture&&u.flipY,textureIndex:h.textureIndex||0}}(t,i),s=function(u,h,f){if(h.isDataTexture)return h.image.data;let g;return g=f.type===p.VzW?new Float32Array(f.width*f.height*f.numInputChannels):new Uint16Array(f.width*f.height*f.numInputChannels),u.readRenderTargetPixels(h,0,0,f.width,f.height,g,void 0,f.textureIndex),g}(e,t,r),o=function(u,h){const f=h.width,g=h.height,_={r:0,g:0,b:0,a:0},A={value:0},x=h.numOutputChannels==4?1:0,E=h.type==p.VzW?rR:iR,T=h.dataType==1?eR:pS,R=new Uint8Array(h.width*h.height*h.numOutputChannels*h.dataSize),I=new DataView(R.buffer);for(let S=0;S<g;++S)for(let O=0;O<f;++O){const k=S*f*4+4*O,N=E(u,k),H=E(u,k+1),X=E(u,k+2),te=E(u,k+3),re=(h.flipY?S:g-S-1)*f*(3+x)*h.dataSize;$P(_,N,H,X,te),A.value=re+O*h.dataSize,T(I,_.a,A),A.value=re+x*f*h.dataSize+O*h.dataSize,T(I,_.b,A),A.value=re+(1+x)*f*h.dataSize+O*h.dataSize,T(I,_.g,A),A.value=re+(2+x)*f*h.dataSize+O*h.dataSize,T(I,_.r,A)}return R}(s,r),l=function(u,h){let f,g,_=0;const A={data:new Array,totalSize:0},x=h.width*h.numOutputChannels*h.blockLines*h.dataSize;switch(h.compression){case 0:f=ZP;break;case 2:case 3:f=JP}h.compression!==0&&(g=new Uint8Array(x));for(let E=0;E<h.numBlocks;++E){const T=f(u.subarray(x*E,x*(E+1)),g);_+=T.length,A.data.push({dataChunk:T,size:T.length})}return A.totalSize=_,A}(o,r);return function(u,h){const f=8*h.numBlocks,g=259+18*h.numOutputChannels,_={value:g+f},A=new Uint8Array(g+f+u.totalSize+8*h.numBlocks),x=new DataView(A.buffer);(function(E,T,R){const I={value:0},S=new DataView(E.buffer);Yr(S,20000630,I),Yr(S,2,I),oa(S,"compression",I),oa(S,"compression",I),Yr(S,1,I),pb(S,R.compression,I),oa(S,"screenWindowCenter",I),oa(S,"v2f",I),Yr(S,8,I),Yr(S,0,I),Yr(S,0,I),oa(S,"screenWindowWidth",I),oa(S,"float",I),Yr(S,4,I),pS(S,1,I),oa(S,"pixelAspectRatio",I),oa(S,"float",I),Yr(S,4,I),pS(S,1,I),oa(S,"lineOrder",I),oa(S,"lineOrder",I),Yr(S,1,I),pb(S,0,I),oa(S,"dataWindow",I),oa(S,"box2i",I),Yr(S,16,I),Yr(S,0,I),Yr(S,0,I),Yr(S,R.width-1,I),Yr(S,R.height-1,I),oa(S,"displayWindow",I),oa(S,"box2i",I),Yr(S,16,I),Yr(S,0,I),Yr(S,0,I),Yr(S,R.width-1,I),Yr(S,R.height-1,I),oa(S,"channels",I),oa(S,"chlist",I),Yr(S,18*R.numOutputChannels+1,I),oa(S,"A",I),Yr(S,R.dataType,I),I.value+=4,Yr(S,1,I),Yr(S,1,I),oa(S,"B",I),Yr(S,R.dataType,I),I.value+=4,Yr(S,1,I),Yr(S,1,I),oa(S,"G",I),Yr(S,R.dataType,I),I.value+=4,Yr(S,1,I),Yr(S,1,I),oa(S,"R",I),Yr(S,R.dataType,I),I.value+=4,Yr(S,1,I),Yr(S,1,I),pb(S,0,I),pb(S,0,I);let O=I.value+8*R.numBlocks;for(let k=0;k<T.data.length;++k)tR(S,O,I),O+=T.data[k].size+8})(A,u,h);for(let E=0;E<u.data.length;++E){const T=u.data[E].dataChunk,R=u.data[E].size;Yr(x,E*h.blockLines,_),Yr(x,R,_),A.set(T,_.value),_.value+=R}return A}(l,r)}}function ZP(a){return a}function JP(a,e){let t=0,i=Math.floor((a.length+1)/2),r=0;const s=a.length-1;for(;!(r>s||(e[t++]=a[r++],r>s));)e[i++]=a[r++];let o=e[0];for(let l=1;l<e.length;l++){const u=e[l]-o+384;o=e[l],e[l]=u}return function(l,u){u||(u={});var h=IE();h.p(l);var f=PE(l,u,2,4);return DE(f,u),RE(f,f.length-4,h.d()),f}(e)}function $P(a,e,t,i,r){a.r=e,a.g=t,a.b=i,a.a=r}function pb(a,e,t){a.setUint8(t.value,e),t.value+=1}function Yr(a,e,t){a.setUint32(t.value,e,!0),t.value+=4}function eR(a,e,t){a.setUint16(t.value,p.A5E.toHalfFloat(e),!0),t.value+=2}function pS(a,e,t){a.setFloat32(t.value,e,!0),t.value+=4}function tR(a,e,t){a.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function oa(a,e,t){const i=YP.encode(e+"\0");for(let r=0;r<i.length;++r)pb(a,i[r],t)}function iR(a,e){return function(t){const i=(31744&t)>>10,r=1023&t;return(t>>15?-1:1)*(i?i===31?r?NaN:1/0:Math.pow(2,i-15)*(1+r/1024):r/1024*6103515625e-14)}(a[e])}function rR(a,e){return a[e]}class Kw extends KP{async parseAsync(e,t){const i=this.parse(e.renderer.rendererObject,e,t);return new Blob([i],{type:"image/x-exr"})}}class CM extends V.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(t=>t.ext.some(i=>e.includes(i)))}constructor(e,t={}){super(),this._processors=new Ya,this.Exporters=[{ctor:()=>new mM,ext:["json"]},{ctor:()=>new gM,ext:["txt","text"]},{ctor:()=>new Kw,ext:["exr"]}],this._cachedParsers=[],dS(this,e)}async exportObject(e,t={}){var i,r;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((i=e==null?void 0:e.userData)===null||i===void 0)&&i.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const s=[];e.assetType==="model"&&e.modelObject.traverse(l=>{l.userData.excludeFromExport&&l.visible&&(l.visible=!1,s.push(l))});const o=await this._exportFile(e,t);return e.assetType==="model"&&s.forEach(l=>l.visible=!0),!((r=e==null?void 0:e.userData)===null||r===void 0)&&r.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,o}async _exportFile(e,t={}){var i,r,s;let o;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const l=await this.processBeforeExport(e,t),u=(r=(i=t.exportExt)!==null&&i!==void 0?i:l==null?void 0:l.typeExt)!==null&&r!==void 0?r:l==null?void 0:l.ext;if(!l||!u)throw new Error(`Unable to preprocess before export ${u}`);const h=this._getParser(u);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const f=await h.parseAsync(l.obj,{exportExt:(s=l.ext)!==null&&s!==void 0?s:u,...t});f.ext=l.ext,o=f}catch(l){return console.error("AssetExporter: Unable to Export file",e),console.error(l),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:l})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),o}_createParser(e){const t=this.Exporters.find(r=>r.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const i=t==null?void 0:t.ctor(this);if(!i)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:i}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:i}),i}_getParser(e){var t,i;return(i=(t=this._cachedParsers.find(r=>r.ext.includes(e)))===null||t===void 0?void 0:t.parser)!==null&&i!==void 0?i:this._createParser(e)}async processBeforeExport(e,t={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}var fb;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})(fb||(fb={}));class td extends Si{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:fb.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new CM(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,i)=>{var r;return i.convertMeshToIndexed&&((r=t.modelObject)===null||r===void 0||r.traverse(s=>{var o;s.geometry&&(s.geometry.attributes.index||(o=s.setGeometry)===null||o===void 0||o.call(s,rr(s.geometry)))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,i;return(t=this.exporter)===null||t===void 0?void 0:t.exportObject((i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var i,r;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("FileTransferPlugin");s?await s.exportFile(e,t):(r=this._viewer)===null||r===void 0||r.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",i=>{var r;typeof((r=i.plugin)===null||r===void 0?void 0:r.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([i,r])=>typeof(r==null?void 0:r.toJSON)=="function"&&(r==null?void 0:r.serializeWithViewer)!==!1).map(([i,r])=>({label:i,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var i,r;return(r=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||r===void 0?void 0:r.call(i,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(fb).map(([i,r])=>({label:i,value:r}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(i=>({label:i}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(i=>({type:"slider",label:i,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,i]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var i,r;return(r=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||r===void 0?void 0:r.call(i,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var i,r;return(r=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||r===void 0?void 0:r.call(i,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Convert to indexed",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(i=>{var r;i.value=!1,(r=i.uiRefresh)===null||r===void 0||r.call(i)})}},{type:"button",label:"Select all",value:()=>{t.forEach(i=>{var r;i.value=!0,(r=i.uiRefresh)===null||r===void 0||r.call(i)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const i=new Blob([JSON.stringify(e.getPlugin(Ut).exportPluginPresets(t.filter(r=>!!r.value).map(r=>(0,V.getOrCall)(r.label)||"")),null,2)],{type:"application/json"});i&&await this._downloadBlob(i,this.exportOptions.name+"."+Ut.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const i=new Blob([JSON.stringify(e.getPlugin(Ut).exportViewerConfig(!1),null,2)],{type:"application/json"});i&&await this._downloadBlob(i,this.exportOptions.name+"."+Ut.ViewerTypeSlug)}}]}]}}}td.PluginType="AssetExporterPlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([ae()],td.prototype,"exportOptions",void 0);class fS{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;return i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const i=t.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class q0 extends fS{constructor(e,t,i,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=i,this._attributes=r,!t.isOnGraph(i))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class nR extends fS{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let i=this.listParentEdges(e);return t&&(i=i.filter(r=>t(r.getParent()))),i.forEach(r=>r.dispose()),this}createEdge(e,t,i,r){return this._registerEdge(new q0(e,t,i,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const i=e.getChild();return this._childEdges.has(i)||this._childEdges.set(i,new Set),this._childEdges.get(i).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function mb(){return mb=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a},mb.apply(this,arguments)}function mS(a){return a instanceof q0}function gb(a){return Array.isArray(a)&&a[0]instanceof q0}function vb(a){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(a)&&function(e){for(const t in e)return e[t]}(a)instanceof q0)}const En=Symbol("attributes"),Y0=Symbol("immutableKeys");class gS extends fS{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[En]=void 0,this[Y0]=void 0,this.graph=e,this[Y0]=new Set,this[En]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const i in e){const r=e[i];if(r instanceof gS){const s=this.graph.createEdge(i,this,r);s.addEventListener("dispose",()=>r.dispose()),this[Y0].add(i),t[i]=s}else t[i]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const i in this[En]){const r=this[En][i];if(mS(r)){const s=r;s.getChild()===e&&this.setRef(i,t,s.getAttributes())}else if(gb(r)){const s=r.find(o=>o.getChild()===e);if(s){const o=s.getAttributes();this.removeRef(i,e).addRef(i,t,o)}}else if(vb(r)){const s=r;for(const o in s){const l=s[o];l.getChild()===e&&this.setRefMap(i,o,t,l.getAttributes())}}}return this}get(e){return this[En][e]}set(e,t){return this[En][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[En][e];return t?t.getChild():null}setRef(e,t,i){if(this[Y0].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[En][e];if(r&&r.dispose(),!t)return this;const s=this.graph.createEdge(e,this,t,i);return s.addEventListener("dispose",()=>{delete this[En][e],this.dispatchEvent({type:"change",attribute:e})}),this[En][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[En][e].map(t=>t.getChild())}addRef(e,t,i){const r=this.graph.createEdge(e,this,t,i),s=this[En][e];return s.push(r),r.addEventListener("dispose",()=>{const o=s.filter(l=>l!==r);s.length=0;for(const l of o)s.push(l);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[En][e].filter(i=>i.getChild()===t).forEach(i=>i.dispose()),this}listRefMapKeys(e){return Object.keys(this[En][e])}listRefMapValues(e){return Object.values(this[En][e]).map(t=>t.getChild())}getRefMap(e,t){const i=this[En][e];return i[t]?i[t].getChild():null}setRefMap(e,t,i,r){const s=this[En][e],o=s[t];if(o&&o.dispose(),!i)return this;r=Object.assign(r||{},{key:t});const l=this.graph.createEdge(e,this,i,mb({},r,{key:t}));return l.addEventListener("dispose",()=>{delete s[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),s[t]=l,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(mb({},e,{target:this})),this.graph.dispatchEvent(mb({},e,{target:this,type:`node:${e.type}`})),this}}const MM="@glb.bin";var fi,Zw,Ic,Bn,kg;(function(a){a.ACCESSOR="Accessor",a.ANIMATION="Animation",a.ANIMATION_CHANNEL="AnimationChannel",a.ANIMATION_SAMPLER="AnimationSampler",a.BUFFER="Buffer",a.CAMERA="Camera",a.MATERIAL="Material",a.MESH="Mesh",a.PRIMITIVE="Primitive",a.PRIMITIVE_TARGET="PrimitiveTarget",a.NODE="Node",a.ROOT="Root",a.SCENE="Scene",a.SKIN="Skin",a.TEXTURE="Texture",a.TEXTURE_INFO="TextureInfo"})(fi||(fi={})),function(a){a.INTERLEAVED="interleaved",a.SEPARATE="separate"}(Zw||(Zw={})),function(a){a.ARRAY_BUFFER="ARRAY_BUFFER",a.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",a.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",a.OTHER="OTHER",a.SPARSE="SPARSE"}(Ic||(Ic={})),function(a){a[a.R=4096]="R",a[a.G=256]="G",a[a.B=16]="B",a[a.A=1]="A"}(Bn||(Bn={})),function(a){a.GLTF="GLTF",a.GLB="GLB"}(kg||(kg={}));const Jw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var $w,vS,_S=typeof Float32Array<"u"?Float32Array:Array;function yS(a){return Math.hypot(a[0],a[1],a[2])}function sR(a,e,t){var i=e[0],r=e[1],s=e[2],o=t[3]*i+t[7]*r+t[11]*s+t[15];return a[0]=(t[0]*i+t[4]*r+t[8]*s+t[12])/(o=o||1),a[1]=(t[1]*i+t[5]*r+t[9]*s+t[13])/o,a[2]=(t[2]*i+t[6]*r+t[10]*s+t[14])/o,a}function aR(a,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const i of a.listPrimitives()){const r=i.getAttribute("POSITION");if(!r)continue;let s=[0,0,0],o=[0,0,0];for(let l=0;l<r.getCount();l++)s=r.getElement(l,s),o=sR(o,s,e),bS(o,t)}return t}function bS(a,e){for(let t=0;t<3;t++)e.min[t]=Math.min(a[t],e.min[t]),e.max[t]=Math.max(a[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)}),$w=new _S(3),_S!=Float32Array&&($w[0]=0,$w[1]=0,$w[2]=0);class Sr{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}{const t=e.split(",")[1],i=e.indexOf("base64")>=0;return Buffer.from(t,i?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const s of e)t+=s.byteLength;const i=new Uint8Array(t);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i}static pad(e,t=0){const i=this.padNumber(e.byteLength);if(i===e.byteLength)return e;const r=new Uint8Array(i);if(r.set(e),t!==0)for(let s=e.byteLength;s<i;s++)r[s]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let i=e.byteLength;for(;i--;)if(e[i]!==t[i])return!1;return!0}static toView(e,t=0,i=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,i))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Nl{static hexToFactor(e,t){e=Math.floor(e);const i=t;return i[0]=(e>>16&255)/255,i[1]=(e>>8&255)/255,i[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[i,r,s]=this.convertLinearToSRGB(e,t);return 255*i<<16^255*r<<8^255*s<<0}static convertSRGBToLinear(e,t){const i=e,r=t;for(let s=0;s<3;s++)r[s]=i[s]<.04045?.0773993808*i[s]:Math.pow(.9478672986*i[s]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const i=e,r=t;for(let s=0;s<3;s++)r[s]=i[s]<.0031308?12.92*i[s]:1.055*Math.pow(i[s],.41666)-.055;return t}}class ex{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Sr.decodeText(e.slice(12,16))===ex.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}ex.PNG_FRIED_CHUNK_NAME="CgBI";class id{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let i=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)i+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return i+=4,i}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function oR(a,e){if(e>a.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(a.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return a}id.impls={"image/jpeg":new class{match(a){return a.length>=3&&a[0]===255&&a[1]===216&&a[2]===255}getSize(a){let e,t,i=new DataView(a.buffer,a.byteOffset+4);for(;i.byteLength;){if(e=i.getUint16(0,!1),oR(i,e),t=i.getUint8(e+1),t===192||t===193||t===194)return[i.getUint16(e+7,!1),i.getUint16(e+5,!1)];i=new DataView(a.buffer,i.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(a){return 3}},"image/png":new ex};class K0{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return id.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function TM(a){return Object.prototype.toString.call(a)==="[object Object]"}function Ug(a){if(TM(a)===!1)return!1;const e=a.constructor;if(e===void 0)return!0;const t=e.prototype;return TM(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}(function(a){a[a.SILENT=4]="SILENT",a[a.ERROR=3]="ERROR",a[a.WARN=2]="WARN",a[a.INFO=1]="INFO",a[a.DEBUG=0]="DEBUG"})(vS||(vS={}));class Pc{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Pc.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Pc.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Pc.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Pc.Verbosity.ERROR&&console.error(e)}}function lR(a,e,t){var i=e[0],r=e[1],s=e[2],o=e[3],l=e[4],u=e[5],h=e[6],f=e[7],g=e[8],_=e[9],A=e[10],x=e[11],E=e[12],T=e[13],R=e[14],I=e[15],S=t[0],O=t[1],k=t[2],N=t[3];return a[0]=S*i+O*l+k*g+N*E,a[1]=S*r+O*u+k*_+N*T,a[2]=S*s+O*h+k*A+N*R,a[3]=S*o+O*f+k*x+N*I,a[4]=(S=t[4])*i+(O=t[5])*l+(k=t[6])*g+(N=t[7])*E,a[5]=S*r+O*u+k*_+N*T,a[6]=S*s+O*h+k*A+N*R,a[7]=S*o+O*f+k*x+N*I,a[8]=(S=t[8])*i+(O=t[9])*l+(k=t[10])*g+(N=t[11])*E,a[9]=S*r+O*u+k*_+N*T,a[10]=S*s+O*h+k*A+N*R,a[11]=S*o+O*f+k*x+N*I,a[12]=(S=t[12])*i+(O=t[13])*l+(k=t[14])*g+(N=t[15])*E,a[13]=S*r+O*u+k*_+N*T,a[14]=S*s+O*h+k*A+N*R,a[15]=S*o+O*f+k*x+N*I,a}Pc.Verbosity=vS,Pc.DEFAULT_INSTANCE=new Pc(Pc.Verbosity.INFO);class Vn{static identity(e){return e}static eq(e,t,i=1e-5){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>i)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Vn.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Vn.encodeNormalizedInt(e,t)}static decompose(e,t,i,r){let s=yS([e[0],e[1],e[2]]);const o=yS([e[4],e[5],e[6]]),l=yS([e[8],e[9],e[10]]);var u,h,f,g,_,A,x,E,T,R,I,S,O,k,N,H,X;((h=(u=e)[0])*(x=u[5])-(f=u[1])*(A=u[4]))*((S=u[10])*(X=u[15])-(O=u[11])*(H=u[14]))-(h*(E=u[6])-(g=u[2])*A)*((I=u[9])*X-O*(N=u[13]))+(h*(T=u[7])-(_=u[3])*A)*(I*H-S*N)+(f*E-g*x)*((R=u[8])*X-O*(k=u[12]))-(f*T-_*x)*(R*H-S*k)+(g*T-_*E)*(R*N-I*k)<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const te=e.slice(),re=1/s,ue=1/o,le=1/l;te[0]*=re,te[1]*=re,te[2]*=re,te[4]*=ue,te[5]*=ue,te[6]*=ue,te[8]*=le,te[9]*=le,te[10]*=le,function(se,de){var ve=new _S(3);(function(Ui,wt){var yt=wt[4],li=wt[5],ar=wt[6],ge=wt[8],je=wt[9],nt=wt[10];Ui[0]=Math.hypot(wt[0],wt[1],wt[2]),Ui[1]=Math.hypot(yt,li,ar),Ui[2]=Math.hypot(ge,je,nt)})(ve,de);var fe=1/ve[0],Ee=1/ve[1],Je=1/ve[2],Te=de[0]*fe,qe=de[1]*Ee,Ve=de[2]*Je,Ye=de[4]*fe,Tt=de[5]*Ee,Xe=de[6]*Je,Zt=de[8]*fe,di=de[9]*Ee,Ai=de[10]*Je,Wi=Te+Tt+Ai,Gi=0;Wi>0?(Gi=2*Math.sqrt(Wi+1),se[3]=.25*Gi,se[0]=(Xe-di)/Gi,se[1]=(Zt-Ve)/Gi,se[2]=(qe-Ye)/Gi):Te>Tt&&Te>Ai?(Gi=2*Math.sqrt(1+Te-Tt-Ai),se[3]=(Xe-di)/Gi,se[0]=.25*Gi,se[1]=(qe+Ye)/Gi,se[2]=(Zt+Ve)/Gi):Tt>Ai?(Gi=2*Math.sqrt(1+Tt-Te-Ai),se[3]=(Zt-Ve)/Gi,se[0]=(qe+Ye)/Gi,se[1]=.25*Gi,se[2]=(Xe+di)/Gi):(Gi=2*Math.sqrt(1+Ai-Te-Tt),se[3]=(qe-Ye)/Gi,se[0]=(Zt+Ve)/Gi,se[1]=(Xe+di)/Gi,se[2]=.25*Gi)}(i,te),r[0]=s,r[1]=o,r[2]=l}static compose(e,t,i,r){const s=r,o=t[0],l=t[1],u=t[2],h=t[3],f=o+o,g=l+l,_=u+u,A=o*f,x=o*g,E=o*_,T=l*g,R=l*_,I=u*_,S=h*f,O=h*g,k=h*_,N=i[0],H=i[1],X=i[2];return s[0]=(1-(T+I))*N,s[1]=(x+k)*N,s[2]=(E-O)*N,s[3]=0,s[4]=(x-k)*H,s[5]=(1-(A+I))*H,s[6]=(R+S)*H,s[7]=0,s[8]=(E+O)*X,s[9]=(R-S)*X,s[10]=(1-(A+T))*X,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function cR(a,e){if(!!a!=!!e)return!1;const t=a.getChild(),i=e.getChild();return t===i||t.equals(i)}function uR(a,e){if(!!a!=!!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++){const i=a[t],r=e[t];if(i.getChild()!==r.getChild()&&!i.getChild().equals(r.getChild()))return!1}return!0}function hR(a,e){if(!!a!=!!e)return!1;const t=Object.keys(a),i=Object.keys(e);if(t.length!==i.length)return!1;for(const r in a){const s=a[r],o=e[r];if(!!s!=!!o)return!1;const l=s.getChild(),u=o.getChild();if(l!==u&&!l.equals(u))return!1}return!0}function IM(a,e){if(a===e)return!0;if(!!a!=!!e||!a||!e||a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function PM(a,e){if(a===e)return!0;if(!!a!=!!e)return!1;if(!Ug(a)||!Ug(e))return a===e;const t=a,i=e;let r,s=0,o=0;for(r in t)s++;for(r in i)o++;if(s!==o)return!1;for(r in t){const l=t[r],u=i[r];if(tx(l)&&tx(u)){if(!IM(l,u))return!1}else if(Ug(l)&&Ug(u)){if(!PM(l,u))return!1}else if(l!==u)return!1}return!0}function tx(a){return Array.isArray(a)||ArrayBuffer.isView(a)}const RM="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",DM=new Set,dR=function(){let a="";for(let e=0;e<6;e++)a+=RM.charAt(Math.floor(Math.random()*RM.length));return a};class _b{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return K0.basename(new URL(e,"https://null.example").pathname)}static extension(e){return K0.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const i=e.split("/"),r=t.split("/");i.pop();for(let s=0;s<r.length;s++)r[s]!=="."&&(r[s]===".."?i.pop():i.push(r[s]));return i.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}_b.DEFAULT_INIT={},_b.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Ip=a=>a,pR=new Set;class AS extends gS{constructor(e,t=""){super(e),this[En].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Ip)}copy(e,t=Ip){for(const i in this[En]){const r=this[En][i];if(r instanceof q0)this[Y0].has(i)||r.dispose();else if(gb(r))for(const s of r)s.dispose();else if(vb(r))for(const s in r)r[s].dispose()}for(const i in e[En]){const r=this[En][i],s=e[En][i];if(s instanceof q0)this[Y0].has(i)?r.getChild().copy(t(s.getChild()),t):this.setRef(i,t(s.getChild()),s.getAttributes());else if(gb(s))for(const o of s)this.addRef(i,t(o.getChild()),o.getAttributes());else if(vb(s))for(const o in s){const l=s[o];this.setRefMap(i,o,t(l.getChild()),l.getAttributes())}else this[En][i]=Ug(s)?JSON.parse(JSON.stringify(s)):Array.isArray(s)||s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.slice():s}return this}equals(e,t=pR){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const i in this[En]){if(t.has(i))continue;const r=this[En][i],s=e[En][i];if(mS(r)||mS(s)){if(!cR(r,s))return!1}else if(gb(r)||gb(s)){if(!uR(r,s))return!1}else if(vb(r)||vb(s)){if(!hR(r,s))return!1}else if(Ug(r)||Ug(s)){if(!PM(r,s))return!1}else if(tx(r)||tx(s)){if(!IM(r,s))return!1}else if(r!==s)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ul extends AS{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Li extends ul{constructor(...e){super(...e),this.i=Vn.identity,this.o=Vn.identity}init(){this.propertyType=fi.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Li.Type.SCALAR,componentType:Li.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=Ip){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Li.Type.SCALAR:return 1;case Li.Type.VEC2:return 2;case Li.Type.VEC3:return 3;case Li.Type.VEC4:case Li.Type.MAT2:return 4;case Li.Type.MAT3:return 9;case Li.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Li.ComponentType.BYTE:case Li.ComponentType.UNSIGNED_BYTE:return 1;case Li.ComponentType.SHORT:case Li.ComponentType.UNSIGNED_SHORT:return 2;case Li.ComponentType.UNSIGNED_INT:case Li.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let i=0;i<t;i++)e[i]=this.o(e[i]);return e}getMin(e){const t=this.get("array"),i=this.getCount(),r=this.getElementSize();for(let s=0;s<r;s++)e[s]=1/0;for(let s=0;s<i*r;s+=r)for(let o=0;o<r;o++){const l=t[s+o];Number.isFinite(l)&&(e[o]=Math.min(e[o],l))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let i=0;i<t;i++)e[i]=this.o(e[i]);return e}getMax(e){const t=this.get("array"),i=this.getCount(),r=this.getElementSize();for(let s=0;s<r;s++)e[s]=-1/0;for(let s=0;s<i*r;s+=r)for(let o=0;o<r;o++){const l=t[s+o];Number.isFinite(l)&&(e[o]=Math.max(e[o],l))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Li.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Vn.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>Vn.encodeNormalizedInt(t,this.get("componentType"))):(this.o=Vn.identity,this.i=Vn.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const i=this.getElementSize(),r=this.get("array");for(let s=0;s<i;s++)t[s]=this.o(r[e*i+s]);return t}setElement(e,t){const i=this.getElementSize(),r=this.get("array");for(let s=0;s<i;s++)r[e*i+s]=this.i(t[s]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return Li.ComponentType.FLOAT;case Uint32Array:return Li.ComponentType.UNSIGNED_INT;case Uint16Array:return Li.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Li.ComponentType.UNSIGNED_BYTE;case Int16Array:return Li.ComponentType.SHORT;case Int8Array:return Li.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Li.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Li.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Li.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class BM extends ul{init(){this.propertyType=fi.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class wS extends ul{init(){this.propertyType=fi.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}wS.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Z0 extends ul{init(){this.propertyType=fi.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Z0.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ic.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ic.OTHER})}}Z0.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class OM extends ul{init(){this.propertyType=fi.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Ng extends ul{init(){this.propertyType=fi.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ng.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Ng.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Os extends AS{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Os.EXTENSION_NAME=void 0;class Gn extends ul{init(){this.propertyType=fi.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Gn.WrapMode.REPEAT,wrapT:Gn.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Gn.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Gn.MagFilter={NEAREST:9728,LINEAR:9729},Gn.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ix,G:rx,B:nx,A:fR}=Bn;class Fg extends ul{init(){this.propertyType=fi.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Fg.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Gn(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Gn(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Gn(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Gn(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Gn(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Nl.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Nl.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ix|rx|nx|fR})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Nl.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Nl.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ix|rx|nx})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ix|rx|nx})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ix})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:rx|nx})}}Fg.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class LM extends ul{init(){this.propertyType=fi.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class kM extends ul{constructor(...e){super(...e),this.u=null}init(){this.propertyType=fi.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Ip){if(t===Ip)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Vn.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),i=this.get("rotation").slice(),r=this.get("scale").slice();return Vn.decompose(e,t,i,r),this.set("translation",t).set("rotation",i).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return Vn.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Vn.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Vn.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.u)e.push(r);let t;const i=e.pop().getMatrix();for(;t=e.pop();)lR(i,i,t.getMatrix());return i}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[En].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===fi.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class jg extends ul{init(){this.propertyType=fi.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:jg.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ic.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ic.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}jg.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class mR extends AS{init(){this.propertyType=fi.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ic.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Fl(){return(Fl=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a}).apply(this,arguments)}class UM extends ul{init(){this.propertyType=fi.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Ip){if(t===Ip)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class NM extends ul{init(){this.propertyType=fi.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ic.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class FM extends ul{init(){this.propertyType=fi.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||id.extensionToMimeType(K0.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=id.extensionToMimeType(K0.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Sr.assertView(e))}getSize(){const e=this.get("image");return e?id.getSize(e,this.getMimeType()):null}}class jM extends ul{init(){this.propertyType=fi.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Ip){if(t===Ip)throw new Error("Root cannot be copied.");this.set("asset",Fl({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Fl({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const i of e.listRefMapKeys("extensions")){const r=e.getExtension(i);this.setExtension(i,t(r))}return this}l(e){return e instanceof UM?this.addRef("scenes",e):e instanceof kM?this.addRef("nodes",e):e instanceof Ng?this.addRef("cameras",e):e instanceof NM?this.addRef("skins",e):e instanceof LM?this.addRef("meshes",e):e instanceof Fg?this.addRef("materials",e):e instanceof FM?this.addRef("textures",e):e instanceof BM?this.addRef("animations",e):e instanceof Li?this.addRef("accessors",e):e instanceof OM&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class J0{static fromGraph(e){return J0.m.get(e)||null}constructor(){this.v=new nR,this.T=new jM(this.v),this.M=Pc.DEFAULT_INSTANCE,J0.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new J0().setLogger(this.M).merge(this)}merge(e){for(const s of e.getRoot().listExtensionsUsed()){const o=this.createExtension(s.constructor);s.isRequired()&&o.setRequired(!0)}const t=new Set,i=new Map;t.add(e.T),i.set(e.T,this.T);for(const s of e.v.listEdges())for(const o of[s.getParent(),s.getChild()]){if(t.has(o))continue;let l;l=o.propertyType===fi.TEXTURE_INFO?o:new o.constructor(this.v),i.set(o,l),t.add(o)}const r=s=>{const o=i.get(s);if(!o)throw new Error("Could resolve property.");return o};for(const s of t){const o=i.get(s);if(!o)throw new Error("Could resolve property.");o.propertyType!==fi.TEXTURE_INFO&&o.copy(s,r)}return this}async transform(...e){const t=e.map(i=>i.name);for(const i of e)await i(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(i=>i.extensionName===t)||new e(this)}createScene(e=""){return new UM(this.v,e)}createNode(e=""){return new kM(this.v,e)}createCamera(e=""){return new Ng(this.v,e)}createSkin(e=""){return new NM(this.v,e)}createMesh(e=""){return new LM(this.v,e)}createPrimitive(){return new jg(this.v)}createPrimitiveTarget(e=""){return new mR(this.v,e)}createMaterial(e=""){return new Fg(this.v,e)}createTexture(e=""){return new FM(this.v,e)}createAnimation(e=""){return new BM(this.v,e)}createAnimationChannel(e=""){return new wS(this.v,e)}createAnimationSampler(e=""){return new Z0(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Li(this.v,e).setBuffer(t)}createBuffer(e=""){return new OM(this.v,e)}}J0.m=new WeakMap;class Zn{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=i=>{const r=i,s=r.target;s instanceof Os&&s.extensionName===this.extensionName&&(r.type==="node:create"&&this.I(s),r.type==="node:dispose"&&this.N(s))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Zn.EXTENSION_NAME=void 0;class gR{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const i=this.jsonDoc.json.textures[t.index];if(i.sampler===void 0)return;const r=this.jsonDoc.json.samplers[i.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const zM={logger:Pc.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function sx(a,e){const t=e.bufferViews[a.bufferView],i=e.jsonDoc.json.bufferViews[a.bufferView],r=Jw[a.componentType],s=Li.getElementSize(a.type),o=r.BYTES_PER_ELEMENT;if(i.byteStride!==void 0&&i.byteStride!==s*o)return function(u,h){const f=h.bufferViews[u.bufferView],g=h.jsonDoc.json.bufferViews[u.bufferView],_=Jw[u.componentType],A=Li.getElementSize(u.type),x=_.BYTES_PER_ELEMENT,E=u.byteOffset||0,T=new _(u.count*A),R=new DataView(f.buffer,f.byteOffset,f.byteLength),I=g.byteStride;for(let S=0;S<u.count;S++)for(let O=0;O<A;O++){const k=E+S*I+O*x;let N;switch(u.componentType){case Li.ComponentType.FLOAT:N=R.getFloat32(k,!0);break;case Li.ComponentType.UNSIGNED_INT:N=R.getUint32(k,!0);break;case Li.ComponentType.UNSIGNED_SHORT:N=R.getUint16(k,!0);break;case Li.ComponentType.UNSIGNED_BYTE:N=R.getUint8(k);break;case Li.ComponentType.SHORT:N=R.getInt16(k,!0);break;case Li.ComponentType.BYTE:N=R.getInt8(k);break;default:throw new Error(`Unexpected componentType "${u.componentType}".`)}T[S*A+O]=N}return T}(a,e);const l=t.byteOffset+(a.byteOffset||0);return new r(t.buffer.slice(l,l+a.count*s*o))}var yb;(function(a){a[a.ARRAY_BUFFER=34962]="ARRAY_BUFFER",a[a.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(yb||(yb={}));class rd{constructor(e,t,i){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=i;const r=e.getRoot(),s=r.listBuffers().length,o=r.listTextures().length;this.bufferURIGenerator=new VM(s>1,()=>i.basename||"buffer"),this.imageURIGenerator=new VM(o>1,l=>function(u,h){const f=u.getGraph().listParentEdges(h).find(g=>g.getParent()!==u.getRoot());return f?f.getName().replace(/texture$/i,""):""}(e,l)||i.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const i={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(i);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(i));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},o=JSON.stringify(s);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const l={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(l.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(l.extras=t.getExtras()),this.textureInfoDefMap.set(t,l),l}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(i=>i.getName()==="attributes"&&i.getAttributes().key==="POSITION"||i.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,i){if(this.options.format===kg.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=id.mimeTypeToExtension(i.getMimeType());e.uri=this.imageURIGenerator.createURI(i,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Ic.SPARSE;for(const i of this.O.getGraph().listParentEdges(e)){const{usage:r}=i.getAttributes();if(r)return r;i.getParent().propertyType!==fi.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${i.getName()}".`)}return Ic.OTHER}addAccessorToUsageGroup(e,t){const i=this.C.get(e);if(i&&i!==t)throw new Error(`Accessor with usage "${i}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,i]of Array.from(this.C.entries()))e[i]=e[i]||[],e[i].push(t);return e}}rd.BufferViewTarget=yb,rd.BufferViewUsage=Ic,rd.USAGE_TO_TARGET={[Ic.ARRAY_BUFFER]:yb.ARRAY_BUFFER,[Ic.ELEMENT_ARRAY_BUFFER]:yb.ELEMENT_ARRAY_BUFFER};class VM{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const i=this.basename(e);return this.counter[i]=this.counter[i]||1,`${i}_${this.counter[i]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:ax}=rd,{UNSIGNED_INT:vR,UNSIGNED_SHORT:_R,UNSIGNED_BYTE:yR}=Li.ComponentType;var ox;(function(a){a[a.JSON=1313821514]="JSON",a[a.BIN=5130562]="BIN"})(ox||(ox={}));class bR{constructor(){this.M=Pc.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=Zw.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const i=GM(t)?this.P(t):{json:JSON.parse(Sr.decodeText(t)),resources:{}};return await this.L(i,this.dirname(e)),this.j(i),i}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(t,i=zM){const r=Fl({},zM,i),{json:s}=t,o=new J0().setLogger(r.logger);this.validate(t,r);const l=new gR(t),u=s.asset,h=o.getRoot().getAsset();u.copyright&&(h.copyright=u.copyright),u.extras&&(h.extras=u.extras),s.extras!==void 0&&o.getRoot().setExtras(Fl({},s.extras));const f=s.extensionsUsed||[],g=s.extensionsRequired||[];for(const S of r.extensions)if(f.includes(S.EXTENSION_NAME)){const O=o.createExtension(S).setRequired(g.includes(S.EXTENSION_NAME));for(const k of O.readDependencies)O.install(k,r.dependencies[k])}const _=s.buffers||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(fi.BUFFER)).forEach(S=>S.preread(l,fi.BUFFER)),l.buffers=_.map(S=>{const O=o.createBuffer(S.name);return S.extras&&O.setExtras(S.extras),S.uri&&S.uri.indexOf("__")!==0&&O.setURI(S.uri),O}),l.bufferViewBuffers=(s.bufferViews||[]).map((S,O)=>{if(!l.bufferViews[O]){const k=t.json.buffers[S.buffer];l.bufferViews[O]=Sr.toView(k.uri?t.resources[k.uri]:t.resources["@glb.bin"],S.byteOffset||0,S.byteLength)}return l.buffers[S.buffer]});const A=s.accessors||[];l.accessors=A.map(S=>{const O=o.createAccessor(S.name,l.bufferViewBuffers[S.bufferView]).setType(S.type);return S.extras&&O.setExtras(S.extras),S.normalized!==void 0&&O.setNormalized(S.normalized),S.bufferView===void 0||O.setArray(sx(S,l)),O});const x=s.images||[],E=s.textures||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(fi.TEXTURE)).forEach(S=>S.preread(l,fi.TEXTURE)),l.textures=x.map(S=>{const O=o.createTexture(S.name);if(S.extras&&O.setExtras(S.extras),S.bufferView!==void 0){const k=s.bufferViews[S.bufferView],N=t.json.buffers[k.buffer],H=k.byteOffset||0,X=(N.uri?t.resources[N.uri]:t.resources["@glb.bin"]).slice(H,H+k.byteLength);O.setImage(X)}else S.uri!==void 0&&(O.setImage(t.resources[S.uri]),S.uri.indexOf("__")!==0&&O.setURI(S.uri));if(S.mimeType!==void 0)O.setMimeType(S.mimeType);else if(S.uri){const k=K0.extension(S.uri);O.setMimeType(id.extensionToMimeType(k))}return O}),l.materials=(s.materials||[]).map(S=>{const O=o.createMaterial(S.name);S.extras&&O.setExtras(S.extras),S.alphaMode!==void 0&&O.setAlphaMode(S.alphaMode),S.alphaCutoff!==void 0&&O.setAlphaCutoff(S.alphaCutoff),S.doubleSided!==void 0&&O.setDoubleSided(S.doubleSided);const k=S.pbrMetallicRoughness||{};if(k.baseColorFactor!==void 0&&O.setBaseColorFactor(k.baseColorFactor),S.emissiveFactor!==void 0&&O.setEmissiveFactor(S.emissiveFactor),k.metallicFactor!==void 0&&O.setMetallicFactor(k.metallicFactor),k.roughnessFactor!==void 0&&O.setRoughnessFactor(k.roughnessFactor),k.baseColorTexture!==void 0){const N=k.baseColorTexture;O.setBaseColorTexture(l.textures[E[N.index].source]),l.setTextureInfo(O.getBaseColorTextureInfo(),N)}if(S.emissiveTexture!==void 0){const N=S.emissiveTexture;O.setEmissiveTexture(l.textures[E[N.index].source]),l.setTextureInfo(O.getEmissiveTextureInfo(),N)}if(S.normalTexture!==void 0){const N=S.normalTexture;O.setNormalTexture(l.textures[E[N.index].source]),l.setTextureInfo(O.getNormalTextureInfo(),N),S.normalTexture.scale!==void 0&&O.setNormalScale(S.normalTexture.scale)}if(S.occlusionTexture!==void 0){const N=S.occlusionTexture;O.setOcclusionTexture(l.textures[E[N.index].source]),l.setTextureInfo(O.getOcclusionTextureInfo(),N),S.occlusionTexture.strength!==void 0&&O.setOcclusionStrength(S.occlusionTexture.strength)}if(k.metallicRoughnessTexture!==void 0){const N=k.metallicRoughnessTexture;O.setMetallicRoughnessTexture(l.textures[E[N.index].source]),l.setTextureInfo(O.getMetallicRoughnessTextureInfo(),N)}return O});const T=s.meshes||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(fi.PRIMITIVE)).forEach(S=>S.preread(l,fi.PRIMITIVE)),l.meshes=T.map(S=>{const O=o.createMesh(S.name);return S.extras&&O.setExtras(S.extras),S.weights!==void 0&&O.setWeights(S.weights),(S.primitives||[]).forEach(k=>{const N=o.createPrimitive();k.extras&&N.setExtras(k.extras),k.material!==void 0&&N.setMaterial(l.materials[k.material]),k.mode!==void 0&&N.setMode(k.mode);for(const[X,te]of Object.entries(k.attributes||{}))N.setAttribute(X,l.accessors[te]);k.indices!==void 0&&N.setIndices(l.accessors[k.indices]);const H=S.extras&&S.extras.targetNames||[];(k.targets||[]).forEach((X,te)=>{const re=H[te]||te.toString(),ue=o.createPrimitiveTarget(re);for(const[le,se]of Object.entries(X))ue.setAttribute(le,l.accessors[se]);N.addTarget(ue)}),O.addPrimitive(N)}),O}),l.cameras=(s.cameras||[]).map(S=>{const O=o.createCamera(S.name).setType(S.type);if(S.extras&&O.setExtras(S.extras),S.type===Ng.Type.PERSPECTIVE){const k=S.perspective;O.setYFov(k.yfov),O.setZNear(k.znear),k.zfar!==void 0&&O.setZFar(k.zfar),k.aspectRatio!==void 0&&O.setAspectRatio(k.aspectRatio)}else{const k=S.orthographic;O.setZNear(k.znear).setZFar(k.zfar).setXMag(k.xmag).setYMag(k.ymag)}return O});const R=s.nodes||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(fi.NODE)).forEach(S=>S.preread(l,fi.NODE)),l.nodes=R.map(S=>{const O=o.createNode(S.name);if(S.extras&&O.setExtras(S.extras),S.translation!==void 0&&O.setTranslation(S.translation),S.rotation!==void 0&&O.setRotation(S.rotation),S.scale!==void 0&&O.setScale(S.scale),S.matrix!==void 0){const k=[0,0,0],N=[0,0,0,1],H=[1,1,1];Vn.decompose(S.matrix,k,N,H),O.setTranslation(k),O.setRotation(N),O.setScale(H)}return S.weights!==void 0&&O.setWeights(S.weights),O}),l.skins=(s.skins||[]).map(S=>{const O=o.createSkin(S.name);S.extras&&O.setExtras(S.extras),S.inverseBindMatrices!==void 0&&O.setInverseBindMatrices(l.accessors[S.inverseBindMatrices]),S.skeleton!==void 0&&O.setSkeleton(l.nodes[S.skeleton]);for(const k of S.joints)O.addJoint(l.nodes[k]);return O}),R.map((S,O)=>{const k=l.nodes[O];(S.children||[]).forEach(N=>k.addChild(l.nodes[N])),S.mesh!==void 0&&k.setMesh(l.meshes[S.mesh]),S.camera!==void 0&&k.setCamera(l.cameras[S.camera]),S.skin!==void 0&&k.setSkin(l.skins[S.skin])}),l.animations=(s.animations||[]).map(S=>{const O=o.createAnimation(S.name);S.extras&&O.setExtras(S.extras);const k=(S.samplers||[]).map(N=>{const H=o.createAnimationSampler().setInput(l.accessors[N.input]).setOutput(l.accessors[N.output]).setInterpolation(N.interpolation||Z0.Interpolation.LINEAR);return N.extras&&H.setExtras(N.extras),O.addSampler(H),H});return(S.channels||[]).forEach(N=>{const H=o.createAnimationChannel().setSampler(k[N.sampler]).setTargetPath(N.target.path);N.target.node!==void 0&&H.setTargetNode(l.nodes[N.target.node]),N.extras&&H.setExtras(N.extras),O.addChannel(H)}),O});const I=s.scenes||[];return o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(fi.SCENE)).forEach(S=>S.preread(l,fi.SCENE)),l.scenes=I.map(S=>{const O=o.createScene(S.name);return S.extras&&O.setExtras(S.extras),(S.nodes||[]).map(k=>l.nodes[k]).forEach(k=>O.addChild(k)),O}),s.scene!==void 0&&o.getRoot().setDefaultScene(l.scenes[s.scene]),o.getRoot().listExtensionsUsed().forEach(S=>S.read(l)),A.forEach((S,O)=>{const k=l.accessors[O],N=!!S.sparse,H=!S.bufferView&&!k.getArray();(N||H)&&k.setSparse(!0).setArray(function(X,te){const re=Jw[X.componentType],ue=Li.getElementSize(X.type);let le;le=X.bufferView!==void 0?sx(X,te):new re(X.count*ue);const se=X.sparse;if(!se)return le;const de=se.count,ve=Fl({},X,se.indices,{count:de,type:"SCALAR"}),fe=Fl({},X,se.values,{count:de}),Ee=sx(ve,te),Je=sx(fe,te);for(let Te=0;Te<ve.count;Te++)for(let qe=0;qe<ue;qe++)le[Ee[Te]*ue+qe]=Je[Te*ue+qe];return le}(S,l))}),o}static validate(t,i){const r=t.json;if(r.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired){for(const s of r.extensionsRequired)if(!i.extensions.find(o=>o.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(r.extensionsUsed)for(const s of r.extensionsUsed)i.extensions.find(o=>o.EXTENSION_NAME===s)||i.logger.warn(`Missing optional extension, "${s}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(Sr.assertView(e));this.j(t);const i=t.json;if(i.buffers&&i.buffers.some(r=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)}(t,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(i.images&&i.images.some(r=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)&&o.bufferView===void 0}(t,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Sr.assertView(e)))}async writeJSON(e,t={}){if(t.format===kg.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0\u20131 buffers.");return(class{static write(i,r){const s=i.getRoot(),o={asset:Fl({generator:"glTF-Transform v3.2.1"},s.getAsset()),extras:Fl({},s.getExtras())},l={json:o,resources:{}},u=new rd(i,l,r),h=r.logger||Pc.DEFAULT_INSTANCE,f=new Set(r.extensions.map(I=>I.EXTENSION_NAME)),g=i.getRoot().listExtensionsUsed().filter(I=>f.has(I.extensionName)),_=i.getRoot().listExtensionsRequired().filter(I=>f.has(I.extensionName));g.length<i.getRoot().listExtensionsUsed().length&&h.warn("Some extensions were not registered for I/O, and will not be written.");for(const I of g)for(const S of I.writeDependencies)I.install(S,r.dependencies[S]);function A(I,S,O,k){const N=[];let H=0;for(const te of I){const re=u.createAccessorDef(te);re.bufferView=o.bufferViews.length;const ue=te.getArray(),le=Sr.pad(Sr.toView(ue));re.byteOffset=H,H+=le.byteLength,N.push(le),u.accessorIndexMap.set(te,o.accessors.length),o.accessors.push(re)}const X={buffer:S,byteOffset:O,byteLength:Sr.concat(N).byteLength};return k&&(X.target=k),o.bufferViews.push(X),{buffers:N,byteLength:H}}function x(I,S,O){const k=I[0].getCount();let N=0;for(const re of I){const ue=u.createAccessorDef(re);ue.bufferView=o.bufferViews.length,ue.byteOffset=N;const le=re.getElementSize(),se=re.getComponentSize();N+=Sr.padNumber(le*se),u.accessorIndexMap.set(re,o.accessors.length),o.accessors.push(ue)}const H=k*N,X=new ArrayBuffer(H),te=new DataView(X);for(let re=0;re<k;re++){let ue=0;for(const le of I){const se=le.getElementSize(),de=le.getComponentSize(),ve=le.getComponentType(),fe=le.getArray();for(let Ee=0;Ee<se;Ee++){const Je=re*N+ue+Ee*de,Te=fe[re*se+Ee];switch(ve){case Li.ComponentType.FLOAT:te.setFloat32(Je,Te,!0);break;case Li.ComponentType.BYTE:te.setInt8(Je,Te);break;case Li.ComponentType.SHORT:te.setInt16(Je,Te,!0);break;case Li.ComponentType.UNSIGNED_BYTE:te.setUint8(Je,Te);break;case Li.ComponentType.UNSIGNED_SHORT:te.setUint16(Je,Te,!0);break;case Li.ComponentType.UNSIGNED_INT:te.setUint32(Je,Te,!0);break;default:throw new Error("Unexpected component type: "+ve)}}ue+=Sr.padNumber(se*de)}}return o.bufferViews.push({buffer:S,byteOffset:O,byteLength:H,byteStride:N,target:rd.BufferViewTarget.ARRAY_BUFFER}),{byteLength:H,buffers:[new Uint8Array(X)]}}function E(I,S,O){const k=[];let N=0;const H=new Map;let X=-1/0;for(const ve of I){const fe=u.createAccessorDef(ve);o.accessors.push(fe),u.accessorIndexMap.set(ve,o.accessors.length-1);const Ee=[],Je=[],Te=[],qe=new Array(ve.getElementSize()).fill(0);for(let Xe=0,Zt=ve.getCount();Xe<Zt;Xe++)if(ve.getElement(Xe,Te),!Vn.eq(Te,qe,0)){X=Math.max(Xe,X),Ee.push(Xe);for(let di=0;di<Te.length;di++)Je.push(Te[di])}const Ve=Ee.length,Ye={accessorDef:fe,count:Ve};if(H.set(ve,Ye),Ve===0)continue;if(Ve>ve.getCount()/3){const Xe=(100*Ee.length/ve.getCount()).toFixed(1);h.warn(`Sparse accessor with many non-zero elements (${Xe}%) may increase file size.`)}const Tt=Jw[ve.getComponentType()];Ye.indices=Ee,Ye.values=new Tt(Je)}if(!Number.isFinite(X))return{buffers:k,byteLength:N};const te=X<255?Uint8Array:X<65535?Uint16Array:Uint32Array,re=X<255?yR:X<65535?_R:vR,ue={buffer:S,byteOffset:O+N,byteLength:0};for(const ve of I){const fe=H.get(ve);if(fe.count===0)continue;fe.indicesByteOffset=ue.byteLength;const Ee=Sr.pad(Sr.toView(new te(fe.indices)));k.push(Ee),N+=Ee.byteLength,ue.byteLength+=Ee.byteLength}o.bufferViews.push(ue);const le=o.bufferViews.length-1,se={buffer:S,byteOffset:O+N,byteLength:0};for(const ve of I){const fe=H.get(ve);if(fe.count===0)continue;fe.valuesByteOffset=se.byteLength;const Ee=Sr.pad(Sr.toView(fe.values));k.push(Ee),N+=Ee.byteLength,se.byteLength+=Ee.byteLength}o.bufferViews.push(se);const de=o.bufferViews.length-1;for(const ve of I){const fe=H.get(ve);fe.count!==0&&(fe.accessorDef.sparse={count:fe.count,indices:{bufferView:le,byteOffset:fe.indicesByteOffset,componentType:re},values:{bufferView:de,byteOffset:fe.valuesByteOffset}})}return{buffers:k,byteLength:N}}const T=new Map;for(const I of i.getGraph().listEdges()){if(I.getParent()===s)continue;const S=I.getChild();if(S instanceof Li){const O=T.get(S)||[];O.push(I),T.set(S,O)}}if(o.accessors=[],o.bufferViews=[],o.samplers=[],o.textures=[],o.images=s.listTextures().map((I,S)=>{const O=u.createPropertyDef(I);I.getMimeType()&&(O.mimeType=I.getMimeType());const k=I.getImage();return k&&u.createImageData(O,k,I),u.imageIndexMap.set(I,S),O}),g.filter(I=>I.prewriteTypes.includes(fi.ACCESSOR)).forEach(I=>I.prewrite(u,fi.ACCESSOR)),s.listAccessors().forEach(I=>{const S=u.accessorUsageGroupedByParent,O=u.accessorParents;if(u.accessorIndexMap.has(I))return;const k=T.get(I)||[],N=u.getAccessorUsage(I);if(u.addAccessorToUsageGroup(I,N),S.has(N)){const H=k[0].getParent(),X=O.get(H)||new Set;X.add(I),O.set(H,X)}}),g.filter(I=>I.prewriteTypes.includes(fi.BUFFER)).forEach(I=>I.prewrite(u,fi.BUFFER)),(s.listAccessors().length>0||s.listTextures().length>0||u.otherBufferViews.size>0)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");o.buffers=[],s.listBuffers().forEach((I,S)=>{const O=u.createPropertyDef(I),k=u.accessorUsageGroupedByParent,N=u.accessorParents,H=I.listParents().filter(se=>se instanceof Li),X=new Set(H),te=[],re=o.buffers.length;let ue=0;const le=u.listAccessorUsageGroups();for(const se in le)if(k.has(se))for(const de of Array.from(N.values())){const ve=Array.from(de).filter(fe=>X.has(fe)).filter(fe=>u.getAccessorUsage(fe)===se);if(ve.length)if(se!==ax.ARRAY_BUFFER||r.vertexLayout===Zw.INTERLEAVED){const fe=se===ax.ARRAY_BUFFER?x(ve,re,ue):A(ve,re,ue);ue+=fe.byteLength,te.push(...fe.buffers)}else for(const fe of ve){const Ee=x([fe],re,ue);ue+=Ee.byteLength,te.push(...Ee.buffers)}}else{const de=le[se].filter(Ee=>X.has(Ee));if(!de.length)continue;const ve=se===ax.ELEMENT_ARRAY_BUFFER?rd.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,fe=se===ax.SPARSE?E(de,re,ue):A(de,re,ue,ve);ue+=fe.byteLength,te.push(...fe.buffers)}if(u.imageBufferViews.length&&S===0){for(let se=0;se<u.imageBufferViews.length;se++)if(o.bufferViews[o.images[se].bufferView].byteOffset=ue,ue+=u.imageBufferViews[se].byteLength,te.push(u.imageBufferViews[se]),ue%8){const de=8-ue%8;ue+=de,te.push(new Uint8Array(de))}}if(u.otherBufferViews.has(I))for(const se of u.otherBufferViews.get(I))o.bufferViews.push({buffer:re,byteOffset:ue,byteLength:se.byteLength}),u.otherBufferViewsIndexMap.set(se,o.bufferViews.length-1),ue+=se.byteLength,te.push(se);if(ue){let se;r.format===kg.GLB?se="@glb.bin":(se=u.bufferURIGenerator.createURI(I,"bin"),O.uri=se),O.byteLength=ue,l.resources[se]=Sr.concat(te)}o.buffers.push(O),u.bufferIndexMap.set(I,S)}),s.listAccessors().find(I=>!I.getBuffer())&&h.warn("Skipped writing one or more Accessors: no Buffer assigned."),o.materials=s.listMaterials().map((I,S)=>{const O=u.createPropertyDef(I);if(I.getAlphaMode()!==Fg.AlphaMode.OPAQUE&&(O.alphaMode=I.getAlphaMode()),I.getAlphaMode()===Fg.AlphaMode.MASK&&(O.alphaCutoff=I.getAlphaCutoff()),I.getDoubleSided()&&(O.doubleSided=!0),O.pbrMetallicRoughness={},Vn.eq(I.getBaseColorFactor(),[1,1,1,1])||(O.pbrMetallicRoughness.baseColorFactor=I.getBaseColorFactor()),Vn.eq(I.getEmissiveFactor(),[0,0,0])||(O.emissiveFactor=I.getEmissiveFactor()),I.getRoughnessFactor()!==1&&(O.pbrMetallicRoughness.roughnessFactor=I.getRoughnessFactor()),I.getMetallicFactor()!==1&&(O.pbrMetallicRoughness.metallicFactor=I.getMetallicFactor()),I.getBaseColorTexture()){const k=I.getBaseColorTexture(),N=I.getBaseColorTextureInfo();O.pbrMetallicRoughness.baseColorTexture=u.createTextureInfoDef(k,N)}if(I.getEmissiveTexture()){const k=I.getEmissiveTexture(),N=I.getEmissiveTextureInfo();O.emissiveTexture=u.createTextureInfoDef(k,N)}if(I.getNormalTexture()){const k=I.getNormalTexture(),N=I.getNormalTextureInfo(),H=u.createTextureInfoDef(k,N);I.getNormalScale()!==1&&(H.scale=I.getNormalScale()),O.normalTexture=H}if(I.getOcclusionTexture()){const k=I.getOcclusionTexture(),N=I.getOcclusionTextureInfo(),H=u.createTextureInfoDef(k,N);I.getOcclusionStrength()!==1&&(H.strength=I.getOcclusionStrength()),O.occlusionTexture=H}if(I.getMetallicRoughnessTexture()){const k=I.getMetallicRoughnessTexture(),N=I.getMetallicRoughnessTextureInfo();O.pbrMetallicRoughness.metallicRoughnessTexture=u.createTextureInfoDef(k,N)}return u.materialIndexMap.set(I,S),O}),o.meshes=s.listMeshes().map((I,S)=>{const O=u.createPropertyDef(I);let k=null;return O.primitives=I.listPrimitives().map(N=>{const H={attributes:{}};H.mode=N.getMode();const X=N.getMaterial();X&&(H.material=u.materialIndexMap.get(X)),Object.keys(N.getExtras()).length&&(H.extras=N.getExtras());const te=N.getIndices();te&&(H.indices=u.accessorIndexMap.get(te));for(const re of N.listSemantics())H.attributes[re]=u.accessorIndexMap.get(N.getAttribute(re));for(const re of N.listTargets()){const ue={};for(const le of re.listSemantics())ue[le]=u.accessorIndexMap.get(re.getAttribute(le));H.targets=H.targets||[],H.targets.push(ue)}return N.listTargets().length&&!k&&(k=N.listTargets().map(re=>re.getName())),H}),I.getWeights().length&&(O.weights=I.getWeights()),k&&(O.extras=O.extras||{},O.extras.targetNames=k),u.meshIndexMap.set(I,S),O}),o.cameras=s.listCameras().map((I,S)=>{const O=u.createPropertyDef(I);if(O.type=I.getType(),O.type===Ng.Type.PERSPECTIVE){O.perspective={znear:I.getZNear(),zfar:I.getZFar(),yfov:I.getYFov()};const k=I.getAspectRatio();k!==null&&(O.perspective.aspectRatio=k)}else O.orthographic={znear:I.getZNear(),zfar:I.getZFar(),xmag:I.getXMag(),ymag:I.getYMag()};return u.cameraIndexMap.set(I,S),O}),o.nodes=s.listNodes().map((I,S)=>{const O=u.createPropertyDef(I);return Vn.eq(I.getTranslation(),[0,0,0])||(O.translation=I.getTranslation()),Vn.eq(I.getRotation(),[0,0,0,1])||(O.rotation=I.getRotation()),Vn.eq(I.getScale(),[1,1,1])||(O.scale=I.getScale()),I.getWeights().length&&(O.weights=I.getWeights()),u.nodeIndexMap.set(I,S),O}),o.skins=s.listSkins().map((I,S)=>{const O=u.createPropertyDef(I),k=I.getInverseBindMatrices();k&&(O.inverseBindMatrices=u.accessorIndexMap.get(k));const N=I.getSkeleton();return N&&(O.skeleton=u.nodeIndexMap.get(N)),O.joints=I.listJoints().map(H=>u.nodeIndexMap.get(H)),u.skinIndexMap.set(I,S),O}),s.listNodes().forEach((I,S)=>{const O=o.nodes[S],k=I.getMesh();k&&(O.mesh=u.meshIndexMap.get(k));const N=I.getCamera();N&&(O.camera=u.cameraIndexMap.get(N));const H=I.getSkin();H&&(O.skin=u.skinIndexMap.get(H)),I.listChildren().length>0&&(O.children=I.listChildren().map(X=>u.nodeIndexMap.get(X)))}),o.animations=s.listAnimations().map((I,S)=>{const O=u.createPropertyDef(I),k=new Map;return O.samplers=I.listSamplers().map((N,H)=>{const X=u.createPropertyDef(N);return X.input=u.accessorIndexMap.get(N.getInput()),X.output=u.accessorIndexMap.get(N.getOutput()),X.interpolation=N.getInterpolation(),k.set(N,H),X}),O.channels=I.listChannels().map(N=>{const H=u.createPropertyDef(N);return H.sampler=k.get(N.getSampler()),H.target={node:u.nodeIndexMap.get(N.getTargetNode()),path:N.getTargetPath()},H}),u.animationIndexMap.set(I,S),O}),o.scenes=s.listScenes().map((I,S)=>{const O=u.createPropertyDef(I);return O.nodes=I.listChildren().map(k=>u.nodeIndexMap.get(k)),u.sceneIndexMap.set(I,S),O});const R=s.getDefaultScene();return R&&(o.scene=s.listScenes().indexOf(R)),o.extensionsUsed=g.map(I=>I.extensionName),o.extensionsRequired=_.map(I=>I.extensionName),g.forEach(I=>I.write(u)),function(I){const S=[];for(const O in I){const k=I[O];(Array.isArray(k)&&k.length===0||k===null||k===""||k&&typeof k=="object"&&Object.keys(k).length===0)&&S.push(O)}for(const O of S)delete I[O]}(o),l}}).write(e,{format:t.format||kg.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:Fl({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:i}=await this.writeJSON(e,{format:kg.GLB}),r=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),o=Sr.pad(Sr.encodeText(s),32),l=Sr.toView(new Uint32Array([o.byteLength,1313821514])),u=Sr.concat([l,o]);r[r.length-1]+=u.byteLength;const h=Object.values(i)[0];if(!h||!h.byteLength)return Sr.concat([Sr.toView(r),u]);const f=Sr.pad(h,0),g=Sr.toView(new Uint32Array([f.byteLength,5130562])),_=Sr.concat([g,f]);return r[r.length-1]+=_.byteLength,Sr.concat([Sr.toView(r),u,_])}async L(e,t){var i=this;const r=[...e.json.images||[],...e.json.buffers||[]].map(async function(s){const o=s.uri;if(!o||o.match(/data:/))return Promise.resolve();e.resources[o]=await i.readURI(i.resolve(t,o),"view"),i.lastReadBytes+=e.resources[o].byteLength});await Promise.all(r)}j(e){function t(i){if(i.uri){if(i.uri in e.resources)Sr.assertView(e.resources[i.uri]);else if(i.uri.match(/data:/)){const r=`__${function(){for(let s=0;s<999;s++){const o=dR();if(!DM.has(o))return DM.add(o),o}return""}()}.${K0.extension(i.uri)}`;e.resources[r]=Sr.createBufferFromDataURI(i.uri),i.uri=r}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(i)}),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:i}=e.json;return e={json:Fl({},e.json),resources:Fl({},e.resources)},t&&(e.json.images=t.map(r=>Fl({},r))),i&&(e.json.buffers=i.map(r=>Fl({},r))),e}P(e){if(!GM(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==ox.JSON)throw new Error("Missing required GLB JSON chunk.");const i=t[0],r=Sr.decodeText(Sr.toView(e,20,i)),s=JSON.parse(r),o=20+i;if(e.byteLength<=o)return{json:s,resources:{}};const l=new Uint32Array(e.buffer,e.byteOffset+o,2);if(l[1]!==ox.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:s,resources:{"@glb.bin":Sr.toView(e,o+8,l[0])}}}}function GM(a){if(a.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(a.buffer,a.byteOffset,3);return e[0]===1179937895&&e[1]===2}class AR extends bR{constructor(e=_b.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const i=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await i.arrayBuffer());case"text":return i.text()}}resolve(e,t){return _b.resolve(e,t)}dirname(e){return _b.dirname(e)}}const wR=64;class xR{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class bb{constructor(e,t,i,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,r)}}const hl=[171,75,84,88,32,50,48,187,13,10,26,10];function HM(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function xS(a){const e=new Uint8Array(a.buffer,a.byteOffset,hl.length);if(e[0]!==hl[0]||e[1]!==hl[1]||e[2]!==hl[2]||e[3]!==hl[3]||e[4]!==hl[4]||e[5]!==hl[5]||e[6]!==hl[6]||e[7]!==hl[7]||e[8]!==hl[8]||e[9]!==hl[9]||e[10]!==hl[10]||e[11]!==hl[11])throw new Error("Missing KTX 2.0 identifier.");const t=new xR,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new bb(a,hl.length,i,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const s=r._nextUint32();t.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),l=r._nextUint32(),u=r._nextUint32(),h=r._nextUint32(),f=r._nextUint64(),g=r._nextUint64(),_=3*s*8,A=new bb(a,hl.length+i,_,!0);for(let Je=0;Je<s;Je++)t.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+A._nextUint64(),A._nextUint64()),uncompressedByteLength:A._nextUint64()});const x=new bb(a,o,l,!0),E={vendorId:x._skip(4)._nextUint16(),descriptorType:x._nextUint16(),versionNumber:x._nextUint16(),descriptorBlockSize:x._nextUint16(),colorModel:x._nextUint8(),colorPrimaries:x._nextUint8(),transferFunction:x._nextUint8(),flags:x._nextUint8(),texelBlockDimension:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],bytesPlane:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],samples:[]},T=(E.descriptorBlockSize/4-6)/4;for(let Je=0;Je<T;Je++){const Te={bitOffset:x._nextUint16(),bitLength:x._nextUint8(),channelType:x._nextUint8(),samplePosition:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Te.channelType&wR?(Te.sampleLower=x._nextInt32(),Te.sampleUpper=x._nextInt32()):(Te.sampleLower=x._nextUint32(),Te.sampleUpper=x._nextUint32()),E.samples[Je]=Te}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(E);const R=new bb(a,u,h,!0);for(;R._offset<h;){const Je=R._nextUint32(),Te=R._scan(Je),qe=HM(Te),Ve=R._scan(Je-Te.byteLength);t.keyValue[qe]=qe.match(/^ktx/i)?HM(Ve):Ve,R._offset%4&&R._skip(4-R._offset%4)}if(g<=0)return t;const I=new bb(a,f,g,!0),S=I._nextUint16(),O=I._nextUint16(),k=I._nextUint32(),N=I._nextUint32(),H=I._nextUint32(),X=I._nextUint32(),te=[];for(let Je=0;Je<s;Je++)te.push({imageFlags:I._nextUint32(),rgbSliceByteOffset:I._nextUint32(),rgbSliceByteLength:I._nextUint32(),alphaSliceByteOffset:I._nextUint32(),alphaSliceByteLength:I._nextUint32()});const re=f+I._offset,ue=re+k,le=ue+N,se=le+H,de=new Uint8Array(a.buffer,a.byteOffset+re,k),ve=new Uint8Array(a.buffer,a.byteOffset+ue,N),fe=new Uint8Array(a.buffer,a.byteOffset+le,H),Ee=new Uint8Array(a.buffer,a.byteOffset+se,X);return t.globalData={endpointCount:S,selectorCount:O,imageDescs:te,endpointsData:de,selectorsData:ve,tablesData:fe,extendedData:Ee},t}class QM extends Os{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[fi.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}QM.EXTENSION_NAME="EXT_mesh_gpu_instancing";const zg="EXT_mesh_gpu_instancing";class WM extends Zn{constructor(...e){super(...e),this.extensionName=zg,this.provideTypes=[fi.NODE],this.prewriteTypes=[fi.ACCESSOR]}createInstancedMesh(){return new QM(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,i)=>{if(!t.extensions||!t.extensions[zg])return;const r=t.extensions[zg],s=this.createInstancedMesh();for(const o in r.attributes)s.setAttribute(o,e.accessors[r.attributes[o]]);e.nodes[i].setExtension(zg,s)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const i of t.listAttributes())e.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const r=i.getExtension(zg);if(r){const s=e.nodeIndexMap.get(i),o=t.json.nodes[s],l={attributes:{}};r.listSemantics().forEach(u=>{const h=r.getAttribute(u);l.attributes[u]=e.accessorIndexMap.get(h)}),o.extensions=o.extensions||{},o.extensions[zg]=l}}),this}}function nm(){return(nm=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a}).apply(this,arguments)}var Ab,$0,Xs;WM.EXTENSION_NAME=zg,function(a){a.QUANTIZE="quantize",a.FILTER="filter"}(Ab||(Ab={})),function(a){a.ATTRIBUTES="ATTRIBUTES",a.TRIANGLES="TRIANGLES",a.INDICES="INDICES"}($0||($0={})),function(a){a.NONE="NONE",a.OCTAHEDRAL="OCTAHEDRAL",a.QUATERNION="QUATERNION",a.EXPONENTIAL="EXPONENTIAL"}(Xs||(Xs={}));const{BYTE:ER,SHORT:XM,FLOAT:SR}=Li.ComponentType,{encodeNormalizedInt:qM,decodeNormalizedInt:ES}=Vn;function CR(a,e,t,i){const{filter:r,bits:s}=i,o={array:a.getArray(),byteStride:a.getElementSize()*a.getComponentSize(),componentType:a.getComponentType(),normalized:a.getNormalized()};if(t!==$0.ATTRIBUTES)return o;if(r!==Xs.NONE){let l=a.getNormalized()?function(u){const h=u.getComponentType(),f=u.getArray(),g=new Float32Array(f.length);for(let _=0;_<f.length;_++)g[_]=ES(f[_],h);return g}(a):new Float32Array(o.array);switch(r){case Xs.EXPONENTIAL:o.byteStride=4*a.getElementSize(),o.componentType=SR,o.normalized=!1,o.array=e.encodeFilterExp(l,a.getCount(),o.byteStride,s);break;case Xs.OCTAHEDRAL:o.byteStride=s>8?8:4,o.componentType=s>8?XM:ER,o.normalized=!0,l=a.getElementSize()===3?function(u){const h=new Float32Array(4*u.length/3);for(let f=0,g=u.length/3;f<g;f++)h[4*f]=u[3*f],h[4*f+1]=u[3*f+1],h[4*f+2]=u[3*f+2];return h}(l):l,o.array=e.encodeFilterOct(l,a.getCount(),o.byteStride,s);break;case Xs.QUATERNION:o.byteStride=8,o.componentType=XM,o.normalized=!0,o.array=e.encodeFilterQuat(l,a.getCount(),o.byteStride,s);break;default:throw new Error("Invalid filter.")}o.min=a.getMin([]),o.max=a.getMax([]),a.getNormalized()&&(o.min=o.min.map(u=>ES(u,a.getComponentType())),o.max=o.max.map(u=>ES(u,a.getComponentType()))),o.normalized&&(o.min=o.min.map(u=>qM(u,o.componentType)),o.max=o.max.map(u=>qM(u,o.componentType)))}else o.byteStride%4&&(o.array=function(l,u){const h=Sr.padNumber(l.BYTES_PER_ELEMENT*u)/l.BYTES_PER_ELEMENT,f=new l.constructor(l.length/u*h);for(let g=0;g*u<l.length;g++)for(let _=0;_<u;_++)f[g*h+_]=l[g*u+_];return f}(o.array,a.getElementSize()),o.byteStride=o.array.byteLength/a.getCount());return o}function MR(a,e){return e===rd.BufferViewUsage.ELEMENT_ARRAY_BUFFER?a.listParents().some(t=>t instanceof jg&&t.getMode()===jg.Mode.TRIANGLES)?$0.TRIANGLES:$0.INDICES:$0.ATTRIBUTES}function TR(a,e){const t=e.getGraph().listParentEdges(a).filter(i=>!(i.getParent()instanceof jM));for(const i of t){const r=i.getName(),s=i.getAttributes().key||"";if(r==="indices")return{filter:Xs.NONE};if(r==="attributes"){if(s==="POSITION")return{filter:Xs.NONE};if(s==="TEXCOORD_0")return{filter:Xs.NONE};if(s==="NORMAL")return{filter:Xs.OCTAHEDRAL,bits:8};if(s==="TANGENT")return{filter:Xs.OCTAHEDRAL,bits:8};if(s.startsWith("JOINTS_"))return{filter:Xs.NONE};if(s.startsWith("WEIGHTS_"))return{filter:Xs.NONE}}if(r==="output"){const o=YM(a);return o==="rotation"?{filter:Xs.QUATERNION,bits:16}:o==="translation"||o==="scale"?{filter:Xs.EXPONENTIAL,bits:12}:{filter:Xs.NONE}}if(r==="input")return{filter:Xs.NONE};if(r==="inverseBindMatrices")return{filter:Xs.NONE}}return{filter:Xs.NONE}}function YM(a){for(const e of a.listParents())if(e instanceof Z0){for(const t of e.listParents())if(t instanceof wS)return t.getTargetPath()}return null}const dl="EXT_meshopt_compression",KM={method:Ab.QUANTIZE};class SS extends Zn{constructor(...e){super(...e),this.extensionName=dl,this.prereadTypes=[fi.BUFFER,fi.PRIMITIVE],this.prewriteTypes=[fi.BUFFER,fi.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=KM,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=nm({},KM,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${dl}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${dl}]: Missing WASM support.`)}return t===fi.BUFFER?this._prereadBuffers(e):t===fi.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((i,r)=>{if(!i.extensions||!i.extensions[dl])return;const s=i.extensions[dl],o=s.byteOffset||0,l=s.byteLength||0,u=s.count,h=s.byteStride,f=new Uint8Array(u*h),g=t.json.buffers[s.buffer],_=Sr.toView(g.uri?t.resources[g.uri]:t.resources[MM],o,l);this._decoder.decodeGltfBuffer(f,u,h,_,s.mode,s.filter),e.bufferViews[r]=f})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(i=>{var r;i.extensions&&i.extensions[dl]&&(r=t.json.buffers[i.buffer]).extensions&&r.extensions.EXT_meshopt_compression&&r.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[i.buffer],e.buffers[i.extensions[dl].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,i]of this._decoderFallbackBufferMap){for(const r of t.listParents())r instanceof Li&&r.swap(t,i);t.dispose()}return this}prewrite(e,t){return t===fi.ACCESSOR?this._prewriteAccessors(e):t===fi.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,i=this._encoder,r=this._encoderOptions,s=this.document.createBuffer(),o=this.document.getRoot().listBuffers().indexOf(s);this._encoderFallbackBuffer=s,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const l of this.document.getRoot().listAccessors()){if(YM(l)==="weights"||l.getSparse())continue;const u=e.getAccessorUsage(l),h=MR(l,u),f=r.method===Ab.FILTER?TR(l,this.document):{filter:Xs.NONE},g=CR(l,i,h,f),{array:_,byteStride:A}=g,x=l.getBuffer();if(!x)throw new Error(`${dl}: Missing buffer for accessor.`);const E=this.document.getRoot().listBuffers().indexOf(x),T=[u,h,f.filter,A,E].join(":");let R=this._encoderBufferViews[T],I=this._encoderBufferViewData[T],S=this._encoderBufferViewAccessors[T];R&&I||(S=this._encoderBufferViewAccessors[T]=[],I=this._encoderBufferViewData[T]=[],R=this._encoderBufferViews[T]={buffer:o,target:rd.USAGE_TO_TARGET[u],byteOffset:0,byteLength:0,byteStride:u===rd.BufferViewUsage.ARRAY_BUFFER?A:void 0,extensions:{[dl]:{buffer:E,byteOffset:0,byteLength:0,mode:h,filter:f.filter!==Xs.NONE?f.filter:void 0,byteStride:A,count:0}}});const O=e.createAccessorDef(l);O.componentType=g.componentType,O.normalized=g.normalized,O.byteOffset=R.byteLength,O.min&&g.min&&(O.min=g.min),O.max&&g.max&&(O.max=g.max),e.accessorIndexMap.set(l,t.accessors.length),t.accessors.push(O),S.push(O),I.push(new Uint8Array(_.buffer,_.byteOffset,_.byteLength)),R.byteLength+=_.byteLength,R.extensions.EXT_meshopt_compression.count+=l.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const i in this._encoderBufferViews){const r=this._encoderBufferViews[i],s=this._encoderBufferViewData[i],o=this.document.getRoot().listBuffers()[r.extensions[dl].buffer],l=e.otherBufferViews.get(o)||[],{count:u,byteStride:h,mode:f}=r.extensions[dl],g=Sr.concat(s),_=t.encodeGltfBuffer(g,u,h,f),A=Sr.pad(_);r.extensions[dl].byteLength=_.byteLength,s.length=0,s.push(A),l.push(A),e.otherBufferViews.set(o,l)}}write(e){let t=0;for(const o in this._encoderBufferViews){const l=this._encoderBufferViews[o],u=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[o][0]),h=this._encoderBufferViewAccessors[o];for(const _ of h)_.bufferView=u;const f=e.jsonDoc.json.bufferViews[u],g=f.byteOffset||0;Object.assign(f,l),f.byteOffset=t,f.extensions[dl].byteOffset=g,t+=Sr.padNumber(l.byteLength)}const i=this._encoderFallbackBuffer,r=e.bufferIndexMap.get(i),s=e.jsonDoc.json.buffers[r];return s.byteLength=t,s.extensions={[dl]:{fallback:!0}},i.dispose(),this}}SS.EXTENSION_NAME=dl,SS.EncoderMethod=Ab;const wb="EXT_texture_avif";class IR{match(e){return e.length>=12&&Sr.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=JM(t,0);if(!i)return null;let r=i.end;for(;i=JM(t,r);)if(i.type==="meta")r=i.start+4;else if(i.type==="iprp"||i.type==="ipco")r=i.start;else{if(i.type==="ispe")return[t.getUint32(i.start+4),t.getUint32(i.start+8)];if(i.type==="mdat")break;r=i.end}return null}getChannels(e){return 4}}class ZM extends Zn{constructor(...e){super(...e),this.extensionName=wb,this.prereadTypes=[fi.TEXTURE]}static register(){id.registerFormat("image/avif",new IR)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[wb]&&(t.source=t.extensions[wb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/avif"){const r=e.imageIndexMap.get(i);(t.json.textures||[]).forEach(s=>{s.source===r&&(s.extensions=s.extensions||{},s.extensions[wb]={source:s.source},delete s.source)})}}),this}}function JM(a,e){if(a.byteLength<4+e)return null;const t=a.getUint32(e);return a.byteLength<t+e||t<8?null:{type:Sr.decodeText(new Uint8Array(a.buffer,a.byteOffset+e+4,4)),start:e+8,end:e+t}}ZM.EXTENSION_NAME=wb;const xb="EXT_texture_webp";class PR{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Sr.decodeText(e.slice(0,4)),i=Sr.decodeText(e.slice(8,12));if(t!=="RIFF"||i!=="WEBP")return null;const r=new DataView(e.buffer,e.byteOffset);let s=12;for(;s<r.byteLength;){const o=Sr.decodeText(new Uint8Array([r.getUint8(s),r.getUint8(s+1),r.getUint8(s+2),r.getUint8(s+3)])),l=r.getUint32(s+4,!0);if(o==="VP8 ")return[16383&r.getInt16(s+14,!0),16383&r.getInt16(s+16,!0)];if(o==="VP8L"){const u=r.getUint8(s+9),h=r.getUint8(s+10),f=r.getUint8(s+11);return[1+((63&h)<<8|u),1+((15&r.getUint8(s+12))<<10|f<<2|(192&h)>>6)]}s+=8+l+l%2}return null}getChannels(e){return 4}}class $M extends Zn{constructor(...e){super(...e),this.extensionName=xb,this.prereadTypes=[fi.TEXTURE]}static register(){id.registerFormat("image/webp",new PR)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[xb]&&(t.source=t.extensions[xb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const r=e.imageIndexMap.get(i);(t.json.textures||[]).forEach(s=>{s.source===r&&(s.extensions=s.extensions||{},s.extensions[xb]={source:s.source},delete s.source)})}}),this}}$M.EXTENSION_NAME=xb;const eT="KHR_draco_mesh_compression";let xa,tT,iT,jl;function RR(a,e){const t=new xa.DecoderBuffer;try{if(t.Init(e,e.length),a.GetEncodedGeometryType(t)!==xa.TRIANGULAR_MESH)throw new Error(`[${eT}] Unknown geometry type.`);const i=new xa.Mesh;if(!a.DecodeBufferToMesh(t,i).ok()||i.ptr===0)throw new Error(`[${eT}] Decoding failure.`);return i}finally{xa.destroy(t)}}function DR(a,e){const t=3*e.num_faces();let i,r;if(e.num_points()<=65534){const s=t*Uint16Array.BYTES_PER_ELEMENT;i=xa._malloc(s),a.GetTrianglesUInt16Array(e,s,i),r=new Uint16Array(xa.HEAPU16.buffer,i,t).slice()}else{const s=t*Uint32Array.BYTES_PER_ELEMENT;i=xa._malloc(s),a.GetTrianglesUInt32Array(e,s,i),r=new Uint32Array(xa.HEAPU32.buffer,i,t).slice()}return xa._free(i),r}function BR(a,e,t,i){const r=iT[i.componentType],s=tT[i.componentType],o=t.num_components(),l=e.num_points()*o,u=l*s.BYTES_PER_ELEMENT,h=xa._malloc(u);a.GetAttributeDataArrayForAllPoints(e,t,r,u,h);const f=new s(xa.HEAPF32.buffer,h,l).slice();return xa._free(h),f}var Eb,ou;(function(a){a[a.EDGEBREAKER=1]="EDGEBREAKER",a[a.SEQUENTIAL=0]="SEQUENTIAL"})(Eb||(Eb={})),function(a){a.POSITION="POSITION",a.NORMAL="NORMAL",a.COLOR="COLOR",a.TEX_COORD="TEX_COORD",a.GENERIC="GENERIC"}(ou||(ou={}));const rT={[ou.POSITION]:14,[ou.NORMAL]:10,[ou.COLOR]:8,[ou.TEX_COORD]:12,[ou.GENERIC]:12},nT={decodeSpeed:5,encodeSpeed:5,method:Eb.EDGEBREAKER,quantizationBits:rT,quantizationVolume:"mesh"};function OR(a,e=nT){const t=nm({},nT,e);t.quantizationBits=nm({},rT,e.quantizationBits);const i=new jl.Encoder,r=new jl.MeshBuilder,s=new jl.Mesh,o={},l=new jl.DracoInt8Array,u=a.listTargets().length>0;let h=!1;for(const T of a.listSemantics()){const R=a.getAttribute(T);if(R.getSparse()){h=!0;continue}const I=LR(T),S=kR(r,R.getComponentType(),s,jl[I],R.getCount(),R.getElementSize(),R.getArray());if(S===-1)throw new Error(`Error compressing "${T}" attribute.`);if(o[T]=S,t.quantizationVolume==="mesh"||T!=="POSITION")i.SetAttributeQuantization(jl[I],t.quantizationBits[I]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:O}=t,k=Math.max(O.max[0]-O.min[0],O.max[1]-O.min[1],O.max[2]-O.min[2]);i.SetAttributeExplicitQuantization(jl[I],t.quantizationBits[I],R.getElementSize(),O.min,k)}}}const f=a.getIndices();if(!f)throw new lx("Primitive must have indices.");r.AddFacesToMesh(s,f.getCount()/3,f.getArray()),i.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),i.SetTrackEncodedProperties(!0),i.SetEncodingMethod(t.method===Eb.SEQUENTIAL||u||h?jl.MESH_SEQUENTIAL_ENCODING:jl.MESH_EDGEBREAKER_ENCODING);const g=i.EncodeMeshToDracoBuffer(s,l);if(g<=0)throw new lx("Error applying Draco compression.");const _=new Uint8Array(g);for(let T=0;T<g;++T)_[T]=l.GetValue(T);const A=a.getAttribute("POSITION").getCount(),x=i.GetNumberOfEncodedPoints(),E=3*i.GetNumberOfEncodedFaces();if((u||h)&&x!==A)throw new lx('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return jl.destroy(l),jl.destroy(s),jl.destroy(r),jl.destroy(i),{numVertices:x,numIndices:E,data:_,attributeIDs:o}}function LR(a){return a==="POSITION"?ou.POSITION:a==="NORMAL"?ou.NORMAL:a.startsWith("COLOR_")?ou.COLOR:a.startsWith("TEXCOORD_")?ou.TEX_COORD:ou.GENERIC}function kR(a,e,t,i,r,s,o){switch(e){case Li.ComponentType.UNSIGNED_BYTE:return a.AddUInt8Attribute(t,i,r,s,o);case Li.ComponentType.BYTE:return a.AddInt8Attribute(t,i,r,s,o);case Li.ComponentType.UNSIGNED_SHORT:return a.AddUInt16Attribute(t,i,r,s,o);case Li.ComponentType.SHORT:return a.AddInt16Attribute(t,i,r,s,o);case Li.ComponentType.UNSIGNED_INT:return a.AddUInt32Attribute(t,i,r,s,o);case Li.ComponentType.FLOAT:return a.AddFloatAttribute(t,i,r,s,o);default:throw new Error(`Unexpected component type, "${e}".`)}}class lx extends Error{}const qs="KHR_draco_mesh_compression";class Sb extends Zn{constructor(...e){super(...e),this.extensionName=qs,this.prereadTypes=[fi.PRIMITIVE],this.prewriteTypes=[fi.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,xa=this._decoderModule,tT={[Li.ComponentType.FLOAT]:Float32Array,[Li.ComponentType.UNSIGNED_INT]:Uint32Array,[Li.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Li.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Li.ComponentType.SHORT]:Int16Array,[Li.ComponentType.BYTE]:Int8Array},iT={[Li.ComponentType.FLOAT]:xa.DT_FLOAT32,[Li.ComponentType.UNSIGNED_INT]:xa.DT_UINT32,[Li.ComponentType.UNSIGNED_SHORT]:xa.DT_UINT16,[Li.ComponentType.UNSIGNED_BYTE]:xa.DT_UINT8,[Li.ComponentType.SHORT]:xa.DT_INT16,[Li.ComponentType.BYTE]:xa.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,jl=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${qs}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),i=e.jsonDoc,r=new Map;try{const s=i.json.meshes||[];for(const o of s)for(const l of o.primitives){if(!l.extensions||!l.extensions[qs])continue;const u=l.extensions[qs];let[h,f]=r.get(u.bufferView)||[];if(!f||!h){const g=i.json.bufferViews[u.bufferView],_=i.json.buffers[g.buffer],A=Sr.toView(_.uri?i.resources[_.uri]:i.resources[MM],g.byteOffset||0,g.byteLength);h=new this._decoderModule.Decoder,f=RR(h,A),r.set(u.bufferView,[h,f]),t.debug(`[${qs}] Decompressed ${A.byteLength} bytes.`)}for(const g in l.attributes){const _=e.jsonDoc.json.accessors[l.attributes[g]],A=h.GetAttributeByUniqueId(f,u.attributes[g]),x=BR(h,f,A,_);e.accessors[l.attributes[g]].setArray(x)}l.indices!==void 0&&e.accessors[l.indices].setArray(DR(h,f))}}finally{for(const[s,o]of Array.from(r.values()))this._decoderModule.destroy(s),this._decoderModule.destroy(o)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${qs}] Please install extension dependency, "draco3d.encoder".`);const i=this.document.getLogger();i.debug(`[${qs}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const r=function(l){const u=l.getLogger(),h=new Set,f=new Set;for(const T of l.getRoot().listMeshes())for(const R of T.listPrimitives())R.getIndices()?R.getMode()!==jg.Mode.TRIANGLES?(f.add(R),u.warn(`[${qs}] Skipping Draco compression on non-TRIANGLES primitive.`)):h.add(R):(f.add(R),u.warn(`[${qs}] Skipping Draco compression on non-indexed primitive.`));const g=l.getRoot().listAccessors(),_=new Map;for(let T=0;T<g.length;T++)_.set(g[T],T);const A=new Map,x=new Set,E=new Map;for(const T of Array.from(h)){let R=sT(T,_);if(x.has(R))E.set(T,R);else{if(A.has(T.getIndices())){const I=T.getIndices(),S=I.clone();_.set(S,l.getRoot().listAccessors().length-1),T.swap(I,S)}for(const I of T.listAttributes())if(A.has(I)){const S=I.clone();_.set(S,l.getRoot().listAccessors().length-1),T.swap(I,S)}R=sT(T,_),x.add(R),E.set(T,R),A.set(T.getIndices(),R);for(const I of T.listAttributes())A.set(I,R)}}for(const T of Array.from(A.keys())){const R=new Set(T.listParents().map(I=>I.propertyType));if(R.size!==2||!R.has(fi.PRIMITIVE)||!R.has(fi.ROOT))throw new Error(`[${qs}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const T of Array.from(h)){const R=E.get(T),I=T.getIndices();if(A.get(I)!==R||T.listAttributes().some(S=>A.get(S)!==R))throw new Error(`[${qs}] Draco primitives must share all, or no, accessors.`)}for(const T of Array.from(f)){const R=T.getIndices();if(A.has(R)||T.listAttributes().some(I=>A.has(I)))throw new Error(`[${qs}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return E}(this.document),s=new Map;let o="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?i.warn(`[${qs}]: quantizationVolume=scene requires exactly 1 scene.`):o=function(l){const u={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},h=l.propertyType===fi.NODE?[l]:l.listChildren();for(const f of h)f.traverse(g=>{const _=g.getMesh();if(!_)return;const A=aR(_,g.getWorldMatrix());bS(A.min,u),bS(A.max,u)});return u}(this.document.getRoot().listScenes().pop()));for(const l of Array.from(r.keys())){const u=r.get(l);if(!u)throw new Error("Unexpected primitive.");if(s.has(u)){s.set(u,s.get(u));continue}const h=l.getIndices(),f=e.jsonDoc.json.accessors;let g;try{g=OR(l,nm({},this._encoderOptions,{quantizationVolume:o}))}catch(x){if(x instanceof lx){i.warn(`[${qs}]: ${x.message} Skipping primitive compression.`);continue}throw x}s.set(u,g);const _=e.createAccessorDef(h);_.count=g.numIndices,e.accessorIndexMap.set(h,f.length),f.push(_);for(const x of l.listSemantics()){const E=l.getAttribute(x);if(g.attributeIDs[x]===void 0)continue;const T=e.createAccessorDef(E);T.count=g.numVertices,e.accessorIndexMap.set(E,f.length),f.push(T)}const A=l.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(A)||e.otherBufferViews.set(A,[]),e.otherBufferViews.get(A).push(g.data)}return i.debug(`[${qs}] Compressed ${r.size} primitives.`),e.extensionData[qs]={primitiveHashMap:r,primitiveEncodingMap:s},this}write(e){const t=e.extensionData[qs];for(const i of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(i)];for(let s=0;s<i.listPrimitives().length;s++){const o=i.listPrimitives()[s],l=r.primitives[s],u=t.primitiveHashMap.get(o);if(!u)continue;const h=t.primitiveEncodingMap.get(u);h&&(l.extensions=l.extensions||{},l.extensions[qs]={bufferView:e.otherBufferViewsIndexMap.get(h.data),attributes:h.attributeIDs})}}if(!t.primitiveHashMap.size){const i=e.jsonDoc.json;i.extensionsUsed=(i.extensionsUsed||[]).filter(r=>r!==qs),i.extensionsRequired=(i.extensionsRequired||[]).filter(r=>r!==qs)}return this}}function sT(a,e){const t=[],i=a.getIndices();t.push(e.get(i));for(const r of a.listAttributes())t.push(e.get(r));return t.sort().join("|")}Sb.EXTENSION_NAME=qs,Sb.EncoderMethod=Eb;class e_ extends Os{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[fi.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:e_.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Nl.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Nl.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}e_.EXTENSION_NAME="KHR_lights_punctual",e_.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const nd="KHR_lights_punctual";class aT extends Zn{constructor(...e){super(...e),this.extensionName=nd}createLight(e=""){return new e_(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[nd])return this;const i=(t.json.extensions[nd].lights||[]).map(r=>{var s,o;const l=this.createLight().setName(r.name||"").setType(r.type);return r.color!==void 0&&l.setColor(r.color),r.intensity!==void 0&&l.setIntensity(r.intensity),r.range!==void 0&&l.setRange(r.range),((s=r.spot)==null?void 0:s.innerConeAngle)!==void 0&&l.setInnerConeAngle(r.spot.innerConeAngle),((o=r.spot)==null?void 0:o.outerConeAngle)!==void 0&&l.setOuterConeAngle(r.spot.outerConeAngle),l});return t.json.nodes.forEach((r,s)=>{r.extensions&&r.extensions[nd]&&e.nodes[s].setExtension(nd,i[r.extensions[nd].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const i=[],r=new Map;for(const s of this.properties){const o=s,l={type:o.getType()};Vn.eq(o.getColor(),[1,1,1])||(l.color=o.getColor()),o.getIntensity()!==1&&(l.intensity=o.getIntensity()),o.getRange()!=null&&(l.range=o.getRange()),o.getName()&&(l.name=o.getName()),o.getType()===e_.Type.SPOT&&(l.spot={innerConeAngle:o.getInnerConeAngle(),outerConeAngle:o.getOuterConeAngle()}),i.push(l),r.set(o,i.length-1)}return this.document.getRoot().listNodes().forEach(s=>{const o=s.getExtension(nd);if(o){const l=e.nodeIndexMap.get(s),u=t.json.nodes[l];u.extensions=u.extensions||{},u.extensions[nd]={light:r.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[nd]={lights:i},this}}aT.EXTENSION_NAME=nd;const{R:UR,G:NR}=Bn;class oT extends Os{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Gn(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:UR|NR})}}oT.EXTENSION_NAME="KHR_materials_anisotropy";const Vg="KHR_materials_anisotropy";class lT extends Zn{constructor(...e){super(...e),this.extensionName=Vg}createAnisotropy(){return new oT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Vg]){const o=this.createAnisotropy();e.materials[s].setExtension(Vg,o);const l=r.extensions[Vg];if(l.anisotropyStrength!==void 0&&o.setAnisotropyStrength(l.anisotropyStrength),l.anisotropyRotation!==void 0&&o.setAnisotropyRotation(l.anisotropyRotation),l.anisotropyTexture!==void 0){const u=l.anisotropyTexture;o.setAnisotropyTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getAnisotropyTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Vg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Vg]={};if(r.getAnisotropyStrength()>0&&(l.anisotropyStrength=r.getAnisotropyStrength()),r.getAnisotropyRotation()!==0&&(l.anisotropyRotation=r.getAnisotropyRotation()),r.getAnisotropyTexture()){const u=r.getAnisotropyTexture(),h=r.getAnisotropyTextureInfo();l.anisotropyTexture=e.createTextureInfoDef(u,h)}}}),this}}lT.EXTENSION_NAME=Vg;const{R:cT,G:uT,B:FR}=Bn;class hT extends Os{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Gn(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Gn(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Gn(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:cT})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:uT})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:cT|uT|FR})}}hT.EXTENSION_NAME="KHR_materials_clearcoat";const Gg="KHR_materials_clearcoat";class dT extends Zn{constructor(...e){super(...e),this.extensionName=Gg}createClearcoat(){return new hT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Gg]){const o=this.createClearcoat();e.materials[s].setExtension(Gg,o);const l=r.extensions[Gg];if(l.clearcoatFactor!==void 0&&o.setClearcoatFactor(l.clearcoatFactor),l.clearcoatRoughnessFactor!==void 0&&o.setClearcoatRoughnessFactor(l.clearcoatRoughnessFactor),l.clearcoatTexture!==void 0){const u=l.clearcoatTexture;o.setClearcoatTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getClearcoatTextureInfo(),u)}if(l.clearcoatRoughnessTexture!==void 0){const u=l.clearcoatRoughnessTexture;o.setClearcoatRoughnessTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getClearcoatRoughnessTextureInfo(),u)}if(l.clearcoatNormalTexture!==void 0){const u=l.clearcoatNormalTexture;o.setClearcoatNormalTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getClearcoatNormalTextureInfo(),u),u.scale!==void 0&&o.setClearcoatNormalScale(u.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Gg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Gg]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const u=r.getClearcoatTexture(),h=r.getClearcoatTextureInfo();l.clearcoatTexture=e.createTextureInfoDef(u,h)}if(r.getClearcoatRoughnessTexture()){const u=r.getClearcoatRoughnessTexture(),h=r.getClearcoatRoughnessTextureInfo();l.clearcoatRoughnessTexture=e.createTextureInfoDef(u,h)}if(r.getClearcoatNormalTexture()){const u=r.getClearcoatNormalTexture(),h=r.getClearcoatNormalTextureInfo();l.clearcoatNormalTexture=e.createTextureInfoDef(u,h),r.getClearcoatNormalScale()!==1&&(l.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}}),this}}dT.EXTENSION_NAME=Gg;class pT extends Os{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}pT.EXTENSION_NAME="KHR_materials_emissive_strength";const Hg="KHR_materials_emissive_strength";class fT extends Zn{constructor(...e){super(...e),this.extensionName=Hg}createEmissiveStrength(){return new pT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[Hg]){const r=this.createEmissiveStrength();e.materials[i].setExtension(Hg,r);const s=t.extensions[Hg];s.emissiveStrength!==void 0&&r.setEmissiveStrength(s.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Hg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Hg]={emissiveStrength:r.getEmissiveStrength()}}}),this}}fT.EXTENSION_NAME=Hg;class mT extends Os{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}mT.EXTENSION_NAME="KHR_materials_ior";const Qg="KHR_materials_ior";class gT extends Zn{constructor(...e){super(...e),this.extensionName=Qg}createIOR(){return new mT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[Qg]){const r=this.createIOR();e.materials[i].setExtension(Qg,r);const s=t.extensions[Qg];s.ior!==void 0&&r.setIOR(s.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Qg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{},o.extensions[Qg]={ior:r.getIOR()}}}),this}}gT.EXTENSION_NAME=Qg;const{R:jR,G:zR}=Bn;class vT extends Os{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Gn(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Gn(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:jR})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:zR})}}vT.EXTENSION_NAME="KHR_materials_iridescence";const Wg="KHR_materials_iridescence";class _T extends Zn{constructor(...e){super(...e),this.extensionName=Wg}createIridescence(){return new vT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Wg]){const o=this.createIridescence();e.materials[s].setExtension(Wg,o);const l=r.extensions[Wg];if(l.iridescenceFactor!==void 0&&o.setIridescenceFactor(l.iridescenceFactor),l.iridescenceIor!==void 0&&o.setIridescenceIOR(l.iridescenceIor),l.iridescenceThicknessMinimum!==void 0&&o.setIridescenceThicknessMinimum(l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&o.setIridescenceThicknessMaximum(l.iridescenceThicknessMaximum),l.iridescenceTexture!==void 0){const u=l.iridescenceTexture;o.setIridescenceTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getIridescenceTextureInfo(),u)}if(l.iridescenceThicknessTexture!==void 0){const u=l.iridescenceThicknessTexture;o.setIridescenceThicknessTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getIridescenceThicknessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Wg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Wg]={};if(r.getIridescenceFactor()>0&&(l.iridescenceFactor=r.getIridescenceFactor()),r.getIridescenceIOR()!==1.3&&(l.iridescenceIor=r.getIridescenceIOR()),r.getIridescenceThicknessMinimum()!==100&&(l.iridescenceThicknessMinimum=r.getIridescenceThicknessMinimum()),r.getIridescenceThicknessMaximum()!==400&&(l.iridescenceThicknessMaximum=r.getIridescenceThicknessMaximum()),r.getIridescenceTexture()){const u=r.getIridescenceTexture(),h=r.getIridescenceTextureInfo();l.iridescenceTexture=e.createTextureInfoDef(u,h)}if(r.getIridescenceThicknessTexture()){const u=r.getIridescenceThicknessTexture(),h=r.getIridescenceThicknessTextureInfo();l.iridescenceThicknessTexture=e.createTextureInfoDef(u,h)}}}),this}}_T.EXTENSION_NAME=Wg;const{R:yT,G:bT,B:AT,A:wT}=Bn;class xT extends Os{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Gn(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Gn(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Nl.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Nl.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:yT|bT|AT|wT})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:yT|bT|AT|wT})}}xT.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const Xg="KHR_materials_pbrSpecularGlossiness";class ET extends Zn{constructor(...e){super(...e),this.extensionName=Xg}createPBRSpecularGlossiness(){return new xT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Xg]){const o=this.createPBRSpecularGlossiness();e.materials[s].setExtension(Xg,o);const l=r.extensions[Xg];if(l.diffuseFactor!==void 0&&o.setDiffuseFactor(l.diffuseFactor),l.specularFactor!==void 0&&o.setSpecularFactor(l.specularFactor),l.glossinessFactor!==void 0&&o.setGlossinessFactor(l.glossinessFactor),l.diffuseTexture!==void 0){const u=l.diffuseTexture;o.setDiffuseTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getDiffuseTextureInfo(),u)}if(l.specularGlossinessTexture!==void 0){const u=l.specularGlossinessTexture;o.setSpecularGlossinessTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getSpecularGlossinessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Xg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Xg]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const u=r.getDiffuseTexture(),h=r.getDiffuseTextureInfo();l.diffuseTexture=e.createTextureInfoDef(u,h)}if(r.getSpecularGlossinessTexture()){const u=r.getSpecularGlossinessTexture(),h=r.getSpecularGlossinessTextureInfo();l.specularGlossinessTexture=e.createTextureInfoDef(u,h)}}}),this}}ET.EXTENSION_NAME=Xg;const{R:VR,G:GR,B:HR,A:QR}=Bn;class ST extends Os{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Gn(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Gn(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Nl.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Nl.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:VR|GR|HR})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:QR})}}ST.EXTENSION_NAME="KHR_materials_sheen";const qg="KHR_materials_sheen";class CT extends Zn{constructor(...e){super(...e),this.extensionName=qg}createSheen(){return new ST(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[qg]){const o=this.createSheen();e.materials[s].setExtension(qg,o);const l=r.extensions[qg];if(l.sheenColorFactor!==void 0&&o.setSheenColorFactor(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&o.setSheenRoughnessFactor(l.sheenRoughnessFactor),l.sheenColorTexture!==void 0){const u=l.sheenColorTexture;o.setSheenColorTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getSheenColorTextureInfo(),u)}if(l.sheenRoughnessTexture!==void 0){const u=l.sheenRoughnessTexture;o.setSheenRoughnessTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getSheenRoughnessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(qg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[qg]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const u=r.getSheenColorTexture(),h=r.getSheenColorTextureInfo();l.sheenColorTexture=e.createTextureInfoDef(u,h)}if(r.getSheenRoughnessTexture()){const u=r.getSheenRoughnessTexture(),h=r.getSheenRoughnessTextureInfo();l.sheenRoughnessTexture=e.createTextureInfoDef(u,h)}}}),this}}CT.EXTENSION_NAME=qg;const{R:WR,G:XR,B:qR,A:YR}=Bn;class MT extends Os{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Gn(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Gn(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Nl.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Nl.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:YR})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:WR|XR|qR})}}MT.EXTENSION_NAME="KHR_materials_specular";const Yg="KHR_materials_specular";class TT extends Zn{constructor(...e){super(...e),this.extensionName=Yg}createSpecular(){return new MT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Yg]){const o=this.createSpecular();e.materials[s].setExtension(Yg,o);const l=r.extensions[Yg];if(l.specularFactor!==void 0&&o.setSpecularFactor(l.specularFactor),l.specularColorFactor!==void 0&&o.setSpecularColorFactor(l.specularColorFactor),l.specularTexture!==void 0){const u=l.specularTexture;o.setSpecularTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getSpecularTextureInfo(),u)}if(l.specularColorTexture!==void 0){const u=l.specularColorTexture;o.setSpecularColorTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getSpecularColorTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Yg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Yg]={};if(r.getSpecularFactor()!==1&&(l.specularFactor=r.getSpecularFactor()),Vn.eq(r.getSpecularColorFactor(),[1,1,1])||(l.specularColorFactor=r.getSpecularColorFactor()),r.getSpecularTexture()){const u=r.getSpecularTexture(),h=r.getSpecularTextureInfo();l.specularTexture=e.createTextureInfoDef(u,h)}if(r.getSpecularColorTexture()){const u=r.getSpecularColorTexture(),h=r.getSpecularColorTextureInfo();l.specularColorTexture=e.createTextureInfoDef(u,h)}}}),this}}TT.EXTENSION_NAME=Yg;const{R:KR}=Bn;class IT extends Os{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Gn(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:KR})}}IT.EXTENSION_NAME="KHR_materials_transmission";const Kg="KHR_materials_transmission";class PT extends Zn{constructor(...e){super(...e),this.extensionName=Kg}createTransmission(){return new IT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Kg]){const o=this.createTransmission();e.materials[s].setExtension(Kg,o);const l=r.extensions[Kg];if(l.transmissionFactor!==void 0&&o.setTransmissionFactor(l.transmissionFactor),l.transmissionTexture!==void 0){const u=l.transmissionTexture;o.setTransmissionTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getTransmissionTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Kg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Kg]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const u=r.getTransmissionTexture(),h=r.getTransmissionTextureInfo();l.transmissionTexture=e.createTextureInfoDef(u,h)}}}),this}}PT.EXTENSION_NAME=Kg;class RT extends Os{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[fi.MATERIAL]}}RT.EXTENSION_NAME="KHR_materials_unlit";const t_="KHR_materials_unlit";class DT extends Zn{constructor(...e){super(...e),this.extensionName=t_}createUnlit(){return new RT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,i)=>{t.extensions&&t.extensions[t_]&&e.materials[i].setExtension(t_,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{if(i.getExtension(t_)){const r=e.materialIndexMap.get(i),s=t.json.materials[r];s.extensions=s.extensions||{},s.extensions[t_]={}}}),this}}DT.EXTENSION_NAME=t_;class BT extends Os{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}BT.EXTENSION_NAME="KHR_materials_variants";class OT extends Os{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[fi.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}OT.EXTENSION_NAME="KHR_materials_variants";class CS extends Os{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}CS.EXTENSION_NAME="KHR_materials_variants";const sd="KHR_materials_variants";class LT extends Zn{constructor(...e){super(...e),this.extensionName=sd}createMappingList(){return new OT(this.document.getGraph())}createVariant(e=""){return new CS(this.document.getGraph(),e)}createMapping(){return new BT(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof CS)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[sd])return this;const i=(t.json.extensions[sd].variants||[]).map(r=>this.createVariant().setName(r.name||""));return(t.json.meshes||[]).forEach((r,s)=>{const o=e.meshes[s];(r.primitives||[]).forEach((l,u)=>{if(!l.extensions||!l.extensions[sd])return;const h=this.createMappingList(),f=l.extensions[sd];for(const g of f.mappings){const _=this.createMapping();g.material!==void 0&&_.setMaterial(e.materials[g.material]);for(const A of g.variants||[])_.addVariant(i[A]);h.addMapping(_)}o.listPrimitives()[u].setExtension(sd,h)})}),this}write(e){const t=e.jsonDoc,i=this.listVariants();if(!i.length)return this;const r=[],s=new Map;for(const o of i)s.set(o,r.length),r.push(e.createPropertyDef(o));for(const o of this.document.getRoot().listMeshes()){const l=e.meshIndexMap.get(o);o.listPrimitives().forEach((u,h)=>{const f=u.getExtension(sd);if(!f)return;const g=e.jsonDoc.json.meshes[l].primitives[h],_=f.listMappings().map(A=>{const x=e.createPropertyDef(A),E=A.getMaterial();return E&&(x.material=e.materialIndexMap.get(E)),x.variants=A.listVariants().map(T=>s.get(T)),x});g.extensions=g.extensions||{},g.extensions[sd]={mappings:_}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[sd]={variants:r},this}}LT.EXTENSION_NAME=sd;const{G:ZR}=Bn;class kT extends Os{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[fi.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Gn(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:ZR})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Nl.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Nl.hexToFactor(e,t))}}kT.EXTENSION_NAME="KHR_materials_volume";const Zg="KHR_materials_volume";class UT extends Zn{constructor(...e){super(...e),this.extensionName=Zg}createVolume(){return new kT(this.document.getGraph())}read(e){const t=e.jsonDoc,i=t.json.textures||[];return(t.json.materials||[]).forEach((r,s)=>{if(r.extensions&&r.extensions[Zg]){const o=this.createVolume();e.materials[s].setExtension(Zg,o);const l=r.extensions[Zg];if(l.thicknessFactor!==void 0&&o.setThicknessFactor(l.thicknessFactor),l.attenuationDistance!==void 0&&o.setAttenuationDistance(l.attenuationDistance),l.attenuationColor!==void 0&&o.setAttenuationColor(l.attenuationColor),l.thicknessTexture!==void 0){const u=l.thicknessTexture;o.setThicknessTexture(e.textures[i[u.index].source]),e.setTextureInfo(o.getThicknessTextureInfo(),u)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(Zg);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l=o.extensions[Zg]={};if(r.getThicknessFactor()>0&&(l.thicknessFactor=r.getThicknessFactor()),Number.isFinite(r.getAttenuationDistance())&&(l.attenuationDistance=r.getAttenuationDistance()),Vn.eq(r.getAttenuationColor(),[1,1,1])||(l.attenuationColor=r.getAttenuationColor()),r.getThicknessTexture()){const u=r.getThicknessTexture(),h=r.getThicknessTextureInfo();l.thicknessTexture=e.createTextureInfoDef(u,h)}}}),this}}UT.EXTENSION_NAME=Zg;const NT="KHR_mesh_quantization";class FT extends Zn{constructor(...e){super(...e),this.extensionName=NT}read(e){return this}write(e){return this}}FT.EXTENSION_NAME=NT;const Cb="KHR_texture_basisu";class JR{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=xS(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=xS(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=xS(e),i=this.getChannels(e)>3;let r=0;for(let s=0;s<t.levels.length;s++){const o=t.levels[s];r+=o.uncompressedByteLength?o.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,s)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,s)))/4)*(i?16:8)}return r}}class jT extends Zn{constructor(...e){super(...e),this.extensionName=Cb,this.prereadTypes=[fi.TEXTURE]}static register(){id.registerFormat("image/ktx2",new JR)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[Cb]&&(t.source=t.extensions[Cb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/ktx2"){const r=e.imageIndexMap.get(i);t.json.textures.forEach(s=>{s.source===r&&(s.extensions=s.extensions||{},s.extensions[Cb]={source:s.source},delete s.source)})}}),this}}jT.EXTENSION_NAME=Cb;class zT extends Os{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[fi.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}zT.EXTENSION_NAME="KHR_texture_transform";const Jg="KHR_texture_transform";class VT extends Zn{constructor(...e){super(...e),this.extensionName=Jg}createTransform(){return new zT(this.document.getGraph())}read(e){for(const[t,i]of Array.from(e.textureInfos.entries())){if(!i.extensions||!i.extensions[Jg])continue;const r=this.createTransform(),s=i.extensions[Jg];s.offset!==void 0&&r.setOffset(s.offset),s.rotation!==void 0&&r.setRotation(s.rotation),s.scale!==void 0&&r.setScale(s.scale),s.texCoord!==void 0&&r.setTexCoord(s.texCoord),t.setExtension(Jg,r)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[i,r]of t){const s=i.getExtension(Jg);if(!s)continue;r.extensions=r.extensions||{};const o={},l=Vn.eq;l(s.getOffset(),[0,0])||(o.offset=s.getOffset()),s.getRotation()!==0&&(o.rotation=s.getRotation()),l(s.getScale(),[1,1])||(o.scale=s.getScale()),s.getTexCoord()!=null&&(o.texCoord=s.getTexCoord()),r.extensions[Jg]=o}return this}}VT.EXTENSION_NAME=Jg;const $R=[fi.ROOT,fi.SCENE,fi.NODE,fi.MESH,fi.MATERIAL,fi.TEXTURE,fi.ANIMATION];class GT extends Os{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=$R}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",nm({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const i=nm({},this.get("properties"));return t?i[e]=t:delete i[e],this.set("properties",i)}toJSONLD(){return nm({"@context":MS(this.get("context"))},MS(this.get("properties")))}fromJSONLD(e){const t=(e=MS(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function MS(a){return JSON.parse(JSON.stringify(a))}GT.EXTENSION_NAME="KHR_xmp_json_ld";const Pp="KHR_xmp_json_ld";class HT extends Zn{constructor(...e){super(...e),this.extensionName=Pp}createPacket(){return new GT(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const i=(t=e.jsonDoc.json.extensions)==null?void 0:t[Pp];if(!i||!i.packets)return this;const r=e.jsonDoc.json,s=this.document.getRoot(),o=i.packets.map(h=>this.createPacket().fromJSONLD(h)),l=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],u=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let h=0;h<l.length;h++){const f=l[h]||[];for(let g=0;g<f.length;g++){const _=f[g];_.extensions&&_.extensions[Pp]&&u[h][g].setExtension(Pp,o[_.extensions[Pp].packet])}}return this}write(e){const{json:t}=e.jsonDoc,i=[];for(const r of this.properties){i.push(r.toJSONLD());for(const s of r.listParents()){let o;switch(s.propertyType){case fi.ROOT:o=t.asset;break;case fi.SCENE:o=t.scenes[e.sceneIndexMap.get(s)];break;case fi.NODE:o=t.nodes[e.nodeIndexMap.get(s)];break;case fi.MESH:o=t.meshes[e.meshIndexMap.get(s)];break;case fi.MATERIAL:o=t.materials[e.materialIndexMap.get(s)];break;case fi.TEXTURE:o=t.images[e.imageIndexMap.get(s)];break;case fi.ANIMATION:o=t.animations[e.animationIndexMap.get(s)];break;default:o=null,this.document.getLogger().warn(`[${Pp}]: Unsupported parent property, "${s.propertyType}"`)}o&&(o.extensions=o.extensions||{},o.extensions[Pp]={packet:i.length-1})}}return i.length>0&&(t.extensions=t.extensions||{},t.extensions[Pp]={packets:i}),this}}HT.EXTENSION_NAME=Pp;const eD=[WM,SS,ZM,$M,Sb,aT,lT,dT,fT,gT,_T,ET,TT,CT,PT,DT,LT,UT,FT,jT,VT,HT];class QT extends hS{constructor(e){super(),this._loadedLibs=!1,e=e||{method:Sb.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new AR().registerExtensions(eD).registerExtensions([WT,fx,ux,hx,dx,mx,gx,vx,_x,yx,bx,Ax,wx,Sx,xx,Cx,px,Ex]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:i,...r}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,r);await this._loadLibs();const s={...r};t&&(s.externalImagesInExtras=!0);const o=await new Promise((_,A)=>this.parse(e,_,A,s)),l=await super.parseAsync(o,s);if(!t)return l;if(!o)throw new Error("GLTFDracoExporter: gltf is null");let u=o;const h=u.byteLength||1/0,f=await(typeof u!="object"||u.byteLength?this._io.readBinary(new Uint8Array(u)):this._io.readJSON({json:u,resources:{}}));if(f.createExtension(Sb).setRequired(!0).setEncoderOptions({...this._encoderOptions,...i??{}}),s.exportExt==="glb")u=await this._io.writeBinary(f),isFinite(h)&&console.log("DRACO Compression ratio: "+(u.byteLength/h).toFixed(5));else{const _=await this._io.writeJSON(f);u=_.json,Object.values(_.resources).filter(A=>A).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),u.resources=_.resources)}u.__isGLTFOutput=!0;const g=await super.parseAsync(u,s);if(!g)throw new Error("GLTFDracoExporter: blob is null");return g.ext="glb",g.__uncompressed=l,g}addExtension(e){return this._io.registerExtensions([e]),this}createAndAddExtension(e,t){return this.addExtension(XT(e,t))}}class TS extends Si{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Ut,td]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,i=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(r,s,o){dS(r,s,QT,l=>{const u=Wn()+".drc",h=l;h.loader=o.registerFile(u),h.loader.setDecoderConfig({type:"js"}),h.loader.preload(!0,!0)})})(i,e,t)}}TS.PluginType="GLTFDracoExportPlugin";class tD extends Os{constructor(){super(...arguments),this.extensionName=fa,this.parentTypes=[fi.SCENE],this.propertyType="ViewerJSON"}init(){}}class WT extends Zn{constructor(){super(...arguments),this.extensionName=fa,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)===null||t===void 0||t.forEach((i,r)=>{if(i.extensions&&i.extensions[fa]){const s=new tD(this.document.getGraph());e.scenes[r].setExtension(fa,s),this._viewerConfig=i.extensions[fa]}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var i;if(t.getExtension(fa)){const r=(i=e.jsonDoc.json.scenes)===null||i===void 0?void 0:i[e.jsonDoc.json.scene||0];r&&Object.keys(this._viewerConfig).length>0&&(r.extensions=r.extensions||{},r.extensions[fa]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}WT.EXTENSION_NAME=fa;class cx extends Os{addTexture(e,t,i,r=4369){this.setRef(e,i,{channels:r}),this.textures[e]=[t,i]}constructor(e,t,i){super(e,t),this.parentTypes=[fi.MATERIAL,fi.MESH,fi.NODE,fi.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=i}init(){}}class za extends Zn{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,i=t.json.materials||[],r=t.json.textures||[];return i.forEach((s,o)=>{var l,u;if(s.extensions&&s.extensions[this.extensionName]){const h=new cx(this.document.getGraph(),"",this.extensionName);e.materials[o].setExtension(this.extensionName,h);const f={...s.extensions[this.extensionName]};for(const[g,_]of Object.entries(f))if(typeof(_==null?void 0:_.index)=="number"){const A=_,x=(l=r[A.index])===null||l===void 0?void 0:l.source;if(typeof x!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",A);continue}const E=e.textures[x],T=new Gn(this.document.getGraph()),R=(u=this.textureChannels[g])!==null&&u!==void 0?u:4369;h.addTexture(g,T,E,R),e.setTextureInfo(T,A),delete f[g]}h.setExtras(f)}}),(t.json.meshes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new cx(this.document.getGraph(),"",this.extensionName);e.meshes[o].setExtension(this.extensionName,l);const u=s.extensions[this.extensionName];l.setExtras(u)}}),(t.json.nodes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new cx(this.document.getGraph(),"",this.extensionName);e.nodes[o].setExtension(this.extensionName,l);const u=s.extensions[this.extensionName];l.setExtras(u)}}),(t.json.scenes||[]).forEach((s,o)=>{if(s.extensions&&s.extensions[this.extensionName]){const l=new cx(this.document.getGraph(),"",this.extensionName);e.scenes[o].setExtension(this.extensionName,l);const u=s.extensions[this.extensionName];l.setExtras(u)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(i=>{const r=i.getExtension(this.extensionName);if(r){const s=e.materialIndexMap.get(i),o=t.json.materials[s];o.extensions=o.extensions||{};const l={...r.getExtras()};for(const[u,h]of Object.entries(r.textures)){const f=h[0],g=h[1];g&&(l[u]=e.createTextureInfoDef(g,f))}o.extensions[this.extensionName]=l}}),this.document.getRoot().listMeshes().forEach(i=>{const r=i.getExtension(this.extensionName);if(r){const s=e.meshIndexMap.get(i),o=t.json.meshes[s];o.extensions=o.extensions||{},o.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listNodes().forEach(i=>{const r=i.getExtension(this.extensionName);if(r){const s=e.nodeIndexMap.get(i),o=t.json.nodes[s];o.extensions=o.extensions||{},o.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listScenes().forEach(i=>{const r=i.getExtension(this.extensionName);if(r){const s=e.jsonDoc.json.scene||0,o=t.json.scenes[s];if(!o)return;o.extensions=o.extensions||{},o.extensions[this.extensionName]=r.getExtras()}}),this}}function iD(a){let e=0;return a.includes("R")&&(e|=Bn.R),a.includes("G")&&(e|=Bn.G),a.includes("B")&&(e|=Bn.B),a.includes("A")&&(e|=Bn.A),e}function XT(a,e){var t;return t=class extends za{constructor(){super(...arguments),this.extensionName=a,this.textureChannels=e?Object.fromEntries(Object.entries(e).map(([i,r])=>[i,typeof r=="number"?r:iD(r)])):{}}},t.EXTENSION_NAME=a,t}class ux extends za{constructor(){super(...arguments),this.extensionName=ux.EXTENSION_NAME,this.textureChannels={bumpTexture:Bn.R}}}ux.EXTENSION_NAME=mh;class hx extends za{constructor(){super(...arguments),this.extensionName=hx.EXTENSION_NAME,this.textureChannels={lightMapTexture:Bn.R|Bn.G|Bn.B}}}hx.EXTENSION_NAME=tc;class dx extends za{constructor(){super(...arguments),this.extensionName=dx.EXTENSION_NAME,this.textureChannels={alphaTexture:Bn.G}}}dx.EXTENSION_NAME=Ml;class px extends za{constructor(){super(...arguments),this.extensionName=px.EXTENSION_NAME,this.textureChannels={displacementTexture:Bn.R}}}px.EXTENSION_NAME=Ld;class fx extends za{constructor(){super(...arguments),this.extensionName=fx.EXTENSION_NAME}}fx.EXTENSION_NAME=Xr.DIAMOND_GLTF_EXTENSION;class mx extends za{constructor(){super(...arguments),this.extensionName=mx.EXTENSION_NAME}}mx.EXTENSION_NAME=tn.AnimationMarkersExtension;class gx extends za{constructor(){super(...arguments),this.extensionName=gx.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Bn.R|Bn.G|Bn.B}}}gx.EXTENSION_NAME=xo.ANISOTROPY_GLTF_EXTENSION;class vx extends za{constructor(){super(...arguments),this.extensionName=vx.EXTENSION_NAME,this.textureChannels={customBumpMap:Bn.R|Bn.G|Bn.B}}}vx.EXTENSION_NAME=Oa.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class _x extends za{constructor(){super(...arguments),this.extensionName=_x.EXTENSION_NAME}}_x.EXTENSION_NAME=Ho;class yx extends za{constructor(){super(...arguments),this.extensionName=yx.EXTENSION_NAME}}yx.EXTENSION_NAME=is;class bx extends za{constructor(){super(...arguments),this.extensionName=bx.EXTENSION_NAME}}bx.EXTENSION_NAME=Ji;class Ax extends za{constructor(){super(...arguments),this.extensionName=Ax.EXTENSION_NAME}}Ax.EXTENSION_NAME=nl.CLEARCOAT_TINT_GLTF_EXTENSION;class wx extends za{constructor(){super(...arguments),this.extensionName=wx.EXTENSION_NAME}}wx.EXTENSION_NAME=Zo.THIN_FILM_LAYER_GLTF_EXTENSION;class xx extends za{constructor(){super(...arguments),this.extensionName=xx.EXTENSION_NAME}}xx.EXTENSION_NAME=To.TRIPLANAR_GLTF_EXTENSION;class Ex extends za{constructor(){super(...arguments),this.extensionName=Ex.EXTENSION_NAME}}Ex.EXTENSION_NAME=Ll.LAYERED_MATERIAL_GLTF_EXTENSION;class Sx extends za{constructor(){super(...arguments),this.extensionName=Sx.EXTENSION_NAME}}Sx.EXTENSION_NAME=Ec.SSBEVEL_GLTF_EXTENSION;class Cx extends za{constructor(){super(...arguments),this.extensionName=Cx.EXTENSION_NAME}}Cx.EXTENSION_NAME=rl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class qT extends V.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}qT.PluginType="PMREMGenerator";const YT=new p.Pa4,rD=new p._fP,KT=new p.Pa4;class nD extends p.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const ad=new p.yGw,sD=new p.yGw;class aD{constructor(e={}){const t=this;let i,r,s,o;const l={camera:{fov:0,style:""},objects:new WeakMap},u=e.element!==void 0?e.element:document.createElement("div");u.style.overflow="hidden",this.domElement=u;const h=document.createElement("div");h.style.transformOrigin="0 0",h.style.pointerEvents="none",u.appendChild(h);const f=document.createElement("div");function g(E){return Math.abs(E)<1e-10?0:E}function _(E){const T=E.elements;return"matrix3d("+g(T[0])+","+g(-T[1])+","+g(T[2])+","+g(T[3])+","+g(T[4])+","+g(-T[5])+","+g(T[6])+","+g(T[7])+","+g(T[8])+","+g(-T[9])+","+g(T[10])+","+g(T[11])+","+g(T[12])+","+g(-T[13])+","+g(T[14])+","+g(T[15])+")"}function A(E){const T=E.elements;return"translate(-50%,-50%)matrix3d("+g(T[0])+","+g(T[1])+","+g(T[2])+","+g(T[3])+","+g(-T[4])+","+g(-T[5])+","+g(-T[6])+","+g(-T[7])+","+g(T[8])+","+g(T[9])+","+g(T[10])+","+g(T[11])+","+g(T[12])+","+g(T[13])+","+g(T[14])+","+g(T[15])+")"}function x(E,T,R,I){if(E.isCSS3DObject){const S=E.visible===!0&&E.layers.test(R.layers)===!0;if(E.element.style.display=S===!0?"":"none",S===!0){let O;E.onBeforeRender(t,T,R),E.isCSS3DSprite?(ad.copy(R.matrixWorldInverse),ad.transpose(),E.rotation2D!==0&&ad.multiply(sD.makeRotationZ(E.rotation2D)),E.matrixWorld.decompose(YT,rD,KT),ad.setPosition(YT),ad.scale(KT),ad.elements[3]=0,ad.elements[7]=0,ad.elements[11]=0,ad.elements[15]=1,O=A(ad)):O=A(E.matrixWorld);const k=E.element,N=l.objects.get(E);if(N===void 0||N.style!==O){k.style.transform=O;const H={style:O};l.objects.set(E,H)}k.parentNode!==f&&f.appendChild(k),E.onAfterRender(t,T,R)}}for(let S=0,O=E.children.length;S<O;S++)x(E.children[S],T,R)}f.style.transformStyle="preserve-3d",h.appendChild(f),this.getSize=function(){return{width:i,height:r}},this.render=function(E,T){const R=T.projectionMatrix.elements[5]*o;let I,S;l.camera.fov!==R&&(h.style.perspective=T.isPerspectiveCamera?R+"px":"",l.camera.fov=R),T.view&&T.view.enabled?(h.style.transform=`translate( ${-T.view.offsetX*(i/T.view.width)}px, ${-T.view.offsetY*(r/T.view.height)}px )`,h.style.transform+=`scale( ${T.view.fullWidth/T.view.width}, ${T.view.fullHeight/T.view.height} )`):h.style.transform="",E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),T.parent===null&&T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),T.isOrthographicCamera&&(I=-(T.right+T.left)/2,S=(T.top+T.bottom)/2);const O=T.view&&T.view.enabled?T.view.height/T.view.fullHeight:1,k=T.isOrthographicCamera?`scale( ${O} )scale(`+R+")translate("+g(I)+"px,"+g(S)+"px)"+_(T.matrixWorldInverse):`scale( ${O} )translateZ(`+R+"px)"+_(T.matrixWorldInverse),N=k+"translate("+s+"px,"+o+"px)";l.camera.style!==N&&(f.style.transform=N,l.camera.style=N),x(E,E,T)},this.setSize=function(E,T){i=E,r=T,s=i/2,o=r/2,u.style.width=E+"px",u.style.height=T+"px",h.style.width=E+"px",h.style.height=T+"px",f.style.width=E+"px",f.style.height=T+"px"}}}var Mx,Tx=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let od=Mx=class extends Si{constructor(a=!0){super(),this._scene=new p.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,t,i,r,s;const o=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();if(!(o!=null&&o.geometry))return void await((i=this._viewer)===null||i===void 0?void 0:i.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const l=await((r=this._viewer)===null||r===void 0?void 0:r.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!l)return;const u=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Width: Enter the width for the object.","512",!1))||"512";u&&this.attachIFrame(o,l,parseInt(u))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=a,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const a=this._viewer;a&&this._renderer&&(a.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",a.canvas):this._renderer.domElement.appendChild(a.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new aD;const a=this._viewer.renderer.rendererObject.getSize(new p.FM8);this._renderer.setSize(a.width,a.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new p.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(a){await super.onAdded(a);let e=!0,t=!0;a.addEventListener("postFrame",s=>{var o,l;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(u=>{var h,f;let g=!0;const _=u.modelObj.material.side;if(_!==p.ehD){const A=new p.Pa4(0,0,1).applyQuaternion(u.cssObj.quaternion),x=(f=(h=this._viewer)===null||h===void 0?void 0:h.scene.activeCamera)===null||f===void 0?void 0:f.cameraObject,E=A.dot(x.getWorldDirection(new p.Pa4));g=_===p._Li?E>0:E<0}u.cssObj.element.style.visibility=g?"visible":"hidden"}),this._trackers.filter(u=>u.dirty).forEach(u=>this._syncProperties(u)),(o=this._renderer)===null||o===void 0||o.render(this._scene,(l=a.scene.activeCamera)===null||l===void 0?void 0:l.cameraObject),e=!1))}),a.addEventListener("update",s=>{this.enabled&&(e=this._trackers.length>0)}),a.scene.addEventListener("sceneUpdate",s=>{this.enabled&&(this._trackers.forEach(o=>o.dirty=!0),e=this._trackers.length>0)}),a.scene.addEventListener("activeCameraUpdate",s=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let i=!1;const r=new p.iMs;a.container.addEventListener("mousemove",s=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const o=this._viewer.canvas.getBoundingClientRect(),l=(s.clientX-o.x)/o.width*2-1,u=-(s.clientY-o.y)/o.height*2+1;r.setFromCamera({x:l,y:u},this._viewer.scene.activeCamera.cameraObject);const h=this._trackers.map(g=>g.modelObj),f=r.intersectObjects(h,!1);if(console.log(f),f.length)return this._viewer.canvas.style.pointerEvents="none",i=!0,void console.log(this._viewer.canvas.style.pointerEvents);i&&(this._viewer.canvas.style.pointerEvents="auto",i=!1)})}attachIFrame(a,e,t){const i=Px(a.modelObject),r=ZT(e,t,t*i.y/i.x,()=>{var s;return(s=a.setDirty)===null||s===void 0?void 0:s.call(a)});return this.attachCSS3DObject(r,a),r}attachCSS3DObject(a,e){var t,i,r,s,o;if(this._trackers.push({cssObj:a,modelObj:e.modelObject,dirty:!0}),a.element&&(this._resizeObserver.observe(a.element),a.element.__isCSS3DObjectElement=!0,console.log(a.element,a.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const l=(t=this._viewer)===null||t===void 0?void 0:t.createMaterial("basic",{opacity:0,color:new p.Ilk("black"),blending:p.jFi,side:p.Wl3});if(!l)throw"cannot create mat";l.userData.forcedLinearDepth=0,(i=e.setMaterial)===null||i===void 0||i.call(e,l),Ix(e.modelObject),IS(e.modelObject),Px(e.modelObject),this._scene.add(a),(s=(r=this.uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||s===void 0||s.call(r),(o=e.setDirty)===null||o===void 0||o.call(e)}_syncProperties(a){const e=a.modelObj,t=a.cssObj;e.updateMatrixWorld();const i=a.cssObj.element.clientWidth<1.5?0:(a.cssObj.element.clientWidth-1.5)/Px(e).x,r=Ix(e);t.quaternion.setFromUnitVectors(new p.Pa4(0,0,1),r),t.position.copy(IS(e)),t.scale.set(1,1,1).multiplyScalar(1/i),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),a.dirty=!1}async onDispose(a){return this._resizeObserver.disconnect(),super.onDispose(a)}};function ZT(a,e,t,i){const r=document.createElement("div");r.style.width=e.toString()+"px",r.style.height=t.toString()+"px",r.style.backgroundColor="transparent";const s=document.createElement("iframe",{is:"x-frame-bypass"});s.style.width="100%",s.style.height="100%",s.style.border="0px";const o=()=>{var l,u;try{s.contentWindow.name}catch(h){(typeof h=="string"?h:(u=(l=h==null?void 0:h.toString)===null||l===void 0?void 0:l.call(h))!==null&&u!==void 0?u:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(h)}i(),s.removeEventListener("load",o)};return s.addEventListener("load",o),s.src=a,r.appendChild(s),new nD(r)}function Ix(a){if(a.geometry.userData.geometryNormal)return a.geometry.userData.geometryNormal;const e=a.geometry.attributes.normal,t=new p.Pa4,i=new p.Pa4;for(let r=0,s=e.count;r<s;r++)t.fromBufferAttribute(e,r),i.add(t);return i.normalize(),a.geometry.userData.geometryNormal=i,i}function IS(a){if(a.geometry.userData.geometryCenter)return a.geometry.userData.geometryCenter;const e=a.geometry;if(!e)return new p.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new p.Pa4);return a.geometry.userData.geometryCenter=t,t}function Px(a,e=new p.Pa4(0,0,1)){if(a.geometry.userData.geometrySize)return a.geometry.userData.geometrySize;const t=a.geometry;if(!t)return new p.Pa4(0,0,0);const i=t.clone();i.applyMatrix4(new p.yGw().makeRotationFromQuaternion(new p._fP().setFromUnitVectors(e,Ix(a)).invert())),i.computeBoundingBox();const r=i.boundingBox.getSize(new p.Pa4);return a.geometry.userData.geometrySize=r,i.dispose(),r}od.PluginType="CSS3DRenderer",Tx([Ot("Enabled"),(0,V.onChange)(Mx.prototype._refreshEnabled),ae()],od.prototype,"enabled",void 0),Tx([Ot("Over canvas"),(0,V.onChange)(Mx.prototype._refreshCanvasInDOM),ae()],od.prototype,"overCanvas",void 0),Tx([Xi("Attach iframe")],od.prototype,"attachIFrameToSelected",void 0),od=Mx=Tx([zi("CSS3D Renderer")],od);class oD extends pu{constructor(e,t,i,r=new p.Ilk(1,1,1),s=1){super(void 0,void 0,i,r,s),this._getSelectedObjectOrMaterial=e,this.target=t}render(e,t,i,r,s){const o=e.getRenderTarget(),l=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),h=this._getSelectedObjectOrMaterial();if(h)this._renderSelectedObject(e,h,t,r,s);else{e.setRenderTarget(this.target);const f=new p.Ilk;e.getClearColor(f),e.setClearColor(new p.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(f)}e.setRenderTarget(o,l,u)}_renderSelectedObject(e,t,i,r,s){if(!this.camera)return;const o=(Array.isArray(t)?t:[t]).map(h=>h.isMaterial?[...h.userData.__appliedMeshes.values()]:h).flat();o.forEach(h=>h.traverse(f=>{f.layers.enable(6)}));const l=this.camera.layers.mask;this.camera.layers.set(6);const u=e.userData;u||console.error("threejs is not patched?"),u.transmissionRenderTarget=i,Wt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,i,this.target,r,s)),u.transmissionRenderTarget=void 0,o.forEach(h=>h.traverse(f=>{f.layers.disable(6)})),this.camera.layers.mask=l}}var th,ld=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Rc=th=class{constructor(a,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new p.Ilk(15305317),this.debugOutline=!1,this.highlightSelectedMaterials=!1,this.highlightMaterialSameNames=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new p.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new p.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null},dpr:{value:1}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(t,i)=>this.enabled?V.glsl`
            ${ha}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;uniform float dpr;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*dpr*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=a.getPlugin(vn),this._pickingPlugin=a.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(a,e,t){this.enabled&&(a.fragmentShader=Mi(a.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(a){return this.enabled?"1":"0"}isCompatible(a){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var a;(a=this.__setDirty)===null||a===void 0||a.call(this),this._setDirty()}_enable(){var a;(a=this._pickingPlugin)===null||a===void 0||a.enableWidget(!this.enabled),this._setDirty()}};Rc.PluginType="Outline",ld([(0,V.onChange)(th.prototype._enable),Ot("Enable"),ae()],Rc.prototype,"enabled",void 0),ld([(0,V.onChange)(th.prototype._setDirty),Ot("Highlight"),ae()],Rc.prototype,"enableHighlight",void 0),ld([(0,V.onChange)(th.prototype._setDirty),Ot("DynamicSelection"),ae()],Rc.prototype,"enableDynamicSelection",void 0),ld([(0,V.onChange)(th.prototype._setDirty),ai("Intensity",[0,2],.001,{limitedUi:!0}),ae()],Rc.prototype,"outlineIntensity",void 0),ld([(0,V.onChange)(th.prototype._setDirty),ai("Transparency",[0,1],.01,{limitedUi:!0}),ae()],Rc.prototype,"highlightTransparency",void 0),ld([(0,V.onChange)(th.prototype._setDirty),ea("Color"),ae()],Rc.prototype,"outlineColor",void 0),ld([(0,V.onChange)(th.prototype._setDirty),Ot("Debug")],Rc.prototype,"debugOutline",void 0),ld([(0,V.onChange)(th.prototype._setDirty),Ot("Highlight Selected Materials")],Rc.prototype,"highlightSelectedMaterials",void 0),ld([(0,V.onChange)(th.prototype._setDirty),Ot("Highlight Materials (same name)")],Rc.prototype,"highlightMaterialSameNames",void 0),Rc=th=ld([zi("Outline")],Rc);class Mb extends Zc{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new Rc(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e==null?void 0:e.getPluginByType("Picking");t||console.error("OutlinePlugin requires PickingPlugin to be added to the viewer"),e.addEventListener("preRender",()=>{this._extension.extraUniforms.dpr.value=e.renderer.displayCanvasScaling});const i=new p.jyz({uniforms:{cameraNearFar:{value:new p.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:p.ehD}),r=Zl(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new oD(()=>{var s,o;if(!((s=this._extension)===null||s===void 0)&&s.highlightSelectedMaterials){const l=(o=t==null?void 0:t.getSelectedObject())===null||o===void 0?void 0:o.material;if(this._extension.highlightMaterialSameNames&&l){const u=Array.isArray(l)?l.map(f=>f.name):[l.name],h=new Set;return u.forEach(f=>{var g,_;const A=(_=(g=e.assetManager)===null||g===void 0?void 0:g.materials)===null||_===void 0?void 0:_.findMaterialsByName(f);A==null||A.forEach(x=>h.add(x))}),[...h]}return l}return t==null?void 0:t.getSelectedObject()},this._outlineTarget,i),update(){e.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),r.passObject.scene=e.scene.modelObject,r.passObject.camera=e.scene.renderCamera.cameraObject}});e.renderer.registerPass(r),t==null||t.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(t!=null&&t.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",s=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const o=t==null?void 0:t.getSelectedObject();o&&this._extension.enableDynamicSelection?s.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=o?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,i){return g0(this._extension,"transparency",{from:e,to:t,duration:i,onComplete:()=>{this._animationCallBack=null}})}}Mb.PluginType="Outline";const Rx=.2,lD=Math.PI/24,JT=new p.FM8,Dx=(a,e,t)=>{let i=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let r=0;r<=12;++r)a.push(e+.17*Math.cos(i),t+.17*Math.sin(i),0,e+Rx*Math.cos(i),t+Rx*Math.sin(i),0),i+=lD};class $T extends p.Kj0{constructor(e,t,i=!1){super(((u,h)=>{const f=new p.u9r,g=[],_=[],A=u.getSize(new p.Pa4),x=A.x/2,E=(h?A.y:A.z)/2;Dx(_,x,E),Dx(_,-x,E),Dx(_,-x,-E),Dx(_,x,-E);const T=_.length/3;for(let I=0;I<T-2;I+=2)g.push(I,I+1,I+3,I,I+3,I+2);const R=T-2;return g.push(R,R+1,1,R,1,0),f.setAttribute("position",new p.a$l(_,3)),f.setIndex(g),f})(e,i)),this.boundingSize=new p.Pa4,this._raycaster=new p.iMs,this._camera=t,this._placeOnWall=i;const r=this.material;r.side=p.Wl3,r.color=new p.Ilk(16711935),r.opacity=0,this.userData.bboxVisible=!1;const s=e.getSize(this.boundingSize),o=s.x/2,l=(i?s.y:s.z)/2;this.hitPlane=new p.Kj0(new p._12(2*(o+Rx),2*(l+Rx))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),i?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,i){JT.set(t,-i),this.hitPlane.visible=!0;const r=this._positionAndNormalFromPoint(JT,this.hitPlane);return this.hitPlane.visible=!1,r==null?null:r.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3);const r=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),r}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:i}=this.hitPlane;t.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const i=this._raycaster.intersectObject(t,!0);if(i.length===0)return null;const r=i[0];return r.face==null?null:r.uv==null?{position:r.point,normal:r.face.normal,uv:null}:(r.face.normal.applyNormalMatrix(new p.Vkp().getNormalMatrix(r.object.matrixWorld)),{position:r.point,normal:r.face.normal,uv:r.uv})}}const PS=new p.Pa4;class e2{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new p.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new p.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new p.Pa4,this._hitMatrix=new p.yGw,this.xDamper=new V.Damper,this.yDamper=new V.Damper,this.zDamper=new V.Damper,this.yawDamper=new V.Damper,this.scaleDamper=new V.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const i=this.frame.getHitTestResultsForTransientInput(t),r=this.presentedScene,s=this.placementBox;if(i.length===1){this.inputSource=e.inputSource;const{axes:o}=this.inputSource.gamepad||{axes:[0,0]},l=s.getHit(r,o[0],o[1]);s.show=!0,l!=null?(this.isTranslating=!0,this.lastDragPosition.copy(l),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*o[0])}else if(i.length===2){s.show=!0,this.isTwoFingering=!0;const{separation:o}=this.fingerPolar(i);this.firstRatio=o/r.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,i){var r;this.transientHitTestSource=await((r=e.requestHitTestSourceForTransientInput)===null||r===void 0?void 0:r.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=i,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const i=(t=this.xr)===null||t===void 0?void 0:t.getReferenceSpace(),r=i?e.getPose(i):null;return r?(this._hitMatrix.fromArray(r.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,i=t.position,r=t.rotation.y,s=this.placementBox,o=Math.max(s.boundingSize.x,s.boundingSize.y,s.boundingSize.z)/2,l=this.goalPosition,u=t.scale.x;if(!l.equals(i)||this.goalScale!==u){let{x:h,y:f,z:g}=i;h=this.xDamper.update(h,l.x,e,o),f=this.yDamper.update(f,l.y,e,o),g=this.zDamper.update(g,l.z,e,o),i.set(h,f,g);const _=this.scaleDamper.update(u,this.goalScale,e,1);if(t.scale.set(_,_,_),!this.isTranslating){const A=l.y-f;this.placementComplete&&!this.placeOnWall?s.offsetHeight=A/_:A===0&&(this.placementComplete=!0,s.show=!1)}}s.updateOpacity(e),t.rotation.y=this.yawDamper.update(r,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const i=this.transientHitTestSource;if(!i||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const r=e.getHitTestResultsForTransientInput(i),s=this.presentedScene,o=s.scale.x;if(this.isTwoFingering)if(r.length<2)this.isTwoFingering=!1;else{const{separation:l,deltaYaw:u}=this.fingerPolar(r);if(this.placeOnWall||(this.goalYaw+=u),!s.userData.__scaleDisabled){const h=l/this.firstRatio;this.goalScale=h<1.3&&h>.7692307692307692?1:h}}else if(r.length!==2)if(this.isRotating&&!((t=this.inputSource)===null||t===void 0)&&t.gamepad){const l=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=l-this.lastAngle,this.lastAngle=l}else this.isTranslating&&(console.log("translating"),r.forEach(l=>{if(l.inputSource!==this.inputSource)return;let u=null;if(l.results.length>0&&(u=this.getHitPoint(l.results[0])),u==null&&(u=this.getTouchLocation()),u!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const h=u.y-this.lastDragPosition.y;if(h<0){this.placementBox.offsetHeight=h/o;const f=PS.copy(this.xr.getCamera().position),g=-h/(f.y-u.y);f.multiplyScalar(g),u.multiplyScalar(1-g).add(f)}}this.goalPosition.add(u),this.lastDragPosition.copy(u)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:l}=this.fingerPolar(r);this.firstRatio=l/o}}getTouchLocation(){var e,t;const{axes:i}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},r=this.placementBox.getExpandedHit(this.presentedScene,i[0],i[1]);return r!=null&&(PS.copy(r).sub((t=this.xr)===null||t===void 0?void 0:t.getCamera().position),PS.length()>10)?null:r}fingerPolar(e){var t,i,r,s,o,l;const u=(r=(i=(t=e[0].inputSource)===null||t===void 0?void 0:t.gamepad)===null||i===void 0?void 0:i.axes)!==null&&r!==void 0?r:[0,0],h=(l=(o=(s=e[1].inputSource)===null||s===void 0?void 0:s.gamepad)===null||o===void 0?void 0:o.axes)!==null&&l!==void 0?l:[0,0],f=h[0]-u[0],g=h[1]-u[1],_=Math.atan2(g,f);let A=this.lastAngle-_;return A>Math.PI?A-=2*Math.PI:A<-Math.PI&&(A+=2*Math.PI),this.lastAngle=_,{separation:Math.sqrt(f*f+g*g),deltaYaw:A}}}class cD{constructor(e,t,i,r,s){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=s,this.frameCallback=this.onXRFrame.bind(this);const o=t.xr.getSession();if(r&&"XRWebGLBinding"in window){const l=new p.oAp(16);e.environment=l.texture;const u=t.getContext();switch(o.preferredReflectionFormat){case"srgba8":u.getExtension("EXT_sRGB");break;case"rgba16f":u.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(o,u),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}o.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const r=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/r,i.primaryLightIntensity.y/r,i.primaryLightIntensity.z/r),this.xrLight.directionalLight.intensity=r,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class uD extends p.ZAu{constructor(e,t=!0){super(),this.lightProbe=new p.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new p.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,r=!1;e.xr.addEventListener("sessionstart",()=>{const s=e.xr.getSession();"requestLightProbe"in s&&s.requestLightProbe({reflectionFormat:s.preferredReflectionFormat}).then(o=>{i=new cD(this,e,o,t,()=>{r=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{i&&(i.dispose(),i=null),r&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var Bx,i_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Rp=Bx=class extends Si{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new e2,this.dependencies=[vr],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var a;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):this._xrManager?(this._xrManager.enabled=!0,(a=this._xrManager)===null||a===void 0||a.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{var a;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=((a=e.cameras)===null||a===void 0?void 0:a[0])||e,i=this._viewer.scene.activeCamera;i.cameraObject.projectionMatrix.copy(t.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var a,e;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const t=this._viewer.renderer,i=(e=(a=this._xrManager)===null||a===void 0?void 0:a.getCamera())===null||e===void 0?void 0:e.cameras[0].viewport;i?t.rendererObject.setViewport(i):console.warn("no viewport for ar camera"),this._viewer.getPlugin(vr).updateShaderProperties(r_.material),r_.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,Wt(t.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{r_.render(t.rendererObject,null,t.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:a,deltaTime:e})=>{var t,i;if(this.dirty=!!a&&((t=this._xrManager)===null||t===void 0?void 0:t.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,Bx.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!a)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const r=this._xrManager.getReferenceSpace(),s=a.getViewerPose(r);if(s==null&&this._frameCount,s==null||((i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(a),this._touchInputHelper.processInput(a),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new p.Pa4(1,1,1),modelPosition:new p.Pa4,modelRotation:new p._fP,cameraPosition:new p.Pa4(0,0,5),cameraTarget:new p.Pa4,cameraUp:new p.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectionMatrix:new p.yGw,cameraAutoNearFar:void 0,groundOffset:new p.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new p.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var a;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(a=this._viewer.scene.backgroundColor)===null||a===void 0?void 0:a.getHex();const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far,this._preXRState.cameraAutoNearFar=t.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectionMatrix.copy(t.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(this._preXRState.groundOffset.subVectors(e.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const a=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var t,i;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const r=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((i=(t=this._xrSession).requestHitTestSource)===null||i===void 0?void 0:i.call(t,{space:r,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async a=>{a.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new uD(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(a),this._xrSession=a},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(a){await super.onAdded(a);const e=a.renderer.rendererObject.xr;if(e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(a.addEventListener("preRender",this._preRender),a.addEventListener("postRender",this._postRender),a.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return a.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(t=>{if(!t)throw new Error("AR not supported")}).catch(t=>{a.console.error("AR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var a,e;if(!this._viewer)return;const t=this._viewer.scene.modelRoot,i=(e=(a=this._viewer.getPluginByType("Ground"))===null||a===void 0?void 0:a.mesh)===null||e===void 0?void 0:e.modelObject;i&&(i.rotation.z=this._viewer.scene.modelRoot.rotation.y,i.position.copy(this._preXRState.groundOffset).multiplyScalar(t.modelObject.scale.x).sub(t.modelObject.position).negate(),i.scale.setScalar(t.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(a){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=a.getHitTestResults(this._hitTestSource);if(!e.length)return;const t=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const i=this._touchInputHelper.getHitPoint(t);if(!i)return;this._placementBox.show=!0;const r=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(i),r.position.copy(i),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var a,e;const t=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera,r=(a=this._xrManager)===null||a===void 0?void 0:a.getCamera(),s=r.cameras[0]||r;this._removePlacementBox();const o=this._viewer.scene.getBounds(!0,!0);o.getSize(new p.Pa4).length()>.01&&(this._placementBox=new $T(o,r,this.placeOnWall),t.add(this._placementBox),this._placementBox.show=!1);const l=r.getWorldDirection(new p.Pa4);t.rotation.y=Math.atan2(-l.x,-l.z)-0,i.cameraObject.zoom=s.zoom,i.cameraObject.near=s.near,i.cameraObject.far=s.far,i.cameraObject.userData.autoNearFar=!1,i.cameraObject.isPerspectiveCamera?(i.cameraObject.fov=s.fov,i.cameraObject.aspect=s.viewport.width/s.viewport.height):console.warn("Perspective camera required."),i.cameraObject.updateProjectionMatrix();const u=t.userData.arScale||1;t.scale.set(u,u,u),t.position.copy(r.position).add(l.multiplyScalar(5)),t.visible=!0;const h=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Ground");h!=null&&h.mesh&&(h.shadowBaker.enabled=!1,h.renderToDepth=!1)}_restorePreXRState(){var a;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,Bx.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((a=this._viewer.scene.backgroundColor)===null||a===void 0||a.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(t.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectionMatrix),t.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectionMatrix).invert(),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(i.mesh.modelObject.position.subVectors(e.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};Rp.PluginType="WEBXR_ARPlugin",i_([Ot("Light Estimate")],Rp.prototype,"estimateLighting",void 0),i_([Ot("Place on Wall")],Rp.prototype,"placeOnWall",void 0),i_([ai("Resilution scale",[.1,1],.1)],Rp.prototype,"xrResolutionScale",void 0),i_([Xi("Enter AR")],Rp.prototype,"enterAR",void 0),i_([Xi("Exit AR")],Rp.prototype,"exitAR",void 0),Rp=Bx=i_([zi("WebXR AR")],Rp);const r_=new On({vertexShader:Ke.vertexShader,fragmentShader:`
        ${ha}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...Ke.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});r_.renderToScreen=!1,r_.useExistingRenderTarget=!0,r_.clear=!1;var Ox,Lx=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let sm=Ox=class extends Si{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[vr],this.xrResolutionScale=1,this.toJSON=void 0,this.enterVR=()=>{var a;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already inVR"):this._xrManager?(this._xrManager.enabled=!0,(a=this._xrManager)===null||a===void 0||a.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitVR=()=>{this._xrSession&&this._xrSession.end()},this._currentCameraIndex=0,this._preRender=()=>{var a;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=((a=e.cameras)===null||a===void 0?void 0:a[this._currentCameraIndex])||e,i=this._viewer.scene.activeCamera;i.cameraObject.zoom=t.zoom,i.cameraObject.near=t.near,i.cameraObject.far=t.far,i.cameraObject.userData.autoNearFar=!1,i.cameraObject.isPerspectiveCamera?(i.cameraObject.fov=t.fov,i.cameraObject.aspect=t.viewport.width/t.viewport.height):console.warn("Perspective camera required."),i.cameraObject.position.copy(t.position),i.cameraObject.rotation.copy(t.rotation),i.cameraObject.updateMatrix(),i.cameraObject.updateProjectionMatrix(),i.cameraObject.projectionMatrix.copy(t.projectionMatrix),i.cameraObject.projectionMatrixInverse.copy(i.cameraObject.projectionMatrix).invert()},this._currentRt=null,this._postRender=()=>{var a,e,t,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const r=this._viewer.renderer,s=(r.rendererObject.getViewport(new p.Ltg),(t=(e=(a=this._xrManager)===null||a===void 0?void 0:a.getCamera())===null||e===void 0?void 0:e.cameras)!==null&&t!==void 0?t:[]),o=r.rendererObject.getRenderTarget(),l=(i=s[this._currentCameraIndex])===null||i===void 0?void 0:i.viewport;l?o&&r.rendererObject.setViewport(l):console.warn("no viewport for vr camera index",this._currentCameraIndex),this._viewer.getPlugin(vr).updateShaderProperties(n_.material),n_.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,Wt(r.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{n_.render(r.rendererObject,null,r.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0,o&&r.rendererObject.setViewport(o.viewport),this._currentCameraIndex++,this._currentCameraIndex>=s.length&&(this._currentCameraIndex=0)},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:a,deltaTime:e})=>{var t,i;if(this.dirty=!!a&&((t=this._xrManager)===null||t===void 0?void 0:t.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,Ox.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!a)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: VR session init"),this._frameCount++;const r=this._xrManager.getReferenceSpace(),s=a.getViewerPose(r);if(s==null&&this._frameCount,s==null||((i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this._viewer.rendersPerFrame=s?s.views.length:1,this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new p.Pa4(1,1,1),modelPosition:new p.Pa4,modelRotation:new p._fP,cameraPosition:new p.Pa4(0,0,5),cameraTarget:new p.Pa4,cameraUp:new p.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new p.yGw,cameraAutoNearFar:void 0,groundOffset:new p.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new p.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var a;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(a=this._viewer.scene.backgroundColor)===null||a===void 0?void 0:a.getHex();const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far,this._preXRState.cameraAutoNearFar=t.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(t.cameraObject.projectionMatrix);const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(this._preXRState.groundOffset.subVectors(e.position,i.mesh.modelObject.position),this._preXRState.groundScale=i.mesh.modelObject.scale.x,this._preXRState.groundRotation=i.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=i.renderToDepth,this._preXRState.groundShadowBaker=i.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.environment),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{this._xrSession&&this._viewer&&(console.log("webxr: VR session start"),this._viewer.renderer.stableNoise=!0,this._viewer.resize())},this._xrRenderingEnd=()=>{console.log("webxr: VR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async a=>{a.addEventListener("end",this._onSessionEnded),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(a),this._xrSession=a},this._onSessionEnded=()=>{this._xrSession&&this._xrSession.removeEventListener("end",this._onSessionEnded)}}async onAdded(a){await super.onAdded(a);const e=a.renderer.rendererObject.xr;if(e.cameraAutoUpdate=!1,this._xrManager=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(a.addEventListener("preRender",this._preRender),a.addEventListener("postRender",this._postRender),a.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return a.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then(t=>{if(!t)throw new Error("VR not supported")}).catch(t=>{a.console.error("VR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var a,e;if(!this._viewer)return;const t=this._viewer.scene.modelRoot,i=(e=(a=this._viewer.getPluginByType("Ground"))===null||a===void 0?void 0:a.mesh)===null||e===void 0?void 0:e.modelObject;i&&(i.rotation.z=this._viewer.scene.modelRoot.rotation.y,i.position.copy(this._preXRState.groundOffset).multiplyScalar(t.modelObject.scale.x).sub(t.modelObject.position).negate(),i.scale.setScalar(t.modelObject.scale.x*this._preXRState.groundScale))}_preSetupModel(){var a;const e=this._viewer.scene.modelRoot,t=e.userData.arScale||1;e.scale.set(t,t,t),e.visible=!0;const i=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("Ground");i!=null&&i.mesh&&(i.shadowBaker.enabled=!1,i.renderToDepth=!1)}_restorePreXRState(){var a;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,Ox.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((a=this._viewer.scene.backgroundColor)===null||a===void 0||a.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(t.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),t.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix();const i=this._viewer.getPluginByType("Ground");i!=null&&i.mesh&&(i.mesh.modelObject.position.subVectors(e.position,this._preXRState.groundOffset),i.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),i.mesh.modelObject.rotation.z=this._preXRState.groundRotation,i.renderToDepth=this._preXRState.groundRenderToDepth,i.shadowBaker.enabled=this._preXRState.groundShadowBaker,i.refreshTransform()),this._viewer.scene.environment=this._preXRState.environment,this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){}};sm.PluginType="WEBXR_VRPluginBasic",Lx([ai("Resolution scale",[.1,1],.1)],sm.prototype,"xrResolutionScale",void 0),Lx([Xi("Enter VR")],sm.prototype,"enterVR",void 0),Lx([Xi("Exit VR")],sm.prototype,"exitVR",void 0),sm=Ox=Lx([zi("WebXR VR")],sm);const n_=new On({vertexShader:Ke.vertexShader,fragmentShader:`
        ${ha}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...Ke.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});n_.renderToScreen=!1,n_.useExistingRenderTarget=!0,n_.clear=!1;class kx extends V.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=i=>{i.data&&i.data.size>0&&this._currentRecording.push(i.data)},this._canvas=e,t==null||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class t2 extends kx{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const t=[];for(const i of e){const r=await this._imgDirectory.getFileHandle(i[0],{create:!0});t.push((0,V.writeFile)(r,i[1]))}await Promise.all(t)}}class Tb extends kx{_setOptions(e){var t,i;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=(t=Tb.GetSupportedMimeTypes([],["h264"],!0))!==null&&t!==void 0?t:Tb.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!(!((i=this.options.mimeType)===null||i===void 0)&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(e,t),this._resumeSyncTime=0,this._onstop=i=>{var r;if(this._recorder&&this._currentRecording.length>0){const s=new Blob(this._currentRecording,{type:this.options.mimeType});(r=this._recordingCallback)===null||r===void 0||r.call(this,s)}this._recorder=void 0,this.setState("stopped")},this._onstart=i=>{var r;this._frameCount=0,this.options.stepMode&&((r=this._recorder)===null||r===void 0||r.pause()),this.setState("recording")},this._onresume=i=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const r=()=>{var o;this.state==="recording"&&((o=this._recorder)===null||o===void 0||o.pause())},s=Math.min(this._resumeSyncTime-(0,V.now)(),0)+1e3/this.options.frameRate;s>0?(0,V.timeout)(s).then(r):r()},this._onerror=i=>{this.setState("error",{error:i}),this._console.error(i),this._recorder=void 0}}start(){var e,t,i;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const r={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(e=r.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const s=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),o=(t=s.getVideoTracks())===null||t===void 0?void 0:t[0];this._track=o,this._recorder=new window.MediaRecorder(s,r),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((i=this._recorder)===null||i===void 0||i.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,V.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,i=!1){if(!window.MediaRecorder)return i?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter(l=>!e||e.length<1||e.includes(l)),s=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(l=>!t||t.length<1||t.includes(l)),o=[];return r.forEach(l=>{const u=`video/${l}`;s.forEach(h=>{[`${u};codecs=${h}`,`${u};codecs:${h}`,`${u};codecs=${h.toUpperCase()}`,`${u};codecs:${h.toUpperCase()}`,`${u}`].forEach(f=>{MediaRecorder.isTypeSupported(f)&&o.push(f)})})}),i?o.length>0?o[0]:void 0:o}}class s_ extends kx{constructor(e,t){super(e,t),this._workerRunning=!1,this.worker=new Worker((0,V.remoteWorkerURL)(s_.LIBRARY_PATH+"ffmpeg-worker-mp4.js",s_.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=i=>{var r;const s=i.data;switch(s.type){case"stdout":case"stderr":if(s.data.indexOf("frame=")===0){const o=parseInt(s.data.split("frame=")[1].split("fps")[0].trim()),l=this._frameCount,u=Math.round(o/l*100);this.dispatchEvent({type:"encode-progress",progress:u,frame:o,totalFrames:l})}console.log(s.data+`
`);break;case"exit":console.log("Process exited with code "+s.data),parseInt(s.data);break;case"done":if(s.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(r=this._recordingCallback)===null||r===void 0||r.call(this,new Blob([s.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),i=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",i,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})},"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}s_.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var RS=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class zl extends Si{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!0,this.mimeType="video/mp4",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,i;if(this.convergeMode&&!((e=this._recorder)===null||e===void 0)&&e.isRecording()){const r=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((i=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||i===void 0?void 0:i.isConverged())||!1,r&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,i;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((i=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||i===void 0)&&i.isConverged(!0))){const r=()=>{var s;return(s=this._recorder)===null||s===void 0?void 0:s.requestFrame()};this.convergeMode?(0,V.timeout)(1).then(r):r()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)===null||e===void 0||e.map(t=>(0,V.getOrCall)(t)).flat(2).forEach(t=>{var i;return(i=t==null?void 0:t.uiRefresh)===null||i===void 0?void 0:i.call(t)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e,t;return(t=(e=this.recorder)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:"not initialized"}},{type:"button",label:()=>{var e;return!((e=this.recorder)===null||e===void 0)&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;!((e=this.recorder)===null||e===void 0)&&e.isRecording()?this.stopRecording().then(async t=>{if(t){const i=t.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(t,i)}}):this.startRecording()}},{type:"button",label:"Record Camera Views",hidden:()=>{var e,t;return!!(!((e=this.recorder)===null||e===void 0)&&e.isRecording())||!(!((t=this._viewer)===null||t===void 0)&&t.getPluginByType("CameraViews"))},value:()=>{var e,t;(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("CameraViews"))===null||t===void 0||t.recordAllViews()}},{type:"button",label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,i,r;return!!(!((e=this.recorder)===null||e===void 0)&&e.isRecording())||!(!((t=this._viewer)===null||t===void 0)&&t.getPluginByType("CameraViews"))||!(!((r=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||r===void 0)&&r.animations.length)},value:()=>{var e,t,i,r;const s=((t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("GLTFAnimation"))===null||t===void 0?void 0:t.animationState)==="playing";(r=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||r===void 0||r.recordAllViews(()=>{var o,l;(l=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||l===void 0||l.playAnimation()}).then(()=>{var o,l;s||(l=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||l===void 0||l.stopAnimation()})}},{type:"button",label:"Record GLTF Anim",hidden:()=>{var e,t,i;return!!(!((e=this.recorder)===null||e===void 0)&&e.isRecording())||!(!((i=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("GLTFAnimation"))===null||i===void 0)&&i.animations.length)},value:async()=>{var e,t;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return;const i=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("GLTFAnimation");if(!i)return;let r=!1;i.loopAnimations&&(r=!0),r&&(i.loopAnimations=!1);const s=await this.record(async()=>i.playAnimation());if(r&&(i.loopAnimations=!0),s){const o=s.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(s,o)}}},{type:"button",label:"Record 360 animation",hidden:()=>{var e;return!!(!((e=this.recorder)===null||e===void 0)&&e.isRecording())},value:async()=>this.download360Recording(null,!1)},{type:"button",label:"Record 360 animation (CCW)",hidden:()=>{var e;return!!(!((e=this.recorder)===null||e===void 0)&&e.isRecording())},value:async()=>this.download360Recording(null,!0)}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e,t;return(t=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&t!==void 0&&t}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(t=e.canvas.parentElement)===null||t===void 0||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var t,i;this.dirty=e,(t=this._viewer)===null||t===void 0||t.setDirty(),(i=this.uiConfig.children)===null||i===void 0||i.map(r=>(0,V.getOrCall)(r)).flat(2).forEach(r=>{var s;return(s=r==null?void 0:r.uiRefresh)===null||s===void 0?void 0:s.call(r)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(t=this._recorder)===null||t===void 0||t.dispose(),Object.values(this._recorders).forEach(i=>{i==null||i.dispose()}),super.onRemove(e)}async record(e,t){var i,r;if(!this.enabled||!((i=this._recorder)===null||i===void 0)&&i.isRecording())return;const s=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("Progressive"),o=s==null?void 0:s.maxFrameCount;s&&this.convergeMode&&(s.maxFrameCount=Math.min(16,o??16)),await new Promise((u,h)=>{const f=()=>{this.removeEventListener("start",g),this.removeEventListener("stop",f),this.removeEventListener("error",_)},g=async()=>{f(),t==null||t(),await e(),u()},_=async()=>{f(),h()};this.addEventListener("start",g),this.addEventListener("stop",f),this.addEventListener("error",_),this.startRecording()});const l=await this.stopRecording();return s&&this.convergeMode&&(s.maxFrameCount=o??16),l}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((t,i)=>{var r;return(r=this.recorder)===null||r===void 0?void 0:r.stop(t)})}async _downloadBlob(e,t){var i,r,s;const o=await((i=this._viewer)===null||i===void 0?void 0:i.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),l=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("FileTransferPlugin");l?await l.exportFile(e,o||"recording.mp4"):(s=this._viewer)===null||s===void 0||s.console.error("FileTransferPlugin required to export/download file")}async download360Recording(e=null,t=!1){var i;if(!((i=this.recorder)===null||i===void 0)&&i.isRecording()||!this._viewer)return;const r=e||await this._viewer.prompt("Enter duration in seconds","5",!0);if(r===null)return;const s=parseFloat(r||"5");if(!isFinite(s)||s<=0)return;const o=await this.recordCamera360(s,t);if(o){const l=o.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(o,l)}}async recordCamera360(e,t=!1){var i;if(!((i=this.recorder)===null||i===void 0)&&i.isRecording()||!this._viewer)return;const r=this._viewer.scene.activeCamera;let s=r.interactionsEnabled,o=0;for(;!(s||(this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),o%30==0&&this._viewer.console.warn("CanvasRecorderPlugin: interactions are already disabled by something, waiting..."),s=r.interactionsEnabled,o>5e3/30));)o++;r.setInteractions(!1,zl.PluginType);const l=r.target.clone(),u=r.position.clone().sub(l),h=await this._viewer.getPluginByType("PopmotionPlugin");if(!h)return void console.error("Popmotion plugin not found");const f=new p.$V().setFromVector3(u);r.position.setFromSpherical(f).add(l),r.positionUpdated(!0);const g=r.autoLookAtTarget;r.autoLookAtTarget=!0;const _=await this.record(async()=>h.animate({from:f.theta,to:f.theta+2*Math.PI*(t?-1:1),duration:1e3*e,ease:el.linear,onUpdate:A=>{f.theta=A,r.position.setFromSpherical(f).add(l),r.positionUpdated(!0)}}).promise);return r.autoLookAtTarget=g,r.position.copy(u).add(l),r.positionUpdated(!0),r.setInteractions(!0,zl.PluginType),_}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t=e==="canvas-media"?new Tb(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new s_(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new t2(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",()=>this._stateChange(!1)),t.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),t.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),t.addEventListener("paused",()=>this._stateChange(!1)),t.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),t.addEventListener("encode-progress",i=>{this.dispatchEvent({...i})}),this._recorders[e]=t,t}}zl.PluginType="CanvasRecorder",RS([(0,V.onChange)(zl.prototype.refreshRecorderOptions),ae()],zl.prototype,"convergeMode",void 0),RS([(0,V.onChange)(zl.prototype.refreshRecorderOptions),ae()],zl.prototype,"mimeType",void 0),RS([(0,V.onChange)(zl.prototype.refreshRecorderOptions),ae()],zl.prototype,"videoFrameRate",void 0);var Ux=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const DS=new p.jyz({name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});DS.depthTest=!1;const BS=new p.jyz({name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});BS.depthTest=!1;class Dc extends Do{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new p.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Cc)}async onAdded(e){const t=e.renderer.createTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:p.wem,magFilter:p.wem});t.texture.name="groundContactDepthTexture";const i=new p.lRF({depthPacking:p.z81});i.onBeforeCompile=function(s){s.uniforms.opacity.value=1,s.fragmentShader=`
						${s.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const r=new sf(t,i,new p.Ilk(0,0,0),0);this._depthPass=r,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:p.ywz,format:p.wk1,colorSpace:p.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:p.wem,magFilter:p.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(DS.uniforms.h.value=t*this.blurAmount/256,BS.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:DS,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:BS,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){var t,i,r;const s=(t=this._depthPass)===null||t===void 0?void 0:t.target;return s&&((i=this._viewer)===null||i===void 0||i.renderer.disposeTarget(s)),(r=this._depthPass)===null||r===void 0||r.dispose(),this._depthPass=void 0,super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new p.Pa4)),this.shadowCamera.setRotationFromEuler(new p.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function i2(a,e,t,i){a.traverse(r=>{r&&(r.userData.cloneRotI=e,r.userData.rotationCount=t,r.userData.rotationAxis=i,r.addEventListener("beforeRender",s=>function(o,l){var u;l&&!((u=l.map)===null||u===void 0)&&u.isTexture&&(l.extraUniformsToUpload||(l.extraUniformsToUpload={}),l.extraUniformsToUpload.uvTransform||(l.extraUniformsToUpload.uvTransform={value:new p.Vkp}),l.extraUniformsToUpload.uvTransform.value.setUvTransform(l.map.offset.x*l.map.repeat.x*o.userData.cloneRotI/(o.userData.rotationCount||1),l.map.offset.y*l.map.repeat.y*o.userData.cloneRotI/(o.userData.rotationCount||1),l.map.repeat.x,l.map.repeat.y,l.map.rotation,l.map.center.x,l.map.center.y))}(r,s.material)))})}function r2(a,e,t,i="x"){var r;if(a.userData.rotationCount>1&&!a.userData.rotationRoot)return a;const s=a.parent;if(!s)throw new Error("No parent");if(a.userData.cloneParent){const l=a.userData.cloneParent;if(!(a=s.children.find(u=>l===u.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",l,s),a}let o=s.children.filter(l=>{var u;return((u=l.userData)===null||u===void 0?void 0:u.cloneParent)===a.uuid}).sort((l,u)=>l.userData.cloneRotI-u.userData.cloneRotI);if(a.userData.rotationCount===e&&e===o.length&&t===void 0&&a.userData.rotationAxis===i)return a;if(t==null&&(t=(r=a.userData.rotationSkips)!==null&&r!==void 0?r:[]),t!==a.userData.rotationSkips&&(a.userData.rotationSkips=[...t]),i2(a,0,e,i),a.userData.rotationRoot=!0,a.visible=!0,e<=o.length){for(let l=e-1;l<o.length;l++)s.remove(o[l]),o[l].traverse(u=>u.userData={__disposed:!0});o=o.slice(0,e)}for(let l=1;l<e;l++){const u=l<=o.length?o[l-1]:a.clone();u.rotation.copy(a.rotation),u.rotation[i]+=l/e*Math.PI*2,i2(u,l,e,i),l>o.length&&s.add(u),u.visible=!t.includes(l)}return a.visible=!t.includes(0),a}Dc.PluginType="ContactShadowGroundPlugin",Ux([(0,V.onChange)(Dc.prototype.refreshOptions),ae()],Dc.prototype,"contactShadows",void 0),Ux([ae(),(0,V.onChange)(Dc.prototype._setDirty)],Dc.prototype,"blurAmount",void 0),Ux([ae(),(0,V.onChange)(Dc.prototype._refreshShadowCameraFrustum)],Dc.prototype,"shadowScale",void 0),Ux([ae(),(0,V.onChange)(Dc.prototype._refreshShadowCameraFrustum)],Dc.prototype,"shadowHeight",void 0);var a_,Ib=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let ih=a_=class extends Si{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(a=!0){super(),this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.enabled=a}_selectedObjectChanged(){var a,e,t,i,r,s,o,l,u;if(!this.enabled)return;const h=(e=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!h)return void((i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0));const f=h.userData.rotationRoot&&(r=h.userData.rotationCount)!==null&&r!==void 0?r:1;this.rotations=f,this.skips=(o=(s=h.userData.rotationSkips)===null||s===void 0?void 0:s.join(","))!==null&&o!==void 0?o:"",this.axis=h.userData.rotationAxis||"x",(u=(l=this.uiConfig).uiRefresh)===null||u===void 0||u.call(l,"postFrame",!0)}_paramsChanged(){var a,e,t,i,r,s;if(!this.enabled)return;const o=(e=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(o){if(this.rotations>1||o.userData.rotationCount){const l=o.userData.rotationCount,u=r2(o,this.rotations,this.skips.split(",").map(f=>parseInt(f)).filter(f=>isFinite(f)),this.axis),h=u==null?void 0:u.userData.rotationCount;if(h&&h!==l){const f=[];u==null||u.traverseAncestors(g=>{f.push(g)});for(const g of f)if(g.userData.autoScaled){mi(g),(t=this._viewer)===null||t===void 0||t.resetCamera({rootObject:g,centerOffset:new p.Pa4(4,4,4)});break}}o.parent&&!o.userData.__disposed||(r=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"))===null||r===void 0||r.setSelectedObject(u,!0)}(s=this._viewer)===null||s===void 0||s.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ih.PluginType="ObjectRotationPlugin",Ib([ae(),Ot("Enabled"),(0,V.onChange)(a_.prototype._paramsChanged)],ih.prototype,"enabled",void 0),Ib([ai("Rotation Count",[1,100],1,a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!a.rotations}})),(0,V.onChange)(a_.prototype._paramsChanged)],ih.prototype,"rotations",void 0),Ib([Fs("Axis",["x","y","z"].map(a=>({label:a})),a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!a.rotations}})),(0,V.onChange)(a_.prototype._paramsChanged)],ih.prototype,"axis",void 0),Ib([Ci("Rotation Skips",a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!a.rotations}})),(0,V.onChange)(a_.prototype._paramsChanged)],ih.prototype,"skips",void 0),ih=a_=Ib([zi("Object Rotations")],ih);var $g,o_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let lu=$g=class extends Si{constructor(a=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,i)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const r of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=Mi(e.fragmentShader,`#include <${r}>`,p.WdD[r].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=Mi(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=Mi(e.fragmentShader,"#include <normal_fragment_maps>",Mi(Mi(p.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)===null||t===void 0?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},i)=>{if(this.enabled)for(const[r,s]of Object.entries(this._defines)){const o=typeof s=="number"?s:s?1:0;t.defines[r]!==o&&(t.defines[r]=o,t.needsUpdate=!0)}}},this.dependencies=[Ut],this.enabled=a,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var a,e,t;(e=(a=this._bumpMapExtension)===null||a===void 0?void 0:a.setDirty)===null||e===void 0||e.call(a),(t=this._viewer)===null||t===void 0||t.setDirty()}async onAdded(a){var e,t;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(a)}async onRemove(a){var e,t;return(t=(e=a.getPlugin(Ut))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(a)}};lu.PluginType="ReliefParallaxMapping",o_([(0,V.onChange)($g.prototype._updateExtension),ae(),Ot("Enabled")],lu.prototype,"enabled",void 0),o_([(0,V.onChange)($g.prototype._updateExtension),Ot("Debug Normals")],lu.prototype,"debugNormals",void 0),o_([(0,V.onChange)($g.prototype._updateExtension),Ot("Debug Hit Height")],lu.prototype,"debugHitHeight",void 0),o_([oe("PARALLAX_MAP_STEPS",void 0,!0,$g.prototype._updateExtension),ai("Step count",[1,32],1),ae()],lu.prototype,"stepCount",void 0),o_([oe("PARALLAX_MAP_B_STEPS",void 0,!0,$g.prototype._updateExtension),ai("Binary search steps",[1,8],1),ae()],lu.prototype,"binaryStepCount",void 0),lu=$g=o_([zi("Parallax Mapping")],lu);class OS extends p.u9r{constructor(e,t,i=32,r=64,s=!1,o=new p.FM8(1,1),l="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:i,tubularSegments:r,closed:s,primary:l,shapeScale:o.clone()};const u=t.computeFrenetFrames(r,s);this.frames=u;const h=new p.Pa4,f=new p.Pa4,g=new p.Pa4,_=new p.FM8;let A=new p.Pa4;const x=[],E=[],T=[],R=e.getSpacedPoints(i);for(const O of R)O.multiply(o);(function(){for(let O=0;O<r;O++)S(O);S(s===!1?r:0),function(){for(let O=0;O<=r;O++)for(let k=0;k<=i;k++)_.x=O/r,_.y=k/i,E.push(_.x,_.y)}(),function(){const O=l==="shape",k=O?i:r,N=O?r:i;for(let H=1;H<=k;H++)for(let X=1;X<=N;X++){const[te,re]=O?[X,H]:[H,X],ue=(i+1)*(te-1)+(re-1),le=(i+1)*te+(re-1),se=(i+1)*te+re,de=(i+1)*(te-1)+re;T.push(ue,le,de),T.push(le,se,de)}}()})(),this.setIndex(T),this.setAttribute("position",new p.a$l(x,3)),this.setAttribute("uv",new p.a$l(E,2)),this.computeVertexNormals();const I=this.attributes.normal;function S(O){A=t.getPointAt(O/r,A);const k=u.normals[O],N=u.binormals[O];for(let H=0;H<=i;H++){const X=R[H%i];f.set(0,0,0).addScaledVector(k,X.x).addScaledVector(N,X.y),h.copy(A).add(f),x.push(h.x,h.y,h.z)}}(function(){for(let k=1;k<i;k++){const N=k+r*(i+1);f.fromBufferAttribute(I,k),g.fromBufferAttribute(I,N),f.add(g).normalize(),I.setXYZ(k,f.x,f.y,f.z),I.setXYZ(N,f.x,f.y,f.z)}for(let k=1;k<r;k++){const N=k*(i+1),H=N+i;f.fromBufferAttribute(I,N),g.fromBufferAttribute(I,H),f.add(g).normalize(),I.setXYZ(N,f.x,f.y,f.z),I.setXYZ(H,f.x,f.y,f.z)}f.fromBufferAttribute(I,0),g.fromBufferAttribute(I,i),f.add(g);const O=r*(i+1);g.fromBufferAttribute(I,O),f.add(g),g.fromBufferAttribute(I,O+i),f.add(g),f.normalize(),I.setXYZ(0,f.x,f.y,f.z),I.setXYZ(i,f.x,f.y,f.z),I.setXYZ(O,f.x,f.y,f.z),I.setXYZ(O+i,f.x,f.y,f.z),I.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,i=this.index.count,r=[...e,1].sort((l,u)=>l-u);let s=0,o=0;for(const l of r){const u=Math.round(t*l)*i/t;this.addGroup(s,u-s,o++),s=u}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var LS,am=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Vl=LS=class extends Si{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new p.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var a,e;const t=(e=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(fr))===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;let i=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!i)return;i=parseFloat(i);const r=new kS(0,0,i,i,0,2*Math.PI,!0,0);await this.extrudeObject(t,r)}}async onAdded(a){await super.onAdded(a)}static CreateCurve(a,e){var t,i;if(a==="circle")return new kS(0,0,(t=e.radius)!==null&&t!==void 0?t:1,(i=e.radius)!==null&&i!==void 0?i:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(a,e,t=this.shapeSegments,i=this.tubularSegments,r=this.shapeScale,s=this.materialSplits.split(",").map(l=>parseFloat(l.trim())),o=this.horizontalSplits){var l,u,h,f,g,_,A,x;if(a.userData.isExtrudedTube,a.userData._extrudeSource){const O=a.userData._extrudeSource;if(a=(l=a.parent)===null||l===void 0?void 0:l.children.find(k=>O===k.uuid),!a)return void console.warn("Could not find extrude source with uuid",O)}if(a.userData.extrudedObject){const O=a.userData.extrudedObject,k=(u=a.parent)===null||u===void 0?void 0:u.children.find(N=>O===N.uuid);k&&(k.removeFromParent(),k.geometry.dispose(),k.geometry=null,k.material=null),delete a.userData.extrudedObject}const E=a.geometry;if(!E)return void((h=this._viewer)===null||h===void 0||h.alert("Extrude: No geometry to extrude"));const T=[a.material];let R;try{const O=LS.ConvertGeometryToFlatShape(E);R=new OS(O,e,t,i,!0,r,o?"shape":"path"),R.computeBoundingBox(),R.createSplits(s)}catch(O){return void((f=this._viewer)===null||f===void 0||f.alert(typeof O=="string"?O:O==null?void 0:O.message))}T[0].color.set(16777215);for(let O=T.length;O<R.groups.length;O++){const k=T[0].clone();T.push(k),k.color.set(16777215*Math.random())}const I=new p.Kj0(R,T);I.userData._extrudeSource=a.uuid,I.userData.isExtrudedTube=!0,a.visible=!1,a.userData.bboxVisible=!1,I.name=a.name+"_extruded";const S=await((A=(_=(g=this._viewer)===null||g===void 0?void 0:g.getManager())===null||_===void 0?void 0:_.importer)===null||A===void 0?void 0:A.processImportedSingle(I,{autoCenter:!1,autoScale:!1}));S&&((x=a.parent)===null||x===void 0||x.add(S.modelObject),a.userData.extrudedObject=S.modelObject.uuid,S.dispatchEvent({type:"select",ui:!0,value:S}))}static ExtrudeShape(a,e,t,i,r,s,o,l){const u=new OS(a,i,e,t,!0,new p.FM8(r,s),l?"shape":"path");u.computeBoundingBox(),u.createSplits(o);const h=new p.Kj0(u,[]);return h.userData.isExtrudedTube=!0,h}static ConvertGeometryToFlatShape(a,e=!0){if(a.userData.__planarShape)return a.userData.__planarShape;let t=a.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const i=a;t=i.attributes.position,i.boundingBox||i.computeBoundingBox();const r=i.boundingBox.getSize(new p.Pa4),s=r.x<.001?"x":r.y<.001?"y":r.z<.001?"z":null;if(!s)throw"geometry is not axis aligned not planar";let o=[];for(let u=0;u<t.count;u++){const h=new p.FM8;s==="x"?h.set(t.getY(u),t.getZ(u)):s==="y"?h.set(t.getX(u),t.getZ(u)):h.set(t.getX(u),t.getY(u)),o.push(h)}if(e){let u=0;for(let h=0;h<o.length;h++)(o[h].x<o[u].x||o[h].x===o[u].x&&o[h].y<o[u].y)&&(u=h);u!==0&&(o=o.slice(u).concat(o.slice(0,u)))}const l=new p.bnF(o);return a.userData.__planarShape=l,l}};Vl.PluginType="ShapeTubeExtrudePlugin",am([Ot("Enabled")],Vl.prototype,"enabled",void 0),am([ai("Shape Segments (X)",[1,100],1,a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"shapeSegments",void 0),am([ai("Tube Segments (Y)",[1,100],1,a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"tubularSegments",void 0),am([Mn("Shape scale",[.01,10],.01,a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"shapeScale",void 0),am([Ci("Material Splits",a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"materialSplits",void 0),am([Ot("Horizontal Splits",a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"horizontalSplits",void 0),am([Xi("Extrude Circle Tube",a=>({hidden:()=>{var e,t;return!(!((t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0)&&t.getSelectedObject())}}))],Vl.prototype,"extrudeCirceTube",void 0),Vl=LS=am([zi("Extrude Tube Shapes")],Vl);class kS extends p.Ny0{getPoint(e,t){return super.getPoint(e,t||new p.Pa4)}}class om extends Si{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var t,i;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))===null||t===void 0||t.enable(om.PluginType),this._fadeDisabled=!1));const r=(0,V.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/60);let s=r-this._lastFrameTime;this._lastFrameTime=r;const o=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(o&&o>0&&(s=o),o!==0&&(s*=1e3,!(s<=.001)&&(this._updaters.forEach(l=>{let u=s;l.time+u<0&&(u=-l.time),l.time+=u,Math.abs(u)>.001&&l.u(u)}),!this._fadeDisabled&&this.disableFrameFade))){const l=this._viewer.getPluginByType("FrameFade");l&&(l.disable(om.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=Wn(),i={id:t,options:e,stop:()=>{var r,s,o;!((r=this.animations[t])===null||r===void 0)&&r._stop?(o=(s=this.animations[t])===null||s===void 0?void 0:s._stop)===null||o===void 0||o.call(s):console.warn("Animation not started")}};return this.animations[t]=i,i.promise=new Promise((r,s)=>{const o={driver:this.defaultDriver,...e,onComplete:()=>{var u;try{(u=e.onComplete)===null||u===void 0||u.call(e)}catch(h){return void s(h)}r()},onStop:()=>{var u;try{(u=e.onStop)===null||u===void 0||u.call(e)}catch(h){return void s(h)}r()}},l=qf(o);this.animations[t]._stop=l.stop,this.animations[t].options=o}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}om.PluginType="PopmotionPlugin";var US,rh,hs=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const Bo=a=>({onChange:e=>{e.last&&a.onChange()}});let la=US=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(a){Object.assign(this,a)}reset(){const a=this.onChange;Object.assign(this,new US),this.onChange=a}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};hs([Ci("Text",Bo)],la.prototype,"text",void 0),hs([ai("Font Size",[2,400],1,Bo)],la.prototype,"fontSize",void 0),hs([ai("Width",[2,4096],1,Bo)],la.prototype,"width",void 0),hs([ai("Height",[2,4096],1,Bo)],la.prototype,"height",void 0),hs([ai("X Offset",[-1024,1024],1,Bo)],la.prototype,"xOffset",void 0),hs([ai("Y Offset",[-1024,1024],1,Bo)],la.prototype,"yOffset",void 0),hs([ai("V-Width",[2,4096],1,Bo)],la.prototype,"boxWidth",void 0),hs([ai("V-Height",[2,4096],1,Bo)],la.prototype,"boxHeight",void 0),hs([Fs("Text Anchor",["start","middle","end"].map(a=>({label:a})),Bo)],la.prototype,"textAnchor",void 0),hs([Ci("Font",Bo)],la.prototype,"fontFamily",void 0),hs([Ci("Font Url",Bo)],la.prototype,"fontPath",void 0),hs([Ot("Mask Text",Bo)],la.prototype,"maskText",void 0),hs([Ot("Inner Shadow",Bo)],la.prototype,"innerShadow",void 0),hs([ea("Text Color",Bo)],la.prototype,"textColor",void 0),hs([ea("BG Fill",Bo)],la.prototype,"bgFillColor",void 0),hs([ea("SVG BG",Bo)],la.prototype,"svgBackground",void 0),la=US=hs([zi("Text SVG Options")],la);const n2={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},Pb=a=>({hidden:()=>{const e=a.getSelected();return!e||!e.userData[Gl.PluginType]}});let Gl=rh=class extends Si{async onAdded(a){var e;await super.onAdded(a),(e=a.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var a,e;return(e=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new la,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var a,e,t,i,r,s;if(!this.enabled)return;const o=this.getSelected();if(!o)return void((e=(a=this.uiConfig).uiRefresh)===null||e===void 0||e.call(a,"postFrame",!0));const l=o.userData[rh.PluginType];if(!l)return this.options.reset(),this._lastMeta=void 0,void((i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0));this._lastMeta!==l&&(this.options.set(l),this._lastMeta=l),(s=(r=this.uiConfig).uiRefresh)===null||s===void 0||s.call(r,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const a=this.getSelected();a&&a.isMesh&&a.userData[rh.PluginType]&&this.updateText(a,this.options.toJSON())}async addTextToSelected(){var a;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[rh.PluginType]||!e.material.map||await((a=this._viewer)===null||a===void 0?void 0:a.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(a,e){return this.updateText(a,Object.assign(this.options.toJSON(),e))}async updateText(a,e){var t,i;if(!a.isMesh)return;if(!a.material)return void console.error("updateText: no material on mesh");let r=a.userData[rh.PluginType];r||(a.userData[rh.PluginType]=r={}),Object.assign(r,e);const s=a.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(r);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}async makeTextSvg(a){const e=a.fontFamily||"Arial",t=a.fontPath||this.fonts[e]||"";let i=a.style;if(t.length>0){const o=t.split("?")[0].split(".").pop()||"woff";i+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${n2[o]||o});
            }`:"")}let r=function({text:o="Custom Text",svgBackground:l="#ffffff",xOffset:u=0,yOffset:h=0,width:f=1024,height:g=1024,boxWidth:_=1024,boxHeight:A=1024,fontFamily:x="",fontSize:E=32,maskText:T=!0,innerShadow:R=!0,bgFillColor:I="#000000",textColor:S="#ffffff",textAnchor:O="middle",style:k=""}){return`
<svg style="background-color:${l}" width="${f}" height="${g}" viewBox="0 0 ${_} ${A}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${k}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${O}; font-size: ${E}px; font-family: ${x||"Arial"}">
        <defs>

`+(T?`
<mask id="textMask">
<text style="fill:white; font-size: ${E}px;" x="${u+_/2}" y="${A/2+h+E/4}" > ${o} </text>
</mask>
`:"")+`

`+(R?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(T?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${_}" height="${A}" style="fill:${I}"/>
        <text style="${R?"filter: url(#innerShadow);":""} fill:${S};" x="${u+_/2}" y="${A/2+h+E/4}"> ${o} </text>

`+(T?`
        </g>
`:"")+`

    </g>
</svg>
`}({...a,fontFamily:e,style:i});r=await(0,V.embedUrlRefs)(r,async o=>this._getAssetData(o)),r=(0,V.svgUrl)(r);const s=await this._viewer.getManager().importer.importSinglePath(r,{generateMipmaps:!1,minFilter:p.wem});return s._isSimpleTextTexture=!0,s.flipY=!1,s.needsUpdate=!0,s}async _getAssetData(a){var e,t;if(a.startsWith("http://www.w3.org"))return a;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||t===void 0?void 0:t.importer;if(!i)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new fM(i.loadingManager),processImported:!1};try{return await i.importPath(a,this._assetLoadOptions)}catch(r){return console.error(r),""}}};Gl.PluginType="SimpleTextPlugin",hs([en(void 0,{params:Pb})],Gl.prototype,"options",void 0),hs([Ot("Apply Map",Pb),(0,V.onChange)(rh.prototype._paramsChanged),ae()],Gl.prototype,"applyToMap",void 0),hs([Ot("Apply Bump Map",Pb),(0,V.onChange)(rh.prototype._paramsChanged),ae()],Gl.prototype,"applyToBumpMap",void 0),hs([Ot("Apply Alpha Map",Pb),(0,V.onChange)(rh.prototype._paramsChanged),ae()],Gl.prototype,"applyToAlphaMap",void 0),hs([Ot("Invert Alpha Map",Pb),(0,V.onChange)(rh.prototype._paramsChanged),ae()],Gl.prototype,"inverseAlphaMap",void 0),hs([Xi("Add Text",a=>({hidden:()=>!a.getSelected()}))],Gl.prototype,"addTextToSelected",null),Gl=rh=hs([zi("Simple Text")],Gl);class NS{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class hD{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class cd{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new cd;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,i=new Array;for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],i=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new cd),this.front.build(t)),i.length&&(this.back||(this.back=new cd),this.back.build(i))}}class Hl{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Hl(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new Hl().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),i=t.x,r=t.y,s=t.z,o=e.x,l=e.y,u=e.z;return this.x=r*u-s*l,this.y=s*o-i*u,this.z=i*l-r*o,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new p.Pa4(this.x,this.y,this.z)}}class ev{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new ev(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,i,r,s){let o=0;const l=[];for(let u=0;u<e.vertices.length;u++){const h=this.normal.dot(e.vertices[u].pos)-this.w,f=h<-ev.EPSILON?2:h>ev.EPSILON?1:0;o|=f,l.push(f)}switch(o){case 0:(this.normal.dot(e.plane.normal)>0?t:i).push(e);break;case 1:r.push(e);break;case 2:s.push(e);break;case 3:{const u=[],h=[];for(let f=0;f<e.vertices.length;f++){const g=(f+1)%e.vertices.length,_=l[f],A=l[g],x=e.vertices[f],E=e.vertices[g];if(_!=2&&u.push(x),_!=1&&h.push(_!=2?x.clone():x),(_|A)==3){const T=(this.w-this.normal.dot(x.pos))/this.normal.dot(new Hl().copy(E.pos).sub(x.pos)),R=x.interpolate(E,T);u.push(R),h.push(R.clone())}}u.length>=3&&r.push(new l_(u,e.shared)),h.length>=3&&s.push(new l_(h,e.shared));break}}}static fromPoints(e,t,i){const r=new Hl().copy(t).sub(e).cross(new Hl().copy(i).sub(e)).normalize();return new ev(r.clone(),r.dot(e))}}ev.EPSILON=1e-5;class l_{constructor(e,t){this.vertices=e,this.shared=t,this.plane=ev.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new l_(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Nx{constructor(e,t,i,r){this.pos=new Hl().copy(e),this.normal=new Hl().copy(t),this.uv=new Hl().copy(i),this.uv.z=0,r&&(this.color=new Hl().copy(r))}clone(){return new Nx(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Nx(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class Ls{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new Ls;return t.polygons=e,t}static fromGeometry(e,t){let i=[];const r=e.attributes.position,s=e.attributes.normal,o=e.attributes.uv,l=e.attributes.color,u=e.groups;let h;if(e.index)h=e.index.array;else{h=new Array(r.array.length/r.itemSize|0);for(let g=0;g<h.length;g++)h[g]=g}const f=h.length/3|0;i=new Array(f);for(let g=0,_=0,A=h.length;g<A;g+=3,_++){const x=new Array(3);for(let E=0;E<3;E++){const T=h[g+E],R=3*T,I=2*T,S=r.array[R],O=r.array[R+1],k=r.array[R+2],N=s.array[R],H=s.array[R+1],X=s.array[R+2],te=o==null?void 0:o.array[I],re=o==null?void 0:o.array[I+1];x[E]=new Nx(new Hl(S,O,k),new Hl(N,H,X),new Hl(te,re,0),l&&new Hl(l.array[I],l.array[I+1],l.array[I+2]))}if(t===void 0&&u&&u.length>0)for(const E of u)g>=E.start&&g<E.start+E.count&&(i[_]=new l_(x,E.materialIndex));else i[_]=new l_(x,t)}return Ls.fromPolygons(i.filter(g=>!isNaN(g.plane.normal.x)))}static toGeometry(e,t){let i=0;const r=e.polygons;for(const A of r)i+=A.vertices.length-2;const s=new p.u9r,o=new NS(3*i*3),l=new NS(3*i*3),u=new hD(2*i*3);let h;const f=[],g=[];for(const A of r){const x=A.vertices,E=x.length;A.shared!==void 0&&(f[A.shared]||(f[A.shared]=[])),E&&x[0].color!==void 0&&(h||(h=new NS(3*i*3)));for(let T=3;T<=E;T++)(A.shared===void 0?g:f[A.shared]).push(o.top/3,o.top/3+1,o.top/3+2),o.write(x[0].pos),o.write(x[T-2].pos),o.write(x[T-1].pos),l.write(x[0].normal),l.write(x[T-2].normal),l.write(x[T-1].normal),u&&(u.write(x[0].uv),u.write(x[T-2].uv),u.write(x[T-1].uv)),h&&(h.write(x[0].color),h.write(x[T-2].color),h.write(x[T-1].color))}s.setAttribute("position",new p.TlE(o.array,3)),s.setAttribute("normal",new p.TlE(l.array,3)),u&&s.setAttribute("uv",new p.TlE(u.array,2)),h&&s.setAttribute("color",new p.TlE(h.array,3));for(let A=0;A<f.length;A++)f[A]===void 0&&(f[A]=[]);if(f.length){let A=[],x=0;for(let E=0;E<f.length;E++)s.addGroup(x,f[E].length,E),x+=f[E].length,A=A.concat(f[E]);s.addGroup(x,g.length,f.length),A=A.concat(g),s.setIndex(A)}const _=new p.yGw().copy(t).invert();return s.applyMatrix4(_),s.computeBoundingSphere(),s.computeBoundingBox(),s}static fromMesh(e,t){const i=Ls.fromGeometry(e.geometry,t),r=new p.Pa4,s=new p.Vkp;s.getNormalMatrix(e.matrix);for(let o=0;o<i.polygons.length;o++){const l=i.polygons[o];for(let u=0;u<l.vertices.length;u++){const h=l.vertices[u];h.pos.copy(r.copy(h.pos.toVector3()).applyMatrix4(e.matrix)),h.normal.copy(r.copy(h.normal.toVector3()).applyMatrix3(s))}}return i}static toMesh(e,t,i){const r=Ls.toGeometry(e,t),s=new p.Kj0(r,i);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}static union(e,t){const i=Ls.fromMesh(e),r=Ls.fromMesh(t);return Ls.toMesh(i.union(r),e.matrix,e.material)}static subtract(e,t){const i=Ls.fromMesh(e),r=Ls.fromMesh(t);return Ls.toMesh(i.subtract(r),e.matrix,e.material)}static intersect(e,t){const i=Ls.fromMesh(e),r=Ls.fromMesh(t);return Ls.toMesh(i.intersect(r),e.matrix,e.material)}clone(){const e=new Ls;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new cd(this.clone().polygons),i=new cd(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),Ls.fromPolygons(t.allPolygons())}subtract(e){const t=new cd(this.clone().polygons),i=new cd(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),Ls.fromPolygons(t.allPolygons())}intersect(e){const t=new cd(this.clone().polygons),i=new cd(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),Ls.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return Ls.toMesh(this,e,t)}toGeometry(e){return Ls.toGeometry(this,e)}}var c_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const FS=["union","subtract","intersect"];class Dp extends Si{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[fr],this.rootMesh=new p.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(fr))===null||t===void 0||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();i&&i.geometry&&(i.userData._isCSGMesh||(i.userData.csgBrush||(i.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,V.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter;if(!i||!this.rootObject)return;const r=this.rootMesh.visible;this.rootMesh.visible=!0;const s=await i.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=r,s}_updateSelectedProperties(){var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();i&&i.userData.csgBrush&&(i.userData.csgBrush.enabled=this.csgSelectedEnabled,i.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,i,r,s,o,l,u;const h=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();h&&(this.csgSelectedEnabled=(r=(i=h.userData.csgBrush)===null||i===void 0?void 0:i.enabled)!==null&&r!==void 0&&r,this.csgSelectedOperation=(o=(s=h.userData.csgBrush)===null||s===void 0?void 0:s.operation)!==null&&o!==void 0?o:"union"),(u=(l=this.uiConfig)===null||l===void 0?void 0:l.uiRefresh)===null||u===void 0||u.call(l,"postFrame",!0)}_preFrame(){var e,t,i;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const r=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((t=this.rootMesh.userData.dispose)!==null&&t!==void 0?t:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(r)),this.rootMesh&&!this.rootMesh.parent&&((i=this.rootObject)===null||i===void 0||i.modelObject.add(this.rootMesh)),this.showResult?(r.forEach(s=>{s[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(r.forEach(s=>{s[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(i=>{var r;i.isMesh&&i.geometry&&!((r=i.userData.csgBrush)===null||r===void 0)&&r.enabled&&t.push([i,i.userData.csgBrush.operation])}),t}_sceneUpdate(e){var t,i;!((i=(t=e==null?void 0:e.object)===null||t===void 0?void 0:t.userData)===null||i===void 0)&&i._isCSGMesh||(this._csgNeedsUpdate=!0)}}c_([Ot("Show Result",a=>({onChange:()=>{var e;return(e=a._viewer)===null||e===void 0?void 0:e.setDirty()}}))],Dp.prototype,"showResult",void 0),c_([Xi("Make CSG Brush",a=>({hidden:()=>{var e,t;const i=(t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();return!(i!=null&&i.userData)||!!i.userData.csgBrush||i.userData._isCSGMesh}}))],Dp.prototype,"makeSelectedCSGBrush",null),c_([Ot("Enabled",a=>({hidden:()=>{var e,t;const i=(t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();return!i||!i.userData.csgBrush},onChange:a._updateSelectedProperties}))],Dp.prototype,"csgSelectedEnabled",void 0),c_([Fs("Operation",FS.map(a=>({label:a})),a=>({hidden:()=>{var e,t;const i=(t=(e=a._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();return!i||!i.userData.csgBrush},onChange:a._updateSelectedProperties}))],Dp.prototype,"csgSelectedOperation",void 0),c_([Xi("Refresh CSG")],Dp.prototype,"refreshCSG",null),c_([Xi("Export Result",a=>({hidden:()=>{var e;return!(!((e=a._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],Dp.prototype,"downloadObject",null);function s2(a,e){let t=new Ls;const i=a.map(s=>s[0].material).flatMap(s=>s);a.forEach(([s,o])=>{if(!FS.includes(o))return void console.error(`Unknown operation ${o}`);s.updateMatrix(),s.updateMatrixWorld();const l=s.matrix;s.matrix=s.matrixWorld;let u=0;u=Array.isArray(s.material)?void 0:i.indexOf(s.material),t=t[o](Ls.fromMesh(s,u)),s.matrix=l});const r=t.toMesh(e??new p.yGw().identity(),i);return r.userData._isCSGMesh=!0,r.geometry.groups=r.geometry.groups.filter(s=>s.count>0),r}let Rb=class extends Dp{_buildCSGMesh(a){return s2(a)}};Rb.PluginType="CSGPluginBSP",Rb=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([zi("CSG Plugin (BSP)")],Rb);const a2=0,o2=1,l2=3,c2=4;class Bp{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const l=e[s][t];i=l<i?l:i,r=l>r?l:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const l=t[s],u=e.dot(l);i=u<i?u:i,r=u>r?u:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}Bp.prototype.setFromBox=function(){const a=new p.Pa4;return function(e,t){const i=t.min,r=t.max;let s=1/0,o=-1/0;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){a.x=i.x*l+r.x*(1-l),a.y=i.y*u+r.y*(1-u),a.z=i.z*h+r.z*(1-h);const f=e.dot(a);s=Math.min(f,s),o=Math.max(f,o)}this.min=s,this.max=o}}();const dD=function(){const a=new p.Pa4,e=new p.Pa4,t=new p.Pa4;return function(i,r,s){const o=i.start,l=a,u=r.start,h=e;t.subVectors(o,u),a.subVectors(i.end,i.start),e.subVectors(r.end,r.start);const f=t.dot(h),g=h.dot(l),_=h.dot(h),A=t.dot(l),x=l.dot(l)*_-g*g;let E,T;E=x!==0?(f*g-A*_)/x:0,T=(f+E*g)/_,s.x=E,s.y=T}}(),jS=function(){const a=new p.FM8,e=new p.Pa4,t=new p.Pa4;return function(i,r,s,o){dD(i,r,a);let l=a.x,u=a.y;if(l>=0&&l<=1&&u>=0&&u<=1)return i.at(l,s),void r.at(u,o);if(l>=0&&l<=1)return u<0?r.at(0,o):r.at(1,o),void i.closestPointToPoint(o,!0,s);if(u>=0&&u<=1)return l<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,o);{let h,f;h=l<0?i.start:i.end,f=u<0?r.start:r.end;const g=e,_=t;return i.closestPointToPoint(f,!0,e),r.closestPointToPoint(h,!0,t),g.distanceToSquared(f)<=_.distanceToSquared(h)?(s.copy(g),void o.copy(f)):(s.copy(h),void o.copy(_))}}}(),pD=function(){const a=new p.Pa4,e=new p.Pa4,t=new p.JOQ,i=new p.Zzh;return function(r,s){const{radius:o,center:l}=r,{a:u,b:h,c:f}=s;if(i.start=u,i.end=h,i.closestPointToPoint(l,!0,a).distanceTo(l)<=o||(i.start=u,i.end=f,i.closestPointToPoint(l,!0,a).distanceTo(l)<=o)||(i.start=h,i.end=f,i.closestPointToPoint(l,!0,a).distanceTo(l)<=o))return!0;const g=s.getPlane(t);if(Math.abs(g.distanceToPoint(l))<=o){const _=g.projectPoint(l,e);if(s.containsPoint(_))return!0}return!1}}(),fD=1e-15;function u_(a){return Math.abs(a)<fD}class ud extends p.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new p.Pa4),this.satBounds=new Array(4).fill().map(()=>new Bp),this.points=[this.a,this.b,this.c],this.sphere=new p.aLr,this.plane=new p.JOQ,this.needsUpdate=!0}intersectsSphere(e){return pD(e,this)}update(){const e=this.a,t=this.b,i=this.c,r=this.points,s=this.satAxes,o=this.satBounds,l=s[0],u=o[0];this.getNormal(l),u.setFromPoints(l,r);const h=s[1],f=o[1];h.subVectors(e,t),f.setFromPoints(h,r);const g=s[2],_=o[2];g.subVectors(t,i),_.setFromPoints(g,r);const A=s[3],x=o[3];A.subVectors(i,e),x.setFromPoints(A,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,e),this.needsUpdate=!1}}ud.prototype.closestPointToSegment=function(){const a=new p.Pa4,e=new p.Pa4,t=new p.Zzh;return function(i,r=null,s=null){const{start:o,end:l}=i,u=this.points;let h,f=1/0;for(let g=0;g<3;g++){const _=(g+1)%3;t.start.copy(u[g]),t.end.copy(u[_]),jS(t,i,a,e),h=a.distanceToSquared(e),h<f&&(f=h,r&&r.copy(a),s&&s.copy(e))}return this.closestPointToPoint(o,a),h=o.distanceToSquared(a),h<f&&(f=h,r&&r.copy(a),s&&s.copy(o)),this.closestPointToPoint(l,a),h=l.distanceToSquared(a),h<f&&(f=h,r&&r.copy(a),s&&s.copy(l)),Math.sqrt(f)}}(),ud.prototype.intersectsTriangle=function(){const a=new ud,e=new Array(3),t=new Array(3),i=new Bp,r=new Bp,s=new p.Pa4,o=new p.Pa4,l=new p.Pa4,u=new p.Pa4,h=new p.Zzh,f=new p.Zzh,g=new p.Zzh;return function(_,A=null,x=!1){this.needsUpdate&&this.update(),_.isExtendedTriangle?_.needsUpdate&&_.update():(a.copy(_),a.update(),_=a);const E=this.plane,T=_.plane;if(Math.abs(E.normal.dot(T.normal))>1-1e-10){const R=this.satBounds,I=this.satAxes;t[0]=_.a,t[1]=_.b,t[2]=_.c;for(let k=0;k<4;k++){const N=R[k],H=I[k];if(i.setFromPoints(H,t),N.isSeparated(i))return!1}const S=_.satBounds,O=_.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let k=0;k<4;k++){const N=S[k],H=O[k];if(i.setFromPoints(H,e),N.isSeparated(i))return!1}for(let k=0;k<4;k++){const N=I[k];for(let H=0;H<4;H++){const X=O[H];if(s.crossVectors(N,X),i.setFromPoints(s,e),r.setFromPoints(s,t),i.isSeparated(r))return!1}}return A&&(x||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),A.start.set(0,0,0),A.end.set(0,0,0)),!0}{const R=this.points;let I=!1,S=0;for(let ue=0;ue<3;ue++){const le=R[ue],se=R[(ue+1)%3];h.start.copy(le),h.end.copy(se),h.delta(o);const de=I?f.start:f.end,ve=u_(T.distanceToPoint(le));if(u_(T.normal.dot(o))&&ve){f.copy(h),S=2;break}if((T.intersectLine(h,de)||ve)&&!u_(de.distanceTo(se))){if(S++,I)break;I=!0}}if(S===1&&_.containsPoint(f.end))return A&&(A.start.copy(f.end),A.end.copy(f.end)),!0;if(S!==2)return!1;const O=_.points;let k=!1,N=0;for(let ue=0;ue<3;ue++){const le=O[ue],se=O[(ue+1)%3];h.start.copy(le),h.end.copy(se),h.delta(l);const de=k?g.start:g.end,ve=u_(E.distanceToPoint(le));if(u_(E.normal.dot(l))&&ve){g.copy(h),N=2;break}if((E.intersectLine(h,de)||ve)&&!u_(de.distanceTo(se))){if(N++,k)break;k=!0}}if(N===1&&this.containsPoint(g.end))return A&&(A.start.copy(g.end),A.end.copy(g.end)),!0;if(N!==2)return!1;if(f.delta(o),g.delta(l),o.dot(l)<0){let ue=g.start;g.start=g.end,g.end=ue}const H=f.start.dot(o),X=f.end.dot(o),te=g.start.dot(o),re=g.end.dot(o);return(H===re||te===X||X<te!=H<re)&&(A&&(u.subVectors(f.start,g.start),u.dot(o)>0?A.start.copy(f.start):A.start.copy(g.start),u.subVectors(f.end,g.end),u.dot(o)<0?A.end.copy(f.end):A.end.copy(g.end)),!0)}}}(),ud.prototype.distanceToPoint=function(){const a=new p.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),ud.prototype.distanceToTriangle=function(){const a=new p.Pa4,e=new p.Pa4,t=["a","b","c"],i=new p.Zzh,r=new p.Zzh;return function(s,o=null,l=null){const u=o||l?i:null;if(this.intersectsTriangle(s,u))return(o||l)&&(o&&u.getCenter(o),l&&u.getCenter(l)),0;let h=1/0;for(let f=0;f<3;f++){let g;const _=t[f],A=s[_];this.closestPointToPoint(A,a),g=A.distanceToSquared(a),g<h&&(h=g,o&&o.copy(a),l&&l.copy(A));const x=this[_];s.closestPointToPoint(x,a),g=x.distanceToSquared(a),g<h&&(h=g,o&&o.copy(x),l&&l.copy(a))}for(let f=0;f<3;f++){const g=t[f],_=t[(f+1)%3];i.set(this[g],this[_]);for(let A=0;A<3;A++){const x=t[A],E=t[(A+1)%3];r.set(s[x],s[E]),jS(i,r,a,e);const T=a.distanceToSquared(e);T<h&&(h=T,o&&o.copy(a),l&&l.copy(e))}}return Math.sqrt(h)}}();const h_=1e-14,d_=1e-10,Op=new p.Zzh,Ys=new p.Zzh,Lp=new p.Pa4,u2=new p.Pa4,Db=new p.JOQ,mD=new ud;function Bb(a){return a.a.distanceToSquared(a.b)<h_||a.a.distanceToSquared(a.c)<h_||a.b.distanceToSquared(a.c)<h_}class gD{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new p.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class vD{constructor(){this.trianglePool=new gD,this.triangles=[],this.normal=new p.Pa4}initialize(e){const{triangles:t,trianglePool:i,normal:r}=this;if(t.length=0,i.clear(),Array.isArray(e))for(let s=0,o=e.length;s<o;s++){const l=e[s];if(s===0)l.getNormal(r);else if(Math.abs(1-l.getNormal(Lp).dot(r))>h_)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const u=i.getTriangle();u.copy(l),t.push(u)}else{e.getNormal(r);const s=i.getTriangle();s.copy(e),t.push(s)}}splitByTriangle(e){const{normal:t,triangles:i}=this;if(e.getPlane(Db),Math.abs(1-Math.abs(Db.normal.dot(t)))<d_){const r=[e.a,e.b,e.c];for(let s=0;s<3;s++){const o=(s+1)%3,l=r[s],u=r[o];Lp.subVectors(u,l).normalize(),u2.crossVectors(t,Lp),Db.setFromNormalAndCoplanarPoint(u2,l),this.splitByPlane(Db,e,s)}for(let s=0,o=i.length;s<o;s++)i[s].coplanarCount=0}else this.splitByPlane(Db,e)}splitByPlane(e,t=null,i=-1){const{triangles:r,trianglePool:s}=this;let o=null;t!==null&&(o=mD,o.copy(t),o.needsUpdate=!0);for(let l=0,u=r.length;l<u;l++){const h=r[l],{a:f,b:g,c:_}=h;if(o&&!o.intersectsTriangle(h,Op,!0))continue;let A=0,x=-1,E=0,T=!1;const R=[f,g,_];for(let I=0;I<3;I++){const S=(I+1)%3;Op.start.copy(R[I]),Op.end.copy(R[S]);const O=e.distanceToPoint(Op.start),k=e.distanceToPoint(Op.end);if(Math.abs(O)<d_&&Math.abs(k)<d_){T=!0;break}if(Math.abs(O)<d_)continue;O>0&&E++;let N=!!e.intersectLine(Op,Lp);!N&&Math.abs(k)<d_&&(Lp.copy(Op.end),N=!0),!N||Lp.distanceTo(Op.start)<h_||(Lp.distanceTo(Op.end)<h_&&(x=I),A===0?Ys.start.copy(Lp):Ys.end.copy(Lp),A++)}if(!T)if(A===2&&Ys.distance()>d_)if(x!==-1){x=(x+1)%3;let I=0;I===x&&(I=(I+1)%3);let S=I+1;S===x&&(S=(S+1)%3);const O=s.getTriangle();O.a.copy(R[S]),O.b.copy(Ys.end),O.c.copy(Ys.start),Bb(O)||r.push(O),h.a.copy(R[I]),h.b.copy(Ys.start),h.c.copy(Ys.end),Bb(h)&&(r.splice(l,1),l--,u--)}else{const I=R.findIndex(H=>E>=2?e.distanceToPoint(H)<0:e.distanceToPoint(H)>0);if(I===0){let H=Ys.start;Ys.start=Ys.end,Ys.end=H}else if(I===-1)continue;const S=(I+1)%3,O=(I+2)%3,k=s.getTriangle(),N=s.getTriangle();R[S].distanceToSquared(Ys.start)<R[O].distanceToSquared(Ys.end)?(k.a.copy(R[S]),k.b.copy(Ys.start),k.c.copy(Ys.end),N.a.copy(R[S]),N.b.copy(R[O]),N.c.copy(Ys.start)):(k.a.copy(R[O]),k.b.copy(Ys.start),k.c.copy(Ys.end),N.a.copy(R[S]),N.b.copy(R[O]),N.c.copy(Ys.end)),h.a.copy(R[I]),h.b.copy(Ys.end),h.c.copy(Ys.start),Bb(k)||r.push(k),Bb(N)||r.push(N),Bb(h)&&(r.splice(l,1),l--,u--)}else A===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function h2(){return typeof SharedArrayBuffer<"u"}function _D(a){if(a.buffer instanceof SharedArrayBuffer)return a;const e=a.constructor,t=a.buffer,i=new SharedArrayBuffer(t.byteLength),r=new Uint8Array(t);return new Uint8Array(i).set(r,0),new e(i)}class d2{constructor(e,t=500){const i=h2()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new i(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:i,expansionFactor:r}=this;e===null&&(e=~~(i.length*r));const s=new t(e);s.set(i,0),this.array=s}push(...e){let{array:t,length:i}=this;i+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,s=e.length;r<s;r++)t[i+r]=e[r];this.length+=e.length}clear(){this.length=0}}class yD{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:i}=this;let r=0;for(let s=0;s<t;s++)r+=i[s][e].length;return r}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const i=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const r={};t.push(r);for(const s in i)r[s]=new d2(i[s].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:i}=this;if(!i[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:i}=this,r=i[0][e];if(r){if(r.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let s=0,o=i.length;s<o;s++)i[s][e]=new d2(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const i in t)t[i].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class bD{constructor(e){this.triangle=new p.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new p.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const i in t)e.push(t[i]);return e}}class p2{constructor(){this.data={}}addTriangleIntersection(e,t,i,r){const{data:s}=this;s[e]||(s[e]=new bD(t)),s[e].addTriangle(i,r)}getTrianglesAsArray(e=null){const{data:t}=this,i=[];if(e!==null)e in t&&i.push(t[e].triangle);else for(const r in t)i.push(t[r].triangle);return i}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(i=>parseInt(i)):[]}getIntersectionsAsArray(e=null,t=null){const{data:i}=this,r=new Set,s=[],o=l=>{if(i[l])if(t!==null)i[l].intersects[t]&&s.push(i[l].intersects[t]);else{const u=i[l].intersects;for(const h in u)r.has(h)||(r.add(h),s.push(u[h]))}};if(e!==null)o(e);else for(const l in i)o(l);return s}reset(){this.data={}}}class AD{constructor(){this.enabled=!1,this.triangleIntersectsA=new p2,this.triangleIntersectsB=new p2,this.intersectionEdges=[]}addIntersectingTriangles(e,t,i,r){const{triangleIntersectsA:s,triangleIntersectsB:o}=this;s.addTriangleIntersection(e,t,i,r),o.addTriangleIntersection(i,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class f2{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:i,ids:r}=this;i[e]||(i[e]=[],r.push(e)),i[e].push(t)}}const lm=new p.zHn,m2=new p.yGw,pl=new p.CJI,kp=new p.Pa4,g2=new p.Ltg,v2=new p.Ltg,_2=new p.Ltg,zS=new p.Ltg,Fx=new p.Ltg,jx=new p.Ltg,VS=new p.Zzh,GS=new p.Pa4,HS=1e-8,wD=1e-15,zx=-1,Vx=1,y2=-2,QS=2,Gx=0,Hx=1,WS=2;let Qx=null;function b2(a){Qx=a}function A2(a,e){function t(){return Math.random()-.5}a.getNormal(GS),lm.direction.copy(GS),a.getMidpoint(lm.origin);let i=0,r=1/0;for(let s=0;s<3;s++){lm.direction.x+=t()*HS,lm.direction.y+=t()*HS,lm.direction.z+=t()*HS,lm.direction.multiplyScalar(-1);const o=e.raycastFirst(lm,p.ehD);if(o&&lm.direction.dot(o.face.normal)>0&&i++,o!==null&&(r=Math.min(r,o.distance)),r<=wD)return o.face.normal.dot(GS)>0?QS:y2;if(i/3>.5||(s-i+1)/3>.5)break}return i/3>.5?zx:Vx}function xD(a,e,t,i,r,s,o=!1){const l=t.attributes,u=t.index,h=3*a,f=u.getX(h+0),g=u.getX(h+1),_=u.getX(h+2);for(const A in s){const x=l[A],E=s[A];if(!(A in l))throw new Error(`CSG Operations: Attribute ${A} not available on geometry.`);const T=x.itemSize;A==="position"?(pl.a.fromBufferAttribute(x,f).applyMatrix4(i),pl.b.fromBufferAttribute(x,g).applyMatrix4(i),pl.c.fromBufferAttribute(x,_).applyMatrix4(i),XS(pl.a,pl.b,pl.c,e,3,E,o)):A==="normal"?(pl.a.fromBufferAttribute(x,f).applyNormalMatrix(r),pl.b.fromBufferAttribute(x,g).applyNormalMatrix(r),pl.c.fromBufferAttribute(x,_).applyNormalMatrix(r),o&&(pl.a.multiplyScalar(-1),pl.b.multiplyScalar(-1),pl.c.multiplyScalar(-1)),XS(pl.a,pl.b,pl.c,e,3,E,o,!0)):(g2.fromBufferAttribute(x,f),v2.fromBufferAttribute(x,g),_2.fromBufferAttribute(x,_),XS(g2,v2,_2,e,T,E,o))}}function ED(a,e,t,i,r,s,o,l=!1){qS(a,i,r,s,o,l),qS(l?t:e,i,r,s,o,l),qS(l?e:t,i,r,s,o,l)}function w2(a,e,t=!1){switch(a){case a2:if(e===Vx||e===QS&&!t)return Hx;break;case o2:if(t){if(e===zx)return Gx}else if(e===Vx||e===y2)return Hx;break;case l2:if(e===zx)return Gx;if(e===Vx)return Hx;break;case c2:if(e===zx||e===QS&&!t)return Hx;break;default:throw new Error(`Unrecognized CSG operation enum "${a}".`)}return WS}function XS(a,e,t,i,r,s,o=!1,l=!1){const u=h=>{s.push(h.x),r>1&&s.push(h.y),r>2&&s.push(h.z),r>3&&s.push(h.w)};zS.set(0,0,0,0).addScaledVector(a,i.a.x).addScaledVector(e,i.a.y).addScaledVector(t,i.a.z),Fx.set(0,0,0,0).addScaledVector(a,i.b.x).addScaledVector(e,i.b.y).addScaledVector(t,i.b.z),jx.set(0,0,0,0).addScaledVector(a,i.c.x).addScaledVector(e,i.c.y).addScaledVector(t,i.c.z),l&&(zS.normalize(),Fx.normalize(),jx.normalize()),u(zS),o?(u(jx),u(Fx)):(u(Fx),u(jx))}function qS(a,e,t,i,r,s=!1){for(const o in r){const l=e[o],u=r[o];if(!(o in e))throw new Error(`CSG Operations: Attribute ${o} no available on geometry.`);const h=l.itemSize;o==="position"?(kp.fromBufferAttribute(l,a).applyMatrix4(t),u.push(kp.x,kp.y,kp.z)):o==="normal"?(kp.fromBufferAttribute(l,a).applyNormalMatrix(i),s&&kp.multiplyScalar(-1),u.push(kp.x,kp.y,kp.z)):(u.push(l.getX(a)),h>1&&u.push(l.getY(a)),h>2&&u.push(l.getZ(a)),h>3&&u.push(l.getW(a)))}}const cm=new p.yGw,Wx=new p.Vkp,tv=new p.CJI,Xx=new p.CJI,qx=new p.CJI,Yx=new p.CJI;function SD(a){for(const e of a)return e}function x2(a,e,t,i,r,s,o,l=0){const u=a.matrixWorld.determinant()<0;cm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),Wx.getNormalMatrix(a.matrixWorld).multiplyScalar(u?-1:1);const h=a.geometry.groupIndices,f=a.geometry.index,g=a.geometry.attributes.position,_=e.geometry.boundsTree,A=e.geometry.index,x=e.geometry.attributes.position,E=t.ids,T=t.intersectionSet;for(let R=0,I=E.length;R<I;R++){const S=E[R],O=l===-1?0:h[S]+l,k=o.getGroupSet(O),N=3*S,H=f.getX(N+0),X=f.getX(N+1),te=f.getX(N+2);tv.a.fromBufferAttribute(g,H).applyMatrix4(cm),tv.b.fromBufferAttribute(g,X).applyMatrix4(cm),tv.c.fromBufferAttribute(g,te).applyMatrix4(cm),s.initialize(tv);const re=T[S];for(let le=0,se=re.length;le<se;le++){const de=3*re[le],ve=A.getX(de+0),fe=A.getX(de+1),Ee=A.getX(de+2);Xx.a.fromBufferAttribute(x,ve),Xx.b.fromBufferAttribute(x,fe),Xx.c.fromBufferAttribute(x,Ee),s.splitByTriangle(Xx)}const ue=s.triangles;for(let le=0,se=ue.length;le<se;le++){const de=ue[le],ve=w2(i,A2(de,_),r);if(ve!==WS){tv.getBarycoord(de.a,Yx.a),tv.getBarycoord(de.b,Yx.b),tv.getBarycoord(de.c,Yx.c);const fe=ve===Gx;xD(S,Yx,a.geometry,a.matrixWorld,Wx,k,u!==fe)}}}return E.length}function E2(a,e,t,i,r,s,o=0){const l=a.matrixWorld.determinant()<0;cm.copy(e.matrixWorld).invert().multiply(a.matrixWorld),Wx.getNormalMatrix(a.matrixWorld).multiplyScalar(l?-1:1);const u=e.geometry.boundsTree,h=a.geometry.groupIndices,f=a.geometry.index,g=a.geometry.attributes,_=g.position,A=[],x=a.geometry.halfEdges,E=new Set;for(let T=0,R=f.count/3;T<R;T++)T in t.intersectionSet||E.add(T);for(;E.size>0;){const T=SD(E);E.delete(T),A.push(T);const R=3*T,I=f.getX(R+0),S=f.getX(R+1),O=f.getX(R+2);qx.a.fromBufferAttribute(_,I).applyMatrix4(cm),qx.b.fromBufferAttribute(_,S).applyMatrix4(cm),qx.c.fromBufferAttribute(_,O).applyMatrix4(cm);const k=w2(i,A2(qx,u),r);for(;A.length>0;){const N=A.pop(),H=o===-1?0:h[N]+o,X=s.getGroupSet(H);for(let de=0;de<3;de++){const ve=x.getSiblingTriangleIndex(N,de);ve!==-1&&E.has(ve)&&(A.push(ve),E.delete(ve))}if(k===WS)continue;const te=3*N,re=f.getX(te+0),ue=f.getX(te+1),le=f.getX(te+2),se=k===Gx;ED(re,ue,le,g,a.matrixWorld,Wx,X,se!==l)}}}const S2=0,CD=1,MD=2,YS=1.25,C2=1,KS=65535,TD=Math.pow(2,-24);class Kx{constructor(){}}function hd(a,e,t){return t.min.x=e[a],t.min.y=e[a+1],t.min.z=e[a+2],t.max.x=e[a+3],t.max.y=e[a+4],t.max.z=e[a+5],t}function M2(a){let e=-1,t=-1/0;for(let i=0;i<3;i++){const r=a[i+3]-a[i];r>t&&(t=r,e=i)}return e}function T2(a,e){e.set(a)}function I2(a,e,t){let i,r;for(let s=0;s<3;s++){const o=s+3;i=a[s],r=e[s],t[s]=i<r?i:r,i=a[o],r=e[o],t[o]=i>r?i:r}}function Zx(a,e,t){for(let i=0;i<3;i++){const r=e[a+2*i],s=e[a+2*i+1],o=r-s,l=r+s;o<t[i]&&(t[i]=o),l>t[i+3]&&(t[i+3]=l)}}function Ob(a){const e=a[3]-a[0],t=a[4]-a[1],i=a[5]-a[2];return 2*(e*t+t*i+i*e)}function ZS(a,e,t,i,r=null){let s=1/0,o=1/0,l=1/0,u=-1/0,h=-1/0,f=-1/0,g=1/0,_=1/0,A=1/0,x=-1/0,E=-1/0,T=-1/0;const R=r!==null;for(let I=6*e,S=6*(e+t);I<S;I+=6){const O=a[I+0],k=a[I+1],N=O-k,H=O+k;N<s&&(s=N),H>u&&(u=H),R&&O<g&&(g=O),R&&O>x&&(x=O);const X=a[I+2],te=a[I+3],re=X-te,ue=X+te;re<o&&(o=re),ue>h&&(h=ue),R&&X<_&&(_=X),R&&X>E&&(E=X);const le=a[I+4],se=a[I+5],de=le-se,ve=le+se;de<l&&(l=de),ve>f&&(f=ve),R&&le<A&&(A=le),R&&le>T&&(T=le)}i[0]=s,i[1]=o,i[2]=l,i[3]=u,i[4]=h,i[5]=f,R&&(r[0]=g,r[1]=_,r[2]=A,r[3]=x,r[4]=E,r[5]=T)}const Up=32,ID=(a,e)=>a.candidate-e.candidate,um=new Array(Up).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Jx=new Float32Array(6);class dd{constructor(e,t,i){this.isOrientedBox=!0,this.min=new p.Pa4,this.max=new p.Pa4,this.matrix=new p.yGw,this.invMatrix=new p.yGw,this.points=new Array(8).fill().map(()=>new p.Pa4),this.satAxes=new Array(3).fill().map(()=>new p.Pa4),this.satBounds=new Array(3).fill().map(()=>new Bp),this.alignedSatBounds=new Array(3).fill().map(()=>new Bp),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}dd.prototype.update=function(){const a=this.matrix,e=this.min,t=this.max,i=this.points;for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)for(let f=0;f<=1;f++){const g=i[1*u|2*h|4*f];g.x=u?t.x:e.x,g.y=h?t.y:e.y,g.z=f?t.z:e.z,g.applyMatrix4(a)}const r=this.satBounds,s=this.satAxes,o=i[0];for(let u=0;u<3;u++){const h=s[u],f=r[u],g=i[1<<u];h.subVectors(o,g),f.setFromPoints(h,i)}const l=this.alignedSatBounds;l[0].setFromPointsField(i,"x"),l[1].setFromPointsField(i,"y"),l[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dd.prototype.intersectsBox=function(){const a=new Bp;return function(e){this.needsUpdate&&this.update();const t=e.min,i=e.max,r=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(a.min=t.x,a.max=i.x,o[0].isSeparated(a)||(a.min=t.y,a.max=i.y,o[1].isSeparated(a))||(a.min=t.z,a.max=i.z,o[2].isSeparated(a)))return!1;for(let l=0;l<3;l++){const u=s[l],h=r[l];if(a.setFromBox(u,e),h.isSeparated(a))return!1}return!0}}(),dd.prototype.intersectsTriangle=function(){const a=new ud,e=new Array(3),t=new Bp,i=new Bp,r=new p.Pa4;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(a.copy(s),a.update(),s=a);const o=this.satBounds,l=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let g=0;g<3;g++){const _=o[g],A=l[g];if(t.setFromPoints(A,e),_.isSeparated(t))return!1}const u=s.satBounds,h=s.satAxes,f=this.points;for(let g=0;g<3;g++){const _=u[g],A=h[g];if(t.setFromPoints(A,f),_.isSeparated(t))return!1}for(let g=0;g<3;g++){const _=l[g];for(let A=0;A<4;A++){const x=h[A];if(r.crossVectors(_,x),t.setFromPoints(r,e),i.setFromPoints(r,f),t.isSeparated(i))return!1}}return!0}}(),dd.prototype.closestPointToPoint=function(a,e){return this.needsUpdate&&this.update(),e.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},dd.prototype.distanceToPoint=function(){const a=new p.Pa4;return function(e){return this.closestPointToPoint(e,a),e.distanceTo(a)}}(),dd.prototype.distanceToBox=function(){const a=["x","y","z"],e=new Array(12).fill().map(()=>new p.Zzh),t=new Array(12).fill().map(()=>new p.Zzh),i=new p.Pa4,r=new p.Pa4;return function(s,o=0,l=null,u=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(l||u)&&(s.getCenter(r),this.closestPointToPoint(r,i),s.closestPointToPoint(i,r),l&&l.copy(i),u&&u.copy(r)),0;const h=o*o,f=s.min,g=s.max,_=this.points;let A=1/0;for(let E=0;E<8;E++){const T=_[E];r.copy(T).clamp(f,g);const R=T.distanceToSquared(r);if(R<A&&(A=R,l&&l.copy(T),u&&u.copy(r),R<h))return Math.sqrt(R)}let x=0;for(let E=0;E<3;E++)for(let T=0;T<=1;T++)for(let R=0;R<=1;R++){const I=(E+1)%3,S=(E+2)%3,O=1<<E|T<<I|R<<S,k=_[T<<I|R<<S],N=_[O];e[x].set(k,N);const H=a[E],X=a[I],te=a[S],re=t[x],ue=re.start,le=re.end;ue[H]=f[H],ue[X]=T?f[X]:g[X],ue[te]=R?f[te]:g[X],le[H]=g[H],le[X]=T?f[X]:g[X],le[te]=R?f[te]:g[X],x++}for(let E=0;E<=1;E++)for(let T=0;T<=1;T++)for(let R=0;R<=1;R++){r.x=E?g.x:f.x,r.y=T?g.y:f.y,r.z=R?g.z:f.z,this.closestPointToPoint(r,i);const I=r.distanceToSquared(i);if(I<A&&(A=I,l&&l.copy(i),u&&u.copy(r),I<h))return Math.sqrt(I)}for(let E=0;E<12;E++){const T=e[E];for(let R=0;R<12;R++){const I=t[R];jS(T,I,i,r);const S=i.distanceToSquared(r);if(S<A&&(A=S,l&&l.copy(i),u&&u.copy(r),S<h))return Math.sqrt(S)}}return Math.sqrt(A)}}();const $x=new p.Pa4,e1=new p.Pa4,t1=new p.Pa4,P2=new p.FM8,R2=new p.FM8,D2=new p.FM8,B2=new p.Pa4;function O2(a,e,t,i,r){const s=3*i,o=a.index.getX(s),l=a.index.getX(s+1),u=a.index.getX(s+2),h=function(f,g,_,A,x,E,T){$x.fromBufferAttribute(g,A),e1.fromBufferAttribute(g,x),t1.fromBufferAttribute(g,E);const R=function(I,S,O,k,N,H){let X;return X=H===p._Li?I.intersectTriangle(k,O,S,!0,N):I.intersectTriangle(S,O,k,H!==p.ehD,N),X===null?null:{distance:I.origin.distanceTo(N),point:N.clone()}}(f,$x,e1,t1,B2,T);if(R){_&&(P2.fromBufferAttribute(_,A),R2.fromBufferAttribute(_,x),D2.fromBufferAttribute(_,E),R.uv=p.CJI.getUV(B2,$x,e1,t1,P2,R2,D2,new p.FM8));const I={a:A,b:x,c:E,normal:new p.Pa4,materialIndex:0};p.CJI.getNormal($x,e1,t1,I.normal),R.face=I,R.faceIndex=A}return R}(t,a.attributes.position,a.attributes.uv,o,l,u,e);return h?(h.faceIndex=i,r&&r.push(h),h):null}function pd(a,e,t,i){const r=a.a,s=a.b,o=a.c;let l=e,u=e+1,h=e+2;t&&(l=t.getX(e),u=t.getX(e+1),h=t.getX(e+2)),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),s.x=i.getX(u),s.y=i.getY(u),s.z=i.getZ(u),o.x=i.getX(h),o.y=i.getY(h),o.z=i.getZ(h)}function L2(a,e,t,i,r,s,o){const l=t.index,u=t.attributes.position;for(let h=a,f=e+a;h<f;h++)if(pd(o,3*h,l,u),o.needsUpdate=!0,i(o,h,r,s))return!0;return!1}class k2{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function hm(a,e){return e[a+15]===65535}function p_(a,e){return e[a+6]}function Lb(a,e){return e[a+14]}function kb(a){return a+8}function Ub(a,e){return e[a+6]}const f_=new p.ZzF,i1=new p.Pa4,PD=["x","y","z"];function JS(a,e,t,i,r){let s=2*a,o=m_,l=dm,u=pm;if(hm(s,l))(function(h,f,g,_,A,x){for(let E=_,T=_+A;E<T;E++)O2(h,f,g,E,x)})(e,t,i,p_(a,u),Lb(s,l),r);else{const h=kb(a);r1(h,o,i,i1)&&JS(h,e,t,i,r);const f=Ub(a,u);r1(f,o,i,i1)&&JS(f,e,t,i,r)}}function $S(a,e,t,i){let r=2*a,s=m_,o=dm,l=pm;if(hm(r,o))return function(u,h,f,g,_){let A=1/0,x=null;for(let E=g,T=g+_;E<T;E++){const R=O2(u,h,f,E);R&&R.distance<A&&(x=R,A=R.distance)}return x}(e,t,i,p_(a,l),Lb(r,o));{const u=function(E,T){return T[E+7]}(a,l),h=PD[u],f=i.direction[h]>=0;let g,_;f?(g=kb(a),_=Ub(a,l)):(g=Ub(a,l),_=kb(a));const A=r1(g,s,i,i1)?$S(g,e,t,i):null;if(A){const E=A.point[h];if(f?E<=s[_+u]:E>=s[_+u+3])return A}const x=r1(_,s,i,i1)?$S(_,e,t,i):null;return A&&x?A.distance<=x.distance?A:x:A||x||null}}const RD=function(){let a,e;const t=[],i=new k2(()=>new p.ZzF);return function(...s){a=i.getPrimitive(),e=i.getPrimitive(),t.push(a,e);const o=r(...s);i.releasePrimitive(a),i.releasePrimitive(e),t.pop(),t.pop();const l=t.length;return l>0&&(e=t[l-1],a=t[l-2]),o};function r(s,o,l,u,h=null,f=0,g=0){function _(I){let S=2*I,O=dm,k=pm;for(;!hm(S,O);)S=2*(I=kb(I));return p_(I,k)}function A(I){let S=2*I,O=dm,k=pm;for(;!hm(S,O);)S=2*(I=Ub(I,k));return p_(I,k)+Lb(S,O)}let x=2*s,E=m_,T=dm,R=pm;if(hm(x,T)){const I=p_(s,R),S=Lb(x,T);return hd(s,E,a),u(I,S,!1,g,f+s,a)}{const I=kb(s),S=Ub(s,R);let O,k,N,H,X=I,te=S;if(h&&(N=a,H=e,hd(X,E,N),hd(te,E,H),O=h(N),k=h(H),k<O)){X=S,te=I;const de=O;O=k,k=de,N=H}N||(N=a,hd(X,E,N));const re=l(N,hm(2*X,T),O,g+1,f+X);let ue;if(re===2){const de=_(X);ue=u(de,A(X)-de,!0,g+1,f+X,N)}else ue=re&&r(X,o,l,u,h,f,g+1);if(ue)return!0;H=e,hd(te,E,H);const le=l(H,hm(2*te,T),k,g+1,f+te);let se;if(le===2){const de=_(te);se=u(de,A(te)-de,!0,g+1,f+te,H)}else se=le&&r(te,o,l,u,h,f,g+1);return!!se}}}(),DD=function(){const a=new ud,e=new ud,t=new p.yGw,i=new dd,r=new dd;return function s(o,l,u,h,f=null){let g=2*o,_=m_,A=dm,x=pm;if(f===null&&(u.boundingBox||u.computeBoundingBox(),i.set(u.boundingBox.min,u.boundingBox.max,h),f=i),!hm(g,A)){const E=o+8,T=x[o+6];return hd(E,_,f_),f.intersectsBox(f_)&&s(E,l,u,h,f)?!0:(hd(T,_,f_),!(!f.intersectsBox(f_)||!s(T,l,u,h,f)))}{const E=l,T=E.index,R=E.attributes.position,I=u.index,S=u.attributes.position,O=p_(o,x),k=Lb(g,A);if(t.copy(h).invert(),u.boundsTree)return hd(o,_,r),r.matrix.copy(t),r.needsUpdate=!0,u.boundsTree.shapecast({intersectsBounds:N=>r.intersectsBox(N),intersectsTriangle:N=>{N.a.applyMatrix4(h),N.b.applyMatrix4(h),N.c.applyMatrix4(h),N.needsUpdate=!0;for(let H=3*O,X=3*(k+O);H<X;H+=3)if(pd(e,H,T,R),e.needsUpdate=!0,N.intersectsTriangle(e))return!0;return!1}});for(let N=3*O,H=k+3*O;N<H;N+=3){pd(a,N,T,R),a.a.applyMatrix4(t),a.b.applyMatrix4(t),a.c.applyMatrix4(t),a.needsUpdate=!0;for(let X=0,te=I.count;X<te;X+=3)if(pd(e,X,I,S),e.needsUpdate=!0,a.intersectsTriangle(e))return!0}}}}();function r1(a,e,t,i){return hd(a,e,f_),t.intersectBox(f_,i)}const eC=[];let n1,m_,dm,pm;function Nb(a){n1&&eC.push(n1),n1=a,m_=new Float32Array(a),dm=new Uint16Array(a),pm=new Uint32Array(a)}function s1(){n1=null,m_=null,dm=null,pm=null,eC.length&&Nb(eC.pop())}const tC=Symbol("skip tree generation"),iC=new p.ZzF,rC=new p.ZzF,g_=new p.yGw,iv=new dd,Fb=new dd,jb=new p.Pa4,a1=new p.Pa4,BD=new p.Pa4,OD=new p.Pa4,LD=new p.Pa4,U2=new p.ZzF,fd=new k2(()=>new ud);class zb{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),zb.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const i=e.geometry,r=e._roots,s=i.getIndex();let o;return o=t.cloneBuffers?{roots:r.map(l=>l.slice()),index:s.array.slice()}:{roots:r,index:s.array},o}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),zb.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});i={setIndex:!0,...i};const{index:r,roots:s}=e,o=new zb(t,{...i,[tC]:!0});if(o._roots=s,i.setIndex){const l=t.getIndex();if(l===null){const u=new p.TlE(e.index,1,!1);t.setIndex(u)}else l.array!==r&&(l.array.set(r),l.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:S2,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[tC]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[tC]||(this._roots=function(i,r){const s=function(A,x){function E(de){te&&te(de/re)}function T(de,ve,fe,Ee=null,Je=0){if(!ue&&Je>=k&&(ue=!0,N&&(console.warn(`MeshBVH: Max depth of ${k} reached when generating BVH. Consider increasing maxDepth.`),console.warn(A))),fe<=H||Je>=k)return E(ve+fe),de.offset=ve,de.count=fe,de;const Te=function(Ve,Ye,Tt,Xe,Zt,di){let Ai=-1,Wi=0;if(di===S2)Ai=M2(Ye),Ai!==-1&&(Wi=(Ye[Ai]+Ye[Ai+3])/2);else if(di===CD)Ai=M2(Ve),Ai!==-1&&(Wi=function(Gi,Ui,wt,yt){let li=0;for(let ar=Ui,ge=Ui+wt;ar<ge;ar++)li+=Gi[6*ar+2*yt];return li/wt}(Tt,Xe,Zt,Ai));else if(di===MD){const Gi=Ob(Ve);let Ui=YS*Zt;const wt=6*Xe,yt=6*(Xe+Zt);for(let li=0;li<3;li++){const ar=Ye[li],ge=(Ye[li+3]-ar)/Up;if(Zt<Up/4){const je=[...um];je.length=Zt;let nt=0;for(let bt=wt;bt<yt;bt+=6,nt++){const Ae=je[nt];Ae.candidate=Tt[bt+2*li],Ae.count=0;const{bounds:st,leftCacheBounds:zt,rightCacheBounds:si}=Ae;for(let ni=0;ni<3;ni++)si[ni]=1/0,si[ni+3]=-1/0,zt[ni]=1/0,zt[ni+3]=-1/0,st[ni]=1/0,st[ni+3]=-1/0;Zx(bt,Tt,st)}je.sort(ID);let St=Zt;for(let bt=0;bt<St;bt++){const Ae=je[bt];for(;bt+1<St&&je[bt+1].candidate===Ae.candidate;)je.splice(bt+1,1),St--}for(let bt=wt;bt<yt;bt+=6){const Ae=Tt[bt+2*li];for(let st=0;st<St;st++){const zt=je[st];Ae>=zt.candidate?Zx(bt,Tt,zt.rightCacheBounds):(Zx(bt,Tt,zt.leftCacheBounds),zt.count++)}}for(let bt=0;bt<St;bt++){const Ae=je[bt],st=Ae.count,zt=Zt-Ae.count,si=Ae.leftCacheBounds,ni=Ae.rightCacheBounds;let vi=0;st!==0&&(vi=Ob(si)/Gi);let Pi=0;zt!==0&&(Pi=Ob(ni)/Gi);const wi=C2+YS*(vi*st+Pi*zt);wi<Ui&&(Ai=li,Ui=wi,Wi=Ae.candidate)}}else{for(let St=0;St<Up;St++){const bt=um[St];bt.count=0,bt.candidate=ar+ge+St*ge;const Ae=bt.bounds;for(let st=0;st<3;st++)Ae[st]=1/0,Ae[st+3]=-1/0}for(let St=wt;St<yt;St+=6){let bt=~~((Tt[St+2*li]-ar)/ge);bt>=Up&&(bt=Up-1);const Ae=um[bt];Ae.count++,Zx(St,Tt,Ae.bounds)}const je=um[Up-1];T2(je.bounds,je.rightCacheBounds);for(let St=Up-2;St>=0;St--){const bt=um[St],Ae=um[St+1];I2(bt.bounds,Ae.rightCacheBounds,bt.rightCacheBounds)}let nt=0;for(let St=0;St<Up-1;St++){const bt=um[St],Ae=bt.count,st=bt.bounds,zt=um[St+1].rightCacheBounds;Ae!==0&&(nt===0?T2(st,Jx):I2(st,Jx,Jx)),nt+=Ae;let si=0,ni=0;nt!==0&&(si=Ob(Jx)/Gi);const vi=Zt-nt;vi!==0&&(ni=Ob(zt)/Gi);const Pi=C2+YS*(si*nt+ni*vi);Pi<Ui&&(Ai=li,Ui=Pi,Wi=bt.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${di} used.`);return{axis:Ai,pos:Wi}}(de.boundingData,Ee,S,ve,fe,X);if(Te.axis===-1)return E(ve+fe),de.offset=ve,de.count=fe,de;const qe=function(Ve,Ye,Tt,Xe,Zt){let di=Tt,Ai=Tt+Xe-1;const Wi=Zt.pos,Gi=2*Zt.axis;for(;;){for(;di<=Ai&&Ye[6*di+Gi]<Wi;)di++;for(;di<=Ai&&Ye[6*Ai+Gi]>=Wi;)Ai--;if(!(di<Ai))return di;for(let Ui=0;Ui<3;Ui++){let wt=Ve[3*di+Ui];Ve[3*di+Ui]=Ve[3*Ai+Ui],Ve[3*Ai+Ui]=wt;let yt=Ye[6*di+2*Ui+0];Ye[6*di+2*Ui+0]=Ye[6*Ai+2*Ui+0],Ye[6*Ai+2*Ui+0]=yt;let li=Ye[6*di+2*Ui+1];Ye[6*di+2*Ui+1]=Ye[6*Ai+2*Ui+1],Ye[6*Ai+2*Ui+1]=li}di++,Ai--}}(O,S,ve,fe,Te);if(qe===ve||qe===ve+fe)E(ve+fe),de.offset=ve,de.count=fe;else{de.splitAxis=Te.axis;const Ve=new Kx,Ye=ve,Tt=qe-ve;de.left=Ve,Ve.boundingData=new Float32Array(6),ZS(S,Ye,Tt,Ve.boundingData,I),T(Ve,Ye,Tt,I,Je+1);const Xe=new Kx,Zt=qe,di=fe-Tt;de.right=Xe,Xe.boundingData=new Float32Array(6),ZS(S,Zt,di,Xe.boundingData,I),T(Xe,Zt,di,I,Je+1)}return de}(function(de,ve){if(!de.index){const fe=de.attributes.position.count,Ee=ve.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Je;Je=fe>65535?new Uint32Array(new Ee(4*fe)):new Uint16Array(new Ee(2*fe)),de.setIndex(new p.TlE(Je,1));for(let Te=0;Te<fe;Te++)Je[Te]=Te}})(A,x);const R=new Float32Array(6),I=new Float32Array(6),S=function(de,ve){const fe=de.attributes.position,Ee=de.index.array,Je=Ee.length/3,Te=new Float32Array(6*Je),qe=fe.normalized,Ve=fe.array,Ye=fe.offset||0;let Tt=3;fe.isInterleavedBufferAttribute&&(Tt=fe.data.stride);const Xe=["getX","getY","getZ"];for(let Zt=0;Zt<Je;Zt++){const di=3*Zt,Ai=6*Zt;let Wi,Gi,Ui;qe?(Wi=Ee[di+0],Gi=Ee[di+1],Ui=Ee[di+2]):(Wi=Ee[di+0]*Tt+Ye,Gi=Ee[di+1]*Tt+Ye,Ui=Ee[di+2]*Tt+Ye);for(let wt=0;wt<3;wt++){let yt,li,ar;qe?(yt=fe[Xe[wt]](Wi),li=fe[Xe[wt]](Gi),ar=fe[Xe[wt]](Ui)):(yt=Ve[Wi+wt],li=Ve[Gi+wt],ar=Ve[Ui+wt]);let ge=yt;li<ge&&(ge=li),ar<ge&&(ge=ar);let je=yt;li>je&&(je=li),ar>je&&(je=ar);const nt=(je-ge)/2,St=2*wt;Te[Ai+St+0]=ge+nt,Te[Ai+St+1]=nt+(Math.abs(ge)+nt)*TD,ge<ve[wt]&&(ve[wt]=ge),je>ve[wt+3]&&(ve[wt+3]=je)}}return Te}(A,R),O=A.index.array,k=x.maxDepth,N=x.verbose,H=x.maxLeafTris,X=x.strategy,te=x.onProgress,re=A.index.count/3;let ue=!1;const le=[],se=function(de){if(!de.groups||!de.groups.length)return[{offset:0,count:de.index.count/3}];const ve=[],fe=new Set;for(const Je of de.groups)fe.add(Je.start),fe.add(Je.start+Je.count);const Ee=Array.from(fe.values()).sort((Je,Te)=>Je-Te);for(let Je=0;Je<Ee.length-1;Je++){const Te=Ee[Je],qe=Ee[Je+1];ve.push({offset:Te/3,count:(qe-Te)/3})}return ve}(A);if(se.length===1){const de=se[0],ve=new Kx;ve.boundingData=R,function(fe,Ee,Je,Te){let qe=1/0,Ve=1/0,Ye=1/0,Tt=-1/0,Xe=-1/0,Zt=-1/0;for(let di=6*Ee,Ai=6*(Ee+Je);di<Ai;di+=6){const Wi=fe[di+0];Wi<qe&&(qe=Wi),Wi>Tt&&(Tt=Wi);const Gi=fe[di+2];Gi<Ve&&(Ve=Gi),Gi>Xe&&(Xe=Gi);const Ui=fe[di+4];Ui<Ye&&(Ye=Ui),Ui>Zt&&(Zt=Ui)}Te[0]=qe,Te[1]=Ve,Te[2]=Ye,Te[3]=Tt,Te[4]=Xe,Te[5]=Zt}(S,de.offset,de.count,I),T(ve,de.offset,de.count,I),le.push(ve)}else for(let de of se){const ve=new Kx;ve.boundingData=new Float32Array(6),ZS(S,de.offset,de.count,ve.boundingData,I),T(ve,de.offset,de.count,I),le.push(ve)}return le}(i,r);let o,l,u;const h=[],f=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let A=0;A<s.length;A++){const x=s[A],E=new f(32*g(x));o=new Float32Array(E),l=new Uint32Array(E),u=new Uint16Array(E),_(0,x),h.push(E)}return h;function g(A){return A.count?1:1+g(A.left)+g(A.right)}function _(A,x){const E=A/4,T=A/2,R=!!x.count,I=x.boundingData;for(let S=0;S<6;S++)o[E+S]=I[S];if(R){const S=x.offset,O=x.count;return l[E+6]=S,u[T+14]=O,u[T+15]=KS,A+32}{const S=x.left,O=x.right,k=x.splitAxis;let N;if(N=_(A+32,S),N/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return l[E+6]=N/4,N=_(N,O),l[E+7]=k,N}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new p.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,i=t.index.array,r=t.attributes.position;let s,o,l,u,h=0;const f=this._roots;for(let _=0,A=f.length;_<A;_++)s=f[_],o=new Uint32Array(s),l=new Uint16Array(s),u=new Float32Array(s),g(0,h),h+=s.byteLength;function g(_,A,x=!1){const E=2*_;if(l[E+15]===KS){const T=o[_+6];let R=1/0,I=1/0,S=1/0,O=-1/0,k=-1/0,N=-1/0;for(let H=3*T,X=3*(T+l[E+14]);H<X;H++){const te=i[H],re=r.getX(te),ue=r.getY(te),le=r.getZ(te);re<R&&(R=re),re>O&&(O=re),ue<I&&(I=ue),ue>k&&(k=ue),le<S&&(S=le),le>N&&(N=le)}return(u[_+0]!==R||u[_+1]!==I||u[_+2]!==S||u[_+3]!==O||u[_+4]!==k||u[_+5]!==N)&&(u[_+0]=R,u[_+1]=I,u[_+2]=S,u[_+3]=O,u[_+4]=k,u[_+5]=N,!0)}{const T=_+8,R=o[_+6],I=T+A,S=R+A;let O=x,k=!1,N=!1;e?O||(k=e.has(I),N=e.has(S),O=!k&&!N):(k=!0,N=!0);const H=O||N;let X=!1;(O||k)&&(X=g(T,A,O));let te=!1;H&&(te=g(R,A,O));const re=X||te;if(re)for(let ue=0;ue<3;ue++){const le=T+ue,se=R+ue,de=u[le],ve=u[le+3],fe=u[se],Ee=u[se+3];u[_+ue]=de<fe?de:fe,u[_+ue+3]=ve>Ee?ve:Ee}return re}}}traverse(e,t=0){const i=this._roots[t],r=new Uint32Array(i),s=new Uint16Array(i);(function o(l,u=0){const h=2*l,f=s[h+15]===KS;if(f){const g=r[l+6],_=s[h+14];e(u,f,new Float32Array(i,4*l,6),g,_)}else{const g=l+8,_=r[l+6],A=r[l+7];e(u,f,new Float32Array(i,4*l,6),A)||(o(g,u+1),o(_,u+1))}})(0)}raycast(e,t=p.Wl3){const i=this._roots,r=this.geometry,s=[],o=t.isMaterial,l=Array.isArray(t),u=r.groups,h=o?t.side:t;for(let f=0,g=i.length;f<g;f++){const _=l?t[u[f].materialIndex].side:h,A=s.length;if(Nb(i[f]),JS(0,r,_,e,s),s1(),l){const x=u[f].materialIndex;for(let E=A,T=s.length;E<T;E++)s[E].face.materialIndex=x}}return s}raycastFirst(e,t=p.Wl3){const i=this._roots,r=this.geometry,s=t.isMaterial,o=Array.isArray(t);let l=null;const u=r.groups,h=s?t.side:t;for(let f=0,g=i.length;f<g;f++){const _=o?t[u[f].materialIndex].side:h;Nb(i[f]);const A=$S(0,r,_,e);s1(),A!=null&&(l==null||A.distance<l.distance)&&(l=A,o&&(A.face.materialIndex=u[f].materialIndex))}return l}intersectsGeometry(e,t){const i=this.geometry;let r=!1;for(const s of this._roots)if(Nb(s),r=DD(0,i,e,t),s1(),r)break;return r}shapecast(e,t,i){const r=this.geometry;if(e instanceof Function){if(t){const _=t;t=(A,x,E,T)=>{const R=3*x;return _(A,R,R+1,R+2,E,T)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=fd.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:l,intersectsRange:u,intersectsTriangle:h}=e;if(u&&h){const _=u;u=(A,x,E,T,R)=>!!_(A,x,E,T,R)||L2(A,x,r,h,E,T,s)}else u||(u=h?(_,A,x,E)=>L2(_,A,r,h,x,E,s):(_,A,x)=>x);let f=!1,g=0;for(const _ of this._roots){if(Nb(_),f=RD(0,r,l,u,o,g),s1(),f)break;g+=_.byteLength}return fd.releasePrimitive(s),f}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:s}=i;const o=this.geometry.index,l=this.geometry.attributes.position,u=e.geometry.index,h=e.geometry.attributes.position;g_.copy(t).invert();const f=fd.getPrimitive(),g=fd.getPrimitive();if(s){let A=function(x,E,T,R,I,S,O,k){for(let N=T,H=T+R;N<H;N++){pd(g,3*N,u,h),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let X=x,te=x+E;X<te;X++)if(pd(f,3*X,o,l),f.needsUpdate=!0,s(f,g,X,N,I,S,O,k))return!0}return!1};if(r){const x=r;r=function(E,T,R,I,S,O,k,N){return!!x(E,T,R,I,S,O,k,N)||A(E,T,R,I,S,O,k,N)}}else r=A}e.getBoundingBox(rC),rC.applyMatrix4(t);const _=this.shapecast({intersectsBounds:A=>rC.intersectsBox(A),intersectsRange:(A,x,E,T,R,I)=>(iC.copy(I),iC.applyMatrix4(g_),e.shapecast({intersectsBounds:S=>iC.intersectsBox(S),intersectsRange:(S,O,k,N,H)=>r(A,x,S,O,T,R,N,H)}))});return fd.releasePrimitive(f),fd.releasePrimitive(g),_}intersectsBox(e,t){return iv.set(e.min,e.max,t),iv.needsUpdate=!0,this.shapecast({intersectsBounds:i=>iv.intersectsBox(i),intersectsTriangle:i=>iv.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),iv.set(e.boundingBox.min,e.boundingBox.max,t),iv.needsUpdate=!0;const l=this.geometry,u=l.attributes.position,h=l.index,f=e.attributes.position,g=e.index,_=fd.getPrimitive(),A=fd.getPrimitive();let x=a1,E=BD,T=null,R=null;r&&(T=OD,R=LD);let I=1/0,S=null,O=null;return g_.copy(t).invert(),Fb.matrix.copy(g_),this.shapecast({boundsTraverseOrder:k=>iv.distanceToBox(k),intersectsBounds:(k,N,H)=>H<I&&H<o&&(N&&(Fb.min.copy(k.min),Fb.max.copy(k.max),Fb.needsUpdate=!0),!0),intersectsRange:(k,N)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:H=>Fb.distanceToBox(H),intersectsBounds:(H,X,te)=>te<I&&te<o,intersectsRange:(H,X)=>{for(let te=3*H,re=3*(H+X);te<re;te+=3){pd(A,te,g,f),A.a.applyMatrix4(t),A.b.applyMatrix4(t),A.c.applyMatrix4(t),A.needsUpdate=!0;for(let ue=3*k,le=3*(k+N);ue<le;ue+=3){pd(_,ue,h,u),_.needsUpdate=!0;const se=_.distanceToTriangle(A,x,T);if(se<I&&(E.copy(x),R&&R.copy(T),I=se,S=ue/3,O=te/3),se<s)return!0}}}});for(let H=0,X=g?g.count:f.count;H<X;H+=3){pd(A,H,g,f),A.a.applyMatrix4(t),A.b.applyMatrix4(t),A.c.applyMatrix4(t),A.needsUpdate=!0;for(let te=3*k,re=3*(k+N);te<re;te+=3){pd(_,te,h,u),_.needsUpdate=!0;const ue=_.distanceToTriangle(A,x,T);if(ue<I&&(E.copy(x),R&&R.copy(T),I=ue,S=te/3,O=H/3),ue<s)return!0}}}}),fd.releasePrimitive(_),fd.releasePrimitive(A),I===1/0?null:(i.point?i.point.copy(E):i.point=E.clone(),i.distance=I,i.faceIndex=S,r&&(r.point?r.point.copy(R):r.point=R.clone(),r.point.applyMatrix4(g_),E.applyMatrix4(g_),r.distance=E.sub(r.point).length(),r.faceIndex=O),i)}closestPointToPoint(e,t={},i=0,r=1/0){const s=i*i,o=r*r;let l=1/0,u=null;if(this.shapecast({boundsTraverseOrder:f=>(jb.copy(e).clamp(f.min,f.max),jb.distanceToSquared(e)),intersectsBounds:(f,g,_)=>_<l&&_<o,intersectsTriangle:(f,g)=>{f.closestPointToPoint(e,jb);const _=e.distanceToSquared(jb);return _<l&&(a1.copy(jb),l=_,u=g),_<s}}),l===1/0)return null;const h=Math.sqrt(l);return t.point?t.point.copy(a1):t.point=a1.clone(),t.distance=h,t.faceIndex=u,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{hd(0,new Float32Array(t),U2),e.union(U2)}),e}}const kD=1e6*(1+1e-7);function nC(a){return~~(a*kD)}function N2(a){return`${nC(a.x)},${nC(a.y)},${nC(a.z)}`}const sC=[new p.Pa4,new p.Pa4,new p.Pa4];class UD{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const i=this.data[3*e+t];return i===-1?-1:~~(i/3)}getSiblingEdgeIndex(e,t){const i=this.data[3*e+t];return i===-1?-1:i%3}updateFrom(e){const t=new Map,{attributes:i}=e,r=e.index,s=i.position;let o=r?r.count/3:s.count/3;const l=o;let u=0;this.useDrawRange&&(u=e.drawRange.start,e.drawRange.count!==1/0&&(o=~~(e.drawRange.count/3)));let h=this.data;(!h||h.length<3*l)&&(h=new Int32Array(3*l)),h.fill(-1);let f=0,g=0;for(let _=0;_<o;_++){const A=3*_+u;for(let x=0;x<3;x++){let E=A+x;r&&(E=r.getX(E)),sC[x].fromBufferAttribute(s,E)}for(let x=0;x<3;x++){const E=(x+1)%3,T=sC[x],R=sC[E],I=N2(T),S=N2(R),O=`${S}_${I}`;if(t.has(O)){const k=t.get(O);h[A+x]=k,h[k]=A+x,t.delete(O),f--,g++}else{const k=`${I}_${S}`;t.set(k,A+x),f++}}}this.matchedEdges=g,this.unmatchedEdges=f,this.data=h}}class o1 extends p.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new p.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,i=e.elements,r=t.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(h2())for(const i in t){const r=t[i];if(r.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");r.array=_D(r.array)}if(e.boundsTree||(e.boundsTree=new zb(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new UD(e)),!e.groupIndices){const i=e.index.count/3,r=new Uint16Array(i),s=e.groups;for(let o=0,l=s.length;o<l;o++){const{start:u,count:h}=s[o];for(let f=u/3,g=(u+h)/3;f<g;f++)r[f]=o}e.groupIndices=r}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function F2(a,e){let t=e;return Array.isArray(e)||(t=[],a.forEach(i=>{t[i.materialIndex]=e})),t}class ND{constructor(){this.triangleSplitter=new vD,this.attributeData=new yD,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new AD}evaluate(e,t,i,r=new o1){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:s,attributeData:o,attributes:l,useGroups:u,debug:h}=this,f=r.geometry,g=e.geometry.attributes;for(let R=0,I=l.length;R<I;R++){const S=l[R],O=g[S];o.initializeArray(S,O.array.constructor)}for(const R in o.attributes)l.includes(R)||o.delete(R);for(const R in f.attributes)l.includes(R)||(f.deleteAttribute(R),f.dispose());o.clear(),h.enabled&&(h.reset(),b2(h)),function(R,I,S,O,k,N){const{useGroups:H=!0}=N,{aIntersections:X,bIntersections:te}=function(ue,le){const se=new f2,de=new f2;return m2.copy(ue.matrixWorld).invert().multiply(le.matrixWorld),ue.geometry.boundsTree.bvhcast(le.geometry.boundsTree,m2,{intersectsTriangles(ve,fe,Ee,Je){if(ve.intersectsTriangle(fe,VS,!0)){if(VS.distanceSq()===0&&ve.plane.normal.dot(fe.plane.normal)<1-1e-10)return!1;se.add(Ee,Je),de.add(Je,Ee),Qx&&(Qx.addEdge(VS),Qx.addIntersectingTriangles(Ee,ve,Je,fe))}return!1}}),{aIntersections:se,bIntersections:de}}(R,I);let re;re=H?0:-1,E2(R,I,X,S,!1,k,re),x2(R,I,X,S,!1,O,k,re),re=H?R.geometry.groups.length||1:-1,E2(I,R,te,S,!0,k,re),x2(I,R,te,S,!0,O,k,re)}(e,t,i,s,o,{useGroups:u}),h.enabled&&b2(null);const _=u&&e.geometry.groups.length!==0?e.geometry.groups.map(R=>({...R})):[{start:0,count:1/0,materialIndex:0}],A=u&&t.geometry.groups.length!==0?t.geometry.groups.map(R=>({...R})):[{start:0,count:1/0,materialIndex:0}],x=F2(_,e.material),E=F2(A,t.material);A.forEach(R=>{R.materialIndex+=x.length}),function(R,I,S,O){let k=!1,N=-1;const H=O.groupCount,X=R.attributes,te=O.groupAttributes[0];for(const ue in te){const le=O.getTotalLength(ue,H),se=te[ue].type;let de=X[ue];if(!de||de.array.length<le){const fe=I.attributes[ue];de=new p.TlE(new se(le),fe.itemSize,fe.normalized),R.setAttribute(ue,de),k=!0}let ve=0;for(let fe=0;fe<H;fe++){const{array:Ee,type:Je,length:Te}=O.groupAttributes[fe][ue],qe=new Je(Ee.buffer,0,Te);de.array.set(qe,ve),ve+=qe.length}de.needsUpdate=!0,N=le/de.itemSize}R.setDrawRange(0,N),R.clearGroups();let re=0;for(let ue=0;ue<H;ue++){const le=O.getGroupArray("position",ue).length/3;if(le!==0){const se=S[ue];R.addGroup(re,le,se.materialIndex),re+=le}}if(R.index){const ue=R.index.array;if(ue.length<N)R.index=null,k=!0;else for(let le=0,se=ue.length;le<se;le++)ue[le]=le}R.boundsTree=null,k&&R.dispose()}(f,e.geometry,[..._,...A],o);const T=f.groups;if(u){const R=new Map,I=[...x,...E];let S=0;for(let O=0,k=I.length;O<k;O++)T.find(N=>N.materialIndex===O)?(R.set(O,S),S++):I[O]=null;for(let O=0,k=T.length;O<k;O++){const N=T[O];N.materialIndex=R.get(N.materialIndex)}r.material=I.filter(O=>O)}return r}evaluateHierarchy(e,t=new o1){e.updateMatrixWorld(!0);const i=(s,o)=>{const l=s.children;for(let u=0,h=l.length;u<h;u++){const f=l[u];f.isOperationGroup?i(f,o):o(f)}},r=s=>{const o=s.children;let l=!1;for(let h=0,f=o.length;h<f;h++){const g=o[h];l=r(g)||l}const u=s.isDirty();if(u&&s.markUpdated(),l&&!s.isOperationGroup){let h;return i(s,f=>{h=h?this.evaluate(h,f,f.operation):this.evaluate(s,f,f.operation)}),s._cachedGeometry=h.geometry,s._cachedMaterials=h.material,!0}return l||u};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const j2={union:a2,subtract:o2,intersect:c2,difference:l2};function z2(a,e){const t=new ND;t.useGroups=!0,t.attributes=["position","normal","uv"],a.forEach(s=>{for(const o of[...t.attributes])s[0].geometry.getAttribute(o)||t.attributes.splice(t.attributes.indexOf(o),1)});let i=new o1(new p._12(.01,.01,2,2));a.forEach(([s,o])=>{if(!Object.keys(j2).includes(o))return void console.error(`Unknown operation ${o}`);s.updateMatrix(),s.updateMatrixWorld();const l=new o1;l.geometry=s.geometry,l.material=s.material,s.matrixWorld.decompose(l.position,l.quaternion,l.scale),l.updateMatrix(),l.updateMatrixWorld(),i=t.evaluate(i,l,j2[o])});const r=i;return r.userData._isCSGMesh=!0,r}let Vb=class extends Dp{_buildCSGMesh(a){return z2(a)}};Vb.PluginType="CSGPluginBVH",Vb=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}([zi("CSG Plugin (BVH)")],Vb);class Gb extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,i,r,s;(i=(t=e.lastCamera)===null||t===void 0?void 0:t.removeControlsCtor)===null||i===void 0||i.call(t,this.controlsKey),(s=(r=e.camera)===null||r===void 0?void 0:r.setControlsCtor)===null||s===void 0||s.call(r,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var V2=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const FD=new p.Pa4(0,0,1),G2=new p.USm,jD=new p._fP,zD=new p._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),v_=new p._fP,VD={type:"change"};let Hb=class extends V.SimpleEventDispatcher{constructor(a){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new p._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new p._fP,this._initQuaternionInvert=new p._fP,this._initQuaternionDest=new p._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=a,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(a=>{a=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(a=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",a)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new p._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const a=this.deviceOrientation;if(a){const e=a.alpha!==null?p.M8C.degToRad(a.alpha):0,t=a.beta!==null?p.M8C.degToRad(a.beta):0,i=a.gamma!==null?p.M8C.degToRad(a.gamma):0,r=this.screenOrientation?p.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,i,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(VD))}}dispose(){this.disconnect()}setObjectQuaternion(a,e,t,i){const r=(0,V.now)()/1e3;G2.set(e,a,-t,"YXZ"),v_.setFromEuler(G2),v_.multiply(zD),v_.multiply(jD.setFromAxisAngle(FD,-i)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(v_).invert(),this._initQuaternionDest.__init=!0),v_.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(v_,this.dampingFactor/(Math.min(1,r-this._lastTime)/(1/60))),this._lastTime=r}};V2([ae(),ai("Damping",[0,1],.01)],Hb.prototype,"dampingFactor",void 0),Hb=V2([Lc("Device Orientation Controls")],Hb);class aC extends Gb{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new Hb(e)}}aC.PluginType="DeviceOrientationControlsPlugin";var Oo=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const H2=new p.Pa4,oC=new p.$V,lC=new p.Pa4,GD={type:"change"};let Ea=class extends V.SimpleEventDispatcher{constructor(a,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new p.Pa4,this._lastTime=-1,this.object=a,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const a=this.object.quaternion;H2.set(0,0,-1).applyQuaternion(a),oC.setFromVector3(H2),this.lat=90-p.M8C.radToDeg(oC.phi),this.lon=p.M8C.radToDeg(oC.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(a){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(a){if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(a){this.domElement===document?(this.pointerX=a.pageX-this.viewHalfX,this.pointerY=a.pageY-this.viewHalfY):(this.pointerX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=a.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(a){if(this.enableKeys)switch(a.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(a,e,t){return a.isVector3?lC.copy(a):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):lC.set(a,e,t),this.object.lookAt(lC),this.setOrientation(),this}update(){const a=(0,V.now)(),e=(this._lastTime<0?16:Math.min(a-this._lastTime,1e3))/1e3;if(this._lastTime=a,!this.enabled)return;if(this.heightSpeed){const u=p.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(u*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let i=e*this.lookSpeed;this.activeLook||(i=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*i,this.lookVertical&&(this.lat-=this.pointerY*i*r),this.lat=Math.max(-85,Math.min(85,this.lat));let s=p.M8C.degToRad(90-this.lat);const o=p.M8C.degToRad(this.lon);this.constrainVertical&&(s=p.M8C.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;this.targetPosition.setFromSphericalCoords(1,s,o).add(l),this.object.lookAt(this.targetPosition),this.dispatchEvent(GD)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(a){this.enableKeys&&a.preventDefault()}};Oo([ae(),Ot()],Ea.prototype,"enabled",void 0),Oo([ae(),Ot()],Ea.prototype,"enableKeys",void 0),Oo([ae(),Ci()],Ea.prototype,"movementSpeed",void 0),Oo([ae(),Ci()],Ea.prototype,"lookSpeed",void 0),Oo([ae(),Ot()],Ea.prototype,"lookVertical",void 0),Oo([ae(),Ot()],Ea.prototype,"autoForward",void 0),Oo([ae(),Ot()],Ea.prototype,"activeLook",void 0),Oo([ae(),Ot()],Ea.prototype,"heightSpeed",void 0),Oo([ae(),Ci()],Ea.prototype,"heightCoef",void 0),Oo([ae(),Ci()],Ea.prototype,"heightMin",void 0),Oo([ae(),Ci()],Ea.prototype,"heightMax",void 0),Oo([ae(),Ot()],Ea.prototype,"constrainVertical",void 0),Oo([ae(),Ci()],Ea.prototype,"verticalMin",void 0),Oo([ae(),Ci()],Ea.prototype,"verticalMax",void 0),Oo([ae(),Ot()],Ea.prototype,"mouseDragOn",void 0),Ea=Oo([zi("First Person Controls")],Ea);class cC extends Gb{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new Ea(e,t)}}cC.PluginType="FirstPersonControlsPlugin";var __=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};const y_=new p.USm(0,0,0,"YXZ"),b_=new p.Pa4,HD={type:"change"},QD={type:"lock"},WD={type:"unlock"},Q2=Math.PI/2;let Np=class extends V.SimpleEventDispatcher{constructor(a,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new p.Pa4(0,0,-1),this.domElement=e,this.object=a,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(a){this.isLocked||this.autoLockOnClick&&(a.preventDefault(),this.lock())}onMouseMove(a){this.isLocked&&(this._movementX+=a.movementX||a.mozMovementX||a.webkitMovementX||0,this._movementY+=a.movementY||a.mozMovementY||a.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(QD),this.isLocked=!0):(this.dispatchEvent(WD),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(a){return a.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(a){b_.setFromMatrixColumn(this.object.matrix,0),b_.crossVectors(this.object.up,b_),this.object.position.addScaledVector(b_,a)}moveRight(a){b_.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(b_,a)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(y_.setFromQuaternion(this.object.quaternion),y_.y-=.002*this._movementX*this.pointerSpeed,y_.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,y_.x=Math.max(Q2-this.maxPolarAngle,Math.min(Q2-this.minPolarAngle,y_.x)),this.object.quaternion.setFromEuler(y_),this.dispatchEvent(HD))}};__([Ot(),ae()],Np.prototype,"enabled",void 0),__([Ci(),ae()],Np.prototype,"minPolarAngle",void 0),__([Ci(),ae()],Np.prototype,"maxPolarAngle",void 0),__([Ci(),ae()],Np.prototype,"pointerSpeed",void 0),__([Ot(),ae()],Np.prototype,"autoLockOnClick",void 0),Np=__([Lc("Pointer Lock Controls")],Np);class uC extends Gb{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new Np(e,t.ownerDocument?t:t.documentElement)}}uC.PluginType="PointerLockControlsPlugin";const hC={type:"change"},dC={type:"start"},pC={type:"end"};class XD extends p.pBf{constructor(e,t){super();const i=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:p.RsA.ROTATE,MIDDLE:p.RsA.DOLLY,RIGHT:p.RsA.PAN},this.target=new p.Pa4;const s=1e-6,o=new p.Pa4;let l=1,u=r.NONE,h=r.NONE,f=0,g=0,_=0;const A=new p.Pa4,x=new p.FM8,E=new p.FM8,T=new p.Pa4,R=new p.FM8,I=new p.FM8,S=new p.FM8,O=new p.FM8,k=[],N={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const Te=i.domElement.getBoundingClientRect(),qe=i.domElement.ownerDocument.documentElement;i.screen.left=Te.left+window.pageXOffset-qe.clientLeft,i.screen.top=Te.top+window.pageYOffset-qe.clientTop,i.screen.width=Te.width,i.screen.height=Te.height};const H=function(){const Te=new p.FM8;return function(qe,Ve){return Te.set((qe-i.screen.left)/i.screen.width,(Ve-i.screen.top)/i.screen.height),Te}}(),X=function(){const Te=new p.FM8;return function(qe,Ve){return Te.set((qe-.5*i.screen.width-i.screen.left)/(.5*i.screen.width),(i.screen.height+2*(i.screen.top-Ve))/i.screen.width),Te}}();function te(Te){i.enabled!==!1&&(k.length===0&&(i.domElement.setPointerCapture(Te.pointerId),i.domElement.addEventListener("pointermove",re),i.domElement.addEventListener("pointerup",ue)),function(qe){k.push(qe)}(Te),Te.pointerType==="touch"?function(qe){if(Je(qe),k.length===1)u=r.TOUCH_ROTATE,E.copy(X(k[0].pageX,k[0].pageY)),x.copy(E);else{u=r.TOUCH_ZOOM_PAN;const Ve=k[0].pageX-k[1].pageX,Ye=k[0].pageY-k[1].pageY;g=f=Math.sqrt(Ve*Ve+Ye*Ye);const Tt=(k[0].pageX+k[1].pageX)/2,Xe=(k[0].pageY+k[1].pageY)/2;S.copy(H(Tt,Xe)),O.copy(S)}i.dispatchEvent(dC)}(Te):function(qe){if(u===r.NONE)switch(qe.button){case i.mouseButtons.LEFT:u=r.ROTATE;break;case i.mouseButtons.MIDDLE:u=r.ZOOM;break;case i.mouseButtons.RIGHT:u=r.PAN}const Ve=h!==r.NONE?h:u;Ve!==r.ROTATE||i.noRotate?Ve!==r.ZOOM||i.noZoom?Ve!==r.PAN||i.noPan||(S.copy(H(qe.pageX,qe.pageY)),O.copy(S)):(R.copy(H(qe.pageX,qe.pageY)),I.copy(R)):(E.copy(X(qe.pageX,qe.pageY)),x.copy(E)),i.dispatchEvent(dC)}(Te))}function re(Te){i.enabled!==!1&&(Te.pointerType==="touch"?function(qe){if(Je(qe),k.length===1)x.copy(E),E.copy(X(qe.pageX,qe.pageY));else{const Ve=function(di){const Ai=di.pointerId===k[0].pointerId?k[1]:k[0];return N[Ai.pointerId]}(qe),Ye=qe.pageX-Ve.x,Tt=qe.pageY-Ve.y;g=Math.sqrt(Ye*Ye+Tt*Tt);const Xe=(qe.pageX+Ve.x)/2,Zt=(qe.pageY+Ve.y)/2;O.copy(H(Xe,Zt))}}(Te):function(qe){const Ve=h!==r.NONE?h:u;Ve!==r.ROTATE||i.noRotate?Ve!==r.ZOOM||i.noZoom?Ve!==r.PAN||i.noPan||O.copy(H(qe.pageX,qe.pageY)):I.copy(H(qe.pageX,qe.pageY)):(x.copy(E),E.copy(X(qe.pageX,qe.pageY)))}(Te))}function ue(Te){i.enabled!==!1&&(Te.pointerType==="touch"?function(qe){switch(k.length){case 0:u=r.NONE;break;case 1:u=r.TOUCH_ROTATE,E.copy(X(qe.pageX,qe.pageY)),x.copy(E);break;case 2:u=r.TOUCH_ZOOM_PAN;for(let Ve=0;Ve<k.length;Ve++)if(k[Ve].pointerId!==qe.pointerId){const Ye=N[k[Ve].pointerId];E.copy(X(Ye.x,Ye.y)),x.copy(E);break}}i.dispatchEvent(pC)}(Te):(u=r.NONE,i.dispatchEvent(pC)),Ee(Te),k.length===0&&(i.domElement.releasePointerCapture(Te.pointerId),i.domElement.removeEventListener("pointermove",re),i.domElement.removeEventListener("pointerup",ue)))}function le(Te){Ee(Te)}function se(Te){i.enabled!==!1&&(window.removeEventListener("keydown",se),h===r.NONE&&(Te.code!==i.keys[r.ROTATE]||i.noRotate?Te.code!==i.keys[r.ZOOM]||i.noZoom?Te.code!==i.keys[r.PAN]||i.noPan||(h=r.PAN):h=r.ZOOM:h=r.ROTATE))}function de(){i.enabled!==!1&&(h=r.NONE,window.addEventListener("keydown",se))}function ve(Te){if(i.enabled!==!1&&i.noZoom!==!0){switch(Te.preventDefault(),Te.deltaMode){case 2:R.y-=.025*Te.deltaY;break;case 1:R.y-=.01*Te.deltaY;break;default:R.y-=25e-5*Te.deltaY}i.dispatchEvent(dC),i.dispatchEvent(pC)}}function fe(Te){i.enabled!==!1&&Te.preventDefault()}function Ee(Te){delete N[Te.pointerId];for(let qe=0;qe<k.length;qe++)if(k[qe].pointerId==Te.pointerId)return void k.splice(qe,1)}function Je(Te){let qe=N[Te.pointerId];qe===void 0&&(qe=new p.FM8,N[Te.pointerId]=qe),qe.set(Te.pageX,Te.pageY)}this.rotateCamera=function(){const Te=new p.Pa4,qe=new p._fP,Ve=new p.Pa4,Ye=new p.Pa4,Tt=new p.Pa4,Xe=new p.Pa4;return function(){Xe.set(E.x-x.x,E.y-x.y,0);let Zt=Xe.length();Zt?(A.copy(i.object.position).sub(i.target),Ve.copy(A).normalize(),Ye.copy(i.object.up).normalize(),Tt.crossVectors(Ye,Ve).normalize(),Ye.setLength(E.y-x.y),Tt.setLength(E.x-x.x),Xe.copy(Ye.add(Tt)),Te.crossVectors(Xe,A).normalize(),Zt*=i.rotateSpeed,qe.setFromAxisAngle(Te,Zt),A.applyQuaternion(qe),i.object.up.applyQuaternion(qe),T.copy(Te),_=Zt):!i.staticMoving&&_&&(_*=Math.sqrt(1-i.dynamicDampingFactor),A.copy(i.object.position).sub(i.target),qe.setFromAxisAngle(T,_),A.applyQuaternion(qe),i.object.up.applyQuaternion(qe)),x.copy(E)}}(),this.zoomCamera=function(){let Te;u===r.TOUCH_ZOOM_PAN?(Te=f/g,f=g,i.object.isPerspectiveCamera?A.multiplyScalar(Te):i.object.isOrthographicCamera?(i.object.zoom=p.M8C.clamp(i.object.zoom/Te,i.minZoom,i.maxZoom),l!==i.object.zoom&&i.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(Te=1+(I.y-R.y)*i.zoomSpeed,Te!==1&&Te>0&&(i.object.isPerspectiveCamera?A.multiplyScalar(Te):i.object.isOrthographicCamera?(i.object.zoom=p.M8C.clamp(i.object.zoom/Te,i.minZoom,i.maxZoom),l!==i.object.zoom&&i.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),i.staticMoving?R.copy(I):R.y+=(I.y-R.y)*this.dynamicDampingFactor)},this.panCamera=function(){const Te=new p.FM8,qe=new p.Pa4,Ve=new p.Pa4;return function(){if(Te.copy(O).sub(S),Te.lengthSq()){if(i.object.isOrthographicCamera){const Ye=(i.object.right-i.object.left)/i.object.zoom/i.domElement.clientWidth,Tt=(i.object.top-i.object.bottom)/i.object.zoom/i.domElement.clientWidth;Te.x*=Ye,Te.y*=Tt}Te.multiplyScalar(A.length()*i.panSpeed),Ve.copy(A).cross(i.object.up).setLength(Te.x),Ve.add(qe.copy(i.object.up).setLength(Te.y)),i.object.position.add(Ve),i.target.add(Ve),i.staticMoving?S.copy(O):S.add(Te.subVectors(O,S).multiplyScalar(i.dynamicDampingFactor))}}}(),this.checkDistances=function(){i.noZoom&&i.noPan||(A.lengthSq()>i.maxDistance*i.maxDistance&&(i.object.position.addVectors(i.target,A.setLength(i.maxDistance)),R.copy(I)),A.lengthSq()<i.minDistance*i.minDistance&&(i.object.position.addVectors(i.target,A.setLength(i.minDistance)),R.copy(I)))},this.update=function(){A.subVectors(i.object.position,i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.addVectors(i.target,A),i.object.isPerspectiveCamera?(i.checkDistances(),i.object.lookAt(i.target),o.distanceToSquared(i.object.position)>s&&(i.dispatchEvent(hC),o.copy(i.object.position))):i.object.isOrthographicCamera?(i.object.lookAt(i.target),(o.distanceToSquared(i.object.position)>s||l!==i.object.zoom)&&(i.dispatchEvent(hC),o.copy(i.object.position),l=i.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){u=r.NONE,h=r.NONE,i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.up.copy(i.up0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),A.subVectors(i.object.position,i.target),i.object.lookAt(i.target),i.dispatchEvent(hC),o.copy(i.object.position),l=i.object.zoom},this.dispose=function(){i.domElement.removeEventListener("contextmenu",fe),i.domElement.removeEventListener("pointerdown",te),i.domElement.removeEventListener("pointercancel",le),i.domElement.removeEventListener("wheel",ve),i.domElement.removeEventListener("pointermove",re),i.domElement.removeEventListener("pointerup",ue),window.removeEventListener("keydown",se),window.removeEventListener("keyup",de)},this.domElement.addEventListener("contextmenu",fe),this.domElement.addEventListener("pointerdown",te),this.domElement.addEventListener("pointercancel",le),this.domElement.addEventListener("wheel",ve,{passive:!1}),window.addEventListener("keydown",se),window.addEventListener("keyup",de),this.handleResize(),this.update()}}var Lo=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Va=class extends XD{constructor(a,e){super(a,e),this.type="TrackballControls",this.enabled=!0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=999999,this.minZoom=0,this.maxZoom=999999,this.object=a}};Lo([ae()],Va.prototype,"type",void 0),Lo([Ot()],Va.prototype,"enabled",void 0),Lo([Ci(),ae()],Va.prototype,"rotateSpeed",void 0),Lo([Ci(),ae()],Va.prototype,"zoomSpeed",void 0),Lo([Ci(),ae()],Va.prototype,"panSpeed",void 0),Lo([Ot(),ae()],Va.prototype,"noRotate",void 0),Lo([Ot(),ae()],Va.prototype,"noZoom",void 0),Lo([Ot(),ae()],Va.prototype,"noPan",void 0),Lo([Ot(),ae()],Va.prototype,"noRoll",void 0),Lo([Ot(),ae()],Va.prototype,"staticMoving",void 0),Lo([Ci(),ae()],Va.prototype,"dynamicDampingFactor",void 0),Lo([Ci(),ae()],Va.prototype,"minDistance",void 0),Lo([Ci(),ae()],Va.prototype,"maxDistance",void 0),Lo([Ci(),ae()],Va.prototype,"minZoom",void 0),Lo([Ci(),ae()],Va.prototype,"maxZoom",void 0),Va=Lo([Lc("Track Ball")],Va);class fC extends Gb{constructor(){super(...arguments),this.controlsKey="trackball",this._controlsCtor=(e,t)=>new Va(e,t.ownerDocument?t:t.documentElement)}}fC.PluginType="TrackballControlsPlugin";var mC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class A_ extends Si{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.simplifyFactor=.5}get initialized(){return!0}async initialize(){}async onAdded(e){await super.onAdded(e),this._pickingPlugin=e.getPlugin(fr)}simplifyGeometries(e,t){var i;if(!e){const s=(i=this._pickingPlugin)===null||i===void 0?void 0:i.getSelectedObject(),o=[];if(s==null||s.traverse(l=>{l.geometry&&!o.includes(l.geometry)&&o.push(l.geometry)}),!(e=o)||!e.length)return}Array.isArray(e)||(e=[e]);const r=[];for(const s of e)r.push(this.simplifyGeometry(s,t));return r}simplifyGeometry(e,{factor:t,count:i,replace:r=!0,disposeOnReplace:s=!1}={}){var o,l,u;if(!e){const R=(o=this._pickingPlugin)===null||o===void 0?void 0:o.getSelectedObject();if(!(e=R==null?void 0:R.geometry))return}if(!e.attributes.position)return(l=this._viewer)===null||l===void 0||l.console.error("SimplifyModifierPlugin: Geometry does not have position attribute",e),e;t=t||this.simplifyFactor,i=i||e.attributes.position.count*t,e.boundingBox||e.computeBoundingBox();const h=this._simplify(e,i);h.computeBoundingBox(),h.computeBoundingSphere(),h.computeVertexNormals();const f=h.boundingBox,g=f.getSize(new p.Pa4);if(!isFinite(g.x)||!isFinite(g.y)||!isFinite(g.z))return(u=this._viewer)===null||u===void 0||u.console.error("SimplifyModifierPlugin: Unable to simplify",e,h,g),e;const _=e.boundingBox,A=_.getSize(new p.Pa4),x=g.clone().sub(A),E=x.clone().divide(A);if(E.lengthSq()>.001&&console.warn("Simplify",e,h,f,_,g,A,x,E),!r)return h;const T=e.userData.__appliedMeshes;if(!T)return console.error("No meshes found for geometry, cannot replace",e),h;for(const R of T)R.setGeometry?R.setGeometry(h):R.geometry=h;return s&&e.dispose(!0),h}async simplifyAll(e,t){var i;if(!e&&this._viewer&&(e=this._viewer.scene.modelRoot),!e)return void console.error("SimplifyModifierPlugin: No root found");if(!this.initialized&&(await this.initialize(),!this.initialized))return void((i=this._viewer)===null||i===void 0||i.console.error("SimplifyModifierPlugin cannot be initialized"));const r=[];if(e.modelObject.traverse(s=>{s.geometry&&!r.includes(s.geometry)&&r.push(s.geometry)}),r.length)return this.simplifyGeometries(r,t);console.error("SimplifyModifierPlugin: No geometries found")}async simplifySelected(){var e;if(!this._viewer)return;if(!this.initialized&&(await this.initialize(),!this.initialized))return void await this._viewer.alert("Simplify: SimplifyModifierPlugin cannot be initialized");const t=(e=this._pickingPlugin)===null||e===void 0?void 0:e.getSelectedObject();if(!t)return void await this._viewer.alert("Simplify: Nothing Selected");let i=!1;t.geometry?t.children.length===0&&(i=!0):i=!0,i||await this._viewer.confirm("Simplify: Simplify all in hierarchy?")&&(i=!0),i?this.simplifyGeometries():this.simplifyGeometry(t.geometry)}}A_.PluginType="SimplifyModifierPlugin",mC([ai("Simplify Factor",[0,1])],A_.prototype,"simplifyFactor",void 0),mC([Xi("Simplify All",{sendArgs:!1})],A_.prototype,"simplifyAll",null),mC([Xi("Simplify Selected")],A_.prototype,"simplifySelected",null);var gC,vC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let md=gC=class extends A_{constructor(a=!0,e=document.head){super(),this.rootNode=e,this._initializing=void 0,this.errorThreshold=.5,this.lockBorder=!1,a&&this.initialize()}get initialized(){return!!window.MeshoptSimplifier}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const a=document.createElement("script");a.type="module";const e=Math.random().toString(36).substring(7);return a.innerHTML=`
import { MeshoptSimplifier } from '${gC.SIMPLIFIER_URL}';
MeshoptSimplifier.ready.then(() => {
window.MeshoptSimplifier = MeshoptSimplifier;
window.dispatchEvent(new CustomEvent('${e}'))
});
`,this._initializing=new Promise(t=>{window.addEventListener(e,()=>t(),{once:!0}),this.rootNode.appendChild(a),this._script=a}),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptSimplifier),this._script=void 0}_simplify(a,e){if(!this.initialized)throw new Error("MeshOptSimplifyModifierPlugin not initialized");const t=(a=a.index?a.clone():rr(a)).index.array,i=a.attributes.position.array,r=e/a.attributes.position.count,s=3*Math.floor(r*t.length/3),[o,l]=window.MeshoptSimplifier.simplify(t,i,3,s,this.errorThreshold,this.lockBorder?["LockBorder"]:[]);return console.log("srcCount",t.length/3,"destCount",o.length/3),l&&console.log("Simplify error",l),a.setIndex(new p.TlE(new Uint32Array(o),1)),a}};md.PluginType="MeshOptSimplifyModifierPlugin",md.SIMPLIFIER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_simplifier.module.js",vC([Ci()],md.prototype,"errorThreshold",void 0),vC([Ot()],md.prototype,"lockBorder",void 0),md=gC=vC([zi("Simplify Modifier (meshopt)")],md);class W2{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new p.SUY}loadModel(e){this._model=e,this.mixer=new p.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var t;const i=[];(t=this._animations)===null||t===void 0||t.forEach(r=>{i.push(this.playClip(r,e))}),await Promise.all(i)}async reverseAllAnimation(e){var t;const i=[];(t=this._animations)===null||t===void 0||t.forEach(r=>{i.push(this.playClip(r,e,1,!0))}),await Promise.all(i)}async playClip(e,t,i=1,r=!1,s=!1){if(!this.mixer)return;const o=this.mixer.clipAction(e);return this._playingAnimations.has(o)&&this.mixer.dispatchEvent({type:"canceled",action:o}),s&&(this.mixer.setTime(0),this.mixer.stopAllAction()),r?(o.paused=!1,o.timeScale=-i):(o.reset(),o.timeScale=i),o.loop=t?p.YKA:p.jAl,o.clampWhenFinished=!0,new Promise(l=>{const u=async h=>{h.action===o&&(this.mixer.removeEventListener("finished",u),this.mixer.removeEventListener("canceled",u),this._playingAnimations.delete(o),l())};this.mixer.addEventListener("finished",u),this.mixer.addEventListener("canceled",u),this._playingAnimations.add(o),o.play()})}playClipByName(e,t,i=1,r=!1){let s;this._animations.forEach(o=>{o.name===e&&(s=o)}),s&&this.playClip(s,t,i,r)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class X2 extends Si{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),(t=this._viewer)===null||t===void 0||t.addEventListener("postFrame",()=>{this.helperIdentities.forEach(i=>{var r;i.update()&&((r=this._viewer)===null||r===void 0||r.setDirty())})})}createHelper(e,t){var i;if(this.helperIdentities.has(e))(i=this._viewer)===null||i===void 0||i.console.warn("Helper with this id already exists");else{const r=new W2;r.loadModel(t),this.helperIdentities.set(e,r)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,i,r=1,s=!1,o=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(t,i,r,s,o)}async playAllAnimations(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(t)}async playAllAnimationsInReverse(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(t)}async playAnimationByName(e,t,i,r=1,s=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(t,i,r,s)}}X2.PluginType="AnimationHelperPlugin";class Qb extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,i)=>{(0,V.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,({state:i,progress:r})=>{this.dispatchEvent({type:"transferFile",path:t,state:i??"exporting",progress:r})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}Qb.PluginType="FileTransferPlugin";var w_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class gd extends Si{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:p.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[Ir],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=t=>{this._preFrame(t)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t,i;return(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ir))===null||t===void 0?void 0:t.camViews)!==null&&i!==void 0?i:[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var t;if(!this.enabled)return;const i=this._cameraViews;if(i.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=p.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=p.M8C.clamp(this._oldState,0,i.length-1.001);const r=Math.floor(this._oldState),s=this._overrideStartView||i[r],o=this._overrideEndView||i[r+1];let l,u=this._overrideStartView?this._overrideTime:this._oldState-r;u=el[this.animEase](u),l=this.interpolateMode==="spherical"?this._lerpViewsSpherical(s,o,u):this._lerpViewsLinear(s,o,u);const h=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera;h&&(h.position.copy(l[0]),h.target.copy(l[1]),h.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,i){const r=new p.Pa4,s=new p.Pa4;return s.lerpVectors(e.position,t.position,i),r.lerpVectors(e.target,t.target,i),[s,r]}_lerpViewsSpherical(e,t,i){const r=e.target.clone(),s=new p.Pa4,o=new p.Pa4,l=gp(e,e.target),u=gp(t,t.target),h=new p.$V;return h.phi=Yf(l.phi,u.phi,i),h.theta=Yf(l.theta,u.theta,i),h.radius=p.M8C.lerp(l.radius,u.radius,i),s.copy(r).lerp(t.target,i),o.setFromSpherical(h),o.add(s),[o,s]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new yn(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),i=this._oldState-t;let r;r=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[t],e[t+1],i):this._lerpViewsLinear(e[t],e[t+1],i),this._overrideEndView=new yn(r[0],r[1]),this._overrideTime=0}}gd.PluginType="CameraViewControlPlugin",w_([Ot("Enabled"),(0,V.onChange)(gd.prototype._onEnabledChanged1),ae()],gd.prototype,"enabled",void 0),w_([ae(),Fs("Ease",Object.keys(el).map(a=>({label:a})))],gd.prototype,"animEase",void 0),w_([ae(),Fs("Interpolation",["spherical","linear"].map(a=>({label:a})))],gd.prototype,"interpolateMode",void 0),w_([Ot("Enable Damping"),ae()],gd.prototype,"enableDamping",void 0),w_([ai("Damping",[.01,1],.001),ae()],gd.prototype,"damping",void 0),w_([ai("Init Anim Time",[.01,5],.001),ae()],gd.prototype,"initAnimationTime",void 0);class _C extends gd{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...Qa(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){var t;if(this.enabled&&!(this._cameraViews.length<=1))try{const i=this._findActiveView(),r=this._getScroll(i);this.setState(r+i),super._preFrame(e)}catch(i){return void(((t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Debug"))&&console.error(i))}}_getScroll(e){var t,i;if(e>=this._cameraViews.length-1)return 0;const r=(t=this.parent.querySelector(this._cameraViews[e].name))!==null&&t!==void 0?t:this.parent.getElementsByTagName("section")[e],s=(i=this.parent.querySelector(this._cameraViews[e+1].name))!==null&&i!==void 0?i:this.parent.getElementsByTagName("section")[e+1],o=this.parent.getBoundingClientRect();if(!r||!s)return 0;const l=r.getBoundingClientRect(),u=s.getBoundingClientRect(),h=this.parent===document.body?0:o.top;return p.M8C.clamp((h-l.top)/Math.max(u.top-l.top,1e-4),0,1)}_findActiveView(){var e,t;for(let i=this._cameraViews.length-1;i>=0;i--){const r=(e=this.parent.querySelector(this._cameraViews[i].name))!==null&&e!==void 0?e:this.parent.getElementsByTagName("section")[i],s=this.parent.getBoundingClientRect();if(r){if(r.getBoundingClientRect().top<(this.parent===document.body?0:s.top))return i}else!((t=this._cameraViews[i].name)===null||t===void 0)&&t.startsWith("#")&&console.error("section with id "+this._cameraViews[i].name+" doesn't exist!")}return 0}}_C.PluginType="ScrollableCameraViewPlugin";var yC,bC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let fm=yC=class extends _C{generateCode(){var a;const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="200";const t=document.createElement("textarea");t.rows=20,t.style.border="3px solid #27223a",t.style.borderRadius="5px",t.style.width="30%",t.style.padding="5px",t.style.zIndex="1000";const i=document.createElement("div");i.textContent="X",i.style.color="red",i.style.width="20px",i.style.height="20px",i.style.padding="2",i.style.textAlign="center",i.style.backgroundColor="white",i.style.borderRadius="100%",i.style.border="2px solid #27223a",i.style.cursor="pointer",i.addEventListener("click",()=>{var s;(s=this._viewer)===null||s===void 0||s.container.removeChild(e)});const r=document.createElement("div");r.textContent="Update",r.style.marginTop="10px",r.style.color="white",r.style.padding="4px 10px 4px 10px",r.style.justifyContent="center",r.style.alignItems="center",r.style.backgroundColor="green",r.style.borderRadius="10px",r.style.border="2px solid #fff",r.style.cursor="pointer",r.addEventListener("click",()=>{var s,o;const l=this.parent.innerHTML;this.parent.innerHTML=t.value;let u=0;for(;u<this._cameraViews.length;u++){let h;try{h=(s=this.parent.querySelector(this._cameraViews[u].name))!==null&&s!==void 0?s:this.parent.getElementsByTagName("section")[u]}catch{h=null}if(!h&&u<2){alert("you need to add 2 sections at least");break}if(!h){const f=((o=this._cameraViews[u].name)===null||o===void 0||o.startsWith("#"),this._cameraViews[u].name.replace(/^#/,""));t.value+=f,t.value=this._format(t.value)}}u<2?this.parent.innerHTML=l:async function(h,f){var g;h.innerHTML=f;const _=h.getElementsByTagName("script");for(let A=0;A<_.length;A++){const x=_[A],E=jP(x);let T=!1;await new Promise(R=>{E.onload=R,E.onerror=()=>{T=!0,R(void 0)}}),T||(g=x.parentNode)===null||g===void 0||g.replaceChild(E,x)}}(this.parent,t.value)}),e.appendChild(i),e.appendChild(t),e.appendChild(r),t.value=this._format(this.parent.innerHTML),(a=this._viewer)===null||a===void 0||a.container.appendChild(e)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(a=document.body,e=!1){super(a,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(a){var e,t,i,r,s,o;this.parent=this.wrapper,await super.onAdded(a),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ir))===null||t===void 0||t.addEventListener("viewDelete",this.deleteView),(r=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Ir))===null||r===void 0||r.addEventListener("deserialize",this.deserialize),(o=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Ir))===null||o===void 0||o.addEventListener("viewAdd",this.addView)}deserialize(a){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var a;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(a=this._viewer)===null||a===void 0||a.container.appendChild(this.wrapper)}_createSection(a){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=a,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=a,this.parent.appendChild(e)}addView(a){this._cameraViews.forEach((e,t)=>{var i,r;let s;try{s=(i=this.parent.querySelector(e.name))!==null&&i!==void 0?i:this.parent.getElementsByTagName("section")[t]}catch{s=null}if(!s){const o=`<section id="${!((r=e.name)===null||r===void 0)&&r.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=o}})}deleteView(a){var e;try{const t=(e=this.parent.querySelector(a.view.name))!==null&&e!==void 0?e:this.parent.getElementsByTagName("section").namedItem(a.view.name);t==null||t.remove()}catch{return}}_format(a){let e="",t="";return a.split(/>\s*</).forEach(function(i){i.match(/^\/\w/)&&(t=t.substring(1)),e+=t+"<"+i+`>\r
`,i.match(/^<?\w[^>]*[^/]$/)&&!i.startsWith("input")&&(t+="	")}),e.substring(1,e.length-3)}};bC([Xi("Show/Edit Code")],fm.prototype,"generateCode",null),bC([Ot("Canvas on top"),(0,V.onChange)(yC.prototype._togglePreview)],fm.prototype,"canvasUp",void 0),fm=yC=bC([zi("Scrollable Camera View Preview (Dev)")],fm);var AC={d:(a,e)=>{for(var t in e)AC.o(e,t)&&!AC.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:e[t]})},o:(a,e)=>Object.prototype.hasOwnProperty.call(a,e)},q2={};AC.d(q2,{Q:()=>ZD});var wC=function(a,e,t,i){return new(t||(t=Promise))(function(r,s){function o(h){try{u(i.next(h))}catch(f){s(f)}}function l(h){try{u(i.throw(h))}catch(f){s(f)}}function u(h){var f;h.done?r(h.value):(f=h.value,f instanceof t?f:new t(function(g){g(f)})).then(o,l)}u((i=i.apply(a,e||[])).next())})};const Y2=Symbol("Comlink.proxy"),qD=Symbol("Comlink.endpoint"),YD=Symbol("Comlink.releaseProxy"),xC=Symbol("Comlink.thrown"),K2=a=>typeof a=="object"&&a!==null||typeof a=="function",Z2=new Map([["proxy",{canHandle:a=>K2(a)&&a[Y2],serialize(a){const{port1:e,port2:t}=new MessageChannel;return J2(a,e),[t,[t]]},deserialize:a=>(a.start(),eI(a))}],["throw",{canHandle:a=>K2(a)&&xC in a,serialize({value:a}){let e;return e=a instanceof Error?{isError:!0,value:{message:a.message,name:a.name,stack:a.stack}}:{isError:!1,value:a},[e,[]]},deserialize(a){throw a.isError?Object.assign(new Error(a.value.message),a.value):a.value}}]]);function J2(a,e=self){e.addEventListener("message",function t(i){if(!i||!i.data)return;const{id:r,type:s,path:o}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(rv);let u;try{const h=o.slice(0,-1).reduce((g,_)=>g[_],a),f=o.reduce((g,_)=>g[_],a);switch(s){case"GET":u=f;break;case"SET":h[o.slice(-1)[0]]=rv(i.data.value),u=!0;break;case"APPLY":u=f.apply(h,l);break;case"CONSTRUCT":u=c1(new f(...l));break;case"ENDPOINT":{const{port1:g,port2:_}=new MessageChannel;J2(a,_),u=function(A,x){return iI.set(A,x),A}(g,[g])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[xC]:0}}Promise.resolve(u).catch(h=>({value:h,[xC]:0})).then(h=>{const[f,g]=SC(h);e.postMessage(Object.assign(Object.assign({},f),{id:r}),g),s==="RELEASE"&&(e.removeEventListener("message",t),$2(e))})}),e.start&&e.start()}function $2(a){(function(e){return e.constructor.name==="MessagePort"})(a)&&a.close()}function eI(a,e){return EC(a,[],e)}function l1(a){if(a)throw new Error("Proxy has been released and is not useable")}function EC(a,e=[],t=function(){}){let i=!1;const r=new Proxy(t,{get(s,o){if(l1(i),o===YD)return()=>x_(a,{type:"RELEASE",path:e.map(l=>l.toString())}).then(()=>{$2(a),i=!0});if(o==="then"){if(e.length===0)return{then:()=>r};const l=x_(a,{type:"GET",path:e.map(u=>u.toString())}).then(rv);return l.then.bind(l)}return EC(a,[...e,o])},set(s,o,l){l1(i);const[u,h]=SC(l);return x_(a,{type:"SET",path:[...e,o].map(f=>f.toString()),value:u},h).then(rv)},apply(s,o,l){l1(i);const u=e[e.length-1];if(u===qD)return x_(a,{type:"ENDPOINT"}).then(rv);if(u==="bind")return EC(a,e.slice(0,-1));const[h,f]=tI(l);return x_(a,{type:"APPLY",path:e.map(g=>g.toString()),argumentList:h},f).then(rv)},construct(s,o){l1(i);const[l,u]=tI(o);return x_(a,{type:"CONSTRUCT",path:e.map(h=>h.toString()),argumentList:l},u).then(rv)}});return r}function tI(a){const e=a.map(SC);return[e.map(i=>i[0]),(t=e.map(i=>i[1]),Array.prototype.concat.apply([],t))];var t}const iI=new WeakMap;function c1(a){return Object.assign(a,{[Y2]:!0})}function SC(a){for(const[e,t]of Z2)if(t.canHandle(a)){const[i,r]=t.serialize(a);return[{type:"HANDLER",name:e,value:i},r]}return[{type:"RAW",value:a},iI.get(a)||[]]}function rv(a){switch(a.type){case"HANDLER":return Z2.get(a.name).deserialize(a.value);case"RAW":return a.value}}function x_(a,e,t){return new Promise(i=>{const r=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");a.addEventListener("message",function s(o){o.data&&o.data.id&&o.data.id===r&&(a.removeEventListener("message",s),i(o.data))}),a.start&&a.start(),a.postMessage(Object.assign({id:r},e),t)})}class KD extends class{}{init(e,t,i,r){if(!this.api){if(!r)throw new Error("workerFilePath is required");(()=>{var s,o,l;s=this,l=function*(){const u=yield fetch(r).then(g=>g.blob()),h=URL.createObjectURL(u),f=new Worker(h,{type:"module"});this.api=yield new(eI(f))(c1(()=>{e(),URL.revokeObjectURL(h)}),c1((g,_)=>g==="xatlas_web.wasm"?i:g+_),c1(t))},new((o=void 0)||(o=Promise))(function(u,h){function f(A){try{_(l.next(A))}catch(x){h(x)}}function g(A){try{_(l.throw(A))}catch(x){h(x)}}function _(A){var x;A.done?u(A.value):(x=A.value,x instanceof o?x:new o(function(E){E(x)})).then(f,g)}_((l=l.apply(s,[])).next())})})()}}}class ZD extends class{constructor(e,t={resolution:2048},i={},r=!1,s=!1,o=!1){this.THREE=e,this.packOptions=t,this.chartOptions=i,this.useNormals=r,this.timeUnwrap=s,this.logProgress=o,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,i){return wC(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((r,s)=>{try{this.xAtlas.init(()=>{r()},e,t,i)}catch(o){s(o)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(r=>setTimeout(r,100));this._libraryLoaded=!0}})}packAtlas(e,t="uv2",i="uv"){return wC(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const r=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(h=>setTimeout(h,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let s=[],o="";for(let h of e){let{uuid:f,index:g,attributes:_}=h;const A=h.userData.worldScale||1;s.push(f),g&&_.position&&_.position.itemSize===3?(o="Mesh"+s.length+" added to atlas: "+f,this.timeUnwrap&&console.time(o),yield this.xAtlas.api.addMesh(g.array,_.position.array,_.normal?_.normal.array:void 0,_.uv?_.uv.array:void 0,f,this.useNormals,r,A),this.timeUnwrap&&console.timeEnd(o)):console.warn("xatlas-three: Geometry not supported: ",h)}o="Generated atlas with "+s.length+" meshes",this.timeUnwrap&&console.time(o);let l=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(o);let u=[];for(let h of l){let f=e.find(g=>g.uuid===h.mesh);f?(h.vertex.vertices&&f.setAttribute("position",new this.THREE.BufferAttribute(h.vertex.vertices,3,!1)),h.vertex.normals&&f.setAttribute("normal",new this.THREE.BufferAttribute(h.vertex.normals,3,!0)),h.vertex.coords1&&f.setAttribute(t,new this.THREE.BufferAttribute(h.vertex.coords1,2,!1)),h.vertex.coords&&t!==i&&f.setAttribute(i,new this.THREE.BufferAttribute(h.vertex.coords,2,!1)),h.index&&f.setIndex(new this.THREE.BufferAttribute(h.index,1,!1)),u.push(f)):console.error("xatlas-three: Mesh not found: ",h.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,u})}unwrapGeometry(e,t="uv",i="uv2"){return wC(this,void 0,void 0,function*(){return this.packAtlas([e],t,i)})}}{_createXAtlas(){return new KD}}var Wb,JD=q2.Q,Sn=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let fl=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};Sn([ae()],fl.prototype,"fixWinding",void 0),Sn([ae()],fl.prototype,"maxBoundaryLength",void 0),Sn([ae()],fl.prototype,"maxChartArea",void 0),Sn([ae()],fl.prototype,"maxCost",void 0),Sn([ae()],fl.prototype,"maxIterations",void 0),Sn([ae()],fl.prototype,"normalDeviationWeight",void 0),Sn([ae()],fl.prototype,"normalSeamWeight",void 0),Sn([ae()],fl.prototype,"roundnessWeight",void 0),Sn([ae()],fl.prototype,"straightnessWeight",void 0),Sn([ae()],fl.prototype,"textureSeamWeight",void 0),Sn([ae()],fl.prototype,"useInputMeshUvs",void 0),fl=Sn([zi("Chart Options"),$n("UChartOptions")],fl);let Ql=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};Sn([ae()],Ql.prototype,"bilinear",void 0),Sn([ae()],Ql.prototype,"blockAlign",void 0),Sn([ae()],Ql.prototype,"bruteForce",void 0),Sn([ae()],Ql.prototype,"createImage",void 0),Sn([ae()],Ql.prototype,"maxChartSize",void 0),Sn([ae()],Ql.prototype,"padding",void 0),Sn([ae()],Ql.prototype,"resolution",void 0),Sn([ae()],Ql.prototype,"rotateCharts",void 0),Sn([ae()],Ql.prototype,"rotateChartsToAxis",void 0),Sn([ae()],Ql.prototype,"texelsPerUnit",void 0),Ql=Sn([zi("Pack Options"),$n("UPackOptions")],Ql);let cu=Wb=class extends Si{constructor(a=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new fl,this.packOptions=new Ql,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var e,t,i,r,s;const o=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(fr))===null||t===void 0?void 0:t.getSelectedObject();if(o)if(o.geometry){if(o.geometry.attributes.uv&&!await((s=this._viewer)===null||s===void 0?void 0:s.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(o.geometry)}else(r=this._viewer)===null||r===void 0||r.alert("Unwrap: Selected object has no geometry");else(i=this._viewer)===null||i===void 0||i.alert("Unwrap: No object selected")},a&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,V.timeout)(100);else this._unwrapper=new JD({BufferAttribute:p.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,Wb.LIBRARY_PATH+"xatlas.wasm",Wb.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(a,e="uv",t="uv"){var i;await this.loadLibrary(),await((i=this._unwrapper)===null||i===void 0?void 0:i.unwrapGeometry(a,e,t))}async packAtlas(a,e=!0,t="uv2",i="uv"){var r;await this.loadLibrary(),Array.isArray(a)||(a=[a]);const s=[];e?a.forEach(o=>o.traverse(l=>{l.geometry&&s.push(l.geometry)})):a.forEach(o=>{o.geometry&&s.push(o.geometry)}),await((r=this._unwrapper)===null||r===void 0?void 0:r.packAtlas(s,t,i))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};cu.PluginType="XAtlasPlugin",cu.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",Sn([(0,V.onChange)(Wb.prototype._useNormalsChanged),ae()],cu.prototype,"useNormals",void 0),Sn([ae()],cu.prototype,"chartOptions",void 0),Sn([ae()],cu.prototype,"packOptions",void 0),Sn([Xi("Unwrap Selected Geometry")],cu.prototype,"unwrapSelected",void 0),cu=Wb=Sn([zi("UV Unwrapping (xAtlas)")],cu);class Xb extends Si{constructor(){super(...arguments),this.dependencies=[Ut],this.enabled=!0,this.serializeWithViewer=!1,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let i=e.icon;return(i&&/^(\w+)\(([^)]*)\)/.exec(i)||/^#([A-Fa-f\d]+)$/.exec(i))&&(i=(0,V.makeColorSvg)(i)),i&&i.startsWith("http")&&i.startsWith("data:")||(i=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(i||""))),i},getItemIcon:(e,t,i)=>{const r=e.iconFiles[t];if(r)return URL.createObjectURL(r);let s=e.icons[t];return(s&&/^(\w+)\(([^)]*)\)/.exec(s)||/^#([A-Fa-f\d]+)$/.exec(s))&&(s=(0,V.makeColorSvg)(s)),s||(s=this.utils.pathToIcon(e.items[t])),!s||s.startsWith("http")||s.startsWith("data:")||(s=this.baseUrl+i+"/"+e.prefix+s),s},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,i)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${i}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,i,r=!1){var s,o;if(!this._viewer)return;const l=this._getVariationId(e);typeof t=="number"&&(t=e.items[t]);const u=e.items.indexOf(t);if(u===-1)return void this._viewer.console.warn(`Item ${t} not found`);const h=e.itemFiles[u],f=e.selected;if(!r&&f===u)return;e.selected=u;const g=this._viewer.getManager(),_=this.utils.getItemPath(e,u,i);if(i==="objects"){let A=this._viewer.scene.findObjectsByName(l).map(I=>I.modelObject);A.length===0&&(A=[(await this._viewer.createObject3D()).modelObject],A[0].name=l),this._viewer.renderEnabled=!1;for(const I of A)[...I.children].forEach(S=>S.dispose&&this.autoDispose?S.dispose():S.removeFromParent());const x=await this._loadObject(_,h);if(!x.length)return void(_.endsWith("json")||this._viewer.console.warn(`Object ${_} not found`));let E=!1;for(const I of A){[...I.children].forEach(S=>S.dispose&&this.autoDispose?S.dispose():S.removeFromParent());for(const S of x)E?I.add(S.modelObject.clone()):I.add(S.modelObject);E=!0}const T=[],R=this.variations.materials.filter(I=>I&&typeof I.selected=="number");for(const I of R)T.push(this.applyVariation(I,I.selected,"materials",!0));await Promise.all(T),this._viewer.renderEnabled=!0}if(i==="materials"){const A=await this._loadMaterial(_,h);if(!A)return void this._viewer.console.warn(`Material ${_} not found`);A.userData.__isVariation=!0;const x=this._viewer.scene.findObjectsByName(l),E=T=>{var R,I,S;T.material&&(Array.isArray(T.material)?T.material.length!==0&&((R=e.data)===null||R===void 0?void 0:R.matType)!==T.material[0].typeSlug:((I=e.data)===null||I===void 0?void 0:I.matType)!==T.material.typeSlug)||(S=T==null?void 0:T.setMaterial)===null||S===void 0||S.call(T,A)};for(const T of x)!((s=e.data)===null||s===void 0)&&s.traverse?T.traverse(E):E(T);(o=g.materials)===null||o===void 0||o.applyMaterial(A,l)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const i=this._getVariationId(t),r=this._viewer.scene.findObjectsByName(i);for(const s of r)[...s.children].forEach(o=>{var l;return((l=o.dispose)!==null&&l!==void 0?l:o.removeFromParent)()})}}async _loadMaterial(e,t){var i,r,s;return(s=(r=(i=this._viewer)===null||i===void 0?void 0:i.getManager())===null||r===void 0?void 0:r.importer)===null||s===void 0?void 0:s.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var i,r,s;return(s=(r=(i=this._viewer)===null||i===void 0?void 0:i.getManager())===null||r===void 0?void 0:r.importer)===null||s===void 0?void 0:s.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){var i,r;typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?Mh(mt(e.folder)):Mh(e.folder));for(const s of this._ty)if(e[s])for(const o of e[s]){const l={items:o.items,prefix:o.prefix,name:o.name,title:o.title||"",icon:o.icon||"",icons:(i=o.icons)!==null&&i!==void 0?i:o.items.map(()=>""),titles:(r=o.titles)!==null&&r!==void 0?r:o.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...o.data}};if(t)for(let u=0;u<o.items.length;u++){const h=o.items[u],f=t[s+"/"+o.prefix+h];l.itemFiles[u]=f?new File([f],h):void 0;const g=o.icons[u];if(!g)continue;const _=t[s+"/"+o.prefix+g];l.iconFiles[u]=_?new File([_],g):void 0}this.variations[s].push(l)}}async importPath(e){var t,i;if(e.endsWith(".json")){const r=await((i=(t=this._viewer)===null||t===void 0?void 0:t.getManager().importer)===null||i===void 0?void 0:i.importSinglePath(e,{processImported:!1})),s=e.split("?")[0];return this.baseUrl||(this.baseUrl=s.substring(0,s.lastIndexOf("/")+1)),this.importConfig(r)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return((t=this.variations.materials.find(i=>this.utils.getName(i)===e))===null||t===void 0?void 0:t.items)||[]}getObjects(e){var t;return((t=this.variations.objects.find(i=>this.utils.getName(i)===e))===null||t===void 0?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var e;let t={objects:{},materials:{}};const i={objects:[],materials:[],type:Xb.PluginType};this.baseUrl&&(i.baseUrl=this.baseUrl);let r=!1;for(const s of this._ty)for(const o of this.variations[s]){const l={...o};l.data={...l.data},delete l.itemFiles,delete l.iconFiles,i[s].push(l);const u=o.prefix.replace(/^\//,""),h=u.trimEnd().endsWith("/")?"":u.split("/").pop()||"",f=u.replace(h,"").trimEnd().replace(/\/$/,""),g={};let _=!1;for(let E=0;E<o.items.length;E++){const T=o.items[E],R=o.itemFiles[E],I=o.iconFiles[E],S=o.icons[E];R?(g[h+T]=new Uint8Array(await R.arrayBuffer()),I&&!S&&((e=this._viewer)===null||e===void 0||e.console.error("Icon file without icon name")),I&&S&&(g[h+S]=new Uint8Array(await I.arrayBuffer())),_=!0):I&&alert("Icon file without model/material file not supported")}if(!_)continue;r=!0;const A=f.split("/");let x=t[s];for(const E of A){x[E]||(x[E]={});const T=x[E];if(typeof T!="object")throw new Error("Invalid prefix: "+o.prefix);x=T}Object.assign(x,g)}return r||(t=void 0),{folder:t,config:i}}}Xb.PluginType="VariationConfiguratorPlugin";class E_ extends Xb{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,q.RemoveAll(E_.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])q.Create(E_.PluginType,this.utils.getTitle(t),5,20,0,t.items.map((i,r)=>({id:i,image:this.utils.getItemIcon(t,r,e),onClick:async s=>this.applyVariation(t,s,e,!1),tooltip:this.utils.getItemTitle(t,r)})),(i,r)=>Cp(i,{placement:"bottom",content:r.tooltip}));return q.RebuildUi(this._viewer.container),!0}}E_.PluginType="VariationConfiguratorPlugin";class qb extends E_{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map((i,r)=>({type:"folder",label:()=>t.items[r],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[r],getValue:()=>t.items[r],setValue:s=>{t.items[r]=s}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[r]),getValue:()=>t.icons[r],setValue:s=>{t.icons[r]=s}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[r]),getValue:()=>t.titles[r],setValue:s=>{t.titles[r]=s}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,r,e)},t.itemFiles[r]?[{type:"button",label:"Remove",value:()=>{t.items.splice(r,1),t.itemFiles.splice(r,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const s=await(0,V.uploadFile)(!1,!1);s.length!==0&&(t.itemFiles[r]=s[0],t.items[r]=s[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const s=t.itemFiles[r];(0,V.downloadBlob)(s,s.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var i,r,s;const o=await(0,V.uploadFile)(!0,!1);if(o.length!==0){for(const l of o){if(!this._extForType[e].includes((i=l.name.split(".").pop())!==null&&i!==void 0?i:"")){await((r=this._viewer)===null||r===void 0?void 0:r.alert(`Invalid file: ${l.name} is not a valid ${e} file`));continue}if(t.items.includes(l.name)){await((s=this._viewer)===null||s===void 0?void 0:s.alert(`Already exists: Item with name ${l.name} already exists`));continue}const u=t.items.push(l.name)-1;t.icons[u]="",t.titles[u]="",t.itemFiles[u]=l}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var i,r,s,o,l;const u=await((i=this._viewer)===null||i===void 0?void 0:i.prompt("URL: Enter the url of the object/material"));if(!u)return;if(!u.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((r=this._viewer)===null||r===void 0?void 0:r.alert(`Invalid url: ${u} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes((s=u.split(".").pop())!==null&&s!==void 0?s:""))return void await((o=this._viewer)===null||o===void 0?void 0:o.alert(`Invalid url: ${u} should be of a material ending with mat`));t.items.includes(u)&&await((l=this._viewer)===null||l===void 0?void 0:l.alert(`Already exists: Item with url ${u} already exists`)),t.items.push(u);const h=t.items.length-1;t.icons[h]="",t.titles[h]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{var i;await((i=this._viewer)===null||i===void 0?void 0:i.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var t;const i=await((t=this._viewer)===null||t===void 0?void 0:t.prompt("Name: Enter the name of the object/material"));i&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:i+"/",name:i,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var t,i,r,s;const o=await(0,V.uploadFile)(!1,!0);if(o.length===0)return;const l=[],u=[],h=[],f=[];for(const E of o){if(E.name.startsWith("."))continue;const T=(t=E.name.split(".").pop())!==null&&t!==void 0?t:"";T?this._extForType[e].includes(T)?(l.push(E.webkitRelativePath.replace(/^\//,"")),u.push(E)):this._extForType.images.includes(T)?(h.push(E.webkitRelativePath.replace(/^\//,"")),f.push(E)):await((r=this._viewer)===null||r===void 0?void 0:r.alert(`Invalid file: ${E.name} is not a valid ${e} file`)):await((i=this._viewer)===null||i===void 0?void 0:i.alert(`Invalid file: ${E.name} has no extension`))}const g=(0,V.longestCommonPrefix)(l),_=this.utils.getName({prefix:g});let A=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Name: Enter the name of the object/material",_,!0));if(A===null)return;A=A||_;const x=l.map(E=>{var T;const R=E.replace(g,""),I=(T=R.split(".").pop())!==null&&T!==void 0?T:"",S=R.replace("."+I,"")+".",O=h.findIndex(k=>k.replace(g,"").startsWith(S));return O<0?["",void 0]:[h[O].replace(g,""),f[O]||void 0]});this.variations[e].push({items:l.map(E=>E.replace(g,"")),icons:x.map(E=>E[0]),iconFiles:x.map(E=>E[1]),titles:l.map(()=>""),itemFiles:u,prefix:g,name:A,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,t;try{const{folder:i,config:r}=await this._exportConfiguratorState(),s=JSON.stringify(r,null,4);if(i){i["config.json"]=mt(s);const o=await Kc(i),l=new Blob([o],{type:"application/zip"});(0,V.downloadBlob)(l,"configurator.zip")}else{const o=new Blob([s],{type:"application/json"});(0,V.downloadBlob)(o,"config.json")}}catch(i){return(e=this._viewer)===null||e===void 0||e.console.error(i),void await((t=this._viewer)===null||t===void 0?void 0:t.alert("Error: "+((i==null?void 0:i.message)||i)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var e,t,i;const r=await(0,V.uploadFile)(!1,!1,"application/zip,application/json");if(r.length===0)return;const s=r[0];if(s.name.endsWith(".zip")){const o=Mh(new Uint8Array(await s.arrayBuffer()));if(!o["config.json"])return void await((e=this._viewer)===null||e===void 0?void 0:e.alert("Invalid zip: config.json not found"));const l=JSON.parse($t(o["config.json"]));this.importConfig(l,o)}else{if(!s.name.endsWith(".json"))return void await((t=this._viewer)===null||t===void 0?void 0:t.alert("Invalid file: "+s.name));{const o=JSON.parse(await s.text());this.importConfig(o)}}await((i=this._viewer)===null||i===void 0?void 0:i.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var e,t;const i=await((e=this._viewer)===null||e===void 0?void 0:e.prompt("URL: Enter the url of the json file."));i&&(await this.importPath(i),await((t=this._viewer)===null||t===void 0?void 0:t.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)===null||e===void 0?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const i=await super._loadObject(e,t);for(const r of i)(r.modelObject||r).userData.excludeFromExport=!0;return i}}qb.PluginType="VariationConfiguratorPlugin";class Fp extends Si{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=e=>{const t=e.object;t!=null&&t.traverse&&t.traverse(i=>{var r,s;i.userData[Fp.PluginType]===void 0&&(i.userData[Fp.PluginType]={transforms:[]});const o={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var l;this.addTransform(i),(l=o==null?void 0:o.uiRefresh)===null||l===void 0||l.call(o)}},()=>{var l;return(l=i.userData[Fp.PluginType])===null||l===void 0?void 0:l.transforms.map((u,h)=>({type:"folder",label:`Transform ${h}`,children:[{type:"vec3",label:"Position",property:[u,"position"]},{type:"vec3",label:"Quaternion",property:[u,"quaternion"]},{type:"vec3",label:"Scale",property:[u,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(i,u)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(i,u)}}]}))}]};(s=(r=i.uiConfig)===null||r===void 0?void 0:r.children)===null||s===void 0||s.push(o)})}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(e)}addTransform(e){e.userData[Fp.PluginType].transforms.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}setTransform(e,t){var i,r,s,o;e.position.copy(t.position),e.quaternion.copy(t.quaternion),e.scale.copy(t.scale),(r=(i=e.userData).setDirty)===null||r===void 0||r.call(i),(o=(s=e.uiConfig)===null||s===void 0?void 0:s.uiRefresh)===null||o===void 0||o.call(s)}animateTransform(e,t,i=2e3){var r,s;const o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("PopmotionPlugin");o||(s=this._viewer)===null||s===void 0||s.console.error("PopmotionPlugin required for animation");const l=typeof t=="number"?e.userData[Fp.PluginType].transforms[t]:t,u=new p.Pa4,h=new p._fP,f=new p.Pa4,g=e.position.clone(),_=e.quaternion.clone(),A=e.scale.clone(),x=l.position,E=l.quaternion,T=l.scale;return o==null?void 0:o.animate({from:0,to:1,duration:i,onUpdate:R=>{var I,S;u.lerpVectors(g,x,R),h.slerpQuaternions(_,E,R),f.lerpVectors(A,T,R),e.position.copy(u),e.quaternion.copy(h),e.scale.copy(f),(I=this._viewer)===null||I===void 0||I.setDirty(),(S=this._viewer)===null||S===void 0||S.renderer.resetShadows()},onStop:()=>{var R,I,S,O;e.position.copy(l.position),e.quaternion.copy(l.quaternion),e.scale.copy(l.scale),(I=(R=e.userData).setDirty)===null||I===void 0||I.call(R),(O=(S=e.uiConfig)===null||S===void 0?void 0:S.uiRefresh)===null||O===void 0||O.call(S)}})}}Fp.PluginType="TransformAnimationPlugin";var rI=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let mm=class extends Si{constructor(a=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const e of this.cameras){if(!e.enabled)continue;const t=this._viewer,i=e.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:e}),t.scene.renderCamera=i,t.renderer.render(!1);const r=t.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:e,readBuffer:r}),t.renderer.blit(r.texture,e.target),this.dispatchEvent({type:"postRenderCamera",camera:e})}catch(r){console.error(r),e.enabled=!1}}},this.enabled=a}async onAdded(a){await super.onAdded(a),a.addEventListener("preRender",this._preRender)}addCamera(a){if(!this._viewer)throw"Plugin not added to viewer";const e={camera:a,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(e),e}};function CC(a,e,t,i,r){const s=a.getAttribute(e),o=i.length/t;return s&&s.count===o?(s.set(i),s.needsUpdate=!0):a.setAttribute(e,new(r??p.a$l)(i,t)),s}function nI(a,e){var t,i,r;if(!a.uiConfig)return;let s=(t=a.uiConfig.children)===null||t===void 0?void 0:t.find(o=>{var l;return(l=o.tags)===null||l===void 0?void 0:l.includes("generatedGeometry")});s||(s={type:"folder",label:"Generation Params",tags:["generatedGeometry"],children:[]},(i=a.uiConfig.children)===null||i===void 0||i.push(s)),a.userData.__generationParamsUiType!==a.userData.generationParams.type&&(s.children=e(),a.userData.__generationParamsUiType=a.userData.generationParams.type,(r=s.uiRefresh)===null||r===void 0||r.call(s,"postFrame",!0))}mm.PluginType="VirtualCamerasPlugin",rI([Ot()],mm.prototype,"enabled",void 0),mm=rI([zi("Virtual Cameras")],mm);class S_{constructor(e){this.type=e}createUiConfig(e){const t=Qa(e.userData.generationParams).filter(i=>{var r;return((r=(0,V.getOrCall)(i.property))===null||r===void 0?void 0:r[1])!=="type"});return t.forEach(i=>{i.onChange=()=>this.generate(e)}),t}generate(e,t={}){const i=e??new p.u9r;if(i.userData.generationParams||(i.userData.generationParams={type:this.type}),i.userData.generationParams.type=this.type,t.type)return console.error("Cannot set type parameter here, use the plugin instead"),i;const r={...this.defaultParams,...i.userData.generationParams,...t},{indices:s,vertices:o,normals:l,uvs:u,groups:h}=this._generateData(r);if(function(f,g){const _=f.index;_&&_.count===g.length?(_.set(g),_.needsUpdate=!0):f.setIndex(g)}(i,s),CC(i,"position",3,o),CC(i,"normal",3,l),CC(i,"uv",2,u),h){i.clearGroups();for(const f of h)i.addGroup(f.start,f.count,f.materialIndex)}return i.computeBoundingBox(),i.computeBoundingSphere(),Object.assign(i.userData.generationParams,r),nI(i,()=>this.createUiConfig(i)),i.dispatchEvent({type:"geometryUpdate"}),i}}class $D extends S_{constructor(){super(...arguments),this.defaultParams={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}}_generateData(e){const{radius:t,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o}=e;let{widthSegments:l,heightSegments:u}=e;l=Math.max(3,Math.floor(l)),u=Math.max(2,Math.floor(u));const h=Math.min(s+o,Math.PI);let f=0;const g=[],_=new p.Pa4,A=new p.Pa4,x=[],E=[],T=[],R=[];for(let I=0;I<=u;I++){const S=[],O=I/u;let k=0;I===0&&s===0?k=.5/l:I===u&&h===Math.PI&&(k=-.5/l);for(let N=0;N<=l;N++){const H=N/l;_.x=-t*Math.cos(i+H*r)*Math.sin(s+O*o),_.y=t*Math.cos(s+O*o),_.z=t*Math.sin(i+H*r)*Math.sin(s+O*o),E.push(_.x,_.y,_.z),A.copy(_).normalize(),T.push(A.x,A.y,A.z),R.push(H+k,1-O),S.push(f++)}g.push(S)}for(let I=0;I<u;I++)for(let S=0;S<l;S++){const O=g[I][S+1],k=g[I][S],N=g[I+1][S],H=g[I+1][S+1];(I!==0||s>0)&&x.push(O,k,H),(I!==u-1||h<Math.PI)&&x.push(k,N,H)}return{indices:x,vertices:E,normals:T,uvs:R}}}class eB extends S_{constructor(){super(...arguments),this.defaultParams={width:1,height:1,widthSegments:2,heightSegments:2}}_generateData(e){const t=e.width/2,i=e.height/2,r=Math.floor(e.widthSegments),s=Math.floor(e.heightSegments),o=r+1,l=s+1,u=e.width/r,h=e.height/s,f=[],g=[],_=[],A=[];for(let x=0;x<l;x++){const E=x*h-i;for(let T=0;T<o;T++){const R=T*u-t;g.push(R,-E,0),_.push(0,0,1),A.push(T/r),A.push(1-x/s)}}for(let x=0;x<s;x++)for(let E=0;E<r;E++){const T=E+o*x,R=E+o*(x+1),I=E+1+o*(x+1),S=E+1+o*x;f.push(T,R,S),f.push(R,I,S)}return{indices:f,vertices:g,normals:_,uvs:A}}}class tB extends S_{constructor(){super(...arguments),this.defaultParams={radius:1,segments:32,thetaStart:0,thetaLength:2*Math.PI}}_generateData(e){const{radius:t,thetaStart:i,thetaLength:r}=e,s=Math.max(3,e.segments),o=[],l=[],u=[],h=[],f=new p.Pa4,g=new p.FM8;l.push(0,0,0),u.push(0,0,1),h.push(.5,.5);for(let _=0,A=3;_<=s;_++,A+=3){const x=i+_/s*r;f.x=t*Math.cos(x),f.y=t*Math.sin(x),l.push(f.x,f.y,f.z),u.push(0,0,1),g.x=(l[A]/t+1)/2,g.y=(l[A+1]/t+1)/2,h.push(g.x,g.y)}for(let _=1;_<=s;_++)o.push(_,_+1,0);return{indices:o,vertices:l,normals:u,uvs:h}}}class iB extends S_{constructor(){super(...arguments),this.defaultParams={radius:1,tube:.4,radialSegments:12,tubularSegments:48,arc:2*Math.PI}}_generateData(e){const{radius:t,tube:i,arc:r}=e;let{radialSegments:s,tubularSegments:o}=e;s=Math.floor(s),o=Math.floor(o);const l=[],u=[],h=[],f=[],g=new p.Pa4,_=new p.Pa4,A=new p.Pa4;for(let x=0;x<=s;x++)for(let E=0;E<=o;E++){const T=E/o*r,R=x/s*Math.PI*2;_.x=(t+i*Math.cos(R))*Math.cos(T),_.y=(t+i*Math.cos(R))*Math.sin(T),_.z=i*Math.sin(R),u.push(_.x,_.y,_.z),g.x=t*Math.cos(T),g.y=t*Math.sin(T),A.subVectors(_,g).normalize(),h.push(A.x,A.y,A.z),f.push(E/o),f.push(x/s)}for(let x=1;x<=s;x++)for(let E=1;E<=o;E++){const T=(o+1)*x+E-1,R=(o+1)*(x-1)+E-1,I=(o+1)*(x-1)+E,S=(o+1)*x+E;l.push(T,R,S),l.push(R,I,S)}return{indices:l,vertices:u,normals:h,uvs:f}}}class rB extends S_{constructor(){super(...arguments),this.defaultParams={radiusTop:1,radiusBottom:1,height:1,radialSegments:32,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}}_generateTorso(e){const{radiusTop:t,radiusBottom:i,height:r,radialSegments:s,heightSegments:o,thetaStart:l,thetaLength:u,indexArray:h,indices:f,groups:g,vertices:_,normals:A,uvs:x,groupStart:E,halfHeight:T}=e,R=new p.Pa4,I=new p.Pa4;let S=0;const O=(i-t)/r;for(let k=0;k<=o;k++){const N=[],H=k/o,X=H*(i-t)+t;for(let te=0;te<=s;te++){const re=te/s,ue=re*u+l,le=Math.sin(ue),se=Math.cos(ue);I.x=X*le,I.y=-H*r+T,I.z=X*se,_.push(I.x,I.y,I.z),R.set(le,O,se).normalize(),A.push(R.x,R.y,R.z),x.push(re,1-H),N.push(e.index++)}h.push(N)}for(let k=0;k<s;k++)for(let N=0;N<o;N++){const H=h[N][k],X=h[N+1][k],te=h[N+1][k+1],re=h[N][k+1];f.push(H,X,re),f.push(X,te,re),S+=6}g.push({start:E,count:S,materialIndex:0}),e.groupStart+=S}_generateCap(e,t){const{radiusTop:i,radiusBottom:r,radialSegments:s,thetaStart:o,thetaLength:l,indices:u,groups:h,vertices:f,normals:g,uvs:_,groupStart:A,halfHeight:x}=e,E=e.index,T=new p.FM8,R=new p.Pa4;let I=0;const S=t===!0?i:r,O=t===!0?1:-1;for(let N=1;N<=s;N++)f.push(0,x*O,0),g.push(0,O,0),_.push(.5,.5),e.index++;const k=e.index;for(let N=0;N<=s;N++){const H=N/s*l+o,X=Math.cos(H),te=Math.sin(H);R.x=S*te,R.y=x*O,R.z=S*X,f.push(R.x,R.y,R.z),g.push(0,O,0),T.x=.5*X+.5,T.y=.5*te*O+.5,_.push(T.x,T.y),e.index++}for(let N=0;N<s;N++){const H=E+N,X=k+N;t===!0?u.push(X,X+1,H):u.push(X+1,X,H),I+=3}h.push({start:A,count:I,materialIndex:t===!0?1:2}),e.groupStart+=I}_generateData(e){let{radialSegments:t,heightSegments:i}=e;t=Math.floor(t),i=Math.floor(i);const r={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[],index:0,indexArray:[],halfHeight:e.height/2,...e,radialSegments:t,heightSegments:i};return this._generateTorso(r),e.openEnded===!1&&(e.radiusTop>0&&this._generateCap(r,!0),e.radiusBottom>0&&this._generateCap(r,!1)),r}}class nB extends S_{constructor(){super(...arguments),this.defaultParams={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1}}_buildPlane(e,t,i,r,s,o,l,u,h,f,g,_){const{indices:A,vertices:x,normals:E,uvs:T,numberOfVertices:R,groupStart:I,groups:S}=e,O=l/f,k=u/g,N=l/2,H=u/2,X=h/2,te=f+1,re=g+1;let ue=0,le=0;const se=new p.Pa4;for(let de=0;de<re;de++){const ve=de*k-H;for(let fe=0;fe<te;fe++){const Ee=fe*O-N;se[t]=Ee*s,se[i]=ve*o,se[r]=X,x.push(se.x,se.y,se.z),se[t]=0,se[i]=0,se[r]=h>0?1:-1,E.push(se.x,se.y,se.z),T.push(fe/f),T.push(1-de/g),ue+=1}}for(let de=0;de<g;de++)for(let ve=0;ve<f;ve++){const fe=R+ve+te*de,Ee=R+ve+te*(de+1),Je=R+(ve+1)+te*(de+1),Te=R+(ve+1)+te*de;A.push(fe,Ee,Te),A.push(Ee,Je,Te),le+=6}S.push({start:I,count:le,materialIndex:_}),e.groupStart+=le,e.numberOfVertices+=ue}_generateData(e){const{width:t,height:i,depth:r}=e;let{widthSegments:s,heightSegments:o,depthSegments:l}=e;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const u={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[]};return this._buildPlane(u,"z","y","x",-1,-1,r,i,t,l,o,0),this._buildPlane(u,"z","y","x",1,-1,r,i,-t,l,o,1),this._buildPlane(u,"x","z","y",1,1,t,r,i,s,l,2),this._buildPlane(u,"x","z","y",1,-1,t,r,-i,s,l,3),this._buildPlane(u,"x","y","z",1,-1,t,i,r,s,o,4),this._buildPlane(u,"x","y","z",-1,-1,t,i,-r,s,o,5),u}}class Yb extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.generators={plane:new eB("plane"),sphere:new $D("sphere"),box:new nB("box"),circle:new tB("circle"),torus:new iB("torus"),cylinder:new rB("cylinder")},this._sceneUpdate=e=>{var t;if(e.hierarchyChanged){const i=e.object||((t=this._viewer)===null||t===void 0?void 0:t.scene.modelRoot);i&&i.traverse(r=>{var s,o,l;const u=(l=(o=(s=r.geometry)===null||s===void 0?void 0:s.userData)===null||o===void 0?void 0:o.generationParams)===null||l===void 0?void 0:l.type;u&&nI(r.geometry,()=>{var h;const f=this.generators[u];return f!=null&&f.createUiConfig&&(h=f.createUiConfig(r.geometry))!==null&&h!==void 0?h:[]})})}},this.uiConfig={type:"folder",label:"Generate Geometry",children:[()=>Object.keys(this.generators).map(e=>({type:"button",label:"Generate "+e,value:async()=>{(await this.generateObject(e)).name=e}}))]}}async generateObject(e){var t,i;const r=this.generators[e];if(!r)throw new Error("Unknown generator type: "+e);const s=await((i=(t=this._viewer)===null||t===void 0?void 0:t.getManager())===null||i===void 0?void 0:i.addImportedSingle(new p.Kj0(new p.u9r,new js({color:16711680})),{autoScale:!1,autoCenter:!1}));return r.generate(s.modelObject.geometry),s.name=e,s.geometry.name="Generated "+e,s.modelObject}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}}Yb.PluginType="GeometryGeneratorPlugin";var MC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let jp=class extends Si{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.dependencies=[td],this._exporting=!1}async exportObject(a){var e,t;const i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(td);if(!i)throw new Error("AssetExporterPlugin not found");return a?(t=i.exporter)===null||t===void 0?void 0:t.exportObject(a,{format:"glb"}):i.exportScene(i.exportOptions)}async getLink(a){var e;const t=await this.exportObject(a);if(!t)throw new Error("Failed to export object or scene");const i=await fetch("https://bee.transfr.one/model.glb",{method:"PUT",body:t});if(i.status!==200)throw new Error("Failed to upload file");const r=(e=await i.text())===null||e===void 0?void 0:e.trim();console.log(r);try{new URL(r)}catch{throw new Error("Invalid URL "+r)}return r}async shareLink(a,e="m"){var t;if(this._exporting)return;this._exporting=!0;let i=await this.getLink().catch(r=>{var s,o;return(s=this._viewer)===null||s===void 0||s.console.error(r),(o=this._viewer)===null||o===void 0||o.alert(`Error: Failed to share scene: 
`+r.message),null});if(i){if(a){const s=typeof a=="string"?new URL(a):a;s.searchParams.set(e??"m",i),i=s.href}let r=!1;try{window&&window.navigator&&navigator.clipboard&&(await navigator.clipboard.writeText(i),r=!0)}catch(s){console.error("Failed to copy link",s)}(t=this._viewer)===null||t===void 0||t.alert("Link"+(r?" Copied: ":": "+i)+`

Note: File will be deleted in 7 days`)}return this._exporting=!1,i}async shareEditorLink(){const a=new URL(window.location.href);return this.shareLink(a)}async shareViewerLink(){const a=new URL(window.location.href);return a.pathname=a.pathname.replace(/editor\.html$/,"viewer.html"),this.shareLink(a)}};jp.PluginType="TransfrSharePlugin",MC([Xi("Share editor link")],jp.prototype,"shareEditorLink",null),MC([Xi("Share viewer link")],jp.prototype,"shareViewerLink",null),jp=MC([zi("Share Link (transfr.one)")],jp);var C_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let uu=class extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.prefix="",this.count=50,this.loops=1,this.color=new p.Ilk().setHSL(0,.8,.5)}colorItems(){if(!this._viewer)return;const a=this._viewer.scene.modelRoot;let e=0;const t=this.color.getHSL({h:0,s:0,l:0});a.traverse(i=>{const r=i.material&&i.material.isDiamondMaterial,s=r&&i.name.startsWith(this.prefix);if(r&&console.log("Found Diamond, name = ",i.name,", coloring = ",s),s){let o=i.name.replace(this.prefix,"");o=parseFloat(o)/this.count;const l=new p.Ilk().setHSL((this.loops*o+t.h)%1,t.s,t.l);i.material=i.material.userData.isColoredClone?i.material:i.material.clone(),i.material.color.set(l),i.material.boostFactors.set(1,1,1),i.material.userData.isColoredClone=!0,e++}}),console.log("total",e),this._viewer.setDirty()}};uu.PluginType="RainbowDiamondPlugin",C_([Ci("Object name prefix")],uu.prototype,"prefix",void 0),C_([Ci("Count")],uu.prototype,"count",void 0),C_([Ci("Loops")],uu.prototype,"loops",void 0),C_([ea("First Color")],uu.prototype,"color",void 0),C_([Xi("Color All Items")],uu.prototype,"colorItems",null),uu=C_([zi("Rainbow Diamond Coloring")],uu);class TC extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=null,this.ringSlots=[],this.dependencies=[Ut,om],this._animating=!1,this._runningAnimations=[],this.uiConfig={type:"folder",label:"Bering Animation",children:[{label:"Play Animation",type:"button",value:()=>{this.startRingAnimation(!1)}},{label:"Record Animation",type:"button",value:async()=>{var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("CanvasRecorder");if(!t||t.isRecording())return;this.animating&&this.stopRingAnimation(!1),await(0,V.timeout)(500);const i=await t.record(async()=>{console.log("start"),await this.startRingAnimation(!1),console.log("finish")});i&&(console.log("recorded",i),(0,V.downloadBlob)(i,"animation.mp4"))}}]}}get animating(){return this._animating}set animating(e){var t,i;if(this._animating===e)return;this._animating=e;const r=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Dl);r&&(e?r.disable("bering"):r.enable("bering"));const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Zf);s&&(s.enabled=!e)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",t=>{var i,r,s,o,l;if(!(!((r=(i=t.options)===null||i===void 0?void 0:i.allImported)===null||r===void 0)&&r.length)||!t.object||!t.object.__importedViewerConfig&&!(!((s=t.object.modelObject)===null||s===void 0)&&s.__importedViewerConfig)||!(!((o=t.options)===null||o===void 0)&&o.allImported))return;let u=0;const h=(l=t.options)===null||l===void 0?void 0:l.allImported.filter(f=>!!(f&&f.modelObject&&f.name.endsWith("bmod"))).reverse();h.forEach(f=>{this.loadRingBMod(f,f.name,u,h.length-1),u++})})}loadRingBMod(e,t,i,r){var s,o,l;if(!t)return;if(!(!((s=this._viewer)===null||s===void 0)&&s.getPlugin(Ut)))throw new Error("no asset manager");this._runningAnimations&&this.stopRingAnimation(),t.endsWith(".bmod")||(t+=".bmod");const u=e==null?void 0:e.modelObject;if(!u||!e)throw new Error("no model");u.userData.__ringSlot=i,this.ringSlots[i]=e;const h=[];u.traverse(g=>{g.userData.rotationCount>1&&h.push(g)}),new Re().expandByObjects(h,!0,!0),t.toLowerCase().includes("x3")||t.toLowerCase().includes("x4");const f=parseInt(t.split("-").pop().toLowerCase().replace("x","").replace(".bmod",""))+1;return u.userData.__ringWidth=f,u.userData.__ringTotalSlots=r,(l=(o=this._viewer)===null||o===void 0?void 0:o.scene)===null||l===void 0||l.setDirty({sceneUpdate:!0,frameFade:!1}),e}clearAllSlots(){this.ringSlots.forEach(e=>{e.modelObject.removeFromParent()}),this.ringSlots=[]}stopRingAnimation(e=!0){var t,i;if(this._runningAnimations.length!==0){for(const r of this._runningAnimations)r.stop();this._runningAnimations=[],e&&((i=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Dl))===null||i===void 0||i.startTransition(1200))}}async startRingAnimation(e=!0){if(this.animating||!this._viewer)return;this.stopRingAnimation(),this.animating=!0;let t=0;const i=[];await new Promise(r=>{var s,o,l;if(!this._viewer)return;const u=()=>{t+=1,t<i.length||r()},h=2500,f=this._viewer.getPlugin(om),g=this.ringSlots[0];if(g){const _=g.modelObject,A={left:[],right:[],rem:[]};_.traverse(T=>{const R=(T==null?void 0:T.name.trim().toLowerCase().replace(/[0-9]/g,""))||"";R.endsWith("-s")?A.left.push(T):R.endsWith("-l")?A.right.push(T):R.startsWith("testlogo")&&A.rem.push(T)});const x=[];for(const T of A.left){const R=((s=T.parent)===null||s===void 0?void 0:s.children)||[];x.push(...R)}for(const T of A.right){const R=((o=T.parent)===null||o===void 0?void 0:o.children)||[];x.push(...R)}for(const T of x)A.left.includes(T)||A.right.includes(T)||A.rem.includes(T)||A.rem.push(T);for(const T of A.rem)new Re().expandByObject(T,!1,!0).getCenter(new p.Pa4).x<=0?A.left.push(T):A.right.push(T);for(const T of[...A.left,...A.right])T.userData.__initX=T.position.x,T.userData.__initRotX=T.rotation.x;const E=(l=this._viewer)===null||l===void 0?void 0:l.getPluginByType("Ground");if(A.left.length>0&&A.right.length>0){const T=I=>S=>{var O,k,N;for(const H of A[I])H.position.x=S+H.userData.__initX;(k=(O=this._viewer)===null||O===void 0?void 0:O.scene)===null||k===void 0||k.setDirty({sceneUpdate:!1,frameFade:!1}),e&&((N=E==null?void 0:E.shadowBaker)===null||N===void 0||N.reset())},R=I=>S=>{var O,k;for(const N of A[I])N.rotation.x=S+N.userData.__initRotX;(k=(O=this._viewer)===null||O===void 0?void 0:O.scene)===null||k===void 0||k.setDirty({sceneUpdate:!1,frameFade:!1})};i.push(f.animate({from:0,to:-.75,onUpdate:T("left"),onStop:()=>{T("left")(0),u()},onComplete:u,duration:h,ease:el.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),i.push(f.animate({from:0,to:.75,onUpdate:T("right"),onStop:()=>{T("right")(0),u()},onComplete:u,duration:h,ease:el.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),i.push(f.animate({from:0,to:1.5*-Math.PI,onUpdate:R("left"),onStop:()=>{R("left")(0),u()},onComplete:u,duration:1250,ease:el.easeInOut,repeat:1,repeatDelay:2750,repeatType:"mirror"}))}}this.ringSlots.forEach(_=>{if(g===_)return;const A=_.modelObject.userData.__ringSlot,x=_.modelObject.userData.__ringTotalSlots,E=_.modelObject.userData.__ringWidth,T=_.modelObject.position.x;i.push(f.animate({from:T,to:T+.75-1.5*(1-(A+1)/(x+1+(2-E))),onUpdate:R=>{var I,S;_.modelObject.position.x=R,(S=(I=this._viewer)===null||I===void 0?void 0:I.scene)===null||S===void 0||S.setDirty({sceneUpdate:!1,frameFade:!1})},onStop:()=>{_.modelObject.position.x=T,u()},onComplete:u,duration:h,ease:el.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"}))}),i.length>0?this._runningAnimations=i:(this.animating=!1,r())}),this.animating=!1;for(const r of this._runningAnimations)r.stop();this._runningAnimations=[],console.log("animation end")}}TC.PluginType="BeringRingAnimation";class nh{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ne);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ne);const i=this.elements,r=e.x,s=e.y,o=e.z;return t.x=i[0]*r+i[1]*s+i[2]*o,t.y=i[3]*r+i[4]*s+i[5]*o,t.z=i[6]*r+i[7]*s+i[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new nh);const i=this.elements,r=e.elements,s=t.elements,o=i[0],l=i[1],u=i[2],h=i[3],f=i[4],g=i[5],_=i[6],A=i[7],x=i[8],E=r[0],T=r[1],R=r[2],I=r[3],S=r[4],O=r[5],k=r[6],N=r[7],H=r[8];return s[0]=o*E+l*I+u*k,s[1]=o*T+l*S+u*N,s[2]=o*R+l*O+u*H,s[3]=h*E+f*I+g*k,s[4]=h*T+f*S+g*N,s[5]=h*R+f*O+g*H,s[6]=_*E+A*I+x*k,s[7]=_*T+A*S+x*N,s[8]=_*R+A*O+x*H,t}scale(e,t){t===void 0&&(t=new nh);const i=this.elements,r=t.elements;for(let s=0;s!==3;s++)r[3*s+0]=e.x*i[3*s+0],r[3*s+1]=e.y*i[3*s+1],r[3*s+2]=e.z*i[3*s+2];return t}solve(e,t){t===void 0&&(t=new ne);const i=[];let r,s;for(r=0;r<12;r++)i.push(0);for(r=0;r<3;r++)for(s=0;s<3;s++)i[r+4*s]=this.elements[r+3*s];i[3]=e.x,i[7]=e.y,i[11]=e.z;let o=3;const l=o;let u,h;do{if(r=l-o,i[r+4*r]===0){for(s=r+1;s<l;s++)if(i[r+4*s]!==0){u=4;do h=4-u,i[h+4*r]+=i[h+4*s];while(--u);break}}if(i[r+4*r]!==0)for(s=r+1;s<l;s++){const f=i[r+4*s]/i[r+4*r];u=4;do h=4-u,i[h+4*s]=h<=r?0:i[h+4*s]-i[h+4*r]*f;while(--u)}}while(--o);if(t.z=i[11]/i[10],t.y=(i[7]-i[6]*t.z)/i[5],t.x=(i[3]-i[2]*t.z-i[1]*t.y)/i[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){e===void 0&&(e=new nh);const t=sB;let i,r;for(i=0;i<3;i++)for(r=0;r<3;r++)t[i+6*r]=this.elements[i+3*r];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let s=3;const o=s;let l,u;do{if(i=o-s,t[i+6*i]===0){for(r=i+1;r<o;r++)if(t[i+6*r]!==0){l=6;do u=6-l,t[u+6*i]+=t[u+6*r];while(--l);break}}if(t[i+6*i]!==0)for(r=i+1;r<o;r++){const h=t[i+6*r]/t[i+6*i];l=6;do u=6-l,t[u+6*r]=u<=i?0:t[u+6*r]-t[u+6*i]*h;while(--l)}}while(--s);i=2;do{r=i-1;do{const h=t[i+6*r]/t[i+6*i];l=6;do u=6-l,t[u+6*r]=t[u+6*r]-t[u+6*i]*h;while(--l)}while(r--)}while(--i);i=2;do{const h=1/t[i+6*i];l=6;do u=6-l,t[u+6*i]=t[u+6*i]*h;while(--l)}while(i--);i=2;do{r=2;do{if(u=t[3+r+6*i],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(i,r,u)}while(r--)}while(i--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,r=e.z,s=e.w,o=t+t,l=i+i,u=r+r,h=t*o,f=t*l,g=t*u,_=i*l,A=i*u,x=r*u,E=s*o,T=s*l,R=s*u,I=this.elements;return I[0]=1-(_+x),I[1]=f-R,I[2]=g+T,I[3]=f+R,I[4]=1-(h+x),I[5]=A-E,I[6]=g-T,I[7]=A+E,I[8]=1-(h+_),this}transpose(e){e===void 0&&(e=new nh);const t=this.elements,i=e.elements;let r;return i[0]=t[0],i[4]=t[4],i[8]=t[8],r=t[1],i[1]=t[3],i[3]=r,r=t[2],i[2]=t[6],i[6]=r,r=t[5],i[5]=t[7],i[7]=r,e}}const sB=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ne{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new ne);const i=e.x,r=e.y,s=e.z,o=this.x,l=this.y,u=this.z;return t.x=l*s-u*r,t.y=u*i-o*s,t.z=o*r-l*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new ne(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new ne(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new nh([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,r=Math.sqrt(e*e+t*t+i*i);if(r>0){const s=1/r;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new ne);const t=this.x,i=this.y,r=this.z;let s=Math.sqrt(t*t+i*i+r*r);return s>0?(s=1/s,e.x=t*s,e.y=i*s,e.z=r*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,l=e.z;return Math.sqrt((s-t)*(s-t)+(o-i)*(o-i)+(l-r)*(l-r))}distanceSquared(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,l=e.z;return(s-t)*(s-t)+(o-i)*(o-i)+(l-r)*(l-r)}scale(e,t){t===void 0&&(t=new ne);const i=this.x,r=this.y,s=this.z;return t.x=e*i,t.y=e*r,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new ne),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new ne),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ne),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const r=aB,s=1/i;r.set(this.x*s,this.y*s,this.z*s);const o=oB;Math.abs(r.x)<.9?(o.set(1,0,0),r.cross(o,e)):(o.set(0,1,0),r.cross(o,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const r=this.x,s=this.y,o=this.z;i.x=r+(e.x-r)*t,i.y=s+(e.y-s)*t,i.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(sI),sI.almostEquals(e,t)}clone(){return new ne(this.x,this.y,this.z)}}ne.ZERO=new ne(0,0,0),ne.UNIT_X=new ne(1,0,0),ne.UNIT_Y=new ne(0,1,0),ne.UNIT_Z=new ne(0,0,1);const aB=new ne,oB=new ne,sI=new ne;class ds{constructor(e){e===void 0&&(e={}),this.lowerBound=new ne,this.upperBound=new ne,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,r){const s=this.lowerBound,o=this.upperBound,l=i;s.copy(e[0]),l&&l.vmult(s,s),o.copy(s);for(let u=1;u<e.length;u++){let h=e[u];l&&(l.vmult(h,aI),h=aI),h.x>o.x&&(o.x=h.x),h.x<s.x&&(s.x=h.x),h.y>o.y&&(o.y=h.y),h.y<s.y&&(s.y=h.y),h.z>o.z&&(o.z=h.z),h.z<s.z&&(s.z=h.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),r&&(s.x-=r,s.y-=r,s.z-=r,o.x+=r,o.y+=r,o.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new ds().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound,o=r.x<=i.x&&i.x<=s.x||t.x<=s.x&&s.x<=i.x,l=r.y<=i.y&&i.y<=s.y||t.y<=s.y&&s.y<=i.y,u=r.z<=i.z&&i.z<=s.z||t.z<=s.z&&s.z<=i.z;return o&&l&&u}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,r=e.lowerBound,s=e.upperBound;return t.x<=r.x&&i.x>=s.x&&t.y<=r.y&&i.y>=s.y&&t.z<=r.z&&i.z>=s.z}getCorners(e,t,i,r,s,o,l,u){const h=this.lowerBound,f=this.upperBound;e.copy(h),t.set(f.x,h.y,h.z),i.set(f.x,f.y,h.z),r.set(h.x,f.y,f.z),s.set(f.x,h.y,f.z),o.set(h.x,f.y,h.z),l.set(h.x,h.y,f.z),u.copy(f)}toLocalFrame(e,t){const i=oI,r=i[0],s=i[1],o=i[2],l=i[3],u=i[4],h=i[5],f=i[6],g=i[7];this.getCorners(r,s,o,l,u,h,f,g);for(let _=0;_!==8;_++){const A=i[_];e.pointToLocal(A,A)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=oI,r=i[0],s=i[1],o=i[2],l=i[3],u=i[4],h=i[5],f=i[6],g=i[7];this.getCorners(r,s,o,l,u,h,f,g);for(let _=0;_!==8;_++){const A=i[_];e.pointToWorld(A,A)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,r=1/t.x,s=1/t.y,o=1/t.z,l=(this.lowerBound.x-i.x)*r,u=(this.upperBound.x-i.x)*r,h=(this.lowerBound.y-i.y)*s,f=(this.upperBound.y-i.y)*s,g=(this.lowerBound.z-i.z)*o,_=(this.upperBound.z-i.z)*o,A=Math.max(Math.max(Math.min(l,u),Math.min(h,f)),Math.min(g,_)),x=Math.min(Math.min(Math.max(l,u),Math.max(h,f)),Math.max(g,_));return!(x<0||A>x)}}const aI=new ne,oI=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne];class lI{constructor(){this.matrix=[]}get(e,t){let{index:i}=e,{index:r}=t;if(r>i){const s=r;r=i,i=s}return this.matrix[(i*(i+1)>>1)+r-1]}set(e,t,i){let{index:r}=e,{index:s}=t;if(s>r){const o=s;s=r,r=o}this.matrix[(r*(r+1)>>1)+s-1]=i?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class cI{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;return i[e]===void 0&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return!(i[e]===void 0||!i[e].includes(t))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const i=this._listeners;if(i[e]===void 0)return this;const r=i[e].indexOf(t);return r!==-1&&i[e].splice(r,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let i=0,r=t.length;i<r;i++)t[i].call(this,e)}return this}}class Ss{constructor(e,t,i,r){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),r===void 0&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}toAxisAngle(e){e===void 0&&(e=new ne),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=lB,r=cB;e.tangents(i,r),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Ss);const i=this.x,r=this.y,s=this.z,o=this.w,l=e.x,u=e.y,h=e.z,f=e.w;return t.x=i*f+o*l+r*h-s*u,t.y=r*f+o*u+s*l-i*h,t.z=s*f+o*h+i*u-r*l,t.w=o*f-i*l-r*u-s*h,t}inverse(e){e===void 0&&(e=new Ss);const t=this.x,i=this.y,r=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+i*i+r*r+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new Ss),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ne);const i=e.x,r=e.y,s=e.z,o=this.x,l=this.y,u=this.z,h=this.w,f=h*i+l*s-u*r,g=h*r+u*i-o*s,_=h*s+o*r-l*i,A=-o*i-l*r-u*s;return t.x=f*h+A*-o+g*-u-_*-l,t.y=g*h+A*-l+_*-o-f*-u,t.z=_*h+A*-u+f*-l-g*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let i,r,s;t===void 0&&(t="YZX");const o=this.x,l=this.y,u=this.z,h=this.w;if(t!=="YZX")throw new Error(`Euler order ${t} not supported yet.`);{const f=o*l+u*h;if(f>.499&&(i=2*Math.atan2(o,h),r=Math.PI/2,s=0),f<-.499&&(i=-2*Math.atan2(o,h),r=-Math.PI/2,s=0),i===void 0){const g=o*o,_=l*l,A=u*u;i=Math.atan2(2*l*h-2*o*u,1-2*_-2*A),r=Math.asin(2*f),s=Math.atan2(2*o*h-2*l*u,1-2*g-2*A)}}e.y=i,e.z=r,e.x=s}setFromEuler(e,t,i,r){r===void 0&&(r="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(i/2),u=Math.sin(e/2),h=Math.sin(t/2),f=Math.sin(i/2);return r==="XYZ"?(this.x=u*o*l+s*h*f,this.y=s*h*l-u*o*f,this.z=s*o*f+u*h*l,this.w=s*o*l-u*h*f):r==="YXZ"?(this.x=u*o*l+s*h*f,this.y=s*h*l-u*o*f,this.z=s*o*f-u*h*l,this.w=s*o*l+u*h*f):r==="ZXY"?(this.x=u*o*l-s*h*f,this.y=s*h*l+u*o*f,this.z=s*o*f+u*h*l,this.w=s*o*l-u*h*f):r==="ZYX"?(this.x=u*o*l-s*h*f,this.y=s*h*l+u*o*f,this.z=s*o*f-u*h*l,this.w=s*o*l+u*h*f):r==="YZX"?(this.x=u*o*l+s*h*f,this.y=s*h*l+u*o*f,this.z=s*o*f-u*h*l,this.w=s*o*l-u*h*f):r==="XZY"&&(this.x=u*o*l-s*h*f,this.y=s*h*l-u*o*f,this.z=s*o*f+u*h*l,this.w=s*o*l+u*h*f),this}clone(){return new Ss(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Ss);const r=this.x,s=this.y,o=this.z,l=this.w;let u,h,f,g,_,A=e.x,x=e.y,E=e.z,T=e.w;return h=r*A+s*x+o*E+l*T,h<0&&(h=-h,A=-A,x=-x,E=-E,T=-T),1-h>1e-6?(u=Math.acos(h),f=Math.sin(u),g=Math.sin((1-t)*u)/f,_=Math.sin(t*u)/f):(g=1-t,_=t),i.x=g*r+_*A,i.y=g*s+_*x,i.z=g*o+_*E,i.w=g*l+_*T,i}integrate(e,t,i,r){r===void 0&&(r=new Ss);const s=e.x*i.x,o=e.y*i.y,l=e.z*i.z,u=this.x,h=this.y,f=this.z,g=this.w,_=.5*t;return r.x+=_*(s*g+o*f-l*h),r.y+=_*(o*g+l*u-s*f),r.z+=_*(l*g+s*h-o*u),r.w+=_*(-s*u-o*h-l*f),r}}const lB=new ne,cB=new ne;class Di{constructor(e){e===void 0&&(e={}),this.id=Di.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Di.idCounter=0,Di.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class rn{constructor(e){e===void 0&&(e={}),this.position=new ne,this.quaternion=new Ss,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return rn.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return rn.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ne),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,r){return r===void 0&&(r=new ne),i.vsub(e,r),t.conjugate(uI),uI.vmult(r,r),r}static pointToWorldFrame(e,t,i,r){return r===void 0&&(r=new ne),t.vmult(i,r),r.vadd(e,r),r}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new ne),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,r){return r===void 0&&(r=new ne),t.w*=-1,t.vmult(i,r),t.w*=-1,r}}const uI=new Ss;class nv extends Di{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:i=[],normals:r=[],axes:s,boundingSphereRadius:o}=e;super({type:Di.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=i,this.faceNormals=r,this.faceNormals.length===0&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;const r=new ne;for(let s=0;s!==e.length;s++){const o=e[s],l=o.length;for(let u=0;u!==l;u++){const h=(u+1)%l;t[o[u]].vsub(t[o[h]],r),r.normalize();let f=!1;for(let g=0;g!==i.length;g++)if(i[g].almostEquals(r)||i[g].almostEquals(r)){f=!0;break}f||i.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let r=0;r<this.faces[e].length;r++)if(!this.vertices[this.faces[e][r]])throw new Error(`Vertex ${this.faces[e][r]} not found!`);const t=this.faceNormals[e]||new ne;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const i=this.vertices[this.faces[e][0]];if(t.dot(i)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let r=0;r<this.faces[e].length;r++)console.warn(`.vertices[${this.faces[e][r]}] = Vec3(${this.vertices[this.faces[e][r]].toString()})`)}}}getFaceNormal(e,t){const i=this.faces[e],r=this.vertices[i[0]],s=this.vertices[i[1]],o=this.vertices[i[2]];nv.computeNormal(r,s,o,t)}static computeNormal(e,t,i,r){const s=new ne,o=new ne;t.vsub(e,o),i.vsub(t,s),s.cross(o,r),r.isZero()||r.normalize()}clipAgainstHull(e,t,i,r,s,o,l,u,h){const f=new ne;let g=-1,_=-Number.MAX_VALUE;for(let x=0;x<i.faces.length;x++){f.copy(i.faceNormals[x]),s.vmult(f,f);const E=f.dot(o);E>_&&(_=E,g=x)}const A=[];for(let x=0;x<i.faces[g].length;x++){const E=i.vertices[i.faces[g][x]],T=new ne;T.copy(E),s.vmult(T,T),r.vadd(T,T),A.push(T)}g>=0&&this.clipFaceAgainstHull(o,e,t,A,l,u,h)}findSeparatingAxis(e,t,i,r,s,o,l,u){const h=new ne,f=new ne,g=new ne,_=new ne,A=new ne,x=new ne;let E=Number.MAX_VALUE;const T=this;if(T.uniqueAxes)for(let R=0;R!==T.uniqueAxes.length;R++){i.vmult(T.uniqueAxes[R],h);const I=T.testSepAxis(h,e,t,i,r,s);if(I===!1)return!1;I<E&&(E=I,o.copy(h))}else{const R=l?l.length:T.faces.length;for(let I=0;I<R;I++){const S=l?l[I]:I;h.copy(T.faceNormals[S]),i.vmult(h,h);const O=T.testSepAxis(h,e,t,i,r,s);if(O===!1)return!1;O<E&&(E=O,o.copy(h))}}if(e.uniqueAxes)for(let R=0;R!==e.uniqueAxes.length;R++){s.vmult(e.uniqueAxes[R],f);const I=T.testSepAxis(f,e,t,i,r,s);if(I===!1)return!1;I<E&&(E=I,o.copy(f))}else{const R=u?u.length:e.faces.length;for(let I=0;I<R;I++){const S=u?u[I]:I;f.copy(e.faceNormals[S]),s.vmult(f,f);const O=T.testSepAxis(f,e,t,i,r,s);if(O===!1)return!1;O<E&&(E=O,o.copy(f))}}for(let R=0;R!==T.uniqueEdges.length;R++){i.vmult(T.uniqueEdges[R],_);for(let I=0;I!==e.uniqueEdges.length;I++)if(s.vmult(e.uniqueEdges[I],A),_.cross(A,x),!x.almostZero()){x.normalize();const S=T.testSepAxis(x,e,t,i,r,s);if(S===!1)return!1;S<E&&(E=S,o.copy(x))}}return r.vsub(t,g),g.dot(o)>0&&o.negate(o),!0}testSepAxis(e,t,i,r,s,o){nv.project(this,e,i,r,IC),nv.project(t,e,s,o,PC);const l=IC[0],u=IC[1],h=PC[0],f=PC[1];if(l<f||h<u)return!1;const g=l-f,_=h-u;return g<_?g:_}calculateLocalInertia(e,t){const i=new ne,r=new ne;this.computeLocalAABB(r,i);const s=i.x-r.x,o=i.y-r.y,l=i.z-r.z;t.x=1/12*e*(2*o*2*o+2*l*2*l),t.y=1/12*e*(2*s*2*s+2*l*2*l),t.z=1/12*e*(2*o*2*o+2*s*2*s)}getPlaneConstantOfFace(e){const t=this.faces[e],i=this.faceNormals[e],r=this.vertices[t[0]];return-i.dot(r)}clipFaceAgainstHull(e,t,i,r,s,o,l){const u=new ne,h=new ne,f=new ne,g=new ne,_=new ne,A=new ne,x=new ne,E=new ne,T=this,R=r,I=[];let S=-1,O=Number.MAX_VALUE;for(let te=0;te<T.faces.length;te++){u.copy(T.faceNormals[te]),i.vmult(u,u);const re=u.dot(e);re<O&&(O=re,S=te)}if(S<0)return;const k=T.faces[S];k.connectedFaces=[];for(let te=0;te<T.faces.length;te++)for(let re=0;re<T.faces[te].length;re++)k.indexOf(T.faces[te][re])!==-1&&te!==S&&k.connectedFaces.indexOf(te)===-1&&k.connectedFaces.push(te);const N=k.length;for(let te=0;te<N;te++){const re=T.vertices[k[te]],ue=T.vertices[k[(te+1)%N]];re.vsub(ue,h),f.copy(h),i.vmult(f,f),t.vadd(f,f),g.copy(this.faceNormals[S]),i.vmult(g,g),t.vadd(g,g),f.cross(g,_),_.negate(_),A.copy(re),i.vmult(A,A),t.vadd(A,A);const le=k.connectedFaces[te];x.copy(this.faceNormals[le]);const se=this.getPlaneConstantOfFace(le);E.copy(x),i.vmult(E,E);const de=se-E.dot(t);for(this.clipFaceAgainstPlane(R,I,E,de);R.length;)R.shift();for(;I.length;)R.push(I.shift())}x.copy(this.faceNormals[S]);const H=this.getPlaneConstantOfFace(S);E.copy(x),i.vmult(E,E);const X=H-E.dot(t);for(let te=0;te<R.length;te++){let re=E.dot(R[te])+X;if(re<=s&&(console.log(`clamped: depth=${re} to minDist=${s}`),re=s),re<=o){const ue=R[te];if(re<=1e-6){const le={point:ue,normal:E,depth:re};l.push(le)}}}}clipFaceAgainstPlane(e,t,i,r){let s,o;const l=e.length;if(l<2)return t;let u=e[e.length-1],h=e[0];s=i.dot(u)+r;for(let f=0;f<l;f++){if(h=e[f],o=i.dot(h)+r,s<0)if(o<0){const g=new ne;g.copy(h),t.push(g)}else{const g=new ne;u.lerp(h,s/(s-o),g),t.push(g)}else if(o<0){const g=new ne;u.lerp(h,s/(s-o),g),t.push(g),t.push(h)}u=h,s=o}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new ne);const i=this.vertices,r=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)t.vmult(i[s],r[s]),e.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const s=i[r];s.x<e.x?e.x=s.x:s.x>t.x&&(t.x=s.x),s.y<e.y?e.y=s.y:s.y>t.y&&(t.y=s.y),s.z<e.z?e.z=s.z:s.z>t.z&&(t.z=s.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new ne);const i=this.faceNormals,r=this.worldFaceNormals;for(let s=0;s!==t;s++)e.vmult(i[s],r[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let i=0;i!==t.length;i++){const r=t[i].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,r){const s=this.vertices;let o,l,u,h,f,g,_=new ne;for(let A=0;A<s.length;A++){_.copy(s[A]),t.vmult(_,_),e.vadd(_,_);const x=_;(o===void 0||x.x<o)&&(o=x.x),(h===void 0||x.x>h)&&(h=x.x),(l===void 0||x.y<l)&&(l=x.y),(f===void 0||x.y>f)&&(f=x.y),(u===void 0||x.z<u)&&(u=x.z),(g===void 0||x.z>g)&&(g=x.z)}i.set(o,l,u),r.set(h,f,g)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new ne);const t=this.vertices;for(let i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const i=this.vertices.length,r=this.vertices;if(t){for(let s=0;s<i;s++){const o=r[s];t.vmult(o,o)}for(let s=0;s<this.faceNormals.length;s++){const o=this.faceNormals[s];t.vmult(o,o)}}if(e)for(let s=0;s<i;s++){const o=r[s];o.vadd(e,o)}}pointIsInside(e){const t=this.vertices,i=this.faces,r=this.faceNormals,s=new ne;this.getAveragePointLocal(s);for(let o=0;o<this.faces.length;o++){let l=r[o];const u=t[i[o][0]],h=new ne;e.vsub(u,h);const f=l.dot(h),g=new ne;s.vsub(u,g);const _=l.dot(g);if(f<0&&_>0||f>0&&_<0)return!1}return-1}static project(e,t,i,r,s){const o=e.vertices.length,l=uB;let u=0,h=0;const f=hB,g=e.vertices;f.setZero(),rn.vectorToLocalFrame(i,r,t,l),rn.pointToLocalFrame(i,r,f,f);const _=f.dot(l);h=u=g[0].dot(l);for(let A=1;A<o;A++){const x=g[A].dot(l);x>u&&(u=x),x<h&&(h=x)}if(h-=_,u-=_,h>u){const A=h;h=u,u=A}s[0]=u,s[1]=h}}const IC=[],PC=[],uB=(new ne,new ne),hB=new ne;class u1 extends Di{constructor(e){super({type:Di.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,r=ne,s=[new r(-e,-t,-i),new r(e,-t,-i),new r(e,t,-i),new r(-e,t,-i),new r(-e,-t,i),new r(e,-t,i),new r(e,t,i),new r(-e,t,i)],o=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],l=new nv({vertices:s,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:o});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new ne),u1.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,i){const r=e;i.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),i.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),i.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,t){const i=e,r=this.halfExtents;if(i[0].set(r.x,0,0),i[1].set(0,r.y,0),i[2].set(0,0,r.z),i[3].set(-r.x,0,0),i[4].set(0,-r.y,0),i[5].set(0,0,-r.z),t!==void 0)for(let s=0;s!==i.length;s++)t.vmult(i[s],i[s]);return i}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,i){const r=this.halfExtents,s=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let o=0;o<s.length;o++)gm.set(s[o][0],s[o][1],s[o][2]),t.vmult(gm,gm),e.vadd(gm,gm),i(gm.x,gm.y,gm.z)}calculateWorldAABB(e,t,i,r){const s=this.halfExtents;vd[0].set(s.x,s.y,s.z),vd[1].set(-s.x,s.y,s.z),vd[2].set(-s.x,-s.y,s.z),vd[3].set(-s.x,-s.y,-s.z),vd[4].set(s.x,-s.y,-s.z),vd[5].set(s.x,s.y,-s.z),vd[6].set(-s.x,s.y,-s.z),vd[7].set(s.x,-s.y,s.z);const o=vd[0];t.vmult(o,o),e.vadd(o,o),r.copy(o),i.copy(o);for(let l=1;l<8;l++){const u=vd[l];t.vmult(u,u),e.vadd(u,u);const h=u.x,f=u.y,g=u.z;h>r.x&&(r.x=h),f>r.y&&(r.y=f),g>r.z&&(r.z=g),h<i.x&&(i.x=h),f<i.y&&(i.y=f),g<i.z&&(i.z=g)}}}const gm=new ne,vd=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne];class ki extends cI{constructor(e){e===void 0&&(e={}),super(),this.id=ki.idCounter++,this.index=-1,this.world=null,this.vlambda=new ne,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new ne,this.previousPosition=new ne,this.interpolatedPosition=new ne,this.initPosition=new ne,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new ne,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new ne,this.force=new ne;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?ki.STATIC:ki.DYNAMIC,typeof e.type==typeof ki.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=ki.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new ne,this.quaternion=new Ss,this.initQuaternion=new Ss,this.previousQuaternion=new Ss,this.interpolatedQuaternion=new Ss,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new ne,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new ne,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new ne,this.invInertia=new ne,this.invInertiaWorld=new nh,this.invMassSolve=0,this.invInertiaSolve=new ne,this.invInertiaWorldSolve=new nh,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new ne(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new ne(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new ds,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new ne,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=ki.AWAKE,this.wakeUpAfterNarrowphase=!1,e===ki.SLEEPING&&this.dispatchEvent(ki.wakeupEvent)}sleep(){this.sleepState=ki.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;t===ki.AWAKE&&i<r?(this.sleepState=ki.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(ki.sleepyEvent)):t===ki.SLEEPY&&i>r?this.wakeUp():t===ki.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(ki.sleepEvent))}}updateSolveMassProperties(){this.sleepState===ki.SLEEPING||this.type===ki.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new ne),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new ne),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new ne),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new ne),this.quaternion.vmult(e,t),t}addShape(e,t,i){const r=new ne,s=new Ss;return t&&r.copy(t),i&&s.copy(i),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,i=e.length;let r=0;for(let s=0;s!==i;s++){const o=e[s];o.updateBoundingSphereRadius();const l=t[s].length(),u=o.boundingSphereRadius;l+u>r&&(r=l+u)}this.boundingRadius=r}updateAABB(){const e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,r=e.length,s=dB,o=pB,l=this.quaternion,u=this.aabb,h=fB;for(let f=0;f!==r;f++){const g=e[f];l.vmult(t[f],s),s.vadd(this.position,s),l.mult(i[f],o),g.calculateWorldAABB(s,o,h.lowerBound,h.upperBound),f===0?u.copy(h):u.extend(h)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const i=mB,r=gB;i.setRotationFromQuaternion(this.quaternion),i.transpose(r),i.scale(t,i),i.mmult(r,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new ne),this.type!==ki.DYNAMIC)return;this.sleepState===ki.SLEEPING&&this.wakeUp();const i=vB;t.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new ne),this.type!==ki.DYNAMIC)return;const i=_B,r=yB;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyForce(i,r)}applyTorque(e){this.type===ki.DYNAMIC&&(this.sleepState===ki.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new ne),this.type!==ki.DYNAMIC)return;this.sleepState===ki.SLEEPING&&this.wakeUp();const i=t,r=bB;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const s=AB;i.cross(e,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new ne),this.type!==ki.DYNAMIC)return;const i=wB,r=xB;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyImpulse(i,r)}updateMassProperties(){const e=EB;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,i=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),u1.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const i=new ne;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}integrate(e,t,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==ki.DYNAMIC&&this.type!==ki.KINEMATIC||this.sleepState===ki.SLEEPING)return;const r=this.velocity,s=this.angularVelocity,o=this.position,l=this.force,u=this.torque,h=this.quaternion,f=this.invMass,g=this.invInertiaWorld,_=this.linearFactor,A=f*e;r.x+=l.x*A*_.x,r.y+=l.y*A*_.y,r.z+=l.z*A*_.z;const x=g.elements,E=this.angularFactor,T=u.x*E.x,R=u.y*E.y,I=u.z*E.z;s.x+=e*(x[0]*T+x[1]*R+x[2]*I),s.y+=e*(x[3]*T+x[4]*R+x[5]*I),s.z+=e*(x[6]*T+x[7]*R+x[8]*I),o.x+=r.x*e,o.y+=r.y*e,o.z+=r.z*e,h.integrate(this.angularVelocity,e,this.angularFactor,h),t&&(i?h.normalizeFast():h.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}ki.idCounter=0,ki.COLLIDE_EVENT_NAME="collide",ki.DYNAMIC=1,ki.STATIC=2,ki.KINEMATIC=4,ki.AWAKE=0,ki.SLEEPY=1,ki.SLEEPING=2,ki.wakeupEvent={type:"wakeup"},ki.sleepyEvent={type:"sleepy"},ki.sleepEvent={type:"sleep"};const dB=new ne,pB=new Ss,fB=new ds,mB=new nh,gB=new nh,vB=(new nh,new ne),_B=new ne,yB=new ne,bB=new ne,AB=new ne,wB=new ne,xB=new ne,EB=new ne;class SB{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&ki.STATIC)==0&&e.sleepState!==ki.SLEEPING||(t.type&ki.STATIC)==0&&t.sleepState!==ki.SLEEPING)}intersectionTest(e,t,i,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,r):this.doBoundingSphereBroadphase(e,t,i,r)}doBoundingSphereBroadphase(e,t,i,r){const s=CB;t.position.vsub(e.position,s);const o=(e.boundingRadius+t.boundingRadius)**2;s.lengthSquared()<o&&(i.push(e),r.push(t))}doBoundingBoxBroadphase(e,t,i,r){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),r.push(t))}makePairsUnique(e,t){const i=MB,r=TB,s=IB,o=e.length;for(let l=0;l!==o;l++)r[l]=e[l],s[l]=t[l];e.length=0,t.length=0;for(let l=0;l!==o;l++){const u=r[l].id,h=s[l].id,f=u<h?`${u},${h}`:`${h},${u}`;i[f]=l,i.keys.push(f)}for(let l=0;l!==i.keys.length;l++){const u=i.keys.pop(),h=i[u];e.push(r[h]),t.push(s[h]),delete i[u]}}setWorld(e){}static boundingSphereCheck(e,t){const i=new ne;e.position.vsub(t.position,i);const r=e.shapes[0],s=t.shapes[0];return Math.pow(r.boundingSphereRadius+s.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const CB=new ne;new ne,new Ss,new ne;const MB={keys:[]},TB=[],IB=[];new ne,new ne,new ne;class PB extends SB{constructor(){super()}collisionPairs(e,t,i){const r=e.bodies,s=r.length;let o,l;for(let u=0;u!==s;u++)for(let h=0;h!==u;h++)o=r[u],l=r[h],this.needBroadphaseCollision(o,l)&&this.intersectionTest(o,l,t,i)}aabbQuery(e,t,i){i===void 0&&(i=[]);for(let r=0;r<e.bodies.length;r++){const s=e.bodies[r];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&i.push(s)}return i}}class h1{constructor(){this.rayFromWorld=new ne,this.rayToWorld=new ne,this.hitNormalWorld=new ne,this.hitPointWorld=new ne,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,r,s,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(r),this.shape=s,this.body=o,this.distance=l}}let hI,dI,pI,fI,mI,gI,vI;hI=Di.types.SPHERE,dI=Di.types.PLANE,pI=Di.types.BOX,fI=Di.types.CYLINDER,mI=Di.types.CONVEXPOLYHEDRON,gI=Di.types.HEIGHTFIELD,vI=Di.types.TRIMESH;class ca{get[hI](){return this._intersectSphere}get[dI](){return this._intersectPlane}get[pI](){return this._intersectBox}get[fI](){return this._intersectConvex}get[mI](){return this._intersectConvex}get[gI](){return this._intersectHeightfield}get[vI](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ne),t===void 0&&(t=new ne),this.from=e.clone(),this.to=t.clone(),this.direction=new ne,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ca.ANY,this.result=new h1,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||ca.ANY,this.result=t.result||new h1,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:-1,this.checkCollisionResponse=t.checkCollisionResponse===void 0||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(_I),RC.length=0,e.broadphase.aabbQuery(e,_I,RC),this.intersectBodies(RC),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const r=RB,s=DB;for(let o=0,l=e.shapes.length;o<l;o++){const u=e.shapes[o];if((!i||u.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],r),r.vadd(e.position,r),this.intersectShape(u,s,r,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,r=e.length;!this.result.shouldStop&&i<r;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,r){if(function(o,l,u){u.vsub(o,sv);const h=sv.dot(l);return l.scale(h,p1),p1.vadd(o,p1),u.distanceTo(p1)}(this.from,this.direction,i)>e.boundingSphereRadius)return;const s=this[e.type];s&&s.call(this,e,t,i,r,e)}_intersectBox(e,t,i,r,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,r,s)}_intersectPlane(e,t,i,r,s){const o=this.from,l=this.to,u=this.direction,h=new ne(0,0,1);t.vmult(h,h);const f=new ne;o.vsub(i,f);const g=f.dot(h);if(l.vsub(i,f),g*f.dot(h)>0||o.distanceTo(l)<g)return;const _=h.dot(u);if(Math.abs(_)<this.precision)return;const A=new ne,x=new ne,E=new ne;o.vsub(i,A);const T=-h.dot(A)/_;u.scale(T,x),o.vadd(x,E),this.reportIntersection(h,E,s,r,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,r=this.to,s=this.from;t.x=Math.min(r.x,s.x),t.y=Math.min(r.y,s.y),t.z=Math.min(r.z,s.z),i.x=Math.max(r.x,s.x),i.y=Math.max(r.y,s.y),i.z=Math.max(r.z,s.z)}_intersectHeightfield(e,t,i,r,s){e.data,e.elementSize;const o=BB;o.from.copy(this.from),o.to.copy(this.to),rn.pointToLocalFrame(i,t,o.from,o.from),rn.pointToLocalFrame(i,t,o.to,o.to),o.updateDirection();const l=OB;let u,h,f,g;u=h=0,f=g=e.data.length-1;const _=new ds;o.getAABB(_),e.getIndexOfPosition(_.lowerBound.x,_.lowerBound.y,l,!0),u=Math.max(u,l[0]),h=Math.max(h,l[1]),e.getIndexOfPosition(_.upperBound.x,_.upperBound.y,l,!0),f=Math.min(f,l[0]+1),g=Math.min(g,l[1]+1);for(let A=u;A<f;A++)for(let x=h;x<g;x++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,x,_),_.overlapsRay(o)){if(e.getConvexTrianglePillar(A,x,!1),rn.pointToWorldFrame(i,t,e.pillarOffset,d1),this._intersectConvex(e.pillarConvex,t,d1,r,s,yI),this.result.shouldStop)return;e.getConvexTrianglePillar(A,x,!0),rn.pointToWorldFrame(i,t,e.pillarOffset,d1),this._intersectConvex(e.pillarConvex,t,d1,r,s,yI)}}}_intersectSphere(e,t,i,r,s){const o=this.from,l=this.to,u=e.radius,h=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,f=2*((l.x-o.x)*(o.x-i.x)+(l.y-o.y)*(o.y-i.y)+(l.z-o.z)*(o.z-i.z)),g=f**2-4*h*((o.x-i.x)**2+(o.y-i.y)**2+(o.z-i.z)**2-u**2),_=LB,A=kB;if(!(g<0))if(g===0)o.lerp(l,g,_),_.vsub(i,A),A.normalize(),this.reportIntersection(A,_,s,r,-1);else{const x=(-f-Math.sqrt(g))/(2*h),E=(-f+Math.sqrt(g))/(2*h);if(x>=0&&x<=1&&(o.lerp(l,x,_),_.vsub(i,A),A.normalize(),this.reportIntersection(A,_,s,r,-1)),this.result.shouldStop)return;E>=0&&E<=1&&(o.lerp(l,E,_),_.vsub(i,A),A.normalize(),this.reportIntersection(A,_,s,r,-1))}}_intersectConvex(e,t,i,r,s,o){const l=UB,u=bI,h=o&&o.faceList||null,f=e.faces,g=e.vertices,_=e.faceNormals,A=this.direction,x=this.from,E=this.to,T=x.distanceTo(E),R=h?h.length:f.length,I=this.result;for(let S=0;!I.shouldStop&&S<R;S++){const O=h?h[S]:S,k=f[O],N=_[O],H=t,X=i;u.copy(g[k[0]]),H.vmult(u,u),u.vadd(X,u),u.vsub(x,u),H.vmult(N,l);const te=A.dot(l);if(Math.abs(te)<this.precision)continue;const re=l.dot(u)/te;if(!(re<0)){A.scale(re,Wl),Wl.vadd(x,Wl),sh.copy(g[k[0]]),H.vmult(sh,sh),X.vadd(sh,sh);for(let ue=1;!I.shouldStop&&ue<k.length-1;ue++){_d.copy(g[k[ue]]),yd.copy(g[k[ue+1]]),H.vmult(_d,_d),H.vmult(yd,yd),X.vadd(_d,_d),X.vadd(yd,yd);const le=Wl.distanceTo(x);!ca.pointInTriangle(Wl,sh,_d,yd)&&!ca.pointInTriangle(Wl,_d,sh,yd)||le>T||this.reportIntersection(l,Wl,s,r,O)}}}}_intersectTrimesh(e,t,i,r,s,o){const l=NB,u=HB,h=QB,f=bI,g=FB,_=jB,A=zB,x=GB,E=VB,T=e.indices;e.vertices;const R=this.from,I=this.to,S=this.direction;h.position.copy(i),h.quaternion.copy(t),rn.vectorToLocalFrame(i,t,S,g),rn.pointToLocalFrame(i,t,R,_),rn.pointToLocalFrame(i,t,I,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,_.x*=e.scale.x,_.y*=e.scale.y,_.z*=e.scale.z,A.vsub(_,g),g.normalize();const O=_.distanceSquared(A);e.tree.rayQuery(this,h,u);for(let k=0,N=u.length;!this.result.shouldStop&&k!==N;k++){const H=u[k];e.getNormal(H,l),e.getVertex(T[3*H],sh),sh.vsub(_,f);const X=g.dot(l),te=l.dot(f)/X;if(te<0)continue;g.scale(te,Wl),Wl.vadd(_,Wl),e.getVertex(T[3*H+1],_d),e.getVertex(T[3*H+2],yd);const re=Wl.distanceSquared(_);!ca.pointInTriangle(Wl,_d,sh,yd)&&!ca.pointInTriangle(Wl,sh,_d,yd)||re>O||(rn.vectorToWorldFrame(t,l,E),rn.pointToWorldFrame(i,t,Wl,x),this.reportIntersection(E,x,s,r,H))}u.length=0}reportIntersection(e,t,i,r,s){const o=this.from,l=this.to,u=o.distanceTo(t),h=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(h.hitFaceIndex=s!==void 0?s:-1,this.mode){case ca.ALL:this.hasHit=!0,h.set(o,l,e,t,i,r,u),h.hasHit=!0,this.callback(h);break;case ca.CLOSEST:(u<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(o,l,e,t,i,r,u));break;case ca.ANY:this.hasHit=!0,h.hasHit=!0,h.set(o,l,e,t,i,r,u),h.shouldStop=!0}}static pointInTriangle(e,t,i,r){r.vsub(t,sv),i.vsub(t,Kb),e.vsub(t,DC);const s=sv.dot(sv),o=sv.dot(Kb),l=sv.dot(DC),u=Kb.dot(Kb),h=Kb.dot(DC);let f,g;return(f=u*l-o*h)>=0&&(g=s*h-o*l)>=0&&f+g<s*u-o*o}}ca.CLOSEST=1,ca.ANY=2,ca.ALL=4;const _I=new ds,RC=[],Kb=new ne,DC=new ne,RB=new ne,DB=new Ss,Wl=new ne,sh=new ne,_d=new ne,yd=new ne;new ne,new h1;const yI={faceList:[0]},d1=new ne,BB=new ca,OB=[],LB=new ne,kB=new ne,UB=new ne,bI=(new ne,new ne,new ne),NB=new ne,FB=new ne,jB=new ne,zB=new ne,VB=new ne,GB=new ne;new ds;const HB=[],QB=new rn,sv=new ne,p1=new ne;class AI{static defaults(e,t){e===void 0&&(e={});for(let i in t)i in e||(e[i]=t[i]);return e}}class f1{constructor(e,t,i){i===void 0&&(i={}),i=AI.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=f1.idCounter++,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}f1.idCounter=0;class wI{constructor(){this.spatial=new ne,this.rotational=new ne}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Zb{constructor(e,t,i,r){i===void 0&&(i=-1e6),r===void 0&&(r=1e6),this.id=Zb.idCounter++,this.minForce=i,this.maxForce=r,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new wI,this.jacobianElementB=new wI,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,i){const r=t,s=e,o=i;this.a=4/(o*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(o*o*s*(1+4*r))}computeB(e,t,i){const r=this.computeGW();return-this.computeGq()*e-r*t-this.computeGiMf()*i}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.position,o=r.position;return e.spatial.dot(s)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.velocity,o=r.velocity,l=i.angularVelocity,u=r.angularVelocity;return e.multiplyVectors(s,l)+t.multiplyVectors(o,u)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.vlambda,o=r.vlambda,l=i.wlambda,u=r.wlambda;return e.multiplyVectors(s,l)+t.multiplyVectors(o,u)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.force,o=i.torque,l=r.force,u=r.torque,h=i.invMassSolve,f=r.invMassSolve;return s.scale(h,xI),l.scale(f,EI),i.invInertiaWorldSolve.vmult(o,SI),r.invInertiaWorldSolve.vmult(u,CI),e.multiplyVectors(xI,SI)+t.multiplyVectors(EI,CI)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,r=this.bj,s=i.invMassSolve,o=r.invMassSolve,l=i.invInertiaWorldSolve,u=r.invInertiaWorldSolve;let h=s+o;return l.vmult(e.rotational,m1),h+=m1.dot(e.rotational),u.vmult(t.rotational,m1),h+=m1.dot(t.rotational),h}addToWlambda(e){const t=this.jacobianElementA,i=this.jacobianElementB,r=this.bi,s=this.bj,o=WB;r.vlambda.addScaledVector(r.invMassSolve*e,t.spatial,r.vlambda),s.vlambda.addScaledVector(s.invMassSolve*e,i.spatial,s.vlambda),r.invInertiaWorldSolve.vmult(t.rotational,o),r.wlambda.addScaledVector(e,o,r.wlambda),s.invInertiaWorldSolve.vmult(i.rotational,o),s.wlambda.addScaledVector(e,o,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Zb.idCounter=0;const xI=new ne,EI=new ne,SI=new ne,CI=new ne,m1=new ne,WB=new ne;class g1 extends Zb{constructor(e,t,i){i===void 0&&(i=1e6),super(e,t,0,i),this.restitution=0,this.ri=new ne,this.rj=new ne,this.ni=new ne}computeB(e){const t=this.a,i=this.b,r=this.bi,s=this.bj,o=this.ri,l=this.rj,u=XB,h=qB,f=r.velocity,g=r.angularVelocity;r.force,r.torque;const _=s.velocity,A=s.angularVelocity;s.force,s.torque;const x=YB,E=this.jacobianElementA,T=this.jacobianElementB,R=this.ni;o.cross(R,u),l.cross(R,h),R.negate(E.spatial),u.negate(E.rotational),T.spatial.copy(R),T.rotational.copy(h),x.copy(s.position),x.vadd(l,x),x.vsub(r.position,x),x.vsub(o,x);const I=R.dot(x),S=this.restitution+1;return-I*t-(S*_.dot(R)-S*f.dot(R)+A.dot(h)-g.dot(u))*i-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=KB,t=ZB,i=JB,r=$B,s=e3;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(r,t),e.vsub(t,s),this.ni.dot(s)}}const XB=new ne,qB=new ne,YB=new ne,KB=new ne,ZB=new ne,JB=new ne,$B=new ne,e3=new ne;class t3 extends f1{constructor(e,t,i,r,s){t===void 0&&(t=new ne),r===void 0&&(r=new ne),s===void 0&&(s=1e6),super(e,i),this.pivotA=t.clone(),this.pivotB=r.clone();const o=this.equationX=new g1(e,i),l=this.equationY=new g1(e,i),u=this.equationZ=new g1(e,i);this.equations.push(o,l,u),o.minForce=l.minForce=u.minForce=-s,o.maxForce=l.maxForce=u.maxForce=s,o.ni.set(1,0,0),l.ni.set(0,1,0),u.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,i=this.equationX,r=this.equationY,s=this.equationZ;e.quaternion.vmult(this.pivotA,i.ri),t.quaternion.vmult(this.pivotB,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),s.ri.copy(i.ri),s.rj.copy(i.rj)}}new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne;class MI extends Zb{constructor(e,t,i){super(e,t,-i,i),this.ri=new ne,this.rj=new ne,this.t=new ne}computeB(e){this.a;const t=this.b;this.bi,this.bj;const i=this.ri,r=this.rj,s=i3,o=r3,l=this.t;i.cross(l,s),r.cross(l,o);const u=this.jacobianElementA,h=this.jacobianElementB;return l.negate(u.spatial),s.negate(u.rotational),h.spatial.copy(l),h.rotational.copy(o),-this.computeGW()*t-e*this.computeGiMf()}}const i3=new ne,r3=new ne;class v1{constructor(e,t,i){i=AI.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=v1.idCounter++,this.materials=[e,t],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}}v1.idCounter=0;class _1{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=_1.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}_1.idCounter=0,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ca,new ne,new ne,new ne,new ne(1,0,0),new ne(0,1,0),new ne(0,0,1),new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne;class TI extends Di{constructor(e){if(super({type:Di.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){t===void 0&&(t=new ne);const i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,i,r){const s=this.radius,o=["x","y","z"];for(let l=0;l<o.length;l++){const u=o[l];i[u]=e[u]-s,r[u]=e[u]+s}}}new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne;class n3 extends nv{constructor(e,t,i,r){if(e===void 0&&(e=1),t===void 0&&(t=1),i===void 0&&(i=1),r===void 0&&(r=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const s=r,o=[],l=[],u=[],h=[],f=[],g=Math.cos,_=Math.sin;o.push(new ne(-t*_(0),.5*-i,t*g(0))),h.push(0),o.push(new ne(-e*_(0),.5*i,e*g(0))),f.push(1);for(let x=0;x<s;x++){const E=2*Math.PI/s*(x+1),T=2*Math.PI/s*(x+.5);x<s-1?(o.push(new ne(-t*_(E),.5*-i,t*g(E))),h.push(2*x+2),o.push(new ne(-e*_(E),.5*i,e*g(E))),f.push(2*x+3),u.push([2*x,2*x+1,2*x+3,2*x+2])):u.push([2*x,2*x+1,1,0]),(s%2==1||x<s/2)&&l.push(new ne(-_(T),0,g(T)))}u.push(h),l.push(new ne(0,1,0));const A=[];for(let x=0;x<f.length;x++)A.push(f[f.length-x-1]);u.push(A),super({vertices:o,faces:u,axes:l}),this.type=Di.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=i,this.numSegments=r}}class s3 extends Di{constructor(){super({type:Di.types.PLANE}),this.worldNormal=new ne,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new ne),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,i,r){zp.set(0,0,1),t.vmult(zp,zp);const s=Number.MAX_VALUE;i.set(-s,-s,-s),r.set(s,s,s),zp.x===1?r.x=e.x:zp.x===-1&&(i.x=e.x),zp.y===1?r.y=e.y:zp.y===-1&&(i.y=e.y),zp.z===1?r.z=e.z:zp.z===-1&&(i.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const zp=new ne;new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne;class bd{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new ds,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,i){i===void 0&&(i=0);const r=this.data;if(!this.aabb.contains(e))return!1;const s=this.children;if(i<(this.maxDepth||this.root.maxDepth)){let o=!1;s.length||(this.subdivide(),o=!0);for(let l=0;l!==8;l++)if(s[l].insert(e,t,i+1))return!0;o&&(s.length=0)}return r.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,i=e.upperBound,r=this.children;r.push(new bd({aabb:new ds({lowerBound:new ne(0,0,0)})}),new bd({aabb:new ds({lowerBound:new ne(1,0,0)})}),new bd({aabb:new ds({lowerBound:new ne(1,1,0)})}),new bd({aabb:new ds({lowerBound:new ne(1,1,1)})}),new bd({aabb:new ds({lowerBound:new ne(0,1,1)})}),new bd({aabb:new ds({lowerBound:new ne(0,0,1)})}),new bd({aabb:new ds({lowerBound:new ne(1,0,1)})}),new bd({aabb:new ds({lowerBound:new ne(0,1,0)})})),i.vsub(t,av),av.scale(.5,av);const s=this.root||this;for(let o=0;o!==8;o++){const l=r[o];l.root=s;const u=l.aabb.lowerBound;u.x*=av.x,u.y*=av.y,u.z*=av.z,u.vadd(t,u),u.vadd(av,l.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const i=[this];for(;i.length;){const r=i.pop();r.aabb.overlaps(e)&&Array.prototype.push.apply(t,r.data),Array.prototype.push.apply(i,r.children)}return t}rayQuery(e,t,i){return e.getAABB(y1),y1.toLocalFrame(t,y1),this.aabbQuery(y1,i),i}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class a3 extends bd{constructor(e,t){t===void 0&&(t={}),super({root:null,aabb:e}),this.maxDepth=t.maxDepth!==void 0?t.maxDepth:8}}const av=new ne,y1=new ds;class b1 extends Di{constructor(e,t){super({type:Di.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new ds,this.edges=null,this.scale=new ne(1,1,1),this.tree=new a3,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const i=new ds,r=new ne,s=new ne,o=new ne,l=[r,s,o];for(let u=0;u<this.indices.length/3;u++){const h=3*u;this._getUnscaledVertex(this.indices[h],r),this._getUnscaledVertex(this.indices[h+1],s),this._getUnscaledVertex(this.indices[h+2],o),i.setFromPoints(l),e.insert(i,u)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){A1.copy(e);const i=this.scale,r=i.x,s=i.y,o=i.z,l=A1.lowerBound,u=A1.upperBound;return l.x/=r,l.y/=s,l.z/=o,u.x/=r,u.y/=s,u.z/=o,this.tree.aabbQuery(A1,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,i=e.x===e.y&&e.y===e.z;t&&i||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=o3,t=this.normals;for(let i=0;i<this.indices.length/3;i++){const r=3*i,s=this.indices[r],o=this.indices[r+1],l=this.indices[r+2];this.getVertex(s,RI),this.getVertex(o,DI),this.getVertex(l,BI),b1.computeNormal(DI,RI,BI,e),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z}}updateEdges(){const e={},t=(r,s)=>{e[r<s?`${r}_${s}`:`${s}_${r}`]=!0};for(let r=0;r<this.indices.length/3;r++){const s=3*r,o=this.indices[s],l=this.indices[s+1],u=this.indices[s+2];t(o,l),t(l,u),t(u,o)}const i=Object.keys(e);this.edges=new Int16Array(2*i.length);for(let r=0;r<i.length;r++){const s=i[r].split("_");this.edges[2*r]=parseInt(s[0],10),this.edges[2*r+1]=parseInt(s[1],10)}}getEdgeVertex(e,t,i){const r=this.edges[2*e+(t?1:0)];this.getVertex(r,i)}getEdgeVector(e,t){const i=l3,r=c3;this.getEdgeVertex(e,0,i),this.getEdgeVertex(e,1,r),r.vsub(i,t)}static computeNormal(e,t,i,r){t.vsub(e,PI),i.vsub(t,II),II.cross(PI,r),r.isZero()||r.normalize()}getVertex(e,t){const i=this.scale;return this._getUnscaledVertex(e,t),t.x*=i.x,t.y*=i.y,t.z*=i.z,t}_getUnscaledVertex(e,t){const i=3*e,r=this.vertices;return t.set(r[i],r[i+1],r[i+2])}getWorldVertex(e,t,i,r){return this.getVertex(e,r),rn.pointToWorldFrame(t,i,r,r),r}getTriangleVertices(e,t,i,r){const s=3*e;this.getVertex(this.indices[s],t),this.getVertex(this.indices[s+1],i),this.getVertex(this.indices[s+2],r)}getNormal(e,t){const i=3*e;return t.set(this.normals[i],this.normals[i+1],this.normals[i+2])}calculateLocalInertia(e,t){this.computeLocalAABB(ov);const i=ov.upperBound.x-ov.lowerBound.x,r=ov.upperBound.y-ov.lowerBound.y,s=ov.upperBound.z-ov.lowerBound.z;return t.set(1/12*e*(2*r*2*r+2*s*2*s),1/12*e*(2*i*2*i+2*s*2*s),1/12*e*(2*r*2*r+2*i*2*i))}computeLocalAABB(e){const t=e.lowerBound,i=e.upperBound,r=this.vertices.length;this.vertices;const s=u3;this.getVertex(0,s),t.copy(s),i.copy(s);for(let o=0;o!==r;o++)this.getVertex(o,s),s.x<t.x?t.x=s.x:s.x>i.x&&(i.x=s.x),s.y<t.y?t.y=s.y:s.y>i.y&&(i.y=s.y),s.z<t.z?t.z=s.z:s.z>i.z&&(i.z=s.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,i=new ne;for(let r=0,s=t.length/3;r!==s;r++){this.getVertex(r,i);const o=i.lengthSquared();o>e&&(e=o)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,r){const s=h3,o=d3;s.position=e,s.quaternion=t,this.aabb.toWorldFrame(s,o),i.copy(o.lowerBound),r.copy(o.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,i,r,s){e===void 0&&(e=1),t===void 0&&(t=.5),i===void 0&&(i=8),r===void 0&&(r=6),s===void 0&&(s=2*Math.PI);const o=[],l=[];for(let u=0;u<=i;u++)for(let h=0;h<=r;h++){const f=h/r*s,g=u/i*Math.PI*2,_=(e+t*Math.cos(g))*Math.cos(f),A=(e+t*Math.cos(g))*Math.sin(f),x=t*Math.sin(g);o.push(_,A,x)}for(let u=1;u<=i;u++)for(let h=1;h<=r;h++){const f=(r+1)*u+h-1,g=(r+1)*(u-1)+h-1,_=(r+1)*(u-1)+h,A=(r+1)*u+h;l.push(f,g,A),l.push(g,_,A)}return new b1(o,l)}}const o3=new ne,A1=new ds,l3=new ne,c3=new ne,II=new ne,PI=new ne,RI=new ne,DI=new ne,BI=new ne,ov=new ds,u3=new ne,h3=new rn,d3=new ds;class p3{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,i=t.indexOf(e);i!==-1&&t.splice(i,1)}removeAllEquations(){this.equations.length=0}}class f3 extends p3{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let i=0;const r=this.iterations,s=this.tolerance*this.tolerance,o=this.equations,l=o.length,u=t.bodies,h=u.length,f=e;let g,_,A,x,E,T;if(l!==0)for(let O=0;O!==h;O++)u[O].updateSolveMassProperties();const R=g3,I=v3,S=m3;R.length=l,I.length=l,S.length=l;for(let O=0;O!==l;O++){const k=o[O];S[O]=0,I[O]=k.computeB(f),R[O]=1/k.computeC()}if(l!==0){for(let N=0;N!==h;N++){const H=u[N],X=H.vlambda,te=H.wlambda;X.set(0,0,0),te.set(0,0,0)}for(i=0;i!==r;i++){x=0;for(let N=0;N!==l;N++){const H=o[N];g=I[N],_=R[N],T=S[N],E=H.computeGWlambda(),A=_*(g-E-H.eps*T),T+A<H.minForce?A=H.minForce-T:T+A>H.maxForce&&(A=H.maxForce-T),S[N]+=A,x+=A>0?A:-A,H.addToWlambda(A)}if(x*x<s)break}for(let N=0;N!==h;N++){const H=u[N],X=H.velocity,te=H.angularVelocity;H.vlambda.vmul(H.linearFactor,H.vlambda),X.vadd(H.vlambda,X),H.wlambda.vmul(H.angularFactor,H.wlambda),te.vadd(H.wlambda,te)}let O=o.length;const k=1/f;for(;O--;)o[O].multiplier=S[O]*k}return i}}const m3=[],g3=[],v3=[];ki.STATIC;class _3{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class y3 extends _3{constructor(){super(...arguments),this.type=ne}constructObject(){return new ne}}const b3=Di.types.SPHERE,A3=Di.types.SPHERE|Di.types.PLANE,w3=Di.types.BOX|Di.types.BOX,x3=Di.types.SPHERE|Di.types.BOX,E3=Di.types.PLANE|Di.types.BOX,S3=Di.types.CONVEXPOLYHEDRON,C3=Di.types.SPHERE|Di.types.CONVEXPOLYHEDRON,M3=Di.types.PLANE|Di.types.CONVEXPOLYHEDRON,T3=Di.types.BOX|Di.types.CONVEXPOLYHEDRON,I3=Di.types.SPHERE|Di.types.HEIGHTFIELD,P3=Di.types.BOX|Di.types.HEIGHTFIELD,R3=Di.types.CONVEXPOLYHEDRON|Di.types.HEIGHTFIELD,D3=Di.types.PARTICLE|Di.types.SPHERE,B3=Di.types.PLANE|Di.types.PARTICLE,O3=Di.types.BOX|Di.types.PARTICLE,L3=Di.types.PARTICLE|Di.types.CONVEXPOLYHEDRON,k3=Di.types.CYLINDER,U3=Di.types.SPHERE|Di.types.CYLINDER,N3=Di.types.PLANE|Di.types.CYLINDER,F3=Di.types.BOX|Di.types.CYLINDER,j3=Di.types.CONVEXPOLYHEDRON|Di.types.CYLINDER,z3=Di.types.HEIGHTFIELD|Di.types.CYLINDER,V3=Di.types.PARTICLE|Di.types.CYLINDER,G3=Di.types.SPHERE|Di.types.TRIMESH,H3=Di.types.PLANE|Di.types.TRIMESH;class Q3{get[b3](){return this.sphereSphere}get[A3](){return this.spherePlane}get[w3](){return this.boxBox}get[x3](){return this.sphereBox}get[E3](){return this.planeBox}get[S3](){return this.convexConvex}get[C3](){return this.sphereConvex}get[M3](){return this.planeConvex}get[T3](){return this.boxConvex}get[I3](){return this.sphereHeightfield}get[P3](){return this.boxHeightfield}get[R3](){return this.convexHeightfield}get[D3](){return this.sphereParticle}get[B3](){return this.planeParticle}get[O3](){return this.boxParticle}get[L3](){return this.convexParticle}get[k3](){return this.convexConvex}get[U3](){return this.sphereConvex}get[N3](){return this.planeConvex}get[F3](){return this.boxConvex}get[j3](){return this.convexConvex}get[z3](){return this.heightfieldCylinder}get[V3](){return this.particleCylinder}get[G3](){return this.sphereTrimesh}get[H3](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new y3,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,i,r,s,o){let l;this.contactPointPool.length?(l=this.contactPointPool.pop(),l.bi=e,l.bj=t):l=new g1(e,t),l.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&r.collisionResponse;const u=this.currentContactMaterial;l.restitution=u.restitution,l.setSpookParams(u.contactEquationStiffness,u.contactEquationRelaxation,this.world.dt);const h=i.material||e.material,f=r.material||t.material;return h&&f&&h.restitution>=0&&f.restitution>=0&&(l.restitution=h.restitution*f.restitution),l.si=s||i,l.sj=o||r,l}createFrictionEquationsFromContact(e,t){const i=e.bi,r=e.bj,s=e.si,o=e.sj,l=this.world,u=this.currentContactMaterial;let h=u.friction;const f=s.material||i.material,g=o.material||r.material;if(f&&g&&f.friction>=0&&g.friction>=0&&(h=f.friction*g.friction),h>0){const _=h*l.gravity.length();let A=i.invMass+r.invMass;A>0&&(A=1/A);const x=this.frictionEquationPool,E=x.length?x.pop():new MI(i,r,_*A),T=x.length?x.pop():new MI(i,r,_*A);return E.bi=T.bi=i,E.bj=T.bj=r,E.minForce=T.minForce=-_*A,E.maxForce=T.maxForce=_*A,E.ri.copy(e.ri),E.rj.copy(e.rj),T.ri.copy(e.ri),T.rj.copy(e.rj),e.ni.tangents(E.t,T.t),E.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,l.dt),T.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,l.dt),E.enabled=T.enabled=e.enabled,t.push(E,T),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const i=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];lv.setZero(),M_.setZero(),T_.setZero();const s=t.bi;t.bj;for(let l=0;l!==e;l++)t=this.result[this.result.length-1-l],t.bi!==s?(lv.vadd(t.ni,lv),M_.vadd(t.ri,M_),T_.vadd(t.rj,T_)):(lv.vsub(t.ni,lv),M_.vadd(t.rj,M_),T_.vadd(t.ri,T_));const o=1/e;M_.scale(o,i.ri),T_.scale(o,i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj),lv.normalize(),lv.tangents(i.t,r.t)}getContacts(e,t,i,r,s,o,l){this.contactPointPool=s,this.frictionEquationPool=l,this.result=r,this.frictionResult=o;const u=q3,h=Y3,f=W3,g=X3;for(let _=0,A=e.length;_!==A;_++){const x=e[_],E=t[_];let T=null;x.material&&E.material&&(T=i.getContactMaterial(x.material,E.material)||null);const R=x.type&ki.KINEMATIC&&E.type&ki.STATIC||x.type&ki.STATIC&&E.type&ki.KINEMATIC||x.type&ki.KINEMATIC&&E.type&ki.KINEMATIC;for(let I=0;I<x.shapes.length;I++){x.quaternion.mult(x.shapeOrientations[I],u),x.quaternion.vmult(x.shapeOffsets[I],f),f.vadd(x.position,f);const S=x.shapes[I];for(let O=0;O<E.shapes.length;O++){E.quaternion.mult(E.shapeOrientations[O],h),E.quaternion.vmult(E.shapeOffsets[O],g),g.vadd(E.position,g);const k=E.shapes[O];if(!(S.collisionFilterMask&k.collisionFilterGroup&&k.collisionFilterMask&S.collisionFilterGroup)||f.distanceTo(g)>S.boundingSphereRadius+k.boundingSphereRadius)continue;let N=null;S.material&&k.material&&(N=i.getContactMaterial(S.material,k.material)||null),this.currentContactMaterial=N||T||i.defaultContactMaterial;const H=this[S.type|k.type];if(H){let X=!1;X=S.type<k.type?H.call(this,S,k,f,g,u,h,x,E,S,k,R):H.call(this,k,S,g,f,h,u,E,x,S,k,R),X&&R&&(i.shapeOverlapKeeper.set(S.id,k.id),i.bodyOverlapKeeper.set(x.id,E.id))}}}}}sphereSphere(e,t,i,r,s,o,l,u,h,f,g){if(g)return i.distanceSquared(r)<(e.radius+t.radius)**2;const _=this.createContactEquation(l,u,e,t,h,f);r.vsub(i,_.ni),_.ni.normalize(),_.ri.copy(_.ni),_.rj.copy(_.ni),_.ri.scale(e.radius,_.ri),_.rj.scale(-t.radius,_.rj),_.ri.vadd(i,_.ri),_.ri.vsub(l.position,_.ri),_.rj.vadd(r,_.rj),_.rj.vsub(u.position,_.rj),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}spherePlane(e,t,i,r,s,o,l,u,h,f,g){const _=this.createContactEquation(l,u,e,t,h,f);if(_.ni.set(0,0,1),o.vmult(_.ni,_.ni),_.ni.negate(_.ni),_.ni.normalize(),_.ni.scale(e.radius,_.ri),i.vsub(r,w1),_.ni.scale(_.ni.dot(w1),OI),w1.vsub(OI,_.rj),-w1.dot(_.ni)<=e.radius){if(g)return!0;const A=_.ri,x=_.rj;A.vadd(i,A),A.vsub(l.position,A),x.vadd(r,x),x.vsub(u.position,x),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}boxBox(e,t,i,r,s,o,l,u,h,f,g){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,r,s,o,l,u,e,t,g)}sphereBox(e,t,i,r,s,o,l,u,h,f,g){const _=this.v3pool,A=AO;i.vsub(r,x1),t.getSideNormals(A,o);const x=e.radius;let E=!1;const T=xO,R=EO,I=SO;let S=null,O=0,k=0,N=0,H=null;for(let fe=0,Ee=A.length;fe!==Ee&&E===!1;fe++){const Je=_O;Je.copy(A[fe]);const Te=Je.length();Je.normalize();const qe=x1.dot(Je);if(qe<Te+x&&qe>0){const Ve=yO,Ye=bO;Ve.copy(A[(fe+1)%3]),Ye.copy(A[(fe+2)%3]);const Tt=Ve.length(),Xe=Ye.length();Ve.normalize(),Ye.normalize();const Zt=x1.dot(Ve),di=x1.dot(Ye);if(Zt<Tt&&Zt>-Tt&&di<Xe&&di>-Xe){const Ai=Math.abs(qe-Te-x);if((H===null||Ai<H)&&(H=Ai,k=Zt,N=di,S=Te,T.copy(Je),R.copy(Ve),I.copy(Ye),O++,g))return!0}}}if(O){E=!0;const fe=this.createContactEquation(l,u,e,t,h,f);T.scale(-x,fe.ri),fe.ni.copy(T),fe.ni.negate(fe.ni),T.scale(S,T),R.scale(k,R),T.vadd(R,T),I.scale(N,I),T.vadd(I,fe.rj),fe.ri.vadd(i,fe.ri),fe.ri.vsub(l.position,fe.ri),fe.rj.vadd(r,fe.rj),fe.rj.vsub(u.position,fe.rj),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult)}let X=_.get();const te=wO;for(let fe=0;fe!==2&&!E;fe++)for(let Ee=0;Ee!==2&&!E;Ee++)for(let Je=0;Je!==2&&!E;Je++)if(X.set(0,0,0),fe?X.vadd(A[0],X):X.vsub(A[0],X),Ee?X.vadd(A[1],X):X.vsub(A[1],X),Je?X.vadd(A[2],X):X.vsub(A[2],X),r.vadd(X,te),te.vsub(i,te),te.lengthSquared()<x*x){if(g)return!0;E=!0;const Te=this.createContactEquation(l,u,e,t,h,f);Te.ri.copy(te),Te.ri.normalize(),Te.ni.copy(Te.ri),Te.ri.scale(x,Te.ri),Te.rj.copy(X),Te.ri.vadd(i,Te.ri),Te.ri.vsub(l.position,Te.ri),Te.rj.vadd(r,Te.rj),Te.rj.vsub(u.position,Te.rj),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}_.release(X),X=null;const re=_.get(),ue=_.get(),le=_.get(),se=_.get(),de=_.get(),ve=A.length;for(let fe=0;fe!==ve&&!E;fe++)for(let Ee=0;Ee!==ve&&!E;Ee++)if(fe%3!=Ee%3){A[Ee].cross(A[fe],re),re.normalize(),A[fe].vadd(A[Ee],ue),le.copy(i),le.vsub(ue,le),le.vsub(r,le);const Je=le.dot(re);re.scale(Je,se);let Te=0;for(;Te===fe%3||Te===Ee%3;)Te++;de.copy(i),de.vsub(se,de),de.vsub(ue,de),de.vsub(r,de);const qe=Math.abs(Je),Ve=de.length();if(qe<A[Te].length()&&Ve<x){if(g)return!0;E=!0;const Ye=this.createContactEquation(l,u,e,t,h,f);ue.vadd(se,Ye.rj),Ye.rj.copy(Ye.rj),de.negate(Ye.ni),Ye.ni.normalize(),Ye.ri.copy(Ye.rj),Ye.ri.vadd(r,Ye.ri),Ye.ri.vsub(i,Ye.ri),Ye.ri.normalize(),Ye.ri.scale(x,Ye.ri),Ye.ri.vadd(i,Ye.ri),Ye.ri.vsub(l.position,Ye.ri),Ye.rj.vadd(r,Ye.rj),Ye.rj.vsub(u.position,Ye.rj),this.result.push(Ye),this.createFrictionEquationsFromContact(Ye,this.frictionResult)}}_.release(re,ue,le,se,de)}planeBox(e,t,i,r,s,o,l,u,h,f,g){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,r,s,o,l,u,e,t,g)}convexConvex(e,t,i,r,s,o,l,u,h,f,g,_,A){const x=jO;if(!(i.distanceTo(r)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,s,r,o,x,_,A)){const E=[],T=zO;e.clipAgainstHull(i,s,t,r,o,x,-100,100,E);let R=0;for(let I=0;I!==E.length;I++){if(g)return!0;const S=this.createContactEquation(l,u,e,t,h,f),O=S.ri,k=S.rj;x.negate(S.ni),E[I].normal.negate(T),T.scale(E[I].depth,T),E[I].point.vadd(T,O),k.copy(E[I].point),O.vsub(i,O),k.vsub(r,k),O.vadd(i,O),O.vsub(l.position,O),k.vadd(r,k),k.vsub(u.position,k),this.result.push(S),R++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(S,this.frictionResult)}this.enableFrictionReduction&&R&&this.createFrictionFromAverage(R)}}sphereConvex(e,t,i,r,s,o,l,u,h,f,g){const _=this.v3pool;i.vsub(r,CO);const A=t.faceNormals,x=t.faces,E=t.vertices,T=e.radius;let R=!1;for(let I=0;I!==E.length;I++){const S=E[I],O=PO;o.vmult(S,O),r.vadd(O,O);const k=IO;if(O.vsub(i,k),k.lengthSquared()<T*T){if(g)return!0;R=!0;const N=this.createContactEquation(l,u,e,t,h,f);return N.ri.copy(k),N.ri.normalize(),N.ni.copy(N.ri),N.ri.scale(T,N.ri),O.vsub(r,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(l.position,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(u.position,N.rj),this.result.push(N),void this.createFrictionEquationsFromContact(N,this.frictionResult)}}for(let I=0,S=x.length;I!==S&&R===!1;I++){const O=A[I],k=x[I],N=RO;o.vmult(O,N);const H=DO;o.vmult(E[k[0]],H),H.vadd(r,H);const X=BO;N.scale(-T,X),i.vadd(X,X);const te=OO;X.vsub(H,te);const re=te.dot(N),ue=LO;if(i.vsub(H,ue),re<0&&ue.dot(N)>0){const le=[];for(let se=0,de=k.length;se!==de;se++){const ve=_.get();o.vmult(E[k[se]],ve),r.vadd(ve,ve),le.push(ve)}if(vO(le,N,i)){if(g)return!0;R=!0;const se=this.createContactEquation(l,u,e,t,h,f);N.scale(-T,se.ri),N.negate(se.ni);const de=_.get();N.scale(-re,de);const ve=_.get();N.scale(-T,ve),i.vsub(r,se.rj),se.rj.vadd(ve,se.rj),se.rj.vadd(de,se.rj),se.rj.vadd(r,se.rj),se.rj.vsub(u.position,se.rj),se.ri.vadd(i,se.ri),se.ri.vsub(l.position,se.ri),_.release(de),_.release(ve),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult);for(let fe=0,Ee=le.length;fe!==Ee;fe++)_.release(le[fe]);return}for(let se=0;se!==k.length;se++){const de=_.get(),ve=_.get();o.vmult(E[k[(se+1)%k.length]],de),o.vmult(E[k[(se+2)%k.length]],ve),r.vadd(de,de),r.vadd(ve,ve);const fe=MO;ve.vsub(de,fe);const Ee=TO;fe.unit(Ee);const Je=_.get(),Te=_.get();i.vsub(de,Te);const qe=Te.dot(Ee);Ee.scale(qe,Je),Je.vadd(de,Je);const Ve=_.get();if(Je.vsub(i,Ve),qe>0&&qe*qe<fe.lengthSquared()&&Ve.lengthSquared()<T*T){if(g)return!0;const Ye=this.createContactEquation(l,u,e,t,h,f);Je.vsub(r,Ye.rj),Je.vsub(i,Ye.ni),Ye.ni.normalize(),Ye.ni.scale(T,Ye.ri),Ye.rj.vadd(r,Ye.rj),Ye.rj.vsub(u.position,Ye.rj),Ye.ri.vadd(i,Ye.ri),Ye.ri.vsub(l.position,Ye.ri),this.result.push(Ye),this.createFrictionEquationsFromContact(Ye,this.frictionResult);for(let Tt=0,Xe=le.length;Tt!==Xe;Tt++)_.release(le[Tt]);return _.release(de),_.release(ve),_.release(Je),_.release(Ve),void _.release(Te)}_.release(de),_.release(ve),_.release(Je),_.release(Ve),_.release(Te)}for(let se=0,de=le.length;se!==de;se++)_.release(le[se])}}}planeConvex(e,t,i,r,s,o,l,u,h,f,g){const _=kO,A=UO;A.set(0,0,1),s.vmult(A,A);let x=0;const E=NO;for(let T=0;T!==t.vertices.length;T++)if(_.copy(t.vertices[T]),o.vmult(_,_),r.vadd(_,_),_.vsub(i,E),A.dot(E)<=0){if(g)return!0;const R=this.createContactEquation(l,u,e,t,h,f),I=FO;A.scale(A.dot(E),I),_.vsub(I,I),I.vsub(i,R.ri),R.ni.copy(A),_.vsub(r,R.rj),R.ri.vadd(i,R.ri),R.ri.vsub(l.position,R.ri),R.rj.vadd(r,R.rj),R.rj.vsub(u.position,R.rj),this.result.push(R),x++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(R,this.frictionResult)}this.enableFrictionReduction&&x&&this.createFrictionFromAverage(x)}boxConvex(e,t,i,r,s,o,l,u,h,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,r,s,o,l,u,e,t,g)}sphereHeightfield(e,t,i,r,s,o,l,u,h,f,g){const _=t.data,A=e.radius,x=t.elementSize,E=$O,T=JO;rn.pointToLocalFrame(r,o,i,T);let R=Math.floor((T.x-A)/x)-1,I=Math.ceil((T.x+A)/x)+1,S=Math.floor((T.y-A)/x)-1,O=Math.ceil((T.y+A)/x)+1;if(I<0||O<0||R>_.length||S>_[0].length)return;R<0&&(R=0),I<0&&(I=0),S<0&&(S=0),O<0&&(O=0),R>=_.length&&(R=_.length-1),I>=_.length&&(I=_.length-1),O>=_[0].length&&(O=_[0].length-1),S>=_[0].length&&(S=_[0].length-1);const k=[];t.getRectMinMax(R,S,I,O,k);const N=k[0],H=k[1];if(T.z-A>H||T.z+A<N)return;const X=this.result;for(let te=R;te<I;te++)for(let re=S;re<O;re++){const ue=X.length;let le=!1;if(t.getConvexTrianglePillar(te,re,!1),rn.pointToWorldFrame(r,o,t.pillarOffset,E),i.distanceTo(E)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(le=this.sphereConvex(e,t.pillarConvex,i,E,s,o,l,u,e,t,g)),g&&le||(t.getConvexTrianglePillar(te,re,!0),rn.pointToWorldFrame(r,o,t.pillarOffset,E),i.distanceTo(E)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(le=this.sphereConvex(e,t.pillarConvex,i,E,s,o,l,u,e,t,g)),g&&le))return!0;if(X.length-ue>2)return}}boxHeightfield(e,t,i,r,s,o,l,u,h,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,r,s,o,l,u,e,t,g)}convexHeightfield(e,t,i,r,s,o,l,u,h,f,g){const _=t.data,A=t.elementSize,x=e.boundingSphereRadius,E=KO,T=ZO,R=YO;rn.pointToLocalFrame(r,o,i,R);let I=Math.floor((R.x-x)/A)-1,S=Math.ceil((R.x+x)/A)+1,O=Math.floor((R.y-x)/A)-1,k=Math.ceil((R.y+x)/A)+1;if(S<0||k<0||I>_.length||O>_[0].length)return;I<0&&(I=0),S<0&&(S=0),O<0&&(O=0),k<0&&(k=0),I>=_.length&&(I=_.length-1),S>=_.length&&(S=_.length-1),k>=_[0].length&&(k=_[0].length-1),O>=_[0].length&&(O=_[0].length-1);const N=[];t.getRectMinMax(I,O,S,k,N);const H=N[0],X=N[1];if(!(R.z-x>X||R.z+x<H))for(let te=I;te<S;te++)for(let re=O;re<k;re++){let ue=!1;if(t.getConvexTrianglePillar(te,re,!1),rn.pointToWorldFrame(r,o,t.pillarOffset,E),i.distanceTo(E)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ue=this.convexConvex(e,t.pillarConvex,i,E,s,o,l,u,null,null,g,T,null)),g&&ue||(t.getConvexTrianglePillar(te,re,!0),rn.pointToWorldFrame(r,o,t.pillarOffset,E),i.distanceTo(E)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ue=this.convexConvex(e,t.pillarConvex,i,E,s,o,l,u,null,null,g,T,null)),g&&ue))return!0}}sphereParticle(e,t,i,r,s,o,l,u,h,f,g){const _=QO;if(_.set(0,0,1),r.vsub(i,_),_.lengthSquared()<=e.radius*e.radius){if(g)return!0;const A=this.createContactEquation(u,l,t,e,h,f);_.normalize(),A.rj.copy(_),A.rj.scale(e.radius,A.rj),A.ni.copy(_),A.ni.negate(A.ni),A.ri.set(0,0,0),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}}planeParticle(e,t,i,r,s,o,l,u,h,f,g){const _=VO;_.set(0,0,1),l.quaternion.vmult(_,_);const A=GO;if(r.vsub(l.position,A),_.dot(A)<=0){if(g)return!0;const x=this.createContactEquation(u,l,t,e,h,f);x.ni.copy(_),x.ni.negate(x.ni),x.ri.set(0,0,0);const E=HO;_.scale(_.dot(r),E),r.vsub(E,E),x.rj.copy(E),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}}boxParticle(e,t,i,r,s,o,l,u,h,f,g){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,r,s,o,l,u,e,t,g)}convexParticle(e,t,i,r,s,o,l,u,h,f,g){let _=-1;const A=XO,x=qO;let E=null;const T=WO;if(T.copy(r),T.vsub(i,T),s.conjugate(LI),LI.vmult(T,T),e.pointIsInside(T)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,s),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(s);for(let R=0,I=e.faces.length;R!==I;R++){const S=[e.worldVertices[e.faces[R][0]]],O=e.worldFaceNormals[R];r.vsub(S[0],kI);const k=-O.dot(kI);if(E===null||Math.abs(k)<Math.abs(E)){if(g)return!0;E=k,_=R,A.copy(O)}}if(_!==-1){const R=this.createContactEquation(u,l,t,e,h,f);A.scale(E,x),x.vadd(r,x),x.vsub(i,x),R.rj.copy(x),A.negate(R.ni),R.ri.set(0,0,0);const I=R.ri,S=R.rj;I.vadd(r,I),I.vsub(u.position,I),S.vadd(i,S),S.vsub(l.position,S),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,i,r,s,o,l,u,h,f,g){return this.convexHeightfield(t,e,r,i,o,s,u,l,h,f,g)}particleCylinder(e,t,i,r,s,o,l,u,h,f,g){return this.convexParticle(t,e,r,i,o,s,u,l,h,f,g)}sphereTrimesh(e,t,i,r,s,o,l,u,h,f,g){const _=rO,A=nO,x=sO,E=aO,T=oO,R=lO,I=dO,S=iO,O=eO,k=pO;rn.pointToLocalFrame(r,o,i,T);const N=e.radius;I.lowerBound.set(T.x-N,T.y-N,T.z-N),I.upperBound.set(T.x+N,T.y+N,T.z+N),t.getTrianglesInAABB(I,k);const H=tO,X=e.radius*e.radius;for(let se=0;se<k.length;se++)for(let de=0;de<3;de++)if(t.getVertex(t.indices[3*k[se]+de],H),H.vsub(T,O),O.lengthSquared()<=X){if(S.copy(H),rn.pointToWorldFrame(r,o,S,H),H.vsub(i,O),g)return!0;let ve=this.createContactEquation(l,u,e,t,h,f);ve.ni.copy(O),ve.ni.normalize(),ve.ri.copy(ve.ni),ve.ri.scale(e.radius,ve.ri),ve.ri.vadd(i,ve.ri),ve.ri.vsub(l.position,ve.ri),ve.rj.copy(H),ve.rj.vsub(u.position,ve.rj),this.result.push(ve),this.createFrictionEquationsFromContact(ve,this.frictionResult)}for(let se=0;se<k.length;se++)for(let de=0;de<3;de++){t.getVertex(t.indices[3*k[se]+de],_),t.getVertex(t.indices[3*k[se]+(de+1)%3],A),A.vsub(_,x),T.vsub(A,R);const ve=R.dot(x);T.vsub(_,R);let fe=R.dot(x);if(fe>0&&ve<0&&(T.vsub(_,R),E.copy(x),E.normalize(),fe=R.dot(E),E.scale(fe,R),R.vadd(_,R),R.distanceTo(T)<e.radius)){if(g)return!0;const Ee=this.createContactEquation(l,u,e,t,h,f);R.vsub(T,Ee.ni),Ee.ni.normalize(),Ee.ni.scale(e.radius,Ee.ri),Ee.ri.vadd(i,Ee.ri),Ee.ri.vsub(l.position,Ee.ri),rn.pointToWorldFrame(r,o,R,R),R.vsub(u.position,Ee.rj),rn.vectorToWorldFrame(o,Ee.ni,Ee.ni),rn.vectorToWorldFrame(o,Ee.ri,Ee.ri),this.result.push(Ee),this.createFrictionEquationsFromContact(Ee,this.frictionResult)}}const te=cO,re=uO,ue=hO,le=$3;for(let se=0,de=k.length;se!==de;se++){t.getTriangleVertices(k[se],te,re,ue),t.getNormal(k[se],le),T.vsub(te,R);let ve=R.dot(le);if(le.scale(ve,R),T.vsub(R,R),ve=R.distanceTo(T),ca.pointInTriangle(R,te,re,ue)&&ve<e.radius){if(g)return!0;let fe=this.createContactEquation(l,u,e,t,h,f);R.vsub(T,fe.ni),fe.ni.normalize(),fe.ni.scale(e.radius,fe.ri),fe.ri.vadd(i,fe.ri),fe.ri.vsub(l.position,fe.ri),rn.pointToWorldFrame(r,o,R,R),R.vsub(u.position,fe.rj),rn.vectorToWorldFrame(o,fe.ni,fe.ni),rn.vectorToWorldFrame(o,fe.ri,fe.ri),this.result.push(fe),this.createFrictionEquationsFromContact(fe,this.frictionResult)}}k.length=0}planeTrimesh(e,t,i,r,s,o,l,u,h,f,g){const _=new ne,A=K3;A.set(0,0,1),s.vmult(A,A);for(let x=0;x<t.vertices.length/3;x++){t.getVertex(x,_);const E=new ne;E.copy(_),rn.pointToWorldFrame(r,o,E,_);const T=Z3;if(_.vsub(i,T),A.dot(T)<=0){if(g)return!0;const R=this.createContactEquation(l,u,e,t,h,f);R.ni.copy(A);const I=J3;A.scale(T.dot(A),I),_.vsub(I,I),R.ri.copy(I),R.ri.vsub(l.position,R.ri),R.rj.copy(_),R.rj.vsub(u.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}}}}const lv=new ne,M_=new ne,T_=new ne,W3=new ne,X3=new ne,q3=new Ss,Y3=new Ss,K3=new ne,Z3=new ne,J3=new ne,$3=new ne,eO=new ne;new ne;const tO=new ne,iO=new ne,rO=new ne,nO=new ne,sO=new ne,aO=new ne,oO=new ne,lO=new ne,cO=new ne,uO=new ne,hO=new ne,dO=new ds,pO=[],w1=new ne,OI=new ne,fO=new ne,mO=new ne,gO=new ne;function vO(a,e,t){let i=null;const r=a.length;for(let s=0;s!==r;s++){const o=a[s],l=fO;a[(s+1)%r].vsub(o,l);const u=mO;l.cross(e,u);const h=gO;t.vsub(o,h);const f=u.dot(h);if(!(i===null||f>0&&i===!0||f<=0&&i===!1))return!1;i===null&&(i=f>0)}return!0}const x1=new ne,_O=new ne,yO=new ne,bO=new ne,AO=[new ne,new ne,new ne,new ne,new ne,new ne],wO=new ne,xO=new ne,EO=new ne,SO=new ne,CO=new ne,MO=new ne,TO=new ne,IO=new ne,PO=new ne,RO=new ne,DO=new ne,BO=new ne,OO=new ne,LO=new ne;new ne,new ne;const kO=new ne,UO=new ne,NO=new ne,FO=new ne,jO=new ne,zO=new ne,VO=new ne,GO=new ne,HO=new ne,QO=new ne,LI=new Ss,WO=new ne;new ne;const XO=new ne,kI=new ne,qO=new ne,YO=new ne,KO=new ne,ZO=[0],JO=new ne,$O=new ne;class UI{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const i=t;t=e,e=i}return e<<16|t}set(e,t){const i=this.getKey(e,t),r=this.current;let s=0;for(;i>r[s];)s++;if(i!==r[s]){for(let o=r.length-1;o>=s;o--)r[o+1]=r[o];r[s]=i}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const i=this.current,r=this.previous,s=i.length,o=r.length;let l=0;for(let u=0;u<s;u++){let h=!1;const f=i[u];for(;f>r[l];)l++;h=f===r[l],h||NI(e,f)}l=0;for(let u=0;u<o;u++){let h=!1;const f=r[u];for(;f>i[l];)l++;h=i[l]===f,h||NI(t,f)}}}function NI(a,e){a.push((4294901760&e)>>16,65535&e)}const BC=(a,e)=>a<e?`${a}-${e}`:`${e}-${a}`;class eL{constructor(){this.data={keys:[]}}get(e,t){const i=BC(e,t);return this.data[i]}set(e,t,i){const r=BC(e,t);this.get(e,t)||this.data.keys.push(r),this.data[r]=i}delete(e,t){const i=BC(e,t),r=this.data.keys.indexOf(i);r!==-1&&this.data.keys.splice(r,1),delete this.data[i]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class tL extends cI{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new ne,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new PB,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new f3,this.constraints=[],this.narrowphase=new Q3(this),this.collisionMatrix=new lI,this.collisionMatrixPrevious=new lI,this.bodyOverlapKeeper=new UI,this.shapeOverlapKeeper=new UI,this.contactmaterials=[],this.contactMaterialTable=new eL,this.defaultMaterial=new _1("default"),this.defaultContactMaterial=new v1(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,i){i instanceof h1?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}raycastAll(e,t,i,r){return i===void 0&&(i={}),i.mode=ca.ALL,i.from=e,i.to=t,i.callback=r,OC.intersectWorld(this,i)}raycastAny(e,t,i,r){return i===void 0&&(i={}),i.mode=ca.ANY,i.from=e,i.to=t,i.result=r,OC.intersectWorld(this,i)}raycastClosest(e,t,i,r){return i===void 0&&(i={}),i.mode=ca.CLOSEST,i.from=e,i.to=t,i.result=r,OC.intersectWorld(this,i)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof ki&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,i=this.bodies,r=i.indexOf(e);if(r!==-1){i.splice(r,1);for(let s=0;s!==i.length;s++)i[s].index=s;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let i=0;i<t.length;i++){const r=t[i].shapes;for(let s=0;s<r.length;s++){const o=r[s];if(o.id===e)return o}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const i=Sa.now()/1e3;if(this.lastCallTime){const r=i-this.lastCallTime;this.step(e,r,t)}else this.step(e,void 0,t);this.lastCallTime=i}step(e,t,i){if(i===void 0&&(i=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const r=Sa.now();let s=0;for(;this.accumulator>=e&&s<i&&(this.internalStep(e),this.accumulator-=e,s++,!(Sa.now()-r>1e3*e)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let l=0;l!==this.bodies.length;l++){const u=this.bodies[l];u.previousPosition.lerp(u.position,o,u.interpolatedPosition),u.previousQuaternion.slerp(u.quaternion,o,u.interpolatedQuaternion),u.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,i=aL,r=oL,s=this.bodies.length,o=this.bodies,l=this.solver,u=this.gravity,h=this.doProfiling,f=this.profile,g=ki.DYNAMIC;let _=-1/0;const A=this.constraints,x=sL;u.length();const E=u.x,T=u.y,R=u.z;let I=0;for(h&&(_=Sa.now()),I=0;I!==s;I++){const le=o[I];if(le.type===g){const se=le.force,de=le.mass;se.x+=de*E,se.y+=de*T,se.z+=de*R}}for(let le=0,se=this.subsystems.length;le!==se;le++)this.subsystems[le].update();h&&(_=Sa.now()),i.length=0,r.length=0,this.broadphase.collisionPairs(this,i,r),h&&(f.broadphase=Sa.now()-_);let S=A.length;for(I=0;I!==S;I++){const le=A[I];if(!le.collideConnected)for(let se=i.length-1;se>=0;se-=1)(le.bodyA===i[se]&&le.bodyB===r[se]||le.bodyB===i[se]&&le.bodyA===r[se])&&(i.splice(se,1),r.splice(se,1))}this.collisionMatrixTick(),h&&(_=Sa.now());const O=nL,k=t.length;for(I=0;I!==k;I++)O.push(t[I]);t.length=0;const N=this.frictionEquations.length;for(I=0;I!==N;I++)x.push(this.frictionEquations[I]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,r,this,t,O,this.frictionEquations,x),h&&(f.narrowphase=Sa.now()-_),h&&(_=Sa.now()),I=0;I<this.frictionEquations.length;I++)l.addEquation(this.frictionEquations[I]);const H=t.length;for(let le=0;le!==H;le++){const se=t[le],de=se.bi,ve=se.bj,fe=se.si,Ee=se.sj;let Je;Je=de.material&&ve.material&&this.getContactMaterial(de.material,ve.material)||this.defaultContactMaterial,Je.friction,de.material&&ve.material&&(de.material.friction>=0&&ve.material.friction>=0&&(de.material.friction,ve.material.friction),de.material.restitution>=0&&ve.material.restitution>=0&&(se.restitution=de.material.restitution*ve.material.restitution)),l.addEquation(se),de.allowSleep&&de.type===ki.DYNAMIC&&de.sleepState===ki.SLEEPING&&ve.sleepState===ki.AWAKE&&ve.type!==ki.STATIC&&ve.velocity.lengthSquared()+ve.angularVelocity.lengthSquared()>=2*ve.sleepSpeedLimit**2&&(de.wakeUpAfterNarrowphase=!0),ve.allowSleep&&ve.type===ki.DYNAMIC&&ve.sleepState===ki.SLEEPING&&de.sleepState===ki.AWAKE&&de.type!==ki.STATIC&&de.velocity.lengthSquared()+de.angularVelocity.lengthSquared()>=2*de.sleepSpeedLimit**2&&(ve.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(de,ve,!0),this.collisionMatrixPrevious.get(de,ve)||(Jb.body=ve,Jb.contact=se,de.dispatchEvent(Jb),Jb.body=de,ve.dispatchEvent(Jb)),this.bodyOverlapKeeper.set(de.id,ve.id),this.shapeOverlapKeeper.set(fe.id,Ee.id)}for(this.emitContactEvents(),h&&(f.makeContactConstraints=Sa.now()-_,_=Sa.now()),I=0;I!==s;I++){const le=o[I];le.wakeUpAfterNarrowphase&&(le.wakeUp(),le.wakeUpAfterNarrowphase=!1)}for(S=A.length,I=0;I!==S;I++){const le=A[I];le.update();for(let se=0,de=le.equations.length;se!==de;se++){const ve=le.equations[se];l.addEquation(ve)}}l.solve(e,this),h&&(f.solve=Sa.now()-_),l.removeAllEquations();const X=Math.pow;for(I=0;I!==s;I++){const le=o[I];if(le.type&g){const se=X(1-le.linearDamping,e),de=le.velocity;de.scale(se,de);const ve=le.angularVelocity;if(ve){const fe=X(1-le.angularDamping,e);ve.scale(fe,ve)}}}this.dispatchEvent(rL),h&&(_=Sa.now());const te=this.stepnumber%(this.quatNormalizeSkip+1)==0,re=this.quatNormalizeFast;for(I=0;I!==s;I++)o[I].integrate(e,te,re);this.clearForces(),this.broadphase.dirty=!0,h&&(f.integrate=Sa.now()-_),this.stepnumber+=1,this.dispatchEvent(iL);let ue=!0;if(this.allowSleep)for(ue=!1,I=0;I!==s;I++){const le=o[I];le.sleepTick(this.time),le.sleepState!==ki.SLEEPING&&(ue=!0)}this.hasActiveBodies=ue}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Vp,Gp),e){for(let s=0,o=Vp.length;s<o;s+=2)$b.bodyA=this.getBodyById(Vp[s]),$b.bodyB=this.getBodyById(Vp[s+1]),this.dispatchEvent($b);$b.bodyA=$b.bodyB=null}if(t){for(let s=0,o=Gp.length;s<o;s+=2)eA.bodyA=this.getBodyById(Gp[s]),eA.bodyB=this.getBodyById(Gp[s+1]),this.dispatchEvent(eA);eA.bodyA=eA.bodyB=null}Vp.length=Gp.length=0;const i=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((i||r)&&this.shapeOverlapKeeper.getDiff(Vp,Gp),i){for(let s=0,o=Vp.length;s<o;s+=2){const l=this.getShapeById(Vp[s]),u=this.getShapeById(Vp[s+1]);Hp.shapeA=l,Hp.shapeB=u,l&&(Hp.bodyA=l.body),u&&(Hp.bodyB=u.body),this.dispatchEvent(Hp)}Hp.bodyA=Hp.bodyB=Hp.shapeA=Hp.shapeB=null}if(r){for(let s=0,o=Gp.length;s<o;s+=2){const l=this.getShapeById(Gp[s]),u=this.getShapeById(Gp[s+1]);Qp.shapeA=l,Qp.shapeB=u,l&&(Qp.bodyA=l.body),u&&(Qp.bodyB=u.body),this.dispatchEvent(Qp)}Qp.bodyA=Qp.bodyB=Qp.shapeA=Qp.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let i=0;i!==t;i++){const r=e[i];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}}}new ds;const OC=new ca,Sa=globalThis.performance||{};if(!Sa.now){let a=Date.now();Sa.timing&&Sa.timing.navigationStart&&(a=Sa.timing.navigationStart),Sa.now=()=>Date.now()-a}new ne;const iL={type:"postStep"},rL={type:"preStep"},Jb={type:ki.COLLIDE_EVENT_NAME,body:null,contact:null},nL=[],sL=[],aL=[],oL=[],Vp=[],Gp=[],$b={type:"beginContact",bodyA:null,bodyB:null},eA={type:"endContact",bodyA:null,bodyB:null},Hp={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Qp={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var lL=function(){var a,e,t,i,r=0,s=new p.Pa4;function o(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new f,this.unassigned=new f,this.vertices=[]}function l(){this.normal=new p.Pa4,this.midpoint=new p.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=r,this.edge=null}function u(g,_){this.vertex=g,this.prev=null,this.next=null,this.twin=null,this.face=_}function h(g,_){this.point=g,this.index=_,this.prev=null,this.next=null,this.face=null}function f(){this.head=null,this.tail=null}return Object.assign(o.prototype,{toJSON:function(){const g=this.faces.map(T=>T.toArray()),_=Array.from(new Set(g.flat())).sort(),A=[];for(let T=0;T<_.length;T++)A.push(this.vertices[_[T]].point.x,this.vertices[_[T]].point.y,this.vertices[_[T]].point.z);const x=new Map;for(let T=0;T<_.length;T++)x.set(_[T],T);const E=[];for(let T=0;T<g.length;T++)E.push([x.get(g[T][0]),x.get(g[T][1]),x.get(g[T][2])]);return[A,E]},setFromPoints:function(g){Array.isArray(g)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),g.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var _=0,A=g.length;_<A;_++)this.vertices.push(new h(g[_],_));return this.compute(),this},setFromObject:function(g){var _=[];return g.updateMatrixWorld(!0),g.traverse(function(A){var x,E,T,R=A.geometry;if(R!==void 0&&(R.isGeometry&&(R=R.toBufferGeometry?R.toBufferGeometry():new BufferGeometry().fromGeometry(R)),R.isBufferGeometry)){var I=R.attributes.position;if(I!==void 0)for(x=0,E=I.count;x<E;x++)(T=new p.Pa4).fromBufferAttribute(I,x).applyMatrix4(A.matrixWorld),_.push(T)}}),this.setFromPoints(_)},containsPoint:function(g){for(var _=this.faces,A=0,x=_.length;A<x;A++)if(_[A].distanceToPoint(g)>this.tolerance)return!1;return!0},intersectRay:function(g,_){for(var A=this.faces,x=-1/0,E=1/0,T=0,R=A.length;T<R;T++){var I=A[T],S=I.distanceToPoint(g.origin),O=I.normal.dot(g.direction);if(S>0&&O>=0)return null;var k=O!==0?-S/O:0;if(!(k<=0)&&(O>0?E=Math.min(k,E):x=Math.max(k,x),x>E))return null}return x!==-1/0?g.at(x,_):g.at(E,_),_},intersectsRay:function(g){return this.intersectRay(g,s)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(g,_){return g.face=_,_.outside===null?this.assigned.append(g):this.assigned.insertBefore(_.outside,g),_.outside=g,this},removeVertexFromFace:function(g,_){return g===_.outside&&(g.next!==null&&g.next.face===_?_.outside=g.next:_.outside=null),this.assigned.remove(g),this},removeAllVerticesFromFace:function(g){if(g.outside!==null){for(var _=g.outside,A=g.outside;A.next!==null&&A.next.face===g;)A=A.next;return this.assigned.removeSubList(_,A),_.prev=A.next=null,g.outside=null,_}},deleteFaceVertices:function(g,_){var A=this.removeAllVerticesFromFace(g);if(A!==void 0)if(_===void 0)this.unassigned.appendChain(A);else{var x=A;do{var E=x.next;_.distanceToPoint(x.point)>this.tolerance?this.addVertexToFace(x,_):this.unassigned.append(x),x=E}while(x!==null)}return this},resolveUnassignedPoints:function(g){if(this.unassigned.isEmpty()===!1){var _=this.unassigned.first();do{for(var A=_.next,x=this.tolerance,E=null,T=0;T<g.length;T++){var R=g[T];if(R.mark===r){var I=R.distanceToPoint(_.point);if(I>x&&(x=I,E=R),x>1e3*this.tolerance)break}}E!==null&&this.addVertexToFace(_,E),_=A}while(_!==null)}return this},computeExtremes:function(){var g,_,A,x=new p.Pa4,E=new p.Pa4,T=[],R=[];for(g=0;g<3;g++)T[g]=R[g]=this.vertices[0];for(x.copy(this.vertices[0].point),E.copy(this.vertices[0].point),g=0,_=this.vertices.length;g<_;g++){var I=this.vertices[g],S=I.point;for(A=0;A<3;A++)S.getComponent(A)<x.getComponent(A)&&(x.setComponent(A,S.getComponent(A)),T[A]=I);for(A=0;A<3;A++)S.getComponent(A)>E.getComponent(A)&&(E.setComponent(A,S.getComponent(A)),R[A]=I)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(x.x),Math.abs(E.x))+Math.max(Math.abs(x.y),Math.abs(E.y))+Math.max(Math.abs(x.z),Math.abs(E.z))),{min:T,max:R}},computeInitialHull:function(){a===void 0&&(a=new p.Zzh,e=new p.JOQ,t=new p.Pa4);var g,_,A,x,E,T,R,I,S,O=this.vertices,k=this.computeExtremes(),N=k.min,H=k.max,X=0,te=0;for(T=0;T<3;T++)(S=H[T].point.getComponent(T)-N[T].point.getComponent(T))>X&&(X=S,te=T);for(_=N[te],A=H[te],X=0,a.set(_.point,A.point),T=0,R=this.vertices.length;T<R;T++)(g=O[T])!==_&&g!==A&&(a.closestPointToPoint(g.point,!0,t),(S=t.distanceToSquared(g.point))>X&&(X=S,x=g));for(X=-1,e.setFromCoplanarPoints(_.point,A.point,x.point),T=0,R=this.vertices.length;T<R;T++)(g=O[T])!==_&&g!==A&&g!==x&&(S=Math.abs(e.distanceToPoint(g.point)))>X&&(X=S,E=g);var re=[];if(e.distanceToPoint(E.point)<0)for(re.push(l.create(_,A,x),l.create(E,A,_),l.create(E,x,A),l.create(E,_,x)),T=0;T<3;T++)I=(T+1)%3,re[T+1].getEdge(2).setTwin(re[0].getEdge(I)),re[T+1].getEdge(1).setTwin(re[I+1].getEdge(0));else for(re.push(l.create(_,x,A),l.create(E,_,A),l.create(E,A,x),l.create(E,x,_)),T=0;T<3;T++)I=(T+1)%3,re[T+1].getEdge(2).setTwin(re[0].getEdge((3-T)%3)),re[T+1].getEdge(0).setTwin(re[I+1].getEdge(1));for(T=0;T<4;T++)this.faces.push(re[T]);for(T=0,R=O.length;T<R;T++)if((g=O[T])!==_&&g!==A&&g!==x&&g!==E){X=this.tolerance;var ue=null;for(I=0;I<4;I++)(S=this.faces[I].distanceToPoint(g.point))>X&&(X=S,ue=this.faces[I]);ue!==null&&this.addVertexToFace(g,ue)}return this},reindexFaces:function(){for(var g=[],_=0;_<this.faces.length;_++){var A=this.faces[_];A.mark===r&&g.push(A)}return this.faces=g,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var g,_=0,A=this.assigned.first().face,x=A.outside;do{var E=A.distanceToPoint(x.point);E>_&&(_=E,g=x),x=x.next}while(x!==null&&x.face===A);return g}},computeHorizon:function(g,_,A,x){var E;this.deleteFaceVertices(A),A.mark=1,E=_===null?_=A.getEdge(0):_.next;do{var T=E.twin,R=T.face;R.mark===r&&(R.distanceToPoint(g)>this.tolerance?this.computeHorizon(g,T,R,x):x.push(E)),E=E.next}while(E!==_);return this},addAdjoiningFace:function(g,_){var A=l.create(g,_.tail(),_.head());return this.faces.push(A),A.getEdge(-1).setTwin(_.twin),A.getEdge(0)},addNewFaces:function(g,_){this.newFaces=[];for(var A=null,x=null,E=0;E<_.length;E++){var T=_[E],R=this.addAdjoiningFace(g,T);A===null?A=R:R.next.setTwin(x),this.newFaces.push(R.face),x=R}return A.next.setTwin(x),this},addVertexToHull:function(g){var _=[];return this.unassigned.clear(),this.removeVertexFromFace(g,g.face),this.computeHorizon(g.point,null,g.face,_),this.addNewFaces(g,_),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var g;for(this.computeInitialHull();(g=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(g);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(l,{create:function(g,_,A){var x=new l,E=new u(g,x),T=new u(_,x),R=new u(A,x);return E.next=R.prev=T,T.next=E.prev=R,R.next=T.prev=E,x.edge=E,x.compute()}}),Object.assign(l.prototype,{toArray:function(){const g=[];let _=this.edge;do g.push(_.head().index),_=_.next;while(_!==this.edge);return g},getEdge:function(g){for(var _=this.edge;g>0;)_=_.next,g--;for(;g<0;)_=_.prev,g++;return _},compute:function(){i===void 0&&(i=new p.CJI);var g=this.edge.tail(),_=this.edge.head(),A=this.edge.next.head();return i.set(g.point,_.point,A.point),i.getNormal(this.normal),i.getMidpoint(this.midpoint),this.area=i.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(g){return this.normal.dot(g)-this.constant}}),Object.assign(u.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var g=this.head(),_=this.tail();return _!==null?_.point.distanceTo(g.point):-1},lengthSquared:function(){var g=this.head(),_=this.tail();return _!==null?_.point.distanceToSquared(g.point):-1},setTwin:function(g){return this.twin=g,g.twin=this,this}}),Object.assign(f.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(g,_){return _.prev=g.prev,_.next=g,_.prev===null?this.head=_:_.prev.next=_,g.prev=_,this},insertAfter:function(g,_){return _.prev=g,_.next=g.next,_.next===null?this.tail=_:_.next.prev=_,g.next=_,this},append:function(g){return this.head===null?this.head=g:this.tail.next=g,g.prev=this.tail,g.next=null,this.tail=g,this},appendChain:function(g){for(this.head===null?this.head=g:this.tail.next=g,g.prev=this.tail;g.next!==null;)g=g.next;return this.tail=g,this},remove:function(g){return g.prev===null?this.head=g.next:g.prev.next=g.next,g.next===null?this.tail=g.prev:g.next.prev=g.prev,this},removeSubList:function(g,_){return g.prev===null?this.head=_.next:g.prev.next=_.next,_.next===null?this.tail=g.prev:_.next.prev=g.prev,this},isEmpty:function(){return this.head===null}}),o}();const cL=new p.Pa4,E1=new p.Pa4,uL=new p._fP;function S1(a){const e=function(r){const s=[];return r.traverse(function(o){o.isMesh&&s.push(o)}),s}(a);if(e.length===0)return null;if(e.length===1)return FI(e[0]);let t;const i=[];for(;t=e.pop();)i.push(hL(FI(t)));return function(r){let s=0;for(let u=0;u<r.length;u++){const h=r[u].attributes.position;h&&h.itemSize===3&&(s+=h.count)}const o=new Float32Array(3*s);let l=0;for(let u=0;u<r.length;u++){const h=r[u].attributes.position;if(h&&h.itemSize===3)for(let f=0;f<h.count;f++)o[l++]=h.getX(f),o[l++]=h.getY(f),o[l++]=h.getZ(f)}return new p.u9r().setAttribute("position",new p.TlE(o,3))}(i)}function FI(a){let e=a.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),a.updateMatrixWorld(),a.matrixWorld.decompose(cL,uL,E1),e.scale(E1.x,E1.y,E1.z),e}function jI(a){const e=a.attributes.position,t=new Float32Array(3*e.count);for(let i=0;i<e.count;i++)t[3*i]=e.getX(i),t[3*i+1]=e.getY(i),t[3*i+2]=e.getZ(i);return t}function C1(a,e){switch(e){case"x":return a.x;case"y":return a.y;case"z":return a.z}throw new Error(`Unexpected component ${e}`)}function hL(a,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=a.getIndex(),r=a.getAttribute("position"),s=i?i.count:r.count;let o=0;const l=[],u=[],h=Math.log10(1/e),f=Math.pow(10,h);for(let A=0;A<s;A++){const x=i?i.getX(A):A;let E="";E+=~~(r.getX(x)*f)+",",E+=~~(r.getY(x)*f)+",",E+=~~(r.getZ(x)*f)+",",E in t?l.push(t[E]):(u.push(r.getX(x)),u.push(r.getY(x)),u.push(r.getZ(x)),t[E]=o,l.push(o),o++)}const g=new p.TlE(new Float32Array(u),r.itemSize,r.normalized),_=new p.u9r;return _.setAttribute("position",g),_.setIndex(l),_}const zI=Math.PI/2;var ks;(function(a){a.BOX="Box",a.CYLINDER="Cylinder",a.SPHERE="Sphere",a.HULL="ConvexPolyhedron",a.MESH="Trimesh"})(ks||(ks={}));const dL=function(a,e={}){const t=function(u,h={}){let f;if(h.type===ks.BOX)return GI(u);if(h.type===ks.CYLINDER)return function(g,_){const A=["x","y","z"],x=_.cylinderAxis||"y",E=A.splice(A.indexOf(x),1)&&A,T=new p.ZzF().setFromObject(g);if(!isFinite(T.min.lengthSq()))return null;const R=T.max[x]-T.min[x],I=.5*Math.max(C1(T.max,E[0])-C1(T.min,E[0]),C1(T.max,E[1])-C1(T.min,E[1])),S=x==="y"?zI:0,O=x==="z"?zI:0;return{type:ks.CYLINDER,params:{radiusTop:I,radiusBottom:I,height:R,segments:12},orientation:new Ss().setFromEuler(S,O,0,"XYZ").normalize()}}(u,h);if(h.type===ks.SPHERE)return function(g,_){if(_.sphereRadius)return{type:ks.SPHERE,params:{radius:_.sphereRadius}};const A=S1(g);return A?(A.computeBoundingSphere(),{type:ks.SPHERE,params:{radius:A.boundingSphere.radius}}):null}(u,h);if(h.type===ks.HULL)return function(g){const _=S1(g);if(!_)return null;const A=1e-4;for(let T=0;T<_.attributes.position.count;T++)_.attributes.position.setXYZ(T,_.attributes.position.getX(T)+(Math.random()-.5)*A,_.attributes.position.getY(T)+(Math.random()-.5)*A,_.attributes.position.getZ(T)+(Math.random()-.5)*A);const[x,E]=new lL().setFromObject(new p.Kj0(_)).toJSON();return{type:ks.HULL,params:{vertices:new Float32Array(x),faces:E}}}(u);if(h.type===ks.MESH)return f=S1(u),f?function(g){const _=jI(g);if(!_.length)return null;const A=new Uint32Array(_.length);for(let x=0;x<_.length;x++)A[x]=x;return{type:ks.MESH,params:{vertices:_,indices:A}}}(f):null;if(h.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${h.type}".`);if(f=S1(u),!f)return null;switch(f.type){case"BoxGeometry":case"BoxBufferGeometry":return VI(f);case"CylinderGeometry":case"CylinderBufferGeometry":return function(g){const _=g.parameters;return{type:ks.CYLINDER,params:{radiusTop:_.radiusTop,radiusBottom:_.radiusBottom,height:_.height,segments:_.radialSegments},orientation:new Ss().setFromEuler(p.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(f);case"PlaneGeometry":case"PlaneBufferGeometry":return function(g){g.computeBoundingBox();const _=g.boundingBox;return{type:ks.BOX,params:{x:(_.max.x-_.min.x)/2||.1,y:(_.max.y-_.min.y)/2||.1,z:(_.max.z-_.min.z)/2||.1}}}(f);case"SphereGeometry":case"SphereBufferGeometry":return function(g){return{type:ks.SPHERE,params:{radius:g.parameters.radius}}}(f);case"TubeGeometry":case"BufferGeometry":return GI(u);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',f.type),VI(f)}}(a,e);if(!t)return null;const{type:i,params:r,offset:s,orientation:o}=t;let l;return l=i===ks.BOX?function(u){const{x:h,y:f,z:g}=u;return new u1(new ne(h,f,g))}(r):i===ks.CYLINDER?function(u){const{radiusTop:h,radiusBottom:f,height:g,segments:_}=u,A=new n3(h,f,g,_);return A.radiusTop=f,A.radiusBottom=f,A.height=g,A.numSegments=_,A}(r):i===ks.SPHERE?function(u){return new TI(u.radius)}(r):i===ks.HULL?function(u){const{faces:h,vertices:f}=u,g=[];for(let _=0;_<f.length;_+=3)g.push(new ne(f[_],f[_+1],f[_+2]));return new nv({faces:h,vertices:g})}(r):function(u){const{vertices:h,indices:f}=u;return new b1(h,f)}(r),{shape:l,offset:s,orientation:o}};function VI(a){if(!jI(a).length)return null;a.computeBoundingBox();const e=a.boundingBox;return{type:ks.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function GI(a){const e=a.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const t=new p.ZzF().setFromObject(e);if(!isFinite(t.min.lengthSq()))return null;const i=t.translate(e.position.negate()).getCenter(new p.Pa4);return{type:ks.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:i.lengthSq()?new ne(i.x,i.y,i.z):void 0}}var I_,M1=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ad=I_=class extends Si{constructor(a=!1){super(),this._world=new tL,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var r;(r=this._viewer)===null||r===void 0||r.scene.modelRoot.children.forEach(s=>{this.makeBody(s)})},this._bodyMeshMap=new Map,this._movementPlane=new p.Kj0(new p._12(100,100),new p.vBJ({color:65280,side:p.ehD})),this.enabled=a,this._world.gravity.set(0,-9.81,0);const e=new s3,t=new ki({mass:0,position:new ne(0,-2,0)});t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=t,this._world.addBody(t);const i=new TI(.1);this._jointBody=new ki({mass:0}),this._jointBody.addShape(i),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(a){await super.onAdded(a);const e=new p.Pa4,t=new p.Pa4,i=new p.Pa4,r=new p._fP,s=new p._fP,o=new p.yGw,l=new p.yGw;let u=!1,h=!1;function f(g){const _=a.canvas.getBoundingClientRect(),A=new p.FM8;return A.x=(g.clientX-_.x)/_.width*2-1,A.y=-(g.clientY-_.y)/_.height*2+1,A}a.addEventListener("preFrame",()=>{const g=a.getPlugin(Ul),_=a.getPlugin(Dl);if(!this.enabled){if(!(this.nextSteps>0))return g&&u&&(g.enableRefreshTransform=!0,u=!1),_&&h&&(_.enable(I_.PluginType),h=!1),void(this._dirty=!1);this.enabled=!0}if(g&&g.enableRefreshTransform&&!u&&(g.enableRefreshTransform=!1,u=!0),_&&!h&&_.disable(I_.PluginType),this.nextSteps>0)for(let x=0;x<this.stepPhysics.stepCount;x++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let A=!1;for(const x of this._world.bodies){if(x.mass===0)continue;const E=this._bodyMeshMap.get(x);if(E&&(E.updateMatrixWorld(),E.getWorldPosition(t),E.getWorldQuaternion(s),E.getWorldScale(i),t.manhattanDistanceTo(e.copy(x.position))>0&&(A=!0),s.angleTo(r.copy(x.quaternion))>0&&(A=!0),A)){if(o.compose(e,r,i),!E.parent)throw new Error("no parent");l.copy(E.parent.matrixWorld).invert(),l.multiply(o),l.decompose(e,r,i),E.position.copy(e),E.quaternion.copy(r)}}this._dirty=A,a.setDirty(),a.renderer.resetShadows(),g==null||g.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),a.scene.addEventListener("update",g=>{this._bodyMeshMap.forEach((_,A)=>{A.velocity.set(0,0,0),A.angularVelocity.set(0,0,0)})}),a.scene.addEventListener("addSceneObject",g=>{var _;const A=(_=g.object)===null||_===void 0?void 0:_.modelObject;A&&A.traverse(x=>{const E=x.uiConfig;E&&Array.isArray(E.children)&&(E.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(x)},{type:"number",label:"Mass",hidden:()=>!x._physicsBody,getValue:()=>{var T,R;return(R=(T=x._physicsBody)===null||T===void 0?void 0:T.mass)!==null&&R!==void 0?R:0},setValue:T=>{x._physicsBody&&(x._physicsBody.mass=T)}}]}),x.userData.physicsMass!==void 0&&this.makeBody(x))})}),a.canvas.addEventListener("pointerdown",g=>{if(!this.enabled||!g.isPrimary)return;a.getPlugin(fr)&&(a.getPlugin(fr).enabled=!1);const _=f(g),A=new p.iMs;A.setFromCamera(_,a.scene.activeCamera.cameraObject);const x=A.intersectObjects([...this._bodyMeshMap.values()],!0);if(!x.length)return;let E,T=null,R=x[0];for(const O of x){for(T=O.object,R=O;!(T==null||T.visible&&T.material);)T=T.parent;if(T)break}if(!T)return;for(;T.parent&&!E;){for(const[O,k]of this._bodyMeshMap.entries())if(k===T){O.mass>0&&(E=O);break}T=T.parent}if(!E)return;a.scene.activeCamera.setInteractions(!1,I_.PluginType),this._movementPlane.position.copy(R.point),this._movementPlane.lookAt(a.scene.activeCamera.cameraObject.getWorldPosition(new p.Pa4));const I=new ne().copy(R.point).vsub(E.position),S=E.quaternion.inverse().vmult(I);this._jointBody.position.copy(R.point),this._jointConstraint=new t3(E,S,this._jointBody,new ne(0,0,0)),this._world.addConstraint(this._jointConstraint)}),a.canvas.addEventListener("pointermove",g=>{if(!this.enabled||!g.isPrimary||!this._jointConstraint)return;const _=f(g),A=new p.iMs;A.setFromCamera(_,a.scene.activeCamera.cameraObject);const x=A.intersectObject(this._movementPlane);if(!x.length)return;const E=x[0];this._jointBody.position.copy(E.point),this._jointConstraint.update()}),a.canvas.addEventListener("pointerup",g=>{this.enabled&&g.isPrimary&&(a.getPlugin(fr)&&(a.getPlugin(fr).enabled=!0),a.scene.activeCamera.setInteractions(!0,I_.PluginType),this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(a){if(a.isLight||a._physicsBody)return;const e=[];let t=0;if(a.updateMatrixWorld(),a.traverse(u=>{var h;const f=u;if(!f.isMesh||!f.material||!f.visible)return;if(f._physicsShape)return void e.push(f._physicsShape);if(t+=(h=f.userData.physicsMass)!==null&&h!==void 0?h:1,f.addEventListener("objectUpdate",()=>{f.userData.physicsMass===0&&(this._ground.position.y=f.position.y,this._bodyMeshMap.forEach((_,A)=>{A.velocity.set(0,0,0),A.angularVelocity.set(0,0,0),A.force.set(0,0,0),A.torque.set(0,0,0)}))}),f.userData.physicsMass===0)return;const g=dL(f,{type:ks.HULL});g?(e.push([g.shape,f]),f._physicsShape=g.shape):console.warn("Failed to convert mesh to cannon shape",f)}),!e.length)return;const i=new ki({mass:t,angularVelocity:new ne(0,0,0),velocity:new ne(0,0,0)}),r=new p.Pa4,s=new p._fP,o=new p.Pa4,l=new p.yGw;for(const[u,h]of e)h!==a?(h.updateMatrixWorld(),l.copy(a.matrixWorld).invert(),l.multiply(h.matrixWorld),l.decompose(r,s,o),i.addShape(u,new ne(...r.toArray()),new Ss(...s.toArray()))):i.addShape(u);i.position.set(...a.getWorldPosition(r).toArray()),i.quaternion.set(...a.getWorldQuaternion(s).toArray()),i.angularVelocity.set(0,0,0),i.velocity.set(0,0,0),a.addEventListener("objectUpdate",()=>{i.position.set(...a.getWorldPosition(r).toArray()),i.quaternion.set(...a.getWorldQuaternion(s).toArray()),i.angularVelocity.set(0,0,0),i.velocity.set(0,0,0)}),this._world.addBody(i),this._bodyMeshMap.set(i,a),a._physicsBody=i,a.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};Ad.PluginType="CannonPhysics",M1([Ot("Enabled",a=>({onChange:()=>{}})),ae()],Ad.prototype,"enabled",void 0),M1([en()],Ad.prototype,"stepPhysics",void 0),M1([Xi("Make Root Bodies")],Ad.prototype,"makeRootBodies",void 0),Ad=I_=M1([zi("Physics (dev)")],Ad);var pL=__webpackgi_require__(819),fL=__webpackgi_require__(665);const mL=(a,e,t)=>{var i,r;const s=a.controller_,o=(r=(i=s.parent)===null||i===void 0?void 0:i.children)===null||r===void 0?void 0:r.indexOf(s);return!(((l,u)=>u.controller_.rackController.rack===l.controller_.parent)(a,e)&&o===t||(e.add(a,t),0))},HI=(a,e,t,i)=>{var r,s,o,l,u;let h=e.uiRef;h!=null&&h.controller_.viewProps.get("disposed")&&(h=void 0);const f=h==null?void 0:h.expanded;if(!h){const T=a.addFolder({title:""});h=T,h.on("fold",R=>{var I,S,O,k;let N=T.expanded;(0,V.safeSetProperty)(e,"expanded",N,!0),N=(I=(0,V.getOrCall)(e.expanded))!==null&&I!==void 0?I:N,N!==T.expanded&&(T.expanded=N),(S=e.uiRefresh)===null||S===void 0||S.call(e,"postFrame",!0,10),N?(O=e.onExpand)===null||O===void 0||O.call(e,e):(k=e.onCollapse)===null||k===void 0||k.call(e,e)})}if(!h)return h;h.expanded=(s=(r=(0,V.getOrCall)(e.expanded))!==null&&r!==void 0?r:f)!==null&&s!==void 0&&s;const g=((o=e.children)!==null&&o!==void 0?o:[]).map(T=>T&&(0,V.getOrCall)(T)).flat(2).filter(T=>T);let _=0;for(const T of g){if(Array.isArray(T)||typeof T!="object"){console.error("child is not an object",T);continue}let R=T.uiRef;R&&R.controller_.viewProps.get("disposed")&&(T.uiRef=void 0,T.uiRefresh=void 0),R=T.uiRef,R||(t.appendUiObject({uiConfig:T},h),R=T.uiRef),R&&mL(R,h,_++)&&t.appendUiObject({uiConfig:T},h)}let A=h.children;for(;A.length>_;){const T=A[A.length-1];h.remove(T),T.dispose(),A=h.children}h.controller_.props.set("title",(l=(0,V.getOrCall)(e.label))!==null&&l!==void 0?l:"");const x=h.controller_.view.containerElement,E=(0,V.getOrCall)(e.domChildren,[]);if((E==null?void 0:E.length)!==void 0){const T=[];for(let R=0;R<x.children.length;R++){const I=x.children[R];!((u=I.dataset)===null||u===void 0)&&u.tpCustomDOM&&T.push(I)}for(const R of T)x.removeChild(R);for(const R of E)R.parentElement!==x&&(x.appendChild(R),R.dataset.tpCustomDOM="true");h.controller_.foldable.cleanUpTransition()}return h},gL=(a,e,t,i)=>{var r,s;const[o,l]=(r=e.property)!==null&&r!==void 0?r:[void 0,void 0],u=(s=(0,V.getOrCall)(e.label))!==null&&s!==void 0?s:l;let h=e.uiRef;return h!=null&&h.controller_.viewProps.get("disposed")&&(h=void 0),h||(h=a.addButton({title:""}),h.on("click",async()=>{const f=[];e.prompt&&f.push(await t.prompt(...e.prompt));let g=o&&l?o[l]:void 0,_=o;if(g||(g=e.value,_=e),typeof g=="function"){const A=()=>{t.removeEventListener("postFrame",A),g.call(_??e,...f)};t.addEventListener("postFrame",A)}else console.warn("uiconfig.js: Invalid action type for button")})),h&&(h.title=(u??"click me")+""),h},vL=(a,e,t,i)=>{var r;const s=Object.fromEntries(((r=(0,V.getOrCall)(e.children))!==null&&r!==void 0?r:[]).map(o=>(0,V.getOrCall)(o)).flat(2).filter(o=>o).map(o=>{var l;const u=(0,V.getOrCall)(o.label);return[u,(l=o.value)!==null&&l!==void 0?l:u]}));return ah(a,e,t,{options:s,...i??{}})},_L=(a,e,t,i)=>{var r,s;const o=(0,V.getOrCall)(e.bounds),l=((r=o==null?void 0:o.length)!==null&&r!==void 0?r:0)>=2?o[1]:1,u=((s=o==null?void 0:o.length)!==null&&s!==void 0?s:0)>=1?o[0]:0,h=e.stepSize||void 0;return ah(a,e,t,{min:u,max:l,step:h,...i??{}})},T1=(a,e,t,i)=>{var r,s,o;const l=(0,V.getOrCall)(e.bounds);if(!l||l.length<1)return ah(a,e,t,{...i??{}});const u=((r=l.length)!==null&&r!==void 0?r:0)>=2?l[1]:1,h=((s=l.length)!==null&&s!==void 0?s:0)>=1?l[0]:0,f={min:h,max:u,step:(o=e.stepSize)!==null&&o!==void 0?o:(u-h)/100},g={x:f,y:f};e.type!=="vec3"&&e.type!=="vec4"||(g.z=f),e.type==="vec4"&&(g.w=f);const _=e.property;if(e.value===void 0&&_&&_[0]&&typeof _[0]=="object"&&_[0][_[1]]&&Array.isArray(_[0][_[1]])){const[A,x]=_,E=A[x],T=E.length,R=new(T===2?p.FM8:T===3?p.Pa4:p.Ltg)().fromArray(E);e.value=R,e.property=void 0,e.onChange=[()=>{A[x]=R.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(I=>I),e.label===void 0&&(e.label=x)}return ah(a,e,t,{...g,...i??{}})},yL=(a,e,t,i)=>{var r;const s=e.property;if(e.value===void 0&&s&&typeof s[0]=="object"&&!((r=s[0][s[1]])===null||r===void 0)&&r.isColor){const[o,l]=s,u=p.KI_;Object.defineProperty(e,"value",{get:()=>{const h=o[l];return h?new p.Ilk(h).getHex(u):0},set:h=>{const f=o[l],g=new p.Ilk().setHex(h,u);f.isColor?f.copy(g):typeof f=="number"?o[l]=g.getHex():typeof f=="string"&&(o[l]="#"+g.getHexString()),typeof(o==null?void 0:o.setDirty)=="function"&&o.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(h=>h),e.label===void 0&&(e.label=l+"")}return(i=i??{}).view="color",(0,V.getOrCall)(e.inlinePicker)&&(i.picker="inline"),ah(a,e,t,i)},ah=(a,e,t,i)=>{var r,s,o,l,u,h,f;let g=(0,V.getOrCall)(e.property);if((e.getValue||e.setValue)&&g&&console.error("specify either property or value, or getValue and setValue",e),g)e.value&&console.warn("uiconfig.js: Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var x;return(x=e.getValue)===null||x===void 0?void 0:x.call(e)},set:x=>{var E;return(E=e.setValue)===null||E===void 0?void 0:E.call(e,x)}}),g=[e,"value"]),g||e.value===void 0||(g=[e,"value"]),!g)return void console.error("cannot determine property",e);i=i??{};const _={label:(r=(0,V.getOrCall)(e.label))!==null&&r!==void 0?r:g[1],...i};let A=e.uiRef;if(A!=null&&A.controller_.viewProps.get("disposed")&&(A=void 0),!A&&typeof g[0]=="object"&&g[0]){const[x,E]=g;try{A=e.isMonitor?a.addMonitor(x,E,_):a.addInput(x,E,_).on("change",T=>{[e.onChange].flat().forEach(R=>typeof R=="function"&&(R==null?void 0:R(T))),typeof(x==null?void 0:x.setDirty)=="function"&&x.setDirty(T)})}catch(T){if(!T.message.startsWith("No matching controller for"))throw T;A=void 0}}if(A){for(const[x,E]of Object.entries(_)){const T=A.controller_;let R=T.props.value(x);if(R!==void 0)R.rawValue!==E&&A.controller_.props.set(x,E);else{const I=T.valueController;R=(o=(s=I.props)===null||s===void 0?void 0:s.value)===null||o===void 0?void 0:o.call(s,x);let S=E;const O=R==null?void 0:R.rawValue;let k=!1;x==="options"&&typeof S=="object"&&!Array.isArray(S)&&Array.isArray(O)&&(S=Object.entries(S).map(([N,H])=>({text:N,value:H})),k=!0),R===void 0||O===S||k&&A.__lastOptions===E||(I.props.set(x,S),k&&((u=(l=I.view)===null||l===void 0?void 0:l.update_)===null||u===void 0||u.call(l),A.__lastOptions=E))}}e.type==="slider"&&(_.min!==void 0&&A.controller_.valueController.sliderController.props.set("minValue",_.min),_.max!==void 0&&A.controller_.valueController.sliderController.props.set("maxValue",_.max)),(h=(A==null?void 0:A.controller_.valueController.view).inputElement)===null||h===void 0||h.setAttribute("placeholder",(f=(0,V.getOrCall)(e.placeholder))!==null&&f!==void 0?f:""),A.refresh()}return A};class QI extends V.SimpleEventDispatcher{constructor(e=!1,t=!1,i=!1,r=!0,s=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:HI,folder:HI,input:ah,number:ah,slider:_L,dropdown:vL,checkbox:ah,color:yL,vec:T1,vec2:T1,vec3:T1,vec4:T1,button:gL,monitor:(l,u,h,f)=>(u.isMonitor=!0,ah(l,u,h,f)),dummy:(l,u,h,f)=>ah(l,u,h,f)},this.alert=async l=>alert(l),this.confirm=async l=>confirm(l),this.prompt=async(l,u,h=!0)=>prompt(l,u),this._expand=e,this._limitedOptions=i;const o=this._createUiContainer();s.appendChild(o),this._container=s,this._pane=new fL.Pane({title:"Configuration",container:o}),this._pane.expanded=this._expand,r&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],i=[],r=(0,V.now)(),s=r-this._lastModeTime[e];t.forEach(o=>{o[2]>.001?(o[2]-=s,i.push(o)):this._refreshUiObject(o[0],o[1],o[2])}),this._refreshQueue[e]=i,this._lastModeTime[e]=r}addToRefreshQueue(e,t){var i;const r=(i=t[0])===null||i===void 0?void 0:i.uiConfig,s=r==null?void 0:r.uuid,o=this._refreshQueue[e],l=o.find(u=>u[3]===s);l?l[2]=Math.max(l[2],t[2]):o.push([...t,s]),this._refreshQueue[e]=o}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var i,r,s,o;const{uiConfig:l}=e??{};if(l&&(!this._limitedOptions||l.limitedUi)&&(t=t??this._pane,l.type)){l.uuid||(l.uuid=Wn()),l.uiRef&&l.uiRefType!==l.type&&this.removeUiConfig(l);const u=(r=(i=this._typeGenerators)[l.type])===null||r===void 0?void 0:r.call(i,t,l,this);u&&(u.hidden=(s=(0,V.getOrCall)(l.hidden))!==null&&s!==void 0&&s,u.disabled=(o=(0,V.getOrCall)(l.disabled))!==null&&o!==void 0&&o),l.uiRef=u,l.uiRefType=u?l.type:void 0,l.uiRefresh=(h="postFrame",f=!1,g=0)=>{var _;return this._uiObjectRefresh(h,(_=e==null?void 0:e.uiConfig)!==null&&_!==void 0?_:l,t,f,g)},u==null||u.controller_.viewProps.handleDispose(()=>{l.uiRef=void 0,l.uiRefType=void 0,l.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,i;e&&e.uiRef&&((i=(t=e.uiRef).dispose)===null||i===void 0||i.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,i,r,s){(r?I1(t,i):[{uiConfig:t,parentFolder:i}]).forEach(o=>{const l=[{uiConfig:o.uiConfig},o.parentFolder,s];e==="immediate"?this._refreshUiObject(...l):this.addToRefreshQueue(e,l)})}_refreshUiObject(e,t,i=0){this._appendUiObject(e,t),i>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,V.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,V.createStyles)(V.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function I1(a,e,t){return t=t??[],a&&a.uiRef&&(t.push({uiConfig:a,parentFolder:e}),typeof a.children=="function"||[...a.children||[]].forEach(i=>{typeof i!="function"&&i&&(Array.isArray(i)?i.forEach(r=>t=I1(r,a.uiRef,t)):t=I1(i,a.uiRef,t))})),t}var P1=__webpackgi_require__(898),tA={};P1.Z&&P1.Z.locals&&(tA.locals=P1.Z.locals);var LC,kC=0,cv={};cv.styleTagTransform=gc(),cv.setAttributes=tu(),cv.insert=function(a,e){(e.target||document.head).appendChild(a)},cv.domAPI=mc(),cv.insertStyleElement=Lu(),tA.use=function(a){return cv.options=a||{},kC++||(LC=fc()(P1.Z,cv)),tA},tA.unuse=function(){kC>0&&!--kC&&(LC(),LC=null)};var bL=tA;class P_ extends QI{constructor(e=!1,t=!1,i=!1,r,s){var o,l;super(e,t,i,!1,(o=r??document.getElementById("tweakpaneMainPanelSlot"))!==null&&o!==void 0?o:document.body),this.dependencies=[Ut],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=u=>{this.dispatchEvent(u),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async u=>this._viewer?this._viewer.alert(u):super.alert(u),this.confirm=async u=>this._viewer?this._viewer.confirm(u):super.confirm(u),this.prompt=async(u,h,f=!0)=>this._viewer?this._viewer.prompt(u,h,f):super.prompt(u,h,f),this._pane.registerPlugin(pL),bL.use({target:this._container}),this.colorMode=(l=s??(localStorage?localStorage.getItem("tpTheme"):"blue"))!==null&&l!==void 0?l:"blue"}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(i,r,s,o)=>{let l=r.property||r.__property;const u="placeholder";if(r.value===void 0&&(r.getValue||r.setValue)&&(Object.defineProperty(r,"_value",{get:()=>{var h;return(h=r.getValue)===null||h===void 0?void 0:h.call(r)},set:h=>{var f;return(f=r.setValue)===null||f===void 0?void 0:f.call(r,h)}}),l=[r,"_value"]),(!(Object.hasOwn?Object.hasOwn(r,"value"):r.hasOwnProperty("value"))||r.value===void 0)&&l&&typeof l[0]=="object"){const[h,f]=l,g=(0,V.makeTextSvg)("Render Target"),_=(0,V.makeTextSvg)("Data Texture"),A=(0,V.makeTextSvg)("CUBE Texture"),x=(0,V.makeTextSvg)("Compressed Texture"),E={},T={};Object.defineProperty(r,"value",{get:()=>{var R;let I,S=h[f];if(S!=null&&S.get&&(S=S.get()),!S)return u;if(S.isCompressedTexture&&S.image&&!S.image.tp_src&&(S.image.tp_src=x),S.isTexture?(S.image&&!S.image.tp_src&&(S.image instanceof ImageBitmap||S.image instanceof HTMLImageElement||S.image instanceof HTMLVideoElement)?S.image.tp_src=(0,V.imageBitmapToBase64)(S.image,160):S.image&&S.isRenderTargetTexture&&!S.image.tp_src?S.__target&&(S.tp_src=t.renderer.renderTargetToDataUrl(S.__target,void 0,void 0,Array.isArray(S.__target.texture)?S.__target.texture.indexOf(S):void 0)):S.image&&!S.image.tp_src&&(S.image.tp_src=$r(S,160,!1).toDataURL("image/png",90)),!S.isRenderTargetTexture||S.image.tp_src||S.tp_src||(S.image.tp_src=g),S.isDataTexture&&S.image&&!S.image.tp_src&&(S.image.tp_src=_),S.image&&(I=S.image.tp_src_uuid,I=I?E[I]:void 0,I||(I=S.image.tp_src||S.image.src)),S.tp_src&&(I=S.tp_src)):typeof S=="string"?I=S:S.domainMin?(I=S.texture,S.texture.image&&!S.texture.image.tp_src&&(S.texture.image.tp_src=A),S.texture.image&&(I=S.texture.image.tp_src_uuid,I=I?E[I]:void 0,I||(I=S.texture.image.tp_src||S.texture.image.src))):S&&console.error("unknown value",S),I||(I=u),S.image&&!S.image.tp_src_uuid){const O=Wn();S.image.tp_src_uuid=O,T[I]=O}return typeof I=="string"&&(I=(R=E[I])!==null&&R!==void 0?R:I),I},set:R=>{var I,S,O,k,N,H,X,te,re,ue,le;const se=h[f],de=fe=>{var Ee;h[f]=fe,fe!=null&&fe.isTexture&&(fe.flipY=fe.isDataTexture?fe.flipY:(Ee=se==null?void 0:se.flipY)===null||Ee===void 0||Ee)};if(typeof R=="string")return void(typeof se=="string"&&de(R));if(!R)return void(r.value=u);if(R.isPlaceholder)return void(se&&(de(typeof se=="string"?"":null),typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty()));let ve=R.tp_src_uuid;if(ve||(ve=(I=R.src)!==null&&I!==void 0?I:R.tp_src,ve=(S=T[ve])!==null&&S!==void 0?S:ve,delete T[ve],R.tp_src_uuid=ve),ve&&(E[ve]=R),typeof se!="string"){if(!((se==null?void 0:se.image)===R||((O=se==null?void 0:se.image)===null||O===void 0?void 0:O.src)===R.src||((k=se==null?void 0:se.image)===null||k===void 0?void 0:k.tp_src)===R.tp_src&&R.tp_src!=null||((N=se==null?void 0:se.image)===null||N===void 0?void 0:N.tp_src)===R.src&&R.src!=null||((H=se==null?void 0:se.image)===null||H===void 0?void 0:H.src)===R.tp_src&&R.tp_src!=null))if(R instanceof File){const fe=t==null?void 0:t.getPlugin(Ut);if(!fe)throw"Viewer or AssetManagerPlugin not found";(X=fe.importer)===null||X===void 0||X.importSingle({file:R,path:R.src}).then(Ee=>{var Je,Te,qe,Ve;if(Ee){Ee.isDataTexture&&(Ee.needsUpdate=!0);const Ye=(qe=(Te=(Je=R.src)===null||Je===void 0?void 0:Je.split("?"))===null||Te===void 0?void 0:Te[0])===null||qe===void 0?void 0:qe.split(".").pop();Ee.userData&&(Ee.userData.mimeType||(Ee.userData.mimeType="image/"+(["jpg","jpeg"].includes(Ye)?"jpeg":"png"))),de(Ee),[r.onChange].flat().forEach(Tt=>typeof Tt=="function"&&(Tt==null?void 0:Tt())),typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty(),(Ve=r.uiRefresh)===null||Ve===void 0||Ve.call(r,"postFrame",!1)}})}else{const fe=new p.xEZ(R);fe.assetType="texture",fe.needsUpdate=!0;const Ee=(ue=(re=(te=R.src)===null||te===void 0?void 0:te.split("?"))===null||re===void 0?void 0:re[0])===null||ue===void 0?void 0:ue.split(".").pop();fe.userData.mimeType||(fe.userData.mimeType="image/"+(["jpg","jpeg"].includes(Ee)?"jpeg":"png"));const Je=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(f);fe.colorSpace=Je?p.GUF:p.KI_,fe.wrapS=p.rpg,fe.wrapT=p.rpg,de(fe),[r.onChange].flat().forEach(Te=>typeof Te=="function"&&(Te==null?void 0:Te())),typeof(h==null?void 0:h.setDirty)=="function"&&h.setDirty(),(le=r.uiRefresh)===null||le===void 0||le.call(r,"postFrame",!1)}}else de(ve)}}),r.__property=r.property,r.property=void 0,r.label===void 0&&(r.label=f)}return(o=o??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],o.imageFit===void 0&&(o.imageFit="contain"),o.clickCallback===void 0&&(o.clickCallback=(h,f)=>{var g;const _=h==null?void 0:h.target,A=_==null?void 0:_.getBoundingClientRect();if(!A)return void f.click();const x=r.uiRef.controller_.valueController.value.rawValue,E=x===u||x!=null&&x.isPlaceholder?{}:{"remove image":()=>{var R;r.uiRef.controller_.valueController.value.setRawValue("");const[I,S]=r.property||r.__property||[r,"value"],O=typeof I[S]=="string";I[S]=O?"":null,[r.onChange].flat().forEach(k=>typeof k=="function"&&(k==null?void 0:k())),typeof(I==null?void 0:I.setDirty)=="function"&&I.setDirty(),(R=r.uiRefresh)===null||R===void 0||R.call(r,"postFrame",!1),ja.Remove()},"download image":async()=>{var R,I;ja.Remove();const[S,O]=r.property||r.__property||[r,"value"],k=S[O];if(!k)return;const N=(R=k==null?void 0:k.image)!==null&&R!==void 0?R:r.uiRef.controller_.valueController.value.rawValue;let H=k.__rootBlob?k.__rootBlob.objectUrl||URL.createObjectURL(k.__rootBlob):k.userData.rootPath||(N==null?void 0:N.src);N&&(N instanceof ImageBitmap||N instanceof HTMLImageElement||N instanceof HTMLVideoElement)&&!H&&(H=(0,V.imageBitmapToBase64)(N));let X=k.__rootBlob?k.__rootBlob.name||"image."+(k.__rootBlob.ext||"png"):null;if(!H&&k.isRenderTargetTexture){const re=k.__target;if(k.type===p.ywz)H=t.renderer.renderTargetToDataUrl(re,"image/png",90,Array.isArray(k.__target.texture)?k.__target.texture.indexOf(k):void 0),X="renderTarget.png";else{const ue=new Kw().parse(t.renderer.rendererObject,re,{textureIndex:Array.isArray(k.__target.texture)?k.__target.texture.indexOf(k):void 0}),le=new Blob([ue],{type:"image/x-exr"});if(!le)return void console.error("cannot export render target",N,S[O],S,O,r);X="renderTarget.exr",H=URL.createObjectURL(le)}}if(!H&&k.isDataTexture){const re=new Kw().parse(void 0,k),ue=new Blob([re],{type:"image/x-exr"});if(!ue)return void console.error("cannot export data texture",N,S[O],S,O,r);X="dataTexture.exr",H=URL.createObjectURL(ue)}if(!H)return void console.error("cannot export image",N,S[O],S,O,r);const te=document.createElement("a");document.body.appendChild(te),te.style.display="none",te.href=H,te.download=X||(H.startsWith("data:")?"image.png":(I=H.split("/").pop())!==null&&I!==void 0?I:"image.png"),te.target="_blank",te.click(),document.body.removeChild(te)}},T=ja.Create({...E,"set/replace image":()=>{f.click(),ja.Remove()},"from url":async()=>{var R,I;let S="";if(S=await s.prompt("Load texture: Enter Image/Texture URL",S,!0),!S||!S.startsWith("http")&&!S.startsWith("data:image"))return S!==null&&await s.alert("Loading Image: Invalid URL"),void ja.Remove();S=S.trim();const[O,k]=r.property||r.__property||[r,"value"],N=O[k];if(typeof N=="string")O[k]=S,[r.onChange].flat().forEach(H=>typeof H=="function"&&(H==null?void 0:H())),typeof(O==null?void 0:O.setDirty)=="function"&&O.setDirty(),(R=r.uiRefresh)===null||R===void 0||R.call(r,"postFrame",!1);else{const H=t==null?void 0:t.getPlugin(Ut);if(!H)throw"Viewer or AssetManagerPlugin not found";(I=H.importer)===null||I===void 0||I.importSinglePath(S).then(X=>{var te;if(X){X.isDataTexture?X.needsUpdate=!0:X&&(N==null?void 0:N.flipY)!==void 0&&(X.flipY=N.flipY);const re=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(k);X.colorSpace=re?p.GUF:p.KI_,O[k]=X,[r.onChange].flat().forEach(ue=>typeof ue=="function"&&(ue==null?void 0:ue())),typeof(O==null?void 0:O.setDirty)=="function"&&O.setDirty(),(te=r.uiRefresh)===null||te===void 0||te.call(r,"postFrame",!1)}else console.warn("uiconfig-tweakpane: Failed to load texture",S)})}ja.Remove()},cancel:()=>{ja.Remove()}},2,A.height+8);(g=_.parentElement)===null||g===void 0||g.appendChild(T),A.y>.7*document.body.clientHeight&&(T.style.top="auto",T.style.bottom=A.height+8+"px")}),o.view="input-image",ah(i,r,s,o)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var t;const i=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(e);if(!i)return void console.warn("plugin not found:",e);this._plugins.push(i),i.uiConfig&&(i.uiConfig.limitedUi=!0),i.uiConfig&&i.uiConfig.hidden===void 0&&(i.uiConfig.hidden=!1),this._appendUiObject(i);const r=i.uiConfig;if(r!=null&&r.uiRef&&i.toJSON){const s=typeof i.toJSON=="function"?i.toJSON():null;i.resetDefaults=async()=>{var u,h;await((u=i.fromJSON)===null||u===void 0?void 0:u.call(i,s)),(h=r.uiRefresh)===null||h===void 0||h.call(r,"postFrame",!0)};const o=r.uiRef.controller_.view.element,l=(0,V.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});l.onclick=u=>{const h={};typeof i.toJSON=="function"&&(h["download preset"]=async()=>{var g,_;const A=(_=(g=this._viewer)===null||g===void 0?void 0:g.getPlugin(Ut))===null||_===void 0?void 0:_.exportPluginPreset(i);await(0,V.downloadBlob)(new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),"preset."+i.constructor.PluginType+".json"),ja.Remove()}),typeof i.fromJSON=="function"&&(h["upload preset"]=async()=>{var g,_,A;ja.Remove();const x=await(0,V.uploadFile)(!1,!1);if(x.length===0)return;const E=x[0],T=await E.text(),R=JSON.parse(T);await((_=(g=this._viewer)===null||g===void 0?void 0:g.getPlugin(Ut))===null||_===void 0?void 0:_.importPluginPreset(R,i)),(A=r.uiRefresh)===null||A===void 0||A.call(r,"postFrame",!0)},s&&(h["reset defaults"]=async()=>{var g,_;ja.Remove(),await((_=(g=i).resetDefaults)===null||_===void 0?void 0:_.call(g))}));const f=ja.Create(h,o.clientWidth-120,12);o.append(f),u.preventDefault()},o.appendChild(l)}return r}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var t;const i=e.uiConfig;i&&((0,V.getOrCall)(i.hidden)!==!0?(t=i.uiRefresh)===null||t===void 0||t.call(i,"postFrame",!0):i.uiRef&&(i.uiRef.hidden=!0))})}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}}P_.PluginType="TweakpaneUi",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([(0,V.onChange)(P_.prototype._colorModeChanged)],P_.prototype,"colorMode",void 0);class iA extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.backgroundIntensity)!==null&&t!==void 0?t:1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",getValue:()=>{var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.environment)||null},setValue:e=>{this._viewer&&(this._viewer.scene.environment=e)},type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",getValue:()=>{var e,t,i;return(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.environment)===null||t===void 0?void 0:t.rotation)!==null&&i!==void 0?i:0},setValue:e=>{var t,i;const r=(t=this._viewer)===null||t===void 0?void 0:t.scene.environment;r&&(r.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())},bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",getValue:()=>{var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&t!==void 0?t:1},setValue:e=>{var t;!((t=this._viewer)===null||t===void 0)&&t.scene&&(this._viewer.scene.envMapIntensity=e)},bounds:[0,4],limitedUi:!0},()=>({label:"Environment1",getValue:()=>{var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.textureSlots.environment1)||null},setValue:e=>{this._viewer&&(e.mapping===p.xfE&&(e.mapping=p.dSO,e.needsUpdate=!0),this._viewer.scene.textureSlots.environment1=e)},type:"image"}),{type:"slider",label:"Env1 Rotation",hidden:()=>{var e;return!(!((e=this._viewer)===null||e===void 0)&&e.scene.textureSlots.environment1)},getValue:()=>{var e,t,i;return(i=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.textureSlots.environment1)===null||t===void 0?void 0:t.rotation)!==null&&i!==void 0?i:0},setValue:e=>{var t,i;const r=(t=this._viewer)===null||t===void 0?void 0:t.scene.textureSlots.environment1;r&&(r.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())},bounds:[0,2*Math.PI]},{type:"checkbox",label:"Fixed Env Direction",getValue:()=>{var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.fixedEnvMapDirection)!==null&&t!==void 0&&t},setValue:e=>{this._viewer&&(this._viewer.scene.fixedEnvMapDirection=e)}},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.renderer.useLegacyLights)===null||t===void 0||t},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.backgroundColor)===null||t===void 0?void 0:t.getHex(p.KI_);return i!==void 0&&(this._savedBg=!0),i||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new p.Ilk),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.scene.background;return t&&(t.isTexture||t.assetType==="texture")?t:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get envmapBg(){var e,t,i;return((e=this._viewer)===null||e===void 0?void 0:e.scene.background)==="environment"||((t=this._viewer)===null||t===void 0?void 0:t.scene.background)===((i=this._viewer)===null||i===void 0?void 0:i.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.scene.background;t&&t!==this._viewer.scene.environment&&t!=="environment"&&(this.lastBgVal=t),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var t,i;(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var t,i;(i=(t=this.uiConfig).uiRefresh)===null||i===void 0||i.call(t,"postFrame",!0)})}}iA.PluginType="SimpleBackgroundEnvUiPlugin1";class rA extends Si{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig):this._uiConfig}_sceneUpdate(){}}rA.PluginType="SimpleUi";var AL=__webpackgi_require__(1),wL=__webpackgi_require__.n(AL)();class nA extends Si{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,V.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._resetting=!1,this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,i)=>(t.push({text:i.name||"unnamed",id:i.uuid,children:i.children.reduce(this._buildData,[])}),t),this._findVisible=(t,i)=>(i.visible&&(i.children.length<1?t.push(i.uuid):t.push(...i.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var i;(i=this._viewer)===null||i===void 0||i.doOnce("postFrame",()=>{var r,s,o;const l=(r=this._viewer)===null||r===void 0?void 0:r.scene.modelRoot;if(!l||t==null)return;const u=new Set;l.traverse(h=>{h!==l&&(h.visible=t.includes(h.uuid),h.visible&&h.traverseAncestors(f=>u.add(f)))}),u.forEach(h=>h.visible=!0),(o=(s=this._viewer)===null||s===void 0?void 0:s.scene)===null||o===void 0||o.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,V.createStyles)(V.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: var(--tp-container-foreground-color, hsl(230, 7%, 75%));
  margin-top: 0;
}
.treejs .treejs-switcher:before {
    border-top: 6px solid var(--tp-container-foreground-color, hsl(230, 7%, 75%)) !important;
}
        `)}_reset(e){var t;if(e!=null&&e.fromHierarchyPlugin||e&&!e.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const i=(t=this._viewer)===null||t===void 0?void 0:t.scene.modelRoot;if(!i)return;const r=i.children.reduce(this._buildData,[]),s=i.children.reduce(this._findVisible,[]);let o=!1;return new Promise((l,u)=>{this.treeView=new wL(this.hierarchyDiv,{closeDepth:1,data:r,loaded:function(){this.values=s,l()},onChange:()=>{o?(0,V.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):o=!0},onItemLabelClick:h=>{var f;const g=(f=this._viewer)===null||f===void 0?void 0:f.scene.modelRoot.modelObject.getObjectByProperty("uuid",h);g&&i.visible&&g.dispatchEvent({type:"select",value:g,ui:!0})}})})}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this.reset),await this.reset()}async reset(e){this._resetting||(this._resetting=!0,await(0,V.timeout)(500),await this._reset(e),this._resetting=!1)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}nA.PluginType="HierarchyUiPlugin";class sA extends Si{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Ud;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const e=new ic;e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const e=new ta;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,this._viewer.scene.addLight(e)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const e=new mf;e.position.set(3,3,3),e.shadow.mapSize.set(1024,1024),e.intensity=2,e.lookAt(0,0,0),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Ut],this._sceneUpdate=e=>{var t,i,r;if(!e.hierarchyChanged)return;const s=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(o=>{if(!o.lightObject)return;const l=o.uiConfig;l&&!s.includes(l)&&s.push(l)}),[...this.uiConfig.children].forEach(o=>{(o==null?void 0:o.type)==="button"||s.includes(o)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(o),1)}),s.forEach(o=>{this.uiConfig.children.includes(o)||this.uiConfig.children.push(o)}),(r=(i=this.uiConfig).uiRefresh)===null||r===void 0||r.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}sA.PluginType="SimpleLightsUi";class aA extends Si{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var e;if(!this._viewer)return;const t=this._viewer.createCamera(new p.cPb(45,1,.5,20));this._viewer.scene.modelRoot.add(t.cameraObject),t.setCameraOptions({controlsMode:"orbit"}),t.position.set(2,2,2),t.target.set(0,0,0),t.positionUpdated(!0),t.cameraObject.lookAt(0,0,0),t.setDirty();const i=this._viewer.getPluginByType("VirtualCamerasPlugin");if(i){const r=i.addCamera(t),s=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("debug");s&&s.addTexture("camera frame",()=>r.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[Ut],this._sceneUpdate=e=>{var t,i,r;if(!e.hierarchyChanged)return;const s=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(o=>{if(!o.cameraObject)return;const l=o.uiConfig;l&&!s.includes(l)&&s.push(l)}),[...this.uiConfig.children].forEach(o=>{(o==null?void 0:o.type)==="button"||s.includes(o)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(o),1)}),s.forEach(o=>{this.uiConfig.children.includes(o)||this.uiConfig.children.push(o)}),(r=(i=this.uiConfig).uiRefresh)===null||r===void 0||r.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}aA.PluginType="SimpleSceneCamerasUi";var Wp,R_=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Bc=Wp=class extends Si{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(a=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},t=this._viewer.container.getBoundingClientRect(),i={width:Math.floor(t.width),height:Math.floor(t.height)};let r=1;if(e.width>i.width){const s=e.width;e.width=i.width;const o=e.width/s;if(e.height=Math.floor(e.height*o),r/=o,r>Wp.MaxCanvasScale)return this.width=i.width*Wp.MaxCanvasScale,console.log("loop",this.width,i.width,r),void this._sizeChanged()}if(e.height>i.height){const s=e.height;e.height=i.height;const o=e.height/s;if(e.width=Math.floor(e.width*o),r/=o,r>Wp.MaxCanvasScale)return this.height=i.height*Wp.MaxCanvasScale,console.log("loop",this.width,i.width,this.height,i.height,r),void this._sizeChanged()}(e.width>=i.width||e.width<1)&&delete e.width,(e.height>=i.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(r),a&&(this.scale=r),this._refresh()}_setScale(a){this._viewer&&(this._viewer.renderer.displayCanvasScaling=a)}_scaleChanged(){if(!this._viewer)return;const a=this.scale;if(Math.abs(a-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,t=this._viewer.container.getBoundingClientRect(),i=Math.floor(t.width*a),r=Math.floor(i/e);this.width=i,this.height=r,this._sizeChanged(!1)}async onAdded(a){await super.onAdded(a);const e=a.canvas.clientWidth,t=a.canvas.clientHeight,i=a.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=i,a.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(a){return a.renderer.removeEventListener("resize",this._refresh),super.onRemove(a)}_refresh(){var a,e;(e=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||e===void 0||e.call(a,"postFrame",!0)}fromJSON(a,e){if(!a.mode)if(a.width||a.height){const t=this._viewer.container.getBoundingClientRect();a.width||(a.width=t.width),a.height||(a.height=t.height),a.scale&&(a.width*=a.scale,a.height*=a.scale,delete a.scale),a.width=Math.round(a.width),a.height=Math.round(a.height),a.mode="custom"}else a.mode="full";return super.fromJSON(a,e)}toJSON(a){const e=super.toJSON(a);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};Bc.PluginType="RendererParamsUiPlugin",Bc.MaxCanvasScale=5,R_([ae("version")],Bc.prototype,"_serializeVersion",void 0),R_([ae(),Fs("Mode",["full","custom"].map(a=>({label:a}))),(0,V.onChange2)(Wp.prototype._sizeChanged)],Bc.prototype,"mode",void 0),R_([ae(),ai("Width",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],Bc.prototype,"width",void 0),R_([ae(),ai("Height",void 0,1,a=>({onChange:()=>a._sizeChanged(),hidden:()=>a.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=a._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],Bc.prototype,"height",void 0),R_([ae(),(0,V.onChange)(Wp.prototype._scaleChanged),ai("Scale",[.25,Wp.MaxCanvasScale],.001,a=>({disabled:()=>a.mode==="custom"}))],Bc.prototype,"scale",void 0),Bc=Wp=R_([zi("Renderer")],Bc);class oA extends Si{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var t;const i=super.toJSON(e);return i.activeCamera=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera.toJSON(),i}fromJSON(e,t){var i;return e.activeCamera&&((i=this._viewer)===null||i===void 0||i.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}oA.PluginType="CameraUiPlugin";var xL={create:a=>{let e="button"+(a.type?" "+a.type:""),t=lr.createDiv(e,a.text);return t.addEventListener("click",a.onClick),t}};let ml={createElement:(a,e,t,i)=>{let r=document.createElement(a);if(e&&(r.className=e),t&&(r.innerHTML=t),i)for(let s in i)r.setAttribute(s,i[s]);return r},createDiv:(a,e,t)=>ml.createElement("div",a,e,t),createDomTree:a=>{if(!a||!a.hasOwnProperty("dom"))return a;let e=a.dom;if(a.children)for(let t in a.children)a.children[t]&&e.appendChild(ml.createDomTree(a.children[t]));return e},removeElement:a=>{a==null||a.parentNode.removeChild(a)},appendToBody:a=>{document.body.appendChild(a)},makeIconHTML:a=>{let e="";return a=="ok"&&(e="#tick"),a=="error"&&(e="#cancel"),a=="info"&&(e="#info-button"),a=="caution"&&(e="#danger"),a=="min"&&(e="#line"),a=="close"&&(e="#close"),`<svg class="icon ${a}"><use xlink:href="${e}" /></svg>`},makeNftContent:a=>{let e=null;if(a.type){let t=null;t=typeof a.content=="string"?ml.createDiv("inner-content",a.content):ml.createDomTree({dom:ml.createDiv("inner-content"),children:[a.content]}),e=a.type=="text"?ml.createDomTree({dom:ml.createDiv("content text"),children:[t]}):ml.createDomTree({dom:ml.createDiv("content"),children:[ml.createDiv("state",ml.makeIconHTML(a.type)),t]})}else typeof a.content=="string"&&(e=ml.createDiv("content",a.content));return e},standardizeButtons:(a,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:a.close.bind(a,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:a.close.bind(a,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let i in t)!t[i].onClick&&(t[i].onClick=a.close.bind(a,t[i].id));return t},makeButtons:a=>{let e=[];if(a)for(let t in a)e.push(xL.create({text:a[t].text?a[t].text:"OK",type:a[t].normal?null:"main",onClick:a[t].onClick}));return ml.createDomTree({dom:ml.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:a=>{let e=t=>{for(let i in a)if(a[i].key===t.keyCode)return void a[i].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:a=>{window.removeEventListener("keydown",a)}};var lr=ml,Ks=__webpackgi_require__(476),ho={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let oh={};oh.overlay_in=[new Ks.Frame(ho["wwise-overlay-in-1"],0),new Ks.Frame(ho["wwise-overlay-in-2"],400)],oh.overlay_out=[new Ks.Frame(ho["wwise-overlay-out-1"],300)],oh.pop_in=[new Ks.Frame(ho["wwise-pop-in-1"],0),new Ks.Frame(ho["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Ks.Frame(ho["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Ks.Frame(ho["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],oh.pop_out=[new Ks.Frame(ho["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],oh.flip_in=[new Ks.Frame(ho["wwise-flip-in-1"],0),new Ks.Frame(ho["wwise-flip-in-2"],500)],oh.flip_out=[new Ks.Frame(ho["wwise-flip-out-1"],400)],oh.min_in=[new Ks.Frame(ho["wwise-min-in-1"],0),new Ks.Frame(ho["wwise-min-in-2"],350)],oh.min_out=[new Ks.Frame(ho["wwise-min-out-1"],400)];let WI=["top","bottom","left","right"];for(let a in WI){let e=WI[a];oh[e+"_in"]=[new Ks.Frame(ho["wwise-"+e+"-in-1"],0),new Ks.Frame(ho["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],oh[e+"_out"]=[new Ks.Frame(ho["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var R1=oh;let EL={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class UC{static create(e,t){let i=e.getElementsByClassName("title")[0];i&&(i=i.innerHTML);let r=e.getElementsByClassName("content")[0];return r&&(r=r.innerHTML),lr.removeElement(e),t.title=i,t.content=r,new UC(t)}constructor(e){this.options=JSON.parse(JSON.stringify(EL));for(let u in e)e[u]!=null&&(this.options[u]=e[u]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let u=document.getElementsByClassName("wwise-overlay");u.length?(this.overlay=u[0],this.hasOverlay=!0):(this.overlay=lr.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let i="content";if(this.options.topbar){let u=[];this.options.topbar.showMin&&(u.push(lr.createDiv(null,lr.makeIconHTML("min"))),u[u.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(u.push(lr.createDiv(null,lr.makeIconHTML("close"))),u[u.length-1].addEventListener("click",this.close.bind(this,void 0)));let h=null;h=typeof this.options.title=="string"?lr.createDiv("title",this.options.title):lr.createDomTree({dom:lr.createDiv("title"),children:[this.options.title]}),this.topbar=lr.createDomTree({dom:lr.createDiv("topbar"),children:[{dom:lr.createDiv("control"),children:u.map(f=>({dom:f}))},{dom:h},{dom:lr.createDiv("clear")}]})}else i+=" no-topbar";typeof this.options.content=="string"?this.content=lr.createDomTree({dom:lr.createDiv(i,this.options.content)}):this.content=lr.createDomTree({dom:lr.createDiv(i),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=lr.createDomTree({dom:lr.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let r=lr.createDiv("wwise-wrapper");this.options.zIndex&&(r.style.zIndex=this.options.zIndex),this.wrapper=lr.createDomTree({dom:r,children:[this.window]}),this.dom=lr.createDomTree({dom:lr.createDiv(),children:[this.wrapper]});let s=this.options.position.split(" "),o=-50,l=-50;if(s[0]=="left"?(o=0,this.wrapper.classList.add("left")):s[0]=="right"?(o=-100,this.wrapper.classList.add("right")):s[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=s[0],s[1]=="top"?(l=0,this.wrapper.classList.add("top")):s[1]=="bottom"?(l=-100,this.wrapper.classList.add("bottom")):s[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${o}%, ${l}%)`,this.options.style)for(let u in this.options.style)this.window.style[u]=this.options.style[u];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(i=>{this.promiseResolve=i}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let i=[new Ks.Queue(this.wrapper,R1[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&i.push(new Ks.Queue(this.overlay,R1.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(i).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let i=[new Ks.Queue(this.wrapper,R1[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&i.push(new Ks.Queue(this.overlay,R1.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(i).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(lr.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),lr.appendToBody(this.dom)}removeDoms(){lr.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(lr.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},i=window.getComputedStyle(this.wrapper),r=this.options.draggable,s=parseFloat(i.left),o=parseFloat(i.top);if(i.left.indexOf("%")!=-1){s=i.left,s=s.substr(0,s.length-1),s=parseInt(s);let l=window,u=document,h=u.documentElement,f=u.getElementsByTagName("body")[0];s=s*(l.innerWidth||h.clientWidth||f.clientWidth)/100}if(i.top.indexOf("%")!=-1){o=i.top,o=o.substr(0,o.length-1),o=parseInt(o);let l=window,u=document,h=u.documentElement,f=u.getElementsByTagName("body")[0];o=o*(l.innerHeight||h.clientHeight||f.clientHeight)/100}r!=1&&r!="horizontal"||(this.wrapper.style.left=s+t.x+"px"),r!=1&&r!="vertical"||(this.wrapper.style.top=o+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var SL=UC,NC=class{constructor(a){let e=this.options=a;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new SL(t)}constructContent(a){let e=lr.createDiv("modal"),t=lr.createDomTree({dom:lr.createDiv("main "+a.type),children:[lr.createDiv(null,lr.makeIconHTML(a.type)),lr.createDiv("title",a.title),lr.createDiv("text",a.text)]});this.buttonArr=lr.standardizeButtons(this,a);let i=lr.makeButtons(this.buttonArr),r=null;a.content&&(r=typeof a.content=="string"?lr.createDiv(null,a.content):a.content);let s=null;return i.innerHTML&&(s=lr.createDomTree({dom:lr.createDiv("operation "+a.type),children:[i]})),r||s||t.classList.add("no-op"),lr.createDomTree({dom:e,children:[t,r,s]})}open(){if(this.wwise.opened)return;let a=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=lr.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),a}close(a){if(this.wwise.opened)return this.value=a,lr.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let CL={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},ML={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var D1=__webpackgi_require__(513),lA={};D1.Z&&D1.Z.locals&&(lA.locals=D1.Z.locals);var FC,jC=0,uv={};uv.styleTagTransform=gc(),uv.setAttributes=tu(),uv.insert=function(a,e){(e.target||document.head).appendChild(a)},uv.domAPI=mc(),uv.insertStyleElement=Lu(),lA.use=function(a){return uv.options=a||{},jC++||(FC=fc()(D1.Z,uv)),lA},lA.unuse=function(){jC>0&&!--jC&&(FC(),FC=null)};var TL=lA;class zC extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},lr.appendToBody=t=>{t.style.zIndex="100",e.container.appendChild(t)},lr.makeIconHTML=t=>"",TL.use({target:e.container}),e.alert=async t=>{const i=t==null?void 0:t.split(":")[0],r=new NC({type:"info",title:i??"&ndsp;",text:(t==null?void 0:t.replace(i+":","").replace(/(\r?\n)/gm,"<br>"))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return r.open(),r.getPromise()},e.confirm=async t=>{const i=t==null?void 0:t.split(":")[0],r=new NC({type:"info",title:i??"&ndsp;",text:(t==null?void 0:t.replace(i||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return r.open(),await r.getPromise()==="yes"},e.prompt=async(t,i,r=!0)=>{const s=t==null?void 0:t.split(":")[0],o=new class{constructor(l){this.options=JSON.parse(JSON.stringify(CL));for(let g in l)l[g]!=null&&(this.options[g]=l[g]);let u=this.options,h=JSON.parse(JSON.stringify(ML));for(let g in h)u.hasOwnProperty(g)&&(h[g]=u[g]);let f=[];u.showCancel&&f.push({key:27,text:u.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),f.push({key:13,text:u.okText,onClick:this.handleOk.bind(this)}),h.buttons=f,this.input=lr.createElement("input","input",null,{placeholder:u.placeholder}),this.error=lr.createDiv("error"),h.content=lr.createDomTree({dom:lr.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new NC(h)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},l=>{this.error.innerText=l}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let l=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((u,h)=>{this.promiseResolve=u,this.promiseReject=h}),l}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:s??"&ndsp;",placeholder:i??"",showCancel:r,animation:"overlay",text:(t==null?void 0:t.replace(s||"","").replace(":",""))||""});return o.open(),await o.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}zC.PluginType="WindowiseDialogPlugin";var B1=__webpackgi_require__(729),cA={};B1.Z&&B1.Z.locals&&(cA.locals=B1.Z.locals);var VC,GC=0,hv={};hv.styleTagTransform=gc(),hv.setAttributes=tu(),hv.insert=function(a,e){(e.target||document.head).appendChild(a)},hv.domAPI=mc(),hv.insertStyleElement=Lu(),cA.use=function(a){return hv.options=a||{},GC++||(VC=fc()(B1.Z,hv)),cA},cA.unuse=function(){GC>0&&!--GC&&(VC(),VC=null)};var IL=cA;function XI(){IL.use(),oM.use()}async function qI(a,e=void 0,t=[]){var i,r;Cp.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>a.container});const s=(0,V.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),o=(0,V.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,V.getUrlQueryParam)("logo-img")&&(o.style.backgroundImage=`url(${(0,V.getUrlQueryParam)("logo-img")})`),o.onclick=()=>{window.open((0,V.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const l=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;a.container.appendChild(o),Cp(o,{placement:"right",content:"Powered by WebGi SDK"});const u=(0,V.createDiv)({innerHTML:l,id:"fsToggle",classList:["round-button"],addToBody:!1});u.dataset.tippyContent="Full-Screen",(i=a.getPlugin(Mo))===null||i===void 0||i.addEventListener("enter",()=>{u.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,u.dataset.tippyContent="Exit Full-Screen"}),(r=a.getPlugin(Mo))===null||r===void 0||r.addEventListener("exit",()=>{u.innerHTML=l,u.dataset.tippyContent="Full-Screen"}),u.onclick=()=>{var R;(R=a.getPlugin(Mo))===null||R===void 0||R.toggle(a.container)},a.container.appendChild(u),Cp(u,{placement:"left"});const h=(0,V.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});a.container.appendChild(h);const f=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var R;if(!await a.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const I=E.map(S=>a.getPlugin(S));for(const S of I)await((R=S==null?void 0:S.resetDefaults)===null||R===void 0?void 0:R.call(S))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await a.confirm("Clear scene: Are you sure you want to clear the scene?")&&a.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var R;await a.fitToView((R=a.getPlugin(fr))===null||R===void 0?void 0:R.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{a.getPlugin(Ir)&&(a.getPlugin(Ir).viewLooping=!a.getPlugin(Ir).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var R;(R=a.getPlugin(tn))===null||R===void 0||R.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const R=a.scene.activeCamera.controls;R&&R.autoRotate!==void 0&&(R.autoRotate=!R.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const R=a.getPlugin(Ol);R?await R.downloadSnapshot():a.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const R=a.getPlugin(td);R?await(R==null?void 0:R.downloadSceneGlb()):a.console.error("AssetExporterPlugin not added")}}];for(const R of f){const I=(0,V.createDiv)({innerHTML:R.icon,id:R.id,classList:["button-bar-button","util-button"],addToBody:!1});I.dataset.tippyContent=R.tooltip,I.onclick=()=>{R.toggle&&I.classList.toggle("button-bar-selected-box"),R.onclick()},h.appendChild(I)}gP(Cp(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const g=a.getPlugin(fr),_=a.getPlugin(us);for(const[R,I]of Object.entries(e??{})){const S=t.find(O=>O.title===R);S?S.plugins.push(...I):t.push({title:R,plugins:[...I]})}let A=t[2],x=[];const E=t.reduce((R,I)=>R.concat(I.plugins),[]);function T(R){var I;A=R,g&&(g.enabled=!0),_&&(["Plugins"].includes(A.title)?_.enable("modesUi"):_.disable("modesUi")),x=[];for(const S of E){const O=a.getPlugin(S);if(!(O!=null&&O.uiConfig))continue;const k=R.plugins.includes(S);(0,V.safeSetProperty)(O.uiConfig,"hidden",!k,!0),k&&x.push(O)}for(const S of t)(I=S.div)===null||I===void 0||I.classList[A!==S?"remove":"add"]("mode-button-selected","button-bar-selected");a.getPlugin(P_).refreshPluginsEnabled()}for(const R of t){const I=(0,V.createDiv)({innerHTML:R.title,classList:["mode-button","button-bar-button"]});I.onclick=()=>{T(R)},R.div=I,s.appendChild(I)}T(t[0]),window.webgi_setEditorMode=T,window.webgi_editorModes=t,g==null||g.addEventListener("selectedObjectChanged",()=>{g!=null&&g.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(A.title)&&T(t.find(R=>R.plugins.includes(fr)))})}class HC extends Si{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Color Scheme",type:"dropdown",children:["black","white","blue"].map(e=>({label:e})),getValue:()=>{var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("TweakpaneUi"))===null||t===void 0?void 0:t.colorMode},setValue:e=>{var t;const i=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("TweakpaneUi");i&&(i.colorMode=e)}}),()=>({label:"Shadow type",type:"dropdown",children:[["Basic",p._MY],["PCF",p._iA],["PCFSoft",p.ntZ],["VSM",p.dwk]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)===null||e===void 0?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;(t=this._viewer)===null||t===void 0||t.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var t,i;await((t=this._viewer)===null||t===void 0?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("rgbm",!((i=this._viewer)===null||i===void 0)&&i.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var t,i;await((t=this._viewer)===null||t===void 0?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("msaa",!((i=this._viewer)===null||i===void 0)&&i.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var t,i;await((t=this._viewer)===null||t===void 0?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("depthPrepass",!((i=this._viewer)===null||i===void 0)&&i.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var t,i;await((t=this._viewer)===null||t===void 0?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,V.setUrlQueryParam)("debug",!((i=this._viewer)===null||i===void 0)&&i.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)===null||e===void 0?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var e,t;const i=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ut))===null||t===void 0?void 0:t.storage;if(i instanceof Storage)i.clear();else if(i instanceof Cache){const r=await i.keys();await Promise.all(r.map(async s=>i.delete(s)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var e;const t=new Set;(e=this._viewer)===null||e===void 0||e.scene.modelRoot.traverse(i=>i.geometry&&t.add(i.geometry)),t.forEach(i=>xd(i))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var e;const t=new Set;(e=this._viewer)===null||e===void 0||e.scene.modelRoot.traverse(i=>i.geometry&&t.add(i.geometry)),t.forEach(i=>{const r=new p.Pa4;i.center(r),r.negate();const s=i.userData.__appliedMeshes;s||console.error("No meshes found for geometry",i),s==null||s.forEach(o=>{o.updateMatrix(),o.position.copy(r).applyMatrix4(o.matrix),o.setDirty&&o.setDirty()})})}}]}}}HC.PluginType="ExtrasUiPlugin1";class QC extends p.Tme{constructor(e){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=Wa("Widget",this),this.object=e,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(e),this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(e){var t,i;return this.object&&this.detach(),this.object=e,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((i=(t=this.object.uiConfig)===null||t===void 0?void 0:t.children)===null||i===void 0||i.push(this.uiConfig)),this.visible=!0),this}detach(){var e,t,i,r;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const s=(t=(e=this.object.uiConfig)===null||e===void 0?void 0:e.children)===null||t===void 0?void 0:t.indexOf(this.uiConfig);s!==void 0&&s>=0&&((r=(i=this.object.uiConfig)===null||i===void 0?void 0:i.children)===null||r===void 0||r.splice(s,1))}this.object=void 0,this.visible=!1}return this}}(function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)})([Ot()],QC.prototype,"visible",void 0);class WC extends QC{constructor(e){super(e),this.light=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}var XC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class Xp extends WC{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this._v1=new p.Pa4,this._v2=new p.Pa4,this._v3=new p.Pa4,this.color=i,t!==void 0&&(this.size=t);let r=new hb;this.material=new Bu({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new rS(r,this.material),this.add(this.lightPlane),r=new hb,r.setPositions([0,0,0,0,0,1]),this.targetLine=new rS(r,this.material),this.add(this.targetLine),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){var e;this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set((e=this.color)!==null&&e!==void 0?e:this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(e){return e.isDirectionalLight}static Create(e){return new Xp(e)}}XC([(0,V.onChange)(Xp.prototype.update)],Xp.prototype,"material",void 0),XC([(0,V.onChange)(Xp.prototype.update),ai(void 0,[.1,20],.01)],Xp.prototype,"lineWidth",void 0),XC([(0,V.onChange)(Xp.prototype.update),ai(void 0,[.01,10],.01)],Xp.prototype,"size",void 0);var qC=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class qp extends WC{constructor(e,t,i){super(e),this.lineWidth=5,this.size=.5,this.color=i,t!==void 0&&(this.size=t);const r=new X_(new p.xo$(.5,4,2));this.material=new Bu({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new q_(r,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(s=>{s.userData.__keepShadowDef=!0,s.castShadow=!1,s.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){var e;this.light&&this.lightSphere&&(this.material.color.set((e=this.color)!==null&&e!==void 0?e:this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(e){return e.isPointLight}static Create(e){return new qp(e)}}qC([(0,V.onChange)(qp.prototype.update)],qp.prototype,"material",void 0),qC([(0,V.onChange)(qp.prototype.update),ai(void 0,[.1,20],.01)],qp.prototype,"lineWidth",void 0),qC([(0,V.onChange)(qp.prototype.update),ai(void 0,[.01,10],.01)],qp.prototype,"size",void 0);var YI=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class dv extends WC{constructor(e,t,i){super(e),this.lineWidth=5,this._v1=new p.Pa4,this.color=i;let r=new $d;const s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,u=32;o<u;o++,l++){const h=o/u*Math.PI*2,f=l/u*Math.PI*2;s.push(Math.cos(h),Math.sin(h),1,Math.cos(f),Math.sin(f),1)}r.setPositions(s),this.material=new Bu({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new Xw(r,this.material),this.add(this.cone),r=new hb,r.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(o=>{o.userData.__keepShadowDef=!0,o.castShadow=!1,o.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){var e;if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set((e=this.color)!==null&&e!==void 0?e:this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(e){return e.isSpotLight}static Create(e){return new dv(e)}}YI([(0,V.onChange)(dv.prototype.update)],dv.prototype,"material",void 0),YI([(0,V.onChange)(dv.prototype.update),ai(void 0,[.1,20],.01)],dv.prototype,"lineWidth",void 0);class PL extends QC{constructor(e){super(e),this.camera=e,this.traverse(t=>{t.userData.__keepShadowDef=!0,t.castShadow=!1,t.receiveShadow=!1})}}class YC extends PL{constructor(e){super(e),this._vector=new p.Pa4,this._camera=new p.V1s;const t=new $d,i=new Bu({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:r,colors:s,pointMap:o}=function(){const _=[],A=[],x={};function E(R,I){T(R),T(I)}function T(R){_.push(0,0,0),A.push(0,0,0),x[R]===void 0&&(x[R]=[]),x[R].push(_.length/3-1)}return E("n1","n2"),E("n2","n4"),E("n4","n3"),E("n3","n1"),E("f1","f2"),E("f2","f4"),E("f4","f3"),E("f3","f1"),E("n1","f1"),E("n2","f2"),E("n3","f3"),E("n4","f4"),E("p","n1"),E("p","n2"),E("p","n3"),E("p","n4"),E("u1","u2"),E("u2","u3"),E("u3","u1"),E("c","t"),E("p","c"),E("cn1","cn2"),E("cn3","cn4"),E("cf1","cf2"),E("cf3","cf4"),{vertices:_,colors:A,pointMap:x}}();t.setPositions(r),t.setColors(s),this.line=new Xw(t,i),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=o,this.update();const l=new p.Ilk(16755200),u=new p.Ilk(16711680),h=new p.Ilk(43775),f=new p.Ilk(16777215),g=new p.Ilk(3355443);this.setColors(l,u,h,f,g)}setColors(e,t,i,r,s){const o=this.line.geometry,l=o.getAttribute("instanceColorStart"),u=o.getAttribute("instanceColorEnd");function h(f,g){l.setXYZ(f/2,g.r,g.g,g.b),u.setXYZ(f/2,g.r,g.g,g.b)}h(0,e),h(2,e),h(4,e),h(6,e),h(8,e),h(10,e),h(12,e),h(14,e),h(16,e),h(18,e),h(20,e),h(22,e),h(24,t),h(26,t),h(28,t),h(30,t),h(32,i),h(34,i),h(36,i),h(38,r),h(40,s),h(42,s),h(44,s),h(46,s),h(48,s),l.needsUpdate=!0,u.needsUpdate=!0}update(){if(!this.camera)return;const e=this.line.geometry,t=this.pointMap,{_camera:i,_vector:r}=this;i.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Zs("c",t,e,i,0,0,-1,r),Zs("t",t,e,i,0,0,1,r),Zs("n1",t,e,i,-1,-1,-1,r),Zs("n2",t,e,i,1,-1,-1,r),Zs("n3",t,e,i,-1,1,-1,r),Zs("n4",t,e,i,1,1,-1,r),Zs("f1",t,e,i,-1,-1,1,r),Zs("f2",t,e,i,1,-1,1,r),Zs("f3",t,e,i,-1,1,1,r),Zs("f4",t,e,i,1,1,1,r),Zs("u1",t,e,i,.7,1.1,-1,r),Zs("u2",t,e,i,-.7,1.1,-1,r),Zs("u3",t,e,i,0,2,-1,r),Zs("cf1",t,e,i,-1,0,1,r),Zs("cf2",t,e,i,1,0,1,r),Zs("cf3",t,e,i,0,-1,1,r),Zs("cf4",t,e,i,0,1,1,r),Zs("cn1",t,e,i,-1,0,-1,r),Zs("cn2",t,e,i,1,0,-1,r),Zs("cn3",t,e,i,0,-1,-1,r),Zs("cn4",t,e,i,0,1,-1,r),e.getAttribute("instanceStart").needsUpdate=!0,e.getAttribute("instanceEnd").needsUpdate=!0,e.computeBoundingBox(),e.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(e){return e.isCamera}static Create(e){return new YC(e)}}function Zs(a,e,t,i,r,s,o,l){l.set(r,s,o).unproject(i);const u=e[a];if(u!==void 0){const h=t.getAttribute("instanceStart"),f=t.getAttribute("instanceEnd");for(let g=0,_=u.length;g<_;g++){const A=Math.floor(u[g]/2);(u[g]%2==0?h:f).setXYZ(A,l.x,l.y,l.z)}}}class pv extends Si{setDirty(){var e,t;(e=this.widgets)===null||e===void 0||e.forEach(i=>i.visible=this.enabled),(t=this._viewer)===null||t===void 0||t.setDirty()}constructor(e=!0){super(),this.enabled=!0,this.helpers=[Xp,dv,qp,YC],this.toJSON=null,this._addSceneObject=t=>{const i=t.object;this._createWidgets(i==null?void 0:i.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=e}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(e){return e.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(t=>t.dispose&&t.dispose()),this.widgets=[],super.onRemove(e)}refresh(){var e;this._createWidgets((e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot)}_createWidgets(e){e==null||e.traverse(t=>{const i=this.widgets.find(r=>r.object===t);if(i)return void(i.update&&i.update());this.helpers.filter(r=>r.Check(t)).forEach(r=>{var s;const o=r.Create(t);o.visible=this.enabled,this.widgets.push(o),(s=this._viewer)===null||s===void 0||s.scene.addWidget(o)})})}}pv.PluginType="WidgetsPlugin",function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);s>3&&o&&Object.defineProperty(e,t,o)}([(0,V.onChange)(pv.prototype.setDirty)],pv.prototype,"enabled",void 0);var RL=Ju({defaultModifiers:[Ap,U0,N0,su]}),DL=__webpackgi_require__(388),BL=__webpackgi_require__.n(DL);function OL(a){const e=[];a.traverse(r=>{r.geometry&&e.push(r)});const t={},i={};e.forEach(r=>{var s;if(!t[r.geometry.uuid]){const u=r.geometry.toJSON().data,h=u?BL()({a:u.attributes||{},b:u.index||[]}):"";t[r.geometry.uuid]=h}const o=t[r.geometry.uuid],l=(s=i[o])!==null&&s!==void 0?s:i[o]=[];l.includes(r)||l.push(r)}),Object.values(i).forEach(r=>{if(r.length<2)return;const s=r[0].geometry;r.forEach((o,l)=>{l<1||(o.geometry.dispose(),o.geometry=s)})})}const Yp=new p.Pa4,fv=new p.Pa4,O1=new p.Pa4,KC=new p.Pa4,L1=new p.Pa4,D_=new p.Pa4;let ZC=1;const LL=new p.Pa4(0,1,0);class kL extends _m{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new p.Pa4(0,0,0);const i=this.update;this.update=()=>this._update(i)}_update(e){this.target.add(this.targetOffset),Yp.copy(this.object.position).sub(this.target),ZC=Yp.length(),D_.copy(this.target);const t=e();return D_.sub(this.target),Yp.copy(this.object.position).sub(this.target),ZC/=Yp.length(),this.target.add(D_),this.object.position.copy(this.target).add(Yp),Yp.normalize(),fv.crossVectors(LL,Yp).normalize(),O1.crossVectors(Yp,fv).normalize(),KC.crossVectors(fv,O1).normalize().negate(),fv.length()>.1&&this.object.up.crossVectors(Yp.clone().normalize(),fv),this.enablePan&&(L1.set(0,0,0).addScaledVector(fv,D_.x).addScaledVector(O1,D_.y).addScaledVector(KC,D_.z),this.targetOffset.add(L1),this.targetOffset.multiplyScalar(1/ZC)),L1.set(0,0,0).addScaledVector(fv,-this.targetOffset.x).addScaledVector(O1,-this.targetOffset.y).addScaledVector(KC,-this.targetOffset.z),this.object.lookAt(L1.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class k1 extends V.SimpleEventDispatcher{_setOptions(e){var t,i;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(t=k1.GetSupportedMimeTypes([],["h264"],!0))!==null&&t!==void 0?t:k1.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((i=this._options.mimeType)===null||i===void 0)&&i.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=r=>{var s;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const o=new Blob(this._currentRecording,{type:this._options.mimeType});(s=this._recordingCallback)===null||s===void 0||s.call(this,o)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=r=>{var s;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((s=this._recorder)===null||s===void 0||s.pause())},this._onresume=r=>{if(!this.stepMode)return;const s=()=>{var l;this._state==="recording"&&((l=this._recorder)===null||l===void 0||l.pause())},o=Math.min(this._resumeSyncTime-(0,V.now)(),0)+1e3/this._options.frameRate;o>0?(0,V.timeout)(o).then(s):s()},this._onpause=r=>{},this._ondataavailable=r=>{r.data&&r.data.size>0&&this._currentRecording.push(r.data)},this._onerror=r=>{this._state="error",this._console.error(r),this.dispatchEvent({type:"error",error:r}),this._recorder=void 0},this._canvas=e;const i=t==null?void 0:t.mimeType;this._options={mimeType:i||"auto",frameRate:30,stepMode:!1},this._setOptions(t||this._options)}isRecording(){return this._state==="recording"}start(){var e,t,i;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const r={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=r.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const s=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),o=(t=s.getVideoTracks())===null||t===void 0?void 0:t[0];this._track=o,this._recorder=new window.MediaRecorder(s,r),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(i=this._recorder)===null||i===void 0||i.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async s=>{const o=await(s==null?void 0:s.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=o,this._state="recording",this._onstart({})}).catch(s=>{this._onerror({detail:s})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,V.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([r,s])=>await(await fetch(s)).blob())),i=[];for(let r=0;r<e.length;r++){const s=await this._imgDirectory.getFileHandle(e[r][0],{create:!0});i.push((0,V.writeFile)(s,t[r]))}await Promise.all(i)}static GetSupportedMimeTypes(e,t,i=!1){if(!window.MediaRecorder)return i?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter(l=>!e||e.length<1||e.includes(l)),s=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(l=>!t||t.length<1||t.includes(l)),o=[];return r.forEach(l=>{const u=`video/${l}`;s.forEach(h=>{[`${u};codecs=${h}`,`${u};codecs:${h}`,`${u};codecs=${h.toUpperCase()}`,`${u};codecs:${h.toUpperCase()}`,`${u}`].forEach(f=>{MediaRecorder.isTypeSupported(f)&&o.push(f)})})}),i?o.length>0?o[0]:void 0:o}}class UL extends Y_{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new p.cJO(1,0))}}function JC(a,e,t){var i,r;let s=Array.from(((i=a.access)!==null&&i!==void 0?i:"").split(".")),o=(r=a.targetObject)!==null&&r!==void 0?r:e;const l=s.pop();if(!l||l.length===0)return{key:void 0,tar:o};if((t=t??(e==null?void 0:e._animGetters))&&s[0]in t){const u=t[s[0]](s);u?(o=u.tar,s=s.slice(u.i+1)):o=u}return o=function(u,h,f=!1){for(typeof u=="string"&&(u=u.split("."));u.length>0;){if(!h)return h;const g=u.splice(0,1)[0];if(!(g.length<1))if(Array.isArray(h))h=h[parseInt(g)];else{if(typeof h!="object"||!(g in h)){if(f)throw new Error("invalid access, check "+g+" in "+h);return}h=h[g]}}return h}(s,o),o&&!(l in o)?(console.error("invalid key",l,o,e,a),{key:void 0,tar:o}):{key:l,tar:o}}async function $C(a,e,t){var i,r,s,o;const{key:l,tar:u}=JC(e,a),h=e.animSet?[ZI(a,e.animSet,t,(i=e.animSetParallel)!==null&&i!==void 0&&i)]:[];if(l&&u){const f=(o=e.updater)!==null&&o!==void 0?o:[],g=async()=>g0(u,l,{from:e.from,to:e.to,ease:typeof e.ease=="string"?el[e.ease]:e.ease,duration:e.duration,...e.options,onUpdate:_=>{var A,x;(x=(A=e.options).onUpdate)===null||x===void 0||x.call(A,_),f.forEach(E=>{var T;return(T=t[E])===null||T===void 0?void 0:T.call(t)})}},void 0,!1);e.delay?h.push((0,V.timeout)(e.delay).then(g)):h.push(g())}else(e.duration||e.delay)&&h.push((0,V.timeout)(((r=e.delay)!==null&&r!==void 0?r:0)+((s=e.duration)!==null&&s!==void 0?s:0)));return h.length===1?h[0]:Promise.all(h)}async function KI(a,e,t){return typeof e.animate=="function"?e.animate():$C(a,e,t)}async function ZI(a,e,t,i=!1){if(i)return Promise.all(e.map(async r=>KI(a,r,t)));for(const r of e)await KI(a,r,t)}const eM=new TextEncoder,NL={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},FL=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class jL{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:i,service:r,region:s,cache:o,retries:l,initRetryMs:u}){if(e==null)throw new TypeError("accessKeyId is a required option");if(t==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=i,this.service=r,this.region=s,this.cache=o||new Map,this.retries=l??10,this.initRetryMs=u||50}async sign(e,t){if(e instanceof Request){const{method:s,url:o,headers:l,body:u}=e;(t=Object.assign({method:s,url:o,headers:l},t)).body==null&&l.has("Content-Type")&&(t.body=u!=null&&l.has("X-Amz-Content-Sha256")?u:await e.clone().arrayBuffer()),e=o}const i=new JI(Object.assign({url:e},t,this,t&&t.aws)),r=Object.assign({},t,await i.sign());delete r.aws;try{return new Request(r.url.toString(),r)}catch(s){if(s instanceof TypeError)return new Request(r.url.toString(),Object.assign({duplex:"half"},r));throw s}}async fetch(e,t){for(let i=0;i<=this.retries;i++){const r=fetch(await this.sign(e,t));if(i===this.retries)return r;const s=await r;if(s.status<500&&s.status!==429)return s;await new Promise(o=>setTimeout(o,Math.random()*this.initRetryMs*Math.pow(2,i)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class JI{constructor({method:e,url:t,headers:i,body:r,accessKeyId:s,secretAccessKey:o,sessionToken:l,service:u,region:h,cache:f,datetime:g,signQuery:_,appendSessionToken:A,allHeaders:x,singleEncode:E}){if(t==null)throw new TypeError("url is a required option");if(s==null)throw new TypeError("accessKeyId is a required option");if(o==null)throw new TypeError("secretAccessKey is a required option");let T,R;this.method=e||(r?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(i||{}),this.body=r,this.accessKeyId=s,this.secretAccessKey=o,this.sessionToken=l,u&&h||([T,R]=function(O,k){const{hostname:N,pathname:H}=O;if(N.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(N.endsWith(".backblazeb2.com")){const ue=N.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return ue!=null?["s3",ue[1]]:["",""]}const X=N.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[te,re]=(X||["",""]).slice(1,3);if(re==="us-gov")re="us-gov-west-1";else if(re==="s3"||re==="s3-accelerate")re="us-east-1",te="s3";else if(te==="iot")te=N.startsWith("iot.")?"execute-api":N.startsWith("data.jobs.iot.")?"iot-jobs-data":H==="/mqtt"?"iotdevicegateway":"iotdata";else if(te==="autoscaling"){const ue=(k.get("X-Amz-Target")||"").split(".")[0];ue==="AnyScaleFrontendService"?te="application-autoscaling":ue==="AnyScaleScalingPlannerFrontendService"&&(te="autoscaling-plans")}else re==null&&te.startsWith("s3-")?(re=te.slice(3).replace(/^fips-|^external-1/,""),te="s3"):te.endsWith("-fips")?te=te.slice(0,-5):re&&/-\d$/.test(te)&&!/-\d$/.test(re)&&([te,re]=[re,te]);return[NL[te]||te,re]}(this.url,this.headers)),this.service=u||T||"",this.region=h||R||"us-east-1",this.cache=f||new Map,this.datetime=g||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=_,this.appendSessionToken=A||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const I=this.signQuery?this.url.searchParams:this.headers;if(I.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&I.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(O=>x||!FL.has(O)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(O=>O+":"+(O==="host"?this.url.host:(this.headers.get(O)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||I.has("X-Amz-Expires")||I.set("X-Amz-Expires","86400"),I.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),I.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),I.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");E||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=eP(this.encodedPath);const S=new Set;this.encodedSearch=[...this.url.searchParams].filter(([O])=>{if(!O)return!1;if(this.service==="s3"){if(S.has(O))return!1;S.add(O)}return!0}).map(O=>O.map(k=>eP(encodeURIComponent(k)))).sort(([O,k],[N,H])=>O<N?-1:O>N?1:k<H?-1:k>H?1:0).map(O=>O.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let i=this.cache.get(t);if(!i){const r=await uA("AWS4"+this.secretAccessKey,e),s=await uA(r,this.region),o=await uA(s,this.service);i=await uA(o,"aws4_request"),this.cache.set(t,i)}return tM(await uA(i,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,tM(await $I(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=tM(await $I(this.body||""))}return e}}async function uA(a,e){const t=await crypto.subtle.importKey("raw",typeof a=="string"?eM.encode(a):a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",t,eM.encode(e))}async function $I(a){return crypto.subtle.digest("SHA-256",typeof a=="string"?eM.encode(a):a)}function tM(a){return Array.prototype.map.call(new Uint8Array(a),e=>("0"+e.toString(16)).slice(-2)).join("")}function eP(a){return a.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var hA,mv=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let gl=hA=class extends Si{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[Qb],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1,this.fetchFunction=fetch}connect(){this._connected&&this.disconnect(),this._client=new jL({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var a,e;(e=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||e===void 0||e.call(a,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(a){return this.serializeSettings?super.toJSON(a):{type:this.constructor.PluginType}}async onAdded(a){await super.onAdded(a);const e=a.getPlugin(Qb);e.actions.exportFile=async(t,i,r)=>{if(!this._connected)return void await e.defaultActions.exportFile(t,i);const s=(0,V.pathJoin)([this.endpointURL,this.pathPrefix,i]),o=await this.fetch(s,{method:"PUT",body:t},r);if(!o.ok)return a.console.error("Error uploading file",o),void await e.defaultActions.exportFile(t,i);this.dispatchEvent({type:"fileUpload",name:i,blob:t,response:o,path:s}),a.console.log("File uploaded",o)}}async fetch(a,e,t){if(!this._client)throw new Error("Not connected");for(let i=0;i<=this._client.retries;i++){const r=await tP(this._client,a,e);let s=r.url.toString();hA.USE_PROXY&&s&&!s.includes(hA.PROXY_URL)&&(s=hA.PROXY_URL.replace("{path}",s));const o=(0,this.fetchFunction)(s,r);if(i===this._client.retries)return o;const l=await o;if(l.status<500&&l.status!==429)return l;await(0,V.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,i))}throw new Error("An unknown error occurred, ensure retries is not negative")}};async function tP(a,e,t){if(e instanceof Request){const{method:s,url:o,headers:l,body:u}=e;(t=Object.assign({method:s,url:o,headers:l},t)).body==null&&l.has("Content-Type")&&(t.body=u!=null&&l.has("X-Amz-Content-Sha256")?u:await e.clone().arrayBuffer()),e=o,console.warn("WebGi AWSClientPlugin: There could be a bug in chrome with cloning Request objects, see https://bugs.chromium.org/p/chromium/issues/detail?id=1360943")}const i=new JI(Object.assign({url:e},t,a,t&&t.aws)),r=Object.assign({},t,await i.sign());return delete r.aws,r}gl.PluginType="AWSClientPlugin1",gl.USE_PROXY=!1,gl.PROXY_URL="https://r2-s3-api.repalash.com/{path}",mv([ae(),Ci("Access Key ID",a=>({disabled:()=>!a.enabled||a._connected}))],gl.prototype,"accessKeyId",void 0),mv([ae(),Ci("Access Key Secret",a=>({disabled:()=>!a.enabled||a._connected}))],gl.prototype,"accessKeySecret",void 0),mv([ae(),Ci("Endpoint URL",a=>({disabled:()=>!a.enabled||a._connected}))],gl.prototype,"endpointURL",void 0),mv([ae(),Ci("Path Prefix",a=>({disabled:()=>!a.enabled}))],gl.prototype,"pathPrefix",void 0),mv([ae(),Ot("Remember",a=>({disabled:()=>!a.enabled||a._connected}))],gl.prototype,"serializeSettings",void 0),mv([Xi(void 0,a=>({label:()=>a._connected?"Disconnect":"Connect"}))],gl.prototype,"toggleConnection",void 0),gl=hA=mv([zi("S3 Connection")],gl);const zL=(()=>{let a=!1,e=!1;const t=typeof globalThis.ReadableStream=="function",i=typeof globalThis.Request=="function";return t&&i&&(e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type")),a&&!e})(),VL={Background:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(a=>({path:a}))}).assets,Environment:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(a=>({path:a}))}).assets,GemEnvironment:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(a=>({path:a}))}).assets,GemEnvironment2:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(a=>({path:a}))}).assets,GemEnvironment3:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(a=>({path:a}))}).assets,Ground:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(a=>({path:a}))}).assets,CameraViews:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(a=>({path:a}))}).assets,MaterialConfiguration:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(a=>({path:a}))}).assets,MaterialLibraries:new Zh({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(a=>({path:a}))}).assets};function iP(a,e){return e?a*(1e3/e):0}function GL(a){var e,t=a.from,i=t===void 0?0:t,r=a.velocity,s=r===void 0?0:r,o=a.min,l=a.max,u=a.power,h=u===void 0?.8:u,f=a.timeConstant,g=f===void 0?750:f,_=a.bounceStiffness,A=_===void 0?500:_,x=a.bounceDamping,E=x===void 0?10:x,T=a.restDelta,R=T===void 0?1:T,I=a.modifyTarget,S=a.driver,O=a.onUpdate,k=a.onComplete,N=a.onStop;function H(fe){return o!==void 0&&fe<o||l!==void 0&&fe>l}function X(fe){return o===void 0?l:l===void 0||Math.abs(o-fe)<Math.abs(l-fe)?o:l}function te(fe){e==null||e.stop(),e=qf(ns(ns({},fe),{driver:S,onUpdate:function(Ee){var Je;O==null||O(Ee),(Je=fe.onUpdate)===null||Je===void 0||Je.call(fe,Ee)},onComplete:k,onStop:N}))}function re(fe){te(ns({type:"spring",stiffness:A,damping:E,restDelta:R},fe))}if(H(i))re({from:i,velocity:s,to:X(i)});else{var ue=h*s+i;I!==void 0&&(ue=I(ue));var le,se,de=X(ue),ve=de===o?-1:1;te({type:"decay",from:i,velocity:s,timeConstant:g,power:h,restDelta:R,modifyTarget:I,onUpdate:H(ue)?function(fe){le=se,se=fe,s=iP(fe-le,Cy().delta),(ve===1&&fe>de||ve===-1&&fe<de)&&re({from:fe,to:de,velocity:s})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var rP=function(a){return 180*a/Math.PI},HL=function(a,e){return e===void 0&&(e=Ay),rP(Math.atan2(e.y-a.y,e.x-a.x))},QL=function(a,e){var t=!0;return e===void 0&&(e=a,t=!1),function(i){return t?i-a+e:(a=i,t=!0,e)}},WL=function(a){return a},iM=function(a){return a===void 0&&(a=WL),function(e,t,i){var r=t-i,s=-(0-e+1)*(0-a(Math.abs(r)));return r<=0?t+s:t-s}},XL=iM(),qL=iM(Math.sqrt),nP=function(a){return a*Math.PI/180},U1=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},rM=function(a){return U1(a)&&a.hasOwnProperty("z")},N1=function(a,e){return Math.abs(a-e)};function YL(a,e){if(wy(a)&&wy(e))return N1(a,e);if(U1(a)&&U1(e)){var t=N1(a.x,e.x),i=N1(a.y,e.y),r=rM(a)&&rM(e)?N1(a.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(i,2)+Math.pow(r,2))}}var KL=function(a,e,t){return e=nP(e),{x:t*Math.cos(e)+a.x,y:t*Math.sin(e)+a.y}},sP=function(a,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(a*e)/e},aP=function(a,e,t,i){return i===void 0&&(i=0),sP(a+t*(e-a)/Math.max(i,t))},ZL=function(a){a===void 0&&(a=50);var e=0,t=0;return function(i){var r=Cy().timestamp,s=r!==t?r-t:0,o=s?aP(e,i,s,a):e;return t=r,e=o,o}},JL=function(a){if(typeof a=="number")return function(i){return Math.round(i/a)*a};var e=0,t=a.length;return function(i){var r=Math.abs(a[0]-i);for(e=1;e<t;e++){var s=a[e],o=Math.abs(s-i);if(o===0)return s;if(o>r)return a[e-1];if(e===t-1)return s;r=o}}};function $L(a,e){return a/(1e3/e)}var ek=function(a,e,t){var i=e-a;return((t-a)%i+i)%i+a},oP=function(a,e){return 1-3*e+3*a},lP=function(a,e){return 3*e-6*a},cP=function(a){return 3*a},F1=function(a,e,t){return((oP(e,t)*a+lP(e,t))*a+cP(e))*a},uP=function(a,e,t){return 3*oP(e,t)*a*a+2*lP(e,t)*a+cP(e)},tk=1e-7,ik=10,rk=8,nk=.001,j1=11,z1=1/(j1-1);function sk(a,e,t,i){if(a===e&&t===i)return n0;for(var r=new Float32Array(j1),s=0;s<j1;++s)r[s]=F1(s*z1,a,t);return function(o){return o===0||o===1?o:F1(function(l){for(var u=0,h=1,f=j1-1;h!==f&&r[h]<=l;++h)u+=z1;--h;var g=u+(l-r[h])/(r[h+1]-r[h])*z1,_=uP(g,a,t);return _>=nk?function(A,x,E,T){for(var R=0;R<rk;++R){var I=uP(x,E,T);if(I===0)return x;x-=(F1(x,E,T)-A)/I}return x}(l,g,a,t):_===0?g:function(A,x,E,T,R){var I,S,O=0;do(I=F1(S=x+(E-x)/2,T,R)-A)>0?E=S:x=S;while(Math.abs(I)>tk&&++O<ik);return S}(l,u,u+z1,a,t)}(o),e,i)}}var ak=function(a,e){return e===void 0&&(e="end"),function(t){var i=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*a,r=e==="end"?Math.floor(i):Math.ceil(i);return kh(0,1,r/a)}};const ko=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function hP(){const a=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ko[255&a]+ko[a>>8&255]+ko[a>>16&255]+ko[a>>24&255]+"-"+ko[255&e]+ko[e>>8&255]+"-"+ko[e>>16&15|64]+ko[e>>24&255]+"-"+ko[63&t|128]+ko[t>>8&255]+"-"+ko[t>>16&255]+ko[t>>24&255]+ko[255&i]+ko[i>>8&255]+ko[i>>16&255]+ko[i>>24&255]).toLowerCase()}var V1,Js=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};class dA extends Si{constructor(){super(...arguments),this.enabled=!0,this.animation=new Us(()=>this._viewer),this.uiConfig=this.animation.uiConfig}async onAdded(e){function t(i){let r="",s=1;for(;s<i.length&&(r+=i[s],i[s].endsWith("\\"));s++)r=r.slice(0,-1),r+=".";return[r,s]}await super.onAdded(e),e._animGetters={objects:i=>{if(i.length<2||!e)return;const[r,s]=t(i);return{tar:e.scene.getObjectByName(r),i:s}},materials:i=>{var r,s,o;if(i.length<2||!e)return;const[l,u]=t(i);return{tar:(o=(s=(r=e.assetManager)===null||r===void 0?void 0:r.materials)===null||s===void 0?void 0:s.findMaterialsByName(l))===null||o===void 0?void 0:o[0],i:u}}}}}dA.PluginType="AnimationObjectPlugin",Js([ae(),en()],dA.prototype,"animation",void 0);let Us=V1=class{constructor(a){this.target=a,this.uuid=hP(),this.name="",this.access="",this.options={},this.duration=1e3,this.delay=0,this.repeat=1,this.repeatType="mirror",this.ease="easeInOutSine",this.updater=[],this.updateScene=!1,this.updateCamera=!1,this.updateViewer=!1,this.animSetParallel=!1,this.animSet=[],this.uiConfig=Wa("Animation Object",this,void 0,"folder",!0)}_onAccessChanged(){const a=(0,V.getOrCall)(this.target),{key:e,tar:t}=JC(this,a);if(this.from=void 0,this.to=void 0,!e||!t)return void this.refreshUi();const i=t[e];if(i==null)return void this.refreshUi();const r=()=>{if(!i)return i;if(i.isColor)return"#"+i.getHexString();const s=typeof i.clone=="function"?i.clone():typeof i=="object"?{...i}:i;return console.log(s),s};this.from=r(),this.to=r(),this.refreshUi()}refreshUi(){var a,e;(e=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||e===void 0||e.call(a,"postFrame",!0,1)}add(a){this.animSet.push(a),a.parent=this,this.refreshUi()}remove(a){const e=this.animSet.indexOf(a);e>=0&&(this.animSet.splice(e,1),a.parent=void 0,this.refreshUi())}async animate(a=!1){typeof a!="boolean"&&(a=!1);const e=(0,V.getOrCall)(this.target);if(!e)return void console.warn("AnimationObject: No viewer");a&&(this.options.to=this.from,this.options.from=this.to),this.options.repeatType=this.repeatType,this.options.repeat=this.repeat,this.updater=[],this.updateScene&&this.updater.push("scene"),this.updateCamera&&this.updater.push("camera"),this.updateViewer&&this.updater.push("viewer"),this.animSet.forEach(t=>t.target=this.target),await $C(e,this,{viewer:()=>e.setDirty(),renderer:()=>e.renderer.reset(),scene:()=>{e.scene.setDirty()},camera:()=>e.scene.activeCamera.setDirty()}),delete this.options.to,delete this.options.from}async animateReverse(){await this.animate(!0)}async removeFromParent2(){const a=(0,V.getOrCall)(this.target);this.parent&&a&&await a.confirm(`Delete: Are you sure you want to delete the animation ${this.name}?`)&&this.removeFromParent()}removeFromParent(){this.parent&&this.parent.remove(this)}addAnimation(){this.add(new V1(this.target))}};Js([ae(),Ci()],Us.prototype,"name",void 0),Js([ae(),Ci(),(0,V.onChange)(V1.prototype._onAccessChanged)],Us.prototype,"access",void 0),Js([en(),ae()],Us.prototype,"from",void 0),Js([en(),ae()],Us.prototype,"to",void 0),Js([ae()],Us.prototype,"options",void 0),Js([ae(),ai(void 0,[0,1e4],1,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"duration",void 0),Js([ae(),ai(void 0,[0,1e4],1,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"delay",void 0),Js([ae(),ai(void 0,[0,10],1,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"repeat",void 0),Js([ae(),Fs("repeatType",["loop","reverse","mirror"].map(a=>({label:a})),a=>({hidden:()=>a.from===void 0}))],Us.prototype,"repeatType",void 0),Js([ae(),Fs("ease",Object.keys(el).map(a=>({label:a})),a=>({hidden:()=>a.from===void 0}))],Us.prototype,"ease",void 0),Js([ae(),Ot(void 0,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"updateScene",void 0),Js([ae(),Ot(void 0,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"updateCamera",void 0),Js([ae(),Ot(void 0,a=>({hidden:()=>a.from===void 0}))],Us.prototype,"updateViewer",void 0),Js([Xi("Animate")],Us.prototype,"animate",null),Js([Xi("Animate Reverse")],Us.prototype,"animateReverse",null),Js([Xi("Delete")],Us.prototype,"removeFromParent2",null),Js([ae(),Ot()],Us.prototype,"animSetParallel",void 0),Js([ae(),en()],Us.prototype,"animSet",void 0),Js([Xi("Add Animation")],Us.prototype,"addAnimation",null),Us=V1=Js([$n("AnimationObject")],Us);var Xl,po=function(a,e,t,i){var r,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,e,t,i);else for(var l=a.length-1;l>=0;l--)(r=a[l])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o};let Ns=Xl=class extends Si{constructor(a=!0){super(),this.enabled=!0,this.dependencies=[],this.options={id:hP(),type:"linear",gradientUnits:"objectBoundingBox",linearOptions:{angle:45,x1:0,y1:0,x2:1,y2:1},radialOptions:{cx:.5,cy:.5,r:.5,fx:.5,fy:.5,spreadMethod:"pad"}},this.type="linear",this.gradientUnits="objectBoundingBox",this.position1=new p.FM8(0,0),this.position2=new p.FM8(1,1),this.angle=0,this.radius=.5,this.center=new p.FM8(.5,.5),this.focus=new p.FM8(.5,.5),this.spreadMethod="pad",this._svgGradient=new ok,this._needsUpdate=!1,this.colors=[new p.Ilk(1,1,1),new p.Ilk(1,0,0)],this.color1=this.colors[0],this.color2=this.colors[1],this.applyToBackground=!1,this.autoRefresh=!0,this.enabled=a}_refreshOptions(){var a,e,t,i,r,s,o,l;this.options.type=this.type,this.options.gradientUnits=this.gradientUnits,this.options.linearOptions={angle:this.angle,x1:(a=this.position1)===null||a===void 0?void 0:a.x,y1:(e=this.position1)===null||e===void 0?void 0:e.y,x2:(t=this.position2)===null||t===void 0?void 0:t.x,y2:(i=this.position2)===null||i===void 0?void 0:i.y},this.options.radialOptions={cx:(r=this.center)===null||r===void 0?void 0:r.x,cy:(s=this.center)===null||s===void 0?void 0:s.y,r:this.radius,fx:(o=this.focus)===null||o===void 0?void 0:o.x,fy:(l=this.focus)===null||l===void 0?void 0:l.y,spreadMethod:this.spreadMethod},this.setDirty()}setDirty(){this._needsUpdate=!0}addColor(){this.colors.push(new p.Ilk),this.setDirty()}refreshSvg(){if((!this.applyToBackground||this._viewer)&&(this._refreshOptions(),this._needsUpdate=!1,this._svgElement=this._svgGradient.get(this.colors,this.options),this.applyToBackground)){const a=`
            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
            <defs>
            ${this._svgElement.outerHTML}
            </defs>
            <rect width="100%" height="100%" fill="url(#${this.options.id})"/>
            </svg>
            `,e=(0,V.svgUrl)(a),t=new Image;t.src=e;const i=new p.xEZ(t);t.onload=()=>{this._svgTexture===i&&(this._svgTexture.needsUpdate=!0,this._viewer.scene.background=this._svgTexture,this._viewer.setDirty())},this._svgTexture&&this._svgTexture.dispose(),this._svgTexture=i}}async onAdded(a){await super.onAdded(a),a.addEventListener("postFrame",()=>{this.enabled&&this._needsUpdate&&this.autoRefresh&&this.refreshSvg()})}};Ns.PluginType="GradientSvgPlugin",po([Ot()],Ns.prototype,"enabled",void 0),po([ae(),Fs("type",["linear","radial"].map(a=>({label:a}))),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"type",void 0),po([ae(),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"gradientUnits",void 0),po([ae(),Mn("position1",[0,1],.01,a=>({hidden:()=>a.type!=="linear",onChange:()=>a._refreshOptions()})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"position1",void 0),po([ae(),Mn("position2",[0,1],.01,a=>({hidden:()=>a.type!=="linear",onChange:()=>a._refreshOptions()})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"position2",void 0),po([ae(),ai("angle",[0,360],1,a=>({hidden:()=>a.type!=="linear"})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"angle",void 0),po([ae(),ai("radius",[0,1],.01,a=>({hidden:()=>a.type!=="radial"})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"radius",void 0),po([ae(),Mn("center",[0,1],.01,a=>({hidden:()=>a.type!=="radial",onChange:()=>a._refreshOptions()})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"center",void 0),po([ae(),Mn("focus",[0,1],.01,a=>({hidden:()=>a.type!=="radial",onChange:()=>a._refreshOptions()})),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"focus",void 0),po([ae(),(0,V.onChange)(Xl.prototype._refreshOptions)],Ns.prototype,"spreadMethod",void 0),po([ae()],Ns.prototype,"colors",void 0),po([ea(void 0,a=>({onChange:()=>a.setDirty()})),(0,V.onChange)(Xl.prototype.setDirty)],Ns.prototype,"color1",void 0),po([ea(void 0,a=>({onChange:()=>a.setDirty()})),(0,V.onChange)(Xl.prototype.setDirty)],Ns.prototype,"color2",void 0),po([ae(),Ot(),(0,V.onChange)(Xl.prototype.setDirty)],Ns.prototype,"applyToBackground",void 0),po([Xi()],Ns.prototype,"refreshSvg",null),po([ae()],Ns.prototype,"autoRefresh",void 0),Ns=Xl=po([zi("Gradient SVG")],Ns);class ok{constructor(){}get(e,t){return this.colors=e,this.options=t,this.createGradient()}createSvgElement(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}createColorStop(e,t,i){const r=this.createSvgElement("stop");return r.setAttribute("offset",t/i*100+"%"),r.setAttribute("stop-color",e),r}colorsToStops(){const e=this.colors;return e.map((t,i)=>{const r=t.getStyle();return this.createColorStop(r,i,e.length)})}createGradientElement(){const e=this.options,t=this.createSvgElement(`${e.type}Gradient`),i=/((id)|([c|f|x|y|r][x|y|1|2]?)|(gradientUnits))/,r=e[`${e.type}Options`],s={id:e.id,type:e.type,gradientUnits:e.gradientUnits,...r};return Object.entries(s).filter(o=>i.test(o[0])).forEach(o=>{o[0]!=="type"&&t.setAttribute(o[0],o[1])}),s.angle&&t.setAttribute("gradientTransform",`rotate(${s.angle})`),t}createGradient(){const e=this.createGradientElement();return this.colorsToStops().forEach(t=>e.appendChild(t)),e}}class lk extends to{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[Bc,oA,Du,eo]},{title:"Picking",plugins:[nA,fr,Xr,Kh,cu,pv]},{title:"Scene",plugins:[iA,Ul,rA,sA,aA,Dh,pc,Dc,Yb,Ns]},{title:"Anti-aliasing",plugins:[As,Zf,tl]},{title:"Post Processing",plugins:[hc,Mb,xn,Om,$c,Kf,rp,km,Aa,Ih,Pf,ro]},{title:"Export",plugins:[td,Ol,zl,gl,jp]},{title:"Animations",plugins:[tn,Ir,dA,Ds,fm,Ad]},{title:"Modifiers",plugins:[ih,Vl,Gl,lu,Rb,Vb,Co,md]},{title:"Configurators",plugins:[Tp,Mp,xc,qb]},{title:"Plugins",plugins:[us,xo,Mo,Oa,Dl,nl,Zo,Eo,Ec,Rh,rl,Zr,od,eh]},{title:"Extras",plugins:[HC,sm,mm,uu,TC]}],XI()}async setupUi(e,t){await qI(this,e,t??this.defaultModes),this._editorInitialized=!0}}async function dP(a,{debug:e=!1,ground:t=!0,bloom:i=!0,depthTonemap:r=!0,importPopup:s=!0,caching:o=!0,presetLibrary:l=!0,switchNode:u=!0,materialConfigurator:h=!0}){a.enabled=!1,e&&await a.addPlugin(Cc),a.getPlugin(Ut)||await a.addPlugin(Ut,void 0,void 0,{storage:o&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await a.addPlugin(td),await a.addPlugin(TS),await a.addPlugin(Qb),s&&await a.addPlugin(Zr),await a.addPlugin(zC),await a.addPlugin(mm,!1),await a.getOrAddPlugin(nS),await a.addPlugin(om),await a.getOrAddPlugin(eo),await a.addPlugin(Ad),await a.addPlugin(Fp),await a.addPlugin(fr,K_,!1,!0),await Nw(a,{ground:t,bloom:i,depthTonemap:r}),l&&await a.getOrAddPlugin(Du),await a.getOrAddPlugin(Xr),await a.addPlugin(Mb),await a.addPlugin(lu,!1),await a.addPlugin(aC),await a.addPlugin(cC),await a.addPlugin(uC),await a.addPlugin(fC),await a.addPlugin(od,!1),await a.addPlugin(new ih(!1)),await a.addPlugin(Vl),await a.addPlugin(Gl),h&&((await a.addPlugin(Mp)).enableEditContextMenus=!0),u&&await a.addPlugin(Tp),await a.addPlugin(qb),await a.addPlugin(Kh),await a.addPlugin(zl),await a.addPlugin(Ol),await a.addPlugin(nA),await a.addPlugin(rA),await a.addPlugin(sA),await a.addPlugin(aA),await a.addPlugin(Bc),await a.addPlugin(oA),await a.addPlugin(iA),await a.addPlugin(pv,!1),await a.addPlugin(Yb),await a.addPlugin(cu),await a.addPlugin(fm,a.container,!1),await a.addPlugin(gl),await a.addPlugin(uu),await a.addPlugin(jp),await a.addPlugin(Ns),await a.addPlugin(dA),await a.addPlugin(md);const f=await a.addPlugin(new P_(!(0,V.mobileAndTabletCheck)()));return a.renderer.refreshPipeline(),a.scene.addEventListener("textureAdded",g=>{g.texture&&a.setEnvironmentMap(g.texture)}),f.setupPluginUi(Mo),f.setupPluginUi(Bc),f.setupPluginUi(oA),f.setupPluginUi(Zr),f.setupPluginUi(eo),f.setupPluginUi(iA),f.setupPluginUi(td),f.setupPluginUi(tn),f.setupPluginUi(Dh),u&&f.setupPluginUi(Tp),h&&f.setupPluginUi(Mp),f.setupPluginUi(Ad),f.setupPluginUi(nA),f.setupPluginUi(Kh),f.setupPluginUi(Xr),f.setupPluginUi(fr),t&&a.getPlugin(Ul)&&f.setupPluginUi(Ul),t&&a.getPlugin(Dc)&&f.setupPluginUi(Dc),f.setupPluginUi(rp),f.setupPluginUi(Ir),f.setupPluginUi(zl),f.setupPluginUi(hc),f.setupPluginUi(Mb),f.setupPluginUi(Om),f.setupPluginUi($c),f.setupPluginUi(xn),f.setupPluginUi(Kf),f.setupPluginUi(Ih),f.setupPluginUi(km),f.setupPluginUi(Rh),f.setupPluginUi(Ec),f.setupPluginUi(rA),f.setupPluginUi(ih),f.setupPluginUi(Vl),f.setupPluginUi(As),f.setupPluginUi(Ns),f.setupPluginUi(dA),f.setupPluginUi(sA),f.setupPluginUi(aA),f.setupPluginUi(Zo),f.setupPluginUi(Eo),f.setupPluginUi(rl),i&&f.setupPluginUi(Aa),f.setupPluginUi(Ol),f.setupPluginUi(xo),f.setupPluginUi(Zf),f.setupPluginUi(pc),f.setupPluginUi(Pf),f.setupPluginUi(ro),f.setupPluginUi(Gl),f.setupPluginUi(Dl),f.setupPluginUi(tl),l&&f.setupPluginUi(Du),f.setupPluginUi(xc),f.setupPluginUi(Oa),f.setupPluginUi(lu),f.setupPluginUi(Ds),f.setupPluginUi(od),f.setupPluginUi(gl),f.setupPluginUi(fm),f.setupPluginUi(cu),f.setupPluginUi(qb),f.setupPluginUi(Co),f.setupPluginUi(pv),f.setupPluginUi(eh),f.setupPluginUi(mm),f.setupPluginUi(Yb),f.setupPluginUi(us),f.setupPluginUi(uu),f.setupPluginUi(jp),f.setupPluginUi(md),a.enabled=!0,a}async function ck(a,{debug:e=!1,ground:t=!0,bloom:i=!0,depthTonemap:r=!0,importPopup:s=!0,caching:o=!0}){const l=new to(a);return await dP(l,{debug:e,ground:t,bloom:i,depthTonemap:r,importPopup:s,caching:o}),l}async function uk(a,{debug:e=!1,ground:t=!0,bloom:i=!0,depthTonemap:r=!0,importPopup:s=!1,enableDrop:o=!1,caching:l=!0}={}){const u=new to(a);return e&&await u.addPlugin(Cc),u.getPlugin(Ut)||u.addPluginSync(Ut,void 0,void 0,{storage:l&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await u.addPlugin(W0,!0),await Nw(u,{ground:t,bloom:i,depthTonemap:r,enableDrop:o,importPopup:s}),await u.getOrAddPlugin(Xr),u}})(),__webpackgi_exports__.MWW,__webpackgi_exports__.LY2,__webpackgi_exports__.GYo,__webpackgi_exports__.GPz,__webpackgi_exports__.HRj,__webpackgi_exports__.li4,__webpackgi_exports__.FO5,__webpackgi_exports__.Nlh,__webpackgi_exports__.Mp4;var __webpackgi_exports__AViewerPlugin=__webpackgi_exports__.QvI;__webpackgi_exports__.PrA,__webpackgi_exports__.JHp,__webpackgi_exports__.bGH,__webpackgi_exports__.NDo,__webpackgi_exports__.gSk,__webpackgi_exports__.WMw,__webpackgi_exports__.OTo,__webpackgi_exports__.T6w,__webpackgi_exports__.Se2,__webpackgi_exports__.cum,__webpackgi_exports__.Mig,__webpackgi_exports__.B$7,__webpackgi_exports__.i_9,__webpackgi_exports__.bBp,__webpackgi_exports__.m7l,__webpackgi_exports__.sYA,__webpackgi_exports__.Xcj,__webpackgi_exports__.mzJ,__webpackgi_exports__.ZZA,__webpackgi_exports__.$Ph,__webpackgi_exports__.T__,__webpackgi_exports__.HkE,__webpackgi_exports__.tGC,__webpackgi_exports__.g1S,__webpackgi_exports__.I$C,__webpackgi_exports__.QIH,__webpackgi_exports__._JE,__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_,__webpackgi_exports__.b7R,__webpackgi_exports__.BDV,__webpackgi_exports__.Ea_,__webpackgi_exports__.qff,__webpackgi_exports__.tmC,__webpackgi_exports__.BON,__webpackgi_exports__.P40,__webpackgi_exports__.wLL,__webpackgi_exports__.iHO,__webpackgi_exports__.BbS,__webpackgi_exports__.kqm,__webpackgi_exports__.Hmr,__webpackgi_exports__.SJI,__webpackgi_exports__.mTL,__webpackgi_exports__.y8_,__webpackgi_exports__._Li,__webpackgi_exports__.w7U,__webpackgi_exports__.g56,__webpackgi_exports__.bj3,__webpackgi_exports__.z81,__webpackgi_exports__._MY,__webpackgi_exports__.L7J,__webpackgi_exports__.yEv,__webpackgi_exports__.dFZ,__webpackgi_exports__.N$j,__webpackgi_exports__._YM,__webpackgi_exports__.TUj,__webpackgi_exports__.ZzF,__webpackgi_exports__.qzb,__webpackgi_exports__.GQ,__webpackgi_exports__.nvb,__webpackgi_exports__.DvJ,__webpackgi_exports__.fQA,__webpackgi_exports__.cPz,__webpackgi_exports__.TlE,__webpackgi_exports__.u9r,__webpackgi_exports__.s4_,__webpackgi_exports__.T95,__webpackgi_exports__.F5w,__webpackgi_exports__.NlP,__webpackgi_exports__.$8Z,__webpackgi_exports__.YYN,__webpackgi_exports__.CtF,__webpackgi_exports__.V1s,__webpackgi_exports__.jOv,__webpackgi_exports__.Rki,__webpackgi_exports__.pzV,__webpackgi_exports__.itZ,__webpackgi_exports__.MMq,__webpackgi_exports__.qKx,__webpackgi_exports__.Hmi,__webpackgi_exports__.X4S,__webpackgi_exports__.vlJ,__webpackgi_exports__.nPO,__webpackgi_exports__.zcQ,__webpackgi_exports__.GH1,__webpackgi_exports__.ROQ,__webpackgi_exports__.YN5,__webpackgi_exports__.BVQ,__webpackgi_exports__.YT8,__webpackgi_exports__._DE,__webpackgi_exports__.YGz,__webpackgi_exports__.trn,__webpackgi_exports__.zf8,__webpackgi_exports__.uWy,__webpackgi_exports__.wYQ,__webpackgi_exports__.SUY;var __webpackgi_exports__Color=__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R,__webpackgi_exports__.epp,__webpackgi_exports__.xmJ,__webpackgi_exports__.GD$,__webpackgi_exports__.Z_g,__webpackgi_exports__.EB7,__webpackgi_exports__.DqL,__webpackgi_exports__._3,__webpackgi_exports__.b_z,__webpackgi_exports__.OCn,__webpackgi_exports__.N_j,__webpackgi_exports__.hNv,__webpackgi_exports__._am,__webpackgi_exports__.kB7,__webpackgi_exports__.fY$,__webpackgi_exports__.vxC,__webpackgi_exports__.BtG,__webpackgi_exports__.cBK,__webpackgi_exports__.g8_,__webpackgi_exports__.AXT,__webpackgi_exports__.yj7,__webpackgi_exports__.dYG,__webpackgi_exports__.tm_,__webpackgi_exports__.S2y,__webpackgi_exports__.B02,__webpackgi_exports__.PeU,__webpackgi_exports__.Hyl,__webpackgi_exports__.Wqd,__webpackgi_exports__.c0Q,__webpackgi_exports__.re0,__webpackgi_exports__.Xaj,__webpackgi_exports__.DUb,__webpackgi_exports__.dZ3,__webpackgi_exports__.m_w,__webpackgi_exports__.fHI,__webpackgi_exports__.LBq,__webpackgi_exports__.Qww,__webpackgi_exports__.CGV,__webpackgi_exports__.JUT,__webpackgi_exports__.p3g,__webpackgi_exports__.IEO,__webpackgi_exports__.yxD,__webpackgi_exports__.CUS,__webpackgi_exports__.A5E,__webpackgi_exports__.zqG,__webpackgi_exports__.PfX,__webpackgi_exports__.Q1o,__webpackgi_exports__.jfJ,__webpackgi_exports__.T_J,__webpackgi_exports__.tEQ,__webpackgi_exports__.gb4,__webpackgi_exports__.qkB,__webpackgi_exports__.cvk,__webpackgi_exports__.HWo,__webpackgi_exports__.brP,__webpackgi_exports__.$YQ,__webpackgi_exports__.X8d,__webpackgi_exports__.Zdt,__webpackgi_exports__.yNB,__webpackgi_exports__.h7x,__webpackgi_exports__.Ox3,__webpackgi_exports__.qtn,__webpackgi_exports__.cBI,__webpackgi_exports__.cU9,__webpackgi_exports__.ntt,__webpackgi_exports__.DT1,__webpackgi_exports__.Kgo,__webpackgi_exports__.ehD,__webpackgi_exports__.fhJ,__webpackgi_exports__.y1s,__webpackgi_exports__.fSK,__webpackgi_exports__.Vdb,__webpackgi_exports__.l8J,__webpackgi_exports__.dj0,__webpackgi_exports__.QM0,__webpackgi_exports__.n94,__webpackgi_exports__.OIS,__webpackgi_exports__.q8b,__webpackgi_exports__.TOt,__webpackgi_exports__.xaN,__webpackgi_exports__.Ny0,__webpackgi_exports__.NeD,__webpackgi_exports__.Zof,__webpackgi_exports__.N1Y,__webpackgi_exports__.itK,__webpackgi_exports__.F1y,__webpackgi_exports__.eD,__webpackgi_exports__.jwo,__webpackgi_exports__.dSO,__webpackgi_exports__.Bf4,__webpackgi_exports__.USm,__webpackgi_exports__.pBf,__webpackgi_exports__.eBg,__webpackgi_exports__.$Vf,__webpackgi_exports__.O7d,__webpackgi_exports__.ksq,__webpackgi_exports__.hFL,__webpackgi_exports__.gXf,__webpackgi_exports__.hH6,__webpackgi_exports__.izP,__webpackgi_exports__.kpi,__webpackgi_exports__.DwZ,__webpackgi_exports__.kN3,__webpackgi_exports__.e62,__webpackgi_exports__.a$l,__webpackgi_exports__.OM3,__webpackgi_exports__.VzW,__webpackgi_exports__.ybr,__webpackgi_exports__.yo9,__webpackgi_exports__.Dzq,__webpackgi_exports__.zCA,__webpackgi_exports__.$Bt,__webpackgi_exports__.Wzm,__webpackgi_exports__.Wl3,__webpackgi_exports__.iWj,__webpackgi_exports__.DNz,__webpackgi_exports__.m1M,__webpackgi_exports__.ylh,__webpackgi_exports__.v9Y,__webpackgi_exports__.LSk,__webpackgi_exports__.LHE,__webpackgi_exports__.KE0,__webpackgi_exports__.KCF,__webpackgi_exports__.a4n,__webpackgi_exports__.NKC,__webpackgi_exports__.jrv,__webpackgi_exports__.zIH,__webpackgi_exports__.Hfk,__webpackgi_exports__.png,__webpackgi_exports__.tAj,__webpackgi_exports__.Eb_,__webpackgi_exports__.SJj,__webpackgi_exports__.cF0,__webpackgi_exports__.BT2,__webpackgi_exports__._8p,__webpackgi_exports__.V5Z,__webpackgi_exports__.s5b,__webpackgi_exports__.BHZ,__webpackgi_exports__.hkn,__webpackgi_exports__.GFY,__webpackgi_exports__.hZr,__webpackgi_exports__.Zen,__webpackgi_exports__.w$m,__webpackgi_exports__.Jjb,__webpackgi_exports__.ksN,__webpackgi_exports__.j4z,__webpackgi_exports__.OAl,__webpackgi_exports__.VLJ;var __webpackgi_exports__GroundPlugin=__webpackgi_exports__.C73;__webpackgi_exports__.ZAu,__webpackgi_exports__.ibP,__webpackgi_exports__.lth,__webpackgi_exports__._fI,__webpackgi_exports__.hUN,__webpackgi_exports__.cLu,__webpackgi_exports__.vmT,__webpackgi_exports__.Qpg,__webpackgi_exports__.So8,__webpackgi_exports__.eOv,__webpackgi_exports__.Wjw,__webpackgi_exports__.cJO,__webpackgi_exports__.QRU,__webpackgi_exports__.S3k,__webpackgi_exports__.OPJ,__webpackgi_exports__.PpQ,__webpackgi_exports__.q_9,__webpackgi_exports__.ZRs,__webpackgi_exports__.oqc,__webpackgi_exports__.T_x,__webpackgi_exports__.lb7,__webpackgi_exports__.L5s,__webpackgi_exports__.$TI,__webpackgi_exports__.SPe,__webpackgi_exports__.aVm,__webpackgi_exports__.j87,__webpackgi_exports__.RNb,__webpackgi_exports__.Kz5,__webpackgi_exports__.LYt,__webpackgi_exports__.vpT,__webpackgi_exports__.kB5,__webpackgi_exports__._C8,__webpackgi_exports__.Syv,__webpackgi_exports__.NMF,__webpackgi_exports__.pIN,__webpackgi_exports__.eMJ,__webpackgi_exports__.rN7,__webpackgi_exports__.iUp,__webpackgi_exports__.GFd,__webpackgi_exports__.x5V,__webpackgi_exports__.tUh,__webpackgi_exports__.z8B,__webpackgi_exports__.vcl,__webpackgi_exports__.GZb,__webpackgi_exports__.p7y,__webpackgi_exports__.e6l,__webpackgi_exports__.S9g,__webpackgi_exports__.D67,__webpackgi_exports__.Zr5,__webpackgi_exports__.M$G,__webpackgi_exports__.vCF,__webpackgi_exports__.yt0,__webpackgi_exports__.uXU,__webpackgi_exports__._kC,__webpackgi_exports__.lk7,__webpackgi_exports__.USc,__webpackgi_exports__.x12,__webpackgi_exports__.w_R,__webpackgi_exports__.Zzh,__webpackgi_exports__.nls,__webpackgi_exports__.g_z,__webpackgi_exports__.U7,__webpackgi_exports__.FT0,__webpackgi_exports__.L1_,__webpackgi_exports__.blk,__webpackgi_exports__.YRm,__webpackgi_exports__.ejS,__webpackgi_exports__.wUb,__webpackgi_exports__.zOz,__webpackgi_exports__.rnI,__webpackgi_exports__.wem,__webpackgi_exports__.lfu,__webpackgi_exports__.FDw,__webpackgi_exports__.lRj,__webpackgi_exports__.D1R,__webpackgi_exports__.qyh,__webpackgi_exports__.GUF,__webpackgi_exports__.EoG,__webpackgi_exports__.aNw,__webpackgi_exports__.Zp0,__webpackgi_exports__.lLk,__webpackgi_exports__.NHT,__webpackgi_exports__.jAl,__webpackgi_exports__.uEv,__webpackgi_exports__.YKA,__webpackgi_exports__.cRx,__webpackgi_exports__.Y8D,__webpackgi_exports__.RsA,__webpackgi_exports__.Y0m,__webpackgi_exports__.F5T,__webpackgi_exports__.EDU,__webpackgi_exports__.z$Q,__webpackgi_exports__.KA8,__webpackgi_exports__.ZqF,__webpackgi_exports__.XUj,__webpackgi_exports__.Me$,__webpackgi_exports__.u7G,__webpackgi_exports__.PEk,__webpackgi_exports__.BG4,__webpackgi_exports__.M8C,__webpackgi_exports__.Vkp,__webpackgi_exports__.yGw,__webpackgi_exports__.Sm8,__webpackgi_exports__.Kj0,__webpackgi_exports__.vBJ,__webpackgi_exports__.QfV,__webpackgi_exports__.lRF,__webpackgi_exports__.Lun,__webpackgi_exports__.YBo,__webpackgi_exports__.kaV,__webpackgi_exports__.RSm,__webpackgi_exports__.NDk,__webpackgi_exports__.xoR,__webpackgi_exports__.EJi,__webpackgi_exports__.Wid,__webpackgi_exports__.iuj,__webpackgi_exports__.IKL,__webpackgi_exports__.r_,__webpackgi_exports__.OoA,__webpackgi_exports__.qhX,__webpackgi_exports__.CRe,__webpackgi_exports__.qPT,__webpackgi_exports__.M5h,__webpackgi_exports__.Ns1,__webpackgi_exports__.TyD,__webpackgi_exports__.vZf,__webpackgi_exports__.HTd,__webpackgi_exports__.aH4,__webpackgi_exports__.YLQ,__webpackgi_exports__.xoQ,__webpackgi_exports__.BVF,__webpackgi_exports__.MyG,__webpackgi_exports__.jFi,__webpackgi_exports__.aCh,__webpackgi_exports__.uL9,__webpackgi_exports__.TNj,__webpackgi_exports__.IFH,__webpackgi_exports__.bdR,__webpackgi_exports__.RPs,__webpackgi_exports__.kM_,__webpackgi_exports__.O78,__webpackgi_exports__.M6v,__webpackgi_exports__.RvT,__webpackgi_exports__.dUE,__webpackgi_exports__.oe_,__webpackgi_exports__.BuN,__webpackgi_exports__.Tme,__webpackgi_exports__.N9P,__webpackgi_exports__.tfP,__webpackgi_exports__.Gql,__webpackgi_exports__.$XY,__webpackgi_exports__.O9d,__webpackgi_exports__.zEO,__webpackgi_exports__.qfx,__webpackgi_exports__.PA7,__webpackgi_exports__.REq,__webpackgi_exports__.pQR,__webpackgi_exports__.ghN,__webpackgi_exports__.Hy8,__webpackgi_exports__.Wpd,__webpackgi_exports__.LgZ,__webpackgi_exports__.iWC,__webpackgi_exports__.mqn,__webpackgi_exports__.SKe,__webpackgi_exports__.iKG,__webpackgi_exports__.rCq,__webpackgi_exports__._iA,__webpackgi_exports__.ntZ,__webpackgi_exports__.anP,__webpackgi_exports__.X2e,__webpackgi_exports__.oxT,__webpackgi_exports__.FCo,__webpackgi_exports__.y$t,__webpackgi_exports__.cPb,__webpackgi_exports__.lmx,__webpackgi_exports__.JOQ,__webpackgi_exports__.BKK,__webpackgi_exports__._12,__webpackgi_exports__.tJx,__webpackgi_exports__.mjX,__webpackgi_exports__.cek,__webpackgi_exports__.qD0,__webpackgi_exports__.xG9,__webpackgi_exports__.eqi,__webpackgi_exports__.wI8,__webpackgi_exports__.Sgv,__webpackgi_exports__.woe,__webpackgi_exports__.UY4,__webpackgi_exports__.aq0,__webpackgi_exports__.ujx,__webpackgi_exports__.Uol,__webpackgi_exports__.JiH,__webpackgi_exports__.VYz,__webpackgi_exports__.B2H,__webpackgi_exports__._Pm,__webpackgi_exports__.EsW,__webpackgi_exports__.iUV,__webpackgi_exports__.tf,__webpackgi_exports__.ZQ6,__webpackgi_exports__.mXe,__webpackgi_exports__._fP,__webpackgi_exports__.iLg,__webpackgi_exports__.zbs,__webpackgi_exports__.ZTh,__webpackgi_exports__.HdW,__webpackgi_exports__.UZH,__webpackgi_exports__.mSO,__webpackgi_exports__.wk1,__webpackgi_exports__.E2K,__webpackgi_exports__.FUD,__webpackgi_exports__.pKu,__webpackgi_exports__.GG6,__webpackgi_exports__.Gih,__webpackgi_exports__.iiP,__webpackgi_exports__.SvJ,__webpackgi_exports__.ptH,__webpackgi_exports__.jZA,__webpackgi_exports__.y2t,__webpackgi_exports__.gi4,__webpackgi_exports__.Djp,__webpackgi_exports__.BG$,__webpackgi_exports__.NYV,__webpackgi_exports__.xJs,__webpackgi_exports__.bsb,__webpackgi_exports__.ekQ,__webpackgi_exports__.CaW,__webpackgi_exports__.eaV,__webpackgi_exports__.BFQ,__webpackgi_exports__.v3W,__webpackgi_exports__.ILR,__webpackgi_exports__.G_r,__webpackgi_exports__.N3F,__webpackgi_exports__.fto,__webpackgi_exports__.l0P,__webpackgi_exports__.vCx,__webpackgi_exports__._AM,__webpackgi_exports__.wuA,__webpackgi_exports__.av9,__webpackgi_exports__.CtA,__webpackgi_exports__.fpq,__webpackgi_exports__.BvQ,__webpackgi_exports__.FZJ,__webpackgi_exports__.FIo,__webpackgi_exports__.zHn,__webpackgi_exports__.iMs,__webpackgi_exports__.T_f,__webpackgi_exports__.hEm,__webpackgi_exports__.D9w,__webpackgi_exports__.sHH,__webpackgi_exports__.CdI,__webpackgi_exports__.rkc,__webpackgi_exports__.rpg,__webpackgi_exports__.ce8,__webpackgi_exports__.rOj,__webpackgi_exports__.P6m,__webpackgi_exports__.JA6,__webpackgi_exports__.V4E,__webpackgi_exports__.o8S,__webpackgi_exports__.flB,__webpackgi_exports__.lGU,__webpackgi_exports__.vuL,__webpackgi_exports__.KI_,__webpackgi_exports__.iLN,__webpackgi_exports__.X6w,__webpackgi_exports__.rz_,__webpackgi_exports__.jsw,__webpackgi_exports__.srG,__webpackgi_exports__.i6Z,__webpackgi_exports__.vfv,__webpackgi_exports__.xsS,__webpackgi_exports__.or,__webpackgi_exports__.EQj,__webpackgi_exports__.Rnn,__webpackgi_exports__.TyN,__webpackgi_exports__.ov0,__webpackgi_exports__.WdD,__webpackgi_exports__.Vj0,__webpackgi_exports__.jyz,__webpackgi_exports__.mTM,__webpackgi_exports__.Mn1,__webpackgi_exports__.Hlq,__webpackgi_exports__.Fi7,__webpackgi_exports__.Tn7,__webpackgi_exports__.bnF,__webpackgi_exports__.HW6,__webpackgi_exports__.oa8,__webpackgi_exports__.T_1,__webpackgi_exports__.zHJ,__webpackgi_exports__.iDF,__webpackgi_exports__.iAb,__webpackgi_exports__.d4E,__webpackgi_exports__.lBg,__webpackgi_exports__.JeJ,__webpackgi_exports__.FKY,__webpackgi_exports__.zlZ,__webpackgi_exports__.vkg,__webpackgi_exports__.brh,__webpackgi_exports__.kZK,__webpackgi_exports__.puG,__webpackgi_exports__.VJK,__webpackgi_exports__.OdW,__webpackgi_exports__._YX,__webpackgi_exports__.TUv,__webpackgi_exports__.Hw6,__webpackgi_exports__.aLr,__webpackgi_exports__.Aip,__webpackgi_exports__.xo$,__webpackgi_exports__.bIn,__webpackgi_exports__.$V,__webpackgi_exports__.lDi,__webpackgi_exports__.gti,__webpackgi_exports__.PMe,__webpackgi_exports__.iwP,__webpackgi_exports__.FvO,__webpackgi_exports__.jyi,__webpackgi_exports__.xeV,__webpackgi_exports__.k74,__webpackgi_exports__.RlZ,__webpackgi_exports__.KhW,__webpackgi_exports__.HgB,__webpackgi_exports__.W2J,__webpackgi_exports__.JWc,__webpackgi_exports__.u37,__webpackgi_exports__.Z6B,__webpackgi_exports__.QZ1,__webpackgi_exports__.Ir4,__webpackgi_exports__.NwF,__webpackgi_exports__.Wbm,__webpackgi_exports__.N4l,__webpackgi_exports__.Jxm,__webpackgi_exports__.ej9,__webpackgi_exports__.QmN,__webpackgi_exports__.Y4W,__webpackgi_exports__.IOt,__webpackgi_exports__.NOD,__webpackgi_exports__.L5g,__webpackgi_exports__.H$k,__webpackgi_exports__.cuP,__webpackgi_exports__.xEZ,__webpackgi_exports__.dpR,__webpackgi_exports__.wOD,__webpackgi_exports__.KNb,__webpackgi_exports__.IiN,__webpackgi_exports__.Cne,__webpackgi_exports__.XvJ,__webpackgi_exports__.XZw,__webpackgi_exports__.FE5,__webpackgi_exports__.lUF,__webpackgi_exports__.Mck,__webpackgi_exports__.lVp,__webpackgi_exports__.Lpo,__webpackgi_exports__.CJI,__webpackgi_exports__.z$h,__webpackgi_exports__.UlW,__webpackgi_exports__.WwZ,__webpackgi_exports__.zG7,__webpackgi_exports__.Lcc,__webpackgi_exports__.WXh,__webpackgi_exports__.Vjr,__webpackgi_exports__.LuM,__webpackgi_exports__.LP5,__webpackgi_exports__.ub3,__webpackgi_exports__.OV,__webpackgi_exports__.G_n,__webpackgi_exports__.xfE,__webpackgi_exports__.qlB,__webpackgi_exports__.lCJ,__webpackgi_exports__.WTc,__webpackgi_exports__.rAo,__webpackgi_exports__.LZj,__webpackgi_exports__.xWb,__webpackgi_exports__.gH0,__webpackgi_exports__.rBU,__webpackgi_exports__.rDY,__webpackgi_exports__.ywz,__webpackgi_exports__.wJv,__webpackgi_exports__.JQ4,__webpackgi_exports__.k0A,__webpackgi_exports__.irR,__webpackgi_exports__.LsT,__webpackgi_exports__.q5h,__webpackgi_exports__.TKh,__webpackgi_exports__.tyg,__webpackgi_exports__.Ro5,__webpackgi_exports__.Saj,__webpackgi_exports__.CHp,__webpackgi_exports__.dwk,__webpackgi_exports__.t0w,__webpackgi_exports__.M7$,__webpackgi_exports__.ML4,__webpackgi_exports__.FM8;var __webpackgi_exports__Vector3=__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg,__webpackgi_exports__.yC1,__webpackgi_exports__.lHq,__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW,__webpackgi_exports__.QEt,__webpackgi_exports__.IFZ,__webpackgi_exports__.b5g,__webpackgi_exports__.Ywn,__webpackgi_exports__.GVz,__webpackgi_exports__._RZ,__webpackgi_exports__.oAp,__webpackgi_exports__.kFz,__webpackgi_exports__.dd2,__webpackgi_exports__.CP7,__webpackgi_exports__.fQK,__webpackgi_exports__.JCZ,__webpackgi_exports__.Wd$,__webpackgi_exports__.t1_,__webpackgi_exports__.v27,__webpackgi_exports__.Uk6,__webpackgi_exports__.H7Z,__webpackgi_exports__._sL,__webpackgi_exports__.czO,__webpackgi_exports__.Pnf,__webpackgi_exports__.c8b,__webpackgi_exports__._lf,__webpackgi_exports__.ad5,__webpackgi_exports__.sZV,__webpackgi_exports__.TfA,__webpackgi_exports__.sKX,__webpackgi_exports__.UdM,__webpackgi_exports__.P0y,__webpackgi_exports__.L_r,__webpackgi_exports__.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.b5G,__webpackgi_exports__.UeO,__webpackgi_exports__.qCx,__webpackgi_exports__.$nx,__webpackgi_exports__.Bk6,__webpackgi_exports__.EER,__webpackgi_exports__.y4l,__webpackgi_exports__.P39,__webpackgi_exports__.HI1,__webpackgi_exports__.ZYi,__webpackgi_exports__.wXW,__webpackgi_exports__.r5x,__webpackgi_exports__.MSI,__webpackgi_exports__.EUu,__webpackgi_exports__.jtH,__webpackgi_exports__.T0T,__webpackgi_exports__.gAb,__webpackgi_exports__.je_,__webpackgi_exports__.wBP,__webpackgi_exports__.LU2,__webpackgi_exports__.wQL,__webpackgi_exports__.Zs7,__webpackgi_exports__.sMc,__webpackgi_exports__.x7s,__webpackgi_exports__.Mnd,__webpackgi_exports__.A0_,__webpackgi_exports__.d73,__webpackgi_exports__.HCD,__webpackgi_exports__.YQ8,__webpackgi_exports__.RG9,__webpackgi_exports__.G2P,__webpackgi_exports__.XLf,__webpackgi_exports__.CGN,__webpackgi_exports__.RGi,__webpackgi_exports__.mvg,__webpackgi_exports__.Hiy,__webpackgi_exports__.XMc,__webpackgi_exports__.N7M,__webpackgi_exports__.iv,__webpackgi_exports__.n55,__webpackgi_exports__.IaC,__webpackgi_exports__.h9t,__webpackgi_exports__.yDW,__webpackgi_exports__.gJv,__webpackgi_exports__.l$g,__webpackgi_exports__.vQi,__webpackgi_exports__.$MY,__webpackgi_exports__.wJl,__webpackgi_exports__.Z7Y,__webpackgi_exports__.X7D,__webpackgi_exports__.BnX,__webpackgi_exports__.uZ5,__webpackgi_exports__.zVI,__webpackgi_exports__.Wz1,__webpackgi_exports__.DpF,__webpackgi_exports__.nNb,__webpackgi_exports__.cqZ,__webpackgi_exports__.pKN,__webpackgi_exports__.CN8,__webpackgi_exports__.DdI,__webpackgi_exports__.rrX,__webpackgi_exports__.uqj,__webpackgi_exports__.Z9P,__webpackgi_exports__.KlC,__webpackgi_exports__.KVn,__webpackgi_exports__.oau,__webpackgi_exports__.aw9,__webpackgi_exports__.Aap,__webpackgi_exports__.Dxg,__webpackgi_exports__.MjT,__webpackgi_exports__.F7Q,__webpackgi_exports__.IFq,__webpackgi_exports__.IJl,__webpackgi_exports__.O5A,__webpackgi_exports__.wCn,__webpackgi_exports__.gGT,__webpackgi_exports__.hqj,__webpackgi_exports__.pEc,__webpackgi_exports__.Bi6,__webpackgi_exports__.fi_,__webpackgi_exports__.TT,__webpackgi_exports__.q2Z,__webpackgi_exports__.NyK,__webpackgi_exports__.bgu,__webpackgi_exports__.kcS,__webpackgi_exports__.rRN,__webpackgi_exports__.ivY,__webpackgi_exports__._s1,__webpackgi_exports__._HO,__webpackgi_exports__.tpL,__webpackgi_exports__.DMK,__webpackgi_exports__.LjN,__webpackgi_exports__.iFs,__webpackgi_exports__.qTg,__webpackgi_exports__.J4G,__webpackgi_exports__.Zj8,__webpackgi_exports__.Wtl,__webpackgi_exports__.DmK,__webpackgi_exports__.Htt,__webpackgi_exports__.Nv0,__webpackgi_exports__.tCp,__webpackgi_exports__.Hx7,__webpackgi_exports__.imt,__webpackgi_exports__.US6,__webpackgi_exports__.vZs,__webpackgi_exports__.TE$,__webpackgi_exports__.lmu,__webpackgi_exports__.SvO,__webpackgi_exports__.YQY,__webpackgi_exports__.mZN,__webpackgi_exports__.VvG,__webpackgi_exports__.omp,__webpackgi_exports__.utz,__webpackgi_exports__.TFV,__webpackgi_exports__.hrz,__webpackgi_exports__.H$s,__webpackgi_exports__.JKM,__webpackgi_exports__.jZf,__webpackgi_exports__.RjL,__webpackgi_exports__.RRI,__webpackgi_exports__.RUq,__webpackgi_exports__._t4,__webpackgi_exports__.YHh,__webpackgi_exports__.R8g,__webpackgi_exports__.f1L,__webpackgi_exports__.Bbl,__webpackgi_exports__.V9r,__webpackgi_exports__.a95,__webpackgi_exports__.PZ2,__webpackgi_exports__.w7A,__webpackgi_exports__.N6S,__webpackgi_exports__.Uxp,__webpackgi_exports__.tAz,__webpackgi_exports__.R$F,__webpackgi_exports__.N33,__webpackgi_exports__.JFD,__webpackgi_exports__.gw2,__webpackgi_exports__.rfc,__webpackgi_exports__.wo6,__webpackgi_exports__.V4T,__webpackgi_exports__.H4P,__webpackgi_exports__.NLp,__webpackgi_exports__.swA,__webpackgi_exports__._Z3,__webpackgi_exports__.ivc,__webpackgi_exports__.rZ1,__webpackgi_exports__.CpZ,__webpackgi_exports__.dyc,__webpackgi_exports__.MxZ,__webpackgi_exports__.btp,__webpackgi_exports__.mXy,__webpackgi_exports__.Ej0,__webpackgi_exports__.ep4,__webpackgi_exports__.DQP,__webpackgi_exports__.VNr,__webpackgi_exports__.V7q,__webpackgi_exports__.hiB,__webpackgi_exports__.zEk,__webpackgi_exports__.qfq,__webpackgi_exports__.piB,__webpackgi_exports__.IIc,__webpackgi_exports__.rrF,__webpackgi_exports__.naq,__webpackgi_exports__.zlD,__webpackgi_exports__.sXR,__webpackgi_exports__.p5I,__webpackgi_exports__.wps,__webpackgi_exports__.wuo,__webpackgi_exports__.GpE,__webpackgi_exports__.F4b,__webpackgi_exports__.NN$,__webpackgi_exports__.t$v,__webpackgi_exports__.tdn,__webpackgi_exports__.Y9t,__webpackgi_exports__.GEo,__webpackgi_exports__.GGm,__webpackgi_exports__.DH3,__webpackgi_exports__.uxM,__webpackgi_exports__.zH3,__webpackgi_exports__.MLs,__webpackgi_exports__.xXG,__webpackgi_exports__.YM4,__webpackgi_exports__.iAx,__webpackgi_exports__.lDn,__webpackgi_exports__.P1O,__webpackgi_exports__.iib,__webpackgi_exports__.qf5,__webpackgi_exports__.n4s,__webpackgi_exports__.fr,__webpackgi_exports__.Z9s,__webpackgi_exports__.oaQ,__webpackgi_exports__.CD7,__webpackgi_exports__.Rc0,__webpackgi_exports__.iPG,__webpackgi_exports__.TIc,__webpackgi_exports__.xsC,__webpackgi_exports__.zOc,__webpackgi_exports__.i8W,__webpackgi_exports__.r46,__webpackgi_exports__.z2C,__webpackgi_exports__.N4A,__webpackgi_exports__.hjq,__webpackgi_exports__._X$,__webpackgi_exports__._yn,__webpackgi_exports__.Dyg,__webpackgi_exports__.cUc,__webpackgi_exports__.zGw,__webpackgi_exports__.Ctq,__webpackgi_exports__.$ch,__webpackgi_exports__.k5b,__webpackgi_exports__.kZl,__webpackgi_exports__.OCg,__webpackgi_exports__.Kd3,__webpackgi_exports__.YjH,__webpackgi_exports__.Ui8,__webpackgi_exports__.YD2,__webpackgi_exports__.vi9,__webpackgi_exports__.ij3,__webpackgi_exports__.pJq,__webpackgi_exports__.YPW,__webpackgi_exports__._tY,__webpackgi_exports__.Bg1,__webpackgi_exports__.kon,__webpackgi_exports__.M3g,__webpackgi_exports__.F2z,__webpackgi_exports__.pJF,__webpackgi_exports__.knz,__webpackgi_exports__.Ejo,__webpackgi_exports__.BgY,__webpackgi_exports__.qCG,__webpackgi_exports__.HD9,__webpackgi_exports__.Rgz,__webpackgi_exports__.fEB,__webpackgi_exports__.Udc,__webpackgi_exports__.ZQg,__webpackgi_exports__.ofC,__webpackgi_exports__.yRy,__webpackgi_exports__._NL,__webpackgi_exports__.LCA,__webpackgi_exports__.Sy1,__webpackgi_exports__.Vs_,__webpackgi_exports__.j1w,__webpackgi_exports__.i8J,__webpackgi_exports__.p7C,__webpackgi_exports__.Y8s,__webpackgi_exports__.ZAS,__webpackgi_exports__.ipH,__webpackgi_exports__.$TF,__webpackgi_exports__.uZI,__webpackgi_exports__.VWG,__webpackgi_exports__.pQ7,__webpackgi_exports__.STw,__webpackgi_exports__.jc8,__webpackgi_exports__.BL_,__webpackgi_exports__.S6,__webpackgi_exports__.T8U,__webpackgi_exports__.TD6,__webpackgi_exports__.BTW,__webpackgi_exports__.akS,__webpackgi_exports__.QKE,__webpackgi_exports__.dKx,__webpackgi_exports__.doP,__webpackgi_exports__.$jA,__webpackgi_exports__.T99,__webpackgi_exports__.LJS,__webpackgi_exports__.VsW,__webpackgi_exports__.LZE,__webpackgi_exports__.YMc,__webpackgi_exports__.aPg,__webpackgi_exports__.LFn,__webpackgi_exports__.VsX,__webpackgi_exports__.wey,__webpackgi_exports__.MaE,__webpackgi_exports__.s4x,__webpackgi_exports__.FJA,__webpackgi_exports__.vIA,__webpackgi_exports__.Spv,__webpackgi_exports__.w8l,__webpackgi_exports__.riG,__webpackgi_exports__.Kbh,__webpackgi_exports__.BFq,__webpackgi_exports__.t8K,__webpackgi_exports__.Q7n,__webpackgi_exports__.KGF,__webpackgi_exports__.e5,__webpackgi_exports__.Rik,__webpackgi_exports__.GZo,__webpackgi_exports__.Bds,__webpackgi_exports__.HTu,__webpackgi_exports__.cTq,__webpackgi_exports__.X_Y,__webpackgi_exports__.dA8,__webpackgi_exports__.NSm,__webpackgi_exports__.bwS,__webpackgi_exports__.Lks,__webpackgi_exports__.Rvq,__webpackgi_exports__.P4F,__webpackgi_exports__.Pd0,__webpackgi_exports__.Pjo,__webpackgi_exports__.Tum,__webpackgi_exports__.dRH,__webpackgi_exports__.RX0,__webpackgi_exports__.reQ,__webpackgi_exports__.cWm,__webpackgi_exports__.NC9,__webpackgi_exports__.$Re,__webpackgi_exports__.Xo9,__webpackgi_exports__.LNO,__webpackgi_exports__.iZP;export{__webpackgi_exports__ViewerApp as _,__webpackgi_exports__addBasePlugins as a,__webpackgi_exports__Vector3 as b,__webpackgi_exports__AssetManagerPlugin as c,__webpackgi_exports__GroundPlugin as d,__webpackgi_exports__AViewerPlugin as e,__webpackgi_exports__Color as f};
